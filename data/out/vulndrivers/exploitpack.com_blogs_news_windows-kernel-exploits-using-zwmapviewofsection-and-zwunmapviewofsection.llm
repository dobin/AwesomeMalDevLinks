Title:
Windows Kernel Exploits Using ZwMapViewOfSection and ZwUnmapViewOfSection

Type:
Blog Post

Short Summary (4–8 sentences max):
- This write-up demonstrates a Windows kernel exploitation chain that abuses a vulnerable driver exposing IOCTLs that call `ZwMapViewOfSection`/`ZwUnmapViewOfSection` to map physical memory into a user process without proper validation.  
- With physical memory read/write primitives, the author resolves kernel export addresses by parsing the `ntoskrnl.exe` export table in memory.  
- The exploit then “hijacks” a legitimate syscall (`NtShutdownSystem`) by temporarily patching its kernel entry point with a small absolute jump stub to redirect execution to arbitrary kernel exports (e.g., `PsGetCurrentProcess`, `ExAllocatePoolWithTag`, `DbgPrint`).  
- User-mode invocation of `NtShutdownSystem` becomes a controlled gate into ring 0, after which the original bytes are restored to reduce crash risk.  
- The end result shown is arbitrary kernel code execution and privilege escalation via token stealing (swapping the current process token with SYSTEM PID 4).  
- It’s primarily useful for kernel exploit developers and red teamers researching BYOVD-style primitives and syscall-gating techniques, and it highlights how unsafe section mapping can become a full kernel compromise.

Technical Focus:
- Vulnerable driver IOCTL analysis and dispatcher tracing
- `ZwMapViewOfSection` / `ZwUnmapViewOfSection` misuse for physical memory mapping
- Kernel base discovery and `ntoskrnl` export table parsing (PE export directory)
- Syscall entry-point patching (inline hook / jump stub) to redirect execution
- Ring0 privilege escalation via token stealing / SYSTEM impersonation

Use Cases:
- Turning a physical-memory mapping bug into arbitrary kernel R/W and LPE
- Rapid prototyping of “syscall as a gate” techniques to invoke kernel exports
- Driver reverse engineering to identify dangerous IOCTL handlers
- Building/validating kernel exploitation primitives for red team tradecraft
- Developing detections around syscall patching and suspicious section mappings

Keywords:
Windows kernel exploitation, ZwMapViewOfSection, ZwUnmapViewOfSection, NtShutdownSystem, syscall hijacking, inline hook, jump stub, ntoskrnl.exe, kernel exports, PE export parsing, kernel base address, IOCTL, vulnerable driver, physical memory mapping, arbitrary kernel read/write, ring 0, token stealing, PsGetCurrentProcess, ExAllocatePoolWithTag, DbgPrint