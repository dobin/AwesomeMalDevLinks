# https://csacyber.com/blog/exploiting-microsoft-kernel-applocker-driver-cve-2024-38041

<!DOCTYPE html><html lang="en">
  <body><div class="cky-hide cky-overlay"></div><div class="cky-btn-revisit-wrapper cky-revisit-hide cky-revisit-bottom-left" data-cky-tag="revisit-consent" data-tooltip="Consent Preferences" style="background-color: #0056a7;"><button aria-label="Consent Preferences" class="cky-btn-revisit" aria-controls="ckyPreferenceCenter" aria-haspopup="dialog"><img alt="Revisit consent button" src="https://cdn-cookieyes.com/assets/images/revisit.svg"></button></div><div class="cky-consent-container cky-box-bottom-left" tabindex="-1" aria-label="We value your privacy" role="region"><div class="cky-consent-bar" data-cky-tag="notice" style="border-color: #f4f4f4; background-color: #FFFFFF;"><div class="cky-notice"><p class="cky-title" aria-level="2" data-cky-tag="title" role="heading" style="color: #212121;">We value your privacy</p><div class="cky-notice-group"><div class="cky-notice-des" data-cky-tag="description" style="color: #212121;"><p>We use cookies to enhance your browsing experience, serve personalised ads or content, and analyse our traffic. By clicking "Accept All", you consent to our use of cookies.</p></div><div class="cky-notice-btn-wrapper" data-cky-tag="notice-buttons"><button class="cky-btn cky-btn-customize" aria-label="Customise" aria-haspopup="dialog" aria-controls="ckyPreferenceCenter" data-cky-tag="settings-button" style="color: #1863dc; border-color: #1863dc; background-color: transparent;">Customise</button> <button class="cky-btn cky-btn-reject" aria-label="Reject All" data-cky-tag="reject-button" style="color: #1863dc; border-color: #1863dc; background-color: transparent;">Reject All</button> <button class="cky-btn cky-btn-accept" aria-label="Accept All" data-cky-tag="accept-button" style="color: #FFFFFF; border-color: #1863dc; background-color: #1863dc;">Accept All</button> </div></div></div></div></div><div class="cky-modal" tabindex="-1"><div class="cky-preference-center" data-cky-tag="detail" aria-label="Customise Consent Preferences" aria-modal="true" id="ckyPreferenceCenter" role="dialog" style="color: #212121; border-color: #F4F4F4; background-color: #FFFFFF;"><div class="cky-preference-header"><span class="cky-preference-title" aria-level="2" data-cky-tag="detail-title" role="heading" style="color: #212121;">Customise Consent Preferences</span> <button aria-label="Close" class="cky-btn-close" data-cky-tag="detail-close"><img alt="" src="https://cdn-cookieyes.com/assets/images/close.svg" width="10" height="10"></button></div><div class="cky-preference-body-wrapper"><div class="cky-preference-content-wrapper" data-cky-tag="detail-description" style="color: #212121;"><p>We use cookies to help you navigate efficiently and perform certain functions. You will find detailed information about all cookies under each consent category below.</p><p>The cookies that are categorised as "Necessary" are stored on your browser as they are essential for enabling the basic functionalities of the site. ...&nbsp;<button class="cky-show-desc-btn" data-cky-tag="show-desc-button" aria-label="Show more">Show more</button></p></div><div class="cky-horizontal-separator"></div><div class="cky-accordion-wrapper" data-cky-tag="detail-categories"><div class="cky-accordion" id="ckyDetailCategorynecessary"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategorynecessaryBody" aria-label="Necessary" data-cky-tag="detail-category-title" style="color: #212121;">Necessary</button><span class="cky-always-active" data-cky-tag="always-active">Always Active</span></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Necessary cookies are required to enable the basic features of this site, such as providing secure log-in or adjusting your consent preferences. These cookies do not store any personally identifiable data.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategorynecessaryBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #ebebeb; background-color: #f4f4f4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__cf_bm</div></li><li><div>Duration</div><div>1 hour</div></li><li><div>Description</div><div>This cookie, set by Cloudflare, is used to support Cloudflare Bot Management. </div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_cfuvid</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>Calendly sets this cookie to track users across sessions to optimize user experience by maintaining session consistency and providing personalized services</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hssrc</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>This cookie is set by Hubspot whenever it changes the session cookie. The __hssrc cookie set to 1 indicates that the user has restarted the browser, and if the cookie does not exist, it is assumed to be a new session.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hssc</div></li><li><div>Duration</div><div>1 hour</div></li><li><div>Description</div><div>HubSpot sets this cookie to keep track of sessions and to determine if HubSpot should increment the session number and timestamps in the __hstc cookie.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_GRECAPTCHA</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>Google Recaptcha service sets this cookie to identify bots to protect the website against malicious spam attacks.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>rc::a</div></li><li><div>Duration</div><div>Never Expires</div></li><li><div>Description</div><div>This cookie is set by the Google recaptcha service to identify bots to protect the website against malicious spam attacks.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>rc::f</div></li><li><div>Duration</div><div>Never Expires</div></li><li><div>Description</div><div>This cookie is set by the Google recaptcha service to identify bots to protect the website against malicious spam attacks.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>rc::c</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>This cookie is set by the Google recaptcha service to identify bots to protect the website against malicious spam attacks.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>rc::b</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>This cookie is set by the Google recaptcha service to identify bots to protect the website against malicious spam attacks.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>cookieyes-consent</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>CookieYes sets this cookie to remember users' consent preferences so that their preferences are respected on subsequent visits to this site. It does not collect or store any personal information about the site visitors.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryfunctional"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryfunctionalBody" aria-label="Functional" data-cky-tag="detail-category-title" style="color: #212121;">Functional</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchfunctional" aria-label="Enable Functional" autocomplete="off" style="background-color: rgb(208, 213, 210);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Functional cookies help perform certain functionalities like sharing the content of the website on social media platforms, collecting feedback, and other third-party features.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryfunctionalBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #ebebeb; background-color: #f4f4f4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>yt-remote-device-id</div></li><li><div>Duration</div><div>Never Expires</div></li><li><div>Description</div><div>YouTube sets this cookie to store the user's video preferences using embedded YouTube videos.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>ytidb::LAST_RESULT_ENTRY_KEY</div></li><li><div>Duration</div><div>Never Expires</div></li><li><div>Description</div><div>The cookie ytidb::LAST_RESULT_ENTRY_KEY is used by YouTube to store the last search result entry that was clicked by the user. This information is used to improve the user experience by providing more relevant search results in the future.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>yt-remote-connected-devices</div></li><li><div>Duration</div><div>Never Expires</div></li><li><div>Description</div><div>YouTube sets this cookie to store the user's video preferences using embedded YouTube videos.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>yt-remote-cast-installed</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>The yt-remote-cast-installed cookie is used to store the user's video player preferences using embedded YouTube video.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>yt-remote-session-app</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>The yt-remote-session-app cookie is used by YouTube to store user preferences and information about the interface of the embedded YouTube video player.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>yt-remote-session-name</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>The yt-remote-session-name cookie is used by YouTube to store the user's video player preferences using embedded YouTube video.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>yt-remote-fast-check-period</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>The yt-remote-fast-check-period cookie is used by YouTube to store the user's video player preferences for embedded YouTube videos.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryanalytics"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryanalyticsBody" aria-label="Analytics" data-cky-tag="detail-category-title" style="color: #212121;">Analytics</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchanalytics" aria-label="Enable Analytics" autocomplete="off" style="background-color: rgb(208, 213, 210);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Analytical cookies are used to understand how visitors interact with the website. These cookies help provide information on metrics such as the number of visitors, bounce rate, traffic source, etc.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryanalyticsBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #ebebeb; background-color: #f4f4f4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hstc</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>Hubspot set this main cookie for tracking visitors. It contains the domain, initial timestamp (first visit), last timestamp (last visit), current timestamp (this visit), and session number (increments for each subsequent session).</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>hubspotutk</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>HubSpot sets this cookie to keep track of the visitors to the website. This cookie is passed to HubSpot on form submission and used when deduplicating contacts.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_ga</div></li><li><div>Duration</div><div>1 year 1 month 4 days</div></li><li><div>Description</div><div>Google Analytics sets this cookie to calculate visitor, session and campaign data and track site usage for the site's analytics report. The cookie stores information anonymously and assigns a randomly generated number to recognise unique visitors.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_ga_*</div></li><li><div>Duration</div><div>1 year 1 month 4 days</div></li><li><div>Description</div><div>Google Analytics sets this cookie to store and count page views.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryperformance"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryperformanceBody" aria-label="Performance" data-cky-tag="detail-category-title" style="color: #212121;">Performance</button></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Performance cookies are used to understand and analyse the key performance indexes of the website which helps in delivering a better user experience for the visitors.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryperformanceBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #ebebeb; background-color: #f4f4f4;"><p class="cky-empty-cookies-text">No cookies to display.</p></div></div></div><div class="cky-accordion" id="ckyDetailCategoryadvertisement"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryadvertisementBody" aria-label="Advertisement" data-cky-tag="detail-category-title" style="color: #212121;">Advertisement</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchadvertisement" aria-label="Enable Advertisement" autocomplete="off" style="background-color: rgb(208, 213, 210);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Advertisement cookies are used to provide visitors with customised advertisements based on the pages you visited previously and to analyse the effectiveness of the ad campaigns.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryadvertisementBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #ebebeb; background-color: #f4f4f4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>YSC</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>Youtube sets this cookie to track the views of embedded videos on Youtube pages.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>VISITOR_INFO1_LIVE</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>YouTube sets this cookie to measure bandwidth, determining whether the user gets the new or old player interface.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>VISITOR_PRIVACY_METADATA</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>YouTube sets this cookie to store the user's cookie consent state for the current domain.	</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>yt.innertube::requests</div></li><li><div>Duration</div><div>Never Expires</div></li><li><div>Description</div><div>YouTube sets this cookie to register a unique ID to store data on what videos from YouTube the user has seen.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>yt.innertube::nextId</div></li><li><div>Duration</div><div>Never Expires</div></li><li><div>Description</div><div>YouTube sets this cookie to register a unique ID to store data on what videos from YouTube the user has seen.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryother"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryotherBody" aria-label="Uncategorised" data-cky-tag="detail-category-title" style="color: #212121;">Uncategorised</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchother" aria-label="Enable Uncategorised" autocomplete="off" style="background-color: rgb(208, 213, 210);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Other uncategorised cookies are those that are being analysed and have not been classified into a category as yet.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryotherBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #ebebeb; background-color: #f4f4f4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__Secure-ROLLOUT_TOKEN</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>Description is currently not available.</div></li></ul></div></div></div></div></div><div class="cky-footer-wrapper"><span class="cky-footer-shadow" style="background: linear-gradient(180deg, rgba(255, 255, 255, 0) 0%, #FFFFFF 100%);"></span><div class="cky-prefrence-btn-wrapper" data-cky-tag="detail-buttons"><button aria-label="Reject All" class="cky-btn cky-btn-reject" data-cky-tag="detail-reject-button" style="color: #1863dc; border-color: #1863dc; background-color: transparent;">Reject All</button> <button aria-label="Save My Preferences" class="cky-btn cky-btn-preferences" data-cky-tag="detail-save-button" style="color: #1863dc; border-color: #1863dc; background-color: transparent;">Save My Preferences</button> <button aria-label="Accept All" class="cky-btn cky-btn-accept" data-cky-tag="detail-accept-button" style="color: #ffffff; border-color: #1863dc; background-color: #1863dc;">Accept All</button></div><div data-cky-tag="detail-powered-by" style="padding: 8px 24px; font-size: 12px; font-weight: 400; line-height: 20px; text-align: right; border-radius: 0 0 6px 6px; direction: ltr; display: flex; justify-content: flex-end; align-items: center; color: #293C5B; background-color: #EDEDED;">Powered by <a href="https://www.cookieyes.com/product/cookie-consent/?ref=cypbcyb&amp;utm_source=cookie-banner&amp;utm_medium=powered-by-cookieyes" rel="noopener" style="margin-left:5px;line-height:0" target="_blank"><img alt="Cookieyes logo" src="https://cdn-cookieyes.com/assets/images/poweredbtcky.svg" style="width:78px;height:13px;margin:0" width="78" height="13"></a></div></div></div></div>
    <div class="body-wrapper   hs-content-id-193014607084 hs-blog-post hs-blog-id-109482809288">
      
        <div data-global-resource-path="Krazy copy/templates/partials/header.html"></div>
      

      

<main id="main-content" class="body-container-wrapper">
  <div class="body-container body-container--blog-post">

    
    <div id="hs_cos_wrapper_kz_blog_post_hero" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">


<section class="kz-blog-post-hero-case-study">
  <div class="content-wrapper">
    <div class="max-width-950 mr-auto ml-auto text-left">

      
      <div class="list-meta mb-20">
        
        <div class="list-meta-date font-weight-500 font-size-16">
          <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="20" height="20" aria-hidden="true"><g id="Calendar4_layer"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></g></svg>
          September 16, 2024
        </div>
        

        <div class="list-meta-read-min font-weight-500 font-size-16">
          <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" aria-hidden="true"><g id="Clock5_layer"><path d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></g></svg>
          6 min read time
        </div>

      </div>
      

      
      <div class="heading-text">
        <h1 class="heading-type heading-color font-size-">
          <span id="hs_cos_wrapper_name" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="text">Exploiting Microsoft Kernel Applocker Driver (CVE-2024-38041)</span>
        </h1>
      </div>
      

      

      
      <div class="list-meta mt-20 mb-20">
        
        
        <div class="meta-blog-author mb-20">
          <img src="https://app.hubspot.com/settings/avatar/d41d8cd98f00b204e9800998ecf8427e" alt="Erwin Krazek" width="48" height="48">
          <a href="https://csacyber.com/blog/author/erwin-krazek" rel="author">
            Erwin Krazek
          </a>
        </div>
        
         

        
        
        <div class="list-meta-item">
          
          <li class="list-inline-item">
            <a class="button px-10 py-5 font-size-16" href="https://csacyber.com/blog/tag/penetration-testing">Penetration Testing</a>
          </li>
          
        </div>
         
        

      </div>
      

      
      <img src="https://csacyber.com/hubfs/kernelapp.png" class="featured-image" alt="">
      

    </div>

  </div>
</section>

</div> 

    
    <div class="content-wrapper">
      <article class="blog-post">
        
        <div class="blog-post__body">
          <span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><h3>Overview</h3>
<p>In recent July Patch Tuesday Microsoft patched a vulnerability in the Microsoft Kernel driver appid.sys, which is the central driver behind<span>&nbsp;</span><a href="https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/applocker-overview">AppLocker</a>, the application whitelisting technology built into Windows. The vulnerability,<span>&nbsp;</span><a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2024-38041">CVE-2024-38041</a>, allows a local attacker to retrieve information that could lead to a Kernel Address Space Layout Randomization (KASLR) bypass which might become a requirement in future releases of windows.</p>
<!--more--><p>This blog post details my process of patch diffing in the Windows kernel, analysing N-day vulnerability, finding the bug, and building a working exploit. This post doesn’t require any specialized Windows kernel knowledge to follow along, though a basic understanding of<span>&nbsp;</span><a href="https://en.wikipedia.org/wiki/Memory_leak">memory disclosure bugs</a><span>&nbsp;</span>and operating system concepts is helpful. I’ll also cover the basics of patch diffing.</p>
<h3>Basics of Patch Diffing</h3>
<p>Patch diffing is a common technique of comparing two binary builds of the same code – a known-vulnerable one and one containing a security fix. It is often used to determine the technical details behind ambiguously-worded bulletins, and to establish the root causes, attack vectors and potential variants of the vulnerabilities in question. The approach has attracted plenty of research and tooling development over the years, and has been shown to be useful for identifying so-called N-day bugs, which can be exploited against users who are slow to adopt latest security patches. Overall, the risk of post-patch vulnerability exploitation is inevitable for software which can be freely reverse-engineered, and is thus accepted as a natural part of the ecosystem.</p>
<p>In a similar vein, binary diffing can be utilized to discover discrepancies between two or more versions of a single product, if they share the same core code and coexist on the market, but are serviced independently by the vendor. One example of such software is the Windows operating system.</p>
<h3>KASLR in Windows 11 24H2</h3>
<p>In previous Windows versions defeating KASLR has been trivial due to a number of syscalls including kernel pointers in their output. In Windows 11 24H2 however, as documented by Yarden Shafir in a<span>&nbsp;</span><a href="https://windows-internals.com/kaslr-leaks-restriction/">blog post</a><span>&nbsp;</span>analysing the change, these kernel address leaks are no longer available to unprivileged callers.</p>
<p>In the absence of the classic KASLR bypasses, in order to determine the layout of the kernel an info leak or new technique is required.</p>
<h3>Patch Diff (Appid.sys)</h3>
<p>In order to identify the specific cause of the vulnerability, we’ll compare the patched binary to the pre-patch binary and try to extract the difference using a tool called<span>&nbsp;</span><a href="https://www.zynamics.com/bindiff.html">BinDiff</a>. I had already saved both binary versions on my computer, as I like to keep track of Patch Tuesday updates. Additionally, I had written a simple Python script to dump all drivers before applying monthly patches, and then doing the dump of the patched binaries afterward. However, we can use<span>&nbsp;</span><a href="https://winbindex.m417z.com/">Winbindex</a><span>&nbsp;</span>to obtain two versions of appid.sys: one right before the patch and one right after, both for the same version of Windows.</p>
<p align="center"><img src="https://csa.limited/assets/img/appid1.png" width="800" loading="lazy" height="1070"></p>
<p>Getting sequential versions of the binaries is important, as even using versions a few updates apart can introduce noise from differences that are not related to the patch, and cause you to waste time while doing your analysis. Winbindex has made patch analysis easier than ever, as you can obtain any Windows binary beginning from Windows 10. I loaded both of the files in<span>&nbsp;</span><a href="https://hex-rays.com/">IDA Decompiler</a><span>&nbsp;</span>and ran the analysis. Afterward, the files can be exported into a BinExport format using the extension BinExport then being loaded into BinDiff tool.</p>
<p align="center"><img src="https://csa.limited/assets/img/newdiff.png" width="800" loading="lazy" height="243"></p>
<p align="center">Creating a new diff</p>
<p align="center"><img src="https://csa.limited/assets/img/bindiffsummary.png" width="800" loading="lazy" height="479"></p>
<p align="center">BinDiff summary comparing the pre and post-patch binaries</p>
<p>BinDiff works by matching functions in the binaries being compared using various algorithms. In this case there, we have applied function symbol information from Microsoft, so all the functions can be matched by name.</p>
<p align="center"><img src="https://csa.limited/assets/img/matchedfunctions.png" width="800" loading="lazy" height="842"></p>
<p align="center">List of matched functions sorted by similarity</p>
<p>Above we see there is only one function that have a similarity less than 100%. The function that was changed by the patch is AipDeviceIoControlDispatch.</p>
<p align="center"><img src="https://csa.limited/assets/img/newchecks.png" width="800" loading="lazy" height="917"></p>
<p align="center">New checks introduced</p>
<p>In the above image we can see the two highlighted in red blocks that have been added in the patched version of the driver. This code checks the<span>&nbsp;</span><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/previousmode">PreviousMode</a><span>&nbsp;</span>of the incoming IOCTL packet in order to verify that the packet is coming from a kernel-mode rather then user-mode.</p>
<h3>Root cause analysis</h3>
<p>The screenshots below shows the changed code pre and post-patch when looking at the decompiled function code of AipDeviceIoControlDispatch in IDA.</p>
<p align="center"><img src="https://csa.limited/assets/img/prepatch.png" width="800" loading="lazy" height="244"></p>
<p align="center">Pre-patch version of appid.sys Windows 11 22H2</p>
<p align="center"><img src="https://csa.limited/assets/img/postpatch.png" width="800" loading="lazy" height="244"></p>
<p align="center">Post-patch version of appid.sys Windows 11 22H2</p>
<p>This change shown above is the only update to the identified function. Some quick analysis showed that a check is being performed based on PreviousMode. If PreviousMode is zero (indicating that the call originates from the kernel) pointers are written to the output buffer specified in the SystemBuffer field. If, on the other hand, PreviousMode is not zero and Feature_2619781439... is enabled then the driver will simply return STATUS_INVALID_DEVICE_REQUEST (0xC0000010) error code.</p>
<h3>Exploitation</h3>
<p>The first step is to communicate with the driver to trigger its vulnerability. To communicate with the driver, you typically need to find the Device Name, obtain a handle, and then send the appropriate<span>&nbsp;</span><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/introduction-to-i-o-control-codes">IOCTL</a><span>&nbsp;</span>code to reach the vulnerability.</p>
<p>For this purpose, the IoCreateDevice function was analyzed in the DriverEntry function and the third argument of DeviceName is found to be \\Device\\AppID.</p>
<p align="center"><img src="https://csa.limited/assets/img/codesnipexploit.png" width="400" loading="lazy" height="1024"></p>
<p><a href="https://www.osronline.com/article.cfm%5earticle=229.htm">Decoding</a><span>&nbsp;</span>the 0x22A014 control code and extracting the RequiredAccess field reveals that a handle with write access is required to call it. Inspecting the device’s ACL (Access Control List; see the screenshot below), there are entries for local service, administrators, and appidsvc. While the entry for administrators does not grant write access, the entry for local service does.</p>
<p align="center"><img src="https://csa.limited/assets/img/symlink.png" width="800" loading="lazy" height="524"></p>
<p>As the<span>&nbsp;</span><a href="https://learn.microsoft.com/en-us/windows/win32/services/localservice-account">local service</a><span>&nbsp;</span>account has reduced privileges compared to administrators, this also gives the vulnerability a somewhat higher impact than standard admin-to-kernel. This might be the reason Microsoft characterized the CVE as Privileges Required: Low, taking into account that local service processes do not always necessarily have to run at higher integrity levels.</p>
<p>Given the fact that I already have wrote an<span>&nbsp;</span><a href="https://github.com/Nero22k/Exploits/tree/main/Windows/CVE-2024-21338">exploit</a><span>&nbsp;</span>for CVE-2024-21338 which is the same driver that we analyse so I will only provide the modified version of the code<span>&nbsp;</span><a href="https://github.com/Nero22k/Exploits/tree/main/Windows/CVE-2024-38041">here</a>.</p>
<p align="center"><img src="https://csa.limited/assets/img/sucess.png" width="800" loading="lazy" height="515"></p>
<p align="center">Successful Exploitation</p>
<h3>Summary</h3>
<p>In this blog post we've covered patch diffing, root cause analysis and process of exploiting the vulnerability. It's important to monitor for new code additions as sometimes it can be fruitful for finding vulnerabilities.</p>
<p>Despite best efforts by Microsoft trying to follow secure coding practices, there are always things that gets often overlooked during code reviews which create vulnerabilities that attackers often are trying to exploit.</p>
<h3>Bibliography</h3>
<p><a href="https://www.blackhat.com/presentations/bh-usa-09/OH/BHUSA09-Oh-DiffingBinaries-SLIDES.pdf">[1] – Diffing Binaries vs Anti-Diffing</a></p>
<p><a href="https://www.cisoplatform.com/profiles/blogs/bruh-do-you-even-diff-diffing-microsoft-patches-to-find-vulnerabi">[2] – Do you even Diff?</a></p>
<p><a href="https://windows-internals.com/kaslr-leaks-restriction/">[3] – KASLR Restrictions</a></p>
<p><a href="https://googleprojectzero.blogspot.com/2017/10/using-binary-diffing-to-discover.html">[4] – Using Binary Diffing To Discover</a></p>
<p><a href="https://securityintelligence.com/x-force/patch-tuesday-exploit-wednesday-pwning-windows-ancillary-function-driver-winsock/">[5] – Patch Tuesday Exploit Wednesday</a></p></span>
        </div>
      </article>

      
    </div>
    
  
    
    <div id="hs_cos_wrapper_kz_related_blog_items" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">

<section class="kz-related-post ">
  <div class="content-wrapper">
    
    
    <div class="header_flex mb-0">
      <div class="header_flex-col">
        
          <div class="tagline-wrap mb-5">
            <div class="tagline secondary-color">Related Posts</div>
            
          </div>
        
        
          <div class="heading-text">
            <h2>
            <span class="heading-type heading-color font-size-">
              You may also like this
            </span>
          </h2></div>
        
        
      </div>
      
      
      <div class="header_flex-col">
        
        
        <a class="button" href="https://csacyber.com/blog">
          Similar Articles
        </a>
      </div>
      
    </div>

    
    
     
    

    
    

    
    
    
      
      
        
          
          
        
      
        
          
          
        
      
        
          
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
    
    <div class="flex">
      
      <article class="col" aria-label="Blog post summary: Preparing for the quantum shift: Why post-quantum readiness cannot wait">
        <div class="blog-card text-left">
          
          
          <div class="blog-card-featured-image text-center">
            <a href="https://csacyber.com/blog/preparing-for-the-quantum-shift-why-post-quantum-readiness-cannot-wait">
              <img class="featured-image" src="https://csacyber.com/hs-fs/hubfs/social-engineering.jpg?width=624&amp;height=427&amp;name=social-engineering.jpg" loading="lazy" alt="" width="624" height="427">
            </a>
          </div>
          

          <div class="blog-card-body pt-20">
            <div class="list-meta mb-20">
              
              <div class="list-meta-date font-weight-500 font-size-16">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="20" height="20" aria-hidden="true"><g id="Calendar6_layer"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></g></svg>
                February 6, 2026
              </div>
              
              <div class="list-meta-read-min font-weight-500 font-size-16">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" aria-hidden="true"><g id="Clock7_layer"><path d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></g></svg>
                4 min read
              </div>
            </div>

            <div class="blog-post-name mb-20">
              <h3 class="mb-0"><a href="https://csacyber.com/blog/preparing-for-the-quantum-shift-why-post-quantum-readiness-cannot-wait">Preparing for the quantum shift: Why post-quantum readiness cannot wait</a></h3>
            </div>

            <div class="blog-card-text">
              The debate around quantum risk is gathering momentum, and rightly so. Research such as Mastercard’s...
            </div>

            <div class="list-meta mt-20">
              
              <div class="list-meta-author font-size-16">
                <a href="https://csacyber.com/blog/author/david-woodfine">
                  
                    <img src="https://app.hubspot.com/settings/avatar/d41d8cd98f00b204e9800998ecf8427e" alt="David Woodfine" width="40" height="40" style="border-radius:50%; margin-right:10px;">
                  
                  David Woodfine
                </a>
              </div>
              
            </div>

            
          </div>
        </div>
      </article>
      
      <article class="col" aria-label="Blog post summary: CVE-2026-21509 Analysis: The ghost in the document">
        <div class="blog-card text-left">
          
          
          <div class="blog-card-featured-image text-center">
            <a href="https://csacyber.com/blog/cve-2026-21509-analysis-the-ghost-in-the-document">
              <img class="featured-image" src="https://csacyber.com/hs-fs/hubfs/blog-banner-logo.png?width=624&amp;height=427&amp;name=blog-banner-logo.png" loading="lazy" alt="" width="624" height="427">
            </a>
          </div>
          

          <div class="blog-card-body pt-20">
            <div class="list-meta mb-20">
              
              <div class="list-meta-date font-weight-500 font-size-16">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="20" height="20" aria-hidden="true"><g id="Calendar8_layer"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></g></svg>
                February 2, 2026
              </div>
              
              <div class="list-meta-read-min font-weight-500 font-size-16">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" aria-hidden="true"><g id="Clock9_layer"><path d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></g></svg>
                11 min read
              </div>
            </div>

            <div class="blog-post-name mb-20">
              <h3 class="mb-0"><a href="https://csacyber.com/blog/cve-2026-21509-analysis-the-ghost-in-the-document">CVE-2026-21509 Analysis: The ghost in the document</a></h3>
            </div>

            <div class="blog-card-text">
              In January 2026, Microsoft confirmed active exploitation of a high-severity zero-day,...
            </div>

            <div class="list-meta mt-20">
              
              <div class="list-meta-author font-size-16">
                <a href="https://csacyber.com/blog/author/steve-velcev">
                  
                    <img src="https://app.hubspot.com/settings/avatar/d41d8cd98f00b204e9800998ecf8427e" alt="Steve Velcev" width="40" height="40" style="border-radius:50%; margin-right:10px;">
                  
                  Steve Velcev
                </a>
              </div>
              
            </div>

            
          </div>
        </div>
      </article>
      
      <article class="col" aria-label="Blog post summary: Cyber Security and Resilience Bill: What it means for UK businesses">
        <div class="blog-card text-left">
          
          
          <div class="blog-card-featured-image text-center">
            <a href="https://csacyber.com/blog/cyber-security-and-resilience-bill-what-it-means">
              <img class="featured-image" src="https://csacyber.com/hs-fs/hubfs/CSR-bill.jpg?width=624&amp;height=427&amp;name=CSR-bill.jpg" loading="lazy" alt="" width="624" height="427">
            </a>
          </div>
          

          <div class="blog-card-body pt-20">
            <div class="list-meta mb-20">
              
              <div class="list-meta-date font-weight-500 font-size-16">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="20" height="20" aria-hidden="true"><g id="Calendar10_layer"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></g></svg>
                January 5, 2026
              </div>
              
              <div class="list-meta-read-min font-weight-500 font-size-16">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" aria-hidden="true"><g id="Clock11_layer"><path d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></g></svg>
                6 min read
              </div>
            </div>

            <div class="blog-post-name mb-20">
              <h3 class="mb-0"><a href="https://csacyber.com/blog/cyber-security-and-resilience-bill-what-it-means">Cyber Security and Resilience Bill: What it means for UK businesses</a></h3>
            </div>

            <div class="blog-card-text">
              On 12 November 2025, the Government introduced the Cyber Security and Resilience (Network and...
            </div>

            <div class="list-meta mt-20">
              
              <div class="list-meta-author font-size-16">
                <a href="https://csacyber.com/blog/author/csa-cyber">
                  
                    <img src="https://csacyber.com/hs-fs/hubfs/CSA%20Cyber%20Logo%20FNL_Stacked.png?width=40&amp;height=40&amp;name=CSA%20Cyber%20Logo%20FNL_Stacked.png" alt="CSA Cyber" width="40" height="40" style="border-radius:50%; margin-right:10px;">
                  
                  CSA Cyber
                </a>
              </div>
              
            </div>

            
          </div>
        </div>
      </article>
      
    </div>
    

  </div>
</section></div>

              </div>
              </main>


      
        <div data-global-resource-path="@marketplace/Juice_Tactics_Snacks/Krazy/templates/partials/footer.html"></div> 
      
    </div>
    
    
    
    
    
    
<!-- HubSpot performance collection script -->











<!-- Start of Web Interactives Embed Code -->

<!-- End of Web Interactives Embed Code -->





<!-- Start of HubSpot Analytics Code -->



<!-- End of HubSpot Analytics Code -->









<div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; width: 0px; height: 0px;"><div></div></div></div>
   
 


  
<div scrolling="no" frameborder="0" allowtransparency="true" src="https://platform.twitter.com/widgets/widget_iframe.2f70fb173b9000da126c79afe2098f02.html?origin=https%3A%2F%2Fcsacyber.com" title="Twitter settings iframe" style="display: none;" data-original-tag="iframe">
<title>Twitter Widget Iframe</title>



</div><div id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;" title="Twitter analytics iframe" data-original-tag="iframe"></div><div owner="archetype" title="archetype" style="display: none; visibility: hidden;" data-original-tag="iframe"></div></body></html>