Title:
Driver Reverse Engineering 101 – Part I: Static Analysis

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post is an introductory methodology for reverse engineering Windows WDM (legacy) kernel drivers, focusing on IOCTL-based communication patterns.  
- It explains the common WDM driver skeleton (DriverEntry, device object + symbolic link creation, dispatch routine registration) and why the IRP_MJ_DEVICE_CONTROL handler is typically the main target for analysis.  
- The author walks through practical static analysis in IDA on real Windows drivers (e.g., afd.sys and mountmgr.sys) without relying on symbols, showing how to locate the IOCTL handler from DriverEntry and interpret dispatch tables.  
- A key technique is correctly selecting IRP/_IO_STACK_LOCATION union members in IDA (e.g., IoControlCode, SystemBuffer, Type3InputBuffer, UserBuffer, MdlAddress) based on the IOCTL transfer method.  
- It highlights common IOCTL handler structures (switch statements vs function-table indexing with whitelists) and how to map IOCTL codes using CTL_CODE/decoders.  
- Useful for red teamers, vulnerability researchers, and malware analysts who need to quickly triage drivers for attack surface (e.g., BYOVD hunting) and understand usermode↔kernelmode interfaces.

Technical Focus:
- Windows WDM driver architecture (DriverEntry, dispatch routines, unload)
- IOCTL encoding/decoding (CTL_CODE, function codes, methods, access)
- IRP and IO_STACK_LOCATION union interpretation in IDA
- Static analysis workflow for drivers without symbols (IDA decompiler, typing, renaming)
- IOCTL handler patterns (switch vs function pointer table/whitelist)
- Intro to kernel debugging setup for dynamic follow-up (WinDbg, remote KD)

Use Cases:
- Identify device names/symbolic links to open driver handles from usermode
- Locate and enumerate IOCTL handlers and reachable functionality in a driver
- Map IOCTL codes to buffer passing semantics to understand input/output surfaces
- Triage drivers found via fuzzing to pinpoint the responsible IOCTL path
- Build a quick reversing workflow applicable to unknown/signed third-party drivers

Keywords:
Windows Driver Model, WDM, kernel driver, IOCTL, IRP, IO_STACK_LOCATION, IRP_MJ_DEVICE_CONTROL, CTL_CODE, METHOD_BUFFERED, METHOD_NEITHER, MDL, SystemBuffer, Type3InputBuffer, UserBuffer, IoCreateDevice, IoCreateSymbolicLink, DeviceIoControl, IDA Pro, WinDbg, BYOVD