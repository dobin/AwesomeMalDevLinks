Title:
Exploiting AMD atdcm64a.sys arbitrary pointer dereference – Part 1

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post walks through reversing an old AMD Windows kernel driver (atdcm64a.sys from Radeon Adrenalin 18.12.1.1) to identify exploitable IOCTL handlers.  
- It focuses on practical methodology in IDA Pro: finding the device symbolic link, mapping IRP major functions, fixing union types in IRP/IO_STACK_LOCATION, and decoding IOCTLs (METHOD_BUFFERED).  
- The author identifies two key issues reachable from user mode via IOCTL 0x22E084: an arbitrary MSR read (user-controlled __readmsr index and output returned to SystemBuffer) and an arbitrary pointer dereference leading to control of a kernel call target.  
- The pointer dereference arises from passing a user-controlled PDEVICE_OBJECT into IoGetAttachedDeviceReference and then into IofCallDriver, which ultimately dispatches through DeviceObject->DriverObject->MajorFunction[MajorFunction].  
- It also notes a tempting “arbitrary increment” via ObpIncrPointerCount, but explains it is likely neutralized by a later ObfDereferenceObject decrement.  
- Useful for kernel exploit devs and red teamers hunting non-blacklisted vulnerable drivers for LPE and potential EDR bypass chains; Part 2/3 cover confirmation and exploitation.

Technical Focus:
- Windows kernel driver reversing (IDA Pro pseudocode + disassembly synchronization)
- IOCTL discovery/decoding and IRP/IO_STACK_LOCATION union correction (METHOD_BUFFERED/SystemBuffer)
- Arbitrary MSR read primitive via rdmsr/__readmsr
- Arbitrary pointer dereference / control-flow redirection via IofCallDriver dispatch
- Kernel debugging setup (WinDbg NET KD, bcdedit dbgsettings)
- Driver loading for testing (OSRLoader)

Use Cases:
- Identify and triage vulnerable third-party Windows drivers for LPE
- Build a proof-of-concept to trigger IOCTL-based kernel primitives (MSR read, pointer deref)
- Develop exploit chains leveraging driver dispatch table control (MajorFunction hijack)
- Reproduce and debug kernel crashes/primitives in a Windows 11 VM with network KD
- Support red team “bring-your-own-vulnerable-driver” assessments where applicable

Keywords:
Windows kernel, atdcm64a.sys, AMD Radeon Adrenalin 18.12.1.1, IOCTL 0x22E084, IRP_MJ_DEVICE_CONTROL, METHOD_BUFFERED, Irp->AssociatedIrp.SystemBuffer, IDA Pro, WinDbg, bcdedit /debug, OSRLoader, rdmsr, __readmsr, arbitrary MSR read, arbitrary pointer dereference, IoGetAttachedDeviceReference, IofCallDriver, DriverObject->MajorFunction, ObpIncrPointerCount, ObfDereferenceObject, local privilege escalation, BYOVD