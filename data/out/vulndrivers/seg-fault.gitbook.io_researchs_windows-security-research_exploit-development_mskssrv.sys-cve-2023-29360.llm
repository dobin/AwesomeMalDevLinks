Title:
mskssrv.sys CVE-2023-29360 – Logical Bug Leading to Windows Kernel LPE via MDL Mapping

Type:
Blog Post

Short Summary (4–8 sentences max):
- This write-up analyzes CVE-2023-29360 in the Windows `mskssrv.sys` driver, a logical flaw that enables local privilege escalation by abusing MDL creation and mapping.  
- The core issue is `FsAllocAndLockMdl` calling `MmProbeAndLockPages` with `KernelMode`, allowing an attacker to build an MDL for an arbitrary virtual address without user-mode validation.  
- The driver later maps the locked pages into the attacker process via `MmMapLockedPagesSpecifyCache`, yielding arbitrary kernel read/write primitives depending on the chosen mapping priority flags.  
- The post details how to reach the vulnerable IOCTL path by obtaining the correct device interface string (observed via `frameServer.dll` / WindowsCamera.exe) and satisfying driver state prerequisites (GlobalRendezvous, stream init/register).  
- With read/write primitives, the exploit escalates to SYSTEM by copying privilege bitfields in the current process `_TOKEN` from the SYSTEM token (offsets around 0x40/0x48/0x50).  
- Useful for exploit developers and red teamers researching Windows kernel LPE primitives and MDL-based arbitrary mapping patterns.

Technical Focus:
- Windows kernel MDL internals (`IoAllocateMdl`, `MmProbeAndLockPages`, `MmMapLockedPagesSpecifyCache`)
- AccessMode confusion (`KernelMode` vs `UserMode`) leading to missing address validation
- IOCTL-driven exploitation flow (PublishTx / ConsumeTx / DrainTx) and state gating (GlobalRendezvous, stream registration)
- Mapping priority flags (e.g., `MdlMappingNoWrite`, `MdlMappingNoExecute`, `NormalPagePriority`) to control RW vs RO mappings
- Token privilege escalation via `_TOKEN` privilege fields overwrite
- Device interface discovery via user-mode component reversing (`frameServer.dll`, `CreateFileW`)

Use Cases:
- Build a Windows 10 kernel LPE exploit using MDL mapping primitives
- Derive arbitrary kernel read/write from a driver that probes pages in `KernelMode`
- Study how multimedia/camera stack components expose kernel attack surface (`mskssrv.sys`, `frameServer.dll`)
- Develop detections/hardening guidance around suspicious MDL mapping behavior and unusual device interface access
- Reproduce/validate CVE-2023-29360 behavior in a lab for patch verification

Keywords:
CVE-2023-29360, mskssrv.sys, Windows 10, LPE, kernel exploit, logical bug, MDL, Memory Descriptor List, IoAllocateMdl, MmProbeAndLockPages, MmMapLockedPagesSpecifyCache, KernelMode, UserMode, IOCTL, DeviceIoControl, CreateFileW, frameServer.dll, _TOKEN, token privileges, arbitrary read/write