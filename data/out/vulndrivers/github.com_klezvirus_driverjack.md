# https://github.com/klezVirus/DriverJack

[Skip to content](https://github.com/klezVirus/DriverJack#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/klezVirus/DriverJack) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/klezVirus/DriverJack) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/klezVirus/DriverJack) to refresh your session.Dismiss alert

{{ message }}

[klezVirus](https://github.com/klezVirus)/ **[DriverJack](https://github.com/klezVirus/DriverJack)** Public

- [Notifications](https://github.com/login?return_to=%2FklezVirus%2FDriverJack) You must be signed in to change notification settings
- [Fork\\
57](https://github.com/login?return_to=%2FklezVirus%2FDriverJack)
- [Star\\
359](https://github.com/login?return_to=%2FklezVirus%2FDriverJack)


Hijacking valid driver services to load arbitrary (signed) drivers abusing native symbolic links and NT paths


### License

[MIT license](https://github.com/klezVirus/DriverJack/blob/master/LICENSE)

[359\\
stars](https://github.com/klezVirus/DriverJack/stargazers) [57\\
forks](https://github.com/klezVirus/DriverJack/forks) [Branches](https://github.com/klezVirus/DriverJack/branches) [Tags](https://github.com/klezVirus/DriverJack/tags) [Activity](https://github.com/klezVirus/DriverJack/activity)

[Star](https://github.com/login?return_to=%2FklezVirus%2FDriverJack)

[Notifications](https://github.com/login?return_to=%2FklezVirus%2FDriverJack) You must be signed in to change notification settings

# klezVirus/DriverJack

master

[**1** Branch](https://github.com/klezVirus/DriverJack/branches) [**0** Tags](https://github.com/klezVirus/DriverJack/tags)

[Go to Branches page](https://github.com/klezVirus/DriverJack/branches)[Go to Tags page](https://github.com/klezVirus/DriverJack/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![klezVirus](https://avatars.githubusercontent.com/u/8959898?v=4&size=40)](https://github.com/klezVirus)[klezVirus](https://github.com/klezVirus/DriverJack/commits?author=klezVirus)<br>[Reupload With Small Change](https://github.com/klezVirus/DriverJack/commit/8ed7175d80569fb10f58fc11520e27636c9ee698)<br>2 years agoAug 11, 2024<br>[8ed7175](https://github.com/klezVirus/DriverJack/commit/8ed7175d80569fb10f58fc11520e27636c9ee698) · 2 years agoAug 11, 2024<br>## History<br>[8 Commits](https://github.com/klezVirus/DriverJack/commits/master/) <br>Open commit details<br>[View commit history for this file.](https://github.com/klezVirus/DriverJack/commits/master/) 8 Commits |
| [BlinkLib](https://github.com/klezVirus/DriverJack/tree/master/BlinkLib "BlinkLib") | [BlinkLib](https://github.com/klezVirus/DriverJack/tree/master/BlinkLib "BlinkLib") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [DLEdit](https://github.com/klezVirus/DriverJack/tree/master/DLEdit "DLEdit") | [DLEdit](https://github.com/klezVirus/DriverJack/tree/master/DLEdit "DLEdit") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [DarkLoadDriver](https://github.com/klezVirus/DriverJack/tree/master/DarkLoadDriver "DarkLoadDriver") | [DarkLoadDriver](https://github.com/klezVirus/DriverJack/tree/master/DarkLoadDriver "DarkLoadDriver") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [DaveLib](https://github.com/klezVirus/DriverJack/tree/master/DaveLib "DaveLib") | [DaveLib](https://github.com/klezVirus/DriverJack/tree/master/DaveLib "DaveLib") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [DriverJack](https://github.com/klezVirus/DriverJack/tree/master/DriverJack "DriverJack") | [DriverJack](https://github.com/klezVirus/DriverJack/tree/master/DriverJack "DriverJack") | [Add HVCI Check](https://github.com/klezVirus/DriverJack/commit/ce09aebaab15e5861b1b1408c7dfae8aafe9bdbf "Add HVCI Check") | 2 years agoJun 11, 2024 |
| [IoCdfsLib](https://github.com/klezVirus/DriverJack/tree/master/IoCdfsLib "IoCdfsLib") | [IoCdfsLib](https://github.com/klezVirus/DriverJack/tree/master/IoCdfsLib "IoCdfsLib") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [RedirectServiceTest](https://github.com/klezVirus/DriverJack/tree/master/RedirectServiceTest "RedirectServiceTest") | [RedirectServiceTest](https://github.com/klezVirus/DriverJack/tree/master/RedirectServiceTest "RedirectServiceTest") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [SvcLib](https://github.com/klezVirus/DriverJack/tree/master/SvcLib "SvcLib") | [SvcLib](https://github.com/klezVirus/DriverJack/tree/master/SvcLib "SvcLib") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [.gitignore](https://github.com/klezVirus/DriverJack/blob/master/.gitignore ".gitignore") | [.gitignore](https://github.com/klezVirus/DriverJack/blob/master/.gitignore ".gitignore") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [DarkLoadDriver.sln](https://github.com/klezVirus/DriverJack/blob/master/DarkLoadDriver.sln "DarkLoadDriver.sln") | [DarkLoadDriver.sln](https://github.com/klezVirus/DriverJack/blob/master/DarkLoadDriver.sln "DarkLoadDriver.sln") | [First Release](https://github.com/klezVirus/DriverJack/commit/b5f35921ba301dbd2b98c748a8e9cb0a9ba8ccb8 "First Release") | 2 years agoJun 8, 2024 |
| [LICENSE](https://github.com/klezVirus/DriverJack/blob/master/LICENSE "LICENSE") | [LICENSE](https://github.com/klezVirus/DriverJack/blob/master/LICENSE "LICENSE") | [Create LICENSE](https://github.com/klezVirus/DriverJack/commit/c65369294d7bd1fc156665d036082b98508ac45f "Create LICENSE") | 2 years agoAug 9, 2024 |
| [README.md](https://github.com/klezVirus/DriverJack/blob/master/README.md "README.md") | [README.md](https://github.com/klezVirus/DriverJack/blob/master/README.md "README.md") | [Update README.md](https://github.com/klezVirus/DriverJack/commit/6c2272b7f938f2e70af9484280123d5202a98b79 "Update README.md") | 2 years agoAug 9, 2024 |
| [\[Whitepaper\] DriverJack - Abusing Emulated Read-Only Filesystems and NTFS Glitches for Infection and Persistence.pdf](https://github.com/klezVirus/DriverJack/blob/master/%5BWhitepaper%5D%20DriverJack%20-%20Abusing%20Emulated%20Read-Only%20Filesystems%20and%20NTFS%20Glitches%20for%20Infection%20and%20Persistence.pdf "[Whitepaper] DriverJack - Abusing Emulated Read-Only Filesystems and NTFS Glitches for Infection and Persistence.pdf") | [\[Whitepaper\] DriverJack - Abusing Emulated Read-Only Filesystems and NTFS Glitches for Infection and Persistence.pdf](https://github.com/klezVirus/DriverJack/blob/master/%5BWhitepaper%5D%20DriverJack%20-%20Abusing%20Emulated%20Read-Only%20Filesystems%20and%20NTFS%20Glitches%20for%20Infection%20and%20Persistence.pdf "[Whitepaper] DriverJack - Abusing Emulated Read-Only Filesystems and NTFS Glitches for Infection and Persistence.pdf") | [Reupload With Small Change](https://github.com/klezVirus/DriverJack/commit/8ed7175d80569fb10f58fc11520e27636c9ee698 "Reupload With Small Change") | 2 years agoAug 11, 2024 |
| View all files |

## Repository files navigation

# DriverJack

[Permalink: DriverJack](https://github.com/klezVirus/DriverJack#driverjack)

## Introduction

[Permalink: Introduction](https://github.com/klezVirus/DriverJack#introduction)

**DriverJack** is a tool designed to load a vulnerable driver by abusing lesser-known NTFS techniques. These method bypass the registration of a Driver Service on the system by hijacking an existing service, and also spoof the image path presented in the Driver Load event. To further masquerade the presence of a vulnerable driver, the attack also abuses an Emulated Filesystem Read-Only bypass to swap the content of a driver file on a mounted ISO before loading it.

## Emulated Filesystem Read-Only Bypass

[Permalink: Emulated Filesystem Read-Only Bypass](https://github.com/klezVirus/DriverJack#emulated-filesystem-read-only-bypass)

DriverJack abuses the possibility of remapping files mounted on emulated filesystems to RW pages to overwrite their contents. This RO bypass is implemented in **IoCdfsLib**.

## Attack Overview

[Permalink: Attack Overview](https://github.com/klezVirus/DriverJack#attack-overview)

Once the ISO is mounted, the attack proceeds by selecting a service driver that can be started or stopped, or one that can be triggered, requiring administrative privileges unless misconfigured.

### Key Attack Phases

[Permalink: Key Attack Phases](https://github.com/klezVirus/DriverJack#key-attack-phases)

1. **ISO Mounting and Driver Selection**
   - The attack begins with mounting the ISO as a filesystem.
   - The attacker selects a service driver that can be manipulated, focusing on those that can be started or restarted without immediate detection.
2. **Hijacking the Driver Path**
   - The core of the attack involves hijacking the driver path. The methods used include:
     - **Direct Reparse Point Abuse**
     - **DosDevice Global Symlink Abuse**
     - **Drive Mountpoint Swap**

### Attack Techniques

[Permalink: Attack Techniques](https://github.com/klezVirus/DriverJack#attack-techniques)

#### 1\. Direct Reparse Point Abuse

[Permalink: 1. Direct Reparse Point Abuse](https://github.com/klezVirus/DriverJack#1-direct-reparse-point-abuse)

This technique exploits the ability of an installer to access the `C:\Windows\System32\drivers` directory directly, allowing a malicious symbolic link to be placed there. The symbolic link is processed by the OS with precedence, leading to the malicious driver being loaded when the service is restarted.

**Key Steps:**

- The `NtLoadDriver` function normalizes the NT Path of the symbolic link.
- When the service is restarted, the malicious driver is loaded. However, the Load Driver event will show the real path of the driver image being loaded, pointing to the ISO mountpoint.

#### 2\. NT Symlink Abuse

[Permalink: 2. NT Symlink Abuse](https://github.com/klezVirus/DriverJack#2-nt-symlink-abuse)

Developed in collaboration with jonasLyk of the Secret Club hacker collective, this method involves redirecting the `\Device\BootDevice` NT symbolic link, part of the path from which a driver binary is loaded. This allows for the hiding of a rootkit within the system.

**Steps:**

- Gain SYSTEM privileges.
- Backup the `BootDevice` symlink target.
- Tamper with the `BootDevice` symlink to point to the mounted ISO.
- Start/Restart the service.
- Restore the `BootDevice` symlink target.

This method was inspired by techniques used in the unDefender project to disable the Windows Defender service and driver. The Load Driver event will still show the real path of the driver being loaded, pointing to the ISO mountpoint.

#### 3\. Mount Point Swapping

[Permalink: 3. Mount Point Swapping](https://github.com/klezVirus/DriverJack#3-mount-point-swapping)

Although widely known, this technique is rarely used due to the potential for system instability. It involves temporarily changing the drive letter assigned to the `BootPartition`, tricking the driver load process to access a different drive.
When combined with NT Symlink Abuse, explained before, this technique can completely masquerade the path of the driver being loaded, bypassing detection by SysMon and other monitoring tools.

## Conclusion

[Permalink: Conclusion](https://github.com/klezVirus/DriverJack#conclusion)

**DriverJack** demonstrates another, non-conventional way for vulnerable driver-loading that leverages CDFS emulated filesystems and lesser-known NTFS symbolic link properties.

## Thanks

[Permalink: Thanks](https://github.com/klezVirus/DriverJack#thanks)

- Jonas Lyk for all the help and the brainstorming sessions.

## Additional References

[Permalink: Additional References](https://github.com/klezVirus/DriverJack#additional-references)

- unDefender by APT Tortellini

## License

[Permalink: License](https://github.com/klezVirus/DriverJack#license)

This project is licensed under the MIT License - see the [LICENSE](https://github.com/klezVirus/DriverJack/blob/master/LICENSE) file for details.

## About

Hijacking valid driver services to load arbitrary (signed) drivers abusing native symbolic links and NT paths


### Resources

[Readme](https://github.com/klezVirus/DriverJack#readme-ov-file)

### License

[MIT license](https://github.com/klezVirus/DriverJack#MIT-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/klezVirus/DriverJack).

[Activity](https://github.com/klezVirus/DriverJack/activity)

### Stars

[**359**\\
stars](https://github.com/klezVirus/DriverJack/stargazers)

### Watchers

[**6**\\
watching](https://github.com/klezVirus/DriverJack/watchers)

### Forks

[**57**\\
forks](https://github.com/klezVirus/DriverJack/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FklezVirus%2FDriverJack&report=klezVirus+%28user%29)

## [Releases](https://github.com/klezVirus/DriverJack/releases)

No releases published

## [Packages\  0](https://github.com/users/klezVirus/packages?repo_name=DriverJack)

No packages published

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/klezVirus/DriverJack).

## Languages

- [C++97.0%](https://github.com/klezVirus/DriverJack/search?l=c%2B%2B)
- [C3.0%](https://github.com/klezVirus/DriverJack/search?l=c)

You can’t perform that action at this time.