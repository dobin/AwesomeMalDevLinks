Title:
300 Milliseconds to Admin: Mastering DLL Hijacking and Hooking to Win the Race (CVE-2025-24076 and CVE-2025-24994)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post details a Windows 11 local privilege escalation discovered during a pentest by abusing a writable COM InProcServer32 DLL path under `C:\ProgramData\CrossDevice\`.  
- CVE-2025-24076 enables low-privileged users to gain SYSTEM/admin by replacing a Microsoft-signed DLL that is later loaded by a privileged process as part of the “Mobile devices” (phone/webcam) feature.  
- A secondary issue, CVE-2025-24994, is noted where a user process loads the DLL without signature verification, enabling user-to-user abuse.  
- The main challenge is a tight race window (~300 ms) and file-locking semantics that prevent overwriting while the DLL is open.  
- The author improves reliability by using an Opportunistic Lock (OpLock) to stall execution and Microsoft Detours API hooking to intercept `GetFileVersionInfoExW`, then overwriting the DLL immediately after the handle is closed.  
- To avoid crashing the target, the malicious DLL is implemented as a proxy that forwards required exports (`DllCanUnloadNow`, `DllGetClassObject`) to the original DLL while executing payload code.  
- Useful for red teams and exploit developers studying practical race-condition hardening, DLL hijacking, and Windows feature-driven LPE paths; also relevant to defenders for understanding detection points around COM/DLL load chains.

Technical Focus:
- Windows COM hijacking via `InProcServer32` and writable DLL paths
- DLL replacement race conditions and file locking/ShareMode behavior
- Opportunistic Locks (OpLocks) to control timing
- WinAPI hooking with Microsoft Detours (`GetFileVersionInfoExW`)
- Proxy DLL/export forwarding to preserve application behavior
- Windows 11 “Mobile devices” / CrossDeviceService DLL load chain

Use Cases:
- Local privilege escalation on vulnerable Windows 11 builds via DLL hijack in CrossDevice components
- Turning unreliable file-replacement races into deterministic exploits using OpLocks + API hooks
- Building proxy DLLs that maintain original exports while running attacker code
- Blue-team hunting for suspicious DLL writes/loads in `C:\ProgramData\CrossDevice\` and unusual Detours-style API hooking

Keywords:
CVE-2025-24076, CVE-2025-24994, Windows 11, LPE, privilege escalation, DLL hijacking, COM InProcServer32, CLSID, CrossDeviceService.exe, Mobile devices feature, ProgramData, race condition, Opportunistic Lock, OpLock, SetOpLock, Microsoft Detours, API hooking, GetFileVersionInfoExW, proxy DLL, DllGetClassObject, DllCanUnloadNow, code signing, signature verification