Title:
.NET GAC and NIC Hijacking for Lateral Movement

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains how .NET Framework assembly resolution differs from classic DLL search order, emphasizing the Global Assembly Cache (GAC) and Native Image Cache (NIC) as high-priority load locations.  
- It demonstrates two lateral movement/persistence techniques: replacing assemblies in the GAC and backdooring NIC native images (`*.ni.dll`) so existing Windows/.NET applications load attacker-controlled code.  
- The author highlights that native images typically take load priority over GAC assemblies, so GAC hijacking often requires targeting assemblies without NIC entries or deleting the corresponding native image.  
- It shows practical backdooring of .NET assemblies using Mono.Cecil (e.g., adding a module initializer) and discusses strong-name verification limitations (assemblies may still load even if verification fails).  
- For NIC hijacking, it covers an “easy” PE-level patch of the native image and a “harder” workflow that re-signs a modified assembly to generate a new native image via `ngen.exe`, then swaps it in.  
- Useful for red teams/pentesters and defenders investigating persistence/lateral movement paths in .NET-heavy Windows environments, especially where local admin access is available.

Technical Focus:
- .NET Framework assembly binding and resolution order (GAC vs NIC vs app paths)
- Global Assembly Cache (GAC) structure, strong naming, and verification behavior
- Native Image Cache (NIC) / NGen (`ngen.exe`) native images and load priority
- Assembly backdooring with Mono.Cecil (IL injection, module initializers)
- PE patching/backdooring of `*.ni.dll` native images
- Permission model/abuse (local Administrators write access to GAC/NIC)

Use Cases:
- Lateral movement by planting backdoored .NET dependencies on remote hosts
- Persistence via high-frequency .NET assemblies loaded by MMC snap-ins (e.g., Task Scheduler)
- “Upload now, execute later” (dechaining staging from execution) by waiting for normal app loads
- Red team tradecraft for stealthy code execution inside trusted Windows processes
- Defensive hunting for unexpected modifications in GAC/NIC directories and anomalous native images

Keywords:
.NET Framework, assembly resolution, Global Assembly Cache, GAC, Native Image Cache, NIC, NGen, ngen.exe, strong name, strong-name verification, Mono.Cecil, IL injection, module initializer, mmc.exe, Task Scheduler snap-in, MIGUIControls.dll, TaskScheduler.ni.dll, PE patching, lateral movement, persistence