# https://nasbench.medium.com/finding-detection-and-forensic-goodness-in-etw-providers-7c7a2b5b5f4f

[Sitemap](https://nasbench.medium.com/sitemap/sitemap.xml)

[Open in app](https://play.google.com/store/apps/details?id=com.medium.reader&referrer=utm_source%3DmobileNavBar&source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fnasbench.medium.com%2Ffinding-detection-and-forensic-goodness-in-etw-providers-7c7a2b5b5f4f&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

[Medium Logo](https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav------------------)

[Search](https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fnasbench.medium.com%2Ffinding-detection-and-forensic-goodness-in-etw-providers-7c7a2b5b5f4f&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

![](https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png)

# Finding Detection and Forensic Goodness In ETW Providers

[![Nasreddine Bencherchali](https://miro.medium.com/v2/resize:fill:32:32/1*ASym8U_jrEiFZvDpm1zyqA.jpeg)](https://nasbench.medium.com/?source=post_page---byline--7c7a2b5b5f4f---------------------------------------)

[Nasreddine Bencherchali](https://nasbench.medium.com/?source=post_page---byline--7c7a2b5b5f4f---------------------------------------)

Follow

6 min read

·

Aug 25, 2021

57

1

[Listen](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2Fplans%3Fdimension%3Dpost_audio_button%26postId%3D7c7a2b5b5f4f&operation=register&redirect=https%3A%2F%2Fnasbench.medium.com%2Ffinding-detection-and-forensic-goodness-in-etw-providers-7c7a2b5b5f4f&source=---header_actions--7c7a2b5b5f4f---------------------post_audio_button------------------)

Share

## Introduction

Hello and welcome to this follow-up blog on ETW. If you haven't read the first part I highly suggest you do because this will be a direct build-up on the concepts introduced there. (Link below)

[**A Primer On Event Tracing For Windows (ETW)** \\
\\
nasbench.medium.com](https://nasbench.medium.com/a-primer-on-event-tracing-for-windows-etw-997725c082bf?source=post_page-----7c7a2b5b5f4f---------------------------------------)

Last time we talked about ETW and its different components. This time I thought I’ll take a look at some of the providers out there. With more than 1000+ providers available by default I started researching interesting events that can help us during detection and forensic investigations.

So let’s get started.

## Get Nasreddine Bencherchali’s stories in your inbox

Join Medium for free to get updates from this writer.

Subscribe

Subscribe

**Note:** Some of the telemetry mentioned here can be obtained via different providers, channels, or methods. The point is to showcase some of the lesser-known ETW providers or at least the not-so-common.

## Microsoft-Windows-Kernel-Process

### Process Creation

- **EID:** 1
- **Channel:** Microsoft-Windows-Kernel-Process/Analytic
- **_Description:_** Capture process creation

Here is an example showing “explorer.exe” spawning “cmd.exe” :

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*lN4xrxTfrZUB0ea5fB3ohg.png)

EID 1 — Process Creation

### Thread Start

- **EID:** 3
- **Channel:** Microsoft-Windows-Kernel-Process/Analytic
- **Description:** Capture thread start in a process

Here is an example showing “cmd.exe” starting a thread:

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*vQ5D8fdtd8lGY92-ke-1kA.png)

EID 3 — Thread Start

### Image Load

- **EID:** 5
- **Channel:** Microsoft-Windows-Kernel-Process/Analytic
- **Description:** Capture when an Image is being loaded into a process

Here is an example of “conhost.exe” loading “ntdll.dll” :

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*z5U2qZhPa-5tDQuO3TQUyw.png)

EID 5 — Image Load

Other interesting events generated by this provider are :

- EID 2 — Process termination (Stop)
- EID 6 — Image unload

## Microsoft-Windows-Kernel-File

### File Creation

- **EID:** 10 / 30
- **Channel:** Microsoft-Windows-Kernel-File/Analytic
- **Description:** Capture file creation event

Here is an example showing “svchost.exe” creating a prefetch file for when i executed “python.exe”:

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*uFREygoL0zANwdtkztFh2A.png)

EID 30 — File Creation

### File Deletion

- **EID:** 11
- **Channel:** Microsoft-Windows-Kernel-File/Analytic
- **Description:** Capture file deletion

Here is an example showing the deletion of the file “example.txt” using the “del” command for example :

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*cspdvCehgT5RNwMrO3Yxxg.png)

EID 11 — File Deletion

Similar to the “Kernel-Process” provider, other interesting events exists that i suggest you check out.

## Microsoft-Windows-Kernel-Network

### Attempted Connection

- **EID:** 12
- **Channel:** Microsoft-Windows-Kernel-Network/Analytic
- **Description:** Capture attempts of initial connection to an IP

Here is an example showing “chrome.exe” attempting to connect to my python server on port “4444”:

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*cvsIgaflSy-0i2YSTOLBAA.png)

EID 12 — Attempted Connection

### Established Connection

- **EID:** 15
- **Channel:** Microsoft-Windows-Kernel-Network/Analytic

Here is an example showing that the previous connection has been established :

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*Ja77TncL9xn7_ZW6zsIzbw.png)

EID 15 — Connection established

### N° of Bytes Transmitted / Received

- **EID:** 10 and 11
- **Channel:** Microsoft-Windows-Kernel-Network/Analytic

These events capture the number of bytes transmitted and received to and from a server. Can be helpful to determine if data has been exfiltrated. Here is an example :

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*alsEdnn08aSGVThUYOGOlQ.png)

These events capture TCPv4 data. This provider also captures events for TCPv6, UDPv4, and UDPv6.

## Microsoft-Windows-Kernel-Registry

This provider contains a lot of useful events from on action performed on the registry such as:

- **CreateKey (EID 1)**
- **OpenKey (EID 2)**
- **DeleteKey (EID 3)**
- **QueryKey (EID 4)**
- **SetValueKey (EID 5)**
- **DeleteValueKey (EID 6)**
- **QueryValueKey (EID 7)**
- **EnumerateKey (EID 8)**
- **EnumerateValueKey (EID 9)**

These events are straightforward and simple to understand. They are available also in the **“Microsoft-Windows-Kernel-Registry/Analytic”** channel.

## Microsoft-Windows-Services-Svchost

This provider is straight forward has only two events that indicate when an svchost process started and stopped

### Svchost Process Start

- **EID:** 101
- **Channel:** Microsoft-Windows-Services-Svchost/Diagnostic

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*QGECmYTcb18ChLYndOoiEA.png)

EID 101 — SVCHOST START

### Svchost Process Stop

- **EID:** 102
- **Channel:** Microsoft-Windows-Services-Svchost/Diagnostic

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:470/1*DkammdCftuQTz_Qz1eV1XQ.png)

EID 102 — SVCHOST STOP

## Microsoft-Windows-LDAP-Client

### LDAP Search

- **EID:** 30
- **Channel:** Microsoft-Windows-LDAP-Client/Debug
- **Description:** Captures LDAP search query from different LDAP clients.

Below is an example of queries performed from the client “ldapbrowser.exe” :

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*nGkO1qZl8QLN-_ciZTIpdw.png)

EID 30 — LDAP Search

If we used a similar client such as the MMC console “Active Directory Users and Computers” snap-in we obtain the same result. In theory, since the events are handled by the “wldap32.dll” dll. Every process that loads this and should generate these events.

## Microsoft-Windows-COMRuntime

### COM Interface Usage / Call

- **EID:** 2
- **Channel:** Microsoft-Windows-COMRuntime/Tracing

Here is an example of an event generated by this provider

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*dCtEJNzHOHrmBvrqnKEPKQ.png)

We can see the target method and interface use that can help us for example to find DCOM lateral movement attempts.

## Microsoft-Windows-Winlogon

This provider contains some interesting events. I talk about some that are present in the “operational” channel in a previous blog but there are some others available only on the “Microsoft-Windows-Winlogon/Diagnostic” channel. Such as :

- “Fail” and “Successful” attempts to “Lock” or “Unlock” a computer
- “Successful” or “Failed” logon

Here is an example showing a sequence of “Lock” and “Unlock”

```
TimeStamp: 2021-08-25 22:27:10EID: 6113Operation: LOCKProcessId: 712ProcessName: winlogon.exeProcess Commandline: winlogon.exeThreadId: 460Event Description: LOCK Started--------------------------------------------------------------------TimeStamp: 2021-08-25 22:27:15EID: 6105Operation: UNLOCKProcessId: 712ProcessName: winlogon.exeProcess Commandline: winlogon.exeThreadId: 460Event Description: UNLOCK Started--------------------------------------------------------------------TimeStamp: 2021-08-25 22:27:15EID: 6107Operation: UNLOCKProcessId: 712ProcessName: winlogon.exeProcess Commandline: winlogon.exeThreadId: 460Event Description: UNLOCK Failed (Reason : 1326)--------------------------------------------------------------------TimeStamp: 2021-08-25 22:27:17EID: 6105Operation: UNLOCKProcessId: 712ProcessName: winlogon.exeProcess Commandline: winlogon.exeThreadId: 460Event Description: UNLOCK Started--------------------------------------------------------------------TimeStamp: 2021-08-25 22:27:17EID: 6106Operation: UNLOCKProcessId: 712ProcessName: winlogon.exeProcess Commandline: winlogon.exeThreadId: 460Event Description: UNLOCK Successful (Reason : 0)
```

## Microsoft-Windows-TerminalServices-ClientActiveXCore

This provider export some events through the “Microsoft-Windows-TerminalServices-RDPClient” event log “operational” channel and some through the “analytic” channel. One of the interesting events provided are both

- **EID 1001**
- **EID 1102**

That indicates when a user initiates an RDP connection from his machine. So for example using “mstsc.exe” to connect to a server, we get the following event :

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:700/1*yOrW_ytk50JKkbVb2CoobQ.png)

EID 1102

## Microsoft-Windows-RPC

With this provider, we can capture RPC Server/Client Calls as shown in the images below

### Server RPC Call Start

- **EID:** 5
- **Channel:** Debug

![](https://miro.medium.com/v2/resize:fit:669/1*zHwPz2n2_aEemEuEQSbt9g.png)

EID 5

### Client RPC Call Start

- **EID:** 6
- **Channel:** Debug

![](https://miro.medium.com/v2/resize:fit:696/1*tr82AiF-c6c3rP3DaMCa-A.png)

EID 6

## Conclusion

This concludes our quick tour in ETW provider land. I just showcased some of the events I found interesting and there many more out there to find.

All of the events mentioned here were captured using the python “pywintrace” library. All of the scripts used and more are available in the Github repository.

[**GitHub - nasbench/EVTX-ETW-Resources: Event Tracing For Windows (ETW) Resources** \\
\\
**This is a repository that contains a bunch of resources to learn and understand EVTX/ETW (Event Tracing for Windows)…**\\
\\
github.com](https://github.com/nasbench/EVTX-ETW-Resources?source=post_page-----7c7a2b5b5f4f---------------------------------------)

Thanks for reading and I hope you got something out of this. If you have any questions or remarks send them my way on Twitter [@nas\_bench](https://twitter.com/nas_bench)

[Etw](https://medium.com/tag/etw?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Windows](https://medium.com/tag/windows?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Forensics](https://medium.com/tag/forensics?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Detection](https://medium.com/tag/detection?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Blue Team](https://medium.com/tag/blue-team?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[![Nasreddine Bencherchali](https://miro.medium.com/v2/resize:fill:48:48/1*ASym8U_jrEiFZvDpm1zyqA.jpeg)](https://nasbench.medium.com/?source=post_page---post_author_info--7c7a2b5b5f4f---------------------------------------)

[![Nasreddine Bencherchali](https://miro.medium.com/v2/resize:fill:64:64/1*ASym8U_jrEiFZvDpm1zyqA.jpeg)](https://nasbench.medium.com/?source=post_page---post_author_info--7c7a2b5b5f4f---------------------------------------)

Follow

[**Written by Nasreddine Bencherchali**](https://nasbench.medium.com/?source=post_page---post_author_info--7c7a2b5b5f4f---------------------------------------)

[2.4K followers](https://nasbench.medium.com/followers?source=post_page---post_author_info--7c7a2b5b5f4f---------------------------------------)

· [64 following](https://nasbench.medium.com/following?source=post_page---post_author_info--7c7a2b5b5f4f---------------------------------------)

I write about #Detection, #Sigma and #Windows. Follow [https://github.com/nasbench/Misc-Research](https://github.com/nasbench/Misc-Research) for interesting Windows tidbits

Follow

## Responses (1)

![](https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png)

Write a response

[What are your thoughts?](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fnasbench.medium.com%2Ffinding-detection-and-forensic-goodness-in-etw-providers-7c7a2b5b5f4f&source=---post_responses--7c7a2b5b5f4f---------------------respond_sidebar------------------)

Cancel

Respond

[![John77](https://miro.medium.com/v2/resize:fill:32:32/0*38VlNAklbDnQpIpt)](https://medium.com/@john5678snow?source=post_page---post_responses--7c7a2b5b5f4f----0-----------------------------------)

[John77](https://medium.com/@john5678snow?source=post_page---post_responses--7c7a2b5b5f4f----0-----------------------------------)

[Nov 22, 2023](https://medium.com/@john5678snow/how-can-you-see-writing-to-an-existing-file-from-a-specific-process-a21692c0f411?source=post_page---post_responses--7c7a2b5b5f4f----0-----------------------------------)

```
How can you see writing to an existing file from a specific process,

For example process 100, writes to test.txt "hello" at location C:\Users\john\Desktop\test.txt

?
```

--

Reply

## More from Nasreddine Bencherchali

[See all from Nasreddine Bencherchali](https://nasbench.medium.com/?source=post_page---author_recirc--7c7a2b5b5f4f---------------------------------------)

## Recommended from Medium

[See more recommendations](https://medium.com/?source=post_page---read_next_recirc--7c7a2b5b5f4f---------------------------------------)

[Help](https://help.medium.com/hc/en-us?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Status](https://status.medium.com/?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[About](https://medium.com/about?autoplay=1&source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Press](mailto:pressinquiries@medium.com)

[Blog](https://blog.medium.com/?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Rules](https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7c7a2b5b5f4f---------------------------------------)

[Text to speech](https://speechify.com/medium?source=post_page-----7c7a2b5b5f4f---------------------------------------)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)