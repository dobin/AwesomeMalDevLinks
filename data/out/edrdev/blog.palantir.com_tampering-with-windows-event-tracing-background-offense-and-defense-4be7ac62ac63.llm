Title:
Tampering with Windows Event Tracing: Background, Offense, and Defense

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains how Windows Event Tracing for Windows (ETW) underpins Windows Event Log collection and how attackers can tamper with ETW to suppress telemetry without generating obvious event-log artifacts.  
- It breaks down ETW architecture (providers, sessions, controllers/consumers) and shows how to enumerate sessions/providers with `logman` and PowerShell ETW cmdlets/WMI-backed classes.  
- The author reverse engineers provider behavior using PowerShell ScriptBlock logging (Event ID 4104) and AMSI ETW events to illustrate how channel/keyword configuration determines whether events land in Event Logs.  
- It then details offensive ETW tampering techniques, including persistent autologger registry modifications (provider removal, EnableProperty changes) and ephemeral provider removal from active trace sessions (SYSTEM-level).  
- Defensive guidance focuses on monitoring autologger registry keys, detecting trace-session modifications (limited signal), and using WMI event subscriptions to log provider removals into the Application log.  
- Useful for both red teams (understanding stealthy log suppression) and blue teams/IR (hardening and validating telemetry integrity assumptions).

Technical Focus:
- ETW architecture: providers, trace sessions, controllers, consumers
- Autologger sessions and registry-backed configuration (WMI\Autologger)
- Provider filtering: levels, keywords (MatchAny/MatchAll), channels (Admin/Operational/etc.)
- Event provider internals and APIs (EventWrite, EventWriteTransfer, EVENT_DESCRIPTOR)
- PowerShell ScriptBlock logging (4104) and AMSI ETW provider behavior
- Detection of ETW tampering via registry monitoring and WMI event subscriptions

Use Cases:
- Validate and harden Windows telemetry pipelines that rely on Event Logs/ETW
- Red-team tradecraft to temporarily or persistently suppress specific event sources (e.g., PowerShell logging)
- Build detections for autologger/provider configuration drift and suspicious trace-session changes
- Enable additional ETW sources (e.g., AMSI) by creating custom autologgers/trace sessions
- Incident response triage for “missing logs” scenarios caused by ETW misconfiguration or tampering

Keywords:
ETW, Event Tracing for Windows, Windows Event Log, autologger, HKLM\SYSTEM\CurrentControlSet\Control\WMI\Autologger, logman.exe, EventTracingManagement, WMI, MSFT_EtwTraceProvider, EventWriteTransfer, EventWrite, EVENT_DESCRIPTOR, keywords, channels, EnableProperty, EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0, EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0, PowerShell 4104, ScriptBlock logging, AMSI, Microsoft-Antimalware-Scan-Interface, Microsoft-Windows-Kernel-EventTracing/Analytic, trace session tampering