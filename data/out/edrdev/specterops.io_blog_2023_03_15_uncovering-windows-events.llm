Title:
Uncovering Windows Events

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post walks through reverse engineering how the Windows Threat-Intelligence (TI) manifest-based ETW provider generates specific security events, using WriteProcessMemory/NtWriteVirtualMemory as the example.  
- It addresses the gap that many ETW providers exist but are not consistently ingested by EDR/telemetry sensors, and shows a repeatable method to map “what event fires for what behavior.”  
- The author traces kernel-side provider registration in `ntoskrnl.exe` (via `EtwRegister`/`EtwInitialize`), then follows call paths to `EtwWrite` to identify the `EVENT_DESCRIPTOR` and event IDs used for local vs remote VM read/write operations.  
- It highlights that logging TI events requires a Protected Process Light (PPL) context, explaining why vendors run as PPL and why tools like Sealighter-TI exist.  
- Useful for defenders validating telemetry coverage and for red teamers/malware developers understanding which low-level actions are likely to produce TI ETW signals.  
- Interesting because it ties high-level APIs (WriteProcessMemory) to kernel instrumentation points and concrete ETW event IDs/keywords.

Technical Focus:
- Event Tracing for Windows (ETW) manifest-based providers
- Threat-Intelligence ETW provider (TI) internals and constraints (PPL)
- Kernel reverse engineering of `ntoskrnl.exe` with IDA
- `EtwRegister` / `EtwInitialize` / `EtwWrite` call flow and `EVENT_DESCRIPTOR`
- Virtual memory read/write telemetry (`NtWriteVirtualMemory`, `MiReadWriteVirtualMemory`)
- Process access rights mapping (e.g., `PROCESS_VM_READ` 0x10, `PROCESS_VM_WRITE` 0x20)

Use Cases:
- Map ETW TI events to specific process injection / memory tampering primitives
- Validate whether an EDR is consuming TI provider events and which ones
- Build or tune ETW consumers/detections using event IDs and keyword masks
- Reproduce the methodology to reverse other manifest-based ETW providers
- Research PPL requirements and implications for telemetry collection

Keywords:
ETW, Threat-Intelligence provider, TI ETW, manifest-based provider, ntoskrnl.exe, kernel telemetry, IDA Pro, EtwRegister, EtwInitialize, EtwWrite, EVENT_DESCRIPTOR, event ID, keyword mask, PPL, Protected Process Light, WriteProcessMemory, NtWriteVirtualMemory, MiReadWriteVirtualMemory, PROCESS_VM_WRITE, PROCESS_VM_READ