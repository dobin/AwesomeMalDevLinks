Title:
Detecting Vectored Exception Handling Squared in an EDR (Rust, Windows Kernel)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes how the author’s Rust-based “Sanctum EDR” detects malware that abuses Vectored Exception Handling (VEH), specifically the “VEH Squared” technique used to redirect execution and evade user-mode monitoring.  
- It focuses on identifying suspicious exception-handler registration and execution patterns that indicate control-flow manipulation via deliberate faults/exceptions rather than normal API-driven flow.  
- The discussion is framed from an EDR engineering perspective, leveraging kernel visibility and/or telemetry to spot handler chains, anomalous exception rates, and memory protections/regions associated with staged payload execution.  
- It’s useful for blue teams and EDR developers building detections for modern in-memory tradecraft, and for red teams to understand what artifacts VEH-based loaders leave behind.  
- The key value is translating a known offensive technique into concrete detection logic and implementation considerations in a Windows kernel/Rust context.

Technical Focus:
- Vectored Exception Handling (AddVectoredExceptionHandler / handler chains)
- VEH Squared / exception-driven control-flow redirection
- Windows kernel-assisted EDR telemetry and correlation
- In-memory execution indicators (RX/RWX regions, staged payloads)
- Detection engineering trade-offs (false positives, performance)

Use Cases:
- Build EDR detections for exception-based loaders and evasive implants
- Hunt for anomalous VEH registration and high-frequency exception behavior
- Validate/red-team test whether VEH-based execution is being monitored
- Create telemetry rules correlating exceptions with suspicious memory changes

Keywords:
VEH, Vectored Exception Handling, VEH Squared, AddVectoredExceptionHandler, exception handler chain, Windows kernel driver, Rust, Sanctum EDR, in-memory execution, control-flow hijack, anti-EDR, telemetry correlation, memory protections, RX/RWX, NTDLL, Windows internals, detection engineering, malware loader