Title:
Attacking EDRs Part 3: One Bug to Stop them all

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes a cross-vendor Windows EDR denial-of-service technique where a low-privileged user can permanently break an EDR agent after reboot by pre-creating IPC objects (primarily ALPC ports) that the agent expects to create during startup.  
- Many EDR user-mode components fail to handle “object already exists” conditions in the Windows Object Manager namespace (commonly `\RPC Control`), causing initialization failure, crashes, or degraded functionality while kernel drivers often continue without effective detection.  
- The author demonstrates reliably winning the startup race using Scheduled Tasks (e.g., logon trigger combined with ARSO auto-logon) to register the target ALPC port before the EDR service starts.  
- The research includes ALPC background, port enumeration methods (WinDBG `!alpc`, ProcessHacker/SystemInformer), and notes on RPC-over-ALPC usage via `rpcrt4.dll` and interface callbacks.  
- Affected products include Cortex XDR, Microsoft Defender for Endpoint, Check Point Harmony, Kaspersky, Trend Micro, Malwarebytes (partial), SentinelOne (partial/variant), and CrowdStrike (partial).  
- It’s useful for red teams and vulnerability researchers assessing EDR resilience, and for defenders/vendors to harden startup/IPC design and add health/telemetry for user-mode failures.

Technical Focus:
- Windows ALPC and RPC (`ncalrpc`, `rpcrt4.dll`) internals and port registration
- Windows Object Manager namespace abuse (`\RPC Control`) and pre-creation/race conditions
- EDR architecture split: user-mode services vs kernel drivers; failure modes and coverage gaps
- Startup persistence/race techniques via Scheduled Tasks and ARSO
- ALPC port enumeration and security descriptor inspection (WinDBG, ProcessHacker/SystemInformer)
- Variant resource blocking via Named Pipes (`\Device\NamedPipe\...`)

Use Cases:
- Disable or degrade EDR user-mode components pre-logon to reduce detection during post-exploitation
- Validate EDR robustness against IPC object squatting and startup race conditions
- Develop detections for “EDR not healthy but host online” and suspicious early-start IPC object creation
- Vendor hardening guidance: randomized/privileged IPC names, driver-enforced recovery/telemetry

Keywords:
ALPC, Advanced Local Procedure Call, Windows RPC, ncalrpc, rpcrt4.dll, Object Manager namespace, \RPC Control, port squatting, race condition, denial of service, EDR bypass, Scheduled Task, ARSO, WinDBG !alpc, Security Descriptor (SDDL), Protected Process Light (PPL), Named Pipes, CVE-2023-3280, CVE-2024-5909, CVE-2024-20671