# https://github.com/mandiant/SilkETW

[Skip to content](https://github.com/mandiant/SilkETW#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/mandiant/SilkETW) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/mandiant/SilkETW) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/mandiant/SilkETW) to refresh your session.Dismiss alert

{{ message }}

This repository was archived by the owner on Aug 5, 2024. It is now read-only.


[mandiant](https://github.com/mandiant)/ **[SilkETW](https://github.com/mandiant/SilkETW)** Public archive

- [Notifications](https://github.com/login?return_to=%2Fmandiant%2FSilkETW) You must be signed in to change notification settings
- [Fork\\
135](https://github.com/login?return_to=%2Fmandiant%2FSilkETW)
- [Star\\
823](https://github.com/login?return_to=%2Fmandiant%2FSilkETW)


### License

[Apache-2.0 license](https://github.com/mandiant/SilkETW/blob/master/LICENSE.txt)

[823\\
stars](https://github.com/mandiant/SilkETW/stargazers) [135\\
forks](https://github.com/mandiant/SilkETW/forks) [Branches](https://github.com/mandiant/SilkETW/branches) [Tags](https://github.com/mandiant/SilkETW/tags) [Activity](https://github.com/mandiant/SilkETW/activity)

[Star](https://github.com/login?return_to=%2Fmandiant%2FSilkETW)

[Notifications](https://github.com/login?return_to=%2Fmandiant%2FSilkETW) You must be signed in to change notification settings

# mandiant/SilkETW

master

[**3** Branches](https://github.com/mandiant/SilkETW/branches) [**3** Tags](https://github.com/mandiant/SilkETW/tags)

[Go to Branches page](https://github.com/mandiant/SilkETW/branches)[Go to Tags page](https://github.com/mandiant/SilkETW/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>![author](https://github.githubassets.com/images/gravatars/gravatar-user-420.png?size=40)<br>Willi Ballenthin (Google)<br>[Update LICENSE.txt](https://github.com/mandiant/SilkETW/commit/093f57201525343d4ebd3d9be33f4c6a1a425ed5)<br>3 years agoJun 1, 2023<br>[093f572](https://github.com/mandiant/SilkETW/commit/093f57201525343d4ebd3d9be33f4c6a1a425ed5) · 3 years agoJun 1, 2023<br>## History<br>[12 Commits](https://github.com/mandiant/SilkETW/commits/master/) <br>Open commit details<br>[View commit history for this file.](https://github.com/mandiant/SilkETW/commits/master/) 12 Commits |
| [Images](https://github.com/mandiant/SilkETW/tree/master/Images "Images") | [Images](https://github.com/mandiant/SilkETW/tree/master/Images "Images") | [+SilkETW v0.5](https://github.com/mandiant/SilkETW/commit/dd11b70613f03ef69cc913d7e094e3e2d2cc6774 "+SilkETW v0.5") | 7 years agoMar 25, 2019 |
| [SilkETW](https://github.com/mandiant/SilkETW/tree/master/SilkETW "SilkETW") | [SilkETW](https://github.com/mandiant/SilkETW/tree/master/SilkETW "SilkETW") | [\+ SilkETW-SilkService v0.8](https://github.com/mandiant/SilkETW/commit/f2f5c6c7e8261564f8481429bb704a10543f601e "+ SilkETW-SilkService v0.8") | 7 years agoSep 13, 2019 |
| [SilkService](https://github.com/mandiant/SilkETW/tree/master/SilkService "SilkService") | [SilkService](https://github.com/mandiant/SilkETW/tree/master/SilkService "SilkService") | [\+ SilkETW-SilkService v0.8](https://github.com/mandiant/SilkETW/commit/f2f5c6c7e8261564f8481429bb704a10543f601e "+ SilkETW-SilkService v0.8") | 7 years agoSep 13, 2019 |
| [.gitignore](https://github.com/mandiant/SilkETW/blob/master/.gitignore ".gitignore") | [.gitignore](https://github.com/mandiant/SilkETW/blob/master/.gitignore ".gitignore") | [Create .gitignore](https://github.com/mandiant/SilkETW/commit/b285342169f32a0f4ff463d9f78b91d82412e28a "Create .gitignore") | 7 years agoMar 19, 2019 |
| [Changelog.txt](https://github.com/mandiant/SilkETW/blob/master/Changelog.txt "Changelog.txt") | [Changelog.txt](https://github.com/mandiant/SilkETW/blob/master/Changelog.txt "Changelog.txt") | [\+ SilkETW-SilkService v0.8](https://github.com/mandiant/SilkETW/commit/f2f5c6c7e8261564f8481429bb704a10543f601e "+ SilkETW-SilkService v0.8") | 7 years agoSep 13, 2019 |
| [LICENSE-3RD-PARTY.txt](https://github.com/mandiant/SilkETW/blob/master/LICENSE-3RD-PARTY.txt "LICENSE-3RD-PARTY.txt") | [LICENSE-3RD-PARTY.txt](https://github.com/mandiant/SilkETW/blob/master/LICENSE-3RD-PARTY.txt "LICENSE-3RD-PARTY.txt") | [Initial Release](https://github.com/mandiant/SilkETW/commit/c7566f6227197f4f71ab1e66ed09c5c87e9495b7 "Initial Release") | 7 years agoMar 19, 2019 |
| [LICENSE.txt](https://github.com/mandiant/SilkETW/blob/master/LICENSE.txt "LICENSE.txt") | [LICENSE.txt](https://github.com/mandiant/SilkETW/blob/master/LICENSE.txt "LICENSE.txt") | [Update LICENSE.txt](https://github.com/mandiant/SilkETW/commit/093f57201525343d4ebd3d9be33f4c6a1a425ed5 "Update LICENSE.txt") | 3 years agoJun 1, 2023 |
| [README.md](https://github.com/mandiant/SilkETW/blob/master/README.md "README.md") | [README.md](https://github.com/mandiant/SilkETW/blob/master/README.md "README.md") | [Update README.md](https://github.com/mandiant/SilkETW/commit/c5368720305dab1767c95e827eb07cb0caf4c8a5 "Update README.md") | 5 years agoMar 28, 2021 |
| View all files |

## Repository files navigation

# SilkETW & SilkService

[Permalink: SilkETW & SilkService](https://github.com/mandiant/SilkETW#silketw--silkservice)

SilkETW & SilkService are flexible C# wrappers for ETW, they are meant to abstract away the complexities of ETW and give people a simple interface to perform research and introspection. While both projects have obvious defensive (and offensive) applications they should primarily be considered as research tools.

For easy consumption, output data is serialized to JSON. The JSON data can either be written to file and analyzed locally using PowerShell, stored in the Windows eventlog or shipped off to 3rd party infrastructure such as [Elasticsearch](https://www.elastic.co/).

For more information on the future of SilkETW & SilkService, see the [Roadmap](https://github.com/mandiant/SilkETW#roadmap) section.

## Media

[Permalink: Media](https://github.com/mandiant/SilkETW#media)

For more background on SilkETW and SilkService please consult the following resources.

- SilkETW: Because Free Telemetry is … Free! - [here](https://www.fireeye.com/blog/threat-research/2019/03/silketw-because-free-telemetry-is-free.html)
- SilkETW & SilkService BlackHat Arsenal 2019 - [here](https://github.com/FuzzySecurity/BH-Arsenal-2019)
- Threat Hunting with ETW events and HELK — Part 1: Installing SilkETW (by [@Cyb3rWard0g](https://twitter.com/Cyb3rWard0g)) \- [here](https://medium.com/threat-hunters-forge/threat-hunting-with-etw-events-and-helk-part-1-installing-silketw-6eb74815e4a0)
- Threat Hunting with ETW events and HELK — Part 2: Shipping ETW events to HELK (by [@Cyb3rWard0g](https://twitter.com/Cyb3rWard0g)) \- [here](https://medium.com/threat-hunters-forge/threat-hunting-with-etw-events-and-helk-part-2-shipping-etw-events-to-helk-16837116d2f5)
- Events from all manifest-based and mof-based ETW providers across Windows 10 versions (by [@jdu2600](https://twitter.com/jdu2600)) \- [here](https://github.com/jdu2600/Windows10EtwEvents)
- Hunting for Suspicious LDAP Activity with SilkETW and Yara - [here](https://riccardoancarani.github.io/2019-10-19-hunting-for-domain-enumeration/)

## Implementation Details

[Permalink: Implementation Details](https://github.com/mandiant/SilkETW#implementation-details)

### Libraries

[Permalink: Libraries](https://github.com/mandiant/SilkETW#libraries)

SilkETW is buit on .Net v4.5 and uses a number of 3rd party libraries, as shown below. Please see [LICENSE-3RD-PARTY](https://github.com/mandiant/SilkETW/blob/master/LICENSE-3RD-PARTY.txt) for further details.

```
ModuleId                                 Version LicenseUrl
--------                                 ------- ----------
McMaster.Extensions.CommandLineUtils     2.3.2   https://licenses.nuget.org/Apache-2.0
Microsoft.Diagnostics.Tracing.TraceEvent 2.0.36  https://github.com/Microsoft/perfview/blob/master/LICENSE.TXT
Newtonsoft.Json                          12.0.1  https://licenses.nuget.org/MIT
System.ValueTuple                        4.4.0   https://github.com/dotnet/corefx/blob/master/LICENSE.TXT
YaraSharp                                1.3.1   https://github.com/stellarbear/YaraSharp/blob/master/LICENSE
```

## SilkETW

[Permalink: SilkETW](https://github.com/mandiant/SilkETW#silketw)

### Command Line Options

[Permalink: Command Line Options](https://github.com/mandiant/SilkETW#command-line-options)

Command line usage is fairly straight forward and user input is validated in the execution prologue. See the image below for further details.

[![Help](https://github.com/mandiant/SilkETW/raw/master/Images/help.png)](https://github.com/mandiant/SilkETW/blob/master/Images/help.png)

## SilkService

[Permalink: SilkService](https://github.com/mandiant/SilkETW#silkservice)

### Caveat

[Permalink: Caveat](https://github.com/mandiant/SilkETW#caveat)

SilkService was created because a large number of people wanted to run SilkETW headless and perform ETW collection for multiple sources at the same time. While there is obvious appeal to this, the following points should be kept in mind.

- SilkETW & SilkService were created by a one-man engineering army, ( [@FuzzySec](https://twitter.com/fuzzysec)), they are not backed by a department of developers and as such may contain bugs. If you do encounter bugs or see ways to improve these projects you are strongly encouraged to file tickets and/or submit pull requests.
- ETW collection can be resource intensive. Do not roll out SilkService across a wide range of hosts without thorough performance testing. Ensure that the configuration can run stably on your least powerful machines.

### Setup

[Permalink: Setup](https://github.com/mandiant/SilkETW#setup)

After compiling or downloading the release package you can install the service by issuing the following command from an elevated prompt.

```
sc create SillkService binPath= "C:\Path\To\SilkService.exe" start= demand
```

### Configuration

[Permalink: Configuration](https://github.com/mandiant/SilkETW#configuration)

SilkService ingests an XML configuration file, "SilkServiceConfig.xml", which should be placed in the same directory as the service binary. An example configuration file can be seen below.

```
<SilkServiceConfig>
	<!--
		This is a user collector
		-> Microsoft-Windows-DotNETRuntime
		-> GUID or string based name
	-->
	<ETWCollector>
		<Guid>45c82358-c52d-4892-8237-ba001d396fb4</Guid>
		<CollectorType>user</CollectorType>
		<ProviderName>e13c0d23-ccbc-4e12-931b-d9cc2eee27e4</ProviderName>
		<UserKeywords>0x2038</UserKeywords>
		<OutputType>url</OutputType>
		<Path>https://some.elk:9200/NetETW/_doc/</Path>
	</ETWCollector>
	<!--
		This is a user collector
	-->
	<ETWCollector>
		<Guid>6720babc-dedc-4906-86b9-d0bc0089ec50</Guid>
		<CollectorType>user</CollectorType>
		<ProviderName>Microsoft-Windows-DNS-Client</ProviderName>
		<OutputType>eventlog</OutputType>
		<YaraScan>C:\Some\Path\RuleFolder</YaraScan>
		<YaraOptions>Matches</YaraOptions>
	</ETWCollector>
	<!--
		This is a kernel collector
	-->
	<ETWCollector>
		<Guid>21ac2393-3bbb-4702-a01c-b593e21913dc</Guid>
		<CollectorType>kernel</CollectorType>
		<KernelKeywords>Process</KernelKeywords>
		<OutputType>file</OutputType>
		<Path>C:\Users\b33f\Desktop\kproc.json</Path>
	</ETWCollector>
</SilkServiceConfig>
```

Note that each ETWCollector element should have a random GUID, this is used for internal tracking and logging purposes. You can generate GUID's in PowerShell using the following command:

```
PS C:\> [guid]::NewGuid()

Guid
----
eee52b87-3f32-4651-b0c3-e7bb9af334aa
```

### Auditing

[Permalink: Auditing](https://github.com/mandiant/SilkETW#auditing)

At runtime SilkService will create a "Logs" subfolder to record service runtime information. This is an invaluable resource to poll the service state, verify service parameter validation and review error information. SilkService has a preference to shut down gracefully if it encounters any type of error, even if such an error does not strictly require termination. This design decision was made purposely as it is not a sound strategy to have dangling collectors or partial operability.

**Always consult the service log if the service shuts itself down!**

### Something went wrong?

[Permalink: Something went wrong?](https://github.com/mandiant/SilkETW#something-went-wrong)

It is always possible that something goes wrong. Consult the service log for further details. While SilkService is configured to terminate and clean up ETW collectors or error it is possible that a stale collector remains registered after process termination. To list running collectors you can use the following command.

```
logman -ets
```

If any stale collectors are identified they can be removed by issuing the following commands from an elevated prompt.

```
Get-EtwTraceProvider |Where-Object {$.SessionName -like "SilkService*"} |ForEach-Object {Stop-EtwTraceSession -Name $.SessionName}
Get-EtwTraceProvider |Where-Object {$_.SessionName -like "SilkService*"} |Remove-EtwTraceProvider
```

## Output Format

[Permalink: Output Format](https://github.com/mandiant/SilkETW#output-format)

### JSON Output Structure

[Permalink: JSON Output Structure](https://github.com/mandiant/SilkETW#json-output-structure)

The JSON output, prior to serialization, is formatted according to the following C# struct.

```
public struct EventRecordStruct
{
    public Guid ProviderGuid;
    public List<String> YaraMatch;
    public string ProviderName;
    public string EventName;
    public TraceEventOpcode Opcode;
    public string OpcodeName;
    public DateTime TimeStamp;
    public int ThreadID;
    public int ProcessID;
    public string ProcessName;
    public int PointerSize;
    public int EventDataLength;
    public Hashtable XmlEventData;
}
```

Note that, depending on the provider and the event type, you will have variable data in the XmlEventData hash table. Sample JSON output can be seen below for "Microsoft-Windows-Kernel-Process" -> "ThreadStop/Stop".

```
{
   "ProviderGuid":"22fb2cd6-0e7b-422b-a0c7-2fad1fd0e716",
   "YaraMatch":[\
\
   ],
   "ProviderName":"Microsoft-Windows-Kernel-Process",
   "EventName":"ThreadStop/Stop",
   "Opcode":2,
   "OpcodeName":"Stop",
   "TimeStamp":"2019-03-03T17:58:14.2862348+00:00",
   "ThreadID":11996,
   "ProcessID":8416,
   "ProcessName":"N/A",
   "PointerSize":8,
   "EventDataLength":76,
   "XmlEventData":{
      "FormattedMessage":"Thread 11,996 (in Process 8,416) stopped. ",
      "StartAddr":"0x7fffe299a110",
      "ThreadID":"11,996",
      "UserStackLimit":"0x3d632000",
      "StackLimit":"0xfffff38632d39000",
      "MSec":"560.5709",
      "TebBase":"0x91c000",
      "CycleTime":"4,266,270",
      "ProcessID":"8,416",
      "PID":"8416",
      "StackBase":"0xfffff38632d40000",
      "SubProcessTag":"0",
      "TID":"11996",
      "ProviderName":"Microsoft-Windows-Kernel-Process",
      "PName":"",
      "UserStackBase":"0x3d640000",
      "EventName":"ThreadStop/Stop",
      "Win32StartAddr":"0x7fffe299a110"
   }
}
```

## Post-Collection

[Permalink: Post-Collection](https://github.com/mandiant/SilkETW#post-collection)

### Filter data in PowerShell

[Permalink: Filter data in PowerShell](https://github.com/mandiant/SilkETW#filter-data-in-powershell)

You can import JSON output from SilkETW in PowerShell using the following simple function.

```
function Get-SilkData {
	param($Path)
	$JSONObject = @()
	Get-Content $Path | ForEach-Object {
		$JSONObject += $_ | ConvertFrom-Json
	}
	$JSONObject
}
```

In the example below we will collect process event data from the Kernel provider and use image loads to identify Mimikatz execution. We can collect the required data with the following command.

```
SilkETW.exe -t kernel -kk ImageLoad -ot file -p C:\Users\b33f\Desktop\mimikatz.json
```

With data in hand it is easy to sort, grep and filter for the properties we are interested in.

[![Mimikatz](https://github.com/mandiant/SilkETW/raw/master/Images/mimi.png)](https://github.com/mandiant/SilkETW/blob/master/Images/mimi.png)

### Yara

[Permalink: Yara](https://github.com/mandiant/SilkETW#yara)

SilkETW includes Yara functionality to filter or tag event data. Again, this has obvious defensive capabilities but it can just as easily be used to augment your ETW research.

In this example we will use the following Yara rule to detect Seatbelt execution in memory through Cobalt Strike's execute-assembly.

```
rule Seatbelt_GetTokenInformation
{
	strings:
		$s1 = "ManagedInteropMethodName=GetTokenInformation" ascii wide nocase
		$s2 = "TOKEN_INFORMATION_CLASS" ascii wide nocase
		$s3 = /bool\(native int,valuetype \w+\.\w+\/\w+,native int,int32,int32&/
		$s4 = "locals (int32,int64,int64,int64,int64,int32& pinned,bool,int32)" ascii wide nocase

	condition:
		all of ($s*)
}
```

We can start collecting .Net ETW data with the following command. The "-yo" option here indicates that we should only write Yara matches to disk!

```
SilkETW.exe -t user -pn Microsoft-Windows-DotNETRuntime -uk 0x2038 -l verbose -y C:\Users\b33f\Desktop\yara -yo matches -ot file -p C:\Users\b33f\Desktop\yara.json
```

We can see at runtime that our Yara rule was hit.

[![Seatbelt](https://github.com/mandiant/SilkETW/raw/master/Images/seatbelt.png)](https://github.com/mandiant/SilkETW/blob/master/Images/seatbelt.png)

Note also that we are only capturing a subset of the "Microsoft-Windows-DotNETRuntime" events (0x2038), specifically: JitKeyword, InteropKeyword, LoaderKeyword and NGenKeyword.

## How to get SilkETW & SilkService?

[Permalink: How to get SilkETW & SilkService?](https://github.com/mandiant/SilkETW#how-to-get-silketw--silkservice)

You can either download the source and compile it in Visual Studio. Please note that you can get the community edition of Visual Studio free of charge. Or you can grab the latest pre-built version from [releases](https://github.com/fireeye/SilkETW/releases).

## Future Work

[Permalink: Future Work](https://github.com/mandiant/SilkETW#future-work)

### Changelog

[Permalink: Changelog](https://github.com/mandiant/SilkETW#changelog)

For details on version specific changes, please refer to the [Changelog](https://github.com/mandiant/SilkETW/blob/master/Changelog.txt).

### RoadMap

[Permalink: RoadMap](https://github.com/mandiant/SilkETW#roadmap)

- Offer users the option to write trace data to disk as \*.etl files.
- ~~Offer users the option to write trace data to the Windows event log.~~ **(v0.5+)**
- ~~Offer users pre-compiled releases.~~ **(v0.6+)**
- ~~Create a separate instance (SilkService) which can be deployed as a service with a configuration file.~~ **(v0.7+)**
- Suggestions welcome!

## About

No description, website, or topics provided.


### Resources

[Readme](https://github.com/mandiant/SilkETW#readme-ov-file)

### License

[Apache-2.0 license](https://github.com/mandiant/SilkETW#Apache-2.0-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/mandiant/SilkETW).

[Activity](https://github.com/mandiant/SilkETW/activity)

[Custom properties](https://github.com/mandiant/SilkETW/custom-properties)

### Stars

[**823**\\
stars](https://github.com/mandiant/SilkETW/stargazers)

### Watchers

[**40**\\
watching](https://github.com/mandiant/SilkETW/watchers)

### Forks

[**135**\\
forks](https://github.com/mandiant/SilkETW/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fmandiant%2FSilkETW&report=mandiant+%28user%29)

## [Releases\  3](https://github.com/mandiant/SilkETW/releases)

[Compiled package for v0.8\\
Latest\\
\\
on Sep 13, 2019Sep 13, 2019](https://github.com/mandiant/SilkETW/releases/tag/v0.8)

[\+ 2 releases](https://github.com/mandiant/SilkETW/releases)

## [Packages\  0](https://github.com/orgs/mandiant/packages?repo_name=SilkETW)

No packages published

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/mandiant/SilkETW).

## Languages

- [C#100.0%](https://github.com/mandiant/SilkETW/search?l=c%23)

You can’t perform that action at this time.