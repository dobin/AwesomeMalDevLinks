# https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/

<!DOCTYPE html><html class="transition bg-[var(--page-bg)] md:text-[16px] text-[14px] dark swup-enabled" data-astro-cid-sckkx6r4="" data-overlayscrollbars-initialize="" lang="en" style="--bannerOffset: 15vh; --banner-height-home: 65vh; --banner-height: 35vh; --configHue: 235; --page-width: 75rem; --hue: 235; --banner-height-extend: 296px; --hue-hl: 97;" data-overlayscrollbars="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYScroll"><body class="transition min-h-screen" data-astro-cid-sckkx6r4="" data-overlayscrollbars-initialize="" style="--bannerOffset:15vh;--banner-height-home:65vh;--banner-height:35vh;--configHue:235;--page-width:75rem"><div id="config-carrier" data-hue="235"></div><div class="transition-all duration-700 max-w-[var(--page-width)] md:px-4 mx-auto pointer-events-none px-0 relative z-50" id="top-row"><div class="transition-all pointer-events-auto sticky top-0" id="navbar-wrapper"><div class="onload-animation z-50" id="navbar"><div class="transition absolute -top-8 bg-[var(--card-bg)] h-8 left-0 right-0"></div><div class="flex items-center justify-between !overflow-visible !rounded-t-none card-base h-[4.5rem] max-w-[var(--page-width)] mx-auto pt-4 px-4"><a href="https://labs.infoguard.ch/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-[3.25rem] mb-2"><div class="mr-24 relative"><svg height="50" width="50" class="stroke-[#FFDC00] stroke-[5]" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg" fill="none"><circle cx="25" cy="25" r="22.5"></circle></svg><div class="absolute top-0 left-[60px]"><svg height="13" width="72" class="fill-[#A0A0A0]" viewBox="0 0 85 15" xmlns="http://www.w3.org/2000/svg"><path d="M54.918 3.90489V14.1256H52.3377V12.8975C51.561 13.8612 50.6015 14.331 49.417 14.331C47.1621 14.331 45.7602 12.8114 45.7602 10.3672V3.90489H48.3211V9.69047C48.3211 11.1406 49.0152 11.9382 50.2731 11.9382C51.5311 11.9382 52.3362 11.0621 52.3362 9.65119V3.90489H54.918ZM64.5795 4.92605C65.3157 5.64811 65.6875 6.71459 65.6875 8.09679V14.1271H63.1821V13.1286C62.392 13.9186 61.344 14.3325 60.1311 14.3325C58.3799 14.3325 56.4938 13.3265 56.4938 11.1195V11.0817C56.4938 8.98653 58.0695 7.73576 60.7083 7.73576C61.8013 7.73576 62.5824 7.90796 63.2001 8.09377V8.05902C63.2001 6.4019 61.9557 6.05446 60.9122 6.05446C59.8687 6.05446 59.0261 6.29767 58.158 6.66172L58.0066 6.72517L57.9541 6.56958L57.3573 4.78556L57.3124 4.65263L57.4398 4.59523C58.3829 4.16924 59.4924 3.77347 61.2106 3.77347C62.6859 3.77347 63.8508 4.17226 64.578 4.92605H64.5795ZM63.2376 10.405V9.83548C62.7833 9.66932 62.0757 9.48805 61.1551 9.48805C59.7847 9.48805 58.9976 10.0334 58.9976 10.9866V11.0243C58.9976 11.8431 59.6903 12.3718 60.7638 12.3718C62.1971 12.3718 63.2376 11.544 63.2376 10.405ZM73.7103 3.71757L73.8572 3.72362V6.42909H73.5738C71.5393 6.42909 70.3743 7.80222 70.3743 10.198V14.1271H67.8135V3.90489H70.3743V5.62697C71.082 4.37166 72.1615 3.71455 73.5273 3.71455C73.5888 3.71455 73.6503 3.71455 73.7118 3.71908L73.7103 3.71757ZM85 0.111784V14.1256H82.4392V12.7736C81.5771 13.8204 80.5261 14.331 79.2397 14.331C76.9518 14.331 74.5214 12.4745 74.5214 9.03336V8.99559C74.5214 5.51669 76.8963 3.69794 79.2397 3.69794C80.5231 3.69794 81.5726 4.17982 82.4392 5.16623V0.111784H85ZM82.4767 9.03336V8.99559C82.4767 7.27502 81.3162 5.97742 79.7794 5.97742C78.2426 5.97742 77.1002 7.21913 77.1002 8.99559V9.03336C77.1002 10.7539 78.2516 12.0515 79.7794 12.0515C81.1048 12.0515 82.4767 10.9216 82.4767 9.03336ZM3.21708e-05 0.117806L0 14.1256H2.56081L2.56084 0.117806H3.21708e-05ZM10.2852 3.69794C9.10677 3.69794 8.14721 4.16471 7.36458 5.12092V3.90489H4.80377V14.1256H7.36458V8.37625C7.36458 6.97593 8.1742 6.07108 9.42912 6.07108C10.684 6.07108 11.3812 6.87623 11.3812 8.33848V14.1241H13.942V7.64361C13.942 5.21004 12.5417 3.69643 10.2867 3.69643L10.2852 3.69794ZM32.7373 8.99559V9.03336C32.7373 12.0153 30.3549 14.3491 27.3128 14.3491C24.2707 14.3491 21.9423 12.0304 21.9423 9.06961V9.03185C21.9423 6.03936 24.3172 3.69643 27.3503 3.69643C30.3834 3.69643 32.7388 6.02425 32.7388 8.99408L32.7373 8.99559ZM24.5031 9.03336C24.5031 10.7267 25.7535 12.0515 27.3488 12.0515C28.9441 12.0515 30.1765 10.7977 30.1765 9.07112V9.03336C30.1765 7.30222 28.9456 5.99706 27.3113 5.99706C25.6771 5.99706 24.5016 7.25841 24.5016 8.9971V9.03487L24.5031 9.03336ZM19.5944 0C18.5869 0 17.8252 0.273418 17.269 0.833848C16.7082 1.40032 16.4234 2.25834 16.4234 3.38373V3.96078H15.1744V6.16625H16.4234V14.1256H18.9842V6.16625H21.5555V3.98042H18.9467V3.59068C18.9467 2.67224 19.3125 2.24323 20.0982 2.24323C20.5719 2.24323 20.9498 2.33689 21.3726 2.4804L21.575 2.54686V0.302119L21.4655 0.268886C21.0187 0.135954 20.449 0 19.5959 0H19.5944ZM33.7043 5.88226C34.1211 3.88525 35.9788 2.43055 37.9174 2.43055C39.5456 2.43055 40.4842 2.95472 41.4707 3.80217L41.5877 3.90338L41.6866 3.78404L43.1395 2.0393L43.2369 1.92148L43.12 1.82178C41.6072 0.527198 40.1274 0 38.0118 0C35.526 0 33.0162 1.45319 31.8017 3.54537C32.5994 4.17226 33.2501 4.96835 33.7043 5.88226ZM43.5728 6.47592V12.2207L43.5188 12.2675C42.4153 13.2177 40.5577 14.3507 37.9789 14.3507C36.1722 14.3507 34.5919 13.7948 33.3685 12.7419C33.9037 11.8899 34.2561 10.9125 34.376 9.85512C35.0972 11.1452 36.4121 11.9397 38.0538 11.9397C39.1513 11.9397 40.2368 11.6059 41.0479 11.0213V8.79468H37.7135V6.47743H43.5713L43.5728 6.47592Z"></path></svg> <span class="-mt-1.5 dark:text-white inline-block text-[#575757] text-[1.2rem]">LABS</span></div></div></a><div class="hidden md:flex"><a href="https://labs.infoguard.ch/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Home"><div class="flex items-center">Home</div></a><a href="https://labs.infoguard.ch/posts/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Posts"><div class="flex items-center">Posts</div></a><a href="https://labs.infoguard.ch/velociraptor/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Velociraptor"><div class="flex items-center">Velociraptor</div></a><a href="https://labs.infoguard.ch/advisories/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Advisories"><div class="flex items-center">Advisories</div></a><a href="https://labs.infoguard.ch/archive/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Archive"><div class="flex items-center">Archive</div></a><a href="https://infoguard.ch/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="InfoGuard" target="_blank"><div class="flex items-center">InfoGuard <svg height="1em" width="1em" class="transition -translate-y-[1px] dark:text-white/[0.2] ml-1 text-[0.875rem] text-black/[0.2]" data-icon="fa6-solid:arrow-up-right-from-square"><symbol id="ai:fa6-solid:arrow-up-right-from-square" viewBox="0 0 512 512"><path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32zM80 32C35.8 32 0 67.8 0 112v320c0 44.2 35.8 80 80 80h320c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v112c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16h112c17.7 0 32-14.3 32-32s-14.3-32-32-32z" fill="currentColor"></path></symbol><use href="#ai:fa6-solid:arrow-up-right-from-square"></use></svg></div></a></div><div class="flex"><astro-island client="only" component-export="default" component-url="/_astro/Search.DlUmB71x.js" opts="{&quot;name&quot;:&quot;Search&quot;,&quot;value&quot;:&quot;svelte&quot;}" props="{}" renderer-url="/_astro/client.svelte.DYqRqnAG.js" uid="ZEG73h"><div id="search-bar" class="hidden lg:flex transition-all items-center h-11 mr-2 rounded-lg
      bg-black/[0.04] hover:bg-black/[0.06] focus-within:bg-black/[0.06]
      dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10
"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"></path><!----></svg><!----> <input class="transition-all pl-10 text-sm bg-transparent outline-0
         h-full w-40 active:w-60 focus:w-60 text-black/50 dark:text-white/50 svelte-1gu5h8y" placeholder="Search"></div> <button aria-label="Search Panel" id="search-switch" class="btn-plain scale-animation lg:!hidden rounded-lg w-11 h-11 active:scale-90"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"></path><!----></svg><!----></button> <div id="search-panel" class="float-panel float-panel-closed search-panel absolute md:w-[30rem] top-20 left-4 md:left-[unset] right-4 shadow-2xl rounded-2xl p-2"><div id="search-bar-inside" class="flex relative lg:hidden transition-all items-center h-11 rounded-xl
      bg-black/[0.04] hover:bg-black/[0.06] focus-within:bg-black/[0.06]
      dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10
  "><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"></path><!----></svg><!----> <input placeholder="Search" class="pl-10 absolute inset-0 text-sm bg-transparent outline-0
               focus:w-60 text-black/50 dark:text-white/50 svelte-1gu5h8y"></div> <!----></div></astro-island><astro-island client="load" component-export="default" component-url="/_astro/LightDarkSwitch.gKnghUdE.js" opts="{&quot;name&quot;:&quot;LightDarkSwitch&quot;,&quot;value&quot;:true}" props="{}" renderer-url="/_astro/client.svelte.DYqRqnAG.js" uid="2ad1lD" await-children=""><div class="relative z-50" role="menu" tabindex="-1"><button aria-label="Light/Dark Mode" role="menuitem" class="relative btn-plain scale-animation rounded-lg h-11 w-11 active:scale-90" id="scheme-switch"><div class="absolute opacity-0"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M11 3V2q0-.425.288-.712T12 1t.713.288T13 2v1q0 .425-.288.713T12 4t-.712-.288T11 3m0 19v-1q0-.425.288-.712T12 20t.713.288T13 21v1q0 .425-.288.713T12 23t-.712-.288T11 22m11-9h-1q-.425 0-.712-.288T20 12t.288-.712T21 11h1q.425 0 .713.288T23 12t-.288.713T22 13M3 13H2q-.425 0-.712-.288T1 12t.288-.712T2 11h1q.425 0 .713.288T4 12t-.288.713T3 13m16.75-7.325l-.35.35q-.275.275-.687.275T18 6q-.275-.275-.288-.687t.263-.713l.375-.375q.275-.3.7-.3t.725.3t.288.725t-.313.725M6.025 19.4l-.375.375q-.275.3-.7.3t-.725-.3t-.288-.725t.313-.725l.35-.35q.275-.275.688-.275T6 18q.275.275.288.688t-.263.712m12.3.35l-.35-.35q-.275-.275-.275-.687T18 18q.275-.275.688-.287t.712.262l.375.375q.3.275.3.7t-.3.725t-.725.288t-.725-.313M4.6 6.025l-.375-.375q-.3-.275-.3-.7t.3-.725t.725-.288t.725.313l.35.35q.275.275.275.688T6 6q-.275.275-.687.288T4.6 6.025M7.75 16.25Q6 14.5 6 12t1.75-4.25T12 6t4.25 1.75T18 12t-1.75 4.25T12 18t-4.25-1.75m7.088-1.412Q16 13.675 16 12t-1.162-2.838T12 8T9.162 9.163T8 12t1.163 2.838T12 16t2.838-1.162M12 12"></path><!----></svg><!----></div> <div class="absolute"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-3.775 0-6.387-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.325-.05.575.088t.4.362t.163.525t-.188.575q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.275-.175.563-.162t.512.137q.25.125.388.375t.087.6q-.35 3.45-2.937 5.725T12 21m0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19m-.25-6.75"></path><!----></svg><!----></div> <div class="absolute opacity-0"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 17V7Q9.925 7 8.463 8.463T7 12t1.463 3.538T12 17m0 5q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"></path><!----></svg><!----></div></button> <div id="light-dark-panel" class="hidden lg:block absolute transition float-panel-closed top-11 -right-2 pt-5"><div class="card-base float-panel p-2"><button class="flex transition whitespace-nowrap items-center !justify-start w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95 mb-0.5"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] mr-3 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M11 3V2q0-.425.288-.712T12 1t.713.288T13 2v1q0 .425-.288.713T12 4t-.712-.288T11 3m0 19v-1q0-.425.288-.712T12 20t.713.288T13 21v1q0 .425-.288.713T12 23t-.712-.288T11 22m11-9h-1q-.425 0-.712-.288T20 12t.288-.712T21 11h1q.425 0 .713.288T23 12t-.288.713T22 13M3 13H2q-.425 0-.712-.288T1 12t.288-.712T2 11h1q.425 0 .713.288T4 12t-.288.713T3 13m16.75-7.325l-.35.35q-.275.275-.687.275T18 6q-.275-.275-.288-.687t.263-.713l.375-.375q.275-.3.7-.3t.725.3t.288.725t-.313.725M6.025 19.4l-.375.375q-.275.3-.7.3t-.725-.3t-.288-.725t.313-.725l.35-.35q.275-.275.688-.275T6 18q.275.275.288.688t-.263.712m12.3.35l-.35-.35q-.275-.275-.275-.687T18 18q.275-.275.688-.287t.712.262l.375.375q.3.275.3.7t-.3.725t-.725.288t-.725-.313M4.6 6.025l-.375-.375q-.3-.275-.3-.7t.3-.725t.725-.288t.725.313l.35.35q.275.275.275.688T6 6q-.275.275-.687.288T4.6 6.025M7.75 16.25Q6 14.5 6 12t1.75-4.25T12 6t4.25 1.75T18 12t-1.75 4.25T12 18t-4.25-1.75m7.088-1.412Q16 13.675 16 12t-1.162-2.838T12 8T9.162 9.163T8 12t1.163 2.838T12 16t2.838-1.162M12 12"></path><!----></svg><!----> Light</button> <button class="flex transition whitespace-nowrap items-center !justify-start w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95 mb-0.5 current-theme-btn"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] mr-3 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-3.775 0-6.387-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.325-.05.575.088t.4.362t.163.525t-.188.575q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.275-.175.563-.162t.512.137q.25.125.388.375t.087.6q-.35 3.45-2.937 5.725T12 21m0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19m-.25-6.75"></path><!----></svg><!----> Dark</button> <button class="flex transition whitespace-nowrap items-center !justify-start w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] mr-3 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 17V7Q9.925 7 8.463 8.463T7 12t1.463 3.538T12 17m0 5q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"></path><!----></svg><!----> System</button></div></div></div></astro-island><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 md:!hidden" aria-label="Menu" id="nav-menu-switch" name="Nav Menu"><svg height="1em" width="1em" class="text-[1.25rem]" data-icon="material-symbols:menu-rounded"><symbol id="ai:material-symbols:menu-rounded" viewBox="0 0 24 24"><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:menu-rounded"></use></svg></button></div><div class="absolute float-panel-closed fixed float-panel px-2 py-2 right-4 transition-all" id="nav-menu-panel"><a href="https://labs.infoguard.ch/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Home</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded"><symbol id="ai:material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><path d="M12.6 12L8.7 8.1q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://labs.infoguard.ch/posts/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Posts</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://labs.infoguard.ch/velociraptor/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Velociraptor</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://labs.infoguard.ch/advisories/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Advisories</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://labs.infoguard.ch/archive/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Archive</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://infoguard.ch/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2" target="_blank"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">InfoGuard</div><svg height="1em" width="1em" class="transition -translate-x-1 dark:text-white/25 text-[0.75rem] text-black/25" data-icon="fa6-solid:arrow-up-right-from-square" viewBox="0 0 512 512"><use href="#ai:fa6-solid:arrow-up-right-from-square"></use></svg></a></div><astro-island client="only" component-export="default" component-url="/_astro/DisplaySettings.KStfPvg9.js" opts="{&quot;name&quot;:&quot;DisplaySettings&quot;,&quot;value&quot;:&quot;svelte&quot;}" props="{}" renderer-url="/_astro/client.svelte.DYqRqnAG.js" uid="ZjfqNG"><div id="display-setting" class="float-panel float-panel-closed absolute transition-all w-80 right-4 px-4 py-4 svelte-1s19bex"><div class="flex flex-row gap-2 mb-3 items-center justify-between"><div class="flex gap-2 font-bold text-lg text-neutral-900 dark:text-neutral-100 transition relative ml-3
            before:w-1 before:h-4 before:rounded-md before:bg-[var(--primary)]
            before:absolute before:-left-3 before:top-[0.33rem]">Theme Color <button aria-label="Reset to Default" class="btn-regular w-7 h-7 rounded-md active:scale-90 opacity-0 pointer-events-none"><div class="text-[var(--btn-content)]"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[0.875rem] iconify iconify--fa6-solid" width="1em" height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M125.7 160H176c17.7 0 32 14.3 32 32s-14.3 32-32 32H48c-17.7 0-32-14.3-32-32V64c0-17.7 14.3-32 32-32s32 14.3 32 32v51.2l17.6-17.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0z"></path><!----></svg><!----></div></button></div> <div class="flex gap-1"><div id="hueValue" class="transition bg-[var(--btn-regular-bg)] w-10 h-7 rounded-md flex justify-center
            font-bold text-sm items-center text-[var(--btn-content)]">235</div></div></div> <div class="w-full h-6 px-1 bg-[oklch(0.80_0.10_0)] dark:bg-[oklch(0.70_0.10_0)] rounded select-none"><input type="range" min="0" max="360" class="slider svelte-1s19bex" id="colorSlider" step="5" style="width: 100%" aria-label="Theme Color"></div></div></astro-island></div></div></div></div><div class="absolute pointer-events-none w-full z-30" style="top:5.5rem"><div class="mx-auto max-w-[var(--page-width)] relative pointer-events-auto"><div class="transition left-0 right-0 duration-700 gap-4 grid grid-cols-[17.5rem_auto] grid-rows-[auto_1fr_auto] lg:grid-rows-[auto] md:px-4 mx-auto px-0 w-full" id="main-grid"><main class="overflow-hidden col-span-2 lg:col-span-1 transition-swup-fade" id="swup-container"><div class="onload-animation" id="content-wrapper"><div class="flex w-full relative mb-4 overflow-hidden rounded-[var(--radius-large)]"><div class="card-base pb-4 md:px-9 pt-6 px-6 relative w-full z-10" id="post-container"><div class="transition flex dark:text-white/30 flex-row gap-5 mb-3 onload-animation text-black/30"><div class="flex items-center"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg height="1em" width="1em" class="text-xl" data-icon="material-symbols:calendar-today-outline-rounded"><symbol id="ai:material-symbols:calendar-today-outline-rounded" viewBox="0 0 24 24"><path d="M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5zM5 8h14V6H5zm0 0V6z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:calendar-today-outline-rounded"></use></svg></div><div class="text-sm">2025-02-10</div></div><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg height="1em" width="1em" data-icon="material-symbols:notes-rounded"><symbol id="ai:material-symbols:notes-rounded" viewBox="0 0 24 24"><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h10q.425 0 .713.288T15 17t-.288.713T14 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:notes-rounded"></use></svg></div><div class="text-sm">2340 words</div></div><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg height="1em" width="1em" data-icon="material-symbols:schedule-outline-rounded"><symbol id="ai:material-symbols:schedule-outline-rounded" viewBox="0 0 24 24"><path d="M13 11.6V8q0-.425-.288-.712T12 7t-.712.288T11 8v3.975q0 .2.075.388t.225.337l3.3 3.3q.275.275.7.275T16 16t.275-.7t-.275-.7zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.325 0 5.663-2.337T20 12t-2.337-5.663T12 4T6.337 6.338T4 12t2.338 5.663T12 20" fill="currentColor"></path></symbol><use href="#ai:material-symbols:schedule-outline-rounded"></use></svg></div><div class="text-sm">12 minutes</div></div></div><div class="onload-animation relative"><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-5 before:left-[-1.125rem] before:top-[0.75rem] block dark:text-white/90 mb-3 md:before:w-1 md:text-[2.25rem]/[2.75rem] text-3xl text-black/90 w-full" data-pagefind-body="" data-pagefind-meta="title" data-pagefind-weight="10">Attacking EDRs Part 1: Intro &amp; Security Analysis of EDR Drivers</div></div><div class="onload-animation"><div class="flex items-center dark:text-neutral-400 flex-wrap gap-4 gap-x-4 gap-y-2 mb-5 text-neutral-500"><div class="flex items-center"><div class="meta-icon"><svg height="1em" width="1em" class="text-xl" data-icon="material-symbols:person-outline"><symbol id="ai:material-symbols:person-outline" viewBox="0 0 24 24"><path d="M12 12q-1.65 0-2.825-1.175T8 8t1.175-2.825T12 4t2.825 1.175T16 8t-1.175 2.825T12 12m-8 8v-2.8q0-.85.438-1.562T5.6 14.55q1.55-.775 3.15-1.162T12 13t3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20zm2-2h12v-.8q0-.275-.137-.5t-.363-.35q-1.35-.675-2.725-1.012T12 15t-2.775.338T6.5 16.35q-.225.125-.363.35T6 17.2zm6-8q.825 0 1.413-.587T14 8t-.587-1.412T12 6t-1.412.588T10 8t.588 1.413T12 10m0 8" fill="currentColor"></path></symbol><use href="#ai:material-symbols:person-outline"></use></svg></div><a href="https://twitter.com/p0w1_" class="transition flex items-center font-medium whitespace-nowrap dark:hover:text-[var(--primary)] gap-1 hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="X profile of Manuel Feifel" target="_blank" rel="noopener noreferrer"><span>Manuel Feifel </span><svg height="1em" width="1em" class="text-lg" data-icon="fa6-brands:x-twitter"><symbol id="ai:fa6-brands:x-twitter" viewBox="0 0 512 512"><path d="M389.2 48h70.6L305.6 224.2L487 464H345L233.7 318.6L106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z" fill="currentColor"></path></symbol><use href="#ai:fa6-brands:x-twitter"></use></svg></a></div><div class="flex items-center"><div class="meta-icon"><svg height="1em" width="1em" class="text-xl" data-icon="material-symbols:book-2-outline-rounded"><symbol id="ai:material-symbols:book-2-outline-rounded" viewBox="0 0 24 24"><path d="M6 15.325q.35-.175.725-.25T7.5 15H8V4h-.5q-.625 0-1.062.438T6 5.5zM10 15h8V4h-8zm-4 .325V4zM7.5 22q-1.45 0-2.475-1.025T4 18.5v-13q0-1.45 1.025-2.475T7.5 2H18q.825 0 1.413.587T20 4v12.525q0 .2-.162.363t-.588.362q-.35.175-.55.5t-.2.75t.2.763t.55.487t.55.413t.2.562v.25q0 .425-.288.725T19 22zm0-2h9.325q-.15-.35-.237-.712T16.5 18.5q0-.4.075-.775t.25-.725H7.5q-.65 0-1.075.438T6 18.5q0 .65.425 1.075T7.5 20" fill="currentColor"></path></symbol><use href="#ai:material-symbols:book-2-outline-rounded"></use></svg></div><div class="flex items-center flex-row flex-nowrap"><a href="https://labs.infoguard.ch/archive/category/Vulnerability%20Research/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts in the Vulnerability Research category">Vulnerability Research</a></div></div><div class="flex items-center"><div class="meta-icon"><svg height="1em" width="1em" class="text-xl" data-icon="material-symbols:tag-rounded"><symbol id="ai:material-symbols:tag-rounded" viewBox="0 0 24 24"><path d="m9 16l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T6.3 18.8L7 16H4.275q-.5 0-.8-.387T3.3 14.75q.075-.35.35-.55t.625-.2H7.5l1-4H5.775q-.5 0-.8-.387T4.8 8.75q.075-.35.35-.55t.625-.2H9l.825-3.275Q9.9 4.4 10.15 4.2t.6-.2q.475 0 .775.375t.175.825L11 8h4l.825-3.275q.075-.325.325-.525t.6-.2q.475 0 .775.375t.175.825L17 8h2.725q.5 0 .8.387t.175.863q-.075.35-.35.55t-.625.2H16.5l-1 4h2.725q.5 0 .8.388t.175.862q-.075.35-.35.55t-.625.2H15l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T12.3 18.8L13 16zm.5-2h4l1-4h-4z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:tag-rounded"></use></svg></div><div class="flex items-center flex-row flex-nowrap"><div class="hidden mx-1.5 text-[var(--meta-divider)] text-sm">/</div><a href="https://labs.infoguard.ch/archive/tag/VulnResearch/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts with the VulnResearch tag">VulnResearch</a><div class="mx-1.5 text-[var(--meta-divider)] text-sm">/</div><a href="https://labs.infoguard.ch/archive/tag/RedTeaming/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts with the RedTeaming tag">RedTeaming</a><div class="mx-1.5 text-[var(--meta-divider)] text-sm">/</div><a href="https://labs.infoguard.ch/archive/tag/EDR/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts with the EDR tag">EDR</a></div></div></div></div><img alt="Attacking EDRs Part 1: Intro &amp; Security Analysis of EDR Drivers" decoding="async" height="507" loading="lazy" src="https://labs.infoguard.ch/_astro/cortex_permissions.C0F1HuvN_zpRlX.webp" width="540" class="onload-animation banner-container mb-8 rounded-xl" id="post-cover"><div class="onload-animation mb-6 !max-w-none custom-md dark:prose-invert markdown-content prose prose-base" data-pagefind-body=""><p>This blog post is part of a series analyzing attack surface for Endpoint Detection and Response (EDR) solutions. Parts 1-3 are linked, with concluding notes for that initial sub-series in Part 3.</p><ul><li><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/">Part 1</a> (<strong>this article</strong>) gives an overview of the attack surface of EDR software and describes the process for analysing drivers from the perspective of a low-privileged user.</li><li><a href="https://labs.infoguard.ch/posts/edr_part2_driver_analysis_results/">Part 2</a> describes the results of the EDR driver security analysis. A minor authentication issue in the Windows driver of the Cortex XDR agent was identified (CVE-2024-5905). Additionally a PPL-”bypass” as well as a detection bypass by early startup. Furthermore, snapshot fuzzing was applied to a Mini-Filter Communication Port of the Sophos Intercept X Windows Mini-Filter driver.</li><li><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/">Part 3</a> describes a DoS vulnerability affecting most Windows EDR agents. This vulnerability allows a low-privileged user to crash/stop the agent permanently by exploiting an issue in how the agent handles preexisting objects in the Object Manager’s namespace. Only some vendors assigned a CVE (CVE-2023-3280, CVE-2024-5909, CVE-2024-20671).</li><li><a href="https://labs.infoguard.ch/posts/attacking_edr_part4_fuzzing_defender_scanning_and_emulation_engine">Part 4</a> describes the fuzzing process of Microsoft Defender’s scanning and emulation engine <code>mpengine.dll</code>. Multiple out-of-bounds read and null dereference bugs were identified by using Snapshot Fuzzing with WTF and kAFL/NYX. These bugs can be used to crash the main Defender process as soon as the file is scanned. None of the bugs appear to be exploitable for code execution.</li></ul><section><h1 id="1-introduction">1. Introduction<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#1-introduction" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h1><p>In today’s organizations, Endpoint Detection and Response (EDR) solutions have become an essential part of the cybersecurity landscape. Despite their prevalence, there remains a notable lack of published research focusing on attacks against EDR applications themselves, even though they present compelling targets for privilege escalation, corporate network compromise, or drive-by attacks. This could have several reasons: limited security research in this specific area, unpublished research held back for red-teaming advantages, or a lack of fruitful findings. Futhermore, there are only a few vendors which have a Bug Bounty program and if they have one, the Windows agents are not in scope (except Kaspersky).<br>In recent years, most security research about EDRs focused on techniques to bypass the security measures such as DLL unhooking. Recognizing this gap, a research project of IG Labs aimed to analyze the attack surface of drivers for widely-used EDRs on Windows. However, after starting the work and before publication of this post, some research into directly attacking EDRs has emerged (<a href="https://www.srlabs.de/blog-post/edrs-decrease-your-enterprise-security-unless-properly-hardened">1</a>, <a href="https://medium.com/falconforce/debugging-the-undebuggable-and-finding-a-cve-in-microsoft-defender-for-endpoint-ce36f50bb31">2</a>, <a href="https://riccardoancarani.github.io/2023-08-03-attacking-an-edr-part-1/">3</a>, <a href="https://riccardoancarani.github.io/2023-09-14-attacking-an-edr-part-2/">4</a>, <a href="https://riccardoancarani.github.io/2023-11-07-attacking-an-edr-part-3/">5</a>, …).</p><p>Due to the extensive attack surface of EDRs, we decided to limit the scope of our investigation to driver-interfaces accessible by a low privileged user as an entry point.<br>EDRs typically incorporate self-protection mechanisms that prevent even local administrators from disabling or uninstalling the product. However, the transition from local administrator to SYSTEM to kernel in Windows, while restricted by security features, does not represent an absolute security boundary. Known methods exist to deactivate or bypass EDRs, including bring-your-own-vulnerable-driver (BYOVD) attacks, Windows Defender Application Control (WDAC), WPF filtering, and other techniques. Consequently, this research focused on low-privileged users, even though attacks from a local administrator can also be valuable.</p><p>Additionally, the focus is directed towards the most used EDRs in the market.<br>However, obtaining access to these EDR solutions for research purposes is challenging. Only a very limited number of vendors offer trial products without prior vetting, further narrowing the range of EDRs that can be analyzed.</p><p><img alt="" decoding="async" height="813" loading="lazy" src="https://labs.infoguard.ch/_astro/crowdstrike_trial.COakFYqf_aog6I.webp" width="1650"></p><p class="figcaption">Typical “trial” (which you will never get without having the right business)</p><p></p><p>Although several EDR drivers permit low-privileged users to access certain functions, it was not possible to detect any serious security issues. Nevertheless, the blog post describes the analysis process including research paths that yielded no findings to help other security researchers. However, after some time a path led to the ALPC communication in PaloAlto Cortex which was not the initial focus. This revealed a DoS vulnerability that is described in <a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/">Part 3</a>.</p><p><strong>The following products were initially examined for the driver analysis:</strong></p><ul><li>Palo Alto Cortex XDR</li><li>Sophos Intercept X</li><li>Microsoft Defender for Endpoint</li><li>Cynet 360</li><li>Tanium (not really an EDR but the functionality and architecture is similar)</li></ul><section><h2 id="11-attack-surface-of-edr-solutions">1.1 Attack Surface of EDR solutions<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#11-attack-surface-of-edr-solutions" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>EDR solutions have a comparably large attack surface for applications. These solutions typically consist of multiple components on the agents themselves and cloud services, while some vendors also offer on-premise servers. EDRs are designed to detect and respond to threats at the endpoint level, but they also inherently create a new attack surface that can be exploited by malicious actors. The agents are a complex part and consequently more prone to vulnerabilities. The frontend of the servers-side part, in contrast has a smaller and usually more explored attack surface (at least the part which is directly accessible by a user such as the web interfaces). Even backend web APIs have basic flaws such as missing authentication as shown <a href="https://medium.com/falconforce/debugging-the-undebuggable-and-finding-a-cve-in-microsoft-defender-for-endpoint-ce36f50bb31">here</a>. Some products also use a <a href="https://github.com/tux3/crowdstrike-cloudproto">custom protocol</a> for the agent-to-cloud communication which could be interesting, too. Furthermore, certain products also implement P2P-communication among the agents (e.g. Tanium) which are interesting from an attacker point of perspective.</p><p><strong>These blog posts focuses solely on the agent side.</strong></p><p>Agents typically consist of user-space and kernel-space (driver) components:</p><ul><li>Filter Driver</li><li>Network Drivers</li><li>Software Driver</li><li>Userland Applications</li></ul><p>These components primarily communicate with each other using the following protocols and methods:</p><ul><li>Kernel-to-Kernel:<ul><li>Exported functions</li><li>IOCTLs</li></ul></li><li>User-to-Kernel:<ul><li>IOCTLs</li><li>FilterConnectionPorts<ul><li>specifically used by minifilter drivers</li><li>uses IOCTLs under the hood as well</li></ul></li><li>ALPC</li></ul></li><li>User-to-User<ul><li>ALPC</li><li>Named Pipes</li><li>Files</li><li>Registry</li><li><a href="https://learn.microsoft.com/en-us/windows/win32/ipc/interprocess-communications">more…</a></li></ul></li></ul><p>The following list outlines potential vulnerabilities within these components and their communication. Note that this list is not exhaustive and excludes all server-side attack surface:</p><ul><li>Memory corruptions in file scanning &amp; emulation (In-the-wild 0day <a href="https://googleprojectzero.github.io/0days-in-the-wild/0day-RCAs/2021/CVE-2021-1647.html">CVE-2021-1647</a>)</li><li>Deletion of arbitrary files (SymLink-Vulns)<ul><li>Plenty of vulnerabilities in the past: <a href="https://www.blackhat.com/eu-22/briefings/schedule/index.html?#aikido-turning-edrs-to-malicious-wipers-using--day-exploits-29336">Deleting files “wiper”</a> (50% of tested EDRs vulnerable)</li></ul></li><li>User-Mode IPC (Interprocess communications): Authorization issues or memory corruptions</li><li>User-to-driver: Authorization issues</li><li>Classic driver vulnerabilities:<ul><li>WDM: <a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/%22https://www.youtube.com/watch?v=qk-OI8Z-1To&amp;ab_channel=media.ccc.de%22">Ilja van Sprundel: Windows drivers attack surface</a></li><li>KMDF: <a href="https://www.youtube.com/watch?v=puNkbSTQtXY&amp;ab_channel=44CONInformationSecurityConference">Reverse Engineering and Bug Hunting on KMDF Drivers - Enrique Nissim at 44CON 2018</a></li><li>Mini-Filter: <a href="https://googleprojectzero.blogspot.com/2021/01/hunting-for-bugs-in-windows-mini-filter.html">Google Project Zero: Hunting for Bugs in Windows Mini-Filter Drivers</a></li></ul></li><li>Server-to-Agent<ul><li>Missing authentication of server</li><li>Parsing bugs in server responses</li></ul></li><li>Classic Windows Application Vulnerabilities (DLL Hijacking, File permissions, …)</li><li>Emulation/Sandbox Escapes</li><li>Other Logic Bugs</li></ul><p>This article focuses on user-to-driver authorization issues and, to some extent, classic driver vulnerabilities. Part 3 addresses user-mode IPC.</p><section><h3 id="impact">Impact<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#impact" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h3><p>The main impact of potential vulnerabilities on the client side is Local Privilege Escalation or hiding the execution of malicious software. Another possibility is spoofing data about the agent sent to the backend. Some vulnerabilities, such as in the scanning engine could also lead to Remote Code Execution. Additionally, a compromised agent also leads to a larger attack surface for the backend, as the attacker can abuse the authenticated session of the agent.<br>In case of P2P-based communication, serious design flaws could lead to the compromise of other agents.</p></section></section></section><section><h1 id="2-driver-attack-surface-for-low-priviledged-users">2. Driver Attack Surface for Low-Priviledged Users<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#2-driver-attack-surface-for-low-priviledged-users" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h1><p>This section provides a basic overview of how to conduct a security analysis of EDR drivers. It primarily focuses on identifying exposed driver functionalities that could constitute an attack surface for low-privileged users. It does not delve into the specifics of driver-related vulnerabilities or their exploitation.</p><p>For a testing environment we recommend using a virtual machine with a WinDBG Kernel Debugger attached. The easiest way to set it up is KDNET (see the following <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/setting-up-a-network-debugging-connection-automatically">documentation</a>).</p><section><h2 id="21-which-drivers-are-loaded">2.1 Which drivers are loaded?<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#21-which-drivers-are-loaded" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>One method for viewing loaded drivers is using <a href="https://www.nirsoft.net/utils/driverview.html">DriverView</a> which is further aided by the fact that there is a feature to filter drivers from Microsoft.</p><p><img alt="" decoding="async" height="561" loading="lazy" src="https://labs.infoguard.ch/_astro/driverview.B5FEZbkS_lPvjP.webp" width="1562"></p><p class="figcaption">DriverView with Cortex installed</p><p></p></section><section><h2 id="22-what-interface-does-each-driver-expose-to-user-land">2.2 What interface does each driver expose to user-land?<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#22-what-interface-does-each-driver-expose-to-user-land" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>There are two approaches to check this: static analysis and dynamic analysis. We suggest to use both methods in combination to catch all cases. For example, an EDR driver may only initialize one device object during startup but might be creating more device objects during the course of the EDRs execution.</p><p>Windows Driver Model (WDM) or Kernel-Mode Driver Framework (KMDF) drivers can expose a device interface. This interface can be opened from user space to interact with the driver.</p><p>Mini-Filter Drivers can expose a FilterCommunicationPort which can be used from user-mode to interact with the driver.</p><section><h3 id="221-static-analysis">2.2.1 Static Analysis<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#221-static-analysis" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h3><p>To establish a communication interface, a driver must invoke specific Windows APIs. These calls can be statically analyzed using reverse engineering software such as IDA. The following functions, as specified in Microsoft’s documentation, are commonly used:</p><ul><li><p>WDM Device Driver:</p><div class="relative code-block"><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-overlayscrollbars="host"><div class="os-size-observer"><div class="os-size-observer-listener"></div></div><div class="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden" tabindex="-1" style="margin-right: 0px; margin-bottom: 0px; margin-left: 0px; top: 0px; right: auto; left: 0px; width: calc(100% + 0px); padding: 0px;"><code><span class="line"><span>NTSTATUS IoCreateDevice(</span></span>
<span class="line"><span>  [in]           PDRIVER_OBJECT  DriverObject,</span></span>
<span class="line"><span>  [in]           ULONG           DeviceExtensionSize,</span></span>
<span class="line"><span>  [in, optional] PUNICODE_STRING DeviceName,</span></span>
<span class="line"><span>  [in]           DEVICE_TYPE     DeviceType,</span></span>
<span class="line"><span>  [in]           ULONG           DeviceCharacteristics,</span></span>
<span class="line"><span>  [in]           BOOLEAN         Exclusive,</span></span>
<span class="line"><span>  [out]          PDEVICE_OBJECT  *DeviceObject</span></span>
<span class="line"><span>);</span></span></code></div><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></pre><button class="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out"><div><svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg> <svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div>
      </button></div><p>Alternatively, IoCreateDeviceSecure can be used which applies a default SDDL String.</p></li><li><p>KMDF Device Driver:</p><div class="relative code-block"><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-overlayscrollbars="host"><div class="os-size-observer"><div class="os-size-observer-listener"></div></div><div class="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden" tabindex="-1" style="margin-right: 0px; margin-bottom: 0px; margin-left: 0px; top: 0px; right: auto; left: 0px; width: calc(100% + 0px); padding: 0px;"><code><span class="line"><span>NTSTATUS WdfDeviceCreateDeviceInterface(</span></span>
<span class="line"><span>  [in]           WDFDEVICE        Device,</span></span>
<span class="line"><span>  [in]           const GUID       *InterfaceClassGUID,</span></span>
<span class="line"><span>  [in, optional] PCUNICODE_STRING ReferenceString</span></span>
<span class="line"><span>);</span></span></code></div><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></pre><button class="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out"><div><svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg> <svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div>
      </button></div></li><li><p>Mini-Filter Driver:</p><div class="relative code-block"><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-overlayscrollbars="host"><div class="os-size-observer"><div class="os-size-observer-listener"></div></div><div class="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden" tabindex="-1" style="margin-right: 0px; margin-bottom: 0px; margin-left: 0px; top: 0px; right: auto; left: 0px; width: calc(100% + 0px); padding: 0px;"><code><span class="line"><span>NTSTATUS FLTAPI FltCreateCommunicationPort(</span></span>
<span class="line"><span>  [in]           PFLT_FILTER            Filter,</span></span>
<span class="line"><span>  [out]          PFLT_PORT              *ServerPort,</span></span>
<span class="line"><span>  [in]           POBJECT_ATTRIBUTES     ObjectAttributes,</span></span>
<span class="line"><span>  [in, optional] PVOID                  ServerPortCookie,</span></span>
<span class="line"><span>  [in]           PFLT_CONNECT_NOTIFY    ConnectNotifyCallback,</span></span>
<span class="line"><span>  [in]           PFLT_DISCONNECT_NOTIFY DisconnectNotifyCallback,</span></span>
<span class="line"><span>  [in, optional] PFLT_MESSAGE_NOTIFY    MessageNotifyCallback,</span></span>
<span class="line"><span>  [in]           LONG                   MaxConnections</span></span>
<span class="line"><span>);</span></span></code></div><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></pre><button class="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out"><div><svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg> <svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div>
      </button></div></li></ul></section><section><h3 id="222-dynamic-analysis">2.2.2 Dynamic Analysis<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#222-dynamic-analysis" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h3><p>Registered devices and port names can be identified using WinObj from Sysinternals (although the names are not always obvious) or by setting breakpoints in a kernel debugger.</p><p><strong>Device Driver</strong>: They are listed in WinObj under “GLOBAL??” as Symbolic Link pointing towards the device object. This makes the device available through <code>\\.\NAME</code> when trying to interact with the driver from another application. Another option is to use the discontinued tool DeviceTree from OSR which shows the devices in a hierachy for each driver and addtional information.</p><p><img alt="" decoding="async" height="642" loading="lazy" src="https://labs.infoguard.ch/_astro/winobj_devicedriver.uSGEv7Xx_Z8Q6Of.webp" width="1111"></p><p class="figcaption">WinObj with Cortex Devices</p><p></p><p><img alt="" decoding="async" height="1104" loading="lazy" src="https://labs.infoguard.ch/_astro/driver_device_tree_cortex.DWsYfQPN_ZJWiS9.webp" width="907"></p><p class="figcaption"><em>DeviceTree with Cortex Devices</em></p><p></p><p><strong>Mini-Filter Driver</strong>: They are listed in WinObj named “FilterConnectionPort”</p><p><img alt="" decoding="async" height="171" loading="lazy" src="https://labs.infoguard.ch/_astro/cortex_filterconnectionports.CnnVmcIt_RJsRd.webp" width="841"></p><p class="figcaption">FilterConnectionPorts in WinObj (Cortex)</p><p></p></section></section><section><h2 id="23-what-are-the-access-permissions-of-each-interface">2.3 What are the access permissions of each interface?<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#23-what-are-the-access-permissions-of-each-interface" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>This step is more easily accomplished dynamically.</p><p><strong>Device Driver:</strong> To our knowledge there is no modern tool to view the correct access permissions of a device interface. Try to get a copy of OSR DeviceTree which directly shows the ACLs and other flags. An alternative is to use a Kernel Debugger.</p><p><img alt="" decoding="async" height="1159" loading="lazy" src="https://labs.infoguard.ch/_astro/device_tree_permissionscoretex.c-8o1yTQ_Z191dAO.webp" width="1498"></p><p><strong>Mini-Filter Driver:</strong> One way to test if a certain user can access a FilterConnectionPort is to use the <a href="https://www.powershellgallery.com/packages/NtObjectManager/1.1.29">NtObjectManager</a> tooling from James Forshaw.</p><div class="relative code-block"><pre class="astro-code github-dark" data-language="powershell" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-overlayscrollbars="host"><div class="os-size-observer"><div class="os-size-observer-listener"></div></div><div class="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden" tabindex="-1" style="margin-right: 0px; margin-bottom: 0px; margin-left: 0px; top: 0px; right: auto; left: 0px; width: calc(100% + 0px); padding: 0px;"><code><span class="line"><span style="color:#79b8ff">Get-FilterConnectionPort</span><span style="color:#f97583"> -</span><span style="color:#e1e4e8">Path </span><span style="color:#9ecbff">"\CyvrFsfd"</span></span>
<span class="line"><span style="color:#e1e4e8">Exception: </span><span style="color:#9ecbff">"(0x80070005) - Access is denied."</span></span></code></div><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></pre><button class="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out"><div><svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg> <svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div>
      </button></div><p>To retrieve the security descriptor, use WinDbg as a kernel debugger:</p><div class="relative code-block"><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-overlayscrollbars="host"><div class="os-size-observer"><div class="os-size-observer-listener"></div></div><div class="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden" tabindex="-1" style="margin-right: 0px; margin-bottom: 0px; margin-left: 0px; top: 0px; right: auto; left: 0px; width: calc(100% + 0px); padding: 0px;"><code><span class="line"><span>0: kd&gt; !object \CyvrFsfd</span></span>
<span class="line"><span>Object: ffffc2861e32f550  Type: (ffffc2861bc7b220) FilterConnectionPort</span></span>
<span class="line"><span>    ObjectHeader: ffffc2861e32f520 (new version)</span></span>
<span class="line"><span>    HandleCount: 1  PointerCount: 6</span></span>
<span class="line"><span>    Directory Object: ffffd9099503e9f0  Name: CyvrFsfd</span></span>
<span class="line"><span>0: kd&gt; dx (((nt!_OBJECT_HEADER*)0xffffc2861e32f520)-&gt;SecurityDescriptor &amp; ~0xa)</span></span>
<span class="line"><span>(((nt!_OBJECT_HEADER*)0xffffc2861e32f520)-&gt;SecurityDescriptor &amp; ~0xa) :</span></span>
<span class="line"><span>0xffffd909950257a0</span></span>
<span class="line"><span>0: kd&gt; !sd 0xffffd909950257a0 1</span></span>
<span class="line"><span>-&gt;Revision: 0x1</span></span>
<span class="line"><span>-&gt;Sbz1    : 0x0</span></span>
<span class="line"><span>-&gt;Control : 0x8004</span></span>
<span class="line"><span>            SE_DACL_PRESENT</span></span>
<span class="line"><span>            SE_SELF_RELATIVE</span></span>
<span class="line"><span>-&gt;Owner   : S-1-5-32-544 (Alias: BUILTIN\Administrators)</span></span>
<span class="line"><span>-&gt;Group   : S-1-5-18 (Well Known Group: NT AUTHORITY\SYSTEM)</span></span>
<span class="line"><span>-&gt;Dacl    :</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;AclRevision: 0x2</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Sbz1       : 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;AclSize    : 0x1c</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;AceCount   : 0x1</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Sbz2       : 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;AceType: ACCESS_ALLOWED_ACE_TYPE</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;AceFlags: 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;AceSize: 0x14</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;Mask : 0x001f0001</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;SID: S-1-5-18 (Well Known Group: NT AUTHORITY\SYSTEM)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-&gt;Sacl    :  is NULL</span></span></code></div><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></pre><button class="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out"><div><svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg> <svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div>
      </button></div><p>This port only allows access from <em>NT AUTHORITY\SYSTEM</em>.</p></section><section><h2 id="24-what-can-you-do-if-an-interface-is-accessible">2.4 What can you do if an interface is accessible?<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#24-what-can-you-do-if-an-interface-is-accessible" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>First of all, if the Windows ACLs allow access to the device interface or FilterConnectionPort, that doesn’t mean that you can actually access all the functionality offered by these interfaces. The driver itself can perform any arbitrary access checks such as verifying the security token of the calling process or checking the file path of the process.</p><p>This topic usually requires to reverse engineer a driver’s interesting functions and figuring out what they do in the absence of function names in the driver. In the following segment, we give some advice on how to start.</p><section><h3 id="241-device-driver">2.4.1 Device Driver<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#241-device-driver" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h3><p>The most relevant method for interacting with these devices is Device Input/Output Control (IOCTL) using major function code 0xe (14) which allows for communication between 2 partners while offering a channel for (bi)directional data exchange. While read (<em>IRP_MJ_READ</em>) and write (<em>IRP_MJ_WRITE</em>) operations could also be relevant, the primary functionality in this context resides within <em>IRP_MJ_DEVICE_CONTROL</em>.</p><p>These dispatch functions can be triggered from user-mode with the following functions:</p><ul><li><em>CreateFile() =&gt; IRP_MJ_CREATE_</em></li><li><em>ReadFile() =&gt; IRP_MJ_READ</em></li><li><em>DeviceIoControl() =&gt; IRP_MJ_CONTROL</em></li></ul><p><img alt="" decoding="async" height="683" loading="lazy" src="https://labs.infoguard.ch/_astro/irp_majorfunctions.CxLInR1J_Z1SEPoX.webp" width="981"></p><p class="figcaption">Source: Enrique Nissim, IOActive</p><p></p><p>The next step involves reverse engineering to analyze the functionality of these dispatch functions. The functionality is located in <code>DRIVER_DISPATCH</code> callback functions which are registered during the initialization of the driver. The following screenshot from IDA shows the <em>tedrdrv.sys</em> driver from Cortex. In this example the callback functions are the same for most of the functions.</p><p><img alt="" decoding="async" height="478" loading="lazy" src="https://labs.infoguard.ch/_astro/driver_dispatch_cortex.DWehs01-_Z2fpWvF.webp" width="574"></p><p class="figcaption">Driver Dispatch Functions in Cortex</p><p></p><p>The function <code>sub_1233A0</code> differentiates between MajorFunction codes. If 0xe (DEVICE_CONTROL) is called the real IO Control Dispatch function is called which looks like the following:</p><p><img alt="" decoding="async" height="891" loading="lazy" src="https://labs.infoguard.ch/_astro/driver_dispatch_io_cortex_marked.ByKpWwCh_1AwBgW.webp" width="1098"></p><p class="figcaption">Device IO Control Dispatch Function in Cortex</p><p></p><p>The different cases correspond to I/O control codes (IOCTLs). This section of the code reveals an interesting aspect: the process ID of the caller is retrieved and then either compared or passed to other functions. This suggests an authorization mechanism needs to be further analyzed. This is part of the next chapter.</p></section><section><h3 id="242-filterconnectionports">2.4.2 FilterConnectionPorts:<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#242-filterconnectionports" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h3><p>Filter connection ports are similar to I/O control codes. During the registration of a filter connection port, callback functions can be specified in the <code>FltCreateCommunicationPort</code> function to handle connection, disconnection, and messages.</p><p><img alt="" decoding="async" height="314" loading="lazy" src="https://labs.infoguard.ch/_astro/driver_filterconenctionport_cortex.BKVJwVmj_Z8Ylrn.webp" width="479"></p><p class="figcaption">FltCreateCommunicationPort() in cyvrfsfd.sys from Cortex</p><p></p><p>The <code>MessageNotifyCallback</code> implements different cases similar to the IO Control Dispatch function above.</p></section></section><section><h2 id="25-why-are-some-of-the-edr-driver-interfaces-accessible-for-low-privileged-users-at-all">2.5 Why are some of the EDR driver interfaces accessible for low privileged users at all?<a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#25-why-are-some-of-the-edr-driver-interfaces-accessible-for-low-privileged-users-at-all" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>Verifying the access control lists (ACLs) of driver interfaces is a fundamental check in penetration testing, one that, ideally, all vendors should conduct at some stage. It is very likely that, in some instances, ACLs are intentionally set to be broadly accessible. Windows APIs typically offer functionalities to restrict privilege levels for specific device objects. One such example is using <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdmsec/nf-wdmsec-wdmlibiocreatedevicesecure"><code>IoCreateDeviceSecure</code></a> with an explicit security identifier as an argument, or alternatively using <code>IoCreateDevice</code> and specifying the security identifier within the INF file.</p><p>Why, then, are these ACLs not more restrictive? During kernel debugging of the driver, we observed that IOCTLs are invoked from various user-space processes. EDRs often employ an architecture where an injected DLL from the EDR agent communicates directly with the driver via IOCTLs on behalf of the injected process. Because these injected processes are frequently low-privileged (e.g., <code>word.exe</code>), the driver cannot enforce security restrictions based solely on the process’s privilege level. We’ve never implemented an EDR and we don’t have enough details to judge this, but we don’t think that this is the most secure approach. Indeed, several EDR solutions do not adopt this practice.</p><p>Following the process described in the previous sections, there are candidates with open ACLs for the driver interfaces:</p><ul><li>PaloAlto Cortex XDR</li><li>Sophos Intercept X</li></ul><p>The results are described in <a href="https://labs.infoguard.ch/posts/edr_part2_driver_analysis_results/">Part 2</a></p></section></section></div><div class="transition relative rounded-xl bg-[var(--license-block-bg)] license-container mb-6 onload-animation overflow-hidden px-6 py-5"><div class="transition font-bold dark:text-white/75 text-black/75">Attacking EDRs Part 1: Intro &amp; Security Analysis of EDR Drivers</div><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/" class="text-[var(--primary)] link">https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/</a><div class="flex gap-6 mt-2"><div><div class="transition text-sm dark:text-white/30 text-black/30">Author</div><div class="transition dark:text-white/75 text-black/75 whitespace-nowrap">Manuel Feifel</div></div><div><div class="transition text-sm dark:text-white/30 text-black/30">Published at</div><div class="transition dark:text-white/75 text-black/75 whitespace-nowrap">2025-02-10</div></div><div><div class="transition text-sm dark:text-white/30 text-black/30">License</div><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="text-[var(--primary)] link whitespace-nowrap" target="_blank">CC BY-NC-SA 4.0</a></div></div><svg height="1em" width="0.97em" class="transition absolute -translate-y-1/2 dark:text-white/5 pointer-events-none right-6 text-[15rem] text-black/5 top-1/2" data-icon="fa6-brands:creative-commons"><symbol id="ai:fa6-brands:creative-commons" viewBox="0 0 496 512"><path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86m143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86M247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248m.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82" fill="currentColor"></path></symbol><use href="#ai:fa6-brands:creative-commons"></use></svg></div></div></div><div class="flex w-full flex-col gap-4 mb-4 justify-between md:flex-row overflow-hidden"><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#" class="overflow-hidden w-full active:scale-95 font-bold pointer-events-none"></a> <a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#" class="overflow-hidden w-full active:scale-95 font-bold pointer-events-none"></a></div></div></main></div><div class="hidden lg:block back-to-top-wrapper" data-astro-cid-eymb5ayk=""><div class="transition flex items-center rounded-2xl back-to-top-btn hide overflow-hidden" id="back-to-top-btn" data-astro-cid-eymb5ayk=""><button class="btn-card h-[3.75rem] w-[3.75rem]" aria-label="Back to Top" data-astro-cid-eymb5ayk=""><svg height="1em" width="1em" class="mx-auto" data-icon="material-symbols:keyboard-arrow-up-rounded" data-astro-cid-eymb5ayk="true"><symbol id="ai:material-symbols:keyboard-arrow-up-rounded" viewBox="0 0 24 24"><path d="m12 10.8l-3.9 3.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.6-4.6q.3-.3.7-.3t.7.3l4.6 4.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:keyboard-arrow-up-rounded"></use></svg></button></div></div></div></div><div class="absolute hidden 2xl:block w-full z-0"><div class="mx-auto max-w-[var(--page-width)] relative"><div class="transition flex items-center -right-[var(--toc-width)] absolute hidden lg:block top-0 w-[var(--toc-width)]" id="toc-wrapper"><div class="h-[calc(100vh_-_20rem)] fixed hide-scrollbar overflow-x-hidden overflow-y-scroll top-14 w-[var(--toc-width)]" id="toc-inner-wrapper"><div class="transition-swup-fade h-full w-full" id="toc"><div class="h-8 w-full"></div><table-of-contents class="group"><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#1-introduction" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">1</div><div class="transition text-sm text-50">1. Introduction</div></a><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#11-attack-surface-of-edr-solutions" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center ml-4 h-5 shrink-0 text-xs w-5"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">1.1 Attack Surface of EDR solutions</div></a><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#2-driver-attack-surface-for-low-priviledged-users" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">2</div><div class="transition text-sm text-50">2. Driver Attack Surface for Low-Priviledged Users</div></a><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#21-which-drivers-are-loaded" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center ml-4 h-5 shrink-0 text-xs w-5"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">2.1 Which drivers are loaded?</div></a><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#22-what-interface-does-each-driver-expose-to-user-land" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center ml-4 h-5 shrink-0 text-xs w-5"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">2.2 What interface does each driver expose to user-land?</div></a><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#23-what-are-the-access-permissions-of-each-interface" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center ml-4 h-5 shrink-0 text-xs w-5"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">2.3 What are the access permissions of each interface?</div></a><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#24-what-can-you-do-if-an-interface-is-accessible" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center ml-4 h-5 shrink-0 text-xs w-5"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">2.4 What can you do if an interface is accessible?</div></a><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/#25-why-are-some-of-the-edr-driver-interfaces-accessible-for-low-privileged-users-at-all" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center ml-4 h-5 shrink-0 text-xs w-5"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">2.5 Why are some of the EDR driver interfaces accessible for low privileged users at all?</div></a><div class="absolute left-0 right-0 -z-10 bg-[var(--toc-btn-hover)] border-2 border-[var(--toc-btn-hover)] border-dashed group-hover:bg-transparent group-hover:border-[var(--toc-btn-active)] rounded-xl transition-all" id="active-indicator"></div></table-of-contents><div class="h-8 w-full"></div></div></div></div><!-- #toc needs to exist for Swup to work normally --></div></div><div class="hidden h-[300vh]" id="page-height-extend" style="--bannerOffset:15vh;--banner-height-home:65vh;--banner-height:35vh;--configHue:235;--page-width:75rem" data-astro-cid-sckkx6r4=""></div><!-- Cloudflare Pages Analytics --><!-- Cloudflare Pages Analytics --><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-auto py-1 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-auto py-1 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-visible os-scrollbar-cornerless" style="--os-viewport-percent: 0.0726; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></body></html>