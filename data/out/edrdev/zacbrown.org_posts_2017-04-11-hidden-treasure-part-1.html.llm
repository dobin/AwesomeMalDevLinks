Title:
Hidden Treasure: Intrusion Detection with ETW, Part 1

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post introduces Event Tracing for Windows (ETW) as a high-fidelity telemetry source for intrusion detection beyond the Windows Security Event Log (e.g., limited context from 4688 process start events).  
- It frames common investigation gaps (process hollowing/injection, DNS-based C2, opaque PowerShell activity) and builds a “forensic wish list” covering DNS, network connections, data volume, beaconing, DLL loads, remote thread creation, WMI actions, and PowerShell function invocation.  
- The author explains ETW’s producer/consumer model: providers emit structured events with schemas, consumers create trace sessions, register providers, and handle events via callbacks.  
- Microsoft Message Analyzer is used to demonstrate inspecting ETW events (example: PowerShell provider revealing command names like `invoke-mimikatz` and the invoking user).  
- It highlights ETW’s breadth across Windows subsystems (network, process/thread, memory, DNS, firewall, WinINet, WMI, PowerShell) and notes the operational challenge: ETW volume is too large to ship raw to a SIEM without filtering/aggregation.  
- Useful primarily for Blue Teams/DFIR and detection engineers, with value to red teams for understanding what telemetry defenders can collect.

Technical Focus:
- Event Tracing for Windows (ETW) architecture (providers, sessions, callbacks)
- PowerShell ETW provider telemetry and command/function visibility
- DNS and network activity tracing via ETW
- Process/thread/DLL load telemetry for injection/hollowing detection context
- ETW event schemas and common metadata fields (PID/TID, timestamp, provider ID)
- Telemetry scaling: filtering and aggregation requirements

Use Cases:
- Enriching investigations when binaries are deleted or only 4688 data exists
- Detecting suspicious PowerShell usage via provider events (command/function invocation)
- Correlating process activity with DNS queries and network destinations
- Building endpoint telemetry pipelines using ETW as a primary data source
- Identifying beaconing patterns using ETW-derived network/DNS timing and volume

Keywords:
ETW, Event Tracing for Windows, Windows Security Event Log, Event ID 4688, PowerShell ETW provider, invoke-mimikatz, process hollowing, process injection, DLL load, thread creation, WMI, DNS tunneling, command and control, WinINet, firewall telemetry, Message Analyzer, logman query providers, trace session, SIEM filtering, telemetry aggregation