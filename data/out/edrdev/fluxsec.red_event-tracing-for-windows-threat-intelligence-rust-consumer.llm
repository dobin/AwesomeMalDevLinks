Title:
Event Tracing for Windows Threat Intelligence (ETW:TI) Rust Consumer (Sanctum EDR)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post shows how to consume the Microsoft-Windows-Threat-Intelligence ETW provider from a Rust-based EDR component to gain kernel-emitted telemetry that usermode ETW patching can’t suppress.  
- It focuses on detecting high-signal behaviors such as remote memory allocation/protection changes, APC queueing, thread/process suspend-resume, and other injection-adjacent actions.  
- The author outlines operational requirements to reliably receive ETW:TI events (Protected Process Light service, ELAM driver/cert, and logging via Windows Event Log).  
- It walks through implementing a real-time ETW session in Rust using StartTraceW, EnableTraceEx2 (with keyword masks), OpenTraceW, and ProcessTrace with an EVENT_RECORD callback.  
- The callback extracts PID/task/keyword metadata and demonstrates simple filtering (e.g., flagging VirtualAllocEx-style remote allocations) plus PID→image resolution.  
- It notes limitations such as difficulty opening handles to SYSTEM processes even from a PPL context, implying potential visibility gaps.  
- Useful for EDR/defensive engineers and red teamers studying what kernel telemetry exposes and what evasion requires kernel-mode capability.

Technical Focus:
- ETW Threat Intelligence provider (Microsoft-Windows-Threat-Intelligence) tasks/keywords
- Real-time ETW consumer implementation (StartTraceW, EnableTraceEx2, OpenTraceW, ProcessTrace)
- Rust + windows-rs Win32 bindings and callback-based event processing (EVENT_RECORD)
- PPL (Protected Process Light) + ELAM prerequisites for security telemetry collection
- Detection of process injection primitives (VirtualAllocEx, ProtectVM, QueueUserAPC, SetThreadContext)
- Windows Event Log as a telemetry sink

Use Cases:
- Build a Rust ETW:TI consumer for an EDR/agent to detect injection and memory-tampering behaviors
- Create high-fidelity detections for remote memory allocation/protection changes and APC-based injection
- Telemetry enrichment: correlate ETW:TI events with process image names and targeted processes
- Red team validation: test which injection techniques are observable via kernel ETW:TI
- Research tuning strategies (keyword masks, filtering) to reduce false positives at scale

Keywords:
ETW, ETW Threat Intelligence, Microsoft-Windows-Threat-Intelligence, Windows kernel telemetry, EVENT_TRACE_PROPERTIES, StartTraceW, EnableTraceEx2, OpenTraceW, ProcessTrace, EVENT_RECORD, EVENT_TRACE_LOGFILEW, keywords bitmask, tasks/opcodes, Protected Process Light, PPL, ELAM, Windows Event Log, VirtualAllocEx, QueueUserAPC, SetThreadContext, process injection, Rust, windows-rs