Title:
Intro and plan for the Sanctum EDR

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post outlines the architecture and milestone plan for “Sanctum,” a Windows AV/EDR project implemented in Rust with both a kernel driver and user-mode components.  
- It focuses on building an EDR that can detect/prevent common malware tradecraft (process injection variants, syscall evasion, ETW/AMSI patching, persistence, DLL sideloading) while also serving as a learning/research vehicle.  
- The design includes a Rust kernel driver for telemetry and enforcement (process/thread/image-load callbacks, ETW Threat Intelligence monitoring, WriteProcessMemory monitoring, potential kill/contain actions) plus an injected per-process DLL for tamper detection and user-mode syscall/hook logic.  
- A user-mode “engine” handles scanning (IOCs, IAT analysis, entropy/PEB/syscall heuristics), GUI (Tauri), and future SIEM export and cloud IOC updates.  
- It’s useful for defenders and EDR engineers building telemetry/enforcement pipelines, and for red teamers/malware researchers to understand what an EDR can realistically observe and how detections might be implemented.  
- Interesting points include committing to Rust for Windows driver development, explicit mapping of offensive techniques to defensive telemetry, and a concrete callback/ETW-centric kernel plan.

Technical Focus:
- Windows kernel driver development in Rust (WDK crates, no_std/libcore, unsafe boundaries)
- Kernel callbacks: PsSetCreateProcessNotifyRoutineEx, PsSetLoadImageNotifyRoutine, PsSetCreateThreadNotifyRoutine
- ETW Threat Intelligence monitoring and anti-ETW/AMSI patching strategies
- Process injection detection signals (WriteProcessMemory, remote threads/APCs, suspicious stacks)
- User-mode scanning heuristics (IOCs, IAT analysis, entropy, PEB access, direct syscalls)
- Driver ↔ user-mode communication and telemetry/enforcement architecture

Use Cases:
- Build a learning/reference EDR architecture with kernel + user-mode components
- Prototype detections for injection, tampering, and persistence techniques on Windows
- Collect process/thread/image-load telemetry and correlate it in a user-mode service
- Implement anti-tamper checks for ETW/AMSI patching and NTDLL remapping
- Develop an AV-style scanner with IOC feeds, disk scans, and optional sandboxing

Keywords:
Sanctum EDR, Rust, Windows kernel driver, WDK crates, no_std, IOCTL, user-mode service, PsSetCreateProcessNotifyRoutineEx, PsSetLoadImageNotifyRoutine, PsSetCreateThreadNotifyRoutine, ETW Threat Intelligence, AMSI patching, ETW patching, WriteProcessMemory, DLL injection, reflective DLL injection, APC queue hijacking, Hell’s Gate, direct syscalls, NTDLL remapping, DLL sideloading, persistence detection, Tauri GUI