Title:
Silencing the EDR Silencers

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post analyzes a common EDR “blinding” technique where attackers block an EDR agent’s network communications instead of tampering with its process or files.  
- It focuses on two Windows-native mechanisms used for this: Windows Defender Firewall rules (often via `netsh` or `INetFwRule/INetFwRules` COM) and Windows Filtering Platform (WFP) filters (often via `FwpmFilterAdd0`, as used by tools like EDRSilencer).  
- The author shows where these artifacts land on disk—Firewall rules as `REG_SZ` under `HKLM\...\FirewallPolicy\FirewallRules\{GUID}` and WFP providers/filters as `REG_BINARY` under WFP registry locations—highlighting why this can be stealthy yet detectable.  
- Defensive mitigations are proposed in two patterns: prevention using kernel registry pre-callbacks (`RegNtPreSetValueKey`) to deny writes, and “immediate removal” using post-callbacks (`RegNtPostSetValueKey`) to detect then remove rules/filters from user mode.  
- For removal, it demonstrates using `INetFwRules::Remove` for firewall rules and `FwpmFilterDeleteById0` / `FwpmProviderDeleteByKey0` for WFP objects, plus mentions Security Event ID 5447 as an alternate signal for WFP rule creation.  
- It’s most useful for EDR/defensive engineers and blue teams building tamper protection, and for red teamers to understand what defenders can monitor and remediate.

Technical Focus:
- Windows Defender Firewall rule creation/storage (registry-backed policy)
- Windows Filtering Platform (WFP) providers and filters (persistent vs dynamic/static)
- Registry callback drivers: `RegNtPreSetValueKey` and `RegNtPostSetValueKey`
- COM firewall management APIs: `INetFwRule`, `INetFwRules::Add/Remove`
- WFP management APIs: `FwpmFilterAdd0`, `FwpmFilterDeleteById0`, `FwpmProviderDeleteByKey0`
- Telemetry/detection points (registry monitoring, Security Event ID 5447)

Use Cases:
- Detecting and auto-remediating malicious firewall rules targeting EDR agents
- Detecting and removing malicious persistent WFP filters/providers used to block telemetry
- Designing EDR self-protection/tamper protection around registry and WFP changes
- Building SOC detections around firewall/WFP registry paths and rule creation events
- Red team validation of “EDR blinding” via network isolation and expected defensive controls

Keywords:
EDR blinding, EDR tampering, Windows Defender Firewall, Windows Filtering Platform, WFP, netsh advfirewall, INetFwRule, INetFwRules, COM, FwpmFilterAdd0, FwpmFilterDeleteById0, FwpmProviderDeleteByKey0, RegNtPreSetValueKey, RegNtPostSetValueKey, registry callbacks, HKLM FirewallRules, persistent filters, Security Event ID 5447, EDRSilencer, EDRSandblast, JonMon