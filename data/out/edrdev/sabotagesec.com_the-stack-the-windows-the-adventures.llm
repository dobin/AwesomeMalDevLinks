Title:
The Stack, The Windows & The Adventures

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post is a practical guide to implementing call stack walking (stack tracing) in Win32 code on both x86 and x64 Windows.  
- It focuses on capturing thread CPU context (register state) and using that context to initialize STACKFRAME/STACKFRAME64 structures correctly.  
- The author explains how to choose between CONTEXT vs WOW64_CONTEXT and related APIs when dealing with WoW64 (32-bit processes on 64-bit Windows).  
- It demonstrates using DbgHelp stack-walking APIs (StackWalk / StackWalk64) in a loop until the final frame is reached, highlighting architecture-specific parameters and callbacks.  
- This is useful for red teamers, malware developers, and defenders building telemetry/anomaly detection based on call stacks, as well as anyone writing debuggers or introspection tooling.  
- It’s interesting because it consolidates the “gotchas” around machine types, structure types, and required helper routines (Sym* functions) that commonly break stack walking implementations.

Technical Focus:
- Windows thread context capture (CONTEXT, WOW64_CONTEXT)
- WoW64 process/thread handling (IsWow64Process, Wow64GetThreadContext)
- DbgHelp stack walking (StackWalk, StackWalk64)
- STACKFRAME/STACKFRAME64 initialization (PC/SP/FP register mapping)
- Symbol/helper routines (SymFunctionTableAccess64, SymGetModuleBase64 / SymGetModuleBase)

Use Cases:
- Implementing stack traces in custom Windows tooling (x86/x64)
- Runtime anomaly detection or EDR-like telemetry using call stacks
- Debugging/crash analysis utilities that need reliable call chains
- Cross-arch (x64 controller → x86 target) thread inspection via WoW64 APIs

Keywords:
Windows, Win32, x86, x64, WoW64, IsWow64Process, CONTEXT, WOW64_CONTEXT, GetThreadContext, Wow64GetThreadContext, RtlCaptureContext, DbgHelp, StackWalk, StackWalk64, STACKFRAME, STACKFRAME64, IMAGE_FILE_MACHINE_I386, IMAGE_FILE_MACHINE_AMD64, SymFunctionTableAccess64, SymGetModuleBase64, SymGetModuleBase