Title:
Ghost Hunting OpenProcess

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes a “Ghost Hunting” detection technique aimed at spotting malware that bypasses EDR user-mode syscall hooks (e.g., direct/indirect syscalls, Hell’s Gate, NTDLL remapping) by correlating two independent telemetry sources.  
- The focus is on detecting OpenProcess/ZwOpenProcess abuse by matching (1) a user-mode syscall-stub hook event emitted via IPC from an injected DLL and (2) a kernel-side handle/open notification from an EDR driver.  
- If both signals don’t arrive within a defined time window (currently 600 ms), the process risk score is increased, indicating likely hook evasion.  
- The implementation is in Rust (Tokio mpsc channels, async tasks) and integrates into the Sanctum EDR engine’s core loop and ProcessMonitor tracking.  
- The author discusses design tradeoffs (noise of handle events, race conditions, avoiding blocking kernel threads) and positions OpenProcess as an early, imperfect but useful correlation point in an injection chain.  
- Useful for EDR engineers/defenders building anti-evasion telemetry correlation, and for red teamers/malware researchers evaluating bypass constraints and timing windows.

Technical Focus:
- User-mode syscall stub hooking of ZwOpenProcess
- Kernel/user telemetry correlation (handle events vs hooked syscall IPC)
- Detecting direct/indirect syscalls (Hell’s Gate) and NTDLL remapping
- Rust async architecture (Tokio mpsc channels, tasks, RwLock)
- Time-window correlation and risk scoring (timer-based anomaly detection)

Use Cases:
- Build EDR detections for syscall-hook bypass attempts using cross-layer correlation
- Detect suspicious OpenProcess handle acquisition preceding injection techniques
- Evaluate attacker timing strategies (loader “hit-and-run” vs delayed execution) against correlation windows
- Prototype research EDR engines in Rust with IPC from injected hooks to a central core

Keywords:
Ghost Hunting, OpenProcess, ZwOpenProcess, syscall hooking, syscall stub, EDR evasion, direct syscalls, indirect syscalls, Hell’s Gate, NTDLL remapping, kernel driver, handle callbacks, IPC, IOCTL, ObOpenObjectByPointer, Rust, Tokio, mpsc channel, risk scoring, time-window correlation