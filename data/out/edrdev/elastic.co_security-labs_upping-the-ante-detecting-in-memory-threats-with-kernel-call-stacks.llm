Title:
Upping the Ante: Detecting In-Memory Threats with Kernel Call Stacks

Type:
Blog Post

Short Summary (4–8 sentences max):
- Elastic Security 8.8 introduces kernel call stack capture/enrichment for common endpoint events (process, file, registry, library) to improve detection of in-memory tradecraft.  
- The goal is to raise detection fidelity against evasive techniques that bypass user-mode telemetry and signature-based memory scanning (e.g., sleep-based evasion, direct syscalls).  
- The post explains how collecting kernel-mode call stacks and enriching them with module/symbol context enables “how it happened” attribution (e.g., unbacked/RWX frames, suspicious modules in the stack).  
- It highlights new out-of-the-box behavior rules (30+) targeting techniques like module stomping, callback-based evasion, unbacked-region execution, and suspicious library loads.  
- Examples show higher-signal detections for Office macro/XLL activity (e.g., `VBE7.dll`, `xlAutoOpen`), CLR loads from suspicious memory, and noisy persistence keys (Run) made actionable with unbacked stack indicators.  
- Useful primarily for Blue Teams/detection engineers, but also valuable for red teams to understand emerging EDR telemetry and where evasions may need to evolve.

Technical Focus:
- Kernel-mode telemetry and inline kernel visibility
- Kernel call stack capture, stack enrichment (modules/symbols)
- Unbacked memory region detection (RWX, non-image-backed execution)
- Detection engineering with EQL and call-stack-aware logic
- In-memory tradecraft: direct syscalls, module stomping, NTDLL unhooking, callback evasion
- Reducing false positives via call-stack-based allowlisting

Use Cases:
- Build high-confidence detections for process/file/registry/library events using call stack context
- Hunt for execution originating from unbacked/RWX memory (shellcode, injected threads)
- Detect Office macro/XLL-driven child processes and dropped payloads via stack module indicators
- Identify suspicious CLR/.NET loading patterns (e.g., execute-assembly style tradecraft)
- Improve noisy persistence detections (e.g., Run keys) by requiring suspicious stack properties
- Detect masquerading/abuse of “normal” Windows binaries by profiling expected call stacks

Keywords:
Elastic Security 8.8, kernel call stacks, EDR telemetry, Windows kernel, process creation, image load, registry events, unbacked memory, RWX, module stomping, direct syscalls, callback evasion, NTDLL unhooking, LdrLoadDLL, VBE7.dll, xlAutoOpen, CLR.DLL, mscoreei.dll, EQL, Cobalt Strike, Brute Ratel, Sliver, WerFault.exe, wermgr.exe, Sysmon/Procmon-like visibility