# https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/

<!DOCTYPE html><html class="transition bg-[var(--page-bg)] md:text-[16px] text-[14px] dark swup-enabled" data-astro-cid-sckkx6r4="" data-overlayscrollbars-initialize="" lang="en" style="--bannerOffset: 15vh; --banner-height-home: 65vh; --banner-height: 35vh; --configHue: 235; --page-width: 75rem; --hue: 235; --banner-height-extend: 30000px; --hue-hl: 97;" data-overlayscrollbars="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden"><body class="transition min-h-screen" data-astro-cid-sckkx6r4="" data-overlayscrollbars-initialize="" style="--bannerOffset:15vh;--banner-height-home:65vh;--banner-height:35vh;--configHue:235;--page-width:75rem"><div id="config-carrier" data-hue="235"></div><div class="transition-all duration-700 max-w-[var(--page-width)] md:px-4 mx-auto pointer-events-none px-0 relative z-50" id="top-row"><div class="transition-all pointer-events-auto sticky top-0" id="navbar-wrapper"><div class="onload-animation z-50" id="navbar"><div class="transition absolute -top-8 bg-[var(--card-bg)] h-8 left-0 right-0"></div><div class="flex items-center justify-between !overflow-visible !rounded-t-none card-base h-[4.5rem] max-w-[var(--page-width)] mx-auto pt-4 px-4"><a href="https://labs.infoguard.ch/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-[3.25rem] mb-2"><div class="mr-24 relative"><svg height="50" width="50" class="stroke-[#FFDC00] stroke-[5]" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg" fill="none"><circle cx="25" cy="25" r="22.5"></circle></svg><div class="absolute top-0 left-[60px]"><svg height="13" width="72" class="fill-[#A0A0A0]" viewBox="0 0 85 15" xmlns="http://www.w3.org/2000/svg"><path d="M54.918 3.90489V14.1256H52.3377V12.8975C51.561 13.8612 50.6015 14.331 49.417 14.331C47.1621 14.331 45.7602 12.8114 45.7602 10.3672V3.90489H48.3211V9.69047C48.3211 11.1406 49.0152 11.9382 50.2731 11.9382C51.5311 11.9382 52.3362 11.0621 52.3362 9.65119V3.90489H54.918ZM64.5795 4.92605C65.3157 5.64811 65.6875 6.71459 65.6875 8.09679V14.1271H63.1821V13.1286C62.392 13.9186 61.344 14.3325 60.1311 14.3325C58.3799 14.3325 56.4938 13.3265 56.4938 11.1195V11.0817C56.4938 8.98653 58.0695 7.73576 60.7083 7.73576C61.8013 7.73576 62.5824 7.90796 63.2001 8.09377V8.05902C63.2001 6.4019 61.9557 6.05446 60.9122 6.05446C59.8687 6.05446 59.0261 6.29767 58.158 6.66172L58.0066 6.72517L57.9541 6.56958L57.3573 4.78556L57.3124 4.65263L57.4398 4.59523C58.3829 4.16924 59.4924 3.77347 61.2106 3.77347C62.6859 3.77347 63.8508 4.17226 64.578 4.92605H64.5795ZM63.2376 10.405V9.83548C62.7833 9.66932 62.0757 9.48805 61.1551 9.48805C59.7847 9.48805 58.9976 10.0334 58.9976 10.9866V11.0243C58.9976 11.8431 59.6903 12.3718 60.7638 12.3718C62.1971 12.3718 63.2376 11.544 63.2376 10.405ZM73.7103 3.71757L73.8572 3.72362V6.42909H73.5738C71.5393 6.42909 70.3743 7.80222 70.3743 10.198V14.1271H67.8135V3.90489H70.3743V5.62697C71.082 4.37166 72.1615 3.71455 73.5273 3.71455C73.5888 3.71455 73.6503 3.71455 73.7118 3.71908L73.7103 3.71757ZM85 0.111784V14.1256H82.4392V12.7736C81.5771 13.8204 80.5261 14.331 79.2397 14.331C76.9518 14.331 74.5214 12.4745 74.5214 9.03336V8.99559C74.5214 5.51669 76.8963 3.69794 79.2397 3.69794C80.5231 3.69794 81.5726 4.17982 82.4392 5.16623V0.111784H85ZM82.4767 9.03336V8.99559C82.4767 7.27502 81.3162 5.97742 79.7794 5.97742C78.2426 5.97742 77.1002 7.21913 77.1002 8.99559V9.03336C77.1002 10.7539 78.2516 12.0515 79.7794 12.0515C81.1048 12.0515 82.4767 10.9216 82.4767 9.03336ZM3.21708e-05 0.117806L0 14.1256H2.56081L2.56084 0.117806H3.21708e-05ZM10.2852 3.69794C9.10677 3.69794 8.14721 4.16471 7.36458 5.12092V3.90489H4.80377V14.1256H7.36458V8.37625C7.36458 6.97593 8.1742 6.07108 9.42912 6.07108C10.684 6.07108 11.3812 6.87623 11.3812 8.33848V14.1241H13.942V7.64361C13.942 5.21004 12.5417 3.69643 10.2867 3.69643L10.2852 3.69794ZM32.7373 8.99559V9.03336C32.7373 12.0153 30.3549 14.3491 27.3128 14.3491C24.2707 14.3491 21.9423 12.0304 21.9423 9.06961V9.03185C21.9423 6.03936 24.3172 3.69643 27.3503 3.69643C30.3834 3.69643 32.7388 6.02425 32.7388 8.99408L32.7373 8.99559ZM24.5031 9.03336C24.5031 10.7267 25.7535 12.0515 27.3488 12.0515C28.9441 12.0515 30.1765 10.7977 30.1765 9.07112V9.03336C30.1765 7.30222 28.9456 5.99706 27.3113 5.99706C25.6771 5.99706 24.5016 7.25841 24.5016 8.9971V9.03487L24.5031 9.03336ZM19.5944 0C18.5869 0 17.8252 0.273418 17.269 0.833848C16.7082 1.40032 16.4234 2.25834 16.4234 3.38373V3.96078H15.1744V6.16625H16.4234V14.1256H18.9842V6.16625H21.5555V3.98042H18.9467V3.59068C18.9467 2.67224 19.3125 2.24323 20.0982 2.24323C20.5719 2.24323 20.9498 2.33689 21.3726 2.4804L21.575 2.54686V0.302119L21.4655 0.268886C21.0187 0.135954 20.449 0 19.5959 0H19.5944ZM33.7043 5.88226C34.1211 3.88525 35.9788 2.43055 37.9174 2.43055C39.5456 2.43055 40.4842 2.95472 41.4707 3.80217L41.5877 3.90338L41.6866 3.78404L43.1395 2.0393L43.2369 1.92148L43.12 1.82178C41.6072 0.527198 40.1274 0 38.0118 0C35.526 0 33.0162 1.45319 31.8017 3.54537C32.5994 4.17226 33.2501 4.96835 33.7043 5.88226ZM43.5728 6.47592V12.2207L43.5188 12.2675C42.4153 13.2177 40.5577 14.3507 37.9789 14.3507C36.1722 14.3507 34.5919 13.7948 33.3685 12.7419C33.9037 11.8899 34.2561 10.9125 34.376 9.85512C35.0972 11.1452 36.4121 11.9397 38.0538 11.9397C39.1513 11.9397 40.2368 11.6059 41.0479 11.0213V8.79468H37.7135V6.47743H43.5713L43.5728 6.47592Z"></path></svg> <span class="-mt-1.5 dark:text-white inline-block text-[#575757] text-[1.2rem]">LABS</span></div></div></a><div class="hidden md:flex"><a href="https://labs.infoguard.ch/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Home"><div class="flex items-center">Home</div></a><a href="https://labs.infoguard.ch/posts/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Posts"><div class="flex items-center">Posts</div></a><a href="https://labs.infoguard.ch/velociraptor/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Velociraptor"><div class="flex items-center">Velociraptor</div></a><a href="https://labs.infoguard.ch/advisories/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Advisories"><div class="flex items-center">Advisories</div></a><a href="https://labs.infoguard.ch/archive/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="Archive"><div class="flex items-center">Archive</div></a><a href="https://infoguard.ch/" class="rounded-lg font-bold active:scale-95 btn-plain px-5 scale-animation h-11" aria-label="InfoGuard" target="_blank"><div class="flex items-center">InfoGuard <svg height="1em" width="1em" class="transition -translate-y-[1px] dark:text-white/[0.2] ml-1 text-[0.875rem] text-black/[0.2]" data-icon="fa6-solid:arrow-up-right-from-square"><symbol id="ai:fa6-solid:arrow-up-right-from-square" viewBox="0 0 512 512"><path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32zM80 32C35.8 32 0 67.8 0 112v320c0 44.2 35.8 80 80 80h320c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v112c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16h112c17.7 0 32-14.3 32-32s-14.3-32-32-32z" fill="currentColor"></path></symbol><use href="#ai:fa6-solid:arrow-up-right-from-square"></use></svg></div></a></div><div class="flex"><astro-island client="only" component-export="default" component-url="/_astro/Search.DlUmB71x.js" opts="{&quot;name&quot;:&quot;Search&quot;,&quot;value&quot;:&quot;svelte&quot;}" props="{}" renderer-url="/_astro/client.svelte.DYqRqnAG.js" uid="ZEG73h"><div id="search-bar" class="hidden lg:flex transition-all items-center h-11 mr-2 rounded-lg
      bg-black/[0.04] hover:bg-black/[0.06] focus-within:bg-black/[0.06]
      dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10
"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"></path><!----></svg><!----> <input class="transition-all pl-10 text-sm bg-transparent outline-0
         h-full w-40 active:w-60 focus:w-60 text-black/50 dark:text-white/50 svelte-1gu5h8y" placeholder="Search"></div> <button aria-label="Search Panel" id="search-switch" class="btn-plain scale-animation lg:!hidden rounded-lg w-11 h-11 active:scale-90"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"></path><!----></svg><!----></button> <div id="search-panel" class="float-panel float-panel-closed search-panel absolute md:w-[30rem] top-20 left-4 md:left-[unset] right-4 shadow-2xl rounded-2xl p-2"><div id="search-bar-inside" class="flex relative lg:hidden transition-all items-center h-11 rounded-xl
      bg-black/[0.04] hover:bg-black/[0.06] focus-within:bg-black/[0.06]
      dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10
  "><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"></path><!----></svg><!----> <input placeholder="Search" class="pl-10 absolute inset-0 text-sm bg-transparent outline-0
               focus:w-60 text-black/50 dark:text-white/50 svelte-1gu5h8y"></div> <!----></div></astro-island><astro-island client="load" component-export="default" component-url="/_astro/LightDarkSwitch.gKnghUdE.js" opts="{&quot;name&quot;:&quot;LightDarkSwitch&quot;,&quot;value&quot;:true}" props="{}" renderer-url="/_astro/client.svelte.DYqRqnAG.js" uid="2ad1lD" await-children=""><div class="relative z-50" role="menu" tabindex="-1"><button aria-label="Light/Dark Mode" role="menuitem" class="relative btn-plain scale-animation rounded-lg h-11 w-11 active:scale-90" id="scheme-switch"><div class="absolute opacity-0"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M11 3V2q0-.425.288-.712T12 1t.713.288T13 2v1q0 .425-.288.713T12 4t-.712-.288T11 3m0 19v-1q0-.425.288-.712T12 20t.713.288T13 21v1q0 .425-.288.713T12 23t-.712-.288T11 22m11-9h-1q-.425 0-.712-.288T20 12t.288-.712T21 11h1q.425 0 .713.288T23 12t-.288.713T22 13M3 13H2q-.425 0-.712-.288T1 12t.288-.712T2 11h1q.425 0 .713.288T4 12t-.288.713T3 13m16.75-7.325l-.35.35q-.275.275-.687.275T18 6q-.275-.275-.288-.687t.263-.713l.375-.375q.275-.3.7-.3t.725.3t.288.725t-.313.725M6.025 19.4l-.375.375q-.275.3-.7.3t-.725-.3t-.288-.725t.313-.725l.35-.35q.275-.275.688-.275T6 18q.275.275.288.688t-.263.712m12.3.35l-.35-.35q-.275-.275-.275-.687T18 18q.275-.275.688-.287t.712.262l.375.375q.3.275.3.7t-.3.725t-.725.288t-.725-.313M4.6 6.025l-.375-.375q-.3-.275-.3-.7t.3-.725t.725-.288t.725.313l.35.35q.275.275.275.688T6 6q-.275.275-.687.288T4.6 6.025M7.75 16.25Q6 14.5 6 12t1.75-4.25T12 6t4.25 1.75T18 12t-1.75 4.25T12 18t-4.25-1.75m7.088-1.412Q16 13.675 16 12t-1.162-2.838T12 8T9.162 9.163T8 12t1.163 2.838T12 16t2.838-1.162M12 12"></path><!----></svg><!----></div> <div class="absolute"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-3.775 0-6.387-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.325-.05.575.088t.4.362t.163.525t-.188.575q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.275-.175.563-.162t.512.137q.25.125.388.375t.087.6q-.35 3.45-2.937 5.725T12 21m0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19m-.25-6.75"></path><!----></svg><!----></div> <div class="absolute opacity-0"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 17V7Q9.925 7 8.463 8.463T7 12t1.463 3.538T12 17m0 5q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"></path><!----></svg><!----></div></button> <div id="light-dark-panel" class="hidden lg:block absolute transition float-panel-closed top-11 -right-2 pt-5"><div class="card-base float-panel p-2"><button class="flex transition whitespace-nowrap items-center !justify-start w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95 mb-0.5"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] mr-3 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M11 3V2q0-.425.288-.712T12 1t.713.288T13 2v1q0 .425-.288.713T12 4t-.712-.288T11 3m0 19v-1q0-.425.288-.712T12 20t.713.288T13 21v1q0 .425-.288.713T12 23t-.712-.288T11 22m11-9h-1q-.425 0-.712-.288T20 12t.288-.712T21 11h1q.425 0 .713.288T23 12t-.288.713T22 13M3 13H2q-.425 0-.712-.288T1 12t.288-.712T2 11h1q.425 0 .713.288T4 12t-.288.713T3 13m16.75-7.325l-.35.35q-.275.275-.687.275T18 6q-.275-.275-.288-.687t.263-.713l.375-.375q.275-.3.7-.3t.725.3t.288.725t-.313.725M6.025 19.4l-.375.375q-.275.3-.7.3t-.725-.3t-.288-.725t.313-.725l.35-.35q.275-.275.688-.275T6 18q.275.275.288.688t-.263.712m12.3.35l-.35-.35q-.275-.275-.275-.687T18 18q.275-.275.688-.287t.712.262l.375.375q.3.275.3.7t-.3.725t-.725.288t-.725-.313M4.6 6.025l-.375-.375q-.3-.275-.3-.7t.3-.725t.725-.288t.725.313l.35.35q.275.275.275.688T6 6q-.275.275-.687.288T4.6 6.025M7.75 16.25Q6 14.5 6 12t1.75-4.25T12 6t4.25 1.75T18 12t-1.75 4.25T12 18t-4.25-1.75m7.088-1.412Q16 13.675 16 12t-1.162-2.838T12 8T9.162 9.163T8 12t1.163 2.838T12 16t2.838-1.162M12 12"></path><!----></svg><!----> Light</button> <button class="flex transition whitespace-nowrap items-center !justify-start w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95 mb-0.5 current-theme-btn"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] mr-3 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-3.775 0-6.387-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.325-.05.575.088t.4.362t.163.525t-.188.575q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.275-.175.563-.162t.512.137q.25.125.388.375t.087.6q-.35 3.45-2.937 5.725T12 21m0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19m-.25-6.75"></path><!----></svg><!----> Dark</button> <button class="flex transition whitespace-nowrap items-center !justify-start w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[1.25rem] mr-3 iconify iconify--material-symbols" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 17V7Q9.925 7 8.463 8.463T7 12t1.463 3.538T12 17m0 5q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"></path><!----></svg><!----> System</button></div></div></div></astro-island><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 md:!hidden" aria-label="Menu" id="nav-menu-switch" name="Nav Menu"><svg height="1em" width="1em" class="text-[1.25rem]" data-icon="material-symbols:menu-rounded"><symbol id="ai:material-symbols:menu-rounded" viewBox="0 0 24 24"><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:menu-rounded"></use></svg></button></div><div class="absolute float-panel-closed fixed float-panel px-2 py-2 right-4 transition-all" id="nav-menu-panel"><a href="https://labs.infoguard.ch/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Home</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded"><symbol id="ai:material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><path d="M12.6 12L8.7 8.1q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://labs.infoguard.ch/posts/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Posts</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://labs.infoguard.ch/velociraptor/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Velociraptor</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://labs.infoguard.ch/advisories/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Advisories</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://labs.infoguard.ch/archive/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Archive</div><svg height="1em" width="1em" class="transition text-[var(--primary)] text-[1.25rem]" data-icon="material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><use href="#ai:material-symbols:chevron-right-rounded"></use></svg> </a><a href="https://infoguard.ch/" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2" target="_blank"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">InfoGuard</div><svg height="1em" width="1em" class="transition -translate-x-1 dark:text-white/25 text-[0.75rem] text-black/25" data-icon="fa6-solid:arrow-up-right-from-square" viewBox="0 0 512 512"><use href="#ai:fa6-solid:arrow-up-right-from-square"></use></svg></a></div><astro-island client="only" component-export="default" component-url="/_astro/DisplaySettings.KStfPvg9.js" opts="{&quot;name&quot;:&quot;DisplaySettings&quot;,&quot;value&quot;:&quot;svelte&quot;}" props="{}" renderer-url="/_astro/client.svelte.DYqRqnAG.js" uid="ZjfqNG"><div id="display-setting" class="float-panel float-panel-closed absolute transition-all w-80 right-4 px-4 py-4 svelte-1s19bex"><div class="flex flex-row gap-2 mb-3 items-center justify-between"><div class="flex gap-2 font-bold text-lg text-neutral-900 dark:text-neutral-100 transition relative ml-3
            before:w-1 before:h-4 before:rounded-md before:bg-[var(--primary)]
            before:absolute before:-left-3 before:top-[0.33rem]">Theme Color <button aria-label="Reset to Default" class="btn-regular w-7 h-7 rounded-md active:scale-90 opacity-0 pointer-events-none"><div class="text-[var(--btn-content)]"><!----><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="text-[0.875rem] iconify iconify--fa6-solid" width="1em" height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M125.7 160H176c17.7 0 32 14.3 32 32s-14.3 32-32 32H48c-17.7 0-32-14.3-32-32V64c0-17.7 14.3-32 32-32s32 14.3 32 32v51.2l17.6-17.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0z"></path><!----></svg><!----></div></button></div> <div class="flex gap-1"><div id="hueValue" class="transition bg-[var(--btn-regular-bg)] w-10 h-7 rounded-md flex justify-center
            font-bold text-sm items-center text-[var(--btn-content)]">235</div></div></div> <div class="w-full h-6 px-1 bg-[oklch(0.80_0.10_0)] dark:bg-[oklch(0.70_0.10_0)] rounded select-none"><input type="range" min="0" max="360" class="slider svelte-1s19bex" id="colorSlider" step="5" style="width: 100%" aria-label="Theme Color"></div></div></astro-island></div></div></div></div><div class="absolute pointer-events-none w-full z-30" style="top:5.5rem"><div class="mx-auto max-w-[var(--page-width)] relative pointer-events-auto"><div class="transition left-0 right-0 duration-700 gap-4 grid grid-cols-[17.5rem_auto] grid-rows-[auto_1fr_auto] lg:grid-rows-[auto] md:px-4 mx-auto px-0 w-full" id="main-grid"><main class="overflow-hidden col-span-2 lg:col-span-1 transition-swup-fade" id="swup-container"><div class="onload-animation" id="content-wrapper"><div class="flex w-full relative mb-4 overflow-hidden rounded-[var(--radius-large)]"><div class="card-base pb-4 md:px-9 pt-6 px-6 relative w-full z-10" id="post-container"><div class="transition flex dark:text-white/30 flex-row gap-5 mb-3 onload-animation text-black/30"><div class="flex items-center"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg height="1em" width="1em" class="text-xl" data-icon="material-symbols:calendar-today-outline-rounded"><symbol id="ai:material-symbols:calendar-today-outline-rounded" viewBox="0 0 24 24"><path d="M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5zM5 8h14V6H5zm0 0V6z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:calendar-today-outline-rounded"></use></svg></div><div class="text-sm">2025-02-24</div></div><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg height="1em" width="1em" data-icon="material-symbols:notes-rounded"><symbol id="ai:material-symbols:notes-rounded" viewBox="0 0 24 24"><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h10q.425 0 .713.288T15 17t-.288.713T14 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:notes-rounded"></use></svg></div><div class="text-sm">3422 words</div></div><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg height="1em" width="1em" data-icon="material-symbols:schedule-outline-rounded"><symbol id="ai:material-symbols:schedule-outline-rounded" viewBox="0 0 24 24"><path d="M13 11.6V8q0-.425-.288-.712T12 7t-.712.288T11 8v3.975q0 .2.075.388t.225.337l3.3 3.3q.275.275.7.275T16 16t.275-.7t-.275-.7zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.325 0 5.663-2.337T20 12t-2.337-5.663T12 4T6.337 6.338T4 12t2.338 5.663T12 20" fill="currentColor"></path></symbol><use href="#ai:material-symbols:schedule-outline-rounded"></use></svg></div><div class="text-sm">17 minutes</div></div></div><div class="onload-animation relative"><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-5 before:left-[-1.125rem] before:top-[0.75rem] block dark:text-white/90 mb-3 md:before:w-1 md:text-[2.25rem]/[2.75rem] text-3xl text-black/90 w-full" data-pagefind-body="" data-pagefind-meta="title" data-pagefind-weight="10">Attacking EDRs Part 3: One Bug to Stop them all</div></div><div class="onload-animation"><div class="flex items-center dark:text-neutral-400 flex-wrap gap-4 gap-x-4 gap-y-2 mb-5 text-neutral-500"><div class="flex items-center"><div class="meta-icon"><svg height="1em" width="1em" class="text-xl" data-icon="material-symbols:person-outline"><symbol id="ai:material-symbols:person-outline" viewBox="0 0 24 24"><path d="M12 12q-1.65 0-2.825-1.175T8 8t1.175-2.825T12 4t2.825 1.175T16 8t-1.175 2.825T12 12m-8 8v-2.8q0-.85.438-1.562T5.6 14.55q1.55-.775 3.15-1.162T12 13t3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20zm2-2h12v-.8q0-.275-.137-.5t-.363-.35q-1.35-.675-2.725-1.012T12 15t-2.775.338T6.5 16.35q-.225.125-.363.35T6 17.2zm6-8q.825 0 1.413-.587T14 8t-.587-1.412T12 6t-1.412.588T10 8t.588 1.413T12 10m0 8" fill="currentColor"></path></symbol><use href="#ai:material-symbols:person-outline"></use></svg></div><a href="https://twitter.com/p0w1_" class="transition flex items-center font-medium whitespace-nowrap dark:hover:text-[var(--primary)] gap-1 hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="X profile of Manuel Feifel" target="_blank" rel="noopener noreferrer"><span>Manuel Feifel </span><svg height="1em" width="1em" class="text-lg" data-icon="fa6-brands:x-twitter"><symbol id="ai:fa6-brands:x-twitter" viewBox="0 0 512 512"><path d="M389.2 48h70.6L305.6 224.2L487 464H345L233.7 318.6L106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z" fill="currentColor"></path></symbol><use href="#ai:fa6-brands:x-twitter"></use></svg></a></div><div class="flex items-center"><div class="meta-icon"><svg height="1em" width="1em" class="text-xl" data-icon="material-symbols:book-2-outline-rounded"><symbol id="ai:material-symbols:book-2-outline-rounded" viewBox="0 0 24 24"><path d="M6 15.325q.35-.175.725-.25T7.5 15H8V4h-.5q-.625 0-1.062.438T6 5.5zM10 15h8V4h-8zm-4 .325V4zM7.5 22q-1.45 0-2.475-1.025T4 18.5v-13q0-1.45 1.025-2.475T7.5 2H18q.825 0 1.413.587T20 4v12.525q0 .2-.162.363t-.588.362q-.35.175-.55.5t-.2.75t.2.763t.55.487t.55.413t.2.562v.25q0 .425-.288.725T19 22zm0-2h9.325q-.15-.35-.237-.712T16.5 18.5q0-.4.075-.775t.25-.725H7.5q-.65 0-1.075.438T6 18.5q0 .65.425 1.075T7.5 20" fill="currentColor"></path></symbol><use href="#ai:material-symbols:book-2-outline-rounded"></use></svg></div><div class="flex items-center flex-row flex-nowrap"><a href="https://labs.infoguard.ch/archive/category/Vulnerability%20Research/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts in the Vulnerability Research category">Vulnerability Research</a></div></div><div class="flex items-center"><div class="meta-icon"><svg height="1em" width="1em" class="text-xl" data-icon="material-symbols:tag-rounded"><symbol id="ai:material-symbols:tag-rounded" viewBox="0 0 24 24"><path d="m9 16l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T6.3 18.8L7 16H4.275q-.5 0-.8-.387T3.3 14.75q.075-.35.35-.55t.625-.2H7.5l1-4H5.775q-.5 0-.8-.387T4.8 8.75q.075-.35.35-.55t.625-.2H9l.825-3.275Q9.9 4.4 10.15 4.2t.6-.2q.475 0 .775.375t.175.825L11 8h4l.825-3.275q.075-.325.325-.525t.6-.2q.475 0 .775.375t.175.825L17 8h2.725q.5 0 .8.387t.175.863q-.075.35-.35.55t-.625.2H16.5l-1 4h2.725q.5 0 .8.388t.175.862q-.075.35-.35.55t-.625.2H15l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T12.3 18.8L13 16zm.5-2h4l1-4h-4z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:tag-rounded"></use></svg></div><div class="flex items-center flex-row flex-nowrap"><div class="hidden mx-1.5 text-[var(--meta-divider)] text-sm">/</div><a href="https://labs.infoguard.ch/archive/tag/VulnResearch/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts with the VulnResearch tag">VulnResearch</a><div class="mx-1.5 text-[var(--meta-divider)] text-sm">/</div><a href="https://labs.infoguard.ch/archive/tag/RedTeaming/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts with the RedTeaming tag">RedTeaming</a><div class="mx-1.5 text-[var(--meta-divider)] text-sm">/</div><a href="https://labs.infoguard.ch/archive/tag/EDR/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts with the EDR tag">EDR</a><div class="mx-1.5 text-[var(--meta-divider)] text-sm">/</div><a href="https://labs.infoguard.ch/archive/tag/ALPC/" class="transition text-sm text-50 dark:hover:text-[var(--primary)] font-medium hover:text-[var(--primary)] link-lg whitespace-nowrap" aria-label="View all posts with the ALPC tag">ALPC</a></div></div></div></div><img alt="Attacking EDRs Part 3: One Bug to Stop them all" decoding="async" height="588" loading="lazy" src="https://labs.infoguard.ch/_astro/cortex_disabled.CXG6r_qh_Z1zhs4b.webp" width="1034" class="onload-animation banner-container mb-8 rounded-xl" id="post-cover"><div class="onload-animation mb-6 !max-w-none custom-md dark:prose-invert markdown-content prose prose-base" data-pagefind-body=""><p>This blog post is part of a series analyzing attack surface for Endpoint Detection and Response (EDR) solutions. Parts 1-3 are linked, with concluding notes for that initial sub-series in Part 3.</p><ul><li><a href="https://labs.infoguard.ch/posts/edr_part1_intro_-_security_analysis_of_edr_drivers/">Part 1</a> gives an overview of the attack surface of EDR software and describes the process for analysing drivers from the perspective of a low-privileged user.</li><li><a href="https://labs.infoguard.ch/posts/edr_part2_driver_analysis_results/">Part 2</a> describes the results of the EDR driver security analysis. A minor authentication issue in the Windows driver of the Cortex XDR agent was identified (CVE-2024-5905). Additionally a PPL-”bypass” as well as a detection bypass by early startup. Furthermore, snapshot fuzzing was applied to a Mini-Filter Communication Port of the Sophos Intercept X Windows Mini-Filter driver.</li><li><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/">Part 3</a> (<strong>this article</strong>) describes a DoS vulnerability affecting most Windows EDR agents. This vulnerability allows a low-privileged user to crash/stop the agent permanently by exploiting an issue in how the agent handles preexisting objects in the Object Manager’s namespace. Only some vendors assigned a CVE (CVE-2023-3280, CVE-2024-5909, CVE-2024-20671).</li><li><a href="https://labs.infoguard.ch/posts/attacking_edr_part4_fuzzing_defender_scanning_and_emulation_engine">Part 4</a> describes the fuzzing process of Microsoft Defender’s scanning and emulation engine <code>mpengine.dll</code>. Multiple out-of-bounds read and null dereference bugs were identified by using Snapshot Fuzzing with WTF and kAFL/NYX. These bugs can be used to crash the main Defender process as soon as the file is scanned. None of the bugs appear to be exploitable for code execution.</li></ul><section><h1 id="1-summary-of-alpc-blocking-vulnerability">1. Summary of ALPC Blocking Vulnerability<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#1-summary-of-alpc-blocking-vulnerability" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h1><blockquote><p>A DoS vulnerability has been discovered within the majority of tested EDRs on Windows that allows a low priviledged user to disable the EDR after a reboot:</p><ul><li>Palo Alto Cortex XDR</li><li>Microsoft Defender (for Endpoint)</li><li>Check Point Harmony</li><li>Kaspersky Endpoint Security for Business</li><li>Trend Micro Vision One XDR</li><li>Malwarebytes for Teams (only one module is disabled)</li><li>SentinelOne (only one executable is blocked with unknown consequences)</li><li>CrowdStrike XDR (only certain features are disabled)</li></ul><p>This can be achieved by opening a specific ALPC (Advanced Local Procedure Call) port or other ressources, typically utilized by the products themselves. Most EDRs use ALPC for inter-process communication in the user-mode components. However, none of the tested EDRs deals with the case if the requested port-name is already used. Consequently the initialization fails and either the user-mode service crashes or is in a non-functional state. The kernel-components which are still running, did not have any detecting or blocking functionality in the tests except for Crowdstrike that implements a large part in the drivers.<br>A scheduled task can be used to win the race to register the ALPC port. For example a user-logon trigger with high prioriy and <a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/winlogon-automatic-restart-sign-on--arso-">ARSO</a> is sufficient for most EDRs. Otherwise, event-triggers can be used but they require the <em>Logon as batch job</em> privilege.</p></blockquote><p>PoC code can be found in this repository:</p><a href="https://github.com/ig-labs/EDR-ALPC-Block-POC" class="card-github no-styling" target="_blank" id="GCuukk6v-card" repo="ig-labs/EDR-ALPC-Block-POC"><div class="gc-titlebar"><div class="gc-titlebar-left"><div class="gc-owner"><div class="gc-avatar" id="GCuukk6v-avatar" style="background-image: url(&quot;https://avatars.githubusercontent.com/u/191580969?v=4&quot;); background-color: transparent;"></div><div class="gc-user">ig-labs</div></div><div class="gc-divider">/</div><div class="gc-repo">EDR-ALPC-Block-POC</div></div><div class="github-logo"></div></div><div class="gc-description" id="GCuukk6v-description">Blocking Windows EDR agents by registering an own IPC-object in the Object Manager’s namespace (CVE-2023-3280, CVE-2024-5909, CVE-2024-20671)</div><div class="gc-infobar"><div class="gc-stars" id="GCuukk6v-stars">33</div><div class="gc-forks" id="GCuukk6v-forks">3</div><div class="gc-license" id="GCuukk6v-license">no-license</div><span class="gc-language" id="GCuukk6v-language">C++</span></div></a></section><section><h1 id="2-windows-alpc-introduction">2. Windows ALPC Introduction<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#2-windows-alpc-introduction" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h1><blockquote class="admonition bdm-note"><span class="bdm-title">NOTE</span><p>You do not need to know any of this to understand or exploit the vulnerability, but it may be useful if you want to conduct your own research.</p></blockquote><p>Windows Advanced (or Asynchronous) Local Procedure Call (ALPC) is an inter-process communication (IPC) mechanism that allows processes, services and drivers on the same host to communicate with each other via pre-defined interfaces. Other IPC mechanisms include named pipes, shared memory, and remote procedure call (RPC). ALPC is a fast and efficient mechanism heavily used within the Windows operating system.</p><p>ALPC itself is undocumented by Microsoft and developers are not indented to use it directly. However, there are official libraries such as RPCRT4.dll which use ALPC under the hood. <a href="https://www.youtube.com/watch?v=UNpL5csYC1E&amp;ab_channel=SyScan">Alex Ionescu reverse engineered and published internals of ALPC</a>.</p><p>If ALPC can be used directly or with the RPC Run Time. By default, it registers a port object at the location <code>\RPC Control\Test-Port</code>) and afterwards a client can connect to it. If plain ALPC is used, raw messages can be send in both directions. Typically, ALPC is used as one implementation of <a href="https://learn.microsoft.com/en-us/windows/win32/rpc/protocol-sequence-constants">Windows RPC “<strong>ncalrpc</strong>”</a>. The library RPCRT4.dll provides functionality for developers to use it. The server registers interfaces where each interface can have multiple methods through IDL-files which are compiled and integrated into the server and client (client/server stub).</p><p>The registered ALPC ports can be looked up in <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/winobj">WinObj from SysInternals</a>.</p><p><img alt="" decoding="async" height="548" loading="lazy" src="https://labs.infoguard.ch/_astro/winobj_alpc.auc5oVnn_2eKOeF.webp" width="752"></p><p class="figcaption">ALPC Ports in WinObj</p><p></p><p><img alt="" decoding="async" height="221" loading="lazy" src="https://labs.infoguard.ch/_astro/alpc_overview.DIAtw8M0_Z1VnbcW.webp" width="263"></p><p class="figcaption"><a href="https://learn.microsoft.com/en-us/windows/win32/rpc/how-rpc-works">How RPC works</a></p><p></p><p>The following decompiled output from IDA shows how an ALPC port is registered using the RPC Runtime library (RPCRT4.dll) in Cortex.</p><p><img alt="" decoding="async" height="555" loading="lazy" src="https://labs.infoguard.ch/_astro/rpctrt4_alpc_coretex_usage_marked.CxpvbnvJ_19O9sc.webp" width="1082"></p><p class="figcaption">ALPC-RPC Server Registration in Cortex</p><p></p><p><strong>Some important notes:</strong></p><ul><li>If the port name is NULL, a random port name such as LRPC-71dcaff45b0f633aad is given</li><li>A port can be restricted using <a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/security-descriptors">Security Descriptors</a></li><li>If no callback function is provided (and no Security Descriptor), every client can establish a connection</li><li>The RPC Server can be registered at the RPC Endpoint Mapper using the function <a href="https://learn.microsoft.com/en-us/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepregister">RpcEpRegister</a><strong>.</strong> Most EDR ports are not registered and depending on the method you use to enumerate the ports, you don’t see them (for example when using <a href="https://github.com/silverf0x/RpcView">RpcView</a>). ProcessHacker/SystemInformer displays all ports in the Handles-Tab</li><li>Clients can connect using the port name or by defining the interface UUID and version contained in the interface description (if it is registered at the endpoint mapper)</li></ul><p>Vulnerabilities in ALPC usage can be categorized as follows (though other categories probably exist):</p><ul><li>Weak or missing access control leading to access to sensitive functionality or data</li><li>Memory corruptions in handling function parameters (there is no official implementation to use RPC with managed languages)</li><li>Impersonation vulnerabilities (usefulness In realistic scenarios unclear)</li><li>DoS: Blocking communication (this type of vulnerability, uncovered in this research, is, to our knowledge, previously not discussed publicly).</li></ul><p>For a better understanding of ALPC and how to interact with it from a testing perspective, we recommend the following talks or the corresponding blog post:</p><ul><li><a href="https://www.youtube.com/watch?v=2GJf8Hrxm4k&amp;t=2672s&amp;ab_channel=HackInTheBoxSecurityConference">Reimplementing Local RPC In .Net - James Forshaw</a></li><li><a href="https://googleprojectzero.blogspot.com/2019/12/calling-local-windows-rpc-servers-from.html">Calling Local Windows RPC Servers from .NET - Project Zero</a></li><li><a href="https://clearbluejar.github.io/posts/from-ntobjectmanager-to-petitpotam/">From NtObjectManager to PetitPotam - clearbluejar</a></li></ul><p>For more details on ALPC security and reverse engineering, see the blog posts by 0xcsandker:</p><ul><li><a href="https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html">Offensive Windows IPC Internals 3: ALPC</a></li><li><a href="https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html">Debugging and Reversing ALPC</a></li></ul></section><section><h1 id="3-alpc-research-results">3. ALPC Research Results<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#3-alpc-research-results" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h1><p>We began looking into ALPC after encountering it while investigating password handling in the Cortex driver cyvrmtng.sys (see <a href="https://labs.infoguard.ch/posts/edr_part2_driver_analysis_results/">Part 2</a>).</p><p>The first step is to enumerate the ALPC ports and check the Security Descriptors.</p><section><h2 id="31-enumerate-alpc-ports">3.1 Enumerate ALPC-ports<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#31-enumerate-alpc-ports" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><section><h3 id="first-method-windbg">First Method: WinDBG<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#first-method-windbg" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h3><div class="relative code-block"><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-overlayscrollbars="host"><div class="os-size-observer"><div class="os-size-observer-listener"></div></div><div class="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden" tabindex="-1" style="margin-right: 0px; margin-bottom: 0px; margin-left: 0px; top: 0px; right: auto; left: 0px; width: calc(100% + 0px); padding: 0px;"><code><span class="line"><span>0: kd&gt; !process 0 0 cyserver.exe</span></span>
<span class="line"><span>PROCESS ffff970f8e6df080</span></span>
<span class="line"><span>    SessionId: 0  Cid: 24f8    Peb: dd298fc000  ParentCid: 02f4</span></span>
<span class="line"><span>    DirBase: 239c24000  ObjectTable: ffffaa08f1ffb400  HandleCount: 846.</span></span>
<span class="line"><span>    Image: cyserver.exe</span></span>
<span class="line"><span></span></span>
<span class="line"><span>0: kd&gt; !alpc /lpp ffff970f8e6df080</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Ports created by the process ffff970f8e6df080:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ffff970f8e76ad30('OLEC4EA145C32D5AB917AD12FA45688') 0, 1 connections</span></span>
<span class="line"><span>    ffff970f85fe1a80 0 -&gt;ffff970f87165a80 0 ffff970f87ca5080('svchost.exe')</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ffff970f8ab938f0('Palo-Alto-Networks-Traps-ESM-Rpc') 0, 1 connections</span></span>
<span class="line"><span>    ffff970f870ac0b0 0 -&gt;ffff970f9209f070 0 ffff970f8e6df080('cyserver.exe')</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ffff970f8c4d6aa0('Palo-Alto-Networks-Traps-Report-Rpc') 0, 0 connections</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ffff970f8b2e9760('TasWorkerServer_811AC91A') 4, 4 connections</span></span>
<span class="line"><span>    ffff970f871242c0 0 -&gt;ffff970f8d0e2510 0</span></span>
<span class="line"><span>ffff970f8eeb1080('tlaworker.exe')</span></span>
<span class="line"><span>    ffff970f871682c0 0 -&gt;ffff970f8d0cd7a0 0</span></span>
<span class="line"><span>ffff970f8eeaf080('tlaworker.exe')</span></span>
<span class="line"><span>    ffff970f87035910 0 -&gt;ffff970f85f35910 0</span></span>
<span class="line"><span>ffff970f8eeb0080('tlaworker.exe')</span></span>
<span class="line"><span>    ffff970f87046910 0 -&gt;ffff970f87068910 0</span></span>
<span class="line"><span>ffff970f8efe2080('tlaworker.exe')</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ffff970f91dc4d30('Palo-Alto-Networks-Traps-DB-Rpc') 0, 0 connections</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ffff970f927f2d30('Palo-Alto-Networks-Traps-Scan-Rpc') 0, 0 connections</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ffff970f8eeafda0('CyveraPort') 0, 1 connections</span></span>
<span class="line"><span>    ffff970f8bb93d10 0 -&gt;ffff970f8e54ec70 0 ffff970f84c7e040('System')</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Ports the process ffff970f8e6df080 is connected to:</span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>0: kd&gt; !object ffff970f8ab938f0</span></span>
<span class="line"><span>Object: ffff970f8ab938f0  Type: (ffff970f84cf7900) ALPC Port</span></span>
<span class="line"><span>    ObjectHeader: ffff970f8ab938c0 (new version)</span></span>
<span class="line"><span>    HandleCount: 1  PointerCount: 32757</span></span>
<span class="line"><span>    Directory Object: ffffaa08e5dfe480  Name: Palo-Alto-Networks-Traps-ESM-Rpc</span></span>
<span class="line"><span></span></span>
<span class="line"><span>0: kd&gt; dx (((nt!_OBJECT_HEADER*)0xffff970f8ab938c0)-&gt;SecurityDescriptor)</span></span>
<span class="line"><span>(((nt!_OBJECT_HEADER*)0xffff970f8ab938c0)-&gt;SecurityDescriptor) :</span></span>
<span class="line"><span>0xffffaa08ea537d6d [Type: void *]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>0: kd&gt; !sd 0xffffaa08ea537d60 1</span></span>
<span class="line"><span>-&gt;Revision: 0x1</span></span>
<span class="line"><span>-&gt;Sbz1    : 0x0</span></span>
<span class="line"><span>-&gt;Control : 0x8804</span></span>
<span class="line"><span>            SE_DACL_PRESENT</span></span>
<span class="line"><span>            SE_SACL_AUTO_INHERITED</span></span>
<span class="line"><span>            SE_SELF_RELATIVE</span></span>
<span class="line"><span>-&gt;Owner   : S-1-5-18 (Well Known Group: NT AUTHORITY\SYSTEM)</span></span>
<span class="line"><span>-&gt;Group   : S-1-5-18 (Well Known Group: NT AUTHORITY\SYSTEM)</span></span>
<span class="line"><span>-&gt;Dacl    :</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;AclRevision: 0x2</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Sbz1       : 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;AclSize    : 0x5c</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;AceCount   : 0x4</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Sbz2       : 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;AceType: ACCESS_ALLOWED_ACE_TYPE</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;AceFlags: 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;AceSize: 0x14</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;Mask : 0x00030001</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[0]: -&gt;SID: S-1-1-0 (Well Known Group: localhost\Everyone)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[1]: -&gt;AceType: ACCESS_ALLOWED_ACE_TYPE</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[1]: -&gt;AceFlags: 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[1]: -&gt;AceSize: 0x14</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[1]: -&gt;Mask : 0x00030001</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[1]: -&gt;SID: S-1-5-12 (Well Known Group: NT AUTHORITY\RESTRICTED)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[2]: -&gt;AceType: ACCESS_ALLOWED_ACE_TYPE</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[2]: -&gt;AceFlags: 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[2]: -&gt;AceSize: 0x18</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[2]: -&gt;Mask : 0x001f0001</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[2]: -&gt;SID: S-1-5-32-544 (Alias: BUILTIN\Administrators)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[3]: -&gt;AceType: ACCESS_ALLOWED_ACE_TYPE</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[3]: -&gt;AceFlags: 0x0</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[3]: -&gt;AceSize: 0x14</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[3]: -&gt;Mask : 0x001f0001</span></span>
<span class="line"><span>-&gt;Dacl    : -&gt;Ace[3]: -&gt;SID: S-1-5-18 (Well Known Group: NT AUTHORITY\SYSTEM)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-&gt;Sacl    :  is NULL</span></span></code></div><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></pre><button class="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out"><div><svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg> <svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div>
      </button></div><p>To sum it up, the following ALPC-ports exist</p><ul><li>Palo-Alto-Networks-Traps-DB-Rpc<ul><li>Security Descriptor: S-1-1-0 (localhost\Everyone)</li><li>Client: cyapi.dll</li><li>Server: cysvc.dll</li></ul></li><li>Palo-Alto-Networks-Traps-ESM-Rpc<ul><li>Security Descriptor: S-1-1-0 (localhost\Everyone)</li><li>Client: cysvc.dll</li><li>Server: cyverau.dll</li></ul></li><li>Palo-Alto-Networks-Traps-Report-Rpc<ul><li>Security Descriptor: S-1-1-0 (localhost\Everyone)</li><li>Client: ?</li><li>Server: cysvc.dll</li></ul></li><li>Palo-Alto-Networks-Traps-Scan-Rpc<ul><li>Security Descriptor: S-1-1-0 (localhost\Everyone)</li><li>Client: cyapi.dll</li><li>Server: cysvc.dll</li></ul></li><li>TasWorkerServer_***<ul><li>Security Descriptor: S-1-1-0 (localhost\Everyone)</li><li>Client: tlaworker.exe</li><li>Server: cysvc.dll</li></ul></li><li>CyveraPort<ul><li>Security Descriptor: S-1-5-18 (NT AUTHORITY\SYSTEM)</li><li>Client: kernel-driver</li><li>Server: cyserver.exe</li></ul></li></ul></section><section><h3 id="second-method-using-processhacker">Second Method using ProcessHacker:<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#second-method-using-processhacker" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h3><p>This method is easier and faster for getting an overview but provides fewer details:</p><p><img alt="" decoding="async" height="324" loading="lazy" src="https://labs.infoguard.ch/_astro/processhacker_alpc.CcK5cPSE_1Gx3rd.webp" width="798"></p><blockquote class="admonition bdm-note"><span class="bdm-title">NOTE</span><p>Tools such as RPCView and many others don’t display these ports because they are not registered in the RPC Endpoint Mapper and they are created by a ProtectedProcess Anti-Malware process. ProcessHacker/SystemInformer ships a driver which allows to access these processes.</p></blockquote></section></section><section><h2 id="32-connecting-to-alpc-port">3.2 Connecting to ALPC Port<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#32-connecting-to-alpc-port" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>The password we traced is transmitted via <em>Palo-Alto-Networks-Traps-ESM-Rpc.</em> Initially, we attempted to connect using the ALPC examples from 0xcsandker, released toghether with <a href="https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html">this blog post</a>. Connecting to the port was successful but sending messages did not seem to work as breakpoints in the receiver were not triggered. However, we shortly noticed, that this approach does not make a lot of sense as ALPC is not used directly but as a RPC-method from rpcrt4.dll with an IDL (Interface definition language).</p><p>We used the <a href="https://googleprojectzero.blogspot.com/2019/12/calling-local-windows-rpc-servers-from.html">NtObjectManager tooling from James Forshaw</a> to establish a connection to the port:</p><p><img alt="" decoding="async" height="1061" loading="lazy" src="https://labs.infoguard.ch/_astro/ntobjectmanager_alpc.CQu1s6rB_TP5w9.webp" width="1159"></p><p class="figcaption">Connecting to an ALPC port from Cortex</p><p></p><p>The reason for the “Access is denied” is the Interface Callback of the ALPC registration:</p><p><img alt="" decoding="async" height="221" loading="lazy" src="https://labs.infoguard.ch/_astro/cyerau_alpc1.DhOQeaFm_Z18F3zY.webp" width="993"></p><p class="figcaption">Registration of the ALPC port</p><p></p><p><img alt="" decoding="async" height="590" loading="lazy" src="https://labs.infoguard.ch/_astro/cyerau_alpc2.m94KVocl_Z1b8BsK.webp" width="1091"></p><p class="figcaption">The <code>IfCallback</code> function of the ALPC port</p><p></p><p>The function <code>CyOpenServerProcess</code> retrieves the process from cyserver.exe via the dirver. Afterwards it gets the process ID from the ALPC client via <code>I_RpcBindingInqLocalClientPID</code> and then it compares the PIDs. If they do not match a connection is rejected.</p></section><section><h2 id="33-impersonating-alpc-server">3.3 Impersonating ALPC Server<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#33-impersonating-alpc-server" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>As it was not successful to use a client to obtain sensitive data, we attempted to impersonate the server by opening the ALPC before Cortex starts. We used a slightly modified version of the <a href="https://github.com/csandker/InterProcessCommunication-Samples/blob/master/ALPC/CPP-ALPC-Basic-Client-Server/CPP-ALPC-Basic-Server/CPP-ALPC-Basic-Server.cpp">CPP-ALPC-Basic-Server.cpp</a> example to start a ALPC server at <code>\RPC Control\Palo-Alto-Networks-Traps-ESM-Rpc</code>. We stopped cyserver with cytool and then started the fake server. Afterwards we started cyserver again.</p><p><img alt="" decoding="async" height="932" loading="lazy" src="https://labs.infoguard.ch/_astro/alpc_ESM_serverimpersonation_marked.BV7gXkNX_2dnOBd.webp" width="1366"></p><p class="figcaption">ALPC Server “Impersonation”</p><p></p><p>The screenshot shows that cyserver.exe connected to the port and sent messages. Because Cyserver.exe itself did not open this, some functionality must be broken. To test this we set up an ALPC server for all the ALPC ports used by Cyserver.exe (except \Cyveraport which requires administrative privileges). After starting this, Cyserver crashed during the initialization.</p><p><img alt="" decoding="async" height="384" loading="lazy" src="https://labs.infoguard.ch/_astro/cortex_crash_1.3AO1LQHT_Z1WjVBC.webp" width="1148"></p><p>This was promising, as Cortex neither prevented nor alerted anything without the user-mode component Cyserver. For example, Mimikatz could be launched and executed without modification.</p><p>The only remaining step was to achieve the same effect during startup without requiring administrative privileges. A scheduled task in combination with Windows ARSO (see this <a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/winlogon-automatic-restart-sign-on--arso-">documentation</a>) successfully disabled Cortex.</p><p><img alt="" decoding="async" height="588" loading="lazy" src="https://labs.infoguard.ch/_astro/cortex_disabled.CXG6r_qh_Z1zhs4b.webp" width="1034"></p><p>The next section details how to exploit this vulnerability.</p><p>We tested as many EDRs as possible for the same vulnerability and found, surprisingly, that most were vulnerable. The concept for exploiting this vulnerability is quite simple, so we expected some EDRs to have addressed it. The following list of EDRs are vulnerable:</p><ul><li>Palo Alto Cortex XDR</li><li>Microsoft Defender (for Endpoint)</li><li>Check Point Harmony</li><li>Kaspersky Endpoint Security for Business</li><li>Trend Micro Vision One XDR</li><li>Malwarebytes for Teams (only one module is disabled)</li><li>SentinelOne (only one executable is blocked with unknown consequences)</li><li>Crowdstrike XDR (only certain features are disabled)</li></ul></section><section><h2 id="34-exploit-conditions">3.4 Exploit Conditions<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#34-exploit-conditions" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>Successful exploitation of the ALPC-block DoS vulnerability requires the following preconditions:</p><ol><li><p>The host reboots (either manually with shutdown privileges or by waiting)</p></li><li><p>The target ALPC port is registered in a namespace where a low-privileged user has write permissions. The default name space is “\RPC Control” where every user can create objects.</p></li><li><p>Permissions to create a scheduled task (allowed by default)</p><ul><li>Alternatively create or modify a service (only for local admins by default) or other methods for early startup (e.g. DLL Hijacking)</li></ul></li><li><p>Exploit registers ALPC ports <strong>before</strong> the EDR during the Windows startup</p><ul><li><p>The likelyhood of winning this race varies between EDRs but for most it is 100% reliable in our tests:</p><ul><li>For example Cortex (cyserver.exe) takes a long time to initialize itself and also has startup-dependencies to other components. Consequently, it is quite easy to be faster.</li></ul></li><li><p>If this is exploited by a low-privileged user, it is important to choose a method which starts during the startup of Windows and not after an interactive logon.</p><ul><li><p>A default user does not have the permission to create a scheduled task with the trigger “at startup”</p></li><li><p>There are two options we used to exploit this:</p><ol><li><p>“At log on” Trigger in combination with Automatic Restart Sign-On (ARSO) (as per this <a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/winlogon-automatic-restart-sign-on--arso-">reference</a>). ARSO was built to improve the update process and temporarly stores the user credentials to do an auto-login of the current user. However, it can also be used without updating the OS. The following screenshot from the <a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/winlogon-automatic-restart-sign-on--arso-">Microsoft ASRO documentation</a> provides an overview of when ARSO is applied</p></li></ol><ul><li><p><img alt="" decoding="async" height="229" loading="lazy" src="https://labs.infoguard.ch/_astro/ARSO_overview.DZWSqUSl_Z2a5sIJ.webp" width="888"></p></li><li><p>The ARSO configuration can also be set via group policy or in the Sign-in options</p></li><li><p><img alt="" decoding="async" height="340" loading="lazy" src="https://labs.infoguard.ch/_astro/ARSO_signin-options.Br1Z82VG_2v65tG.webp" width="572"></p></li><li><p><img alt="" decoding="async" height="709" loading="lazy" src="https://labs.infoguard.ch/_astro/scheduled_task_1_1.BiKYZr7b_Z1ccp6r.webp" width="925"></p></li><li><p><img alt="" decoding="async" height="662" loading="lazy" src="https://labs.infoguard.ch/_astro/scheduled_task_1_2.Bmb3khCx_15LREA.webp" width="917"></p></li></ul><ol start="2"><li><p>Scheduled task with an event-trigger (on any Event ID happening early during the Windows startup). The password of the user needs to be stored in the scheduled task in this case which requires the right <a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/log-on-as-a-batch-job">“SeBatchLogonRight”</a>. On unmanaged Windows hosts this permission is not given by default. However, on several AD-joined clients, this was enabled in different companies.</p></li></ol><ul><li>One of the first events that can be used is Event ID “6” from FilterManager which is created if a filter driver is loaded</li><li><img alt="" decoding="async" height="957" loading="lazy" src="https://labs.infoguard.ch/_astro/scheduled_task_2_1.CEjB8A8h_ZIM9jP.webp" width="835"></li></ul></li><li><p>Generally, the process priority of the scheduled task should be set as high as possible. The default priority of a scheduled task is 7 (BELOW\_NORMAL). The priority cannot be adjusted in the GUI. The scheduled task can be exported to an XML where the priority can be adjusted. Afterwards it can be imported again. This could also be done programmatically.</p></li><li><p>Priority 0 (REALTIME) and 1 (HIGH) can only be used by local administrators.</p></li><li><p>Priority 2 (ABOVE\_NORMAL) can be set by all accounts</p></li></ul></li></ul></li></ol></section><section><h2 id="35-mitigation">3.5 Mitigation<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#35-mitigation" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>This vulnerability cannot be easily fixed because it is an architectural flaw rather than a coding error. The following suggestions primarily mitigate the effects but do not address the root cause:</p><ul><li>Use a randomly generated port name (e.g. UUID)</li><li>Generate an alert of an EDR is not active but the host itself is online</li><li>If a required port is in use, kill the corresponding application via the driver and flag it as malware</li><li>Limit the attack surface to administrative users: Use Port names in the root directory (e.g. \TestPort) which are only accessible to administrative users.</li><li>General recommendation: Ensure the kernel-components can send an alert if a user-mode component is not active.</li><li>Monitor processes via the driver before the user-mode process is started and cache results to sent them later</li></ul><p>Some fixes of vendors where analyzed with the following results:</p><section><h3 id="vendor-fixes">Vendor Fixes<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#vendor-fixes" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h3><p>We examined the fixes from Cortex XDR for <a href="https://security.paloaltonetworks.com/CVE-2023-3280">CVE-2023-3280</a> and <a href="https://security.paloaltonetworks.com/CVE-2024-5909">CVE-2024-5909</a> in more detail.</p><p>CVE-2023-3280 was “fixed” by blocking the registering of ports used by Cortex (e.g. <em>Palo-Alto-Networks-Traps-DB-Rpc</em>) by the driver. As soon as the user-mode component was ready to register the port, an IOCTL was send to the driver to release the ports. However, all processes are now allowed to register the port and it opens up a short timeframe to win the race.</p><p>Only one additional line in the exploit code was required to bypass the “fix”:</p><div class="relative code-block"><pre class="astro-code github-dark" data-language="c" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-overlayscrollbars="host"><div class="os-size-observer"><div class="os-size-observer-listener"></div></div><div class="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden" tabindex="-1" style="margin-right: 0px; margin-bottom: 0px; margin-left: 0px; top: 0px; right: auto; left: 0px; width: calc(100% + 0px); padding: 0px;"><code><span class="line"><span style="color:#b392f0">register_port</span><span style="color:#e1e4e8">();</span></span></code></div><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></pre><button class="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out"><div><svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg> <svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div>
      </button></div><p>to</p><div class="relative code-block"><pre class="astro-code github-dark" data-language="c" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-overlayscrollbars="host"><div class="os-size-observer"><div class="os-size-observer-listener"></div></div><div class="" data-overlayscrollbars-viewport="scrollbarHidden overflowXHidden overflowYHidden" tabindex="-1" style="margin-right: 0px; margin-bottom: 0px; margin-left: 0px; top: 0px; right: auto; left: 0px; width: calc(100% + 0px); padding: 0px;"><code><span class="line"><span style="color:#f97583">while</span><span style="color:#e1e4e8">(not_successful){</span></span>
<span class="line"><span style="color:#b392f0">  register_port</span><span style="color:#e1e4e8">();</span></span>
<span class="line"><span style="color:#e1e4e8">}</span></span></code></div><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-dark px-2 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></pre><button class="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out"><div><svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg> <svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div>
      </button></div><p>After reporting it to PaloAlto another fix was published in 2024 (CVE-2024-5909). The port names are now UUIDs set or retreived via IOCTls.</p><p>We did not examine the fixed versions of other vendors.</p></section></section><section><h2 id="36-blocking-edrs-with-namedpipes">3.6 Blocking EDRs with NamedPipes<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#36-blocking-edrs-with-namedpipes" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>SentinelOne Singularity XDR can be blocked by registering NamedPipes instead of ALPC ports. This demonstrates that other resources can be exploited by the same type of vulnerability. The exploitation is tricky as the NamedPipe is not a static string: <code>\Device\NamedPipe\DFIScanner.Inline.3360.3720Pipe</code> The first number is a PID and the second number is a TID. During the first start of the EDR during the Windows startup, the values are usually in the range of 2500-4000. The exploit did first register the most likely ports and afterwards other ranges from 0-12000. This technique could be successfully exploited with a low privileged user similiar to the other ALPC based vulnerabilities.</p></section><section><h2 id="37-further-research">3.7 Further Research<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#37-further-research" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h2><p>This research project only scratched the surface of the existing attack surface of EDRs (or XDRs). Further blog posts on this topic are likely. If you have read this entire post, you will have noticed several areas that warrant further investigation.</p><p>The following topics related to the research described in this post should be addressed:</p><ul><li>Testing the same ALPC DoS vulnerability for further vendors</li><li>Testing other IPC-methods (e.g. NamedPipes) or completely other resources to block EDRs</li><li>Testing accessible ALPC functions for logic bugs or memory corruptions</li><li>Spoofing an IPC-server or IPC-client to modify the behavior or to extract sensitive data</li><li>Analysing the driver interfaces of further EDR products</li><li>Analyzing fixes and searching for potential bypasses such as the one discussed in <a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#vendor-fixes">this section</a></li></ul></section></section><section><h1 id="4-disclosure-process">4 Disclosure Process<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#4-disclosure-process" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h1><p>Well… one would think that this would be a rather positive experience compared to other vendors because they make security products themselves. This was not the case for the majority of vendors. First of all, most vendors required more than 90 days to release a fix or did not fix it at all. Most disclosure reports have been sent between April 2023 and September 2023. Some reports have been sent later, as access to some products was not given in 2023. No vendors did provide information on how they fixed it after (e.g. “that is considered proprietary Cortex XDR agent information”) although some requested a retest.</p><p>Second, two vendors responded with unbelievably incompetent questions and comments. One example, after we sent the requested (PoC) code, was the following:</p><blockquote><p>“The cpp program needs to be converted to exe? If no then, what’s the command that you are running?”</p></blockquote><p>An Overview of the disclosure process:</p><ul><li>PaloAlto Cortex XDR<ul><li>05.04.2023: Reported ALPC-block vulnerability to PaloAlto</li><li>13.09.2023: Released Advisory <a href="https://security.paloaltonetworks.com/CVE-2023-3280">CVE-2023-3280</a></li><li>25.09.2023: Reported a bypass for their “fix” to PaloAlto</li><li>13.10.2023: PaloAlto reponded that that it will take time to address the issue</li><li>12.06.2024: Released Advisory <a href="https://security.paloaltonetworks.com/CVE-2024-5905">CVE-2024-5905</a></li></ul></li><li>Microsoft Defender (for Endpoint)<ul><li>31.05.2023: Reported ALPC-block vulnerability to Microsoft</li><li>19.09.2023: Fix is in testing process (“we plan to release it as part of the October Patch Tuesday”)</li><li>13.11.2023: “During the staggered deployment for the fix to the issue you reported, the team noticed that the fix was causing some crashes on systems with the update installed. … this will not be completed until December at the earliest.”</li><li>12.03.2024: Released Advisory <a href="https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2024-20671">CVE-2024-20671</a></li></ul></li><li>CheckPoint Harmony<ul><li>07.07.2023: Reported ALPC-block vulnerability to CheckPoint</li><li>17.08.2023: After several clarification mails, they still cannot reproduce it.</li></ul></li><li>Kaspersky Endpoint Security for Business:<ul><li>07.07.2023: Reported ALPC-block vulnerability to Kaspersky</li><li>12.07.2023: Kaspersky reproduced vulnerability</li><li>13.09.2023: Kaspersky fixed the issue</li><li>21.11:2023: After asking for a CVE, they responded that they will not publish a CVE</li></ul></li><li>TrendMicro Vision One XDR<ul><li>10.07.2023: Reported ALPC-block vulnerability to TrendMicro</li><li>02.08.2023: After some clarification mails, no further information was provided by TrendMicro</li></ul></li><li>Malwarebytes for Teams<ul><li>13.07.2023: Reported ALPC-block vulnerability to Malwarebytes that one module can be disabled but not the whole product. Asked them to provide a test license for their Business EDR product which I did not receive.<ul><li>The employee assigned to this case did not have the knowledge to understand and reproduce the case.</li></ul></li><li>02.10.2023: The case was closed without releasing a fix or providing access to the EDR product with more features.</li></ul></li><li>SentinelOne Singularity XDR<ul><li>We did not have a fully working environment to test this product.</li><li>ALPC block<ul><li>25.07.2023: Reported that a certain process can be crashed by blocking an ALPC port. However, we could not reproduce it reliably in the limited test environment. We asked for a test license to do a further analysis.</li><li>03.10.2023: After asking for an update on the status, the assigned employee at HackerOne did not know anything.</li></ul></li><li>NamedPipe block<ul><li>29.09.2023: Reported that the whole product can be blocked by registering NamedPipes instead of ALPC ports.</li><li>02.11.2023: SentinelOne reproduced it. A timeline for a fix is not known.</li><li>22.06.2024: SentinelOne asked for a retest of their fix. However, this was not possible because SentinelOne did not want to provide a test license.</li></ul></li></ul></li><li>Crowdstrike XDR<ul><li>Initially, no access to a Crowdstrike environment was available. Therefore, it was reported later.</li><li>26.06.2024: Reported that the a certain process can be crashed by blocking an ALPC port. However, some functionality was still available.</li><li>26.06.2024: Crowdstrike reproduced it on the same day.</li><li>05.08.2024: “After careful evaluation, we have determined that the security finding is considered low impact and does not meet the criteria for a CVE” because the kernel-mode driver remains fully operational.</li><li>It is unknown when a fix was published.</li></ul></li></ul></section><section><h1 id="5-conclusion">5 Conclusion<a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#5-conclusion" class="anchor"><span class="anchor-icon" data-pagefind-ignore="true">#</span></a></h1><p>This research project demonstrated that EDRs can contain relatively simple vulnerabilities. A “novel” type of vulnerability was identified that allows disabling or bypassing several widely used EDRs. Exploitation is relatively easy, requiring only the setup of a scheduled task that registers a specific ALPC port. To our knowledge, similar vulnerabilities have not been previously published for EDR or antivirus software. However, we could not identify straightforward vulnerabilities such as insecure driver interfaces accessible to low-privileged users. Nevertheless, several EDRs have a direct kernel attack surface accessible to low-privileged users. Fully understanding the true attack surface and authorization model of these drivers requires extensive reverse engineering, which could not be fully completed due to time constraints. In our opinion, the field of security research on EDR attack surfaces has not been explored in sufficient detail.</p></section></div><div class="transition relative rounded-xl bg-[var(--license-block-bg)] license-container mb-6 onload-animation overflow-hidden px-6 py-5"><div class="transition font-bold dark:text-white/75 text-black/75">Attacking EDRs Part 3: One Bug to Stop them all</div><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/" class="text-[var(--primary)] link">https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/</a><div class="flex gap-6 mt-2"><div><div class="transition text-sm dark:text-white/30 text-black/30">Author</div><div class="transition dark:text-white/75 text-black/75 whitespace-nowrap">Manuel Feifel</div></div><div><div class="transition text-sm dark:text-white/30 text-black/30">Published at</div><div class="transition dark:text-white/75 text-black/75 whitespace-nowrap">2025-02-24</div></div><div><div class="transition text-sm dark:text-white/30 text-black/30">License</div><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="text-[var(--primary)] link whitespace-nowrap" target="_blank">CC BY-NC-SA 4.0</a></div></div><svg height="1em" width="0.97em" class="transition absolute -translate-y-1/2 dark:text-white/5 pointer-events-none right-6 text-[15rem] text-black/5 top-1/2" data-icon="fa6-brands:creative-commons"><symbol id="ai:fa6-brands:creative-commons" viewBox="0 0 496 512"><path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86m143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86M247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248m.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82" fill="currentColor"></path></symbol><use href="#ai:fa6-brands:creative-commons"></use></svg></div></div></div><div class="flex w-full flex-col gap-4 mb-4 justify-between md:flex-row overflow-hidden"><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#" class="overflow-hidden w-full active:scale-95 font-bold pointer-events-none"></a> <a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#" class="overflow-hidden w-full active:scale-95 font-bold pointer-events-none"></a></div></div></main></div><div class="hidden lg:block back-to-top-wrapper" data-astro-cid-eymb5ayk=""><div class="transition flex items-center rounded-2xl back-to-top-btn hide overflow-hidden" id="back-to-top-btn" data-astro-cid-eymb5ayk=""><button class="btn-card h-[3.75rem] w-[3.75rem]" aria-label="Back to Top" data-astro-cid-eymb5ayk=""><svg height="1em" width="1em" class="mx-auto" data-icon="material-symbols:keyboard-arrow-up-rounded" data-astro-cid-eymb5ayk="true"><symbol id="ai:material-symbols:keyboard-arrow-up-rounded" viewBox="0 0 24 24"><path d="m12 10.8l-3.9 3.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.6-4.6q.3-.3.7-.3t.7.3l4.6 4.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275z" fill="currentColor"></path></symbol><use href="#ai:material-symbols:keyboard-arrow-up-rounded"></use></svg></button></div></div></div></div><div class="absolute hidden 2xl:block w-full z-0"><div class="mx-auto max-w-[var(--page-width)] relative"><div class="transition flex items-center -right-[var(--toc-width)] absolute hidden lg:block top-0 w-[var(--toc-width)]" id="toc-wrapper"><div class="h-[calc(100vh_-_20rem)] fixed hide-scrollbar overflow-x-hidden overflow-y-scroll top-14 w-[var(--toc-width)]" id="toc-inner-wrapper"><div class="transition-swup-fade h-full w-full" id="toc"><div class="h-8 w-full"></div><table-of-contents class="group"><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#1-summary-of-alpc-blocking-vulnerability" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">1</div><div class="transition text-sm text-50">1. Summary of ALPC Blocking Vulnerability</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#2-windows-alpc-introduction" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">2</div><div class="transition text-sm text-50">2. Windows ALPC Introduction</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#3-alpc-research-results" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">3</div><div class="transition text-sm text-50">3. ALPC Research Results</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#31-enumerate-alpc-ports" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 ml-4"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">3.1 Enumerate ALPC-ports</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#32-connecting-to-alpc-port" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 ml-4"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">3.2 Connecting to ALPC Port</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#33-impersonating-alpc-server" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 ml-4"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">3.3 Impersonating ALPC Server</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#34-exploit-conditions" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 ml-4"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">3.4 Exploit Conditions</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#35-mitigation" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 ml-4"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">3.5 Mitigation</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#36-blocking-edrs-with-namedpipes" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 ml-4"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">3.6 Blocking EDRs with NamedPipes</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#37-further-research" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 ml-4"><div class="transition bg-[var(--toc-badge-bg)] h-2 rounded-[0.1875rem] w-2"></div></div><div class="transition text-sm text-50">3.7 Further Research</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#4-disclosure-process" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">4</div><div class="transition text-sm text-50">4 Disclosure Process</div></a><a href="https://labs.infoguard.ch/posts/edr_part3_one_bug_to_stop_them_all/#5-conclusion" class="transition flex py-2 active:bg-[var(--toc-btn-active)] gap-2 hover:bg-[var(--toc-btn-hover)] min-h-9 px-2 relative rounded-xl w-full"><div class="transition flex items-center rounded-lg font-bold justify-center h-5 shrink-0 text-xs w-5 bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">5</div><div class="transition text-sm text-50">5 Conclusion</div></a><div class="absolute left-0 right-0 -z-10 bg-[var(--toc-btn-hover)] border-2 border-[var(--toc-btn-hover)] border-dashed group-hover:bg-transparent group-hover:border-[var(--toc-btn-active)] rounded-xl transition-all" id="active-indicator"></div></table-of-contents><div class="h-8 w-full"></div></div></div></div><!-- #toc needs to exist for Swup to work normally --></div></div><div class="hidden h-[300vh]" id="page-height-extend" style="--bannerOffset:15vh;--banner-height-home:65vh;--banner-height:35vh;--configHue:235;--page-width:75rem" data-astro-cid-sckkx6r4=""></div><!-- Cloudflare Pages Analytics --><!-- Cloudflare Pages Analytics --><div class="os-scrollbar os-scrollbar-horizontal scrollbar-base scrollbar-auto py-1 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div><div class="os-scrollbar os-scrollbar-vertical scrollbar-base scrollbar-auto py-1 os-scrollbar-auto-hide os-scrollbar-auto-hide-hidden os-scrollbar-handle-interactive os-scrollbar-cornerless os-scrollbar-unusable" style="--os-viewport-percent: 1; --os-scroll-direction: 0;"><div class="os-scrollbar-track"><div class="os-scrollbar-handle"></div></div></div></body></html>