Title:
Indirect Syscall Detector (Detecting-Indirect-Syscalls)

Type:
GitHub Tool

Short Summary (4–8 sentences max):
This repository provides a Windows x64 user-mode detector for indirect syscall execution (a common EDR hook-evasion technique). It monitors execution of `syscall` instructions inside `ntdll.dll` by setting CPU hardware execution breakpoints and handling hits via a Vectored Exception Handler (VEH). On each breakpoint, it inspects the return address on the stack (RSP) and checks whether it falls within whitelisted “trusted” module ranges (e.g., `ntdll.dll`, optionally other system DLLs). If the return address points to untrusted memory (heap/stack/allocated regions), it flags the event as likely indirect syscall usage. The tool instruments all threads by enumerating them and updating debug registers (DR0–DR3/DR7) in each thread context, with a follow-up scan for newly created threads. It’s primarily useful for Blue Team/EDR research and defenders validating detections, and for Red Teamers to understand detection boundaries and bypass conditions (e.g., executing within trusted module ranges/ROP).

Technical Focus:
- Indirect syscalls / NTAPI hook evasion (Hell’s Gate-style)
- x64 hardware breakpoints (DR0–DR3, DR7) and execution breakpoints
- Vectored Exception Handling (VEH) with EXCEPTION_SINGLE_STEP
- Return address (stack/RSP) validation and module range whitelisting
- Thread enumeration and per-thread context modification (NtGet/SetContextThread)
- Trusted-module range construction via PE export parsing

Use Cases:
- Detecting indirect syscall shellcode in a monitored process at runtime
- Prototyping/benchmarking EDR-style user-mode telemetry for syscall evasion
- Researching bypasses (e.g., ROP or code execution within trusted module address space)
- Building lab detections for SysWhispers/Hell’s Gate-like techniques
- Incident response triage to identify suspicious syscall invocation patterns

Keywords:
indirect syscalls, ntdll.dll, syscall instruction, hardware breakpoints, DR0, DR1, DR2, DR3, DR7, vectored exception handler, VEH, EXCEPTION_SINGLE_STEP, trap flag, EFLAGS.TF, return address validation, RSP, thread context, NtGetContextThread, NtSetContextThread, CreateToolhelp32Snapshot, NtOpenThread, NtSuspendThread, SysWhispers, Hell’s Gate, ROP bypass, PE export parsing, Windows x64