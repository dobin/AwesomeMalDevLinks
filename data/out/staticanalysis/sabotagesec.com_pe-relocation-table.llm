Title:
PE Relocation Table

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains the purpose and structure of the PE “.reloc” section and how Windows uses the relocation table when an image cannot be loaded at its preferred ImageBase.  
- It describes how the linker builds code/data assuming a fixed ImageBase, and why loading at a different base breaks absolute addresses without relocation.  
- The author breaks down `IMAGE_BASE_RELOCATION` blocks (page RVA + block size) and the 2-byte relocation entries where the high bits encode the relocation type (commonly 0x3 for 32-bit and 0xA for 64-bit) and the remaining bits encode the offset within the page.  
- Using notepad.exe as an example, it demonstrates calculating the relocation DELTA (loaded base − ImageBase) and applying it to the addresses referenced by relocation entries, validating the result in a debugger.  
- It’s useful for red teamers, malware developers, and low-level Windows researchers implementing custom loaders (e.g., reflective loading) or doing in-memory manipulation where the OS loader isn’t doing relocations for you.  
- The key value is a practical, step-by-step mental model for how reloc entries point to locations that contain addresses needing adjustment, not the reloc entries themselves.

Technical Focus:
- PE format: `.reloc` section and base relocations
- `IMAGE_BASE_RELOCATION` structure and relocation blocks (page-based)
- Relocation entry encoding (type + offset) and common types (HIGHLOW/DIR64)
- ImageBase vs loaded base address and DELTA computation
- Debugger-based validation of relocation results

Use Cases:
- Implementing reflective PE loaders / manual mapping
- Process hollowing and in-memory PE replacement requiring relocation fixups
- Custom DLL unhooking or remapping workflows that rebuild image layout
- Malware analysis and reverse engineering of loader behavior
- Building PE parsing/patching tooling to apply base relocations

Keywords:
PE, Portable Executable, .reloc, relocation table, base relocation, IMAGE_BASE_RELOCATION, ImageBase, OptionalHeader, RVA, VirtualAddress, SizeOfBlock, DELTA, Windows loader, HIGHLOW, DIR64, ASLR, manual mapping, reflective loading, process hollowing, PE-Bear, WinDbg/debugger