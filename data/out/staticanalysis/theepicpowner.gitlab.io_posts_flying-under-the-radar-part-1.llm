Title:
Flying Under the Radar: Part 1 – Resolving Sensitive Windows Functions with x64 Assembly

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post covers how to resolve Windows DLL base addresses and exported function addresses at runtime using x64 MASM assembly, avoiding reliance on standard Win32 APIs like GetProcAddress/GetModuleHandle.  
- The core problem addressed is reducing suspicious Import Address Table (IAT) entries to hinder static triage and to delay/avoid sandbox and EDR detections that key off imported APIs and common resolution patterns.  
- It demonstrates walking the PEB loader lists (via TEB->PEB->Ldr->InLoadOrderModuleList) to locate loaded modules (e.g., ntdll.dll), then parsing PE export structures (IMAGE_DOS_HEADER/NT_HEADERS/EXPORT_DIRECTORY) to find function RVAs (e.g., NtDelayExecution).  
- The author also compares how different toolchains (MSVC, MinGW, LLVM/Clang) affect resulting IAT contents, including approaches that can yield extremely small or even empty import tables.  
- Useful for red teamers, malware developers, and offensive security researchers building loaders/shellcode-like components or “independent” implants; also relevant to blue teamers for understanding common PEB-walking and export-parsing tradecraft.  
- It’s interesting because it ties low-level resolution techniques directly to practical detection surfaces (IAT, CRT imports, EDR usermode monitoring) and sets up later work on syscall strategies.

Technical Focus:
- PEB/TEB access on x64 (GS:[0x60]) and loader module list traversal
- LDR_DATA_TABLE_ENTRY parsing (DllBase, BaseDllName) and string comparison in assembly
- Manual PE export parsing (e_lfanew, DataDirectory, IMAGE_EXPORT_DIRECTORY)
- Resolving function addresses via AddressOfNames / AddressOfNameOrdinals / AddressOfFunctions
- Import table minimization and compiler/CRT side effects (MSVC vs MinGW vs Clang)
- MASM + C++ interop for runtime API resolution

Use Cases:
- Build custom GetModuleHandle/GetProcAddress equivalents without importing them
- Reduce or control IAT footprint for droppers/loaders/implants
- Resolve ntdll exports for later syscall setup (direct/indirect) or hook inspection
- Create “CRT-less” or minimal-runtime Windows executables for research
- Develop detections for PEB-walking + export-table parsing behaviors

Keywords:
PEB, TEB, GS segment, Ldr, InLoadOrderModuleList, LDR_DATA_TABLE_ENTRY, ntdll.dll, kernel32.dll, Import Address Table, IAT, PE exports, IMAGE_DOS_HEADER, e_lfanew, IMAGE_NT_HEADERS64, IMAGE_EXPORT_DIRECTORY, AddressOfNames, AddressOfNameOrdinals, AddressOfFunctions, MASM, x64 assembly, EDR hooking, sandbox evasion, MinGW, MSVC, Clang, CRT, NtDelayExecution