# https://oblivion-malware.xyz/posts/evading-static-analysis/

<!DOCTYPE html><html lang="en"><body><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Evading Static Analysis</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h1 id="import-address-table-iat">Import Address Table (IAT)</h1><p>The Import Address Table(IAT), consists of the API imports used within a binary. For instance, in a previous article in this journal, we demonstrated how to detect <a href="https://oblivion-malware.xyz/posts/classic-injection/">Classic Injection</a>. We could already consider it malicious simply by its IAT, as this somewhat reveals its actions, typically used by malware. However, now I will show ways to use WinAPIs while keeping the IAT clean.</p><h1 id="dynamic-calls">Dynamic Calls</h1><p>When we compile our binary passing direct the api, we are already telling the compiler that we will use these functions. The compiler automatically loads the Dynamic Linked Library (DLL) and adds the WINAPI call to the PE structure.</p><p>One solution is to make the call dynamically. This occurs as follows: if the DLL is already incorporated into the process, we will use GetModuleHandle to obtain an identifier for the DLL. If it is not incorporated, we will use LoadLibrary to load it into the process and obtain the identifier.</p><p>One way is to create the API definition with a typedef:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">typedef</span> <span class="nf">int</span><span class="p">(</span><span class="n">WINAPI</span> <span class="o">*</span><span class="n">pMessageBox</span><span class="p">)(</span>
    <span class="n">HWND</span> <span class="n">hWnd</span><span class="p">,</span>
    <span class="n">LPCSTR</span> <span class="n">lpText</span><span class="p">,</span>
    <span class="n">LPCSTR</span> <span class="n">lpCaption</span><span class="p">,</span>
    <span class="n">UINT</span> <span class="n">uType</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div><p>And then we will retrieve the address of the exported function by populating a previously defined. In the case of <a href="https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messagebox">MessageBox</a>, it is exported from the DLL called User32.dll, and for that, it needs to be loaded into the process, so we use <a href="https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">LoadLibrary</a>.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">HMODULE</span> <span class="n">hUser32</span> <span class="o">=</span> <span class="n">LoadLibraryA</span><span class="p">(</span> <span class="s">"user32.dll"</span> <span class="p">);</span>
<span class="n">pMessageBox</span> <span class="n">ppMessageBox</span> <span class="o">=</span> <span class="n">GetProcAddress</span><span class="p">(</span> <span class="n">hUser32</span><span class="p">,</span> <span class="s">"MessageBoxA"</span> <span class="p">);</span>
<span class="n">ppMessageBox</span><span class="p">(</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">"Dynamically Called MessageBox"</span><span class="p">,</span> <span class="s">"Dynamic Call :D"</span><span class="p">,</span> <span class="n">MB_OK</span> <span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div><p>Comparing the difference in the Import Address Table (IAT) between a binary with dynamic and static loading:</p><h3 id="static"><span class="me-2">Static</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#static" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p></p><h3 id="dynamic"><span class="me-2">Dynamic</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#dynamic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p></p><p>That was a demonstration using <code class="language-plaintext highlighter-rouge">Dumpbin.exe</code>. There are other tools such as: <a href="https://ntcore.com/explorer-suite/">CFF Explorer</a>, <a href="https://github.com/hasherezade/pe-bear">PeBear</a>, <a href="https://github.com/horsicq/Detect-It-Easy">DIE</a> and more. Now I will show the difference in the disassembly.</p><h3 id="static-1"><span class="me-2">Static</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#static-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p></p><p>As we can see above, we were able to receive the information for each parameter and its value.</p><h3 id="dynamic-1"><span class="me-2">Dynamic</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#dynamic-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p></p><p>This time, we don’t have exactly the same parameters and their values, but <a href="https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a> and <a href="https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">LoadLibrary</a> are visible. We pass <code class="language-plaintext highlighter-rouge">user32.dll</code> and <a href="https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messagebox">MessageBox</a> as parameters.</p><p>By doing this, we hide the import of <code class="language-plaintext highlighter-rouge">User32.dll</code> and the API used. However, there are still two other points that can be improved upon. If we look closely at Dynamic, it is showing the use of <a href="https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a> and <a href="https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">LoadLibrary</a>, which is not good.</p><p>Now, another demonstration, but this time using custom APIs, meaning my own implementation.</p><p></p><p>Here we have a quite significant difference, this way, we won’t have the import of dynamic loading APIs, and we only have issues with the strings, which make it very obvious what is happening. If you are interested in knowing how to implement them, check out the following two blogs <a href="https://oblivion-malware.xyz/posts/shellcode-part-1-finding-module-address/">Shellcode - Pt 1: Finding Module(DLL) Address</a> and <a href="https://oblivion-malware.xyz/posts/shellcode-part-2-finding-exported-functions/">Shellcode - Pt 2: Finding Exported Function</a></p><p>When it comes to strings, there’s something called <code class="language-plaintext highlighter-rouge">String Hashing</code>, where it’s possible to pass a hash instead of the string when calling our custom API. It’s an additional feature, and I leave reference for more informations <a href="https://www.ired.team/offensive-security/defense-evasion/windows-api-hashing-in-malware">API Hashing</a>.</p><p>For more information about WINAPI used in malware and its purposes, I recommend visiting <a href="https://malapi.io/">MalApi</a></p><h1 id="signature">Signature</h1><p>Signature evasion is crucial when we want to create a loader for a <code class="language-plaintext highlighter-rouge">Command and Control (C2)</code> and establish a reverse connection. It is also essential to execute some well-known tools evasively, among other operations. However, the challenge lies in the bytecodes/shellcode we choose to use. In almost 100% of the cases, these tools will have a signature, which means that we cannot simply drop the <code class="language-plaintext highlighter-rouge">.bin</code> file in our malware and execute the loader. To solve this problem, there are methods we can employ, and I will show you a little about them.</p><h2 id="cryptography--obfuscation"><span class="me-2">Cryptography | Obfuscation</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#cryptography--obfuscation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>One way, somewhat like a signature, is encrypting your payload or obfuscating it. This way, you won’t be caught by signature-based detection. There are various algorithms that can be used, such as <code class="language-plaintext highlighter-rouge">Salsa20</code>, <code class="language-plaintext highlighter-rouge">Serpent</code>, <code class="language-plaintext highlighter-rouge">3DES</code>, <code class="language-plaintext highlighter-rouge">AES</code>, <code class="language-plaintext highlighter-rouge">XOR</code>, <code class="language-plaintext highlighter-rouge">RC4</code>, and more. For obfuscation, we have <code class="language-plaintext highlighter-rouge">IPv4</code>, <code class="language-plaintext highlighter-rouge">IPv6</code>, and <code class="language-plaintext highlighter-rouge">MAC</code>. You can find a tool that generates output with obfuscation called <a href="https://github.com/NUL0x4C/HellShell">HellShell</a>, developed by <a href="https://github.com/NUL0x4C">NUL0x4C</a>. He and <a href="https://github.com/mrd0x">mrd0x</a> are references in Maldev and recommend that you follow them. Obfuscation has a certain advantage because it does not increase the entropy of the binary, but caution must be taken with the algorithm used.</p><p>Returning to our discussion on cryptography and obfuscation, I will talk about cryptography, explaining the various ways it can be utilized. Well, there are several ways to detect cryptography in the binary, which is attributed to static analysis on entropy and reverse engineering analysis. I will delve into two topics at the moment:</p><ul><li>With WinAPI</li><li>Without WinAPI</li></ul><h3 id="with-winapi"><span class="me-2">With WinAPI</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#with-winapi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Certainly, it is the easiest method to be identified. For encryption, there is the Windows CryptAPI, within which there are two functions called <a href="https://learn.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptgenkey">CryptGenKey</a> and <a href="https://learn.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptcreatehash">CryptCreateHash</a> used for creating keys and hashes for encryption, decryption, and hash operations. In these two functions, there is a parameter called <code class="language-plaintext highlighter-rouge">ALG_ID</code> which is the key to detecting the encryption used, representing the ID of the algorithm being used. You can find more information about the <code class="language-plaintext highlighter-rouge">ALG_ID</code> in the Microsoft Documentation.</p><ul><li><a href="https://learn.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptgenkey">CryptGenKey</a>: Used to generate a cryptographic session key or a public/private key pair. You need to specify the algorithm you want to use for the key generation by passing the corresponding <code class="language-plaintext highlighter-rouge">ALG_ID</code>.</li></ul><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">ALG_ID</span> <span class="n">algorithmID</span> <span class="o">=</span> <span class="n">CALG_AES_256</span><span class="p">;</span>  <span class="c1">// Example: AES with a 256-bit key</span>
<span class="n">CryptGenKey</span><span class="p">(</span> <span class="n">hCryptProv</span><span class="p">,</span> <span class="n">algorithmID</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hKey</span> <span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div><ul><li><a href="https://learn.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptcreatehash">CryptCreateHash</a>: Used to create a new hash object, which is used to generate a hash value for data. You also need to specify the desired hash algorithm using the <code class="language-plaintext highlighter-rouge">ALG_ID</code>.</li></ul><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">ALG_ID</span> <span class="n">algorithmID</span> <span class="o">=</span> <span class="n">CALG_SHA_256</span><span class="p">;</span>  <span class="c1">// Example: SHA-256</span>
<span class="n">CryptCreateHash</span><span class="p">(</span> <span class="n">hCryptProv</span><span class="p">,</span> <span class="n">algorithmID</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hHash</span> <span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div><p>Therefore, the use of WinAPI for payload encryption should be avoided. So even with dynamic loading, it’s not advisable and can still be detected, as I showed above in <code class="language-plaintext highlighter-rouge">Import Address Table(IAT)</code>.</p><h3 id="without-winapi"><span class="me-2">Without WinAPI</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#without-winapi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Within this topic, we will have two ways in which encryption can be detected: Flow and Constants.</p><p><code class="language-plaintext highlighter-rouge">Constants</code> - Typically hardcoded values required in order to output the correct data - easy to detect. Constants range from substitution boxes, <code class="language-plaintext highlighter-rouge">magic numbers</code>, or even just certain values used for mathematical operations.</p><p><code class="language-plaintext highlighter-rouge">Flow</code> - Much harder to recognize, requires prior knowledge of the algorithm - although there are certain exception. Examples of recognizable flows: <code class="language-plaintext highlighter-rouge">RC4</code>, <code class="language-plaintext highlighter-rouge">KSA</code>, <code class="language-plaintext highlighter-rouge">PRGA</code>, <code class="language-plaintext highlighter-rouge">XOR</code> stages, length of the <code class="language-plaintext highlighter-rouge">Serpent</code> CBC algorithm.</p><p></p><p>An example is <code class="language-plaintext highlighter-rouge">XOR</code>, represented in the image above. Even if you hardcode the algorithm in your code, it will be detected because of the <code class="language-plaintext highlighter-rouge">Flow</code>, so it’s good to implement some changes to not make it so obvious. For instance, running it through VirusTotal will already detect the <code class="language-plaintext highlighter-rouge">XOR</code>.</p><h2 id="stager"><span class="me-2">Stager</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#stager" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In addition to encryption, another approach is to make a call to the bytecodes in a file hosted on a web server. The file doesn’t necessarily need to have the extension <code class="language-plaintext highlighter-rouge">.bin</code>; you can use any extension since we are only extracting bytes from the file. A crucial note to keep in mind is to be cautious of security solutions that perform traffic analysis, as the request can still be detected. Therefore, it is advisable to keep the payload encrypted and decrypt it during runtime.</p><p>As an example, I will simply direct you to <code class="language-plaintext highlighter-rouge">Shellcode Injection</code>. In the <code class="language-plaintext highlighter-rouge">Attacker Perspective</code> section, there is a sample code that does what was mentioned here.</p><h1 id="entropy">Entropy</h1><p>Entropy occurs when we have <code class="language-plaintext highlighter-rouge">random/disordered</code> data, usually happening when the data is packed or encrypted. This randomness is analyzed by an algorithm we won’t delve into. The calculation of entropy can be checked in various ways, and the ideal is to have the calculation for each section of the PE (Portable Executable). I will show how to store the payload in <code class="language-plaintext highlighter-rouge">.text</code> and <code class="language-plaintext highlighter-rouge">.rdata</code> section and how this affects the binary’s entropy. An important note is, entropy above 6.0 is a bad sign for us, the score ranges from 0 to 10.</p><h2 id="text-section"><span class="me-2">.text section</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#text-section" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To place the payload inside the <code class="language-plaintext highlighter-rouge">.text</code> section, it is necessary to declare it to the compiler (MSVC) as follows:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="cp">#pragma section(".text")
</span><span class="kr">__declspec</span><span class="p">(</span><span class="n">allocate</span><span class="p">(</span><span class="s">".text"</span><span class="p">))</span> <span class="o">&lt;</span><span class="n">var</span> <span class="n">type</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">var</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">=</span>
</pre></td></tr></tbody></table></code></div></div><p>for mingw-w64-gcc is:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">".text"</span><span class="p">)))</span> <span class="o">&lt;</span><span class="n">var</span> <span class="n">type</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">var</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">=</span>
</pre></td></tr></tbody></table></code></div></div><p>Now the payload outside the <code class="language-plaintext highlighter-rouge">.text</code> section, then allocated in the <code class="language-plaintext highlighter-rouge">.text</code> encrypted and decrypted (brute shellcode).</p><h3 id="outside-the-text-section"><span class="me-2">Outside the .text section.</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#outside-the-text-section" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p></p><h3 id="decrypted-in-the-text-section"><span class="me-2">Decrypted in the .text section.</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#decrypted-in-the-text-section" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p></p><h3 id="crypted-in-the-text-section"><span class="me-2">Crypted in the .text section.</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#crypted-in-the-text-section" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p></p><p>The raw shellcode in the code increases entropy if it is too large, this should be taken into consideration. Next, I will use the encrypted payload for the remaining sections.</p><h2 id="rdata-section"><span class="me-2">.rdata section</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#rdata-section" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To allocate the load in the <code class="language-plaintext highlighter-rouge">.rdata</code> section, which is read-only data, it is necessary to declare a constant as follows.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pPayloadBytes</span><span class="p">[]</span> <span class="o">=</span>
</pre></td></tr></tbody></table></code></div></div><p>Now a sample of the entropy.</p><p></p><h2 id="binary-entropy-reduction"><span class="me-2">Binary Entropy Reduction</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#binary-entropy-reduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A good way to avoid being flagged for entropy is to use options like Stage, inserting English strings into the binary and filling the encrypted payload text with the same byte repeatedly. This works because these added bytes will have an entropy of 0.00, as they are all the same. Removing the CRT Lib, as will be shown in the next topic, also helps reduce entropy.</p><p>For ease, there is a tool called <a href="https://github.com/Maldev-Academy/EntropyReducer">Entropy Reducer</a> that I recommend checking out.</p><h1 id="compilation">Compilation</h1><p>In compilation, it’s ideal to have some care, as depending on how it’s done, there will be a lot of ‘garbage’, unnecessary things that will hinder your evasion. Below is a list of what we should do:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>x86_64-w64-mingw32-gcc <span class="nt">-s</span> <span class="nt">-w</span> <span class="nt">-mwindows</span> <span class="nt">-nostdlib</span> <span class="nt">-Os</span> <span class="nt">-fno-asynchronous-unwind-tables</span> <span class="nt">-masm</span><span class="o">=</span>intel blackout.c <span class="nt">-o</span> blackout.exe
</pre></td></tr></tbody></table></code></div></div><ul><li><p><code class="language-plaintext highlighter-rouge">-s</code>: This flag is generally used to remove debugging symbols from the generated object code. This can help reduce the size of the final executable.</p></li><li><p><code class="language-plaintext highlighter-rouge">-w</code>: This flag is used to disable warnings during compilation. Warnings are messages that the compiler emits to indicate potential issues in the code, such as unused variables or suspicious operations.</p></li><li><p><code class="language-plaintext highlighter-rouge">-mwindows</code>: This flag is specific for compiling as a GUI, so it will not generate a console.</p></li><li><p><code class="language-plaintext highlighter-rouge">-nostdlib</code>: This flag instructs the compiler not to include the standard library (such as libc in the case of C) during linking.</p></li><li><p><code class="language-plaintext highlighter-rouge">-Os</code>: This flag optimizes the code for size. It instructs the compiler to try to reduce the size of the generated code, even if this may result in a slight loss of performance.</p></li><li><p><code class="language-plaintext highlighter-rouge">-fno-asynchronous-unwind-tables</code>: This flag disables the generation of asynchronous unwind tables. These tables are used to track the execution stack during exceptions or errors but can increase the size of the code.</p></li><li><p><code class="language-plaintext highlighter-rouge">-masm=intel</code>: This flag instructs the compiler to generate assembly code in the Intel format instead of the default GCC format.</p></li><li><p><code class="language-plaintext highlighter-rouge">-o</code>: flag is used to specify the output file name for the compiled program or object file.</p></li></ul><h2 id="example"><span class="me-2">Example</span><a href="https://oblivion-malware.xyz/posts/evading-static-analysis/#example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The same code will be compiled in two different ways. Payload compiled with cl blackout.c.</p><p></p><p>Payload compiled with the demonstrated implementations.</p><p></p><h1 id="conclusion">Conclusion</h1><p>Various static analysis prevention techniques were shown, consequently evading, we went through encryption, entropy, staging, dynamic calls, and even compilation.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="https://oblivion-malware.xyz/categories/malware-development/">Malware Development</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="https://oblivion-malware.xyz/tags/windows/" class="post-tag no-text-decoration">Windows</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 "><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Evading%20Static%20Analysis%20-%20Oblivion&amp;url=%2Fposts%2Fevading-static-analysis%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" aria-label="Twitter" data-bs-original-title="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Evading%20Static%20Analysis%20-%20Oblivion&amp;u=%2Fposts%2Fevading-static-analysis%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" aria-label="Facebook" data-bs-original-title="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fevading-static-analysis%2F&amp;text=Evading%20Static%20Analysis%20-%20Oblivion" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" aria-label="Telegram" data-bs-original-title="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" data-title-succeed="Link copied successfully!" data-bs-original-title="Copy link"> <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="https://oblivion-malware.xyz/tags/windows/">Windows</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>
</body></html>