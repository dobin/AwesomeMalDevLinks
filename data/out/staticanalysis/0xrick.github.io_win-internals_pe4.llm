Title:
A dive into the PE file format – PE file structure (Part 3): NT Headers

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains the Windows Portable Executable (PE) NT Headers, focusing on how the PE loader uses them to map and execute an image.  
- It introduces Relative Virtual Addresses (RVAs) and how they translate to virtual addresses via the ImageBase.  
- The article breaks down `IMAGE_NT_HEADERS` / `IMAGE_NT_HEADERS64`, covering the PE signature (`PE\0\0`), the COFF `IMAGE_FILE_HEADER`, and the critical `IMAGE_OPTIONAL_HEADER32/64`.  
- It highlights key differences between PE32 and PE32+ (notably `Magic`, `BaseOfData`, and 32-bit vs 64-bit field sizes like `ImageBase` and stack/heap sizes).  
- Practical interpretation is shown via PE-bear screenshots, including how `SectionAlignment` and `FileAlignment` affect in-memory vs on-disk layout and padding.  
- Useful for red teamers, malware developers, reverse engineers, and defenders who need to parse, validate, or manipulate PE metadata for tooling, analysis, or detection.

Technical Focus:
- PE NT Headers (`IMAGE_NT_HEADERS32/64`) structure and parsing
- COFF File Header fields (`Machine`, `Characteristics`, section count, timestamps)
- Optional Header semantics (`Magic`, `AddressOfEntryPoint`, `ImageBase`, `Subsystem`, `DllCharacteristics`)
- RVA vs VA translation and loader-relevant addressing
- Alignment rules (`SectionAlignment` vs `FileAlignment`) and header/image sizing
- PE32 vs PE32+ structural differences

Use Cases:
- Building or improving PE parsers (custom loaders, scanners, triage tools)
- Reverse engineering and static analysis of Windows binaries
- Malware development / packer work that modifies entry points, headers, or alignment
- Defensive validation and anomaly detection (suspicious header values, alignment inconsistencies)
- Forensics: interpreting timestamps, subsystem type, and loader-related metadata

Keywords:
PE, Portable Executable, IMAGE_NT_HEADERS, IMAGE_FILE_HEADER, IMAGE_OPTIONAL_HEADER32, IMAGE_OPTIONAL_HEADER64, PE32, PE32+, RVA, ImageBase, AddressOfEntryPoint, SectionAlignment, FileAlignment, DllCharacteristics, Subsystem, SizeOfImage, SizeOfHeaders, COFF, winnt.h, PE-bear