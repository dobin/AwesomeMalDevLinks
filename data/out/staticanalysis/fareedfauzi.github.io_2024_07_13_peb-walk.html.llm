Title:
PEB Walk: Dynamically Resolving Windows APIs via the Process Environment Block

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains how malware and shellcode “walk” the Windows Process Environment Block (PEB) to find loaded modules and resolve API addresses without relying on the Import Address Table (IAT).  
- It covers why this is used (reducing static import visibility and complicating reverse engineering) and where the relevant loader data lives (PEB → PEB_LDR_DATA → module linked lists).  
- The author demonstrates accessing the PEB in 32-bit Windows via `fs:[0x30]` (TEB → PEB pointer), then iterating `InLoadOrderModuleList` to locate `kernel32.dll` and extract its base address.  
- It shows manual PE export parsing to resolve `LoadLibraryA` and `GetProcAddress`, then dynamically loads `user32.dll` and calls `MessageBoxA`.  
- The post also includes a reversing workflow in IDA Pro: renaming variables and applying custom PEB/LDR and PE header structures to make decompiled output readable.  
- Useful primarily for malware analysts, reverse engineers, and red teamers working with shellcode/loaders and API-hiding techniques.

Technical Focus:
- PEB/TEB access on 32-bit Windows (`fs:[0x30]`, `NtCurrentPeb`)
- Loader module enumeration via `PEB_LDR_DATA` and `LDR_DATA_TABLE_ENTRY`
- Traversing `InLoadOrderModuleList` / `InMemoryOrderModuleList` linked lists
- Manual PE export table parsing (`IMAGE_DOS_HEADER`, `IMAGE_NT_HEADERS`, `IMAGE_EXPORT_DIRECTORY`)
- Dynamic API resolution (`LoadLibraryA`, `GetProcAddress`) to avoid IAT imports
- IDA Pro reverse engineering: applying local types/structures to decompiler output

Use Cases:
- Analyze malware/shellcode that hides imports by resolving APIs at runtime
- Build or understand reflective loaders and minimal-import stagers
- Create YARA/reversing heuristics for PEB access patterns (e.g., `fs:[0x30]`)
- Improve IDA Pro decompilation clarity by importing PEB/LDR/PE structures
- Triage binaries with suspiciously small/empty IATs

Keywords:
PEB, TEB, fs:[0x30], NtCurrentPeb, PEB_LDR_DATA, LDR_DATA_TABLE_ENTRY, InLoadOrderModuleList, InMemoryOrderModuleList, kernel32.dll, ntdll.dll, user32.dll, IAT evasion, dynamic API resolution, LoadLibraryA, GetProcAddress, MessageBoxA, PE export parsing, IMAGE_EXPORT_DIRECTORY, IDA Pro, shellcode