Title:
Introducing New Packing Method: First Reflective PE Packer (Amber)

Type:
Blog Post

Short Summary (4–8 sentences max):
This post introduces “Amber,” a proof-of-concept packer that converts compiled Windows PE executables into position-independent, multi-stage, in-memory payloads (shellcode-like) without requiring the target to load a DLL or use classic process hollowing APIs. It aims to reduce detection by avoiding suspicious file-mapping and process-creation sequences (e.g., CreateProcess/NtMapViewOfSection) and instead executes a pre-mapped PE image inside the current/target process. The technique manually performs key PE loader tasks: import resolution (LoadLibraryA/GetProcAddress), optional base relocations (for ASLR-capable binaries), mapping sections into a new base, and transferring execution to the PE entry point (often via CreateThread). Two stubs are described: an ASLR-capable stub (VirtualAlloc + CreateThread) and a non-ASLR stub that attempts to overwrite at the preferred image base using VirtualProtect, with stability limitations. API resolution can be done via PEB walking and EAT parsing with ROR13-hashed exports, or via fixed API addresses (and future IAT parsing). It’s useful for red teams, exploit developers, and malware researchers interested in reflective loading, staged payload delivery, and PE internals, and it highlights tradeoffs/limitations around relocations and process stability.

Technical Focus:
- Reflective PE loading (manual PE loader implementation)
- PEB traversal and EAT parsing (InMemoryOrderModuleList, _LDR_DATA_TABLE_ENTRY)
- Import resolution (IAT population via LoadLibraryA/GetProcAddress)
- Base relocations / ASLR handling (relocation table delta patching)
- In-memory execution and staged payload delivery (shellcode-like stagers)
- Minimal/suspicious-API reduction vs classic hollowing/mapping APIs

Use Cases:
- Delivering full EXE payloads via exploit stagers (e.g., Metasploit staged shellcode)
- Fileless execution of PE malware/tools from memory (no on-disk artifact)
- Building multi-stage loaders for buffer overflow/heap overflow exploitation chains
- Researching/benchmarking EDR detection of reflective loaders vs hollowing
- Packaging red-team tradecraft payloads with custom loader stubs

Keywords:
Amber, reflective PE loader, PE packer, in-memory execution, fileless, staged payload, shellcode, ASLR, base relocation, relocation table, PEB, InMemoryOrderModuleList, EAT parsing, ROR13 hash, _LDR_DATA_TABLE_ENTRY, IAT, LoadLibraryA, GetProcAddress, VirtualAlloc, VirtualProtect, CreateThread, process injection, Metasploit stager