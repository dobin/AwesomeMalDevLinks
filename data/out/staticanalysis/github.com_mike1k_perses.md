# https://github.com/mike1k/perses

[Skip to content](https://github.com/mike1k/perses#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/mike1k/perses) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/mike1k/perses) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/mike1k/perses) to refresh your session.Dismiss alert

{{ message }}

[mike1k](https://github.com/mike1k)/ **[perses](https://github.com/mike1k/perses)** Public

- [Notifications](https://github.com/login?return_to=%2Fmike1k%2Fperses) You must be signed in to change notification settings
- [Fork\\
78](https://github.com/login?return_to=%2Fmike1k%2Fperses)
- [Star\\
534](https://github.com/login?return_to=%2Fmike1k%2Fperses)


X86 Mutation Engine with Portable Executable compatibility.


[534\\
stars](https://github.com/mike1k/perses/stargazers) [78\\
forks](https://github.com/mike1k/perses/forks) [Branches](https://github.com/mike1k/perses/branches) [Tags](https://github.com/mike1k/perses/tags) [Activity](https://github.com/mike1k/perses/activity)

[Star](https://github.com/login?return_to=%2Fmike1k%2Fperses)

[Notifications](https://github.com/login?return_to=%2Fmike1k%2Fperses) You must be signed in to change notification settings

# mike1k/perses

master

[**1** Branch](https://github.com/mike1k/perses/branches) [**0** Tags](https://github.com/mike1k/perses/tags)

[Go to Branches page](https://github.com/mike1k/perses/branches)[Go to Tags page](https://github.com/mike1k/perses/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![mike1k](https://avatars.githubusercontent.com/u/53958713?v=4&size=40)](https://github.com/mike1k)[mike1k](https://github.com/mike1k/perses/commits?author=mike1k)<br>[Removed requirement of -x64 arg for 64bit binaries.](https://github.com/mike1k/perses/commit/cdf3b77f18015d653fd98ef21ad1aefb5c2f63c3)<br>4 years agoApr 14, 2022<br>[cdf3b77](https://github.com/mike1k/perses/commit/cdf3b77f18015d653fd98ef21ad1aefb5c2f63c3) · 4 years agoApr 14, 2022<br>## History<br>[6 Commits](https://github.com/mike1k/perses/commits/master/) <br>Open commit details<br>[View commit history for this file.](https://github.com/mike1k/perses/commits/master/) 6 Commits |
| [sdk](https://github.com/mike1k/perses/tree/master/sdk "sdk") | [sdk](https://github.com/mike1k/perses/tree/master/sdk "sdk") | [Fixed wrong byte order](https://github.com/mike1k/perses/commit/b40c98ec98eb79f4abb29947a5436812b7b869f0 "Fixed wrong byte order  The order of the bytes is wrong, if we compare to the file detais.hpp at line #79, the scan will never match.") | 4 years agoApr 14, 2022 |
| [src](https://github.com/mike1k/perses/tree/master/src "src") | [src](https://github.com/mike1k/perses/tree/master/src "src") | [Removed requirement of -x64 arg for 64bit binaries.](https://github.com/mike1k/perses/commit/cdf3b77f18015d653fd98ef21ad1aefb5c2f63c3 "Removed requirement of -x64 arg for 64bit binaries.") | 4 years agoApr 14, 2022 |
| [vendor](https://github.com/mike1k/perses/tree/master/vendor "vendor") | [vendor](https://github.com/mike1k/perses/tree/master/vendor "vendor") | [PERSES Initial commit](https://github.com/mike1k/perses/commit/853324ff52b01e6afb4480fe83fcc1ba5aa9696c "PERSES Initial commit") | 4 years agoApr 13, 2022 |
| [.gitignore](https://github.com/mike1k/perses/blob/master/.gitignore ".gitignore") | [.gitignore](https://github.com/mike1k/perses/blob/master/.gitignore ".gitignore") | [PERSES Initial commit](https://github.com/mike1k/perses/commit/853324ff52b01e6afb4480fe83fcc1ba5aa9696c "PERSES Initial commit") | 4 years agoApr 13, 2022 |
| [.gitmodules](https://github.com/mike1k/perses/blob/master/.gitmodules ".gitmodules") | [.gitmodules](https://github.com/mike1k/perses/blob/master/.gitmodules ".gitmodules") | [PERSES Initial commit](https://github.com/mike1k/perses/commit/853324ff52b01e6afb4480fe83fcc1ba5aa9696c "PERSES Initial commit") | 4 years agoApr 13, 2022 |
| [CMakeLists.txt](https://github.com/mike1k/perses/blob/master/CMakeLists.txt "CMakeLists.txt") | [CMakeLists.txt](https://github.com/mike1k/perses/blob/master/CMakeLists.txt "CMakeLists.txt") | [PERSES Initial commit](https://github.com/mike1k/perses/commit/853324ff52b01e6afb4480fe83fcc1ba5aa9696c "PERSES Initial commit") | 4 years agoApr 13, 2022 |
| [README.md](https://github.com/mike1k/perses/blob/master/README.md "README.md") | [README.md](https://github.com/mike1k/perses/blob/master/README.md "README.md") | [Removed requirement of -x64 arg for 64bit binaries.](https://github.com/mike1k/perses/commit/cdf3b77f18015d653fd98ef21ad1aefb5c2f63c3 "Removed requirement of -x64 arg for 64bit binaries.") | 4 years agoApr 14, 2022 |
| [cmake.toml](https://github.com/mike1k/perses/blob/master/cmake.toml "cmake.toml") | [cmake.toml](https://github.com/mike1k/perses/blob/master/cmake.toml "cmake.toml") | [PERSES Initial commit](https://github.com/mike1k/perses/commit/853324ff52b01e6afb4480fe83fcc1ba5aa9696c "PERSES Initial commit") | 4 years agoApr 13, 2022 |
| [cmkr.cmake](https://github.com/mike1k/perses/blob/master/cmkr.cmake "cmkr.cmake") | [cmkr.cmake](https://github.com/mike1k/perses/blob/master/cmkr.cmake "cmkr.cmake") | [PERSES Initial commit](https://github.com/mike1k/perses/commit/853324ff52b01e6afb4480fe83fcc1ba5aa9696c "PERSES Initial commit") | 4 years agoApr 13, 2022 |
| View all files |

## Repository files navigation

[![](https://camo.githubusercontent.com/866f2d7fd346b0a1a6aac8a8a16508f85586318e2d19f9fa411122e53a0db709/68747470733a2f2f692e696d6775722e636f6d2f596932796135662e706e67)](https://camo.githubusercontent.com/866f2d7fd346b0a1a6aac8a8a16508f85586318e2d19f9fa411122e53a0db709/68747470733a2f2f692e696d6775722e636f6d2f596932796135662e706e67)

# Introduction

[Permalink: Introduction](https://github.com/mike1k/perses#introduction)

PERSES is a X86 code obfuscation engine that works with [Portable Executable](https://en.wikipedia.org/wiki/Portable_Executable) files. The obfuscation works by replacing a specific instruction with a larger more sophisticated set that is semantically compatible to the original. PERSES only mutates 4 instructions yet has adverse effects on analyzers/decompilers due to the method of mutation. For more information on PERSES' inner workings, please check out the article written [here](https://back.engineering/13/04/2022/).

PERSES is a work in progress and does not attempt to be a replacement for any established code obfuscation engine, so please be mindful when using it to protect your code. Furthermore, X64 support can be slightly improved and augmented to ensure semantical accuracy.

# Reference Manual

[Permalink: Reference Manual](https://github.com/mike1k/perses#reference-manual)

PERSES by default works off a command line. Listed below are the arguments requried to utilize PERSES.

| Argument | Description | May Require |
| --- | --- | --- |
| `-f` or `--file` | Path to the input PE file. | ✔️ |
| `-a` or `-address` | Address or list of addresses required to be mutated. | ✔️ |
| `-s` or `--symbol` | Symbol or list of symbols to be mutated. This requires a linked `.map` file. | ❌ |
| `--map` | Map file to be linked. IDA Pro `.map` files must have their extension replaced with `.ida`. | ❌ |
| `--list` | List of functions to be mutated. Each entry must envelop one line and be formatted as `0x1000:0x2000` where `0x1000` is the start and `0x2000` is the end of the routine. | ❌ |
| `--rets` | Allow PERSES to build a `RET` gadget pool used to create `JMP`s to random locations. | ❌ |
| `--scan` | Force PERSES to scan for code protection markers. | ❌ |

Both symbols and addresses can be used, but atleast one of them must be present.

> ℹ️ Due to limitations in the `argparse` library, if more than one address or symbol are required, please append the `-a` or `-s` argument and parameters last.

## Working with PERSES Manually

[Permalink: Working with PERSES Manually](https://github.com/mike1k/perses#working-with-perses-manually)

If desired, PERSES can be used manually to generate mutated binaries. To begin, one must declare a `X86BinaryApplication` instance with the provided template parameter.

- `X86BinaryApplication<PERSES_64BIT>(filepath)` to generate a `X86_64` instance.
- `X86BinaryApplication<PERSES_32BIT>(filepath)` to generate a `X86` instance.

### RET Gadgets

[Permalink: RET Gadgets](https://github.com/mike1k/perses#ret-gadgets)

After instantiating the object, the `RET` gadget pool mentioned above can be optionally created with `perses::buildKnownRetGadgets(app)`.

### MAP Files

[Permalink: MAP Files](https://github.com/mike1k/perses#map-files)

MAP files are optionally produced by compilers to show symbols and sections present in a binary with their corresponding address. PERSES allows MAP files from `IDA Pro` and `MSVC` (tested on VS2022) to be linked via `X86BinaryApplication::linkMapFile`. Afterwards, symbols can be traversed via `X86BinaryApplication::getSymbols` or added directly into the mutation queue by calling `addRoutineBySymbol`. For instance, after linking the map file, adding `main` to the mutation queue is as simple as:

```
app->addRoutineBySymbol("main", PERSES_MARKER_MUTATION);
```

MAP files can aid function size calculation by exposing known symbols, however, MAP linking is completely optional and only added as a convenience.

### Function Lists

[Permalink: Function Lists](https://github.com/mike1k/perses#function-lists)

If mutating a batch of functions is wanted, function lists can be parsed in order to add the specified routines automatically. This is done by calling `parseFunctionList`. Please be mindful of the required format listed [above](https://github.com/mike1k/perses#Reference-Manual) in the argument table. Futhermore, the end address supplied is expected to be the end of a function, providing anything else will likely result in instability of the output program.

### Markers

[Permalink: Markers](https://github.com/mike1k/perses#markers)

The [PersesSDK](https://github.com/mike1k/perses/sdk/PersesSDK.h) can be included into a project to emit a scannable pattern into code. PERSES makes use of compiler intrinsics to generate unique patterns. Beginning and end macros named `PERSES_MUTATION_START()` and `PERSES_MUTATION_END()` are provided.

### Applying Transforms

[Permalink: Applying Transforms](https://github.com/mike1k/perses#applying-transforms)

Applying mutation on all routines in the queue is done by calling `X86BinaryApplication::transformRoutines`. Transforms are applied via the corresponding schema. At the moment, there is only one schema supplied; `MutationLight`.

### Compiling.

[Permalink: Compiling.](https://github.com/mike1k/perses#compiling)

Compilation of the new binary can be done with `X86BinaryApplication::compile`. PERSES creates a new file and appends `.perses` after the original filename.

# Showcase

[Permalink: Showcase](https://github.com/mike1k/perses#showcase)

Below are some example programs created to show the efficacy in regards to crippling decompiler output.

## Hello, world!

[Permalink: Hello, world!](https://github.com/mike1k/perses#hello-world)

```
int main()
{
	PERSES_MUTATION_START()

	printf("Hello, world!\n");
	Sleep(100);

	PERSES_MUTATION_END()

	return getchar();
}
```

### Output

[Permalink: Output](https://github.com/mike1k/perses#output)

[![Output1](https://camo.githubusercontent.com/128d7e04d03198526926e92646a8ce442b265d6397e945fab0a2b7b15f40b2e3/68747470733a2f2f692e696d6775722e636f6d2f6b334d767363562e706e67)](https://camo.githubusercontent.com/128d7e04d03198526926e92646a8ce442b265d6397e945fab0a2b7b15f40b2e3/68747470733a2f2f692e696d6775722e636f6d2f6b334d767363562e706e67)

## Jump Table Mutation

[Permalink: Jump Table Mutation](https://github.com/mike1k/perses#jump-table-mutation)

```
int main()
{
	int input = 0;

	std::cin >> input;

	switch (input)
	{
	case 0:
		std::cout << "Value is zero" << std::endl;
		break;
	case 1:
		std::cout << "Value is one" << std::endl;
		break;
	case 2:
		std::cout << "Value is two" << std::endl;
		break;
	case 3:
		std::cout << "Value is three" << std::endl;
		break;
	case 4:
		std::cout << "Value is four" << std::endl;
		break;
	default:
		std::cerr << "Unhandled value!" << std::endl;
		break;
	}

	return getchar();
}
```

> Full function mutation using command line

```
perses -f MutationTesting.exe --map MutationTesting.map --rets -s _main
```

### Output

[Permalink: Output](https://github.com/mike1k/perses#output-1)

[![Output2](https://camo.githubusercontent.com/e58b37f563db16720ec0b08350a514bbefb0548470f7f54867792029b91bd622/68747470733a2f2f692e696d6775722e636f6d2f373961577535632e706e67)](https://camo.githubusercontent.com/e58b37f563db16720ec0b08350a514bbefb0548470f7f54867792029b91bd622/68747470733a2f2f692e696d6775722e636f6d2f373961577535632e706e67)

# Modification

[Permalink: Modification](https://github.com/mike1k/perses#modification)

Additional schemas can be created then attached to `X86BinaryApplication::buildSchema`. Alternatively, `MutationLight` can be extended as it only supports a minimal set of instructions. In order to modify the existing schema, please thoroughly read and understand [MutationLight.cpp](https://github.com/mike1k/src/MutationLight.cpp).

# Building (Windows)

[Permalink: Building (Windows)](https://github.com/mike1k/perses#building-windows)

PERSES utilizes [cmkr](https://github.com/build-cpp/cmkr). In order to build the PERSES project, please run the following commands:

```
git clone --recursive https://github.com/mike1k/perses.git
cmake -B build
```

# Dependencies

[Permalink: Dependencies](https://github.com/mike1k/perses#dependencies)

PERSES makes use of multiple great libraries in order to achieve it's objective.

- [Zydis](https://github.com/zyantific/zydis)
- [AsmJit](https://github.com/asmjit/asmjit)
- [spdlog](https://github.com/gabime/spdlog)
- [argparse](https://github.com/p-ranav/argparse)
- [pepp](https://github.com/mike1k/pepp)

## About

X86 Mutation Engine with Portable Executable compatibility.


### Topics

[obfuscation](https://github.com/topics/obfuscation "Topic: obfuscation") [x86](https://github.com/topics/x86 "Topic: x86") [portable-executable](https://github.com/topics/portable-executable "Topic: portable-executable") [cmkr](https://github.com/topics/cmkr "Topic: cmkr")

### Resources

[Readme](https://github.com/mike1k/perses#readme-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/mike1k/perses).

[Activity](https://github.com/mike1k/perses/activity)

### Stars

[**534**\\
stars](https://github.com/mike1k/perses/stargazers)

### Watchers

[**14**\\
watching](https://github.com/mike1k/perses/watchers)

### Forks

[**78**\\
forks](https://github.com/mike1k/perses/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fmike1k%2Fperses&report=mike1k+%28user%29)

## [Releases](https://github.com/mike1k/perses/releases)

No releases published

## [Packages\  0](https://github.com/users/mike1k/packages?repo_name=perses)

No packages published

## [Contributors\  2](https://github.com/mike1k/perses/graphs/contributors)

- [![@mike1k](https://avatars.githubusercontent.com/u/53958713?s=64&v=4)](https://github.com/mike1k)[**mike1k**](https://github.com/mike1k)
- [![@lguilhermee](https://avatars.githubusercontent.com/u/21105275?s=64&v=4)](https://github.com/lguilhermee)[**lguilhermee** Lucas](https://github.com/lguilhermee)

## Languages

- [C++90.7%](https://github.com/mike1k/perses/search?l=c%2B%2B)
- [CMake9.1%](https://github.com/mike1k/perses/search?l=cmake)
- [C0.2%](https://github.com/mike1k/perses/search?l=c)

You can’t perform that action at this time.