Title:
A dive into the PE file format – PE file structure (Part 6): PE Base Relocations

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains how PE base relocations work and why they’re needed when a Windows loader maps an image at a different base address than the one assumed at compile time (`IMAGE_OPTIONAL_HEADER.ImageBase`).  
- It describes the relocation delta concept and how the loader fixes hardcoded absolute addresses by adding the difference between preferred and actual load addresses.  
- The article breaks down the PE Relocation Table as a Data Directory stored in the `.reloc` section, organized into 4KB page-based blocks aligned on 32-bit boundaries.  
- It details the `IMAGE_BASE_RELOCATION` header (page RVA + block size) and the subsequent WORD entries where the high 4 bits encode relocation type and low 12 bits encode offset within the page.  
- Useful for reverse engineers, exploit developers, and red teamers building loaders/manual mappers who need to correctly apply relocations.

Technical Focus:
- PE `.reloc` section and Base Relocation Data Directory
- `IMAGE_OPTIONAL_HEADER.ImageBase` and relocation delta
- `IMAGE_BASE_RELOCATION` block structure (VirtualAddress, SizeOfBlock)
- Relocation entry encoding (type nibble + 12-bit offset)
- Page-based (4KB) relocation processing and address reconstruction

Use Cases:
- Implementing or debugging manual PE loaders / reflective loaders
- Writing tooling to parse and apply relocations during in-memory mapping
- Reverse engineering binaries to understand loader fixups and address validity
- Analyzing why a PE fails to load at non-preferred bases (ASLR/constraints)

Keywords:
PE format, base relocations, relocation table, .reloc, Data Directory, IMAGE_OPTIONAL_HEADER, ImageBase, relocation delta, IMAGE_BASE_RELOCATION, VirtualAddress, SizeOfBlock, RVA, loader, 4KB page, relocation type, offset entries, Windows internals, ASLR, manual mapping