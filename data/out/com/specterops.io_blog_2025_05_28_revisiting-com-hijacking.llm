Title:
Revisiting COM Hijacking

Type:
Blog Post

Short Summary (4â€“8 sentences max):
- This post revisits Windows COM hijacking as a practical user-level persistence technique by abusing the HKCU-over-HKLM COM class lookup order.  
- It shows how to discover hijackable COM CLSIDs by monitoring processes with Procmon for missing `HKCU\...\CLSID\{...}\InProcServer32` lookups that fall back to HKLM.  
- The author demonstrates building a proxy/stub DLL that executes a payload (demo uses `calc.exe`) while forwarding required exports to the legitimate DLL to avoid breaking the calling application.  
- A key angle is using the hijack not only for persistence but also to gain execution inside high-value processes like `chrome.exe`/`msedge.exe` (e.g., via WebView2 usage across many apps).  
- It discusses adding process-name gating and a mutex/event guard to reduce noise and prevent repeated execution.  
- Useful for red teams/pentesters seeking reliable, low-interaction persistence and for defenders looking to understand COM-based execution paths into common enterprise apps.

Technical Focus:
- COM class registration and CLSID resolution (HKCU vs HKLM precedence)
- `InProcServer32` COM servers and threading model matching
- Procmon-based discovery of missing HKCU COM registrations
- Proxy DLL/export forwarding (`#pragma comment(linker, ...)`)
- Execution gating (process checks) and single-instance control (mutex/event)
- Targeting Chromium/WebView2-hosted processes for in-process execution

Use Cases:
- Establish user-level persistence without scheduled tasks/run keys
- Execute code inside specific applications (Chrome/Edge/WebView2 hosts) for stealthier callbacks
- Reduce detection risk versus direct process injection by leveraging legitimate COM loading
- Support post-exploitation actions in browser context (e.g., cookie access workflows)

Keywords:
COM hijacking, CLSID, InProcServer32, LocalServer32, HKCU, HKLM, registry precedence, Process Monitor, Procmon, System Informer, directmanipulation.dll, WebView2, msedgewebview2.exe, chrome.exe, msedge.exe, DLL proxying, export forwarding, threading model, CreateProcessA, CreateEvent, persistence