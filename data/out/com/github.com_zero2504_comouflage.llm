Title:
COMouflage — COM-based DLL Surrogate Injection

Type:
GitHub Tool

Short Summary (4–8 sentences max):
COMouflage demonstrates a COM abuse technique that achieves stealthy code execution by forcing a COM DLL to be hosted inside a legitimate DLL surrogate process (dllhost.exe). Instead of classic COM hijacking for persistence, it uses per-user (HKCU) registry manipulation to register a custom CLSID/AppID and set `DllSurrogate` so COM launches `dllhost.exe` and loads an attacker-controlled `InprocServer32` DLL. The trigger is a `CoCreateInstance` call with `CLSCTX_LOCAL_SERVER`, which causes COM SCM to spawn the surrogate, producing a misleading process tree (often `svchost.exe` → `dllhost.exe /Processid:{CLSID}`). This can reduce parent/child correlation value and blend execution into common Windows COM infrastructure without requiring admin rights. The repo includes a C++ PoC and a write-up with code-level details and notes on EDR blind spots observed during testing. It’s primarily useful for red teams, pentesters, and malware developers, and secondarily for defenders building detections around COM/AppID/DllSurrogate abuse.

Technical Focus:
- COM registration abuse (CLSID/AppID) via HKCU\Software\Classes
- DLL Surrogate hosting using `dllhost.exe` and `DllSurrogate` registry value
- Out-of-proc COM activation via `CoCreateInstance` + `CLSCTX_LOCAL_SERVER`
- Process tree/parent masquerading (`svchost.exe` → `dllhost.exe`)
- Windows Registry APIs (RegCreateKeyExW, RegSetValueExW) and COM initialization (CoInitializeEx)

Use Cases:
- User-level stealth execution by loading a payload DLL into `dllhost.exe`
- EDR evaluation of COM surrogate execution and parent/child attribution gaps
- Tradecraft development for living-off-the-land style execution chains
- Defensive research: hunting for anomalous per-user COM registrations and surrogate launches

Keywords:
COM, CLSID, AppID, DllSurrogate, dllhost.exe, svchost.exe, COM SCM, CoCreateInstance, CLSCTX_LOCAL_SERVER, HKCU, Software\\Classes, InprocServer32, ThreadingModel, RegCreateKeyExW, RegSetValueExW, process tree masquerading, COM hijacking, MITRE ATT&CK T1546.015, Windows internals, C++ PoC