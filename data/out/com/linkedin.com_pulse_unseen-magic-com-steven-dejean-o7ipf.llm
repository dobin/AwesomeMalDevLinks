Title:
The Unseen Magic of COM

Type:
Blog Post

Short Summary (4â€“8 sentences max):
- This post provides a high-level but practical walkthrough of how Windows Component Object Model (COM) works under the hood and why it shows up in everyday Windows features (OLE embedding, shell context menu handlers, AV integrations, clipboard interactions).  
- It explains the COM client lifecycle: initializing COM on a thread (CoInitialize/CoInitializeEx), instantiating objects (CoCreateInstance) using CLSID (class identity) and IID (interface identity), and cleaning up (CoUninitialize).  
- The article breaks down how COM resolves and loads in-proc servers (DLL) via registry lookup, LoadLibrary, DllGetClassObject, and IClassFactory::CreateInstance.  
- It contrasts this with out-of-proc COM servers (EXE), covering process launch, CoRegisterClassObject, RPC-based communication, and marshaling for cross-process interface calls.  
- Core COM object model concepts are covered: interface pointers, vtables, QueryInterface for interface discovery, and IUnknown-based reference counting (AddRef/Release).  
- Useful for red teamers, malware developers, and defenders who need to understand COM activation paths, registry-based resolution, and cross-process COM behavior that often appears in tradecraft and telemetry.

Technical Focus:
- COM activation flow (CoInitialize/CoCreateInstance/CoUninitialize)
- CLSID/IID resolution and Windows Registry COM registration
- In-proc COM servers (DLL): LoadLibrary, DllGetClassObject, IClassFactory
- Out-of-proc COM servers (EXE): CoRegisterClassObject, RPC, marshaling
- Interface pointers, vtables, IUnknown (QueryInterface/AddRef/Release)

Use Cases:
- Reverse engineering COM-based components and understanding call flows
- Mapping CLSIDs to binaries for hunting/sandbox triage and incident response
- Building or instrumenting COM clients/servers for testing and research
- Interpreting Windows telemetry involving COM activation, DLL loads, and RPC
- Analyzing persistence or execution paths that leverage COM registration (conceptual foundation)

Keywords:
COM, Component Object Model, OLE, ActiveX, CoInitialize, CoInitializeEx, CoCreateInstance, CLSID, IID, Windows Registry, in-proc server, out-of-proc server, LoadLibrary, DllGetClassObject, IClassFactory, CreateInstance, CoRegisterClassObject, RPC, marshaling, IUnknown, QueryInterface, AddRef, Release, vtable