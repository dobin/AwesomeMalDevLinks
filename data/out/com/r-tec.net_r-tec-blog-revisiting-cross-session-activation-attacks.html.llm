Title:
Revisiting Cross Session Activation Attacks

Type:
Blog Post

Short Summary (4–8 sentences max):
This post revisits Windows DCOM “Cross-Session Activation” and shows how it can be repurposed from local privilege escalation/coercion into a lateral movement technique that executes code in the context of an already logged-on interactive user on a remote host. It explains the underlying (largely undocumented) API flow (CoCreateInstance → ISpecialSystemProperties/SetSessionId → StandardGetInstanceFromIStorage) and the prerequisites (COM class RunAs=INTERACTIVE USER plus suitable launch/activation permissions). After enumerating candidate CLSIDs and failing to find direct remote code-exec primitives, the author pivots to combining cross-session DCOM activation with remote HKCU COM hijacking to force a spawned COM host process to load an attacker-controlled DLL. Two PoCs are referenced: BitlockMove (BitLocker-related BDEUILauncher/BaaUpdate.exe, mostly client-focused) and SpeechRuntimeMove (SpeechRuntimeBroker.exe, works on common Windows Server versions and requires session targeting). The post also provides concrete detection points (SMB share access, registry modifications, process creation, and suspicious DLL loads). It’s useful for red teams/pentesters looking for stealthier lateral movement into interactive sessions, and for blue teams building detections around DCOM + HKCU COM hijack behavior.

Technical Focus:
- DCOM remote activation and COM class security (RunAs=INTERACTIVE USER, Launch/Activation permissions)
- Cross-session COM instantiation via ISpecialSystemProperties::SetSessionId
- StandardGetInstanceFromIStorage abuse path (undocumented/legacy behavior)
- COM hijacking via HKCU\Software\Classes\CLSID\*\InProcServer32
- Remote registry manipulation and DLL planting over ADMIN$/C$
- Detection via Windows Security Event IDs (4624/5140/4657/4663/4688) and DLL load telemetry

Use Cases:
- Lateral movement that executes payloads inside an existing interactive user session without process injection/impersonation
- Coercing authentication or session-context actions via cross-session DCOM activation (admin context)
- Rapid hunting for “INTERACTIVE USER” COM classes that can be paired with HKCU COM hijacks
- Defensive detection engineering for remote HKCU COM hijack + unusual COM host process spawns

Keywords:
DCOM, COM, Cross-Session Activation, ISpecialSystemProperties, SetSessionId, StandardGetInstanceFromIStorage, CoCreateInstance, CLSID, IID, OleView.NET, COM hijacking, InProcServer32, HKCU\Software\Classes, Remote Registry, SMB ADMIN$, lateral movement, SpeechRuntimeBroker.exe, BaaUpdate.exe, BitlockMove, SpeechRuntimeMove, RemoteKrbRelay, NetNTLMv2, Kerberos relay, Windows Security 4624, 5140, 4657, 4663, 4688