Title:
COM Hijacking EDR Front-Ends to Reach SYSTEM via Back-End IPC (Part 1)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post analyzes a common AV/EDR architecture where a low-privileged UI (“front-end”) talks to a SYSTEM “back-end” service over IPC (named pipes/RPC/COM) to perform privileged actions.  
- The authors show how trust in the front-end can be broken by using COM hijacking (HKCU-over-HKLM COM resolution) to force the front-end to load an attacker-controlled in-proc COM DLL, achieving code execution inside the trusted UI process.  
- They detail a practical methodology to find hijackable COM CLSIDs using Sysinternals Process Monitor by filtering for `CLSID`/`InProcServer32` registry lookups and subsequent DLL loads.  
- With code running in the front-end, they capture and replay named-pipe messages to the SYSTEM back-end; in one target, the pipe traffic is plaintext and includes registry paths.  
- By modifying a replayed message to overwrite a vendor-controlled “Application Path” registry value, they redirect a privileged process to execute attacker-controlled binaries after reboot, resulting in SYSTEM privilege escalation.  
- This is useful for red teams and vulnerability researchers assessing EDR self-defense boundaries and for blue teams designing IPC hardening and COM abuse detections.

Technical Focus:
- COM hijacking via HKCU `Software\Classes\CLSID` precedence over HKLM
- In-proc COM server loading (`InProcServer32`) and DLL proxying (`DllGetClassObject`)
- Front-end/back-end trust boundary failures in security products
- Named pipe traffic capture, message replay, and protocol tampering
- Registry-based privilege escalation via path redirection (“Application Path”)
- Tooling: Sysinternals Process Monitor, IONinja Pipe Monitor, Donut shellcode generation

Use Cases:
- Identify and weaponize COM-based injection paths into “protected” EDR UI processes
- Audit AV/EDR IPC channels for replayable or weakly validated privileged operations
- Build LPE proofs-of-concept by redirecting vendor-controlled registry configuration used by SYSTEM services
- Develop detections for suspicious HKCU COM registrations and anomalous named-pipe message patterns
- Reproduce and validate vendor fixes for COM/IPC hardening issues

Keywords:
COM hijacking, CLSID, InProcServer32, HKCU Software\Classes, HKLM Software\Classes, CoCreateInstance, DllGetClassObject, DLL proxying, Process Monitor, Sysinternals, named pipes, CreateNamedPipe, ConnectNamedPipe, IONinja, IPC replay attack, registry write as SYSTEM, Application Path, privilege escalation, EDR self-defense, Donut shellcode