Title:
AMSI Bypass Without AMSI Bypass!?

Type:
Blog Post

Short Summary (4–8 sentences max):
- The post describes a stealthy AMSI evasion technique for .NET in-memory execution that avoids loading `amsi.dll` entirely, rather than patching or hooking AMSI.  
- It leverages a custom CLR host and the `_AppDomain::Load_2` method (identity-string based loading) instead of the common `_AppDomain::Load_3` / `Assembly.Load(byte[])` reflective load path that triggers AMSI scanning.  
- By implementing `IHostControl` and providing a custom `IHostAssemblyManager`/`IHostAssemblyStore`, the host intercepts assembly resolution and returns the assembly as an in-memory `IStream` via `ProvideAssembly`.  
- The identity string required by `Load_2` is extracted from the assembly bytes using `SHCreateMemStream` and `GetBindingIdentityFromStream`.  
- The key insight is that `Load_2` is treated as “disk-based” resolution by the CLR, so AMSI scanning callbacks (e.g., `AmsiScanBuffer`) are not invoked and `amsi.dll` is not injected.  
- This is primarily useful for red teams and offensive tool developers building custom .NET loaders, and it’s interesting because it shifts from noisy AMSI tampering to avoiding the AMSI integration path altogether.

Technical Focus:
- CLR hosting with `ICLRRuntimeHost` and `SetHostControl`
- `_AppDomain::Load_2` vs `_AppDomain::Load_3` assembly loading semantics
- Custom assembly resolution via `IHostAssemblyManager` and `IHostAssemblyStore::ProvideAssembly`
- In-memory assembly delivery using COM `IStream` (`SHCreateMemStream`)
- Assembly identity extraction (`GetBindingIdentityFromStream`)
- AMSI load/scan trigger conditions (`amsi.dll`, `AmsiScanBuffer`)

Use Cases:
- Building stealthy in-memory .NET loaders that avoid AMSI initialization
- Executing known offensive .NET tooling (e.g., Rubeus) with reduced AMSI/EDR visibility
- Researching CLR assembly resolution internals and alternative load paths
- Developing detections around custom CLR hosting and nonstandard assembly resolution

Keywords:
AMSI, amsi.dll, AmsiScanBuffer, CLR hosting, ICLRRuntimeHost, SetHostControl, IHostControl, IHostAssemblyManager, IHostAssemblyStore, ProvideAssembly, _AppDomain::Load_2, _AppDomain::Load_3, Assembly.Load, SHCreateMemStream, IStream, GetBindingIdentityFromStream, SAFEARRAY, in-memory execution, .NET loader, EDR evasion