Title:
Bypassing Windows Defender

Type:
Blog Post

Short Summary (4â€“8 sentences max):
- This post walks through manually obfuscating PowerShell to bypass Windows Defender by patching AMSI and disabling PowerShell ETW logging.  
- It demonstrates how Defender signatures commonly trigger on specific strings (e.g., `AmsiUtils`, `amsiInitFailed`) and shows an iterative workflow to identify and modify those indicators.  
- The author uses AmsiTrigger to pinpoint detected substrings, then applies simple transformations (Base64/hex encoding, string splitting/concatenation, and reverse-string reconstruction) to evade static/signature-based detection.  
- It also covers an ETW patch that disables the PowerShell ETW provider by flipping internal fields via .NET reflection, and notes that obfuscation/encryption alone may only help against static analysis unless AMSI is bypassed first.  
- Useful primarily for red teamers and pentesters developing or adapting in-memory PowerShell tradecraft; secondarily useful for blue teams to understand common AMSI/ETW tampering patterns worth detecting.

Technical Focus:
- AMSI bypass via .NET reflection (`System.Management.Automation.AmsiUtils`, `amsiInitFailed`)
- Signature evasion through manual string obfuscation (Base64, hex, concat, reverse)
- AMSITrigger-driven iterative detection of flagged substrings
- ETW tampering in PowerShell (`PSEtwLogProvider`, `EventProvider.m_enabled`, `etwProvider`)
- Invoke-Obfuscation usage and limitations (static vs runtime detection)

Use Cases:
- Rapidly modifying known AMSI bypass one-liners to evade Defender string signatures
- Building obfuscated PowerShell loaders for in-memory execution (e.g., `IEX(iwr ...)`)
- Disabling/impairing PowerShell ETW telemetry during offensive operations
- Creating detection content for AMSI/ETW patching behaviors (reflection patterns, field names, type strings)

Keywords:
Windows Defender, PowerShell, AMSI, Antimalware Scan Interface, AmsiUtils, amsiInitFailed, .NET Reflection, System.Management.Automation, ETW, Event Tracing for Windows, PSEtwLogProvider, System.Diagnostics.Eventing.EventProvider, m_enabled, etwProvider, AmsiTrigger, Invoke-Obfuscation, in-memory execution, signature evasion, string obfuscation