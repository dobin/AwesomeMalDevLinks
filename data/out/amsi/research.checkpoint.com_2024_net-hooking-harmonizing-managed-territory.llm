Title:
.NET Hooking – Harmonizing Managed Territory

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post introduces managed (.NET) runtime hooking using the Harmony2 library, focusing on in-memory method patching rather than modifying assemblies on disk.  
- It explains how Harmony enables instrumentation at the IL level with multiple patch types (Prefix, Postfix, Transpiler, Finalizer, Reverse Patch) and how these can be combined without conflicting.  
- The article walks through practical examples: modifying arguments, overriding return values while skipping originals, post-processing results, and rewriting IL instructions via transpilers.  
- It covers unpatching and Reverse Patching to safely call the original method (avoiding recursion/StackOverflow when a hook calls the hooked API).  
- A real-world malware-analysis use case is shown: bypassing ConfuserEx2 anti-reflection checks by hooking `Assembly.GetCallingAssembly()` to enable dynamic string decryption, resulting in the ConfuserEx2_String_Decryptor tool.  
- It also demonstrates a workflow trick: loading a Harmony hook DLL and toggling hooks live from dnSpyEx’s Watch Window to combine debugging precision with hook-based automation.  

Technical Focus:
- Harmony2 runtime patching (Prefix/Postfix/Transpiler/Reverse Patch)
- IL (CIL/MSIL) rewriting with `CodeInstruction` and `OpCodes`
- Reflection-based loaders and runtime type/method resolution (AccessTools)
- In-memory instrumentation vs on-disk patching/rebuilding
- ConfuserEx2 constants/string protection bypass via call-stack/assembly checks
- dnSpyEx debugging-context hook deployment (Watch Window expression evaluation)

Use Cases:
- Automating .NET malware analysis by intercepting/decrypting runtime values (strings/config)
- Bypassing anti-tamper / anti-reflection checks in obfuscated assemblies
- Dynamic tracing/instrumentation of managed apps without breaking fragile obfuscation layouts
- Rapid prototyping of behavioral modifications for reverse engineering experiments
- Live hook install/uninstall during debugging sessions for precise execution-window control

Keywords:
.NET, C#, Harmony2, HarmonyLib, managed hooking, runtime patching, IL, CIL, MSIL, Transpiler, Prefix patch, Postfix patch, Reverse Patch, UnpatchAll, Reflection, AccessTools, dnSpyEx, ConfuserEx2, Assembly.GetCallingAssembly, Assembly.GetExecutingAssembly, AsmResolver, string decryption, obfuscation bypass, CodeInstruction, OpCodes