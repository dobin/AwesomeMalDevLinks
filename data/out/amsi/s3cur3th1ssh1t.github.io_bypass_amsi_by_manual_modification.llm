Title:
Bypass AMSI by manual modification

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains how to regain effectiveness of known AMSI bypasses by manually identifying and modifying the specific AMSI “signatures/triggers” that cause PowerShell/C# code to be blocked.  
- It uses Matt Graeber’s classic `AmsiUtils.amsiInitFailed` reflection one-liner as a case study, showing how it becomes detected over time and how to locate the exact triggering tokens.  
- The author demonstrates trigger discovery with AMSITrigger (calling `AmsiScanBuffer` on script fragments) and highlights that detections can be simple string matches or regex-like patterns spanning multiple tokens/lines.  
- Evasion techniques covered include string concatenation, renaming variables/functions, removing comments, and encoding/encrypting trigger strings with runtime decoding to preserve functionality.  
- Examples include updating the `AmsiUtils`/`amsiInitFailed` bypass via Base64/hex runtime decoding and de-triggering PowerView by altering a regex-hit line (e.g., splitting `'krbtgt'`).  
- Useful for red teamers/pentesters maintaining PowerShell tradecraft and for defenders understanding how brittle string/regex signatures can be and how attackers mutate around them.

Technical Focus:
- AMSI internals and signature-based blocking (strings vs regex-like triggers)
- PowerShell reflection bypass (`System.Management.Automation.AmsiUtils`, `amsiInitFailed`)
- Trigger hunting with AMSITrigger / `AmsiScanBuffer`
- Manual de-signaturing: string concatenation, renaming identifiers, comment removal
- Runtime decoding (Base64/hex) to reconstruct flagged strings
- Evasion of common PowerShell stager patterns (base64+gzip+IEX style)

Use Cases:
- Refreshing broken public AMSI bypass PoCs by altering detected tokens
- Identifying which exact lines/words in a script trigger AMSI in a given environment
- De-triggering offensive PowerShell frameworks (e.g., PowerView/PowerSploit) via minimal edits
- Building more resilient loaders by reconstructing sensitive strings at runtime
- Defensive testing: validating AMSI signature coverage and brittleness across AV vendors

Keywords:
AMSI, amsi.dll, Antimalware Scan Interface, PowerShell, System.Management.Automation, AmsiUtils, amsiInitFailed, reflection, AmsiScanBuffer, AMSITrigger, signature trigger, regex detection, string concatenation, runtime decoding, Base64, hex encoding, IEX, GzipStream, PowerView, PowerSploit