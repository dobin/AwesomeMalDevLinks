Title:
Indirect Syscall in CSharp (SharpWhispers + SysWhispers3-style)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post documents implementing “indirect syscalls” in C# to evade EDR user-mode API hooking and detections targeting direct syscall stubs.  
- It builds on SECFORCE’s SharpWhispers (C# SysWhispers2 port) and adapts ideas from SysWhispers3 to ensure the syscall instruction executes from a legitimate NTDLL address rather than from attacker-controlled code.  
- The author walks NTDLL’s export table to resolve Zw* function addresses, derives the syscall instruction location (common offsets like 0x12/0x0f), and adds a byte-by-byte fallback search to handle cases where hooks break fixed-offset assumptions.  
- A syscall list structure is extended to store both the API address and the located syscall/sysenter instruction address, with WoW64 checks to avoid unnecessary scanning overhead.  
- The syscall stub is modified: on x64 it loads a chosen NTDLL syscall address into R11 and `jmp`s to it; on x86 it supports both 32-bit OS (sysenter path) and WoW64 (KiFastSystemCall via `fs:[0xC0]`).  
- Useful for red teamers and implant/loader developers implementing stealthy NTAPI invocation in managed code while reducing “syscall outside NTDLL” and similar heuristic detections.

Technical Focus:
- Indirect syscall technique (jumping to NTDLL’s syscall instruction)
- NTDLL export table parsing and function address resolution
- Syscall instruction discovery via fixed offsets + byte-pattern scanning
- C# dynamic invocation with embedded assembly stubs (SharpASM)
- x86 vs x64 syscall mechanics (syscall vs sysenter, KiFastSystemCall, WoW64/TEB `fs:[0xC0]`)
- EDR detection tradeoffs (Mark-of-the-Syscall, syscall-origin heuristics)

Use Cases:
- Implement NTAPI invocation in C# loaders without embedding `syscall` instructions
- Bypass/complicate user-mode hook-based monitoring and “direct syscall” signatures
- Build cross-arch syscall stubs supporting x64, x86-on-x64 (WoW64), and x86-on-x86
- Research and validation of syscall-address resolution robustness under hooking

Keywords:
indirect syscall, direct syscall, SharpWhispers, SysWhispers3, SysWhispers2, NTDLL, Zw* exports, SSN, syscall number, syscall instruction, sysenter, KiFastSystemCall, WoW64, TEB fs:[0xC0], export address table, VirtualQueryEx, Marshal.Copy, SharpASM, EDR user-mode hooks, Mark of the Syscall