Title:
Being a Good CLR Host

Type:
GitHub Tool

Short Summary (4–8 sentences max):
This repository is a C proof-of-concept demonstrating “good” CLR hosting by combining modern CLR hosting (ICLRRuntimeHost + SetHostControl) with custom CLR manager interfaces to influence runtime behavior. It shows how to implement custom memory management (IHostMemoryManager/IHostMalloc) to intercept CLR VirtualAlloc/VirtualProtect/VirtualFree-style activity and track/encrypt allocations for opsec (with stability caveats). It also implements custom assembly loading (IHostAssemblyManager/IHostAssemblyStore) to supply assemblies via IStream when the CLR requests them by identity. A key technique is an AMSI bypass for reflective .NET loading: using Load_2 (identity-based) so the CLR believes it’s loading from disk, then returning in-memory bytes via ProvideAssembly—preventing AMSI from loading/scanning in the process. This is primarily useful for red teams, implant/C2 developers, and offensive tool authors building stealthier .NET execution pipelines. It’s interesting because it leverages underused CLR customization hooks rather than patching AMSI/ETW directly, and provides a practical template for integrating these interfaces.

Technical Focus:
- CLR hosting APIs: ICLRRuntimeHost, ICorRuntimeHost, SetHostControl
- CLR customization interfaces: IHostControl, IHostMemoryManager, IHostMalloc
- Assembly load interception: IHostAssemblyManager, IHostAssemblyStore, ProvideAssembly/ProvideModule, IStream
- AMSI bypass via identity-based loading (Load_2 vs Load_3)
- Memory allocation tracking and (optional) sleep-time encryption concepts

Use Cases:
- Build a custom .NET loader that avoids AMSI scanning during in-memory assembly execution
- Implement allocation telemetry for CLR/JIT regions to support sleep-masking or memory hygiene
- Swap Win32 memory APIs for stealthier primitives (e.g., indirect syscalls) inside CLR-managed allocations
- Create an implant-side “managed execution” subsystem with controlled assembly resolution and loading
- Research/detection engineering: understand where CLR hosts can alter expected AMSI/assembly-load behavior

Keywords:
CLR hosting, ICLRRuntimeHost, ICorRuntimeHost, SetHostControl, IHostControl, IHostMemoryManager, IHostMalloc, IHostAssemblyManager, IHostAssemblyStore, ProvideAssembly, IStream, reflective .NET loading, AMSI bypass, Load_2, Load_3, VirtualAlloc, VirtualProtect, JIT, sleep masking, in-memory assembly execution