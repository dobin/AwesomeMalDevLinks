# https://github.com/lkarlslund/defender-acl-blocker

[Skip to content](https://github.com/lkarlslund/defender-acl-blocker#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/lkarlslund/defender-acl-blocker) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/lkarlslund/defender-acl-blocker) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/lkarlslund/defender-acl-blocker) to refresh your session.Dismiss alert

{{ message }}

[lkarlslund](https://github.com/lkarlslund)/ **[defender-acl-blocker](https://github.com/lkarlslund/defender-acl-blocker)** Public

- [Notifications](https://github.com/login?return_to=%2Flkarlslund%2Fdefender-acl-blocker) You must be signed in to change notification settings
- [Fork\\
10](https://github.com/login?return_to=%2Flkarlslund%2Fdefender-acl-blocker)
- [Star\\
76](https://github.com/login?return_to=%2Flkarlslund%2Fdefender-acl-blocker)


Block Windows Defender by deny ACL


[76\\
stars](https://github.com/lkarlslund/defender-acl-blocker/stargazers) [10\\
forks](https://github.com/lkarlslund/defender-acl-blocker/forks) [Branches](https://github.com/lkarlslund/defender-acl-blocker/branches) [Tags](https://github.com/lkarlslund/defender-acl-blocker/tags) [Activity](https://github.com/lkarlslund/defender-acl-blocker/activity)

[Star](https://github.com/login?return_to=%2Flkarlslund%2Fdefender-acl-blocker)

[Notifications](https://github.com/login?return_to=%2Flkarlslund%2Fdefender-acl-blocker) You must be signed in to change notification settings

# lkarlslund/defender-acl-blocker

main

[**1** Branch](https://github.com/lkarlslund/defender-acl-blocker/branches) [**0** Tags](https://github.com/lkarlslund/defender-acl-blocker/tags)

[Go to Branches page](https://github.com/lkarlslund/defender-acl-blocker/branches)[Go to Tags page](https://github.com/lkarlslund/defender-acl-blocker/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![lkarlslund](https://avatars.githubusercontent.com/u/8929787?v=4&size=40)](https://github.com/lkarlslund)[lkarlslund](https://github.com/lkarlslund/defender-acl-blocker/commits?author=lkarlslund)<br>[Remove is now working](https://github.com/lkarlslund/defender-acl-blocker/commit/b0db4df8b04e2ba95bed39bc1d8f4c8288e93cc4)<br>last monthJan 12, 2026<br>[b0db4df](https://github.com/lkarlslund/defender-acl-blocker/commit/b0db4df8b04e2ba95bed39bc1d8f4c8288e93cc4) · last monthJan 12, 2026<br>## History<br>[3 Commits](https://github.com/lkarlslund/defender-acl-blocker/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/lkarlslund/defender-acl-blocker/commits/main/) 3 Commits |
| [.gitignore](https://github.com/lkarlslund/defender-acl-blocker/blob/main/.gitignore ".gitignore") | [.gitignore](https://github.com/lkarlslund/defender-acl-blocker/blob/main/.gitignore ".gitignore") | [Remove is now working](https://github.com/lkarlslund/defender-acl-blocker/commit/b0db4df8b04e2ba95bed39bc1d8f4c8288e93cc4 "Remove is now working") | last monthJan 12, 2026 |
| [go.mod](https://github.com/lkarlslund/defender-acl-blocker/blob/main/go.mod "go.mod") | [go.mod](https://github.com/lkarlslund/defender-acl-blocker/blob/main/go.mod "go.mod") | [Let's go](https://github.com/lkarlslund/defender-acl-blocker/commit/f300923ffd80ffd5acd8f6bad5acea7d7ba1d84a "Let's go") | last monthJan 9, 2026 |
| [go.sum](https://github.com/lkarlslund/defender-acl-blocker/blob/main/go.sum "go.sum") | [go.sum](https://github.com/lkarlslund/defender-acl-blocker/blob/main/go.sum "go.sum") | [Let's go](https://github.com/lkarlslund/defender-acl-blocker/commit/f300923ffd80ffd5acd8f6bad5acea7d7ba1d84a "Let's go") | last monthJan 9, 2026 |
| [main.go](https://github.com/lkarlslund/defender-acl-blocker/blob/main/main.go "main.go") | [main.go](https://github.com/lkarlslund/defender-acl-blocker/blob/main/main.go "main.go") | [Remove is now working](https://github.com/lkarlslund/defender-acl-blocker/commit/b0db4df8b04e2ba95bed39bc1d8f4c8288e93cc4 "Remove is now working") | last monthJan 12, 2026 |
| [readme.md](https://github.com/lkarlslund/defender-acl-blocker/blob/main/readme.md "readme.md") | [readme.md](https://github.com/lkarlslund/defender-acl-blocker/blob/main/readme.md "readme.md") | [Remove is now working](https://github.com/lkarlslund/defender-acl-blocker/commit/b0db4df8b04e2ba95bed39bc1d8f4c8288e93cc4 "Remove is now working") | last monthJan 12, 2026 |
| View all files |

## Repository files navigation

# Defender ACL Blocker

[Permalink: Defender ACL Blocker](https://github.com/lkarlslund/defender-acl-blocker#defender-acl-blocker)

Disable Microsoft Defender user space part with simple ACL deny ACL

## Usage

[Permalink: Usage](https://github.com/lkarlslund/defender-acl-blocker#usage)

### Regular build:

[Permalink: Regular build:](https://github.com/lkarlslund/defender-acl-blocker#regular-build)

- install [Go](https://go.dev/dl/)
- clone this repo: `git clone https://github.com/lkarlslund/defender-acl-blocker`
- build it: `cd defender-acl-blocker && go build .`

### Obfuscated build:

[Permalink: Obfuscated build:](https://github.com/lkarlslund/defender-acl-blocker#obfuscated-build)

- install [Go](https://go.dev/dl/)
- install Garble: `go install mvdan.cc/garble@latest`
- clone this repo: `git clone https://github.com/lkarlslund/defender-acl-blocker`
- build it: `cd defender-acl-blocker && garble -tiny -literals -seed=random build .`

### Run it:

[Permalink: Run it:](https://github.com/lkarlslund/defender-acl-blocker#run-it)

From an elevated command prompt:

```
# Standard run (adds DENY ACLs)
defender-acl-blocker.exe

# Undo changes (revokes applied ACLs)
defender-acl-blocker.exe -remove

# Custom targets and services
defender-acl-blocker.exe -target C:\path\to\file.dll -services "Service1,Service2"
```

### Options:

[Permalink: Options:](https://github.com/lkarlslund/defender-acl-blocker#options)

- `-remove`: Revokes access (removes entry) for the specified services instead of adding a DENY entry.
- `-services`: A comma-separated list of service names to apply the ACL to (default: WinDefend, mpssvc, Sense, etc.).
- `-target`: The file to apply the ACLs to (default: `C:\Windows\System32\kernel32.dll`).

Reboot after applying changes. Defender primary user mode service can not start anymore.

## How it works

[Permalink: How it works](https://github.com/lkarlslund/defender-acl-blocker#how-it-works)

The tool follows these steps to effectively block Defender (and other services) from starting:

1. It enables `SeDebugPrivilege` to allow the process to interact with other system processes.
2. It first impersonates the `SYSTEM` account by stealing a token from `winlogon.exe`.

   - It then impersonates `TrustedInstaller`. If the service isn't running, it starts it, steals the token from the `trustedinstaller.exe` process, and assumes its identity. This provides the highest possible permissions over system files.
3. It calculates the unique Service SID for each target service (e.g., `WinDefend`, `Sense`, `mpssvc`). Service SIDs are in the format `S-1-5-80-...` and are used to identify the service's identity in the local system.
4. It retrieves the current Discretionary Access Control List (DACL) of a target system file (by default `C:\Windows\System32\kernel32.dll`).

   - It prepends "DENY" Access Control Entries (ACEs) for each of the calculated Service SIDs to the ACL.
   - It applies the modified ACL back to the target file.
5. Because "Deny" ACEs take precedence over any "Allow" ACEs, the Windows Loader will refuse to load the target DLL (like `kernel32.dll`) when the service tries to start. Since almost every user-mode process requires `kernel32.dll`, the Defender services fail to initialize and start.

## Disclaimer

[Permalink: Disclaimer](https://github.com/lkarlslund/defender-acl-blocker#disclaimer)

This tool is provided as-is, for educational purposes only, and is not supported by Microsoft, yada yada. Don't use it.

## About

Block Windows Defender by deny ACL


### Resources

[Readme](https://github.com/lkarlslund/defender-acl-blocker#readme-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/lkarlslund/defender-acl-blocker).

[Activity](https://github.com/lkarlslund/defender-acl-blocker/activity)

### Stars

[**76**\\
stars](https://github.com/lkarlslund/defender-acl-blocker/stargazers)

### Watchers

[**1**\\
watching](https://github.com/lkarlslund/defender-acl-blocker/watchers)

### Forks

[**10**\\
forks](https://github.com/lkarlslund/defender-acl-blocker/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Flkarlslund%2Fdefender-acl-blocker&report=lkarlslund+%28user%29)

## [Releases](https://github.com/lkarlslund/defender-acl-blocker/releases)

No releases published

## [Packages\  0](https://github.com/users/lkarlslund/packages?repo_name=defender-acl-blocker)

No packages published

## Languages

- [Go100.0%](https://github.com/lkarlslund/defender-acl-blocker/search?l=go)

You can’t perform that action at this time.