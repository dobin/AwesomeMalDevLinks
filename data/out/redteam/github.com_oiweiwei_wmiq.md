# https://github.com/oiweiwei/wmiq

[Skip to content](https://github.com/oiweiwei/wmiq#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/oiweiwei/wmiq) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/oiweiwei/wmiq) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/oiweiwei/wmiq) to refresh your session.Dismiss alert

{{ message }}

[oiweiwei](https://github.com/oiweiwei)/ **[wmiq](https://github.com/oiweiwei/wmiq)** Public

- [Notifications](https://github.com/login?return_to=%2Foiweiwei%2Fwmiq) You must be signed in to change notification settings
- [Fork\\
0](https://github.com/login?return_to=%2Foiweiwei%2Fwmiq)
- [Star\\
1](https://github.com/login?return_to=%2Foiweiwei%2Fwmiq)


wmi query command-line utility


### License

[MIT license](https://github.com/oiweiwei/wmiq/blob/main/LICENSE)

[1\\
star](https://github.com/oiweiwei/wmiq/stargazers) [0\\
forks](https://github.com/oiweiwei/wmiq/forks) [Branches](https://github.com/oiweiwei/wmiq/branches) [Tags](https://github.com/oiweiwei/wmiq/tags) [Activity](https://github.com/oiweiwei/wmiq/activity)

[Star](https://github.com/login?return_to=%2Foiweiwei%2Fwmiq)

[Notifications](https://github.com/login?return_to=%2Foiweiwei%2Fwmiq) You must be signed in to change notification settings

# oiweiwei/wmiq

main

[**1** Branch](https://github.com/oiweiwei/wmiq/branches) [**1** Tag](https://github.com/oiweiwei/wmiq/tags)

[Go to Branches page](https://github.com/oiweiwei/wmiq/branches)[Go to Tags page](https://github.com/oiweiwei/wmiq/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![oiweiwei](https://avatars.githubusercontent.com/u/168575193?v=4&size=40)](https://github.com/oiweiwei)[oiweiwei](https://github.com/oiweiwei/wmiq/commits?author=oiweiwei)<br>[initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96)<br>success<br>6 months agoAug 7, 2025<br>[7bb9503](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96) · 6 months agoAug 7, 2025<br>## History<br>[1 Commit](https://github.com/oiweiwei/wmiq/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/oiweiwei/wmiq/commits/main/) 1 Commit |
| [.github/workflows](https://github.com/oiweiwei/wmiq/tree/main/.github/workflows "This path skips through empty directories") | [.github/workflows](https://github.com/oiweiwei/wmiq/tree/main/.github/workflows "This path skips through empty directories") | [initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96 "initial commit") | 6 months agoAug 7, 2025 |
| [.gitignore](https://github.com/oiweiwei/wmiq/blob/main/.gitignore ".gitignore") | [.gitignore](https://github.com/oiweiwei/wmiq/blob/main/.gitignore ".gitignore") | [initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96 "initial commit") | 6 months agoAug 7, 2025 |
| [.goreleaser.yaml](https://github.com/oiweiwei/wmiq/blob/main/.goreleaser.yaml ".goreleaser.yaml") | [.goreleaser.yaml](https://github.com/oiweiwei/wmiq/blob/main/.goreleaser.yaml ".goreleaser.yaml") | [initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96 "initial commit") | 6 months agoAug 7, 2025 |
| [LICENSE](https://github.com/oiweiwei/wmiq/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/oiweiwei/wmiq/blob/main/LICENSE "LICENSE") | [initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96 "initial commit") | 6 months agoAug 7, 2025 |
| [README.md](https://github.com/oiweiwei/wmiq/blob/main/README.md "README.md") | [README.md](https://github.com/oiweiwei/wmiq/blob/main/README.md "README.md") | [initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96 "initial commit") | 6 months agoAug 7, 2025 |
| [go.mod](https://github.com/oiweiwei/wmiq/blob/main/go.mod "go.mod") | [go.mod](https://github.com/oiweiwei/wmiq/blob/main/go.mod "go.mod") | [initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96 "initial commit") | 6 months agoAug 7, 2025 |
| [go.sum](https://github.com/oiweiwei/wmiq/blob/main/go.sum "go.sum") | [go.sum](https://github.com/oiweiwei/wmiq/blob/main/go.sum "go.sum") | [initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96 "initial commit") | 6 months agoAug 7, 2025 |
| [wmiq.go](https://github.com/oiweiwei/wmiq/blob/main/wmiq.go "wmiq.go") | [wmiq.go](https://github.com/oiweiwei/wmiq/blob/main/wmiq.go "wmiq.go") | [initial commit](https://github.com/oiweiwei/wmiq/commit/7bb95038ac3f12469443e847e5e9af83607b3d96 "initial commit") | 6 months agoAug 7, 2025 |
| View all files |

## Repository files navigation

# wmiq

[Permalink: wmiq](https://github.com/oiweiwei/wmiq#wmiq)

A command-line tool for querying Windows Management Instrumentation (WMI) remotely over the network using the DCOM protocol. Built with Go and leveraging the power of [RedTeamPentesting/adauth](https://github.com/RedTeamPentesting/adauth) for authentication and [oiweiwei/go-msrpc](https://github.com/oiweiwei/go-msrpc) for Microsoft RPC communication.

## Features

[Permalink: Features](https://github.com/oiweiwei/wmiq#features)

- **Remote WMI Queries**: Execute WQL (WMI Query Language) queries against remote Windows systems
- **Multiple Authentication Methods**: Support for username/password, Kerberos, and NT hashes
- **Flexible Transport**: Choose between TCP/IP or named pipes (SMB) transport
- **Output Formats**: JSON and YAML output support
- **Performance Optimizations**: Configurable page size, result limiting, and forward-only enumeration
- **Proxy Support**: SOCKS5 proxy support for network routing
- **Debug Mode**: Detailed debugging output for troubleshooting

## Installation

[Permalink: Installation](https://github.com/oiweiwei/wmiq#installation)

### From Source

[Permalink: From Source](https://github.com/oiweiwei/wmiq#from-source)

```
git clone https://github.com/oiweiwei/wmiq.git
cd wmiq
go build -o wmiq wmiq.go
```

### Pre-built Binary

[Permalink: Pre-built Binary](https://github.com/oiweiwei/wmiq#pre-built-binary)

Check the releases page for pre-compiled binaries.

## Usage

[Permalink: Usage](https://github.com/oiweiwei/wmiq#usage)

### Basic Syntax

[Permalink: Basic Syntax](https://github.com/oiweiwei/wmiq#basic-syntax)

```
wmiq [options] <target> <query>
```

### Parameters

[Permalink: Parameters](https://github.com/oiweiwei/wmiq#parameters)

```
$ wmiq -h
Usage of wmiq:
      --aes-key hex key       Kerberos AES hex key
      --ccache file           Kerberos CCache file name (defaults to $KRB5CCNAME, currently unset)
      --dc string             Domain controller
      --debug                 Enable debug output
      --forward-only          Use forward-only enumeration
  -k, --kerberos              Use Kerberos authentication
      --limit int             Limit the number of results
      --named-pipe            Use named pipe (SMB) as transport
  -n, --namespace string      WMI namespace (resource) (default "root/cimv2")
      --no-seal               Disable sealing of DCERPC messages
  -H, --nt-hash hash          NT hash ('NT', ':NT' or 'LM:NT')
  -o, --output string         Output format (json, yaml) (default "json")
      --page int              Page size for enumeration (default 100)
  -p, --password string       Password
      --pfx file              Client certificate and private key as PFX file
      --pfx-password string   Password for PFX file
      --prototype             Return prototype
      --socks string          SOCKS5 proxy server
      --timeout duration      Timeout for the operation (default 30s)
  -u, --user user@domain      Username ('user@domain', 'domain\user', 'domain/user' or 'user')
```

## Examples

[Permalink: Examples](https://github.com/oiweiwei/wmiq#examples)

### Basic Process Query

[Permalink: Basic Process Query](https://github.com/oiweiwei/wmiq#basic-process-query)

Query running processes on a remote system:

```
wmiq dc01.msad.local -u username -p password "SELECT * FROM Win32_Process" -o json --limit 1
```

**Output:**

```
{
  "CSCreationClassName": "Win32_ComputerSystem",
  "CSName": "DC01",
  "Caption": "System Idle Process",
  "CommandLine": null,
  "CreationClassName": "Win32_Process",
  "CreationDate": "20250806185811.003650-240",
  "Description": "System Idle Process",
  "Handle": "0",
  "HandleCount": 0,
  "KernelModeTime": 38191718750,
  "Name": "System Idle Process",
  "OSCreationClassName": "Win32_OperatingSystem",
  "OSName": "Microsoft Windows Server 2019 Datacenter Evaluation|C:\\Windows|\\Device\\Harddisk0\\Partition2",
  "OtherOperationCount": 0,
  "OtherTransferCount": 0,
  "PageFaults": 8,
  "PageFileUsage": 56,
  "ParentProcessId": 0,
  "PeakPageFileUsage": 56,
  "PeakVirtualSize": 8192,
  "PeakWorkingSetSize": 12,
  "Priority": 0,
  "PrivatePageCount": 57344,
  "ProcessId": 0,
  "QuotaNonPagedPoolUsage": 1,
  "QuotaPagedPoolUsage": 0,
  "QuotaPeakNonPagedPoolUsage": 1,
  "QuotaPeakPagedPoolUsage": 0,
  "ReadOperationCount": 0,
  "ReadTransferCount": 0,
  "SessionId": 0,
  "ThreadCount": 2,
  "UserModeTime": 0,
  "VirtualSize": 8192,
  "WindowsVersion": "10.0.17763",
  "WorkingSetSize": 8192,
  "WriteOperationCount": 0,
  "WriteTransferCount": 0
}
```

### System Information Query

[Permalink: System Information Query](https://github.com/oiweiwei/wmiq#system-information-query)

Get operating system information:

```
wmiq 192.168.1.100 -u domain\\administrator -p password123 "SELECT * FROM Win32_OperatingSystem"
```

### Service Query with YAML Output

[Permalink: Service Query with YAML Output](https://github.com/oiweiwei/wmiq#service-query-with-yaml-output)

List all services in YAML format:

```
wmiq server.domain.com -u user@domain.com -p mypassword "SELECT Name, State, StartMode FROM Win32_Service" -o yaml --limit 5
```

### Using NT Hash Authentication

[Permalink: Using NT Hash Authentication](https://github.com/oiweiwei/wmiq#using-nt-hash-authentication)

Authenticate using NT hash:

```
wmiq target.domain.com -u administrator -H aad3b435b51404eeaad3b435b51404ee:5fbc3d5fec8206a30f4b6c473d68ae76 "SELECT * FROM Win32_LogicalDisk"
```

### Kerberos Authentication

[Permalink: Kerberos Authentication](https://github.com/oiweiwei/wmiq#kerberos-authentication)

Using Kerberos with a ccache file:

```
wmiq dc.domain.com -k --ccache /tmp/krb5cc_1000 "SELECT * FROM Win32_ComputerSystem"
```

### Named Pipe Transport

[Permalink: Named Pipe Transport](https://github.com/oiweiwei/wmiq#named-pipe-transport)

Use SMB named pipes instead of TCP:

```
wmiq target.domain.com -u user -p password --named-pipe "SELECT * FROM Win32_Process WHERE Name='explorer.exe'"
```

### Through SOCKS5 Proxy

[Permalink: Through SOCKS5 Proxy](https://github.com/oiweiwei/wmiq#through-socks5-proxy)

Route traffic through a SOCKS5 proxy:

```
wmiq target.internal --socks 127.0.0.1:1080 -u domain\\user -p password "SELECT * FROM Win32_NetworkAdapter"
```

### Performance Optimization

[Permalink: Performance Optimization](https://github.com/oiweiwei/wmiq#performance-optimization)

For large result sets, use forward-only enumeration and custom page size:

```
wmiq server.com -u user -p pass "SELECT * FROM Win32_Process" --forward-only --page 50 --limit 100
```

## Common WMI Classes

[Permalink: Common WMI Classes](https://github.com/oiweiwei/wmiq#common-wmi-classes)

Here are some useful WMI classes you can query:

- **Win32\_Process** \- Running processes
- **Win32\_Service** \- Windows services
- **Win32\_OperatingSystem** \- OS information
- **Win32\_ComputerSystem** \- Computer hardware info
- **Win32\_LogicalDisk** \- Disk drives and storage
- **Win32\_NetworkAdapter** \- Network adapters
- **Win32\_UserAccount** \- User accounts
- **Win32\_Group** \- Security groups
- **Win32\_StartupCommand** \- Startup programs
- **Win32\_ScheduledJob** \- Scheduled tasks
- **Win32\_Share** \- Network shares
- **Win32\_EventLogFile** \- Event logs

## WQL Query Examples

[Permalink: WQL Query Examples](https://github.com/oiweiwei/wmiq#wql-query-examples)

### Filter by Process Name

[Permalink: Filter by Process Name](https://github.com/oiweiwei/wmiq#filter-by-process-name)

```
SELECT * FROM Win32_Process WHERE Name = 'notepad.exe'
```

### Get Specific Properties

[Permalink: Get Specific Properties](https://github.com/oiweiwei/wmiq#get-specific-properties)

```
SELECT Name, ProcessId, CommandLine FROM Win32_Process
```

### Services with Specific State

[Permalink: Services with Specific State](https://github.com/oiweiwei/wmiq#services-with-specific-state)

```
SELECT * FROM Win32_Service WHERE State = 'Running'
```

### Disk Space Information

[Permalink: Disk Space Information](https://github.com/oiweiwei/wmiq#disk-space-information)

```
SELECT DeviceID, Size, FreeSpace FROM Win32_LogicalDisk WHERE DriveType = 3
```

## WMI Namespaces

[Permalink: WMI Namespaces](https://github.com/oiweiwei/wmiq#wmi-namespaces)

WMI organizes classes into hierarchical namespaces. The default namespace is `root/cimv2`, but you can specify different namespaces using the `-n` or `--namespace` parameter.

### Common WMI Namespaces

[Permalink: Common WMI Namespaces](https://github.com/oiweiwei/wmiq#common-wmi-namespaces)

- **root/cimv2**(default) - Standard CIM classes for system information

  - Win32\_Process, Win32\_Service, Win32\_OperatingSystem, etc.
- **root/wmi**\- Windows-specific WMI providers

  - Hardware monitoring, performance counters
- **root/directory/ldap**\- Active Directory information

  - AD users, groups, organizational units
- **root/microsoftiisv2**\- Internet Information Services (IIS)

  - Web sites, application pools, virtual directories
- **root/ccm**\- System Center Configuration Manager

  - SCCM client information and policies
- **root/securitycenter**\- Windows Security Center

  - Antivirus, firewall, and security product information
- **root/subscription**\- Event subscriptions

  - WMI event consumers and filters

### Using Different Namespaces

[Permalink: Using Different Namespaces](https://github.com/oiweiwei/wmiq#using-different-namespaces)

Query Active Directory information:

```
wmiq dc.domain.com -u user -p pass -n "root/directory/ldap" "SELECT * FROM ds_user"
```

Query IIS configuration:

```
wmiq webserver.domain.com -u admin -p pass -n "root/microsoftiisv2" "SELECT * FROM IIsWebServer"
```

Query security center information:

```
wmiq target.com -u user -p pass -n "root/securitycenter" "SELECT * FROM AntiVirusProduct"
```

Query WMI performance data:

```
wmiq server.com -u user -p pass -n "root/wmi" "SELECT * FROM MSAcpi_ThermalZoneTemperature"
```

### Discovering Available Classes in a Namespace

[Permalink: Discovering Available Classes in a Namespace](https://github.com/oiweiwei/wmiq#discovering-available-classes-in-a-namespace)

To see what classes are available in a specific namespace, you can query the meta-classes:

```
wmiq target.com -u user -p pass -n "root/cimv2" "SELECT * FROM meta_class WHERE __class LIKE 'Win32_%DNS'"
```

## Authentication Methods

[Permalink: Authentication Methods](https://github.com/oiweiwei/wmiq#authentication-methods)

### Username/Password

[Permalink: Username/Password](https://github.com/oiweiwei/wmiq#usernamepassword)

```
-u username -p password
-u domain\\username -p password
-u username@domain.com -p password
```

### NT Hash

[Permalink: NT Hash](https://github.com/oiweiwei/wmiq#nt-hash)

```
-u username -H ntlmhash
-u username -H lmhash:ntlmhash
```

### Kerberos Authentication

[Permalink: Kerberos Authentication](https://github.com/oiweiwei/wmiq#kerberos-authentication-1)

Using Kerberos with a ccache file:

```
wmiq dc.domain.com -k --ccache /tmp/krb5cc_1000 "SELECT * FROM Win32_ComputerSystem"
```

#### Creating a Kerberos ccache file in Linux

[Permalink: Creating a Kerberos ccache file in Linux](https://github.com/oiweiwei/wmiq#creating-a-kerberos-ccache-file-in-linux)

First, obtain a Kerberos ticket using `kinit`:

```
# Authenticate with domain user and specify ccache file location
kinit -c /tmp/krb5cc_wmiq user@DOMAIN.COM

# Verify ticket was obtained
klist -c /tmp/krb5cc_wmiq

# Alternative: use default location
kinit user@DOMAIN.COM
klist
```

Then use wmiq with the ccache file:

```
# Use a specific ccache file
wmiq dc.domain.com -k --ccache /tmp/krb5cc_wmiq "SELECT * FROM Win32_Process" --limit 5

# Or use the default ccache location (wmiq will auto-detect)
wmiq dc.domain.com -k "SELECT * FROM Win32_Process" --limit 5
```

Example complete workflow:

```
# Obtain Kerberos ticket with specific ccache file
kinit -c /tmp/krb5cc_wmiq administrator@CONTOSO.COM
# Password: ********

# Verify ticket
klist -c /tmp/krb5cc_wmiq
# Ticket cache: FILE:/tmp/krb5cc_wmiq
# Default principal: administrator@CONTOSO.COM

# Query WMI using Kerberos authentication
wmiq dc01.contoso.com -k --ccache /tmp/krb5cc_wmiq "SELECT Name, State FROM Win32_Service WHERE State='Running'" --limit 3
```

#### Using AES Key with Kerberos

[Permalink: Using AES Key with Kerberos](https://github.com/oiweiwei/wmiq#using-aes-key-with-kerberos)

If you have an AES key instead of a password, you can use it directly:

```
# Using AES-256 key (hex format)
wmiq dc01.contoso.com -k --aes-key a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456 "SELECT * FROM Win32_Process" --limit 5

# Combined with ccache file
wmiq dc01.contoso.com -k --ccache /tmp/krb5cc_wmiq --aes-key a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456 "SELECT * FROM Win32_ComputerSystem"
```

## Troubleshooting

[Permalink: Troubleshooting](https://github.com/oiweiwei/wmiq#troubleshooting)

### Enable Debug Output

[Permalink: Enable Debug Output](https://github.com/oiweiwei/wmiq#enable-debug-output)

Use the `--debug` flag to see detailed protocol communication:

```
wmiq target.com -u user -p pass "SELECT * FROM Win32_Process" --debug
```

### Common Issues

[Permalink: Common Issues](https://github.com/oiweiwei/wmiq#common-issues)

1. **Access Denied**: Ensure the user has WMI query permissions on the target system
2. **Authentication Failures**: Verify credentials and try different authentication methods
3. **Large Result Sets**: Use `--limit` and `--page` parameters to manage memory usage

## Dependencies

[Permalink: Dependencies](https://github.com/oiweiwei/wmiq#dependencies)

- [RedTeamPentesting/adauth](https://github.com/RedTeamPentesting/adauth) \- Active Directory authentication
- [oiweiwei/go-msrpc](https://github.com/oiweiwei/go-msrpc) \- Microsoft RPC protocol implementation

## License

[Permalink: License](https://github.com/oiweiwei/wmiq#license)

This project is licensed under the terms specified in the LICENSE file.

## Contributing

[Permalink: Contributing](https://github.com/oiweiwei/wmiq#contributing)

Contributions are welcome! Please feel free to submit issues and pull requests.

## Security Considerations

[Permalink: Security Considerations](https://github.com/oiweiwei/wmiq#security-considerations)

- This tool can be used for legitimate system administration and security testing
- Always ensure you have proper authorization before querying remote systems
- Be mindful of credentials and use secure authentication methods when possible
- Consider using SOCKS5 proxies in sensitive network environments

## Useful Resources

[Permalink: Useful Resources](https://github.com/oiweiwei/wmiq#useful-resources)

### WQL Reference and Documentation

[Permalink: WQL Reference and Documentation](https://github.com/oiweiwei/wmiq#wql-reference-and-documentation)

- **[WQL (SQL for WMI) Reference](https://learn.microsoft.com/en-us/windows/win32/wmisdk/wql-sql-for-wmi)** \- Official Microsoft WQL documentation
- **[WMI Classes Reference](https://learn.microsoft.com/en-us/windows/win32/cimwin32prov/win32-provider)** \- Complete list of Win32 WMI classes
- **[WQL Operators](https://learn.microsoft.com/en-us/windows/win32/wmisdk/where-clause)** \- WHERE clause operators and syntax
- **[WMI Query Language by Example](https://www.codeproject.com/Articles/46390/WMI-Query-Language-by-Example)** \- Practical WQL examples and syntax guide

## About

wmi query command-line utility


### Topics

[windows](https://github.com/topics/windows "Topic: windows") [linux](https://github.com/topics/linux "Topic: linux") [hacking](https://github.com/topics/hacking "Topic: hacking") [wmi](https://github.com/topics/wmi "Topic: wmi") [wmic](https://github.com/topics/wmic "Topic: wmic") [wql](https://github.com/topics/wql "Topic: wql")

### Resources

[Readme](https://github.com/oiweiwei/wmiq#readme-ov-file)

### License

[MIT license](https://github.com/oiweiwei/wmiq#MIT-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/oiweiwei/wmiq).

[Activity](https://github.com/oiweiwei/wmiq/activity)

### Stars

[**1**\\
star](https://github.com/oiweiwei/wmiq/stargazers)

### Watchers

[**0**\\
watching](https://github.com/oiweiwei/wmiq/watchers)

### Forks

[**0**\\
forks](https://github.com/oiweiwei/wmiq/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Foiweiwei%2Fwmiq&report=oiweiwei+%28user%29)

## [Releases\  1](https://github.com/oiweiwei/wmiq/releases)

[v0.1.0\\
Latest\\
\\
on Aug 7, 2025Aug 7, 2025](https://github.com/oiweiwei/wmiq/releases/tag/v0.1.0)

## [Packages\  0](https://github.com/users/oiweiwei/packages?repo_name=wmiq)

No packages published

## Languages

- [Go100.0%](https://github.com/oiweiwei/wmiq/search?l=go)

You can’t perform that action at this time.