Title:
Engineering antivirus evasion (Part II) – Hiding API imports via automated C/C++ refactoring (avcleaner)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains how static AV engines fingerprint Windows binaries by inspecting clear-text DLL/API names in the PE Import Address Table (IAT) and associated strings.  
- It demonstrates replacing load-time imports with run-time dynamic linking (LoadLibrary/GetProcAddress) and obfuscating the DLL/API strings (e.g., stack strings) to remove obvious indicators from the binary.  
- The core contribution is an automated source-to-source refactoring approach using Clang libTooling: AST matchers locate targeted API call sites and rewrite code to inject typedefs, LoadLibrary/GetProcAddress stubs, and renamed call identifiers.  
- The technique is generalized to hide “suspicious” APIs (example focus on samlib.dll SAM* functions) and is tested against real offensive code (e.g., mimikatz/lsadump) to reduce static detections (notably ESET Nod32).  
- It’s useful for red teams/pentest tool developers and malware researchers who need to reduce static signatures in C/C++ payloads (e.g., Meterpreter modules).  
- It’s interesting because it operationalizes AV-evasion refactoring at scale across a codebase using AST-aware transformations rather than brittle regex-based rewriting.

Technical Focus:
- PE import table / Import Address Table (IAT) fingerprinting
- Run-time dynamic linking (LoadLibraryA, GetProcAddress) vs load-time imports
- String obfuscation via stack strings / encoded literals
- Clang libTooling, AST dumping, ASTMatchers, Rewriter-based source transformation
- Automated injection of typedefs/function pointers and call-site rewriting
- Evasion tuning using targeted API sets (e.g., samlib.dll SAM RPC APIs)

Use Cases:
- Reduce static AV/EDR signatures by removing suspicious imports from compiled PE files
- Automatically refactor large C/C++ offensive codebases (Meterpreter modules, mimikatz forks) to hide WinAPI usage
- Generate per-build polymorphism by randomizing identifiers and avoiding stable string artifacts
- Pre-processing step before further evasion (e.g., replacing WinAPI with custom loaders or direct syscalls)

Keywords:
Import Address Table, IAT, PE format, Windows API imports, LoadLibraryA, GetProcAddress, run-time dynamic linking, function pointers, Clang libTooling, ASTMatcher, clang-query, Rewriter, source-to-source transformation, string obfuscation, stack strings, Meterpreter, mimikatz, samlib.dll, SamConnect, ESET Nod32