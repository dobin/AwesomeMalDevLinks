# https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking

[Skip to content](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking) to refresh your session.Dismiss alert

{{ message }}

[Hue-Jhan](https://github.com/Hue-Jhan)/ **[Syscalls-Thread-Hijacking](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking)** Public

- [Notifications](https://github.com/login?return_to=%2FHue-Jhan%2FSyscalls-Thread-Hijacking) You must be signed in to change notification settings
- [Fork\\
0](https://github.com/login?return_to=%2FHue-Jhan%2FSyscalls-Thread-Hijacking)
- [Star\\
5](https://github.com/login?return_to=%2FHue-Jhan%2FSyscalls-Thread-Hijacking)


Thread Hijacking malware using direct/indirect syscalls, ntdll and low level utilities, undetected by Windows Defender and BitDefender


### License

[CC0-1.0 license](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/LICENSE)

[5\\
stars](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/stargazers) [0\\
forks](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/forks) [Branches](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/branches) [Tags](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tags) [Activity](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/activity)

[Star](https://github.com/login?return_to=%2FHue-Jhan%2FSyscalls-Thread-Hijacking)

[Notifications](https://github.com/login?return_to=%2FHue-Jhan%2FSyscalls-Thread-Hijacking) You must be signed in to change notification settings

# Hue-Jhan/Syscalls-Thread-Hijacking

main

[**1** Branch](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/branches) [**0** Tags](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tags)

[Go to Branches page](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/branches)[Go to Tags page](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![Hue-Jhan](https://avatars.githubusercontent.com/u/75088696?v=4&size=40)](https://github.com/Hue-Jhan)[Hue-Jhan](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commits?author=Hue-Jhan)<br>[Update README.md](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/574445ea080919f61f2a3b016748c3dfbbc38cb4)<br>last monthJan 20, 2026<br>[574445e](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/574445ea080919f61f2a3b016748c3dfbbc38cb4)Â Â·Â last monthJan 20, 2026<br>## History<br>[28 Commits](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commits/main/) 28 Commits |
| [direct\_code\_basic](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/direct_code_basic "direct_code_basic") | [direct\_code\_basic](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/direct_code_basic "direct_code_basic") | [add direct code basic](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/b396ebcfef4c632d94f4d5cca99ba888dfeb8c22 "add direct code basic") | 3 months agoDec 2, 2025 |
| [direct\_code\_dll](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/direct_code_dll "direct_code_dll") | [direct\_code\_dll](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/direct_code_dll "direct_code_dll") | [add direct dll](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/f01c1ca03b7c997d63549fe01b68a2cdd6f862a4 "add direct dll") | 3 months agoDec 2, 2025 |
| [indirect\_code\_basic](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/indirect_code_basic "indirect_code_basic") | [indirect\_code\_basic](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/indirect_code_basic "indirect_code_basic") | [add indirect code basic](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/e82d7fc4a1d9e2358d7175f989f9ddf3120fda89 "add indirect code basic") | 3 months agoDec 2, 2025 |
| [indirect\_code\_dll](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/indirect_code_dll "indirect_code_dll") | [indirect\_code\_dll](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/indirect_code_dll "indirect_code_dll") | [add indir code dll](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/f234e79eea6b2aad607b06aaa0943adb77d6fe09 "add indir code dll") | 3 months agoDec 2, 2025 |
| [media](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/media "media") | [media](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/tree/main/media "media") | [Add files via upload](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/182caf89515078dc272c15e2bda87578974a8db1 "Add files via upload") | 3 months agoDec 2, 2025 |
| [LICENSE](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/LICENSE "LICENSE") | [Initial commit](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/e66d7d3df899087ca415337d90606e329160f034 "Initial commit") | 3 months agoNov 30, 2025 |
| [README.md](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/README.md "README.md") | [README.md](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/README.md "README.md") | [Update README.md](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/commit/574445ea080919f61f2a3b016748c3dfbbc38cb4 "Update README.md") | last monthJan 20, 2026 |
| View all files |

## Repository files navigation

# System calls Thread Hijacking Malwares

[Permalink: System calls Thread Hijacking Malwares](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#system-calls-thread-hijacking-malwares)

Collection of Thread Hijacking malware using direct/syscalls, ntdll and low level utilities, undetected by Windows Defender and BitDefender.

This code is for educational purposes only, do not use it for any malicious or unauthorized activity.

# ðŸ’» Code

[Permalink: ðŸ’» Code](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#-code)

[![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/indirsyscall-hijak-cr-reshak-msi.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/indirsyscall-hijak-cr-reshak-msi.png)

More advanced version of [this](https://github.com/Hue-Jhan/Ntdll-Thread-Hijacking-trojan) malware collection, it uses system calls resolved dynamically from ntdll.dll functions to hijack one of the target process threads and inject it with shellcode. This bypasses usermode AV hooks, EDRs, and reduces static IAT footprint. Using direct syscalls i made a process injection version and a Dll version, then i did the same thing but with indirect syscalls.

### 0) Direct/Indirect system calls explained

[Permalink: 0) Direct/Indirect system calls explained](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#0-directindirect-system-calls-explained)

On Windows, many native API functions inside ntdll.dll eventually execute a syscall that transitions execution from user mode to kernel mode. This code extracts the system service number (SSN) of some native api functions and puts it in their new unhooked structs. The ssn changes from a windows version to another, so it has to be resolved at runtime. Here is the struct the code looks for:

```
mov r10, rcx
mov eax, 0x00001BE   ; SSN
syscall              ; found and replaced with "qword ptr [Syscall addr]"
```

This is not ntdll unhooking because we do not directly modify the function but simply bypass the hook placed at the beginning of the function (jmp ...). In the indirect syscall version the code also locates the "syscall" instruction inside that function and jumps to that after setting the SSN.

So basically this code:

- Creates custom typedef structs for each function (+ internal structures and objects that they need);
- Manually resolves their RVA in ntdll with `GetProcAddressManual(ex)`;
- Replaces the instructions with the assembly stubs containing the SSN and syscall address;
- Uses the new nt functions to hijack an existing thread (or to create and hijack a new thread) inside a target process;

To get the RVA of each nt procedure (located in the export directory) i used `GetProcAddressManualEx()`, a custom function made by chatgp- ehm i mean me, that parses the PE headers and walks the export directory instead of calling the Windows api. So the process looks like this:

- Read the **DOS header** and use `e_lfanew` to get to nt headers;
- At `base + e_lfanew` find the **NT headers** (signature + IMAGE\_FILE\_HEADER + IMAGE\_OPTIONAL\_HEADER), the OptionalHeader contains the DataDirectory array.
- **OptionalHeader.DataDirectory**\[IMAGE\_DIRECTORY\_ENTRY\_EXPORT\] gives the RVA/size of the Export Directory, so `base + rva` goes to IMAGE\_EXPORT\_DIRECTORY in memory.
- **Export Directory**contains 3 lists:

  - AddressOfNames: array of RVAs to ASCII names, for example `nameRvas[i] = "LoadLibraryA"`;
  - AddressOfNameOrdinals: each index corresponds to a function name and tells you the ordinal for that name, `ordinals[i] = index into AddressOfFunctions`;
  - AddressOfFunctions: array of RVAs of the real exported functions, `funcRvas[ordinal] = RVA of the actual function`.

So to resolve a name we find the name in the AddressOfNames array, get its `ordinals[i]` value (index), read `funcRvas[ordinals[i]]`, and convert the function RVA to an absolute address by adding the module base: `funct_add = base + funcRvas[ordinals[i]]`.

If funcRva points back inside the export directory region then the entry is a forwarded export, in this case and in other special cases like failing to validates the DOS header magic (MZ) and the PE signature, or if the RVA is too big, the function simply returns null.

### 1) Process injection

[Permalink: 1) Process injection](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#1-process-injection)

[![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/dirsyscall-hijak-cr3.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/dirsyscall-hijak-cr3.png)

This technique is a simple remote process injection with encrypted shellcode, you can find this pattern in most of my malware samples and the shellcode is most of the times just for a msgbox that says "xd". On the right are the raw direct proc-inj detections, and below the indirect ones:

- The shellcode is decrypted, for a better view of the encryption mechanism check it out [here](https://github.com/Hue-Jhan/Simple-shellcode-crypter);
- The code then uses `NtQuerySystemInformation()` to list all existing processes, find the one that matches the name, save its pid and take a handle to it;
- After this the code does the same thing but iterating through all the threads of our system process to find one whose owner is the process we targeted earlier; [![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/indirsyscall-hijak-cr1.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/indirsyscall-hijak-cr1.png)
- Once its saves its Tid and gets a handle to it, the program will allocate memory for the payload, upload the shellcode in it, and change its permissions to RWX.
- Finally it will suspend the thread, change its instruction pointer to make it point to the payload, and resume it.

Because the thread in question might hold important operations, there is a high chance that after executing our new payload the process might crash, because it cannot function without the thread we hijacked.

The alternative version is a bit different, it does not iterate through every thread but simply creates an already suspended one (whose base address points to a dummy function) so that when hijacking it it's already suspended.

### 2) DLL

[Permalink: 2) DLL](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#2-dll)

[![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/dirsyscall-hijak-fin-dll.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/dirsyscall-hijak-fin-dll.png)

The DLL version is the same exact process but it's a DLL that operates in the same process it was injected into, stealthier than the first version. On the right are the detections for the direct and indirect dlls.

The difference is simply that once the dll is attached to a process, it will start a new thread that will function as the "main" function of the previous samples. In order to target the current process we use a harmless GetCurrentProcessId(), the rest is the same as the Process Injection version. [![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/indirsyscall-hijak-cr-dll.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/indirsyscall-hijak-cr-dll.png)

The new thread outside the loader lock is essential to avoid deadlock. You also might want to disable precompiled headers to remove the pch files.

# ðŸ›¡ AV Detection

[Permalink: ðŸ›¡ AV Detection](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#-av-detection)

[![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/dirsyscall-hijak-cr-reshak.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/dirsyscall-hijak-cr-reshak.png)

Undetected by Windows Defender and Bitdefender, although sometimes the Bitdefender Advanced threat defense system blocks some random operations like suspending the process or opening it... it does not warn the user, logs the activity or whatsoever, it just blocks the execution.... idk

[![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/indirsyscall-hijak-cr-reshak.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/indirsyscall-hijak-cr-reshak.png)

Here you can find the detections for the direct/indirect process injections obfuscated with some metadata or wrapped in msi files. [![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/indirsyscall-hijak-cr-reshak-msi.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/indirsyscall-hijak-cr-reshak-msi.png)

If an EDR replaced the syscall instruction itself with a trampoline, the jump may land in the hook/trampoline and will not bypass detection. So this method does not bypass any kernel-level monitoring, ETW, callbacks, filtering, or advanced trampolines.

[![](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/raw/main/media/dirsyscall-hijak-fin-dll-reshack.png)](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/blob/main/media/dirsyscall-hijak-fin-dll-reshack.png)

This one on the left shows the detections for the obfuscated dll versions, which drop to 0 by simply injecting ntdll metadata, keep in mind that the injector must be undetected too.

## About

Thread Hijacking malware using direct/indirect syscalls, ntdll and low level utilities, undetected by Windows Defender and BitDefender


### Topics

[malware-analysis](https://github.com/topics/malware-analysis "Topic: malware-analysis") [shellcode-loader](https://github.com/topics/shellcode-loader "Topic: shellcode-loader") [system-calls](https://github.com/topics/system-calls "Topic: system-calls") [process-injection](https://github.com/topics/process-injection "Topic: process-injection") [shellcode-injection](https://github.com/topics/shellcode-injection "Topic: shellcode-injection") [thread-hijacking](https://github.com/topics/thread-hijacking "Topic: thread-hijacking") [direct-syscalls](https://github.com/topics/direct-syscalls "Topic: direct-syscalls")

### Resources

[Readme](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#readme-ov-file)

### License

[CC0-1.0 license](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking#CC0-1.0-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking).

[Activity](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/activity)

### Stars

[**5**\\
stars](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/stargazers)

### Watchers

[**0**\\
watching](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/watchers)

### Forks

[**0**\\
forks](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FHue-Jhan%2FSyscalls-Thread-Hijacking&report=Hue-Jhan+%28user%29)

## [Releases](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/releases)

No releases published

## [Packages\  0](https://github.com/users/Hue-Jhan/packages?repo_name=Syscalls-Thread-Hijacking)

No packages published

## Languages

- [C90.3%](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/search?l=c)
- [Assembly9.4%](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/search?l=assembly)
- [C++0.3%](https://github.com/Hue-Jhan/Syscalls-Thread-Hijacking/search?l=c%2B%2B)

You canâ€™t perform that action at this time.