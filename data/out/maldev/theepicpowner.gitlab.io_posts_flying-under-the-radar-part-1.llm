Title:
Flying Under the Radar (Part 1): Resolving Sensitive Windows Functions with x64 Assembly

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains how to resolve Windows DLLs and exported function addresses at runtime using x64 MASM assembly, avoiding reliance on standard APIs like GetProcAddress/GetModuleHandle.  
- The core problem addressed is reducing suspicious Import Address Table (IAT) entries (static detection) and avoiding obvious user-mode API usage patterns that may be monitored/hooked by EDRs (dynamic detection).  
- It walks through locating loaded modules via the PEB/TEB (GS:[0x60]) and traversing PEB->Ldr module lists to find a target DLL base (e.g., ntdll.dll).  
- It then details manual export parsing (DOS header -> NT headers -> IMAGE_EXPORT_DIRECTORY) to resolve a function like NtDelayExecution by iterating AddressOfNames, mapping to ordinals, and retrieving the final function RVA from AddressOfFunctions.  
- The post also compares how MSVC, MinGW, and LLVM/Clang affect resulting IAT entries, including approaches that can yield extremely small or even empty import tables.  
- Useful for red teamers, malware developers, and defenders/reverse engineers who want to understand PEB-walking, custom API resolution, and how build toolchains influence PE import artifacts.

Technical Focus:
- PEB/TEB access and module enumeration (InLoadOrderModuleList / LDR_DATA_TABLE_ENTRY)
- Manual PE export table parsing (IMAGE_DOS_HEADER, IMAGE_NT_HEADERS64, IMAGE_EXPORT_DIRECTORY)
- Custom GetModuleHandle/GetProcAddress-style resolvers in x64 assembly (MASM)
- IAT minimization and compiler/CRT import side-effects (MSVC vs MinGW vs Clang)
- EDR considerations: user-mode API monitoring/hooking and call-chain visibility

Use Cases:
- Building custom runtime API resolvers to avoid importing sensitive Win32/NT APIs
- Creating “lean import” PE payloads for tradecraft experimentation and detection research
- Preparing groundwork for syscall-based techniques (direct/indirect) by resolving ntdll exports
- Reverse engineering/detection engineering: recognizing PEB-walking and export-parsing patterns
- Comparing compiler/linker configurations to understand PE import artifacts

Keywords:
PEB, TEB, GS segment, ntdll.dll, kernel32.dll, LDR_DATA_TABLE_ENTRY, PEB_LDR_DATA, InLoadOrderModuleList, IMAGE_DOS_HEADER, e_lfanew, IMAGE_NT_HEADERS64, IMAGE_EXPORT_DIRECTORY, AddressOfNames, AddressOfNameOrdinals, AddressOfFunctions, NtDelayExecution, GetProcAddress, GetModuleHandle, IAT, MASM, ml64, MSVC, MinGW, clang, CRT, EDR hooking, static analysis, dynamic analysis