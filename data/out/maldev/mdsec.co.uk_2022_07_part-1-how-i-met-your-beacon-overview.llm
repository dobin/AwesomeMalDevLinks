Title:
Part 1: How I Met Your Beacon – Overview

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post outlines practical strategies for detecting in-memory C2 “beacons” on Windows endpoints, focusing on generic implant presence rather than specific post-exploitation actions.  
- It frames detection around observable load-time behavior (notably anomalous DLL load sequences) and in-memory artifacts left by injection, patching, and execution.  
- Techniques discussed include EQL-based behavioral hunting, YARA memory signatures, identifying common security-control patches (AMSI/ETW), and detecting copy-on-write pages created by in-memory modifications.  
- It also covers thread-based anomalies (unbacked start addresses, suspicious call stacks, cloned thread context indicators) and executable private memory regions as strong signals of injected code.  
- The post discusses “page permission fluctuation” tradecraft (removing RX while sleeping) and module stomping, including detection ideas like memory-vs-disk module comparison and CoW heuristics.  
- It’s useful for threat hunters/blue teams building high-signal hunts, and for red teams to understand which implant tradecraft creates durable endpoint indicators.

Technical Focus:
- Windows DLL load behavior and sequence-based detections (EQL)
- YARA-based in-memory signature scanning
- AMSI/ETW patch detection and in-memory hooks
- Copy-on-write page detection via QueryWorkingSetEx / PSAPI_WORKING_SET_EX_INFORMATION
- Thread anomaly hunting (start address, call stack spoofing, TIB/stack duplication)
- Module stomping and memory-vs-disk integrity checks

Use Cases:
- Hunt for beacon execution via anomalous DLL load chains (e.g., winhttp.dll + credui.dll)
- Detect AMSI/ETW tampering by spotting patched exports (EtwEventWrite, AmsiScanBuffer/OpenSession)
- Identify injected implants via private committed executable pages (RX/RWX) and suspicious threads
- Triage suspected call stack spoofing/cloned thread contexts using TIB/stack base-limit duplication
- Detect module stomping through CoW indicators and module content comparison against on-disk images

Keywords:
Beacon detection, in-memory implant, Windows internals, EQL, YARA, DLL load sequence, winhttp.dll, wininet.dll, credui.dll, dbghelp.dll, samcli.dll, AMSI, ETW, EtwEventWrite, AmsiScanBuffer, AmsiOpenSession, QueryWorkingSetEx, PSAPI_WORKING_SET_EX_INFORMATION, copy-on-write, NtQueryInformationThread, Thread Information Block, VirtualAlloc, VirtualProtect, MEM_IMAGE, MEM_COMMIT, module stomping, Cobalt Strike, Sliver, Nighthawk, Ekko, Gargoyle, ShellcodeFluctuation