# https://github.com/naksyn/DojoLoader

[Skip to content](https://github.com/naksyn/DojoLoader#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/naksyn/DojoLoader) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/naksyn/DojoLoader) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/naksyn/DojoLoader) to refresh your session.Dismiss alert

{{ message }}

[naksyn](https://github.com/naksyn)/ **[DojoLoader](https://github.com/naksyn/DojoLoader)** Public

- [Notifications](https://github.com/login?return_to=%2Fnaksyn%2FDojoLoader) You must be signed in to change notification settings
- [Fork\\
50](https://github.com/login?return_to=%2Fnaksyn%2FDojoLoader)
- [Star\\
244](https://github.com/login?return_to=%2Fnaksyn%2FDojoLoader)


Generic PE loader for fast prototyping evasion techniques


### License

[Apache-2.0 license](https://github.com/naksyn/DojoLoader/blob/main/LICENSE)

[244\\
stars](https://github.com/naksyn/DojoLoader/stargazers) [50\\
forks](https://github.com/naksyn/DojoLoader/forks) [Branches](https://github.com/naksyn/DojoLoader/branches) [Tags](https://github.com/naksyn/DojoLoader/tags) [Activity](https://github.com/naksyn/DojoLoader/activity)

[Star](https://github.com/login?return_to=%2Fnaksyn%2FDojoLoader)

[Notifications](https://github.com/login?return_to=%2Fnaksyn%2FDojoLoader) You must be signed in to change notification settings

# naksyn/DojoLoader

main

[**1** Branch](https://github.com/naksyn/DojoLoader/branches) [**0** Tags](https://github.com/naksyn/DojoLoader/tags)

[Go to Branches page](https://github.com/naksyn/DojoLoader/branches)[Go to Tags page](https://github.com/naksyn/DojoLoader/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![naksyn](https://avatars.githubusercontent.com/u/59816245?v=4&size=40)](https://github.com/naksyn)[naksyn](https://github.com/naksyn/DojoLoader/commits?author=naksyn)<br>[URL fix](https://github.com/naksyn/DojoLoader/commit/e339b73b546a6527deeed35456bf37baa60fd117)<br>2 years agoJul 2, 2024<br>[e339b73](https://github.com/naksyn/DojoLoader/commit/e339b73b546a6527deeed35456bf37baa60fd117) · 2 years agoJul 2, 2024<br>## History<br>[4 Commits](https://github.com/naksyn/DojoLoader/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/naksyn/DojoLoader/commits/main/) 4 Commits |
| [DojoLoader](https://github.com/naksyn/DojoLoader/tree/main/DojoLoader "DojoLoader") | [DojoLoader](https://github.com/naksyn/DojoLoader/tree/main/DojoLoader "DojoLoader") | [Initial commit](https://github.com/naksyn/DojoLoader/commit/b0834ba05ec8a4f93a74946deeea501372e778f5 "Initial commit") | 2 years agoJul 2, 2024 |
| [Utils](https://github.com/naksyn/DojoLoader/tree/main/Utils "Utils") | [Utils](https://github.com/naksyn/DojoLoader/tree/main/Utils "Utils") | [Initial commit](https://github.com/naksyn/DojoLoader/commit/b0834ba05ec8a4f93a74946deeea501372e778f5 "Initial commit") | 2 years agoJul 2, 2024 |
| [DojoLoader.sln](https://github.com/naksyn/DojoLoader/blob/main/DojoLoader.sln "DojoLoader.sln") | [DojoLoader.sln](https://github.com/naksyn/DojoLoader/blob/main/DojoLoader.sln "DojoLoader.sln") | [Initial commit](https://github.com/naksyn/DojoLoader/commit/b0834ba05ec8a4f93a74946deeea501372e778f5 "Initial commit") | 2 years agoJul 2, 2024 |
| [LICENSE](https://github.com/naksyn/DojoLoader/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/naksyn/DojoLoader/blob/main/LICENSE "LICENSE") | [Initial commit](https://github.com/naksyn/DojoLoader/commit/b0834ba05ec8a4f93a74946deeea501372e778f5 "Initial commit") | 2 years agoJul 2, 2024 |
| [README.md](https://github.com/naksyn/DojoLoader/blob/main/README.md "README.md") | [README.md](https://github.com/naksyn/DojoLoader/blob/main/README.md "README.md") | [URL fix](https://github.com/naksyn/DojoLoader/commit/e339b73b546a6527deeed35456bf37baa60fd117 "URL fix") | 2 years agoJul 2, 2024 |
| View all files |

## Repository files navigation

[![Twitter](https://camo.githubusercontent.com/3e2a6c7ad8f60db1d64964d88909cd29669e20118b51380a0ad11b261f7dd4ad/68747470733a2f2f696d672e736869656c64732e696f2f747769747465722f666f6c6c6f772f6e616b73796e3f6c6162656c3d6e616b73796e267374796c653d736f6369616c)](https://twitter.com/intent/follow?screen_name=naksyn)

# DojoLoader

[Permalink: DojoLoader](https://github.com/naksyn/DojoLoader#dojoloader)

Generic PE loader for fast prototyping evasion techniques

[![immagine](https://private-user-images.githubusercontent.com/59816245/344711090-af9abb9e-f731-4cf9-a11f-03e99d5f3262.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI4OTQsIm5iZiI6MTc3MTQxMjU5NCwicGF0aCI6Ii81OTgxNjI0NS8zNDQ3MTEwOTAtYWY5YWJiOWUtZjczMS00Y2Y5LWExMWYtMDNlOTlkNWYzMjYyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDExMDMxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQ4NzM2YWRiODE4M2NhZDQyZjMxNjkwZGE0Mjc5OTk4MTRkMzQxZTk2Yzg1NDU0NTMzMzRlOWMzYWVlM2IzMjUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.egga0noZw4elpoWdLmWr8ofsKIY9SBkYs7O45IxRe-Y)](https://private-user-images.githubusercontent.com/59816245/344711090-af9abb9e-f731-4cf9-a11f-03e99d5f3262.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI4OTQsIm5iZiI6MTc3MTQxMjU5NCwicGF0aCI6Ii81OTgxNjI0NS8zNDQ3MTEwOTAtYWY5YWJiOWUtZjczMS00Y2Y5LWExMWYtMDNlOTlkNWYzMjYyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDExMDMxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQ4NzM2YWRiODE4M2NhZDQyZjMxNjkwZGE0Mjc5OTk4MTRkMzQxZTk2Yzg1NDU0NTMzMzRlOWMzYWVlM2IzMjUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.egga0noZw4elpoWdLmWr8ofsKIY9SBkYs7O45IxRe-Y)

# What is it

[Permalink: What is it](https://github.com/naksyn/DojoLoader#what-is-it)

DojoLoader is a generic PE loader initially created to prototype sleep obfuscation techniques with Cobalt Strike UDRL-less raw Beacon payload, in an attempt to reduce debugging time with UDRLs.

[You can read this blog post for more insight on the journey](https://www.naksyn.com/cobalt%20strike/2024/07/02/raising-beacons-without-UDRLs-teaching-how-to-sleep.html).

DojoLoader borrows MemoryModule implementation of the [DynamicDllLoader](https://gitlab.com/ORCA000/dynamicdllloader) project by ORCA000 and expands on that adding modularity and the following features:

1. download and execution of (xored) shellcode from HTTP of from file
2. dynamic IAT hooking for Sleep function
3. Three different Sleep obfuscation techinques implemented in the hook library
   - RW->RX
   - MemoryBouncing
   - MemoryHopping

**Rw->RX** sleep obfuscation is a classic RW -> encrypt -> Sleep -> decrypt -> RX -> RW -> encrypt scheme.

**MemoryBouncing** is a diferent (from publicly available techniques) sleep obfuscation that aims to evade public RX->RW detections and involves the following steps:

1. Copy mapped PE to a buffer and encrypt it
2. Free mapped PE address
3. do sleep time (e.g. SleepEx)
4. Allocate RWX address on the same address were PE was mapped
5. deecrypt the buffer and copy it over the RWX memory

RX->RW detection is evaded by avoiding VirtualProtect and hiding the payload during sleep by freeing the payload memory area.

membounce.mp4

**MemoryHopping** is another different (from publicly available techniques) sleep obfuscation that aims to evade public RX->RW detections and involves the following steps:

1. save the return address
2. copy the mapped PE bytes to a buffer and optionally encrypt it
3. Free the memory of the mapped payload
4. allocate RWX memory on a different address
5. calculate delta and adjust the return address accordingly
6. copy bytes from the buffer to the newly created memory region
7. perform relocations on the copied bytes
8. resume execution form the adjusted return address

memhop2.mp4

# Usage

[Permalink: Usage](https://github.com/naksyn/DojoLoader#usage)

To use the loader with Cobalt Strike Beacon, generate first a UDRL-less payload using the cna in the Utils folder and -beacon flag with the loader.

```
Usage: -d <url> | -f <file> [-k <key>] [-s <function>] [-beacon]
Options:
  -d -download <url>     Load PE from the specified URL
  -f -file <file>                Load PE from the specified file
  -k -key <key>                  XOR the payload with the specified key
  -s -sleep <1 (membounce),2 (memhop),3 (RWRX)>          Sleep Obfuscation techniques:
                 1 or membounce for MemoryBouncing
                 2 or memhop for Memory Hopping (choose a compatible payload)
                 3 or RWRX for classic RW->RX
  -beacon                use Cobalt Strike UDRL-les Beacon payload execution method
  -h                     print this help
```

## About

Generic PE loader for fast prototyping evasion techniques


### Topics

[evasion](https://github.com/topics/evasion "Topic: evasion") [pe-loader](https://github.com/topics/pe-loader "Topic: pe-loader") [cobalt-strike](https://github.com/topics/cobalt-strike "Topic: cobalt-strike") [red-teaming](https://github.com/topics/red-teaming "Topic: red-teaming") [red-team-tools](https://github.com/topics/red-team-tools "Topic: red-team-tools") [edr-evasion](https://github.com/topics/edr-evasion "Topic: edr-evasion") [sleep-obfuscation](https://github.com/topics/sleep-obfuscation "Topic: sleep-obfuscation")

### Resources

[Readme](https://github.com/naksyn/DojoLoader#readme-ov-file)

### License

[Apache-2.0 license](https://github.com/naksyn/DojoLoader#Apache-2.0-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/naksyn/DojoLoader).

[Activity](https://github.com/naksyn/DojoLoader/activity)

### Stars

[**244**\\
stars](https://github.com/naksyn/DojoLoader/stargazers)

### Watchers

[**6**\\
watching](https://github.com/naksyn/DojoLoader/watchers)

### Forks

[**50**\\
forks](https://github.com/naksyn/DojoLoader/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fnaksyn%2FDojoLoader&report=naksyn+%28user%29)

## [Releases](https://github.com/naksyn/DojoLoader/releases)

No releases published

## [Packages\  0](https://github.com/users/naksyn/packages?repo_name=DojoLoader)

No packages published

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/naksyn/DojoLoader).

## Languages

- [C100.0%](https://github.com/naksyn/DojoLoader/search?l=c)

You can’t perform that action at this time.