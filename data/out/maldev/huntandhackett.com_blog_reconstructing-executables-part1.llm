Title:
Reconstructing Executables Part 1: Between Files and Memory

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post discusses why recovering malware samples from disk or by parsing a hostile process’s memory can fail, especially with self-deleting and file-tampering execution techniques.  
- It targets scenarios like Process Ghosting, Doppelgänging, and Herpaderping where the on-disk image is transient or reverted, and memory views can be encrypted, raced, or booby-trapped.  
- The authors propose an alternative forensic approach: reconstruct the original PE by extracting the cached image data from the process’s image section object (referenced by `EPROCESS->SectionObject`) rather than trusting attacker-controlled memory regions.  
- They outline how to obtain a section handle (via `NtQueryInformationProcess` with `ProcessImageSection`, requiring in-process execution due to access restrictions), map it (`NtMapViewOfSection`), and convert the in-memory PE layout back to on-disk layout (SectionAlignment → FileAlignment).  
- The post also covers relocation behavior (user-mode vs kernel “dynamic relocation”) and how to undo dynamic relocations using `NtQuerySection` relocation metadata.  
- Useful for malware analysts, DFIR, and blue teams building reliable acquisition tooling; also relevant to red teams understanding what artifacts persist despite fileless/tampered execution.

Technical Focus:
- Windows section objects (image sections vs data sections) and process creation internals
- PE reconstruction: memory layout vs file layout (SectionAlignment/FileAlignment)
- Native API usage: `NtQueryInformationProcess`, `NtMapViewOfSection`, `NtQuerySection`
- Process tampering techniques: Ghosting, Doppelgänging, Herpaderping, self-delete
- Relocations/ASLR: user-mode relocations vs kernel dynamic relocation
- Copy-on-write semantics and mitigation interactions (e.g., ACG)

Use Cases:
- Recovering executables from processes with deleted/overwritten backing files
- Forensic acquisition of “transient” malware launched via Ghosting/Doppelgänging/Herpaderping
- Building more robust PE dumpers that avoid parsing attacker-modified private memory
- Validating/diffing reconstructed images against disk artifacts for tamper detection

Keywords:
Windows internals, PE format, executable reconstruction, image section, section object, EPROCESS SectionObject, NtCreateProcessEx, NtCreateUserProcess, NtQueryInformationProcess, ProcessImageSection, NtMapViewOfSection, NtQuerySection, SectionRelocationInformation, ASLR, dynamic relocation, copy-on-write, Process Ghosting, Process Doppelgänging, Herpaderping, ACG (Arbitrary Code Guard)