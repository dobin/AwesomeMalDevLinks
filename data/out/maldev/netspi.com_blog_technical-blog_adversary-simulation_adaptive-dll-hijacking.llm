Title:
Adaptive DLL Hijacking

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post breaks down why “simple” Windows DLL hijacking often fails in real environments and presents more reliable, process-stable approaches.  
- It distinguishes two execution origins (“sinks”): static loads via the Import Address Table (IAT) and dynamic loads via LoadLibrary, explaining how export validation and IAT patching complicate static-sink hijacks.  
- The author covers multiple proxying strategies to preserve application functionality (export forwarding, stack patching, runtime linking, and runtime export-table generation) and discusses their tradeoffs.  
- A major focus is loader lock constraints in DllMain, common deadlock patterns, and safer patterns such as offloading work to a new thread plus selective function hooking to keep the host process alive.  
- The post culminates in “Koppeling,” a technique/tooling approach that post-build clones a reference DLL’s exports into an arbitrary payload DLL and uses export forwarding to proxy calls, improving stability and flexibility.  
- Useful for red teamers, adversary simulation engineers, and malware developers who need dependable DLL hijacks without crashing targets; also valuable for defenders understanding realistic hijack implementations.

Technical Focus:
- Windows loader internals (ntdll LDR: LdrLoadDll, LdrpInitializeProcess, LdrpCallInitRoutine)
- Static vs dynamic DLL load paths (IAT dependency graph vs LoadLibrary)
- Export Address Table (EAT) cloning and export forwarding
- Loader lock / DllMain constraints and deadlock scenarios
- Stack walking/patching and dynamic IAT/return-address manipulation
- Function hooking for post-load execution stability

Use Cases:
- Build stable DLL hijacks that preserve target application behavior via proxying
- Prepare arbitrary payload DLLs for hijacking by cloning/forwarding exports from a real DLL
- Avoid loader-lock deadlocks by deferring work to threads and hooking safe execution points
- Research/replicate advanced hijack tradecraft for adversary simulation and detection testing
- Analyze whether a hijack is static-sink or dynamic-sink to choose a viable technique

Keywords:
DLL hijacking, Windows loader, ntdll.dll, LdrLoadDll, LdrpCallInitRoutine, LdrpInitializeProcess, Import Address Table, IAT patching, Export Address Table, EAT cloning, export forwarding, DllMain, loader lock, dependency graph, GetProcAddress, LoadLibraryExW, stack walking, stack patching, function hooking, Koppeling