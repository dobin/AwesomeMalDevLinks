Title:
Detecting Cobalt Strike with memory signatures

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes how to detect Cobalt Strike Beacon by scanning live process memory with signatures rather than relying on on-disk artifacts.  
- It addresses the problem of packers, throwaway loaders, and reflective loading that prevent stable file-based signatures, by targeting the decrypted payload that must exist in memory at runtime.  
- The author demonstrates extracting Beacon memory regions (e.g., via unbacked threads calling SleepEx), then building YARA rules based on unique strings and byte patterns.  
- It covers Beacon’s “obfuscate-and-sleep” (sleep_mask) behavior, showing how simple XOR-obfuscated strings can be detected with YARA’s `xor()` modifier, and how newer Beacon versions use a multi-byte XOR key.  
- Because Beacon obfuscation focuses on data/strings while leaving code largely intact, the post proposes signaturing stable code routines (e.g., the deobfuscation routine) for both x86 and x64.  
- It’s primarily useful for Blue Teams/DFIR and detection engineers building high-confidence endpoint detections, and also relevant to red teams for understanding what memory-resident artifacts remain detectable.

Technical Focus:
- In-memory malware detection and process memory scanning
- YARA rule authoring (strings, hex patterns, `xor()` modifier)
- Cobalt Strike Beacon reflective loading and “obfuscate-and-sleep” (sleep_mask)
- Unbacked threads / SleepEx-based hunting for injected code
- Reverse engineering Beacon obfuscation/deobfuscation routines (x86/x64)

Use Cases:
- Hunt for Cobalt Strike Beacon in live endpoints by scanning process memory
- Create low-false-positive YARA signatures resilient to packers/loaders
- Detect Beacon even during sleep/obfuscated states by targeting code routines
- Validate detections across Beacon versions and architectures (32/64-bit)
- Automate enterprise-wide periodic memory scanning (e.g., process enumeration + YARA)

Keywords:
Cobalt Strike, Beacon, memory signatures, in-memory scanning, YARA, xor modifier, reflective DLL injection, sleep_mask, obfuscate-and-sleep, process memory dump, unbacked threads, SleepEx, Process Hacker, IDA Pro, CyberChef, x86, x64, deobfuscation routine, signature-based detection, endpoint hunting