Title:
Ghostly Reflective PE Loader — how to make an existing remote process inject a PE in itself

Type:
Blog Post

Short Summary (4–8 sentences max):
- The post describes a hybrid Windows injection technique that combines “Ghostly Hollowing” (SEC_IMAGE-based mapping into a target) with reflective-style loading to execute an arbitrary PE inside an already-running remote process.  
- It addresses a key limitation of Ghostly Hollowing (best suited for newly created suspended processes and avoiding relocations by patching image base early) by injecting a position-independent Loader DLL first, then having that loader fetch and map the real payload itself.  
- The Loader DLL is designed to be PIC, resolve APIs dynamically (primarily via ntdll/kernel32), avoid globals, and terminate its thread explicitly after transferring execution.  
- The payload (“Target PE”) is staged in a named section backed by the system page file (CreateFileMapping), and the loader reads it via NT APIs (NtOpenSection/NtMapViewOfSection) before performing a custom in-memory PE load and jumping to the entrypoint.  
- The injector handles creating the named section, mapping the loader into the remote process using Ghostly Hollowing, and invoking the loader’s exported function by creating a suspended thread and patching thread context (RCX for the first argument, RIP for start).  
- Useful for red teamers and malware researchers studying stealthier PE loading/injection tradeoffs, and for defenders to understand section-backed payload staging and thread-context based invocation patterns.

Technical Focus:
- Ghostly Hollowing with SEC_IMAGE section mapping
- Position-independent Loader DLL design (dynamic API resolution, no globals)
- Named section / pagefile-backed payload staging (CreateFileMapping, NtOpenSection)
- NT API memory mapping (NtMapViewOfSection, NtUnmapViewOfSection, NtClose)
- Thread creation + context manipulation (CreateRemoteThread, Get/SetThreadContext, RCX/RIP)
- Custom in-memory PE loading (imports, relocations, entrypoint transfer)

Use Cases:
- Injecting an arbitrary PE into an existing remote process while minimizing cross-process reads/writes
- Staging payloads via named sections instead of direct WriteProcessMemory-style transfers
- Researching loader constraints (stdcall vs fastcall, PIC requirements) and execution handoff
- Building/understanding detection logic for section-object abuse and unusual thread-context starts

Keywords:
Ghostly Hollowing, reflective loading, PE loader, remote process injection, SEC_IMAGE, section objects, named section, pagefile-backed section, CreateFileMappingW, MapViewOfFile, MapViewOfFile3, NtOpenSection, NtMapViewOfSection, NtQueryObject, NtUnmapViewOfSection, GetThreadContext, SetThreadContext, CreateRemoteThread, RCX calling convention, RIP patching, ntdll.dll, kernel32.dll