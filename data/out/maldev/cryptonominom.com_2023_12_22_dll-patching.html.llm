Title:
DLL Patching: Hooking Exports in x86_64 DLLs with BDF (Backdoor Factory)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes new functionality in BDF-ng (Backdoor Factory) to hook exported functions in x86_64 Windows DLLs to execute attacker-controlled code while preserving original behavior.  
- It solves the problem of reliably “infecting” DLLs by inserting a loader into the `.text` section and storing the payload in a code cave, then redirecting selected exports to the loader and returning execution to the original export.  
- The author explains why export hooking is preferred over DllMain/PE entrypoint patching (avoids double execution on load/unload) and shows operational options like updating PE checksum and zeroing the certificate table.  
- A toy example demonstrates hooking multiple exports and executing via `rundll32.exe`, and a real-world scenario discusses OneDrive DLL hijacking tradeoffs and limitations with forwarded exports.  
- Useful primarily for red teams and penetration testers doing on-disk tradecraft, payload staging, and EDR testing; also relevant to defenders analyzing DLL tampering and export-hook based persistence/execution.

Technical Focus:
- PE/DLL export table hooking (x86_64)
- Code-cave injection and `.text`-section loader stubs
- Custom IAT creation / import thunk insertion (LoadLibraryA, GetProcAddress, VirtualAlloc, CreateThread)
- Payload staging and single-execution flags
- Handling PE checksum and Authenticode certificate table modifications
- Forwarded export detection/limitations (export forwarding abuse context)

Use Cases:
- Patch specific DLL exports to gain execution when a target application calls them
- Weaponize DLL hijacking opportunities by backdooring candidate DLLs used by an application (e.g., OneDrive pre-vault move)
- Build test samples to evaluate EDR detection of export-hooking and on-disk PE modification
- Create controlled “functionality patches” (e.g., altering return values) while maintaining application stability
- Rapidly prototype DLL-based loaders that avoid DllMain-triggered double execution

Keywords:
BDF, BDF-ng, Backdoor Factory, DLL patching, export hooking, PE format, x86_64, code cave, .text section, IAT, import thunks, LoadLibraryA, GetProcAddress, VirtualAlloc, CreateThread, rundll32.exe, DLL hijacking, OneDrive, forwarded exports, Authenticode, PE checksum