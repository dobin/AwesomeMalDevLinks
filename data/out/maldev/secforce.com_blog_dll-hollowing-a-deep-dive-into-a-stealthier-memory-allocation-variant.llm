Title:
DLL Hollowing: A Deep Dive into a Stealthier Memory Allocation Variant

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes a “DLL Hollowing” variant based on Module Overloading to hide injected payloads inside a legitimate DLL mapping without requiring write access to the DLL on disk.  
- Instead of classic `LoadLibrary`-based hollowing or `NtAllocateVirtualMemory` (Private memory), it uses `NtCreateSection(SEC_IMAGE)` + `NtMapViewOfSection` to create an Image-backed mapping that resembles normal DLL memory.  
- The technique overwrites the mapped DLL contents with shellcode, flips protections with `NtProtectVirtualMemory`, and executes via `NtCreateThreadEx`, aiming to reduce memory-artifact-based detection.  
- It details key IOCs (missing PEB module entry, PE header/section mismatches, protection inconsistencies) and mitigations (write into an RX section like `.text`, add module to PEB lists).  
- For remote injection, it covers selecting a sacrificial DLL not already loaded in the target and explains crashes caused by Control Flow Guard (CFG) in CFG-enabled processes.  
- Multiple CFG workarounds are discussed: disabling CFG via IFEO MitigationOptions, patching `ntdll!LdrpDispatchUserCallTarget`, and bypassing checks by creating a suspended thread and setting RIP via thread context.  
- Useful for red teamers and malware researchers studying stealthier allocation/injection tradeoffs and for defenders building detections around image-mapping anomalies and CFG tampering.

Technical Focus:
- Module Overloading / DLL Hollowing memory allocation (SEC_IMAGE sections)
- NTDLL syscalls: `NtCreateSection`, `NtMapViewOfSection`, `NtProtectVirtualMemory`, `NtWriteVirtualMemory`, `NtCreateThreadEx`
- PEB module list artifacts and in-memory vs on-disk module mismatch detection
- Remote process module enumeration (Toolhelp32 snapshot) and sacrificial DLL selection
- Control Flow Guard (CFG) internals: GFIDS/GuardCFFunctionTable, `LdrpDispatchUserCallTarget`
- CFG bypass techniques (IFEO mitigation, NTDLL patching, thread context/RIP manipulation)

Use Cases:
- Stealthier shellcode allocation that appears as `MEM_IMAGE` rather than `MEM_PRIVATE`
- Process injection PoCs for research on EDR memory-scanning heuristics
- Studying/detecting module overloading via RAM-vs-disk comparisons (Moneta/Moneta-like tooling)
- Testing CFG impact on injection tradecraft and evaluating bypass reliability
- Building detections for NTDLL CFG-check patching and suspicious section/protection mismatches

Keywords:
DLL hollowing, module overloading, Phantom DLL Hollowing, NtCreateSection, NtMapViewOfSection, SEC_IMAGE, NtProtectVirtualMemory, NtWriteVirtualMemory, NtCreateThreadEx, PEB module list, MEM_IMAGE, memory artifacts, Moneta, hollows_hunter, Volatility hollowfind, Control Flow Guard, CFG, GuardCFFunctionTable, gfids, LdrpDispatchUserCallTarget, IFEO MitigationOptions, SetThreadContext, RIP hijack, PsSetLoadImageNotifyRoutine, PsSetCreateThreadNotifyRoutine