# https://github.com/Friends-Security/RedirectThread

[Skip to content](https://github.com/Friends-Security/RedirectThread#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/Friends-Security/RedirectThread) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/Friends-Security/RedirectThread) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/Friends-Security/RedirectThread) to refresh your session.Dismiss alert

{{ message }}

[Friends-Security](https://github.com/Friends-Security)/ **[RedirectThread](https://github.com/Friends-Security/RedirectThread)** Public

- [Notifications](https://github.com/login?return_to=%2FFriends-Security%2FRedirectThread) You must be signed in to change notification settings
- [Fork\\
23](https://github.com/login?return_to=%2FFriends-Security%2FRedirectThread)
- [Star\\
198](https://github.com/login?return_to=%2FFriends-Security%2FRedirectThread)


Playing around with Thread Context Hijacking. Building more evasive primitives to use as alternative for existing process injection techniques


### License

[MIT license](https://github.com/Friends-Security/RedirectThread/blob/master/LICENSE)

[198\\
stars](https://github.com/Friends-Security/RedirectThread/stargazers) [23\\
forks](https://github.com/Friends-Security/RedirectThread/forks) [Branches](https://github.com/Friends-Security/RedirectThread/branches) [Tags](https://github.com/Friends-Security/RedirectThread/tags) [Activity](https://github.com/Friends-Security/RedirectThread/activity)

[Star](https://github.com/login?return_to=%2FFriends-Security%2FRedirectThread)

[Notifications](https://github.com/login?return_to=%2FFriends-Security%2FRedirectThread) You must be signed in to change notification settings

# Friends-Security/RedirectThread

master

[**1** Branch](https://github.com/Friends-Security/RedirectThread/branches) [**0** Tags](https://github.com/Friends-Security/RedirectThread/tags)

[Go to Branches page](https://github.com/Friends-Security/RedirectThread/branches)[Go to Tags page](https://github.com/Friends-Security/RedirectThread/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![Argentix03](https://avatars.githubusercontent.com/u/39255806?v=4&size=40)](https://github.com/Argentix03)[Argentix03](https://github.com/Friends-Security/RedirectThread/commits?author=Argentix03)<br>[Update Arguments.cpp](https://github.com/Friends-Security/RedirectThread/commit/750abd28161ca03873058b6e08930d2e3bbe7485)<br>8 months agoJun 17, 2025<br>[750abd2](https://github.com/Friends-Security/RedirectThread/commit/750abd28161ca03873058b6e08930d2e3bbe7485) · 8 months agoJun 17, 2025<br>## History<br>[5 Commits](https://github.com/Friends-Security/RedirectThread/commits/master/) <br>Open commit details<br>[View commit history for this file.](https://github.com/Friends-Security/RedirectThread/commits/master/) 5 Commits |
| [AlertableThreadsForDays](https://github.com/Friends-Security/RedirectThread/tree/master/AlertableThreadsForDays "AlertableThreadsForDays") | [AlertableThreadsForDays](https://github.com/Friends-Security/RedirectThread/tree/master/AlertableThreadsForDays "AlertableThreadsForDays") | [Initial commit](https://github.com/Friends-Security/RedirectThread/commit/21068a5b775d5715b91b4caf4b10d6794bacc3ea "Initial commit") | 9 months agoMay 16, 2025 |
| [ETWThreadCreationNoise](https://github.com/Friends-Security/RedirectThread/tree/master/ETWThreadCreationNoise "ETWThreadCreationNoise") | [ETWThreadCreationNoise](https://github.com/Friends-Security/RedirectThread/tree/master/ETWThreadCreationNoise "ETWThreadCreationNoise") | [Initial commit](https://github.com/Friends-Security/RedirectThread/commit/21068a5b775d5715b91b4caf4b10d6794bacc3ea "Initial commit") | 9 months agoMay 16, 2025 |
| [RedirectThread](https://github.com/Friends-Security/RedirectThread/tree/master/RedirectThread "RedirectThread") | [RedirectThread](https://github.com/Friends-Security/RedirectThread/tree/master/RedirectThread "RedirectThread") | [Update Arguments.cpp](https://github.com/Friends-Security/RedirectThread/commit/750abd28161ca03873058b6e08930d2e3bbe7485 "Update Arguments.cpp") | 8 months agoJun 17, 2025 |
| [ShellcodeExamples](https://github.com/Friends-Security/RedirectThread/tree/master/ShellcodeExamples "ShellcodeExamples") | [ShellcodeExamples](https://github.com/Friends-Security/RedirectThread/tree/master/ShellcodeExamples "ShellcodeExamples") | [Initial commit](https://github.com/Friends-Security/RedirectThread/commit/21068a5b775d5715b91b4caf4b10d6794bacc3ea "Initial commit") | 9 months agoMay 16, 2025 |
| [.gitattributes](https://github.com/Friends-Security/RedirectThread/blob/master/.gitattributes ".gitattributes") | [.gitattributes](https://github.com/Friends-Security/RedirectThread/blob/master/.gitattributes ".gitattributes") | [Initial commit](https://github.com/Friends-Security/RedirectThread/commit/21068a5b775d5715b91b4caf4b10d6794bacc3ea "Initial commit") | 9 months agoMay 16, 2025 |
| [.gitignore](https://github.com/Friends-Security/RedirectThread/blob/master/.gitignore ".gitignore") | [.gitignore](https://github.com/Friends-Security/RedirectThread/blob/master/.gitignore ".gitignore") | [Initial commit](https://github.com/Friends-Security/RedirectThread/commit/21068a5b775d5715b91b4caf4b10d6794bacc3ea "Initial commit") | 9 months agoMay 16, 2025 |
| [CMakeLists.txt](https://github.com/Friends-Security/RedirectThread/blob/master/CMakeLists.txt "CMakeLists.txt") | [CMakeLists.txt](https://github.com/Friends-Security/RedirectThread/blob/master/CMakeLists.txt "CMakeLists.txt") | [Initial commit](https://github.com/Friends-Security/RedirectThread/commit/21068a5b775d5715b91b4caf4b10d6794bacc3ea "Initial commit") | 9 months agoMay 16, 2025 |
| [LICENSE](https://github.com/Friends-Security/RedirectThread/blob/master/LICENSE "LICENSE") | [LICENSE](https://github.com/Friends-Security/RedirectThread/blob/master/LICENSE "LICENSE") | [Initial commit](https://github.com/Friends-Security/RedirectThread/commit/21068a5b775d5715b91b4caf4b10d6794bacc3ea "Initial commit") | 9 months agoMay 16, 2025 |
| [README.md](https://github.com/Friends-Security/RedirectThread/blob/master/README.md "README.md") | [README.md](https://github.com/Friends-Security/RedirectThread/blob/master/README.md "README.md") | [Update README.md](https://github.com/Friends-Security/RedirectThread/commit/e1c5ab77e996a8def078efc0cedbe67bb7f639f7 "Update README.md") | 9 months agoMay 16, 2025 |
| [RedirectThread.sln](https://github.com/Friends-Security/RedirectThread/blob/master/RedirectThread.sln "RedirectThread.sln") | [RedirectThread.sln](https://github.com/Friends-Security/RedirectThread/blob/master/RedirectThread.sln "RedirectThread.sln") | [Initial commit](https://github.com/Friends-Security/RedirectThread/commit/21068a5b775d5715b91b4caf4b10d6794bacc3ea "Initial commit") | 9 months agoMay 16, 2025 |
| View all files |

## Repository files navigation

# RedirectThread

[Permalink: RedirectThread](https://github.com/Friends-Security/RedirectThread#redirectthread)

This tool explores various techniques for remote code execution and thread manipulation on Windows, originating from the `CONTEXT` struct.

For a detailed explanation of the research and techniques, please refer to our blog post: **[New Process Injection Class: The CONTEXT-Only Attack Surface](https://blog.fndsec.net/2025/05/16/the-context-only-attack-surface/)**

## TL;DR

[Permalink: TL;DR](https://github.com/Friends-Security/RedirectThread#tldr)

Most process injection techniques follow a familiar pattern:
allocate → write → execute.

In this research, we ask: what if we skip allocation and writing entirely?

By focusing on execution-only primitives, we found distinct approaches to inject code without allocating / writing memory:

- Inject a DLL using only `LoadLibraryA`.
- Call arbitrary WinAPI functions with parameters using `SetThreadContext`, without suspending a thread.
- Utilize only `NtCreateThread` to remotely allocate, write and execute shellcode.
- Expand the technique to APC functions such as `QueueUserAPC`.

This isn’t classic thread hijacking — we don’t necessarily suspend/resume a thread mid-execution to overwrite it.

## Projects Included

[Permalink: Projects Included](https://github.com/Friends-Security/RedirectThread#projects-included)

This solution contains the following main projects:

- **`RedirectThread`**: A tool demonstrating various remote thread injection techniques utilizing the `CONTEXT` struct while avoiding allocating / writing memory remotely (and some ROP gadgets).
- **`AlertableThreadsForDays`**: A utility for creating alertable threads, for testing with APC-based injection methods.

## Usage

[Permalink: Usage](https://github.com/Friends-Security/RedirectThread#usage)

```
Usage: C:\RedirectThread.exe [options]

Required Options:
  --pid <pid>                 Target process ID to inject into
  --inject-dll                Perform DLL injection (hardcoded to "0.dll")
  --inject-shellcode <file>   Perform shellcode injection from file
  --inject-shellcode-bytes <hex>  Perform shellcode injection from hex string (e.g. 9090c3)

Delivery Method Options:
  --method <method>           Specify code execution method
     CreateRemoteThread       Default, creates a remote thread
     NtCreateThread           Uses NtCreateThread (less traceable)
     QueueUserAPC             Uses QueueUserAPC (requires --tid)
     QueueUserAPC2            Uses QueueUserAPC2 (requires --tid)
     NtQueueApcThread         Uses NtQueueApcThread (requires --tid)
     NtQueueApcThreadEx       Uses NtQueueApcThreadEx (requires --tid)
     NtQueueApcThreadEx2      Uses NtQueueApcThreadEx2 (requires --tid)

Context Method Options:
  --context-method <method>   Specify context manipulation method
     rop-gadget               Default, uses ROP gadget technique
     two-step                 Uses a two-step thread hijacking approach

Additional Options:
  --tid <tid>                 Target thread ID (required for APC methods)
  --alloc-size <size>         Memory allocation size in bytes (default: 4096)
  --alloc-perm <hex>          Memory protection flags in hex (default: 0x40)
  --alloc-address <hex>       Specify base address for allocation (hex, optional)
  --use-suspend               Use thread suspension for increased reliability
  --verbose                   Enable verbose output
  --enter-debug               Pause execution at key points for debugger attachment

Example:
  C:\RedirectThread.exe --pid 1234 --inject-dll mydll.dll
  C:\RedirectThread.exe --pid 1234 --inject-shellcode payload.bin --verbose
  C:\RedirectThread.exe --pid 1234 --inject-shellcode payload.bin --method NtCreateThread
  C:\RedirectThread.exe --pid 1234 --inject-shellcode-bytes 9090c3 --method QueueUserAPC --tid 5678
  C:\RedirectThread.exe --pid 1234 --inject-shellcode-bytes $bytes --context-method two-step --method NtQueueUserApcThreadEx2 --tid 5678
```

## Building the Project

[Permalink: Building the Project](https://github.com/Friends-Security/RedirectThread#building-the-project)

You can build this project using either CMake or Visual Studio directly with the provided solution file (`RedirectThread.sln`).

### Option 1: Using CMake

[Permalink: Option 1: Using CMake](https://github.com/Friends-Security/RedirectThread#option-1-using-cmake)

This project can be built using CMake. You can either use CMake from the command line (if CMake is installed and in your system's PATH) or leverage the CMake Tools extension if you are using Visual Studio Code.

#### Prerequisites

[Permalink: Prerequisites](https://github.com/Friends-Security/RedirectThread#prerequisites)

- A C++ compiler that supports C++17 (e.g., MSVC, GCC, Clang).
- CMake (version 3.10 or higher).

#### Build Steps

[Permalink: Build Steps](https://github.com/Friends-Security/RedirectThread#build-steps)

The following steps describe building with CMake from the command line. If you are using the CMake Tools extension in VSCode, you can often perform the configuration and build steps through the extension's UI instead of running these commands manually.

1. **Clone the repository:**



```
git clone <repository-url>
cd RedirectThread
```

2. **Create a build directory and navigate into it:**



```
mkdir build
cd build
```

3. **Configure the project with CMake:**
   - For Visual Studio (example for Visual Studio 2019, 64-bit):



     ```
     cmake .. -G "Visual Studio 16 2019" -A x64
     ```

   - For Makefiles (example):



     ```
     cmake ..
     ```

   - For other generators, please refer to CMake documentation.
4. **Build the project:**


   - For Visual Studio:



     ```
     cmake --build . --config Release
     ```

   - For Makefiles:



     ```
     make
     ```


Executables will typically be located in a subdirectory within your build folder (e.g., `build/Release` or `build/RedirectThread/Release`).

### Option 2: Using Visual Studio Solution File

[Permalink: Option 2: Using Visual Studio Solution File](https://github.com/Friends-Security/RedirectThread#option-2-using-visual-studio-solution-file)

1. Open `RedirectThread.sln` in Visual Studio.

2. Select the desired build configuration (e.g., Release, x64).

3. Build the solution (Build > Build Solution).

Executables will be located in the respective project output directories (e.g., `x64/Release`).


## About

Playing around with Thread Context Hijacking. Building more evasive primitives to use as alternative for existing process injection techniques


### Resources

[Readme](https://github.com/Friends-Security/RedirectThread#readme-ov-file)

### License

[MIT license](https://github.com/Friends-Security/RedirectThread#MIT-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/Friends-Security/RedirectThread).

[Activity](https://github.com/Friends-Security/RedirectThread/activity)

[Custom properties](https://github.com/Friends-Security/RedirectThread/custom-properties)

### Stars

[**198**\\
stars](https://github.com/Friends-Security/RedirectThread/stargazers)

### Watchers

[**1**\\
watching](https://github.com/Friends-Security/RedirectThread/watchers)

### Forks

[**23**\\
forks](https://github.com/Friends-Security/RedirectThread/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FFriends-Security%2FRedirectThread&report=Friends-Security+%28user%29)

## [Releases](https://github.com/Friends-Security/RedirectThread/releases)

No releases published

## [Packages\  0](https://github.com/orgs/Friends-Security/packages?repo_name=RedirectThread)

No packages published

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/Friends-Security/RedirectThread).

## [Contributors\  3](https://github.com/Friends-Security/RedirectThread/graphs/contributors)

- [![@yudasm](https://avatars.githubusercontent.com/u/88127398?s=64&v=4)](https://github.com/yudasm)[**yudasm** Yehuda Smirnov](https://github.com/yudasm)
- [![@Argentix03](https://avatars.githubusercontent.com/u/39255806?s=64&v=4)](https://github.com/Argentix03)[**Argentix03** Hoshea](https://github.com/Argentix03)
- [![@LuxNoBulIshit](https://avatars.githubusercontent.com/u/51244609?s=64&v=4)](https://github.com/LuxNoBulIshit)[**LuxNoBulIshit** Hai Vaknin](https://github.com/LuxNoBulIshit)

## Languages

- [C++93.1%](https://github.com/Friends-Security/RedirectThread/search?l=c%2B%2B)
- [C4.7%](https://github.com/Friends-Security/RedirectThread/search?l=c)
- [PowerShell1.6%](https://github.com/Friends-Security/RedirectThread/search?l=powershell)
- [CMake0.6%](https://github.com/Friends-Security/RedirectThread/search?l=cmake)

You can’t perform that action at this time.