Title:
Proxy DLL Loads

Type:
GitHub Tool

Short Summary (4–8 sentences max):
- This repository provides proof-of-concept code for “DLL-load proxying” on Windows to make module loads appear to originate from alternative call paths, commonly to evade ETW-TI stack-based visibility and callstack-based detections.  
- It demonstrates two main approaches: using a Vectored Exception Handler (VEH) to redirect execution into `LoadLibraryA`, and using undocumented NTDLL threadpool (`Tp*`) APIs to execute `LoadLibrary` via callback stubs (reducing exposure to userland API hooks).  
- The README walks through “hunting” undocumented `Tp*` exports by reversing `kernel32.dll` implementations and mapping them to underlying `ntdll!Tp*` routines, with Process Hacker headers as a reference.  
- A third PoC variant adds a “call gadget” from a legitimate DLL (`AuthenticateFAM_SecureFP.dll`) to insert arbitrary frames into the call stack during module load, targeting bypass of Elastic’s callstack signature rule for callback-based library loads.  
- It includes debugging guidance (register setup for callback stubs) and OPSEC notes (custom `GetModuleHandleA`/`GetProcAddress`, avoid `VirtualProtect` as a VEH trigger).  
- Useful for red teams, malware developers, and defenders researching detection gaps around callback-based execution and callstack spoofing.

Technical Focus:
- DLL-load proxying / callstack manipulation during `LoadLibrary*`
- Vectored Exception Handling (VEH) with `PAGE_GUARD` / `STATUS_GUARD_PAGE_VIOLATION`
- Undocumented NTDLL threadpool APIs (`TpAlloc*`, `TpSet*`, cleanup groups, timers/waits)
- Callback stub construction and register/context manipulation (RIP/RCX)
- Call-gadget insertion to break callstack-based detection signatures
- Reversing Windows DLL exports (kernel32 → ntdll) with IDA/x64dbg

Use Cases:
- Proxying DLL loads to reduce ETW-TI stack-trace fidelity during module load events
- Executing `LoadLibraryA` via threadpool callbacks using lower-level/undocumented APIs
- Testing and bypassing callstack-based detection rules (e.g., Elastic callback-load rule)
- Researching/replicating undocumented `Tp*` interfaces for custom loaders
- Building defensive detections for anomalous threadpool callback-based module loads

Keywords:
Windows, DLL load proxying, LoadLibraryA, VEH, Vectored Exception Handler, PAGE_GUARD, STATUS_GUARD_PAGE_VIOLATION, VirtualProtect, ntdll, kernel32, undocumented syscalls, threadpool, TpAllocPool, TpAllocTimer, TpAllocWait, TpSetTimer, TpReleaseCleanupGroupMembers, callback function, call stack spoofing, call gadget, ETW-TI, Elastic detection rule, IDA, x64dbg