Title:
Proxying Your Way to Code Execution – A Different Take on DLL Hijacking

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes “DLL proxying” as an alternative to classic DLL hijacking/side-loading, focusing on scenarios where attackers can write into the directory containing a legitimate DLL and replace it with a proxy DLL that forwards exports to the original to avoid breaking functionality.  
- It explains how to discover proxyable DLLs by monitoring “Load Image” events with Sysinternals Process Monitor and checking ACL misconfigurations in non-protected paths (notably user-writable AppData).  
- The author demonstrates real-world targets in Microsoft Teams/Outlook add-in paths (e.g., TeamsMeetingAddin) where low-privilege users can rename legitimate DLLs and drop a malicious proxy DLL for execution inside Outlook.  
- It covers weaponization details: using .def files to forward exports and avoiding DllMain deadlocks by spawning a thread and delaying execution.  
- The post then expands to a COM/registry-based DLL load redirection technique: abusing HKCU\Software\Classes\CLSID lookups (queried before HKLM) to force applications (including new WindowsApps-packaged Outlook/Teams and others) to load attacker-controlled DLLs.  
- It introduces FaceDancer, a tool to automate generating proxy DLLs and the required HKCU registry entries, and notes Microsoft acknowledged findings but declined immediate fixes, making detection the primary mitigation.

Technical Focus:
- DLL proxying via export forwarding (.def files) and in-folder replacement
- Windows DLL load behavior (“Load Image”) and Procmon-based hunting
- ACL/permission misconfigurations in user-writable directories (AppData)
- DllMain execution constraints, deadlock avoidance, delayed thread execution
- COM activation / CLSID resolution order (HKCU vs HKLM) for DLL path hijack
- Automation tooling (FaceDancer) for proxy DLL + registry key generation

Use Cases:
- Achieve stealthy code execution inside trusted processes (e.g., Outlook, Teams, Edge) without breaking app functionality
- Bypass application allowlisting by executing payloads via legitimate signed binaries loading attacker DLLs
- Identify enterprise software with unsafe DLL load patterns or writable install/add-in directories
- Red-team tradecraft for low-privilege persistence or execution in user context
- Blue-team detection engineering: monitor suspicious HKCU\Software\Classes\CLSID writes and anomalous DLL loads from user paths

Keywords:
DLL hijacking, DLL proxying, export forwarding, .def file, DllMain, CreateThread, sleep delay, Sysinternals Process Monitor, Load Image, ACL misconfiguration, AppData, Microsoft TeamsMeetingAddin, Outlook.exe, OneAuth.dll, ffmpeg.dll, SlimCV.dll, COM, CLSID, HKCU\Software\Classes\CLSID, RegOpenKey Name Not Found, WindowsApps, msedge.exe, Cobalt Strike, FaceDancer