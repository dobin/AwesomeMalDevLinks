# https://github.com/joaoviictorti/hypnus

[Skip to content](https://github.com/joaoviictorti/hypnus#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/joaoviictorti/hypnus) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/joaoviictorti/hypnus) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/joaoviictorti/hypnus) to refresh your session.Dismiss alert

{{ message }}

[joaoviictorti](https://github.com/joaoviictorti)/ **[hypnus](https://github.com/joaoviictorti/hypnus)** Public

- [Notifications](https://github.com/login?return_to=%2Fjoaoviictorti%2Fhypnus) You must be signed in to change notification settings
- [Fork\\
30](https://github.com/login?return_to=%2Fjoaoviictorti%2Fhypnus)
- [Star\\
277](https://github.com/login?return_to=%2Fjoaoviictorti%2Fhypnus)


Sleep Obfuscation in Rust


[crates.io/crates/hypnus](https://crates.io/crates/hypnus "https://crates.io/crates/hypnus")

### License

Apache-2.0, MIT licenses found


### Licenses found

[Apache-2.0\\
\\
LICENSE-APACHE](https://github.com/joaoviictorti/hypnus/blob/main/LICENSE-APACHE) [MIT\\
\\
LICENSE-MIT](https://github.com/joaoviictorti/hypnus/blob/main/LICENSE-MIT)

[277\\
stars](https://github.com/joaoviictorti/hypnus/stargazers) [30\\
forks](https://github.com/joaoviictorti/hypnus/forks) [Branches](https://github.com/joaoviictorti/hypnus/branches) [Tags](https://github.com/joaoviictorti/hypnus/tags) [Activity](https://github.com/joaoviictorti/hypnus/activity)

[Star](https://github.com/login?return_to=%2Fjoaoviictorti%2Fhypnus)

[Notifications](https://github.com/login?return_to=%2Fjoaoviictorti%2Fhypnus) You must be signed in to change notification settings

# joaoviictorti/hypnus

main

[**1** Branch](https://github.com/joaoviictorti/hypnus/branches) [**0** Tags](https://github.com/joaoviictorti/hypnus/tags)

[Go to Branches page](https://github.com/joaoviictorti/hypnus/branches)[Go to Tags page](https://github.com/joaoviictorti/hypnus/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![joaoviictorti](https://avatars.githubusercontent.com/u/85838827?v=4&size=40)](https://github.com/joaoviictorti)[joaoviictorti](https://github.com/joaoviictorti/hypnus/commits?author=joaoviictorti)<br>[chore: release v0.2.0](https://github.com/joaoviictorti/hypnus/commit/97901fae94aebb62c95576ef7bfc6f57500fa281)<br>success<br>3 months agoNov 30, 2025<br>[97901fa](https://github.com/joaoviictorti/hypnus/commit/97901fae94aebb62c95576ef7bfc6f57500fa281) · 3 months agoNov 30, 2025<br>## History<br>[37 Commits](https://github.com/joaoviictorti/hypnus/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/joaoviictorti/hypnus/commits/main/) 37 Commits |
| [.github/workflows](https://github.com/joaoviictorti/hypnus/tree/main/.github/workflows "This path skips through empty directories") | [.github/workflows](https://github.com/joaoviictorti/hypnus/tree/main/.github/workflows "This path skips through empty directories") | [ci: remove examples job from CI](https://github.com/joaoviictorti/hypnus/commit/73c45c0135aad23b6389d896c1b7cd19ae328a08 "ci: remove examples job from CI") | 3 months agoNov 30, 2025 |
| [.vscode](https://github.com/joaoviictorti/hypnus/tree/main/.vscode ".vscode") | [.vscode](https://github.com/joaoviictorti/hypnus/tree/main/.vscode ".vscode") | [Initial commit](https://github.com/joaoviictorti/hypnus/commit/181b04ac8de2e0d4d4ace8296ee71c23b0ae183a "Initial commit") | 8 months agoJun 26, 2025 |
| [src](https://github.com/joaoviictorti/hypnus/tree/main/src "src") | [src](https://github.com/joaoviictorti/hypnus/tree/main/src "src") | [chore: release v0.2.0](https://github.com/joaoviictorti/hypnus/commit/97901fae94aebb62c95576ef7bfc6f57500fa281 "chore: release v0.2.0") | 3 months agoNov 30, 2025 |
| [.gitattributes](https://github.com/joaoviictorti/hypnus/blob/main/.gitattributes ".gitattributes") | [.gitattributes](https://github.com/joaoviictorti/hypnus/blob/main/.gitattributes ".gitattributes") | [Initial commit](https://github.com/joaoviictorti/hypnus/commit/181b04ac8de2e0d4d4ace8296ee71c23b0ae183a "Initial commit") | 8 months agoJun 26, 2025 |
| [.gitignore](https://github.com/joaoviictorti/hypnus/blob/main/.gitignore ".gitignore") | [.gitignore](https://github.com/joaoviictorti/hypnus/blob/main/.gitignore ".gitignore") | [Initial commit](https://github.com/joaoviictorti/hypnus/commit/181b04ac8de2e0d4d4ace8296ee71c23b0ae183a "Initial commit") | 8 months agoJun 26, 2025 |
| [Cargo.toml](https://github.com/joaoviictorti/hypnus/blob/main/Cargo.toml "Cargo.toml") | [Cargo.toml](https://github.com/joaoviictorti/hypnus/blob/main/Cargo.toml "Cargo.toml") | [chore: release v0.2.0](https://github.com/joaoviictorti/hypnus/commit/97901fae94aebb62c95576ef7bfc6f57500fa281 "chore: release v0.2.0") | 3 months agoNov 30, 2025 |
| [Justfile](https://github.com/joaoviictorti/hypnus/blob/main/Justfile "Justfile") | [Justfile](https://github.com/joaoviictorti/hypnus/blob/main/Justfile "Justfile") | [Update Justfile](https://github.com/joaoviictorti/hypnus/commit/d4176355abc050eb515e41d8bca3fc5e2980ad8f "Update Justfile") | 3 months agoNov 30, 2025 |
| [LICENSE-APACHE](https://github.com/joaoviictorti/hypnus/blob/main/LICENSE-APACHE "LICENSE-APACHE") | [LICENSE-APACHE](https://github.com/joaoviictorti/hypnus/blob/main/LICENSE-APACHE "LICENSE-APACHE") | [Add license](https://github.com/joaoviictorti/hypnus/commit/0be6c319933c7360d4441027ac05c32de220f5b1 "Add license") | 3 months agoNov 30, 2025 |
| [LICENSE-MIT](https://github.com/joaoviictorti/hypnus/blob/main/LICENSE-MIT "LICENSE-MIT") | [LICENSE-MIT](https://github.com/joaoviictorti/hypnus/blob/main/LICENSE-MIT "LICENSE-MIT") | [Add license](https://github.com/joaoviictorti/hypnus/commit/0be6c319933c7360d4441027ac05c32de220f5b1 "Add license") | 3 months agoNov 30, 2025 |
| [README.md](https://github.com/joaoviictorti/hypnus/blob/main/README.md "README.md") | [README.md](https://github.com/joaoviictorti/hypnus/blob/main/README.md "README.md") | [Update README.md](https://github.com/joaoviictorti/hypnus/commit/1058e5c322e8db01d3184a45d44ac89ede1e5b39 "Update README.md") | 3 months agoNov 30, 2025 |
| [clippy.toml](https://github.com/joaoviictorti/hypnus/blob/main/clippy.toml "clippy.toml") | [clippy.toml](https://github.com/joaoviictorti/hypnus/blob/main/clippy.toml "clippy.toml") | [Add clippy.toml](https://github.com/joaoviictorti/hypnus/commit/3fd24f8a14b840d768426de14ea7dc260e869424 "Add clippy.toml") | 4 months agoOct 27, 2025 |
| [rust-toolchain.toml](https://github.com/joaoviictorti/hypnus/blob/main/rust-toolchain.toml "rust-toolchain.toml") | [rust-toolchain.toml](https://github.com/joaoviictorti/hypnus/blob/main/rust-toolchain.toml "rust-toolchain.toml") | [Initial commit](https://github.com/joaoviictorti/hypnus/commit/181b04ac8de2e0d4d4ace8296ee71c23b0ae183a "Initial commit") | 8 months agoJun 26, 2025 |
| [rustfmt.toml](https://github.com/joaoviictorti/hypnus/blob/main/rustfmt.toml "rustfmt.toml") | [rustfmt.toml](https://github.com/joaoviictorti/hypnus/blob/main/rustfmt.toml "rustfmt.toml") | [Initial commit](https://github.com/joaoviictorti/hypnus/commit/181b04ac8de2e0d4d4ace8296ee71c23b0ae183a "Initial commit") | 8 months agoJun 26, 2025 |
| [taplo.toml](https://github.com/joaoviictorti/hypnus/blob/main/taplo.toml "taplo.toml") | [taplo.toml](https://github.com/joaoviictorti/hypnus/blob/main/taplo.toml "taplo.toml") | [Initial commit](https://github.com/joaoviictorti/hypnus/commit/181b04ac8de2e0d4d4ace8296ee71c23b0ae183a "Initial commit") | 8 months agoJun 26, 2025 |
| View all files |

## Repository files navigation

# hypnus

[Permalink: hypnus](https://github.com/joaoviictorti/hypnus#hypnus)

[![Rust](https://camo.githubusercontent.com/eb4a5ef008cf7982a0c4bcbb0885e71ca97fa82e4650ea57af9fd4a4d559d05e/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6d616465253230776974682d527573742d726564)](https://camo.githubusercontent.com/eb4a5ef008cf7982a0c4bcbb0885e71ca97fa82e4650ea57af9fd4a4d559d05e/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6d616465253230776974682d527573742d726564)[![crate](https://camo.githubusercontent.com/ec10fa8556f419222e5d999a4ed88eb13dfc26aa8f7a9fb9815aa96875648793/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f6879706e75732e737667)](https://camo.githubusercontent.com/ec10fa8556f419222e5d999a4ed88eb13dfc26aa8f7a9fb9815aa96875648793/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f6879706e75732e737667)[![docs](https://camo.githubusercontent.com/52121a7f4fe8a7b7a4db37006e3431f032b1c9a5b09beb1c8b6ab42022bd7e33/68747470733a2f2f646f63732e72732f6879706e75732f62616467652e737667)](https://camo.githubusercontent.com/52121a7f4fe8a7b7a4db37006e3431f032b1c9a5b09beb1c8b6ab42022bd7e33/68747470733a2f2f646f63732e72732f6879706e75732f62616467652e737667)[![License](https://camo.githubusercontent.com/6518dd7d312b0cf50fec34f8519595e0516ab8d42008be31327b5a558e7f71b7/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542532464170616368652d2d322e302d627269676874677265656e)](https://camo.githubusercontent.com/6518dd7d312b0cf50fec34f8519595e0516ab8d42008be31327b5a558e7f71b7/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542532464170616368652d2d322e302d627269676874677265656e)[![Actions status](https://github.com/joaoviictorti/hypnus/actions/workflows/ci.yml/badge.svg)](https://github.com/joaoviictorti/hypnus/actions)

Library for execution obfuscation, designed to protect memory regions during inactivity or sleep cycles. It leverages thread pool timers, wait objects and APC, all with dynamic call stack spoofing and optional heap obfuscation. Execution remains stealthy, and no thread duplication is required. It builds upon the dynamic spoofing foundation of the [uwd](https://github.com/joaoviictorti/uwd) library.

## Features

[Permalink: Features](https://github.com/joaoviictorti/hypnus#features)

- ✅ Supports `#[no_std]` environments (with `alloc`).
- ✅ Call Stack Spoofing during both API execution and sleep.
- ✅ Optional Heap Obfuscation (requires `HypnusHeap` allocator).
- ✅ Automatically registers spoofed call targets in Control Flow Guard (CFG), if enabled in the process.
- ✅ The library supports three advanced sleep obfuscation techniques: it leverages ThreadPool Timers via `TpSetTimer`, ThreadPool Waits via `TpSetWait`, and APC via `NtQueueApcThread`.

## Getting started

[Permalink: Getting started](https://github.com/joaoviictorti/hypnus#getting-started)

Add `hypnus` to your project by updating your `Cargo.toml`:

```
cargo add hypnus
```

## Observation

[Permalink: Observation](https://github.com/joaoviictorti/hypnus#observation)

If you're encrypting only specific memory regions (e.g., heap, custom buffers), using the `Rust standard library (std)` is safe. However, when encrypting the entire PE image of the current process, it's strongly recommended to use `#[no_std]`. This is not a limitation of the library, but rather a constraint imposed by Rust itself, `std` may internally access thread-local storage or perform operations that lead to access violations when the full process memory is obfuscated.

## Usage

[Permalink: Usage](https://github.com/joaoviictorti/hypnus#usage)

To use `hypnus`, simply import the crate and call one of the obfuscation macros: `timer!`, `wait!`, or `foliage!`. These macros apply memory encryption and call stack spoofing both during the sleep window and throughout the chained API calls used to encrypt and decrypt memory, ensuring full execution flow concealment.

### Sleep Obfuscation via TpSetTimer

[Permalink: Sleep Obfuscation via TpSetTimer](https://github.com/joaoviictorti/hypnus#sleep-obfuscation-via-tpsettimer)

This technique is a variant of the Sleep Obfuscation method used in [Ekko](https://github.com/cracked5pider/ekko/), but it's a more evasive version that leverages the `TpSetTimer` thread pool API directly for invocation, combined with call stack spoofing.

```
use hypnus::timer;
use core::ffi::c_void;

// Pointer to the memory region you want to obfuscate (e.g., shellcode)
let ptr = 0x13370000 as *mut c_void;
let size = 512;

// Sleep duration in seconds
let delay = 5;

// Sleep using ThreadPool Timer
timer!(ptr, size, delay);
```

### Sleep Obfuscation via TpSetWait

[Permalink: Sleep Obfuscation via TpSetWait](https://github.com/joaoviictorti/hypnus#sleep-obfuscation-via-tpsetwait)

This technique is a variant of the Sleep Obfuscation method used in `Zilean`, but it's a more evasive version that leverages the `TpSetWait` thread pool API directly for invocation, combined with call stack spoofing.

```
use hypnus::wait;
use core::ffi::c_void;

// Pointer to the memory region you want to obfuscate (e.g., shellcode)
let ptr = 0x13370000 as *mut c_void;
let size = 512;

// Sleep duration in seconds
let delay = 5;

// Sleep using ThreadPool Wait
wait!(ptr, size, delay);
```

### Sleep Obfuscation via APC

[Permalink: Sleep Obfuscation via APC](https://github.com/joaoviictorti/hypnus#sleep-obfuscation-via-apc)

This technique is based on the [Foliage](https://github.com/realoriginal/foliage) method, which utilizes Asynchronous Procedure Calls (APCs) to execute spoofed callbacks on a suspended thread with call stack spoofing.

```
use hypnus::foliage;
use core::ffi::c_void;

// Pointer to the memory region you want to obfuscate (e.g., shellcode)
let ptr = 0x13370000 as *mut c_void;
let size = 512;

// Sleep duration in seconds
let delay = 5;

// Sleep using APC
foliage!(ptr, size, delay);
```

### Heap Obfuscation & RWX

[Permalink: Heap Obfuscation & RWX](https://github.com/joaoviictorti/hypnus#heap-obfuscation--rwx)

If you want to enable heap encryption or RWX protection, you must explicitly pass the appropriate flags via `ObfMode`. In addition, enabling heap obfuscation requires using the custom allocator provided by the library: `HypnusHeap`.

```
#![no_std]
#![no_main]

extern crate alloc;

use hypnus::{foliage, ObfMode, allocator::HypnusHeap};
use core::ffi::c_void;

#[unsafe(no_mangle)]
fn main() -> u8 {
    // Pointer to the memory region you want to obfuscate (e.g., shellcode)
    let data = b"\x90\x90\x90\xCC";
    let ptr = data.as_ptr() as *mut c_void;
    let size = data.len() as u64;

    // Sleep duration in seconds
    let delay = 5;

    // Full obfuscation with heap encryption and RWX memory protection
    foliage!(ptr, size, delay, ObfMode::Heap | ObfMode::Rwx);

    0
}

#[global_allocator]
static ALLOCATOR: HypnusHeap = HypnusHeap;

#[cfg(not(test))]
#[panic_handler]
fn panic(_info: &core::panic::PanicInfo) -> ! {
    loop { }
}
```

## References

[Permalink: References](https://github.com/joaoviictorti/hypnus#references)

I want to express my gratitude to these projects that inspired me to create `hypnus` and contribute with some features:

- [Ekko](https://github.com/Cracked5pider/Ekko)
- [Foliage](https://github.com/realoriginal/foliage)

## License

[Permalink: License](https://github.com/joaoviictorti/hypnus#license)

hypnus is licensed under either of

- Apache License, Version 2.0, ( [LICENSE-APACHE](https://github.com/joaoviictorti/hypnus/tree/main/LICENSE-APACHE) or
[https://www.apache.org/licenses/LICENSE-2.0](https://www.apache.org/licenses/LICENSE-2.0))
- MIT license ( [LICENSE-MIT](https://github.com/joaoviictorti/hypnus/tree/main/LICENSE-MIT) or [https://opensource.org/licenses/MIT](https://opensource.org/licenses/MIT))

at your option.

Unless you explicitly state otherwise, any contribution intentionally submitted for inclusion in hypnus
by you, as defined in the Apache-2.0 license, shall be dually licensed as above, without any
additional terms or conditions.

## About

Sleep Obfuscation in Rust


[crates.io/crates/hypnus](https://crates.io/crates/hypnus "https://crates.io/crates/hypnus")

### Topics

[windows](https://github.com/topics/windows "Topic: windows") [rust](https://github.com/topics/rust "Topic: rust") [obfuscation](https://github.com/topics/obfuscation "Topic: obfuscation") [offensive-security](https://github.com/topics/offensive-security "Topic: offensive-security")

### Resources

[Readme](https://github.com/joaoviictorti/hypnus#readme-ov-file)

### License

Apache-2.0, MIT licenses found


### Licenses found

[Apache-2.0\\
\\
LICENSE-APACHE](https://github.com/joaoviictorti/hypnus/blob/main/LICENSE-APACHE) [MIT\\
\\
LICENSE-MIT](https://github.com/joaoviictorti/hypnus/blob/main/LICENSE-MIT)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/joaoviictorti/hypnus).

[Activity](https://github.com/joaoviictorti/hypnus/activity)

### Stars

[**277**\\
stars](https://github.com/joaoviictorti/hypnus/stargazers)

### Watchers

[**1**\\
watching](https://github.com/joaoviictorti/hypnus/watchers)

### Forks

[**30**\\
forks](https://github.com/joaoviictorti/hypnus/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fjoaoviictorti%2Fhypnus&report=joaoviictorti+%28user%29)

## [Releases](https://github.com/joaoviictorti/hypnus/releases)

No releases published

## [Packages\  0](https://github.com/users/joaoviictorti/packages?repo_name=hypnus)

No packages published

## Languages

- [Rust99.6%](https://github.com/joaoviictorti/hypnus/search?l=rust)
- [Just0.4%](https://github.com/joaoviictorti/hypnus/search?l=just)

You can’t perform that action at this time.