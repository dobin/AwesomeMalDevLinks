# https://www.netspi.com/blog/technical-blog/adversary-simulation/adaptive-dll-hijacking/

<!DOCTYPE html><html lang="en-US" class="scroll-smooth scroll-pt-20 js">
<body class="wp-singular post-template-default single single-post postid-20149 single-format-standard wp-custom-logo wp-theme-netspi overflow-x-hidden disableFixed">
<!-- Google Tag Manager (noscript) -->

<!-- End Google Tag Manager (noscript) -->


<div id="searchModal" class="flex items-center justify-center searchModalStyle">
  <div id="closeModal" class="absolute p-2 text-gray-600 right-5 closeModalTrigger hover:text-gray-800 focus:outline-none">
    <svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </div>
  <div class="container px-3 mx-auto">
    <div class="mx-auto lg:w-2/4">
      <form action="https://www.netspi.com/" method="GET">
        <input type="text" name="s" placeholder="Search..." class="w-full py-4 border-b border-gray-300 focus:outline-none sm:py-5 sm:text-xl">
      </form>
    </div>    
  </div>
</div>
<div class="fixed inset-0 bg-black opacity-0 searchBackDrop pointer-none"></div>
  
  <div id="mobile-menu" class="fixed top-0 left-0 w-full pt-[4rem] h-full bg-[#E9ECEF] z-20 flex flex-col overflow-x-hidden overflow-y-scroll transition-transform duration-500 a11ydrops">
    <ul class="flex flex-col items-center px-5 font-medium main-menu md:flex-row md:space-x-10 lg:px-0">
              <li class="relative block w-full border-b-2 border-solid border-platinum py-[1.5rem]">
        <div class="container">
        <a class="flex text-[1.5rem] font-semibold parent" href="https://www.netspi.com/blog/technical-blog/adversary-simulation/adaptive-dll-hijacking/#">Solutions</a>
                      <button class="a11ydrops-btn " aria-expanded="false"><span class="sr-only">Toggle Menu</span></button><div class="relative w-full sub-menu bg-[#E9ECEF] a11ydrops-drop" aria-hidden="true">
              <div class="flex flex-col pt-5">
                                        <div class="vr">
                            <ul class="flex flex-col gap-4 pb-5">
                                                          <li>
                                <a class="inline-flex items-center justify-between w-full gap-2 font-medium whitespace-nowrap hover-mnu" href="https://www.netspi.com/the-netspi-platform/">
                                The NetSPI Platform                                                                  <svg width="11" height="10" viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M10.1667 4.16667L11 5L6 10L5.16667 9.16667L10.1667 4.16667Z" fill="#07142A"></path> <path d="M5.16667 0.833333L6 -2.18557e-07L11 5L10.1665 5.83333L5.16667 0.833333Z" fill="#07142A"></path> <path d="M10 4.5L10 5.5L-2.40413e-07 5.5L-1.96701e-07 4.5L10 4.5Z" fill="#07142A"></path> </svg>
                                                                </a>
                              </li>
                                                                                                                              <li>
                                    <a data-leftmn="0" class="inline-flex items-center justify-between w-full gap-2 active pl-5 font-medium whitespace-nowrap hover-mnu" href="https://www.netspi.com/blog/technical-blog/adversary-simulation/adaptive-dll-hijacking/#">
                                      Penetration Testing                                      <svg class="-mr-[3px]" fill="#07142A" width="15" height="15" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg"> <path d="M96,220a12,12,0,0,1-8.48535-20.48535L159.0293,128,87.51465,56.48535a12.0001,12.0001,0,0,1,16.9707-16.9707l80,80a12.00062,12.00062,0,0,1,0,16.9707l-80,80A11.96287,11.96287,0,0,1,96,220Z"></path> </svg>
                                    </a>
                                                                                                                                                                                                                            <div class="flex flex-col flex-1 w-full py-3 pl-12">
                                                  <div class="leftmn active leftmn-0">
                                                                                                          <a href="https://www.netspi.com/netspi-ptaas/" class="group">
                                                        <p class="leading-[16px] font-medium undrl inline-block">Penetration Testing as a Service ( PTaaS )</p>
                                                        <span class="block mt-2 text-xs font-normal">Shift projects to programs with human-delivered, contextualized pentesting services</span>
                                                      </a>
                                                      <hr class="my-3 border-platinum">
                                                                                                                                                              <div class="grid lg:grid-cols-2 gap-x-8 gap-y-5">
                                                                                                                                                                            <a href="https://www.netspi.com/netspi-ptaas/application-penetration-testing/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Application Pentesting</p>
                                                            <span class="block mt-2 text-xs font-normal">Web, API, Mobile, Thick, and Virtual Applications</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/ai-ml-penetration-testing/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">AI/ML Pentesting</p>
                                                            <span class="block mt-2 text-xs font-normal">Enhance your AI / ML security with expert LLM testing and jailbreaking</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/cloud-penetration-testing/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Cloud Pentesting</p>
                                                            <span class="block mt-2 text-xs font-normal">Secure AWS, Azure, and Google Cloud infrastructures</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/network-penetration-testing/mainframe/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Mainframe Pentesting</p>
                                                            <span class="block mt-2 text-xs font-normal">z/OS Mainframe Testing - CICS / IMS Region and Application
</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/network-penetration-testing/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Network Pentesting</p>
                                                            <span class="block mt-2 text-xs font-normal">Internal, External, Wireless, Host-based, and Virtual Desktop Networks</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/hardware-systems/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Hardware Systems</p>
                                                            <span class="block mt-2 text-xs font-normal">Automotive, Medical device, IoT, ATM, and Operational Technology</span>
                                                          </a>  
                                                                                                                                                                        </div>
                                                                                                      </div>
                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                  </li>
                                                                                                                                <li>
                                    <a data-leftmn="1" class="inline-flex items-center justify-between w-full gap-2  pl-5 font-medium whitespace-nowrap hover-mnu" href="https://netspi.com/security-assessments/">
                                      Security Assessments                                      <svg class="-mr-[3px]" fill="#07142A" width="15" height="15" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg"> <path d="M96,220a12,12,0,0,1-8.48535-20.48535L159.0293,128,87.51465,56.48535a12.0001,12.0001,0,0,1,16.9707-16.9707l80,80a12.00062,12.00062,0,0,1,0,16.9707l-80,80A11.96287,11.96287,0,0,1,96,220Z"></path> </svg>
                                    </a>
                                                                                                                                                                                                                                                                                                                      <div class="flex flex-col flex-1 w-full py-3 pl-12">
                                                  <div class="leftmn  leftmn-1">
                                                                                                          <a href="https://netspi.com/security-assessments/" class="group">
                                                        <p class="leading-[16px] font-medium undrl inline-block">Security Assessments &amp; Advisory</p>
                                                        <span class="block mt-2 text-xs font-normal">Comprehensive security assessments and strategic advisory services that are tailored to meet your organization's unique needs.</span>
                                                      </a>
                                                      <hr class="my-3 border-platinum">
                                                                                                                                                              <div class="grid lg:grid-cols-2 gap-x-8 gap-y-5">
                                                                                                                                                                            <a href="https://www.netspi.com/netspi-ptaas/red-team-operations/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Red Team Operations</p>
                                                            <span class="block mt-2 text-xs font-normal">Simulate attacks to assess detection, response, and recovery capabilities</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/social-engineering/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Social Engineering</p>
                                                            <span class="block mt-2 text-xs font-normal">Conduct email, phone, or physical security social engineering tests</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/security-assessments/detective-controls-testing/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Detective Controls Testing</p>
                                                            <span class="block mt-2 text-xs font-normal">Validate security detection controls with focused attack simulations</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/secure-code-review/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Secure Code Review</p>
                                                            <span class="block mt-2 text-xs font-normal">Find vulnerabilities in your source code with SAST tools and expert review</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/cybersecurity-maturity-assessment/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Cybersecurity Maturity</p>
                                                            <span class="block mt-2 text-xs font-normal">Define prioritized steps to advance your security program</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/netspi-ptaas/threat-modeling/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Threat Modeling</p>
                                                            <span class="block mt-2 text-xs font-normal">Identify critical threats to your organization with our holistic program</span>
                                                          </a>  
                                                                                                                                                                        </div>
                                                                                                      </div>
                                                </div>
                                                                                                                                                                                                                                                                                                        </li>
                                                                                                                                <li>
                                    <a data-leftmn="2" class="inline-flex items-center justify-between w-full gap-2  pl-5 font-medium whitespace-nowrap hover-mnu" href="https://www.netspi.com/blog/technical-blog/adversary-simulation/adaptive-dll-hijacking/#">
                                      Additional Solutions                                      <svg class="-mr-[3px]" fill="#07142A" width="15" height="15" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg"> <path d="M96,220a12,12,0,0,1-8.48535-20.48535L159.0293,128,87.51465,56.48535a12.0001,12.0001,0,0,1,16.9707-16.9707l80,80a12.00062,12.00062,0,0,1,0,16.9707l-80,80A11.96287,11.96287,0,0,1,96,220Z"></path> </svg>
                                    </a>
                                                                                                                                                                                                                                                                                                                                                                                                                <div class="flex flex-col flex-1 w-full py-3 pl-12">
                                                  <div class="leftmn  leftmn-2">
                                                                                                          <a href="https://www.netspi.com/attack-surface-visibility/" class="group">
                                                        <p class="leading-[16px] font-medium undrl inline-block">Attack Surface Visibility</p>
                                                        <span class="block mt-2 text-xs font-normal">Secure your modern attack surface with 360-degree visibility from NetSPI </span>
                                                      </a>
                                                      <hr class="my-3 border-platinum">
                                                                                                                                                              <div class="grid lg:grid-cols-2 gap-x-8 gap-y-5">
                                                                                                                                                                            <a href="https://www.netspi.com/attack-surface-visibility/dark-web-monitoring/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Dark Web Monitoring</p>
                                                            <span class="block mt-2 text-xs font-normal">Detect potential threats before they escalate into security breaches.</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/attack-surface-visibility/domain-monitoring/" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Domain Monitoring</p>
                                                            <span class="block mt-2 text-xs font-normal">Identify fraudulent look-alike domains, generate takedown reports, and more. </span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/attack-surface-visibility/#integrations" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Seamless Integrations</p>
                                                            <span class="block mt-2 text-xs font-normal">Integrations across Asset Managers, IAM , Vulnerabilities, and more.</span>
                                                          </a>  
                                                                                                                                                                                                                                      <a href="https://www.netspi.com/attack-surface-visibility/#cloud" class="group">
                                                            <p class="leading-[16px] font-medium undrl inline-block">Cloud Security Scans</p>
                                                            <span class="block mt-2 text-xs font-normal">( AWS &amp; Azure ) Cloud scans for misconfigurations, insecure settings.</span>
                                                          </a>  
                                                                                                                                                                        </div>
                                                                                                      </div>
                                                </div>
                                                                                                                                                                                                              </li>
                                                                                                                                                    </ul>
                          </div>
                                                                                        </div>
            </div>
                  </div>
        </li>
              <li class="relative block w-full border-b-2 border-solid border-platinum py-[1.5rem]">
        <div class="container">
        <a class="flex text-[1.5rem] font-semibold parent" href="https://www.netspi.com/blog/technical-blog/adversary-simulation/adaptive-dll-hijacking/#">Resources</a>
                      <button class="a11ydrops-btn " aria-expanded="false"><span class="sr-only">Toggle Menu</span></button><div class="relative w-full sub-menu bg-[#E9ECEF] a11ydrops-drop" aria-hidden="true">
              <div class="flex flex-col pt-5">
                                                                    <ul class="flex flex-col">
                                                  <li class="">
                            <a href="https://www.netspi.com/resources/" class="block my-3 text-xl leading-5">
                              All Resources                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/events-and-webinars/" class="block my-3 text-xl leading-5">
                              Events &amp; Webinars                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/podcast/" class="block my-3 text-xl leading-5">
                              Podcasts                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/netspi-labs/" class="block my-3 text-xl leading-5">
                              NetSPI Labs                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/open-source-tools/" class="block my-3 text-xl leading-5">
                              Open-Source Tools                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/ctem/" class="block my-3 text-xl leading-5">
                              CTEM Enablement                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/resources/solution-briefs/" class="block my-3 text-xl leading-5">
                              Solution Briefs                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/resources/data-sheets/" class="block my-3 text-xl leading-5">
                              Data Sheets                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/resources/ebooks-and-whitepapers/" class="block my-3 text-xl leading-5">
                              Whitepapers                            </a>
                          </li>
                                              </ul>
                                                </div>
            </div>
                  </div>
        </li>
              <li class="relative block w-full border-b-2 border-solid border-platinum py-[1.5rem]">
        <div class="container">
        <a class="flex text-[1.5rem] font-semibold parent" href="https://www.netspi.com/blog/technical-blog/adversary-simulation/adaptive-dll-hijacking/#">Blog</a>
                      <button class="a11ydrops-btn " aria-expanded="false"><span class="sr-only">Toggle Menu</span></button><div class="relative w-full sub-menu bg-[#E9ECEF] a11ydrops-drop" aria-hidden="true">
              <div class="flex flex-col pt-5">
                                                                    <ul class="flex flex-col">
                                                  <li class="">
                            <a href="https://www.netspi.com/blog/" class="block my-3 text-xl leading-5">
                              All Blogs                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/blog/technical-blog/" class="block my-3 text-xl leading-5">
                              Hack Responsibly                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/blog/executive-blog/" class="block my-3 text-xl leading-5">
                              Executive Blog                            </a>
                          </li>
                                              </ul>
                                                </div>
            </div>
                  </div>
        </li>
              <li class="relative block w-full border-b-2 border-solid border-platinum py-[1.5rem]">
        <div class="container">
        <a class="flex text-[1.5rem] font-semibold parent" href="https://www.netspi.com/blog/technical-blog/adversary-simulation/adaptive-dll-hijacking/#">Customers</a>
                      <button class="a11ydrops-btn " aria-expanded="false"><span class="sr-only">Toggle Menu</span></button><div class="relative w-full sub-menu bg-[#E9ECEF] a11ydrops-drop" aria-hidden="true">
              <div class="flex flex-col pt-5">
                                                                    <ul class="flex flex-col">
                                                  <li class="">
                            <a href="https://www.netspi.com/customer-stories/" class="block my-3 text-xl leading-5">
                              Customer Success Stories                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/customer-reviews/" class="block my-3 text-xl leading-5">
                              Customer Reviews                            </a>
                          </li>
                                              </ul>
                                                </div>
            </div>
                  </div>
        </li>
              <li class="relative block w-full border-b-2 border-solid border-platinum py-[1.5rem]">
        <div class="container">
        <a class="flex text-[1.5rem] font-semibold parent" href="https://www.netspi.com/blog/technical-blog/adversary-simulation/adaptive-dll-hijacking/#">Company</a>
                      <button class="a11ydrops-btn " aria-expanded="false"><span class="sr-only">Toggle Menu</span></button><div class="relative w-full sub-menu bg-[#E9ECEF] a11ydrops-drop" aria-hidden="true">
              <div class="flex flex-col pt-5">
                                                                    <ul class="flex flex-col">
                                                  <li class="">
                            <a href="https://www.netspi.com/about-us/" class="block my-3 text-xl leading-5">
                              About Us                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/meet-our-agents/" class="block my-3 text-xl leading-5">
                              Meet The NetSPI Agents                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/trust/" class="block my-3 text-xl leading-5">
                              Security and Compliance                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/about-us/#executive" class="block my-3 text-xl leading-5">
                              Leadership                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/careers/" class="block my-3 text-xl leading-5">
                              Careers                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/newsroom/" class="block my-3 text-xl leading-5">
                              Newsroom                            </a>
                          </li>
                                                  <li class="md:hidden">
                            <a href="https://www.netspi.com/partner/" class="block my-3 text-xl leading-5">
                              Partner with NetSPI                            </a>
                          </li>
                                                  <li class="">
                            <a href="https://www.netspi.com/contact/" class="block my-3 text-xl leading-5">
                              Contact Us                            </a>
                          </li>
                                              </ul>
                                                </div>
            </div>
                  </div>
        </li>
          </ul>
        <div class="container mt-12">
      <div class="px-5">
        <a href="https://www.netspi.com/contact/" class="w-full text-center button text-[22px] leading-[22px] mb-8">Contact Us</a>
      </div>
    </div>
      </div>

<main id="primary" class="site-main -mt-[68px] lg:-mt-[66px]" role="main">



<div class="prose text-charcoal main-content technical-blog">
  <div class="container ">
    <div class="py-8 bg-moreOffWhite main">
      
<p>DLL hijacking has been a centerpiece of our operations for many years. During that time we’ve explored the deep caveats which make this technique difficult to actually use in the real world. Our implementations have expanded to include export table cloning, dynamic IAT patching, stack walking, and run time table reconstruction. We explore the details of these techniques extensively in our&nbsp;Dark Side Ops&nbsp;courses and we’d like to share some of that knowledge here.<br><br><strong>If you’ve ever “understood” DLL hijacking, only to return to your lab and fail to get it working properly, this post is for you.</strong></p>



<p><strong>TLDR?&nbsp;</strong>Check out&nbsp;<a href="https://github.com/monoxgas/Koppeling" target="_blank" rel="noreferrer noopener">Koppeling</a>. You really should read it though&nbsp;</p>



<h3 class="wp-block-heading" id="h-refresher">Refresher</h3>



<p>This post won’t cover the basics of DLL hijacking. We expect you are familiar with module search order, KnownDLLs, “safe search”, etc. If you need a refresher, here are some links:</p>



<ul class="wp-block-list">
<li><a href="https://resources.infosecinstitute.com/dll-hijacking-attacks-revisited/" target="_blank" rel="noreferrer noopener">https://resources.infosecinstitute.com/dll-hijacking-attacks-revisited/</a></li>



<li><a href="https://pentestlab.blog/2017/03/27/dll-hijacking/" target="_blank" rel="noreferrer noopener">https://pentestlab.blog/2017/03/27/dll-hijacking/</a></li>



<li><a href="https://liberty-shell.com/sec/2019/03/12/dll-hijacking/" target="_blank" rel="noreferrer noopener">https://liberty-shell.com/sec/2019/03/12/dll-hijacking/</a></li>



<li><a href="https://astr0baby.wordpress.com/2018/09/08/understanding-how-dll-hijacking-works/" target="_blank" rel="noreferrer noopener">https://astr0baby.wordpress.com/2018/09/08/understanding-how-dll-hijacking-works/</a></li>



<li><a href="https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1493862085.pdf" target="_blank" rel="noreferrer noopener">https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1493862085.pdf</a></li>



<li><a href="https://posts.specterops.io/lateral-movement-scm-and-dll-hijacking-primer-d2f61e8ab992" target="_blank" rel="noreferrer noopener">https://posts.specterops.io/lateral-movement-scm-and-dll-hijacking-primer-d2f61e8ab992</a></li>
</ul>



<p>In addition, some tooling designed to discover/exploit hijacks:</p>



<ul class="wp-block-list">
<li><a href="https://github.com/cys3c/Siofra" target="_blank" rel="noreferrer noopener">https://github.com/cys3c/Siofra</a>&nbsp;[<a href="https://github.com/Cybereason/siofra" target="_blank" rel="noreferrer noopener">https://github.com/Cybereason/siofra</a>]</li>



<li><a href="https://github.com/cyberark/DLLSpy" target="_blank" rel="noreferrer noopener">https://github.com/cyberark/DLLSpy</a></li>



<li><a href="https://github.com/MojtabaTajik/Robber" target="_blank" rel="noreferrer noopener">https://github.com/MojtabaTajik/Robber</a></li>
</ul>



<p>When you first learned about DLL hijacking, you were likely shown a fairly primitive example which is trivial to exploit. Something like this:</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-cpp enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-k5">void</span><span class="enlighter-text"> </span><span class="enlighter-m0">BeUnsafe</span><span class="enlighter-g1">()</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    HMODULE module = </span><span class="enlighter-m0">LoadLibrary</span><span class="enlighter-g1">(</span><span class="enlighter-s0">"functions.dll"</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c0">// ...</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">void BeUnsafe() {
    HMODULE module = LoadLibrary("functions.dll");
    // ...
}</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="cpp" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">void BeUnsafe() {
	HMODULE module = LoadLibrary("functions.dll");
	// ...
}</pre>



<p>Here, we simply need to get some evil code into the correct location as “functions.dll”.&nbsp;<strong>LoadLibrary&nbsp;</strong>will ultimately trigger the execution of our DllMain function, where we might write something like this:</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-cpp enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">BOOL WINAPI </span><span class="enlighter-m0">DllMain</span><span class="enlighter-g1">(</span><span class="enlighter-text">HINSTANCE instance, DWORD reason, LPVOID reserved</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text">reason != DLL_PROCESS_ATTACH</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c0">// Do evil stuff</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">system</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-s0">"start calc.exe"</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved)
{
    if (reason != DLL_PROCESS_ATTACH)
        return TRUE;

    // Do evil stuff
    system ("start calc.exe");

    return TRUE;
}</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="cpp" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved)
{
	if (reason != DLL_PROCESS_ATTACH)
		return TRUE;

	// Do evil stuff
	system ("start calc.exe");

	return TRUE;
}</pre>



<p>There are a few critical reasons exploitation is so trivial here. We’ll go through them here and then look at each one in more detail throughout the post.</p>



<ol class="wp-block-list">
<li><strong>We don’t maintain the stability of the source process.</strong>&nbsp;In most instances, it will exit, crash, or otherwise misbehave as a result of our hijack. After all, it’s likely loading this DLL for a reason.</li>



<li><strong>We don’t maintain code execution in the source process.</strong>&nbsp;As an extension of 1, we are simply executing calc externally. We don’t care if the process stays up, or even what happens after we “pop our shell”.</li>



<li><strong>We don’t care about loader lock.&nbsp;</strong>Because our entry point is so simple, we don’t have to worry about executing complex code inside DllMain while the loader lock is held (which can be dangerous).</li>



<li><strong>We don’t have to worry about export names.&nbsp;</strong>Because this hijack occurs as a result of&nbsp;<strong>LoadLibrary</strong>, our malicious DLL doesn’t need to include any specific export names or ordinals.</li>
</ol>



<p>If you’ve ever attempted to hijack in the real world, and something broke/failed, it was likely because of one (or many) of the 4 points above. Our time spent hijacking has yielded many tools and snippets which we’ll share throughout the post, so let’s get smarter.</p>



<h3 class="wp-block-heading" id="h-execution-sinks">Execution Sinks</h3>



<p>There are two primary “sinks” from which DLL execution can originate. The names aren’t important, but we need consistent terminology to stay on the same page. Both of these sinks are provided by the module loader (LDR) within&nbsp;<strong>ntdll.dll</strong>. If an actor is interested in gaining execution as part of a DLL load, they require a call to&nbsp;<strong>ntdll!LdrpCallInitRoutine</strong>, triggering execution of&nbsp;<strong>evil!DllMain</strong>.</p>



<h4 class="wp-block-heading" id="h-static-sink-iat">Static Sink (IAT)</h4>



<p>The most obvious cause for DLL initialization is the result of its inclusion in a dependency graph. Specifically,&nbsp;<strong>it’s membership of a required module’s import address table (IAT)</strong>. This will most likely occur during process initialization (<strong>ntdll!LdrpInitializeProcess</strong>), but can also occur as a result of dynamic loading.</p>



<p>Here, the subsystem is simply calculating all required dependencies for a particular load event, and sequentially initializing them. However, before passing execution to the new module,&nbsp;<strong>it’s export table will be examined to ensure it provides the expected functionality</strong>. This is done by comparing the EAT of the child module and patching those addresses into the IAT of the parent module. A typical call stack looks something like this:</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-raw enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">ntdll!LdrInitializeThunk &lt;- New process starts</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitialize</span></div></div><div class=""><div><span class="enlighter-text">ntdll!_LdrpInitialize</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitializeProcess</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitializeGraphRecurse &lt;- Dependency graph is built</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitializeNode</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpCallInitRoutine</span></div></div><div class=""><div><span class="enlighter-text">evil!DllMain &lt;- Execution is passed to external code</span></div></div></div><div class="enlighter-raw">ntdll!LdrInitializeThunk &lt;- New process starts
ntdll!LdrpInitialize
ntdll!_LdrpInitialize
ntdll!LdrpInitializeProcess
ntdll!LdrpInitializeGraphRecurse &lt;- Dependency graph is built
ntdll!LdrpInitializeNode
ntdll!LdrpCallInitRoutine
evil!DllMain &lt;- Execution is passed to external code</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ntdll!LdrInitializeThunk &lt;- New process starts
ntdll!LdrpInitialize
ntdll!_LdrpInitialize
ntdll!LdrpInitializeProcess
ntdll!LdrpInitializeGraphRecurse &lt;- Dependency graph is built
ntdll!LdrpInitializeNode
ntdll!LdrpCallInitRoutine
evil!DllMain &lt;- Execution is passed to external code</pre>



<h4 class="wp-block-heading" id="h-dynamic-sink-loadlibrary">Dynamic Sink (LoadLibrary)</h4>



<p>In a similar, but distinctly different process, active code is requesting a new module be initialized without specifying required functions. As a result, ntdll!LdrLoadDll will happily&nbsp;<strong>ignore the export table of the target module</strong>. This will likely be followed by&nbsp;<strong>GetProcAddress&nbsp;</strong>in an attempt to identify a particular function for run time use, but not always.</p>



<p>The dependency graph will be calculated with the requested module at its root and load events will occur as described above. This call stack looks something like this:</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-raw enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">KernelBase!LoadLibraryExW &lt;- Dynamic module load is requested</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrLoadDll</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpLoadDll</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpLoadDllInternal</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpPrepareModuleForExecution</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitializeGraphRecurse &lt;- Dependency graph is built</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitializeNode</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpCallInitRoutine</span></div></div><div class=""><div><span class="enlighter-text">evil!DllMain &lt;- Execution is passed to external code</span></div></div></div><div class="enlighter-raw">KernelBase!LoadLibraryExW &lt;- Dynamic module load is requested
ntdll!LdrLoadDll
ntdll!LdrpLoadDll
ntdll!LdrpLoadDllInternal
ntdll!LdrpPrepareModuleForExecution
ntdll!LdrpInitializeGraphRecurse &lt;- Dependency graph is built
ntdll!LdrpInitializeNode
ntdll!LdrpCallInitRoutine
evil!DllMain &lt;- Execution is passed to external code</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">KernelBase!LoadLibraryExW &lt;- Dynamic module load is requested
ntdll!LdrLoadDll
ntdll!LdrpLoadDll
ntdll!LdrpLoadDllInternal
ntdll!LdrpPrepareModuleForExecution
ntdll!LdrpInitializeGraphRecurse &lt;- Dependency graph is built
ntdll!LdrpInitializeNode
ntdll!LdrpCallInitRoutine
evil!DllMain &lt;- Execution is passed to external code</pre>



<h5 class="wp-block-heading" id="h-takeaway">Takeaway</h5>



<p><strong>Hijacks are more complicated to implement when part of a static sink.&nbsp;</strong>We need to ensure our export table supplies the required import names of our parent module&nbsp;<strong>before we have control over execution</strong>. In addition, by the time we have control of execution the addresses in our EAT will have already been patched into the parent module. This complicates any solution which would just rebuild the export table at run time.</p>



<h3 class="wp-block-heading" id="h-function-proxying">Function Proxying</h3>



<p>Maintaining stability in our source process demands that we proxy functionality to the real DLL (if there is one). This essentially means, through one means or another, linking our export table to the export table of the real DLL. Game hackers have been using this for a long time, but like hikers and hunters, the knowledge was slow to propagate to network security spheres. Here are some references links that tackle proxying through different methods:</p>



<ul class="wp-block-list">
<li><a href="https://itm4n.github.io/dll-proxying/" target="_blank" rel="noreferrer noopener">https://itm4n.github.io/dll-proxying/</a></li>



<li><a href="https://dl.packetstormsecurity.net/papers/win/intercept_apis_dll_redirection.pdf" target="_blank" rel="noreferrer noopener">https://dl.packetstormsecurity.net/papers/win/intercept_apis_dll_redirection.pdf</a></li>



<li><a href="https://www.shysecurity.com/post/20130111-Dll%20Proxy" target="_blank" rel="noreferrer noopener">https://www.shysecurity.com/post/20130111-Dll%20Proxy</a></li>



<li><a href="https://kevinalmansa.github.io/application%20security/DLL-Proxying/" target="_blank" rel="noreferrer noopener">https://kevinalmansa.github.io/application%20security/DLL-Proxying/</a></li>



<li><a href="https://googleprojectzero.blogspot.com/2018/04/windows-exploitation-tricks-exploiting.html" target="_blank" rel="noreferrer noopener">https://googleprojectzero.blogspot.com/2018/04/windows-exploitation-tricks-exploiting.html</a></li>



<li><a href="https://www.synack.com/blog/dll-hijacking-in-2014/" target="_blank" rel="noreferrer noopener">https://www.synack.com/blog/dll-hijacking-in-2014/</a></li>
</ul>



<p>And here are some projects that implement these methods:</p>



<ul class="wp-block-list">
<li><a href="https://github.com/kevinalmansa/DLL_Wrapper" target="_blank" rel="noreferrer noopener">https://github.com/kevinalmansa/DLL_Wrapper</a></li>



<li><a href="https://github.com/maluramichael/dll-proxy-generator" target="_blank" rel="noreferrer noopener">https://github.com/maluramichael/dll-proxy-generator</a></li>



<li><a href="https://github.com/oranke/proxy-dll-generator" target="_blank" rel="noreferrer noopener">https://github.com/oranke/proxy-dll-generator</a></li>



<li><a href="https://github.com/mcryptzzz/ProxyDllGenerator" target="_blank" rel="noreferrer noopener">https://github.com/mcryptzzz/ProxyDllGenerator</a></li>



<li><a href="https://github.com/advancedmonitoring/ProxyDll" target="_blank" rel="noreferrer noopener">https://github.com/advancedmonitoring/ProxyDll</a></li>



<li><a href="https://www.codeproject.com/Articles/1179147/ProxiFy-Automatic-Proxy-DLL-Generation" target="_blank" rel="noreferrer noopener">https://www.codeproject.com/Articles/1179147/ProxiFy-Automatic-Proxy-DLL-Generation</a></li>



<li><a href="https://www.codeproject.com/Articles/16541/Create-your-Proxy-DLLs-automatically" target="_blank" rel="noreferrer noopener">https://www.codeproject.com/Articles/16541/Create-your-Proxy-DLLs-automatically</a></li>
</ul>



<p>These techniques all accomplish the same outcome through slightly different means. Let’s take a quick look at some strategies for better understanding.</p>



<h4 class="wp-block-heading" id="h-export-forwarding">Export Forwarding</h4>



<p>PE files provide a simple mechanism for redirecting exports to another module. We can take advantage of this and simply point our names at the same export from the real DLL. You can either rename the real file or just use the full path. Most do this using linker directives like so:</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-cpp enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-k4">#pragma comment(linker,"/export:ReadThing=real.ReadThing")</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k4">#pragma comment(linker,"/export:WriteThing=real.WriteThing")</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k4">#pragma comment(linker,"/export:DeleteThing=real.#3")</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k4">#pragma comment(linker,"/export:DoThing=C:Windowsreal.DoThing")</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-c0">// ...</span></div></div></div><div class="enlighter-raw">#pragma comment(linker,"/export:ReadThing=real.ReadThing")
#pragma comment(linker,"/export:WriteThing=real.WriteThing")
#pragma comment(linker,"/export:DeleteThing=real.#3")
#pragma comment(linker,"/export:DoThing=C:Windowsreal.DoThing")
// ...</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="cpp" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">#pragma comment(linker,"/export:ReadThing=real.ReadThing")
#pragma comment(linker,"/export:WriteThing=real.WriteThing")
#pragma comment(linker,"/export:DeleteThing=real.#3")
#pragma comment(linker,"/export:DoThing=C:Windowsreal.DoThing")
// ...</pre>



<p>Very easy, and we offload the work to the loader subsystem. It might look a bit obvious that we are attempting a hijack (e.g. every export is forwarded), but the advantage lies in its simplicity. One downside is the requirement to modify source code and/or build processes to prepare a DLL for hijacking, we’ll solve this later.</p>



<p><em>The traditional format for the module name was *without* the “.dll” extension when defining a forward. Nowadays this doesn’t matter as the LDR subsystem has learned to ignore it. However, older systems like Windows 7 / Server 2008 will still fail if an extension is included. They also might crash when error reporting is attempted due to LdrUnloadDll being called too early.</em></p>



<h4 class="wp-block-heading" id="h-stack-patching">Stack Patching</h4>



<p>An equally elegant, but more dynamic approach is to walk the stack backward from DllMain and replace the return value for the LoadLibrary call above us with a different module handle. As a result, any future calls to lookup functions will simply bypass us completely. It should be no surprise to the reader at this point, but&nbsp;<strong>this technique will only work for dynamic sinks.</strong>&nbsp;With static sinks, the LDR subsystem has already validated our export table and patched IATs with its values, nor does it care what we have to say about module handles.</p>



<p>Preempt mentions this in&nbsp;<a href="https://www.preempt.com/blog/improving-hacking-techniques-used-by-the-cia-dll-proxy-made-easy/" target="_blank" rel="noreferrer noopener">a post about Vault 7 techniques</a>, but they don’t go into much detail. Luckily we’re crazy enough to try this stuff, so we’ve written a small PoC which should demo the trick nicely for anyone who wants to run with it.</p>



<p><a href="https://gist.github.com/monoxgas/b8a87bec4c4b51d8ac671c7ff245c812" target="_blank" rel="noreferrer noopener">https://gist.github.com/monoxgas/b8a87bec4c4b51d8ac671c7ff245c812</a></p>



<h4 class="wp-block-heading" id="h-run-time-linking">Run Time Linking</h4>



<p>Here we create a hollow list of function pointers, and compile our export table to reference them. The names will be there, but the functions themselves won’t go anywhere useful. When we gain control in DllMain, we load the real DLL dynamically and remap all of the function pointers at run time. This is essentially re-implementing export forwarding…. but with more code. We still have the same disadvantage of modifying source and/or build processes.</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-generic enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">EXPORTS</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">ReadThing=ReadThing_wrapper @</span><span class="enlighter-n1">1</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">WriteThing=WriteThing_wrapper @</span><span class="enlighter-n1">2</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">DeleteThing=DeleteThing_wrapper @</span><span class="enlighter-n1">3</span></div></div></div><div class="enlighter-raw">EXPORTS

ReadThing=ReadThing_wrapper @1
WriteThing=WriteThing_wrapper @2
DeleteThing=DeleteThing_wrapper @3</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">EXPORTS

ReadThing=ReadThing_wrapper @1
WriteThing=WriteThing_wrapper @2
DeleteThing=DeleteThing_wrapper @3</pre>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-assembly enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">.code</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">extern</span><span class="enlighter-text"> ProcList</span><span class="enlighter-k0">:</span><span class="enlighter-k0">QWORD</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">ReadThing_wrapper</span><span class="enlighter-text"> proc</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">jmp</span><span class="enlighter-text"> ProcList[</span><span class="enlighter-n1">0</span><span class="enlighter-text">*</span><span class="enlighter-n1">8</span><span class="enlighter-text">]</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">ReadThing_wrapper</span><span class="enlighter-text"> endp</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">WriteThing_wrapper</span><span class="enlighter-text"> proc</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">jmp</span><span class="enlighter-text"> ProcList[</span><span class="enlighter-n1">1</span><span class="enlighter-text">*</span><span class="enlighter-n1">8</span><span class="enlighter-text">]</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">WriteThing_wrapper</span><span class="enlighter-text"> endp</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">DeleteThing_wrapper</span><span class="enlighter-text"> proc</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">jmp</span><span class="enlighter-text"> ProcList[</span><span class="enlighter-n1">2</span><span class="enlighter-text">*</span><span class="enlighter-n1">8</span><span class="enlighter-text">]</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">DeleteThing_wrapper</span><span class="enlighter-text"> endp</span></div></div></div><div class="enlighter-raw">.code
extern ProcList:QWORD
ReadThing_wrapper proc
    jmp ProcList[0*8]
ReadThing_wrapper endp
WriteThing_wrapper proc
    jmp ProcList[1*8]
WriteThing_wrapper endp
DeleteThing_wrapper proc
    jmp ProcList[2*8]
DeleteThing_wrapper endp</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="asm" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">.code
extern ProcList:QWORD
ReadThing_wrapper proc
	jmp ProcList[0*8]
ReadThing_wrapper endp
WriteThing_wrapper proc
	jmp ProcList[1*8]
WriteThing_wrapper endp
DeleteThing_wrapper proc
	jmp ProcList[2*8]
DeleteThing_wrapper endp</pre>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-cpp enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-k0">extern</span><span class="enlighter-text"> </span><span class="enlighter-s0">"C"</span><span class="enlighter-text"> UINT_PTR ProcList</span><span class="enlighter-g1">[</span><span class="enlighter-text">3</span><span class="enlighter-g1">]</span><span class="enlighter-text"> = </span><span class="enlighter-g1">{</span><span class="enlighter-text">0</span><span class="enlighter-g1">}</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">extern</span><span class="enlighter-text"> </span><span class="enlighter-s0">"C"</span><span class="enlighter-text"> </span><span class="enlighter-k5">void</span><span class="enlighter-text"> </span><span class="enlighter-m0">ReadThing_wrapper</span><span class="enlighter-g1">()</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">extern</span><span class="enlighter-text"> </span><span class="enlighter-s0">"C"</span><span class="enlighter-text"> </span><span class="enlighter-k5">void</span><span class="enlighter-text"> </span><span class="enlighter-m0">WriteThing_wrapper</span><span class="enlighter-g1">()</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k0">extern</span><span class="enlighter-text"> </span><span class="enlighter-s0">"C"</span><span class="enlighter-text"> </span><span class="enlighter-k5">void</span><span class="enlighter-text"> </span><span class="enlighter-m0">DeleteThing_wrapper</span><span class="enlighter-g1">()</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">LPCSTR ImportNames</span><span class="enlighter-g1">[]</span><span class="enlighter-text"> = </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">   </span><span class="enlighter-s0">"ReadThing"</span><span class="enlighter-text">,</span></div></div><div class=""><div><span class="enlighter-text">   </span><span class="enlighter-s0">"WriteThing"</span><span class="enlighter-text">,</span></div></div><div class=""><div><span class="enlighter-text">   </span><span class="enlighter-s0">"DeleteThing"</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">BOOL WINAPI </span><span class="enlighter-m0">DllMain</span><span class="enlighter-g1">(</span><span class="enlighter-text">HINSTANCE instance, DWORD reason, LPVOID reserved</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text">reason != DLL_PROCESS_ATTACH</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    HANDLE real_dll = </span><span class="enlighter-m0">LoadLibrary</span><span class="enlighter-g1">(</span><span class="enlighter-text"> </span><span class="enlighter-s0">"real.dll"</span><span class="enlighter-text"> </span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">for</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text"> </span><span class="enlighter-k5">int</span><span class="enlighter-text"> i = 0; i </span><span class="enlighter-g1">&lt;</span><span class="enlighter-text"> 3; i++ </span><span class="enlighter-g1">)</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        ProcList</span><span class="enlighter-g1">[</span><span class="enlighter-text">i</span><span class="enlighter-g1">]</span><span class="enlighter-text"> = </span><span class="enlighter-m0">GetProcAddress</span><span class="enlighter-g1">(</span><span class="enlighter-text">real_dll , ImportNames</span><span class="enlighter-g1">[</span><span class="enlighter-text">i</span><span class="enlighter-g1">])</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-g1">}</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">extern "C" UINT_PTR ProcList[3] = {0};

extern "C" void ReadThing_wrapper();
extern "C" void WriteThing_wrapper();
extern "C" void DeleteThing_wrapper();

LPCSTR ImportNames[] = {
   "ReadThing",
   "WriteThing",
   "DeleteThing"
}

BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved)
{
    if (reason != DLL_PROCESS_ATTACH)
        return TRUE;

    HANDLE real_dll = LoadLibrary( "real.dll" );
    for ( int i = 0; i &lt; 3; i++ ) {
        ProcList[i] = GetProcAddress(real_dll , ImportNames[i]);
    }

    return TRUE;
}</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="cpp" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">extern "C" UINT_PTR ProcList[3] = {0};

extern "C" void ReadThing_wrapper();
extern "C" void WriteThing_wrapper();
extern "C" void DeleteThing_wrapper();

LPCSTR ImportNames[] = {
   "ReadThing",
   "WriteThing",
   "DeleteThing"
}

BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved)
{
	if (reason != DLL_PROCESS_ATTACH)
		return TRUE;

	HANDLE real_dll = LoadLibrary( "real.dll" );
	for ( int i = 0; i &lt; 3; i++ ) {
		ProcList[i] = GetProcAddress(real_dll , ImportNames[i]);
	}

	return TRUE;
}</pre>



<h4 class="wp-block-heading" id="h-run-time-generation">Run-Time Generation</h4>



<p>We could also go crazy and just re-build the entire export address table at run time. Here we need not know what DLL we are going to hijack when we write our code, which is nice. We can also add a basic function which re-implements the Windows search order to try and locate the real DLL dynamically. It could also perform basic alterations like .old and .bak within the current directory just in case.</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-cpp enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">HMODULE </span><span class="enlighter-m0">FindModule</span><span class="enlighter-g1">(</span><span class="enlighter-text">HMODULE our_dll</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    WCHAR our_name</span><span class="enlighter-g1">[</span><span class="enlighter-text">MAX_PATH</span><span class="enlighter-g1">]</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">GetModuleFileName</span><span class="enlighter-g1">(</span><span class="enlighter-text">our_dll, our_name, MAX_PATH</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c0">// Locate real DLL using our_name</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text">our_dll != module</span><span class="enlighter-g1">){</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k0">return</span><span class="enlighter-text"> module;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-g1">}</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-k5">void</span><span class="enlighter-text"> </span><span class="enlighter-m0">ProxyExports</span><span class="enlighter-g1">(</span><span class="enlighter-text">HMODULE module</span><span class="enlighter-g1">)</span><span class="enlighter-text"> </span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    HMODULE real_dll = </span><span class="enlighter-m0">FindModule</span><span class="enlighter-g1">(</span><span class="enlighter-text">module</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c0">// Rebuild our export table with real_dll</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">return</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">BOOL WINAPI </span><span class="enlighter-m0">DllMain</span><span class="enlighter-g1">(</span><span class="enlighter-text">HMODULE module, DWORD reason, LPVOID reserved</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text">reason != DLL_PROCESS_ATTACH</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">ProxyExports</span><span class="enlighter-g1">(</span><span class="enlighter-text">module</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">HMODULE FindModule(HMODULE our_dll)
{
    WCHAR our_name[MAX_PATH];
    GetModuleFileName(our_dll, our_name, MAX_PATH);

    // Locate real DLL using our_name

    if (our_dll != module){
        return module;
    }
}

void ProxyExports(HMODULE module) 
{
    HMODULE real_dll = FindModule(module);

    // Rebuild our export table with real_dll

    return;
}

BOOL WINAPI DllMain(HMODULE module, DWORD reason, LPVOID reserved)
{
    if (reason != DLL_PROCESS_ATTACH)
        return TRUE;

    ProxyExports(module);

    return TRUE;
}</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="cpp" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">HMODULE FindModule(HMODULE our_dll)
{
	WCHAR our_name[MAX_PATH];
	GetModuleFileName(our_dll, our_name, MAX_PATH);

	// Locate real DLL using our_name

	if (our_dll != module){
		return module;
	}
}

void ProxyExports(HMODULE module) 
{
	HMODULE real_dll = FindModule(module);

	// Rebuild our export table with real_dll

	return;
}

BOOL WINAPI DllMain(HMODULE module, DWORD reason, LPVOID reserved)
{
	if (reason != DLL_PROCESS_ATTACH)
		return TRUE;

	ProxyExports(module);

	return TRUE;
}</pre>



<p>This strategy, while elegant, suffers from being so dynamic. We no longer include the export names in our static table unless we explicitly add them (re: static sinks). In addition, we receive execution after the import tables (IATs) of other modules might already contain references to our old export table (static sinks again). There is no easy fix for the former that keeps us dynamic unless we simply add every export name we might expect to need across all DLLs. To fix the latter, we need to iterate loaded modules and patch in addresses to the real DLL. Nothing some code can’t solve, but a convoluted solution to some eyes. The bulk of this strategy can be found in the Koppeling project below.</p>



<p><em>Another caveat is that references to, and within, the export table are relative virtual addresses (RVAs). Because of their size (DWORD), we are limited to placing our new export table somewhere within 4GB of the PE base unless it can fit inside the old one. Not an issue on x86, but certainly on x64.</em></p>



<h5 class="wp-block-heading" id="h-takeaway-0">Takeaway</h5>



<p><strong>Export forwarding is the easiest solution</strong>&nbsp;when it comes to proxying functionality. It’s preparatory (we need to create the DLL with a specific hijack in mind), but the loader subsystem does the heavy lifting. We can make some nice improvements to the preparation process itself which we’ll look at later. We like the flexibility of run-time generation, but it has weaknesses regarding static-sinks and their requirement for export names to be included in the file on disk. When it comes down to it, we might as well automate export forwarding.</p>



<h3 class="wp-block-heading" id="h-loader-lock">Loader Lock</h3>



<p>The LDR subsystem holds a single list of loaded modules for the process. To solve any thread sharing issues, a “loader lock” is implemented to ensure only one thread is ever modifying a module list at one time. This is relevant for hijacking as we typically gain code execution inside DllMain, which occurs while the LDR subsystem is still working on the module list. In other words, ntdll has to pass execution to us while the loader lock is still being held (not ideal). As a consequence, Microsoft provides a big list of&nbsp;<a href="https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-best-practices" target="_blank" rel="noreferrer noopener">things you certainly SHOULD NOT DO while inside DllMain</a>.</p>



<ul class="wp-block-list">
<li>Call LoadLibrary or LoadLibraryEx (either directly or indirectly). This can cause a deadlock or a crash.</li>



<li>Call GetStringTypeA, GetStringTypeEx, or GetStringTypeW (either directly or indirectly). This can cause a deadlock or a crash.</li>



<li>Synchronize with other threads. This can cause a deadlock.</li>



<li>Acquire a synchronization object that is owned by code that is waiting to acquire the loader lock. This can cause a deadlock.</li>



<li>Initialize COM threads by using CoInitializeEx. Under certain conditions, this function can call LoadLibraryEx.</li>



<li>Call the registry functions. These functions are implemented in Advapi32.dll. If Advapi32.dll is not initialized before your DLL, the DLL can access uninitialized memory and cause the process to crash.</li>



<li>Call CreateProcess. Creating a process can load another DLL.</li>



<li>Call ExitThread. Exiting a thread during DLL detach can cause the loader lock to be acquired again, causing a deadlock or a crash.</li>



<li>Call CreateThread. Creating a thread can work if you do not synchronize with other threads, but it is risky.</li>



<li>Use the memory management function from the dynamic C Run-Time (CRT). If the CRT DLL is not initialized, calls to these functions can cause the process to crash.</li>



<li>Call functions in User32.dll or Gdi32.dll. Some functions load another DLL, which may not be initialized.</li>



<li>Use managed code.</li>
</ul>



<p><strong>Scary list, right?</strong></p>



<p>In our experience, however, this list is not as bad as it might appear. For example, LoadLibrary is typically safe to call within DllMain. In fact during static sinks, the loader lock is not re-acquired as long as the same thread is still in initialization. The call to LdrLoadDll will simply re-trigger dependency graph calculation and initialization. Does this mean that Microsoft is wrong to publish the list above? Absolutely not. They are just trying to prevent issues wherever possible.</p>



<p><strong>The real answer to “Can I do &lt;questionable thing&gt; inside DllMain?” is typically “it depends, but avoid trying it”.</strong>&nbsp;Let’s check out one example where LDR synchronization can cause a deadlock:</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-cpp enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">DWORD </span><span class="enlighter-m0">ThreadFunc</span><span class="enlighter-g1">(</span><span class="enlighter-text">PVOID param</span><span class="enlighter-g1">)</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">printf</span><span class="enlighter-g1">(</span><span class="enlighter-s0">"[+] New thread started."</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">return</span><span class="enlighter-text"> 1;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">BOOL WINAPI </span><span class="enlighter-m0">DllMain</span><span class="enlighter-g1">(</span><span class="enlighter-text">HINSTANCE instance, DWORD reason, LPVOID reserved</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text">reason != DLL_PROCESS_ATTACH</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    DWORD dwThread;</span></div></div><div class=""><div><span class="enlighter-text">    HANDLE hThread = </span><span class="enlighter-m0">CreateThread</span><span class="enlighter-g1">(</span><span class="enlighter-text">0, 0, ThreadFunc, 0, 0, &amp;dwThread</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c0">// Deadlock starts here</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">WaitForSingleObject</span><span class="enlighter-g1">(</span><span class="enlighter-text">hThread, INFINITE</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">DWORD ThreadFunc(PVOID param) {
    printf("[+] New thread started.");
    return 1;
}

BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved)
{
    if (reason != DLL_PROCESS_ATTACH)
        return TRUE;

    DWORD dwThread;
    HANDLE hThread = CreateThread(0, 0, ThreadFunc, 0, 0, &amp;dwThread);

    // Deadlock starts here
    WaitForSingleObject(hThread, INFINITE);

    return TRUE;
}</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="cpp" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">DWORD ThreadFunc(PVOID param) {
	printf("[+] New thread started.");
	return 1;
}

BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved)
{
	if (reason != DLL_PROCESS_ATTACH)
		return TRUE;

	DWORD dwThread;
	HANDLE hThread = CreateThread(0, 0, ThreadFunc, 0, 0, &amp;dwThread);

	// Deadlock starts here
	WaitForSingleObject(hThread, INFINITE);

	return TRUE;
}</pre>



<p>Regardless of the sink we use, our DllMain will get stuck waiting for the new thread to finish, but the new thread will be waiting for us to finish. You can see this in the two call stacks for the threads:</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-raw enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">...</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpCallInitRoutine</span></div></div><div class=""><div><span class="enlighter-text">Theif!DllMain</span></div></div><div class=""><div><span class="enlighter-text">KernelBase!WaitForSingleObjectEx</span></div></div><div class=""><div><span class="enlighter-text">ntdll!NtWaitForSingleObject &lt;- Waiting for the thread</span></div></div></div><div class="enlighter-raw">...
ntdll!LdrpCallInitRoutine
Theif!DllMain
KernelBase!WaitForSingleObjectEx
ntdll!NtWaitForSingleObject &lt;- Waiting for the thread</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">...
ntdll!LdrpCallInitRoutine
Theif!DllMain
KernelBase!WaitForSingleObjectEx
ntdll!NtWaitForSingleObject &lt;- Waiting for the thread</pre>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-raw enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">ntdll!LdrInitializeThunk</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitialize</span></div></div><div class=""><div><span class="enlighter-text">ntdll!_LdrpInitialize</span></div></div><div class=""><div><span class="enlighter-text">ntdll!NtWaitForSingleObject &lt;- Waiting for LdrpInitCompleteEvent</span></div></div><div class=""><div><span class="enlighter-text">         (can also be NtDelayExecution/LdrpProcessInitialized != 1)</span></div></div></div><div class="enlighter-raw">ntdll!LdrInitializeThunk
ntdll!LdrpInitialize
ntdll!_LdrpInitialize
ntdll!NtWaitForSingleObject &lt;- Waiting for LdrpInitCompleteEvent
         (can also be NtDelayExecution/LdrpProcessInitialized != 1)</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ntdll!LdrInitializeThunk
ntdll!LdrpInitialize
ntdll!_LdrpInitialize
ntdll!NtWaitForSingleObject &lt;- Waiting for LdrpInitCompleteEvent
         (can also be NtDelayExecution/LdrpProcessInitialized != 1)</pre>



<p>Inside a dynamic sink, you’ll probably see the deadlock occur in LdrpDrainWorkQueue (as the process has already been initialized by then).</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-raw enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">ntdll!LdrInitializeThunk</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitialize</span></div></div><div class=""><div><span class="enlighter-text">ntdll!_LdrpInitialize</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpInitializeThread</span></div></div><div class=""><div><span class="enlighter-text">ntdll!LdrpDrainWorkQueue</span></div></div><div class=""><div><span class="enlighter-text">ntdll!NtDelayExecution &lt;- Waiting for LdrpWorkCompleteEvent</span></div></div></div><div class="enlighter-raw">ntdll!LdrInitializeThunk
ntdll!LdrpInitialize
ntdll!_LdrpInitialize
ntdll!LdrpInitializeThread
ntdll!LdrpDrainWorkQueue
ntdll!NtDelayExecution &lt;- Waiting for LdrpWorkCompleteEvent</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ntdll!LdrInitializeThunk
ntdll!LdrpInitialize
ntdll!_LdrpInitialize
ntdll!LdrpInitializeThread
ntdll!LdrpDrainWorkQueue
ntdll!NtDelayExecution &lt;- Waiting for LdrpWorkCompleteEvent</pre>



<p>This outcome is frustrating, because starting a new thread is the easiest way to avoid LDR conflicts. We can collect execution in DllMain, kick off a new thread, and let our malicious code run there once the process has finished initializing. To avoid the deadlock, we could remove the&nbsp;<strong>WaitForSingleObject&nbsp;</strong>call like so:</p>



<div class="enlighter-default enlighter-v-standard enlighter-t-wpcustom enlighter-l-cpp enlighter-hover enlighter-linenumbers enlighter-overflow-scroll "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw"><div class="enlighter-tooltip">Plain text</div></div><div class="enlighter-btn enlighter-btn-copy"><div class="enlighter-tooltip">Copy to clipboard</div></div><div class="enlighter-btn enlighter-btn-window"><div class="enlighter-tooltip">Open code in new window</div></div><div class="enlighter-btn enlighter-btn-website"><div class="enlighter-tooltip">EnlighterJS 3 Syntax Highlighter</div></div></div><div class="enlighter-code"><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">BOOL WINAPI </span><span class="enlighter-m0">DllMain</span><span class="enlighter-g1">(</span><span class="enlighter-text">HINSTANCE instance, DWORD reason, LPVOID reserved</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text">reason != DLL_PROCESS_ATTACH</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    DWORD dwThread;</span></div></div><div class=""><div><span class="enlighter-text">    HANDLE hThread = </span><span class="enlighter-m0">CreateThread</span><span class="enlighter-g1">(</span><span class="enlighter-text">0, 0, ThreadFunc, 0, 0, &amp;dwThread</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c0">// WaitForSingleObject(hThread, INFINITE);</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k0">return</span><span class="enlighter-text"> </span><span class="enlighter-e0">TRUE</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved)
{
    if (reason != DLL_PROCESS_ATTACH)
        return TRUE;

    DWORD dwThread;
    HANDLE hThread = CreateThread(0, 0, ThreadFunc, 0, 0, &amp;dwThread);

    // WaitForSingleObject(hThread, INFINITE);

    return TRUE;
}</div></div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="cpp" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved)
{
    if (reason != DLL_PROCESS_ATTACH)
        return TRUE;

    DWORD dwThread;
    HANDLE hThread = CreateThread(0, 0, ThreadFunc, 0, 0, &amp;dwThread);

    // WaitForSingleObject(hThread, INFINITE);

    return TRUE;
}</pre>



<p>This works if the process stays up long enough for our code to execute, but this is a rare occurrence. Most likely, we will return execution to the primary module and it will exit quickly or throw an error if we haven’t done proxying properly. Our thread will never get a chance to do anything useful.</p>



<h4 class="wp-block-heading" id="h-hooking-for-stability">Hooking for Stability</h4>



<p>Lucky for us, we do hold execution long enough to implement a hook, so we can try to take over primary execution once LDR is done. Where exactly we place this hook is going to depend on where in the execution chain we sit.</p>



<ul class="wp-block-list">
<li><strong>Pre-Load:&nbsp;</strong>The process is still being initialized and execution has not been handed over to the primary module. In this case, we’d likely want to hook the&nbsp;<strong>entry point</strong>&nbsp;of the primary module.</li>



<li><strong>Post-Load:&nbsp;</strong>The process has already started core execution, and we might be loaded as a consequence of a LoadLibrary call. The most optimal is to just hook the&nbsp;<strong>last function&nbsp;</strong>in the call stack which is part of the primary module. Whatever issues/errors bubble up can be ignored then.</li>
</ul>



<p>To differentiate between these two scenarios was can just keep walking backward in the stack. If we find a return address for the primary module, we are probably post-load. Otherwise, the process likely hasn’t kicked off yet and the entry point is our best bet. Naturally, we’ve built a proof of concept already so you don’t have to pull your hair out:</p>



<p><a href="https://gist.github.com/monoxgas/5027de10caad036c864efb32533202ec" target="_blank" rel="noreferrer noopener">https://gist.github.com/monoxgas/5027de10caad036c864efb32533202ec</a></p>



<h5 class="wp-block-heading" id="h-takeaway-1">Takeaway</h5>



<p>Loader lock represents some challenges, but nothing too difficult as long as we respect it.&nbsp;<strong>Starting a separate thread for any significant code is the best option.</strong>&nbsp;In situations where we need to keep the process alive so the thread can continue run, we can use function hooking.</p>



<h3 class="wp-block-heading" id="h-koppeling">Koppeling</h3>



<p>We started this post by introducing various complexities of hijacking. Let’s review and pair them up with relevant solutions:</p>



<ol class="wp-block-list">
<li><strong>Stability of the source process:&nbsp;</strong>Use function proxying, avoid loader lock.</li>



<li><strong>Maintaining code execution inter-process:&nbsp;</strong>Use proxying and/or function hooking.</li>



<li><strong>Complexities of loader lock:&nbsp;</strong>Use new threads and/or function hooking.</li>



<li><strong>Static export names:&nbsp;</strong>Use post-build cloning, static definitions, linker comments, etc.</li>
</ol>



<p>If there is one thing to communicate however, the solution space is quite large and everyone will have preferences. Our current “best” implementation combines the simplicity of export forwarding with post-build patching for flexibility. The process goes like this:</p>



<ol class="wp-block-list">
<li>We compile/collect our “evil” DLL for hijacking. It doesn’t need to be aware of any hijacking duty (unless you need to add hooking).</li>



<li>We clone the exports of a reference DLL into the “evil” DLL. The “real” DLL is parsed and the export table is duplicated into a new PE section. Export forwarding is used to correctly proxy functionality.</li>



<li>We use the freshly cloned DLL in any hijack. Stability is guaranteed and we can maintain execution inter-process.</li>
</ol>



<p>We’re releasing a project to demonstrate this, and some other, advanced hijacking techniques called&nbsp;<strong>Koppeling</strong>. Much like our&nbsp;<a href="https://github.com/monoxgas/sRDI" target="_blank" rel="noreferrer noopener">sRDI&nbsp;</a>project,&nbsp;<strong>it allows you to prepare any arbitrary DLL for hijacking&nbsp;</strong>provided you know the final path of the reference DLL. We hope you find use for it and contribute if you love hijacking as much as we do.</p>



<p><a href="https://github.com/monoxgas/Koppeling" target="_blank" rel="noreferrer noopener">https://github.com/monoxgas/Koppeling</a></p>



<h3 class="wp-block-heading" id="h-wrap-up">Wrap Up</h3>



<p>Our team is very passionate about not only how to weaponize a technique, but how to do it with stability and poise. We want to avoid impact to customer environments at all costs. This kind of care demands hours of research, testing, and development. Our&nbsp;<a href="https://silentbreaksecurity.com/red-team-toolkit/slingshot/" target="_blank" rel="noreferrer noopener">Slingshot&nbsp;</a>toolkit maintains seamless integration with the techniques we’ve detailed here to ensure our team and others can take full advantage of hijacking. As mentioned earlier, we also dive deeper into these topics in our&nbsp;Dark Side Ops&nbsp;course series if you’re hungry for more.</p>



<p>We hope this post has provided a deeper understanding of this often misrepresented technique. Till next time.</p>



<p>– Nick (@monoxgas)</p>
 
    </div>
  </div>
</div>


  <section class="pt-8">
    <div class="container">
        <div class="py-20 lg:py-24 bg-platinum text-navy">
          <div class="max-w-[90%] sm:max-w-[40rem] md:max-w-[54.5rem] lg:max-w-[67.5rem] mx-auto">
              <h2 class="h1">Explore More Blog Posts</h2>
              <div class="grid gap-5 mt-10 sm:grid-cols-2 md:grid-cols-3 gap-y-12">
                <a href="https://www.netspi.com/blog/executive-blog/critical-vulnerability/cve-2026-1731-beyondtrust-rce-overview-and-takeaways/" class="relative  flex flex-col group"> 
    <div class="md:h-[12.0625rem] h-[12rem] sm:h-[19rem] relative">
                <img class="absolute top-0 left-0 object-cover w-full h-full" src="https://www.netspi.com/wp-content/uploads/2025/12/TB-Design-1_Feature-Image.png" alt="">
            </div>
    <div class="flex flex-col justify-between flex-1 h-full">
        <div>
            <div>
                                            <span class="p-2 px-4 my-6 text-sm bg-orange tabled font-sm font-secondary">Critical Vulnerability</span>
                                    </div>
            <h3>
                CVE-2026-1731 – BeyondTrust RCE Overview and Takeaways            </h3>
            <div class="mt-3 event-post-metadata">
                <p>February 12, 2026</p>
            </div>
                            <p class="pt-3 lg:pr-12">Learn about CVE-2026-1731, a critical RCE vulnerability in BeyondTrust RS &amp; PRA products. Discover its impact, affected versions, and remediation steps.</p>
                    </div>
        <div>
            <span class="mt-6 tabled undrl">Learn More</span>
        </div>
    </div>
</a><a href="https://www.netspi.com/blog/technical-blog/adversary-simulation/pipe-dreams-remote-code-execution-via-quest-desktop-authority-named-pipe/" class="relative  flex flex-col group"> 
    <div class="md:h-[12.0625rem] h-[12rem] sm:h-[19rem] relative">
                <img class="absolute top-0 left-0 object-cover w-full h-full" src="https://www.netspi.com/wp-content/uploads/2026/01/01.29.26_EXEC_Quest-Desktop-Authority-Blog_Feature-Image.png" alt="">
            </div>
    <div class="flex flex-col justify-between flex-1 h-full">
        <div>
            <div>
                                            <span class="p-2 px-4 my-6 text-sm bg-orange tabled font-sm font-secondary">Adversary Simulation</span>
                                    </div>
            <h3>
                Pipe Dreams: Remote Code Execution via Quest Desktop Authority Named Pipe&nbsp;            </h3>
            <div class="mt-3 event-post-metadata">
                <p>February 1, 2026</p>
            </div>
                            <p class="pt-3 lg:pr-12">Discover the risks of the CVE-2025-67813 vulnerability in Quest Desktop Authority. Learn how this RCE flaw impacts your organization and how to mitigate it.</p>
                    </div>
        <div>
            <span class="mt-6 tabled undrl">Learn More</span>
        </div>
    </div>
</a><a href="https://www.netspi.com/blog/executive-blog/critical-vulnerability/ivanti-endpoint-manager-mobile-epmm-cve-2026-1281-cve-2026-1340-overview-takeaways/" class="relative  flex flex-col group"> 
    <div class="md:h-[12.0625rem] h-[12rem] sm:h-[19rem] relative">
                <img class="absolute top-0 left-0 object-cover w-full h-full" src="https://www.netspi.com/wp-content/uploads/2025/12/TB-Design-1_Feature-Image.png" alt="">
            </div>
    <div class="flex flex-col justify-between flex-1 h-full">
        <div>
            <div>
                                            <span class="p-2 px-4 my-6 text-sm bg-orange tabled font-sm font-secondary">Critical Vulnerability</span>
                                    </div>
            <h3>
                Ivanti Endpoint Manager Mobile (EPMM)&nbsp;[CVE-2026-1281 &amp; CVE-2026-1340]:&nbsp;Overview &amp; Takeaways            </h3>
            <div class="mt-3 event-post-metadata">
                <p>January 30, 2026</p>
            </div>
                            <p class="pt-3 lg:pr-12">Ivanti has disclosed two critical zero‑day vulnerabilities affecting Ivanti Endpoint Manager Mobile (EPMM), tracked as CVE‑2026‑1281 and CVE‑2026‑1340. 

Both vulnerabilities have been exploited in active attacks and allow unauthenticated remote threat actors to compromise EPMM appliances. </p>
                    </div>
        <div>
            <span class="mt-6 tabled undrl">Learn More</span>
        </div>
    </div>
</a>              </div>
          </div>
        </div>
    </div>
  </section>
  
</main>

<span class="bg-darkOlive bg-slate bg-grey bg-platinum bg-darkGold bg-gold bg-orange bg-fadedGreen bg-offWhite"></span>
<div id="close-menu" class="fixed top-0 left-0 w-[100vw] h-[100vh] -z-10"></div>

<div id="wonderpluginlightbox_options" data-skinsfoldername="skins/default/" data-jsfolder="https://www.netspi.com/wp-content/plugins/wonderplugin-lightbox/engine/" data-inityoutube="false" data-initvimeo="false" data-autoslide="false" data-showall="false" data-slideinterval="5000" data-showtimer="true" data-timerposition="bottom" data-timerheight="2" data-timercolor="#dc572e" data-timeropacity="1" data-navarrowspos="inside" data-closepos="outside" data-enteranimation="none" data-exitanimation="" data-showplaybutton="false" data-alwaysshownavarrows="false" data-bordersize="8" data-showtitleprefix="false" data-responsive="true" data-fullscreenmode="false" data-fullscreentextoutside="true" data-closeonoverlay="true" data-videohidecontrols="false" data-mutevideo="false" data-nativehtml5controls="false" data-enableclick="false" data-enablespacekey="false" data-titlestyle="bottom" data-imagepercentage="75" data-enabletouchswipe="true" data-supportdynamiccontent="false" data-autoplay="false" data-html5player="true" data-overlaybgcolor="#000" data-overlayopacity="0.8" data-defaultvideovolume="1" data-bgcolor="#FFF" data-borderradius="0" data-thumbwidth="96" data-thumbheight="72" data-thumbtopmargin="12" data-thumbbottommargin="12" data-barheight="64" data-showtitle="true" data-titleprefix="%NUM / %TOTAL" data-titlebottomcss="color:#333; font-size:14px; font-family:Armata,sans-serif,Arial; overflow:hidden; text-align:left;" data-showdescription="true" data-descriptionbottomcss="color:#333; font-size:12px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left; margin:4px 0px 0px; padding: 0px;" data-titleinsidecss="color:#fff; font-size:16px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left;" data-descriptioninsidecss="color:#fff; font-size:12px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left; margin:4px 0px 0px; padding: 0px;" data-titleoutsidecss="color:#fff; font-size:18px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:center; margin: 8px;" data-descriptionoutsidecss="color:#fff; font-size:14px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:center; margin:8px; padding: 0px;" data-videobgcolor="#000" data-html5videoposter="" data-responsivebarheight="false" data-smallscreenheight="415" data-barheightonsmallheight="48" data-notkeepratioonsmallheight="false" data-showsocial="false" data-socialposition="position:absolute;top:100%;right:0;" data-socialpositionsmallscreen="position:absolute;top:100%;right:0;left:0;" data-socialdirection="horizontal" data-socialbuttonsize="32" data-socialbuttonfontsize="18" data-socialrotateeffect="true" data-showemail="false" data-showfacebook="true" data-showtwitter="true" data-showpinterest="true" data-showdownload="false" data-showcopylink="false" data-showlinkedin="false" data-showcopymedialink="false" data-bordertopmargin="48" data-shownavigation="true" data-navbgcolor="rgba(0,0,0,0.2)" data-shownavcontrol="true" data-hidenavdefault="false" data-hidenavigationonmobile="false" data-hidenavigationonipad="false" data-ga4account="" data-googleanalyticsaccount="" data-videoplaystyle="triangle" data-videoiconbg="#4169e1" data-videoiconcolor="#fff" data-videoicondisabledcolor="#aaa" data-videobarbuffercolor="#444" data-videobaractivecolor="#fcc500" data-videobarcolor="#666" data-videoplaysize="64" data-videoplayfontsize="32" data-videoplayradius="32" data-videoplayopacity="0.8" data-videoplaytimeout="1500" data-videocontroltimeout="3000" data-videohidetotaltimewidth="320" data-videohidecurrtimewidth="240" data-videohidecontrolbar="false" data-videohideplaybutton="false" data-wonderplugin-lightbox-options="fcf133a08c" data-_wp_http_referer="/wp-admin/admin.php?page=wonderplugin_lightbox_show_options" style="display:none;"></div>






</body></html>