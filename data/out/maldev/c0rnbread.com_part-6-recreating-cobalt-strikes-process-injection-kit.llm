Title:
Part 6: Recreating Cobalt Strike’s Process Injection Kit

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes adding Cobalt Strike–style “Process Injection Kit” extensibility to the Mythic Xenon agent so operators can swap process injection techniques without recompiling the payload.  
- It explains Cobalt Strike’s two injection hooks (spawn/fork-and-run vs explicit injection) and why injection is used to isolate risky post-execution from the main beacon process.  
- Xenon’s default method is APC injection (highly signatured), so the author implements a mechanism to upload a user-provided BOF that overrides spawn-based injection for selected commands (e.g., `execute_assembly`, `mimikatz`).  
- A key engineering challenge is capturing output from code running in the remote/sacrificial process when the user controls process creation; the solution is a prepended PIC stub that redirects stdout/stderr to a known named pipe.  
- The post contrasts fork-and-run with modern in-process BOF execution (often quieter) but keeps injection-kit support for flexibility and compatibility with existing kits.  
- Useful for red teamers and C2/implant developers who want modular injection tradecraft and for defenders studying common injection/output-redirection patterns.

Technical Focus:
- Process injection “kits” via BOFs (COFF) and hook-style overrides
- Fork-and-run (spawn + inject) vs explicit injection tradeoffs
- Output capture from remote processes using named pipes
- PIC stubs: PEB walking to resolve WinAPI (CreateFileA, SetStdHandle)
- Beacon APIs / Cobalt Strike compatibility patterns (BeaconSpawnTemporaryProcess, BeaconInjectTemporaryProcess)
- Windows process/std-handle manipulation and shellcode staging

Use Cases:
- Swap injection techniques on-the-fly to evade signatures without rebuilding an agent
- Implement custom spawn-and-inject methods (e.g., indirect syscalls, section mapping)
- Run risky post-ex tasks in sacrificial processes while preserving beacon stability
- Build/port Cobalt Strike Process Injection Kits to Mythic Xenon
- Study detection opportunities around named-pipe stdout redirection and injection workflows

Keywords:
Mythic, Xenon agent, Cobalt Strike, Process Injection Kit, BOF, COFF loader, fork and run, spawn injection, explicit injection, APC injection, shellcode, PIC stub, PEB walking, CreateFileA, SetStdHandle, named pipe, stdout/stderr redirection, Beacon APIs, indirect syscalls, section mapping injection, Tartarus Gate