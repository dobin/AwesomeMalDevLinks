Title:
LdrLockLiberator — Escaping Windows Loader Lock from DllMain

Type:
GitHub Tool

Short Summary (4–8 sentences max):
LdrLockLiberator is a C proof-of-concept/toolkit that provides techniques to execute meaningful code from `DllMain` despite Windows’ Loader Lock constraints. It targets the common problem where doing “real work” in `DllMain` deadlocks or breaks due to the loader holding internal locks and incomplete loader state. The repo includes approaches like forcibly fully unlocking the loader (setting loader events and toggling internal state such as `LdrpWorkInProgress`) and a safer “escape at exit” method using CRT `atexit` plus DLL pinning via `LdrAddRefDll(LDR_ADDREF_DLL_PIN)` to survive `FreeLibrary`. It was released alongside the “Perfect DLL Hijacking” article and includes sample DLL-hijack scenarios (e.g., hijacking `MpClient.dll` for `OfflineScannerShell.exe`) with a default `ShellExecute` payload. It’s primarily useful for red teamers, exploit developers, and malware researchers who need reliable execution when `DllMain` is the only available entrypoint, while also being relevant to defenders studying loader abuse patterns. The project emphasizes compatibility with modern mitigations by avoiding memory-protection changes and pointer patching where possible (x64-focused).

Technical Focus:
- Windows Loader Lock / `DllMain` execution constraints and deadlock avoidance
- NTDLL loader internals (loader events, `LdrpWorkInProgress`)
- `LdrAddRefDll` and `LDR_ADDREF_DLL_PIN` (DLL pinning)
- CRT `atexit` abuse for deferred execution outside loader lock
- DLL hijacking / export forwarding considerations for static vs dynamic loads
- x86-64 Windows native API linking (`ntdll.lib`), WDK build workflow

Use Cases:
- Build DLL hijacks that safely run payload logic without `DllMain` deadlocks
- Defer execution until process exit to bypass loader-lock restrictions
- Research/validate loader-internal manipulation impacts and stability tradeoffs
- Create PoCs for “perfect” DLL hijacking chains in real Windows binaries
- Develop detection ideas around unusual loader-state changes or DLL pinning

Keywords:
DllMain, Loader Lock, LdrLock, NTDLL, LdrAddRefDll, LDR_ADDREF_DLL_PIN, LdrpWorkInProgress, atexit, LoadLibrary, FreeLibrary, DLL hijacking, export forwarding, MpClient.dll, OfflineScannerShell.exe, ShellExecute, Windows loader internals, x64, WDK 7.1, ntdll.lib, CRT/MSVCRT