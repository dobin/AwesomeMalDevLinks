Title:
Introducing a New Vulnerability Class: False File Immutability

Type:
Blog Post

Short Summary (4–8 sentences max):
- This write-up defines “False File Immutability” (FFI): a Windows vulnerability class where code assumes a file can’t change after opening it without `FILE_SHARE_WRITE`, but the file can still be modified via writable mappings or remote filesystems (SMB redirectors) that don’t honor Windows sharing semantics.  
- It explains how these incorrect assumptions interact with the Memory Manager paging behavior, section objects (data vs `SEC_IMAGE`), and Code Integrity (CI) signature validation, enabling double-read/double-fetch style races against file-backed content.  
- The article connects FFI to real exploitation: PPLFault (Admin→PPL) and introduces a new exploit, “ItsNotASecurityBoundary,” that targets CI’s security catalog (`.cat`) processing to achieve Admin→Kernel by racing catalog signature verification vs hash parsing.  
- It details why page-hash enforcement matters (present for drivers/PP, absent for PPL historically) and how network-loaded images/cat files expand the attack surface.  
- Mitigations are discussed at multiple layers: enabling HVCI, CI changes (copy-to-heap / lock pages with `MmProbeAndLockPages`), and a defensive minifilter that blocks CI from opening catalogs over network redirectors.  
- This is useful for Windows exploit devs/red teams (new privesc and CI bypass patterns) and for defenders/OS developers (identifying and fixing file-processing race assumptions).

Technical Focus:
- Windows file sharing semantics (`CreateFile`, `IoCheckShareAccess`, `MmDoesFileHaveUserWritableReferences`)
- Section objects and mappings (data sections vs `SEC_IMAGE`, `ZwCreateSection`, `ZwMapViewOfSection`)
- Memory Manager paging, working set eviction, and page-fault driven I/O
- Authenticode, authentihash, security catalogs (`.cat`), and Code Integrity (`ci.dll`)
- Page hashes (static `/ph` and dynamic) and their enforcement gaps
- Race/double-fetch style exploitation against file-backed parsing/verification

Use Cases:
- Identify Windows components vulnerable to FFI by auditing file mapping + multi-stage parsing/verification flows
- Develop or emulate Admin→PPL / Admin→Kernel exploit chains leveraging network redirectors and paging races
- Build detections around CI Operational logs indicating repeated invalid catalog/driver signature events
- Implement mitigations in products (minifilter policies, forcing local-only catalog access, pinning/copying mapped data)
- Validate hardening impact of HVCI and page-hash enforcement changes across Windows versions

Keywords:
Windows kernel, False File Immutability, FFI, CreateFile, FILE_SHARE_WRITE, IoCheckShareAccess, MmDoesFileHaveUserWritableReferences, MmFlushImageSection, ZwCreateSection, ZwMapViewOfSection, SEC_IMAGE, section objects, Memory Manager, paging, working set, page faults, Authenticode, authentihash, security catalog, CatRoot, Code Integrity, ci.dll, HVCI, skci.dll, page hashes, Protected Process Light, PPL, SMB redirector, Samba, impacket, oplock, double-fetch, MmProbeAndLockPages, minifilter driver, ItsNotASecurityBoundary, PPLFault, GodFault, KB5037771