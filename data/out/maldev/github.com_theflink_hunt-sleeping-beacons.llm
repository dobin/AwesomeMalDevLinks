Title:
Hunt-Sleeping-Beacons

Type:
GitHub Tool

Short Summary (4–8 sentences max):
- Hunt-Sleeping-Beacons is a Windows userland callstack-scanning tool designed to identify “sleeping” C2 beacons by analyzing why threads are blocked/idle between callbacks.  
- It looks for indicators of injected/unpacked agents and common sleepmask implementations by inspecting thread callstacks for suspicious frames and memory characteristics.  
- The tool flags IOCs such as unbacked private RX/RWX memory in stacks, non-executable pages (permission-flipping sleepmasks), and module stomping via working set attributes.  
- It also detects APC- and timer-based sleepmasks by spotting relevant ntdll dispatcher/callback frames and, notably, enumerates threadpool timers and their callback addresses from userland.  
- Additional heuristics include abnormal intermodular call sequences consistent with module proxying and patterns suggestive of return address spoofing.  
- Results are heuristic (false positives expected, especially module stomping); by default it ignores .NET and 32-bit processes.  
- Useful for Blue Teams/EDR engineers and threat hunters validating suspicious processes, and for Red Teams to understand detectable artifacts of sleepmasking and stack evasion.

Technical Focus:
- Thread callstack inspection for blocked threads (sleeping beacon detection)
- Memory forensics heuristics (unbacked pages, RX/RWX, NX permission flips)
- Module stomping detection via MEMORY_WORKING_SET_EX_INFORMATION / SharedOriginal
- APC-based sleepmask detection (KiUserApcDispatcher, NtContinue, wait APIs)
- Threadpool timer queue enumeration via NtQueryInformationWorkerFactory / WORKER_FACTORY_BASIC_INFORMATION
- Stack evasion detection (module proxying patterns, return address spoofing/jmp-gadget returns)

Use Cases:
- Hunt for in-memory C2 agents that “sleep” between callbacks
- Triage suspicious processes by correlating idle threads with stack/memory IOCs
- Detect timer/APC-based sleepmasking and enumerate suspicious timer callbacks
- Validate or tune defensive detections around module stomping and stack manipulation
- Red-team self-assessment of beacon OPSEC against callstack/timer-based hunting

Keywords:
Windows, callstack scanning, sleeping beacons, C2 agent, in-memory injection, unpacked payload, sleepmask, APC, KiUserApcDispatcher, NtContinue, WaitForSingleObject, threadpool timers, TimerQueue, NtQueryInformationWorkerFactory, WORKER_FACTORY_BASIC_INFORMATION, FULL_TP_POOL, module stomping, MEMORY_WORKING_SET_EX_INFORMATION, SharedOriginal, copy-on-write, module proxying, return address spoofing, jmp gadget, ntdll, kernel32