# https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/

<!DOCTYPE html><html class="scroll-smooth" lang="en-us"><body class="flex h-screen flex-col bg-white dark:bg-[#1b1f26]"><div id="post-feature" class="mt-22 w-full md:mt-[151px]"><img class="h-60 w-full object-cover md:h-120" src="https://azr43lkn1ght.github.io/images/posts/10.jpg" alt="preview image"></div><div id="single-page-container" class="mx-auto my-5 w-full rounded-b-lg px-5 md:max-w-6xl"><div class="flex w-full justify-between"><div id="post-container" class="w-full flex-grow"><div id="post-title" data-popover-target="popover-animation" data-popover-offset="0" data-popover-placement="bottom" class="flex flex-col py-5 pl-0 pr-1 md:py-8 md:pl-1 md:pr-3 lg:py-10 lg:pl-7 lg:pr-10"><div class="flex flex-row flex-wrap space-x-1 border-l-8 border-primary pb-2 pl-2 pt-1 font-Oswald text-sm font-normal tracking-wide text-gray-500/90 dark:text-gray-300"><span>Posted by June 3 2024</span>
<span class="flex flex-row space-x-1"><span class="text-primary">/ </span><a class="border-b-2 border-transparent hover:border-b-2 hover:border-primary hover:text-[#00adb5]" href="https://azr43lkn1ght.github.io/categories/malware-development/">Malware Development</a>
<span class="text-primary">/ </span><a class="border-b-2 border-transparent hover:border-b-2 hover:border-primary hover:text-[#00adb5]" href="https://azr43lkn1ght.github.io/categories/malware-analysis/">Malware Analysis</a>
<span class="text-primary">/ </span><a class="border-b-2 border-transparent hover:border-b-2 hover:border-primary hover:text-[#00adb5]" href="https://azr43lkn1ght.github.io/categories/dfir/">DFIR</a></span></div><div class="border-l-8 border-primary py-1 pl-2 text-start text-3xl font-bold tracking-wide text-black lg:text-4xl dark:text-white">Malware Development, Analysis and DFIR Series - Part III</div><div class="flex flex-row flex-wrap items-center space-x-1 border-l-8 border-primary pb-1 pl-2 pt-3.5 font-Oswald text-xs font-extralight tracking-wide text-gray-500/90 dark:text-gray-300"><span>Updated on June 3 2024</span><div class="h-1 w-1 rounded-full bg-primary"></div><span>3794 words</span><div class="h-1 w-1 rounded-full bg-primary"></div><span>18 minutes read</span><div class="h-1 w-1 rounded-full bg-primary"></div><p><span id="twikoo_visitors" class="page-info-pageview-count" data-path="/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/">...</span>
visits</p></div></div><div id="single-content" class="format mx-auto max-w-none px-1 py-5 md:format-base dark:format-invert format-figure:flex format-figure:flex-col format-figure:items-center format-img:cursor-zoom-in md:px-3 lg:px-10 dark:text-gray-300"><h1 class="group head-tag" id="malware-development-analysis-and-dfir-series">Malware Development, Analysis and DFIR Series<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#malware-development-analysis-and-dfir-series"></a></h1><h2 class="group head-tag" id="part-iii">PART III<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#part-iii"></a></h2><h3 class="group head-tag" id="introduction">Introduction<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#introduction"></a></h3><p>In this post, we will delve into windows memory internals, understand how memory is managed in windows as well as process internals. we wil also look into segmentation and its role in x86 memory address translation and why as well how it is ignored in x86_64.</p><p>First, Let’s discuss about the three fundamental memory models which are linear or flat, physical and segmented memory models and with this we have three modes of operation for the processor which are real mode, protected mode and System Management Mode (SMM).</p><h3 class="group head-tag" id="memory-models">Memory Models<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#memory-models"></a></h3><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-10.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><h4 class="group head-tag" id="physical-model">Physical model<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#physical-model"></a></h4><p>This model is where we are able write directly to the physical memory that is the RAM itself and exactly why it does not have any protection mechanisms and due to this if we run out of memory, the system will crash.</p><h4 class="group head-tag" id="flatlinear-model">Flat/Linear model<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#flatlinear-model"></a></h4><p>This model makes use of the concept of virtual memory. In this, the address space is a single contiguous address space and the operating system is responsible for mapping the virtual address to the physical address.</p><h4 class="group head-tag" id="segmented-model">Segmented model<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#segmented-model"></a></h4><p>This model builds upon the linear model by dividing the linear address space into distinct regions called segments. Here each address is represented by combining effective address and base address of a segment. The base address is stored in a special register called as the segment selector and the effective address is an offset into the segment referenced by the segment selector.</p><h4 class="group head-tag" id="paging-model">Paging model<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#paging-model"></a></h4><p>This model builds upon the flat/linear and segmented memory model. The operating system divides both physical memory (RAM) and logical memory (process address space) into fixed-size blocks called pages. These pages have the same size for both physical and logical memory. Despite Windows using a segmented memory mode, the details of the process address space are abstracted away from the developer. We will look deeper into it after few more basics.</p><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-9.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><h3 class="group head-tag" id="memory-modes">Memory Modes<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#memory-modes"></a></h3><h4 class="group head-tag" id="real-mode">Real Mode<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#real-mode"></a></h4><p>It is the first mode in which the processor is in when the computer first boots and which is before the operating system has been loaded. This then implements the segmented memory model and there is very limited memory protections and which makes it very easy to corrupt the system in this mode.Since the address space is limited to 20 bits and thus only 1MB of RAM is addressable. And each virtual address is split into two distinct parts: a 16-bit segment selector and a 16-bit offset. As we already discussed, the segment selector refers to the base address of the segment and the offset is the effective address which is used to index into that segment. This is then used to map to a physical memory address which is the RAM.</p><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-11.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><p>In real mode, the size of each register is limited to 16 bits. So most registers that are available in successor modes are not available. There are few register to note down including the segment registers as they are the most important ones when we use segmented memory model:</p><p>&lt;&gt; CS (Code Segment): Holds the starting address of the currently executing code segment.</p><p>&lt;&gt; DS (Data Segment): Points to the beginning of the currently used data segment. Most memory accesses for data operands use DS.</p><p>&lt;&gt; SS (Stack Segment): Defines the starting address of the stack segment.</p><p>&lt;&gt; ES (Extra Segment): Provides an additional segment register for programmers to use for various purposes.</p><p>&lt;&gt; GS and FS segments: Have no special meaning and are used by operating system as it so wishes but On Windows x86_64, the GS segment is used to store the base address of the thread environment block(TEB).</p><p>&lt;&gt; There are pointer registers, which are used to store the effective address (offsets) for a particular segment.</p><p>&lt;&gt; IP (Instruction Pointer): Holds the address of the currently executing instruction and is used in conjunction with the code segment.</p><p>&lt;&gt; SP (Stack Pointer): Holds the address of the top of the current stack frame and is thus used with the data segment.</p><p>&lt;&gt; BP (Base Pointer): Points to the bottom of the current stack frame and is used with the stack segment.</p><h4 class="group head-tag" id="protected-mode">Protected Mode<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#protected-mode"></a></h4><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-13.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><p>This is where the Segmented memory model is used but with paging added to it and provides additional meticulous memory protection. In 64 bit systems, this is extended further with the introduction of Long Mode. Long Mode sets the base address of all the segment registers (excluding GS and FS) to 0, which states that the address space is flat. let’s look into segmented protected mode without paging first.</p><p>The previously mentioned registers are no longer are used for address mapping to physical memory. Rather in x86 we have two registers which are:</p><p>global descriptor table register (GDTR): Contains the base address for the global descriptor table(GDT), each entry in the table is a segment descriptor which is used to describe a particular segment in the linear address space. The segment selector registers are used to index into the global descriptor table (GDT).</p><p>local descriptor table register (LDTR): It is not used on Windows so it is not discussed further.</p><p>The Segment selector stays 16 bit as in real mode but the effective address is extended to 32 bits instead. Base address is taken from the segment descriptor and combined with the effective address and the linear address is 32-bits, This is the reason why x86 operating systems are able to address up to 4GB of RAM.</p><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-8.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><h4 class="group head-tag" id="system-management-mode-smm">System Management Mode (SMM)<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#system-management-mode-smm"></a></h4><p>System Management Mode (SMM), also sometimes referred to as ring-2 (due to its privilege level), is a special operating mode found in x86 processors. It’s designed for low-level system management tasks handled by the firmware (BIOS or UEFI) and not by the operating system itself.</p><h3 class="group head-tag" id="memory-management">Memory Management<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#memory-management"></a></h3><h4 class="group head-tag" id="virtual-memory">Virtual Memory<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#virtual-memory"></a></h4><p>Virtual memory lets processes see a private, continuous memory space even with limited physical RAM. Programs can access the entire virtual address space as if everything is resident, but inactive pages are stored on disk. The memory manager and MMU work together to translate virtual addresses into physical addresses and handle page faults when needed. This creates a separation between the logical memory view and the physical memory reality. The virtual address space is typically divided between the operating system (kernel) and individual processes. Hardware support ensures memory isolation, preventing processes from interfering with each other’s memory.</p><h4 class="group head-tag" id="segmentation">Segmentation<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#segmentation"></a></h4><p>Intel IA-32 processors use segmentation for memory management. This divides the memory into variable-sized segments, each with its own descriptor defining location, size, and access permissions. Programs reference memory using a segment selector and an offset within that segment. The processor translates this into a physical address using the descriptor information.</p><p>While segmentation offers some advantages, modern operating systems typically create overlapping segments with a base address of zero. This effectively hides segmentation from programs and creates the illusion of a flat, continuous memory space. However, segmentation controls are still enforced for security, requiring separate segment descriptors for code and data access.</p><h4 class="group head-tag" id="paging">Paging<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#paging"></a></h4><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-12.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><p>Imagine a computer system with limited physical memory but the need to run programs that require much more. Paging comes to the rescue, creating a virtual address space that feels vast and contiguous to programs, even though it’s backed by a combination of physical RAM and disk storage. This technique breaks the 32-bit linear address space into fixed-sized chunks called pages. These pages can be loaded into physical memory in any order, providing flexibility and efficient memory utilization.</p><p>When a program tries to access a memory location, the address goes through a translation process. Special tables called page directories and page tables, stored in memory, act as a map for this translation. The page directory is like a main directory in a library, holding references to sub-directories (page tables). A special register (CR3) points to the page directory. To find the specific page directory entry (PDE) for the target memory location, the processor combines bits 31:12 from CR3 with bits 31:22 of the virtual address.</p><p>Each page directory entry points to a page table, which lists individual pages. Page tables reside in memory and are accessed using the PDE. Bits 31:12 from the PDE are combined with bits 21:12 of the virtual address to locate the relevant page table entry (PTE) for the specific page. Think of it like finding a specific book in the library using the sub-directory information. Finally, the MMU (Memory Management Unit) retrieves the physical frame number from the PTE and combines it with the remaining bits (11:0) of the virtual address to obtain the final physical address in memory. This physical address points to the actual location of the data in RAM.</p><p>Paging offers several benefits. By loading only actively used program sections (pages) into memory, the operating system can manage memory efficiently. Programs can operate under the illusion of having a large, contiguous memory space, simplifying memory management for developers. Additionally, paging enhances security and stability by allowing the operating system to control access permissions in the page tables, preventing processes from accessing each other’s memory.</p><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/intel-segmentation-and-paging.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><h4 class="group head-tag" id="demand-paging">Demand Paging<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#demand-paging"></a></h4><p>Demand paging is a key technique for virtual memory. It avoids loading entire processes into memory at once. Instead, it brings in only the pages that are actively being used, relying on the principle of locality of reference (frequently accessed memory locations tend to be clustered). This reduces memory load time and allows more processes to run concurrently. The operating system tracks which pages are in memory and triggers a “page fault” when a non-resident page is accessed. The OS then retrieves the needed page from the swap file (on disk) and handles the fault. Demand paging improves system performance and is invisible to running applications. However, it adds complexity to memory forensics because some data might reside on disk during memory analysis. In some cases, combining data from memory and disk can provide a more complete picture of virtual memory.</p><h4 class="group head-tag" id="shared-memory">Shared Memory<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#shared-memory"></a></h4><p>Shared memory is a feature in modern operating systems that allows processes to access the same memory region from their own virtual address spaces. Imagine two programs, A and B, having private memory spaces that overlap in a certain area. This overlap signifies that both programs are mapped to the same physical memory pages. This shared memory area provides a fast and efficient way for processes to communicate and exchange data, eliminating the need for slower methods like message passing.</p><p>Shared memory also helps conserve physical memory. Instead of each process having its own copy of frequently used data (like libraries), a single instance can be shared across processes. This reduces overall memory usage. Operating systems often employ a “copy-on-write” strategy for shared memory. Initially, processes share the same physical pages. If a process tries to modify the shared data, the memory manager creates a private copy of the page specifically for that process. This ensures data integrity for individual processes while optimizing memory usage. Shared memory and copy-on-write techniques are important for memory forensics. Since malicious software might exploit shared memory to alter program execution (e.g., modifying shared libraries).</p><h3 class="group head-tag" id="address-translation">Address Translation<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#address-translation"></a></h3><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-4.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><p>The linear address on x86 systems is divided into three distinct parts:</p><pre tabindex="0"><code style="font-size: large !important;">- Page Directory index
- Page Table Index
- Byte Offset 
</code><button class="codeblock-copy"><svg class="icon-copy" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
<path d="M731.428571 292.571429v658.285714H73.142857V292.571429h658.285714z m-73.142857 73.142857H146.285714v512h512V365.714286z m292.571429-292.571429v585.142857h-146.285714v-73.142857h73.142857V146.285714H438.857143v73.142857h-73.142857V73.142857h585.142857z"></path>
</svg></button></pre><p>This gives a three-level paging structure. Each page on a x86 system is either 4KB or considered a large page which comprises of a 4MB page, these large pages are only enabled if the page size extension (PSE) bit is enabled in the CR4 register. The only distinguishable difference between the two, is that a large page address does not have a page table index and its offset is extended from 12-bit to 22-bits.</p><p>The same applies to x86_64 systems but since physical address extension (PAE) is enabled by default in order to increase the addressable amount of memory, the linear address changes slightly and is extended but usually limited to 48 bits on most operating systems to make paging simpler to manage. This provides a paging hierarchy of four levels.</p><p>In x86, the page directory index is 10 bits; the page table index is 10 bits and the byte offset is 12 bits. The page directory index – as the name implies – contains an index into the page directory which is an array of page directory entries (PDEs). The page directory differs between different processes but the physical address can always be found in the CR3 register. The page directory consists of 1024 page directory entries, all of which are 32 bits (4 bytes) in length. Each page directory entry will point to a page table which in turn consists of 1024 4-byte entries known as page table entries (PTEs). This PTE is very similar to a PDE but instead of referring to a page table, will point to the base physical address of the associated page; the page offset is then applied to this base address to find the physical address which the PTE corresponds to.</p><p><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image.png" alt="alt text" loading="lazy">
The above figure is for 4kb pages.</p><p><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-1.png" alt="alt text" loading="lazy">
The above figure is for 4mb pages.</p><p>in x86_64, the linear address being 64-bits in length, only 48-bits of that linear address is addressable by the operating system! This restriction means that all addresses on must be canonical: the upper 14-bits must be either all 0s or all 1s. The 48th bit (bit 47) determines what the other upper bits will be set to: if it is set to 1, then the rest must be 1s otherwise the rest must be 0s if it has been set to 0.</p><p>The linear address is then broken in the following parts:</p><pre tabindex="0"><code style="font-size: large !important;">- 14-bit sign extension 
- 9-bit page-map level-4 offset (PML4) 
- 9-bit page directory pointer index (PDPT)
- 9-bit page directory index (PDE)
- 9-bit page table index (PTE) 
- 12-bit byte offset.
</code><button class="codeblock-copy"><svg class="icon-copy" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
<path d="M731.428571 292.571429v658.285714H73.142857V292.571429h658.285714z m-73.142857 73.142857H146.285714v512h512V365.714286z m292.571429-292.571429v585.142857h-146.285714v-73.142857h73.142857V146.285714H438.857143v73.142857h-73.142857V73.142857h585.142857z"></path>
</svg></button></pre><p><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-2.png" alt="alt text" loading="lazy">
above image is for 4kb paging for 4 level paging.</p><p>The CR3 register no longer references the physical address of a page directory but rather the physical address of the PML4 table instead, specifically, the bits 12 to 51 of the CR3 register are used. All the paging tables now store 512 entries each respectively, with each entry being extended to 64 bits (8 bytes), although, only 40 bits is actually used for indexing into the other tables. The DirectoryTableBase field of the _EPROCESS structure now refers to the PML4 rather than the page directory table.</p><p>The PML4 table consists of 512 PML4 entries, the PML4 index from the linear address is multiplied by 8 bytes – remember each PML4E is 8 bytes in length – and then added to the base address found in the CR3 register. This means that the PML4 table can address up to 512GB of physical memory. Similarly, bits 12-51 of the PML4E contain the physical address of a PDPT, we use the same process as before to find the PDPTE: take the index into the PDPT from the linear address then multiply by 8 bytes, which when combined with the physical address allows us to locate the corresponding PDPTE. This maps up to 1GB of physical memory.</p><p>To find the address of the page directory table entry, we take the PDE index multiply that by 8 bytes then use that with bits 12-51 of the PDPTE. This is assuming that the PS flag (bit 7) of the PDPTE has been set to 0. If the flag were to be set to 1, then we would use combine bits 30-51 and bits 0-29 from the linear address in order to find the physical address. This only applies to 1GB pages. And in the more common case, the PS flag will be set to 0, and the PDE will be used to find the corresponding PTE using a similar process. If the PS flag were to be set to 1, then the PDE would point to a large page (2MB) directly.</p><p><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-3.png" alt="alt text" loading="lazy">
The above image is for 2mb paging for 4 level paging.</p><h3 class="group head-tag" id="process-internals">Process Internals<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#process-internals"></a></h3><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-5.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><p>At the center is the _EPROCESS, which is the name of the structure that Windows uses to represent a process. Although the structure names certainly differ among different operating systems share the same concepts that are described in this high-level diagram. They all have one or more threads that execute code, and they all have a table of handles to kernel objects such as files, network sockets, and mutexes. Each process has its own private virtual memory space that’s isolated from other processes. Inside this memory space, you can find the process executable, its list of loaded modules, and its stacks, heaps, and allocated memory regions containing everything from user input to application-specific data structures. each _EPROCESS points to a list of security identifiers and privilege data. This is one of the primary ways the kernel enforces security and access control</p><p>The _EPROCESS structure contains a _LIST_ENTRY structure called ActiveProcessLinks. The _LIST_ENTRY structure contains two members: a Flink (forward link) that points to the _LIST_ENTRY of the next _EPROCESS structure, and the Blink (backward link) that points to the _LIST_ENTRY of the previous _EPROCESS structure.</p><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-6.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><h4 class="group head-tag" id="process-environment-block-peb">Process Environment Block (PEB)<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#process-environment-block-peb"></a></h4><p>_EPROCESS contains a pointer to the Process Environment Block (PEB). Although the member (_EPROCESS.Peb) exists in kernel mode, it points to an address in user mode. The PEB contains pointers to the process’s DLL lists, current working directory, command line arguments, environment variables, heaps, and standard handles.</p><h4 class="group head-tag" id="process-control-bloackpcb">Process Control Bloack(PCB)<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#process-control-bloackpcb"></a></h4><p>The kernel’s process control block (_KPROCESS). This structure is found at the base of _EPROCESS and contains several critical fields, including the DirectoryTableBase for address translation and the amount of time the process has spent in kernel mode and user mode.</p><h4 class="group head-tag" id="process-tokens">Process Tokens<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#process-tokens"></a></h4><p>A process’s token describes its security context. This context includes security identifiers (SIDs) of users or groups that the process is running as and the various privileges (specific tasks) that it is allowed to perform.</p><p>A process’s token contains numerical SID values that you can translate into a string and then resolve into a user or group name. This ultimately enables you to determine the primary user account under which a process is running</p><p>When the kernel needs to decide whether a process can access an object or call a particular API, it consults data in the process’s token. As a result, this structure dictates many of the security-related controls that involve processes.</p><h4 class="group head-tag" id="process-handles">Process Handles<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#process-handles"></a></h4><p>A handle is a reference to an open instance of a kernel object, such as a file, registry key, mutex, process, or thread. By enumerating and analyzing the specific objects a process is accessing or has handles to, we can predict what process was reading or writing a particular file, what process accessed one of the registry keys, and which process mapped remote file systems. For a process to access an object, it must open a handle to the object by calling WinAPI that helps us such as CreateFile, RegOpenKeyEx, or CreateMutex. These APIs return a special Windows data type called HANDLE, which is simply an index into a process-specific handle table.</p><p>if we use CreateFile, a pointer to the corresponding _FILE_OBJECT in kernel memory is placed in the first available slot in the calling process’s handle table, and the respective index (such as 0x40) is returned. So normally Read or Write is done by</p><pre tabindex="0"><code style="font-size: large !important;">- Finding the base address of the calling process’s handle table
- Go to index of the handle
- Retrieve the _FILE_OBJECT pointer from the table
- Proceed with the read or write operation
</code><button class="codeblock-copy"><svg class="icon-copy" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
<path d="M731.428571 292.571429v658.285714H73.142857V292.571429h658.285714z m-73.142857 73.142857H146.285714v512h512V365.714286z m292.571429-292.571429v585.142857h-146.285714v-73.142857h73.142857V146.285714H438.857143v73.142857h-73.142857V73.142857h585.142857z"></path>
</svg></button></pre><h4 class="group head-tag" id="process-threads">Process Threads<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#process-threads"></a></h4><p>A thread is the basic unit of CPU utilization and execution. A thread is often characterized by a thread ID, CPU register set, and execution stack(s), which help define a thread’s execution context. A process with multiple threads can appear to be simultaneously performing multiple tasks.</p><h4 class="group head-tag" id="process-memory-layout">Process Memory Layout<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#process-memory-layout"></a></h4><figure class="data-image-info"><img class="data-image" src="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/image-7.png" alt="alt text" loading="lazy"><figcaption></figcaption></figure><p>The positions as well as it’s ranges are not constant especially in the case of ASLR (Address Space Layout Randomization). The thread stacks can exist below or above the process executable, or the ranges containing mapped files can be interspersed throughout the entire process space, not gathered contiguously.</p><p>&lt;&gt; DLLs: shared libraries (DLLs) that were loaded into the address space, either intentionally by the process or forcefully
through DLL injection.</p><p>&lt;&gt; Environment variables: This range of memory stores the process’s environment variables, such as its executable paths, temporary directories, home folders, etc..</p><p>&lt;&gt; Process Environment Block(PEB): Contains the process’s command line arguments, its current working directory, and its standard handles as well as location to several of the other items in this list, including the DLLs, heaps, and environment variables.</p><p>&lt;&gt; Process heaps: Where you can find a majority of the dynamic input that the process receives.</p><p>&lt;&gt; Thread stacks: Each thread has a dedicated range of process memory set aside for its runtime stack. This is where you can find function arguments, return addresses, local variables, etc..</p><p>&lt;&gt; Mapped files and application data: Mapped files represent content from files on disk, which could be configuration data, documents,etc, Application data is anything the process needs to perform its intended duties.</p><p>&lt;&gt; Executable: The process executable contains the primary body of code and read/write variables for the application. This data may be compressed/encrypted/packed/crypted on disk, but once loaded into memory, it unpacks, enabling you to dump original/relaible code back to disk.</p><h4 class="group head-tag" id="process-page-tables">Process Page Tables<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#process-page-tables"></a></h4><p>we can leverage page tables to map virtual addresses in process memory to physical offsets in RAM, determine what pages are swapped to disk, and analyze the hardware-based permissions applied to the pages.</p><h4 class="group head-tag" id="virtual-address-descriptorvad">Virtual Address Descriptor(VAD)<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#virtual-address-descriptorvad"></a></h4><p>VADs are structures defined by Windows to track reserved or committed, virtually contiguous collections of pages. If a page is 4KB and a process commits 10 pages at the same time, a VAD is created in kernel memory that describes the 40KB range of memory. If the region contains a memory-mapped file, the VAD also stores information about the file’s path.</p><p>A process’s VAD tree describes the layout of its memory segments at a slightly higher level than the page tables. The operating system defines and maintains these data structures. VADs contain the names of memory-mapped files, the total number of pages in the region, the initial protection (read, write, execute), and several other flags that can tell you a lot about what type of data the regions contain.</p><h3 class="group head-tag" id="conclusion">Conclusion<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#conclusion"></a></h3><p>In this post, we have discussed the three fundamental memory models which are linear or flat, physical and segmented memory models and with this we have three modes of operation for the processor which are real mode, protected mode and System Management Mode (SMM). We have also discussed about the memory management in windows and how the address translation is done in x86 and x86_64 systems. We have also discussed about the process internals and how the memory layout is done in a process.</p><h3 class="group head-tag" id="contact-me">Contact me?<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#contact-me"></a></h3><p>Azr43lKn1ght |
<a href="https://twitter.com/Azr43lKn1ght" target="_blank">twitter</a>
|
<a href="https://www.linkedin.com/in/azr43lkn1ght?utm_source=share&amp;utm_campaign=share_via&amp;utm_content=profile&amp;utm_medium=android_app" target="_blank">Linkedin</a>
|
<a href="https://github.com/Azr43lKn1ght" target="_blank">github</a></p><h4 class="group head-tag" id="references">References<a data-title-of-head="" class="group-hover:after:content-['__#'] no-underline hover:text-blue-700" href="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/#references"></a></h4><ul><li>The Art of Memory Forensics,</li><li>Microsoft Windows Internals and MSDN,</li><li>The Malware Cookbook,</li><li>bsodtutorials,</li><li>Practical Malware Analysis,</li><li>sysforensics,</li><li>volatility Labs.</li></ul></div><div class="flex flex-col justify-start px-1 pb-5 pt-1 md:px-3 lg:flex-row lg:justify-between lg:px-10"><div class="flex flex-row flex-wrap items-center"><a class="mx-1 my-0.5 rounded-lg border border-gray-200 px-1.5 py-1 text-center text-xs text-gray-600 hover:bg-gray-100 dark:border-gray-500 dark:text-gray-200 dark:hover:bg-gray-600" href="https://azr43lkn1ght.github.io/tags/malware-analyis/">Malware Analyis</a>
<a class="mx-1 my-0.5 rounded-lg border border-gray-200 px-1.5 py-1 text-center text-xs text-gray-600 hover:bg-gray-100 dark:border-gray-500 dark:text-gray-200 dark:hover:bg-gray-600" href="https://azr43lkn1ght.github.io/tags/malware-development/">Malware Development</a>
<a class="mx-1 my-0.5 rounded-lg border border-gray-200 px-1.5 py-1 text-center text-xs text-gray-600 hover:bg-gray-100 dark:border-gray-500 dark:text-gray-200 dark:hover:bg-gray-600" href="https://azr43lkn1ght.github.io/tags/dfir/">DFIR</a>
<a class="mx-1 my-0.5 rounded-lg border border-gray-200 px-1.5 py-1 text-center text-xs text-gray-600 hover:bg-gray-100 dark:border-gray-500 dark:text-gray-200 dark:hover:bg-gray-600" href="https://azr43lkn1ght.github.io/tags/malware/">Malware</a>
<a class="mx-1 my-0.5 rounded-lg border border-gray-200 px-1.5 py-1 text-center text-xs text-gray-600 hover:bg-gray-100 dark:border-gray-500 dark:text-gray-200 dark:hover:bg-gray-600" href="https://azr43lkn1ght.github.io/tags/memory-forensics/">Memory Forensics</a></div></div></div></div></div><div data-dial-init="" class="group fixed bottom-24 end-8 md:end-20"><div id="speed-dial-menu-bottom-right" class="mb-4 flex hidden flex-col items-center space-y-2"><button id="to-top-button" type="button" data-tooltip-target="tooltip-top" data-tooltip-placement="left" class="flex h-[52px] w-[52px] items-center justify-center rounded-full border border-gray-200 bg-white text-gray-500 shadow-sm hover:bg-gray-50 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 dark:hover:text-white dark:focus:ring-gray-400 hidden">
<svg class="h-5 w-5" aria-hidden="true" fill="currentcolor" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M629.333333 853.333333H394.666667c-17.066667.0-32 14.933333-32 32s14.933333 32 32 32h234.666666c17.066667.0 32-14.933333 32-32s-14.933333-32-32-32zm213.333334-492.8-307.2-247.466666c-12.8-8.533333-27.733333-8.533333-40.533334.0L183.466667 360.533333c-6.4 6.4-12.8 14.933333-12.8 23.466667.0 2.133333.0 6.4 2.133333 8.533333 2.133333 12.8 14.933333 21.333333 27.733333 21.333334h155.733334v236.8c0 19.2 12.8 29.866667 32 29.866666h249.6c21.333333.0 34.133333-12.8 34.133333-29.866666V416h151.466667c12.8.0 25.6-8.533333 27.733333-21.333333s0-25.6-8.533333-34.133334zM629.333333 746.666667H394.666667c-17.066667.0-32 14.933333-32 32s14.933333 32 32 32h234.666666c17.066667.0 32-14.933333 32-32s-14.933333-32-32-32z"></path></svg>
<span class="sr-only">Top</span></button><div id="tooltip-top" role="tooltip" class="tooltip invisible absolute z-10 inline-block w-auto rounded-lg bg-gray-900 px-3 py-2 text-sm font-medium text-white opacity-0 shadow-sm transition-opacity duration-300 dark:bg-gray-700" data-popper-placement="right" style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate(57px, 5863px);">Top<div class="tooltip-arrow" data-popper-arrow="" style="position: absolute; top: 0px; transform: translate(0px, 9px);"></div></div><button type="button" data-tooltip-target="tooltip-toc" data-tooltip-placement="left" data-drawer-target="drawer-body-scrolling-toc" data-drawer-show="drawer-body-scrolling-toc" data-drawer-body-scrolling="true" aria-controls="drawer-body-scrolling-toc" class="flex h-[52px] w-[52px] items-center justify-center rounded-full border border-gray-200 bg-white text-gray-500 shadow-sm hover:bg-gray-50 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 dark:hover:text-white dark:focus:ring-gray-400">
<svg class="h-5 w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentcolor" viewBox="0 0 1024 1024"><path d="M901.8 313.5H354.4c-32 0-58.2-26.2-58.2-58.2v-18.1c0-32 26.2-58.2 58.2-58.2h547.4c32 0 58.2 26.2 58.2 58.2v18.1c0 32-26.2 58.2-58.2 58.2z"></path><path d="M131.3 246.2m-67.3.0a67.3 67.3.0 10134.6.0 67.3 67.3.0 10-134.6.0z"></path><path d="M901.8 579.3H354.4c-32 0-58.2-26.2-58.2-58.2V503c0-32 26.2-58.2 58.2-58.2h547.4c32 0 58.2 26.2 58.2 58.2v18.1c0 32-26.2 58.2-58.2 58.2z"></path><path d="M131.3 512M64 512a67.3 67.3.0 10134.6.0A67.3 67.3.0 1064 512z"></path><path d="M901.8 845.1H354.4c-32 0-58.2-26.2-58.2-58.2v-18.1c0-32 26.2-58.2 58.2-58.2h547.4c32 0 58.2 26.2 58.2 58.2v18.1c0 32-26.2 58.2-58.2 58.2z"></path><path d="M131.3 777.8m-67.3.0a67.3 67.3.0 10134.6.0 67.3 67.3.0 10-134.6.0z"></path></svg>
<span class="sr-only">Catelog</span></button><div id="tooltip-toc" role="tooltip" class="tooltip invisible absolute z-10 inline-block w-auto rounded-lg bg-gray-900 px-3 py-2 text-sm font-medium text-white opacity-0 shadow-sm transition-opacity duration-300 dark:bg-gray-700" data-popper-placement="right" style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate(123px, 5850px);">Catelog<div class="tooltip-arrow" data-popper-arrow="" style="position: absolute; top: 0px; transform: translate(0px, 9px);"></div></div><button type="button" data-drawer-target="drawer-body-scrolling" data-drawer-show="drawer-body-scrolling" data-drawer-body-scrolling="true" aria-controls="drawer-body-scrolling" data-tooltip-target="tooltip-tags" data-tooltip-placement="left" class="flex h-[52px] w-[52px] items-center justify-center rounded-full border border-gray-200 bg-white text-gray-500 shadow-sm hover:bg-gray-50 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 dark:hover:text-white dark:focus:ring-gray-400">
<svg class="h-5 w-5" aria-hidden="true" fill="currentcolor" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M96.512 454.272h839.84a78.752 78.752.0 0178.752 78.752v8.704a78.752 78.752.0 01-78.752 78.752H96.512A78.752 78.752.0 0117.76 541.728v-8.704a78.752 78.752.0 0178.752-78.752zm475.36-221.6H904.32a55.424 55.424.0 010 110.848H571.872a55.424 55.424.0 010-110.848zM350.208 731.36h332.448a55.424 55.424.0 010 110.848H350.208a55.424 55.424.0 010-110.848zM128.544 177.248h221.664a55.424 55.424.0 010 110.848H128.544a55.424 55.424.0 010-110.848z" p-id="22696"></path></svg>
<span class="sr-only">Tags</span></button><div id="tooltip-tags" role="tooltip" class="tooltip invisible absolute z-10 inline-block w-auto rounded-lg bg-gray-900 px-3 py-2 text-sm font-medium text-white opacity-0 shadow-sm transition-opacity duration-300 dark:bg-gray-700" data-popper-placement="left" style="position: absolute; inset: 0px 0px auto auto; margin: 0px; transform: translate(-1813px, 5859px);">Tags<div class="tooltip-arrow" data-popper-arrow="" style="position: absolute; top: 0px; transform: translate(0px, 9px);"></div></div><button id="to-bottom-button" type="button" data-tooltip-target="tooltip-bottom" data-tooltip-placement="left" class="flex h-[52px] w-[52px] items-center justify-center rounded-full border border-gray-200 bg-white text-gray-500 shadow-sm hover:bg-gray-50 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 dark:hover:text-white dark:focus:ring-gray-400 hidden">
<svg class="h-5 w-5" aria-hidden="true" fill="currentcolor" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M635.733333 341.333333c19.2.0 32 12.8 32 29.866667V608h155.733334c12.8.0 25.6 8.533333 27.733333 21.333333 2.133333 4.266667 2.133333 6.4 2.133333 10.666667.0 8.533333-6.4 19.2-12.8 25.6L529.066667 910.933333c-12.8 8.533333-27.733333 8.533333-40.533334.0l-307.2-247.466666c-8.533333-8.533333-12.8-21.333333-8.533333-34.133334C174.933333 616.533333 187.733333 608 200.533333 608H352V371.2c0-19.2 12.8-29.866667 34.133333-29.866667h249.6zm-6.4-128c17.066667.0 32 14.933333 32 32s-14.933333 32-32 32H394.666667c-17.066667.0-32-14.933333-32-32s14.933333-32 32-32h234.666666zm0-106.666666c17.066667.0 32 14.933333 32 32s-14.9333330000001 32-32 32H394.666667c-17.066667.0-32-14.933333-32-32S377.6 106.666667 394.666667 106.666667h234.666666z"></path></svg>
<span class="sr-only">Bottom</span></button><div id="tooltip-bottom" role="tooltip" class="tooltip invisible absolute z-10 inline-block w-auto rounded-lg bg-gray-900 px-3 py-2 text-sm font-medium text-white opacity-0 shadow-sm transition-opacity duration-300 dark:bg-gray-700" data-popper-placement="left" style="position: absolute; inset: 0px 0px auto auto; margin: 0px; transform: translate(-1766px, 5852px);">Bottom<div class="tooltip-arrow" data-popper-arrow="" style="position: absolute; top: 0px; transform: translate(0px, 9px);"></div></div></div><button type="button" data-dial-toggle="speed-dial-menu-bottom-right" aria-controls="speed-dial-menu-bottom-right" aria-expanded="false" class="flex h-14 w-14 items-center justify-center rounded-full bg-primary text-white hover:bg-primary700 focus:outline-none focus:ring-4 focus:ring-primary dark:bg-primary dark:hover:bg-primary700 dark:focus:ring-primary700">
<svg class="h-5 w-5 transition-transform group-hover:rotate-45" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 18"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 1v16M1 9h16"></path></svg>
<span class="sr-only">Open actions menu</span></button></div><div id="drawer-body-scrolling" class="fixed left-0 top-0 z-40 h-screen w-64 -translate-x-full overflow-y-auto bg-white p-4 transition-transform md:w-80 lg:w-96 dark:bg-gray-800" tabindex="-1" aria-labelledby="drawer-body-scrolling-label" aria-hidden="true"><h5 id="drawer-body-scrolling-label" class="text-base font-semibold uppercase text-gray-500 dark:text-gray-400">TAGS</h5><button type="button" data-drawer-hide="drawer-body-scrolling" aria-controls="drawer-body-scrolling" class="absolute end-2.5 top-2.5 inline-flex h-8 w-8 items-center justify-center rounded-lg bg-transparent text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900 dark:hover:bg-gray-600 dark:hover:text-white">
<svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path></svg>
<span class="sr-only">Close tags</span></button><div class="overflow-y-auto py-3"><div class="flex flex-wrap justify-center gap-2 p-3"><a href="https://azr43lkn1ght.github.io/tags/bi0sctf/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Bi0sCTF</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">3</span>
</a><a href="https://azr43lkn1ght.github.io/tags/bi0sctf2024/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Bi0sctf2024</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">2</span>
</a><a href="https://azr43lkn1ght.github.io/tags/blockchain-forensics/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Blockchain Forensics</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/browser-forensics/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Browser Forensics</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/dfir/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">DFIR</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">4</span>
</a><a href="https://azr43lkn1ght.github.io/tags/file-forensics/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">File Forensics</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/incident-response/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Incident Response</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">5</span>
</a><a href="https://azr43lkn1ght.github.io/tags/mac-artefact-analysis/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">MAC Artefact Analysis</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/malware/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Malware</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">4</span>
</a><a href="https://azr43lkn1ght.github.io/tags/malware-analyis/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Malware Analyis</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">4</span>
</a><a href="https://azr43lkn1ght.github.io/tags/malware-analysis/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Malware Analysis</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">4</span>
</a><a href="https://azr43lkn1ght.github.io/tags/malware-development/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Malware Development</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">4</span>
</a><a href="https://azr43lkn1ght.github.io/tags/memory-forensics/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Memory Forensics</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">3</span>
</a><a href="https://azr43lkn1ght.github.io/tags/password-retrieval/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Password Retrieval</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/process-memory-analysis/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Process Memory Analysis</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/ransomware/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Ransomware</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">2</span>
</a><a href="https://azr43lkn1ght.github.io/tags/ransomware-analysis/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Ransomware Analysis</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">2</span>
</a><a href="https://azr43lkn1ght.github.io/tags/ransomware-investigation/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Ransomware Investigation</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/ransomware-investigtion/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Ransomware Investigtion</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/ransomware-recovery/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Ransomware Recovery</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">2</span>
</a><a href="https://azr43lkn1ght.github.io/tags/reverse-engineering/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Reverse Engineering</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">2</span>
</a><a href="https://azr43lkn1ght.github.io/tags/rootkit-analysis/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Rootkit Analysis</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">1</span>
</a><a href="https://azr43lkn1ght.github.io/tags/threat-hunting/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Threat Hunting</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">3</span>
</a><a href="https://azr43lkn1ght.github.io/tags/windbg-dump-debugging/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">WinDBG Dump Debugging</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">3</span>
</a><a href="https://azr43lkn1ght.github.io/tags/windows-forensics/" class="group flex items-center rounded-lg border p-2 text-xs text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"><span class="flex-1 whitespace-nowrap">Windows Forensics</span>
<span class="ms-2 inline-flex h-2 w-2 items-center justify-center rounded-full bg-blue-100 p-2 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">3</span></a></div></div></div><div id="drawer-body-scrolling-toc" class="fixed left-0 top-0 z-40 h-screen w-64 -translate-x-full overflow-y-auto bg-white p-4 transition-transform dark:bg-gray-800 md:w-80 lg:w-96" tabindex="-1" aria-labelledby="drawer-body-scrolling-toc-label" aria-hidden="true"><h5 id="drawer-body-scrolling-toc-label" class="text-base font-semibold text-gray-500 dark:text-gray-400">On this page</h5><button type="button" data-drawer-hide="drawer-body-scrolling-toc" aria-controls="drawer-body-scrolling-toc" class="absolute end-2.5 top-2.5 inline-flex h-8 w-8 items-center justify-center rounded-lg bg-transparent text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900 dark:hover:bg-gray-600 dark:hover:text-white">
<svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path></svg>
<span class="sr-only">Close menu</span></button><div class="overflow-y-auto py-4"></div></div><div id="search-overlay" class="fixed inset-0 z-50 hidden bg-gray-900/90 backdrop-blur-lg dark:bg-gray-900/80"></div><section id="search-section" class="z-50 flex hidden h-dvh w-full flex-col"><div class="flex h-dvh w-full flex-col overflow-auto md:mx-auto md:w-2/3 lg:max-w-2xl"><div id="searchBoxDiv" class="sticky top-[-88px] z-50 flex flex-row justify-between px-8 pt-[88px]"><div id="searchBox" class="my-6 flex w-full flex-row items-center"><div class="ais-SearchBox"><form action="https://azr43lkn1ght.github.io/Malware%20Development,%20Analysis%20and%20DFIR%20Series%20-%20Part%20III/" role="search" class="ais-SearchBox-form" novalidate=""><input class="ais-SearchBox-input" type="search" placeholder=" Search for content" autofocus="true" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query."><svg t="1687792593023" class="ais-SearchBox-submitIcon" viewBox="0 0 1269 1024" version="1.1" width="10" height="10"><path d="M990.28992 695.0912l254.19776 165.56032-83.39456 128.8192-246.784-160.768A511.09888 511.09888 0 0 1 512 1024C229.21216 1024 0 794.78784 0 512S229.21216 0 512 0 1024 229.21216 1024 512a510.7712 510.7712 0 0 1-33.71008 183.0912zM512 153.6a358.4 358.4 0 1 0 0 716.8 358.4 358.4 0 0 0 0-716.8z" p-id="12490"></path></svg></button><button class="ais-SearchBox-reset" type="reset" title="Clear the search query."><svg class="ais-SearchBox-resetIcon" viewBox="0 0 20 20" width="10" height="10" aria-hidden="true"><path d="M8.114 10L.944 2.83 0 1.885 1.886 0l.943.943L10 8.113l7.17-7.17.944-.943L20 1.886l-.943.943-7.17 7.17 7.17 7.17.943.944L18.114 20l-.943-.943-7.17-7.17-7.17 7.17-.944.943L0 18.114l.943-.943L8.113 10z"></path></svg></button><span class="ais-SearchBox-loadingIndicator"><svg class="ais-SearchBox-loadingIcon" width="16" height="16" viewBox="0 0 38 38" stroke="#444" aria-hidden="true"><g fill="none" fillrule="evenodd"><g transform="translate(1 1)" strokewidth="2"><circle strokeopacity=".5" cx="18" cy="18" r="18"></circle><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform></path></g></g></svg></span></form></div></div></div><div class="h-[30rem] overflow-auto"><div id="searchResults" class="my-3 px-6" style="display: none;"></div><div id="NotSearchResults" class="flex-col items-center justify-around space-y-4 px-6 py-10 flex"><p class="font-Oswald text-lg font-bold tracking-wide text-gray-500">No search content</p></div><div id="searchError" class="hidden flex-col items-center justify-around space-y-4 px-6 py-10 text-center"><p class="font-Oswald text-lg font-bold text-red-500">Oop ! Error occur ...</p></div><div id="searchLoading" class="hidden flex-col items-center justify-around px-6 py-10"><svg t="1689331200868" class="icon animate-spin" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="51409" width="128" height="128"><path d="M512 170.666667V256A256 256 0 11288.426667 387.2l-74.496-41.6A341.333333 341.333333.0 10512 170.666667z" fill="#bfbfbf" opacity=".3" p-id="51410"></path></svg></div></div></div><div class="bottom-0 flex flex-col items-center justify-center space-y-2 py-8 font-Oswald text-xs font-bold text-gray-600"><div class="hidden md:block">Press ESC to cancle</div><div class="flex items-center"><span>Powered by &nbsp;</span>
<img src="https://azr43lkn1ght.github.io/images/default/algolia-logo.svg" alt="" class="h-4" width="300" height="150"></div></div></section></body></html>