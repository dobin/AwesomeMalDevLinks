Title:
Shellcodes are dead, long live Fileless Shellcodes

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post analyzes why embedding raw/encrypted shellcode inside a loader is increasingly caught by static signatures (e.g., Defender flagging Cobalt Strike/Meterpreter-like byte patterns and API-hash constants).  
- It demonstrates using ThreatCheck and Ghidra to locate “bad bytes” and attributes detections to well-known Cobalt Strike/Meterpreter shellcode traits such as default API hashing values.  
- As mitigations, it discusses randomizing/encoding API hashes (e.g., ror13-based dynamic hash encoding) and shifting to “fileless” delivery by downloading shellcode at runtime over HTTP to avoid storing high-entropy/signatured blobs in the PE .text section.  
- The implementation uses WinHTTP to fetch the payload in chunks into a buffer, then places it on the heap, optionally XOR-encrypting it in memory.  
- It also proposes heap-wide XOR “encryption” via HeapWalk over busy heap entries to hinder basic heap inspection during analysis.  
- Useful for red teamers/pentesters building loaders and for defenders understanding common evasion patterns around shellcode staging and in-memory obfuscation.

Technical Focus:
- Static signature evasion for Cobalt Strike/Meterpreter shellcode
- API hashing and hash randomization/encoding (ror13)
- Fileless payload staging via WinHTTP (WinHttpOpen/Connect/OpenRequest/ReadData)
- Entropy-based heuristics and PE section content considerations
- Heap-resident payload handling and XOR obfuscation
- Heap enumeration with HeapWalk / PROCESS_HEAP_ENTRY

Use Cases:
- Building a staged shellcode loader that retrieves payloads over HTTP at runtime
- Reducing static detections by avoiding embedded shellcode blobs in PE sections
- Modifying/encoding API-hash constants to break known shellcode signatures
- Basic in-memory obfuscation of heap buffers to complicate triage/debugging
- Defensive hunting: detecting WinHTTP-based staging + heap-walk encryption patterns

Keywords:
Cobalt Strike, Meterpreter, shellcode loader, static detection, Windows Defender, ThreatCheck, Ghidra, API hashing, ror13, hash randomization, fileless, WinHTTP, WinHttpOpen, WinHttpReadData, entropy, PE .text section, heap, HeapWalk, PROCESS_HEAP_ENTRY, XOR encryption