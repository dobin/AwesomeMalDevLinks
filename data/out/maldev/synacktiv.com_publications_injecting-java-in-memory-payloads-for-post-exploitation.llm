Title:
Injecting Java in-memory payloads for post-exploitation

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes practical techniques to load and run Java payloads purely in-memory inside compromised Java web applications to enable stealthy post-exploitation (no dropped webshell/JAR on disk beyond what’s needed to trigger loading).  
- It demonstrates three initial access/RCE paths—command injection (Bitbucket Data Center CVE-2022-36804), scripting engine execution (Jenkins Groovy console / RCE chains), and SSTI/OGNL injection (Confluence Data Center CVE-2023-22527)—then pivots into runtime backdooring.  
- Core methods include attaching a Java agent via the Attach API/Instrumentation, defining new classes through the target application’s ClassLoader, and registering in-memory request interceptors (Tomcat Valves, Jetty Filters).  
- The payloads are extended into post-exploitation capabilities such as enumerating admins via internal services/beans, minting “remember-me” cookies for account takeover, and intercepting plaintext credentials from login endpoints.  
- It also covers operational caveats (missing tools.jar/libattach on some JRE installs, Java 9+ classloader changes, Hibernate session binding) and provides a brief detection angle using class-dumping/heuristics (copagent).  
- Useful for red teams and offensive researchers building stealthy Java persistence/backdoors; also relevant to defenders hunting in-memory webshell behavior in Java app servers.

Technical Focus:
- JVM Instrumentation & Java Agents (agentmain), Attach API (com.sun.tools.attach)
- In-memory class injection via ClassLoader/ByteArrayClassLoader and bytecode loading
- Web request interception primitives (Tomcat Valve, Jetty Servlet Filter)
- Spring/Hibernate internals abuse (WebApplicationContext beans, session binding)
- OGNL/Velocity SSTI exploitation and sandbox bypass (MethodInvocationUtils)
- Post-exploitation in Atlassian/Jenkins internals (remember-me tokens, credential interception)

Use Cases:
- Deploy an in-memory Java agent/backdoor after RCE without writing a traditional webshell
- Intercept and manipulate HTTP traffic inside embedded Tomcat/Jetty
- Enumerate privileged users and internal application data via Spring beans / product APIs
- Generate valid remember-me cookies/tokens to impersonate arbitrary users
- Capture plaintext credentials from application login flows for lateral movement
- Blue-team validation: test detection of in-memory implants via class extraction tools (copagent)

Keywords:
Java agent, Instrumentation API, Attach API, com.sun.tools.attach.VirtualMachine, agentmain, ClassLoader, defineClass, ByteArrayClassLoader, Tomcat Valve, org.apache.catalina.valves.ValveBase, Jetty WebAppContext, Servlet Filter, Spring WebApplicationContext, Spring SecurityContextHolder, Hibernate SessionFactory, TransactionSynchronizationManager, remember-me cookie, OGNL, Velocity template injection, CVE-2022-36804, CVE-2023-22527, Jenkins Groovy console, SYSTEM2, copagent