Title:
ImmoralFiber (PoisonFiber & PhantomThread) — Offensive techniques using Windows Fibers

Type:
GitHub Tool

Short Summary (4–8 sentences max):
- This repository provides proof-of-concept implementations of two offensive techniques built around Windows Fibers: remote fiber injection (PoisonFiber) and improved fiber-based callstack masking (PhantomThread).  
- PoisonFiber focuses on remotely enumerating fiber-using threads/processes, locating dormant Fiber objects on remote heaps, and triggering execution by modifying fiber CONTEXT/stack state or Fiber Local Storage (FLS) callback tables.  
- It demonstrates multiple sub-techniques: overwriting existing fiber resumption code, redirecting execution by pushing a new return target, and hijacking default or user-defined FLS callbacks for one-shot execution.  
- PhantomThread evolves traditional “sleep masking” by removing common fiber indicators (e.g., `TEB->SameTebFlags` `HasFiberData`, `RtlUserFiberStart` artifacts) and by masking both the active and dormant fibers using a dummy fiber with a valid `XoredCookie`.  
- The project is useful for red teamers, malware developers, and security researchers studying stealthy execution/injection primitives and EDR detection gaps around fibers.  
- It’s interesting because it operationalizes lesser-used Windows internals (fiber objects, FLS internals, cookies) into injection and anti-scanning techniques, while explicitly noting expected telemetry and limitations (e.g., inline callstack collection).

Technical Focus:
- Windows Fibers internals (Fiber objects, dormant fibers, `CONTEXT`, fiber stacks)
- Remote enumeration of fiber usage via TEB (`SameTebFlags`, `HasFiberData`)
- Remote heap enumeration and validation using `XoredCookie` / `FiberData` sanity checks
- Fiber Local Storage (FLS) internals and callback table hijacking
- Callstack masking / sleep masking and artifact removal (`RtlUserFiberStart`)
- Memory scanning evasion tradeoffs and detection telemetry (ETW TI, RWX scanning, usermode hooks)

Use Cases:
- Remote code execution in fiber-using processes without creating new remote threads
- Researching/validating detections for fiber-based injection and FLS callback abuse
- Building or testing callstack masking approaches against periodic memory scanners
- Developing forensic tooling to enumerate/validate fiber objects and hidden stacks
- Training material / lab POCs for Windows internals and EDR telemetry generation

Keywords:
Windows Fibers, PoisonFiber, PhantomThread, fiber injection, dormant fiber, ConvertThreadToFiber, CreateFiber, SwitchToFiber, TEB, SameTebFlags, HasFiberData, CONTEXT, RIP, heap enumeration, Fiber Local Storage, FLS, FlsData, GLOBAL_FLS_DATA, callback table hijack, XoredCookie, callstack masking, sleep masking, ETW Threat Intelligence, KERNEL_THREATINT_KEYWORD_WRITEVM_REMOTE, CreateToolhelp32Snapshot, RWX memory, usermode hooks