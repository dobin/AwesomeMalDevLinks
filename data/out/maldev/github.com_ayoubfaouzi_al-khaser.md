# https://github.com/ayoubfaouzi/al-khaser

[Skip to content](https://github.com/ayoubfaouzi/al-khaser#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/ayoubfaouzi/al-khaser) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/ayoubfaouzi/al-khaser) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/ayoubfaouzi/al-khaser) to refresh your session.Dismiss alert

{{ message }}

[ayoubfaouzi](https://github.com/ayoubfaouzi)/ **[al-khaser](https://github.com/ayoubfaouzi/al-khaser)** Public

- [Notifications](https://github.com/login?return_to=%2Fayoubfaouzi%2Fal-khaser) You must be signed in to change notification settings
- [Fork\\
1.3k](https://github.com/login?return_to=%2Fayoubfaouzi%2Fal-khaser)
- [Star\\
6.8k](https://github.com/login?return_to=%2Fayoubfaouzi%2Fal-khaser)


Public malware techniques used in the wild: Virtual Machine, Emulation, Debuggers, Sandbox detection.


### License

[GPL-2.0 license](https://github.com/ayoubfaouzi/al-khaser/blob/master/LICENSE)

[6.8k\\
stars](https://github.com/ayoubfaouzi/al-khaser/stargazers) [1.3k\\
forks](https://github.com/ayoubfaouzi/al-khaser/forks) [Branches](https://github.com/ayoubfaouzi/al-khaser/branches) [Tags](https://github.com/ayoubfaouzi/al-khaser/tags) [Activity](https://github.com/ayoubfaouzi/al-khaser/activity)

[Star](https://github.com/login?return_to=%2Fayoubfaouzi%2Fal-khaser)

[Notifications](https://github.com/login?return_to=%2Fayoubfaouzi%2Fal-khaser) You must be signed in to change notification settings

# ayoubfaouzi/al-khaser

master

[**7** Branches](https://github.com/ayoubfaouzi/al-khaser/branches) [**2** Tags](https://github.com/ayoubfaouzi/al-khaser/tags)

[Go to Branches page](https://github.com/ayoubfaouzi/al-khaser/branches)[Go to Tags page](https://github.com/ayoubfaouzi/al-khaser/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![dependabot[bot]](https://avatars.githubusercontent.com/in/29110?v=4&size=40)](https://github.com/apps/dependabot)[dependabot\[bot\]](https://github.com/ayoubfaouzi/al-khaser/commits?author=dependabot%5Bbot%5D)<br>[Bump microsoft/setup-msbuild from 1.1.3 to 2.0.0 (](https://github.com/ayoubfaouzi/al-khaser/commit/59be27488f629c8843a351cd72dc6ed0050a650e) [#305](https://github.com/ayoubfaouzi/al-khaser/pull/305) [)](https://github.com/ayoubfaouzi/al-khaser/commit/59be27488f629c8843a351cd72dc6ed0050a650e)<br>Open commit details<br>2 weeks agoFeb 1, 2026<br>[59be274](https://github.com/ayoubfaouzi/al-khaser/commit/59be27488f629c8843a351cd72dc6ed0050a650e) · 2 weeks agoFeb 1, 2026<br>## History<br>[549 Commits](https://github.com/ayoubfaouzi/al-khaser/commits/master/) <br>Open commit details<br>[View commit history for this file.](https://github.com/ayoubfaouzi/al-khaser/commits/master/) 549 Commits |
| [.github](https://github.com/ayoubfaouzi/al-khaser/tree/master/.github ".github") | [.github](https://github.com/ayoubfaouzi/al-khaser/tree/master/.github ".github") | [Bump microsoft/setup-msbuild from 1.1.3 to 2.0.0 (](https://github.com/ayoubfaouzi/al-khaser/commit/59be27488f629c8843a351cd72dc6ed0050a650e "Bump microsoft/setup-msbuild from 1.1.3 to 2.0.0 (#305)  Signed-off-by: dependabot[bot] <support@github.com> Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>") [#305](https://github.com/ayoubfaouzi/al-khaser/pull/305) [)](https://github.com/ayoubfaouzi/al-khaser/commit/59be27488f629c8843a351cd72dc6ed0050a650e "Bump microsoft/setup-msbuild from 1.1.3 to 2.0.0 (#305)  Signed-off-by: dependabot[bot] <support@github.com> Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>") | 2 weeks agoFeb 1, 2026 |
| [Tools](https://github.com/ayoubfaouzi/al-khaser/tree/master/Tools "Tools") | [Tools](https://github.com/ayoubfaouzi/al-khaser/tree/master/Tools "Tools") | [Add NtSystemDebugControl anti-dbg (](https://github.com/ayoubfaouzi/al-khaser/commit/6cd41fa690a16aba698dce0618e6080bf1692195 "Add NtSystemDebugControl anti-dbg (#252)  * Add NtSystemDebugControl anti-dbg  * Update CI  * force 2022  Co-authored-by: Stephen Eckels <stephen.eckels@mandiant.com>") [#252](https://github.com/ayoubfaouzi/al-khaser/pull/252) [)](https://github.com/ayoubfaouzi/al-khaser/commit/6cd41fa690a16aba698dce0618e6080bf1692195 "Add NtSystemDebugControl anti-dbg (#252)  * Add NtSystemDebugControl anti-dbg  * Update CI  * force 2022  Co-authored-by: Stephen Eckels <stephen.eckels@mandiant.com>") | 4 years agoNov 4, 2022 |
| [al-khaser](https://github.com/ayoubfaouzi/al-khaser/tree/master/al-khaser "al-khaser") | [al-khaser](https://github.com/ayoubfaouzi/al-khaser/tree/master/al-khaser "al-khaser") | [Fix for VirtualBox checks: add VariantInit(&vtProp) to ensure safe VA…](https://github.com/ayoubfaouzi/al-khaser/commit/490f270897d41b7d1c473d7b38f3020398dd34e8 "Fix for VirtualBox checks: add VariantInit(&vtProp) to ensure safe VARIANT initialization (#301)  Co-authored-by: igor korkin <ikorkin@ptsecurity.com>") | 2 weeks agoJan 30, 2026 |
| [.clang-format](https://github.com/ayoubfaouzi/al-khaser/blob/master/.clang-format ".clang-format") | [.clang-format](https://github.com/ayoubfaouzi/al-khaser/blob/master/.clang-format ".clang-format") | [Add .clang-format file; fix ldt test for x64; remove an unused local …](https://github.com/ayoubfaouzi/al-khaser/commit/aa9150da49c9a4e52374d1ed106db2017759336f "Add .clang-format file; fix ldt test for x64; remove an unused local variable (#292)  Co-authored-by: igor korkin <ikorkin@ptsecurity.com>") | 7 months agoJul 14, 2025 |
| [.editorconfig](https://github.com/ayoubfaouzi/al-khaser/blob/master/.editorconfig ".editorconfig") | [.editorconfig](https://github.com/ayoubfaouzi/al-khaser/blob/master/.editorconfig ".editorconfig") | [added .editorconfig for current style + ignore database](https://github.com/ayoubfaouzi/al-khaser/commit/4e36bab8af004887d6f179035e7fd6f09d1e261e "added .editorconfig for current style + ignore database") | 10 years agoJun 27, 2016 |
| [.gitattributes](https://github.com/ayoubfaouzi/al-khaser/blob/master/.gitattributes ".gitattributes") | [.gitattributes](https://github.com/ayoubfaouzi/al-khaser/blob/master/.gitattributes ".gitattributes") | [add gitattributes to normalize line endings](https://github.com/ayoubfaouzi/al-khaser/commit/028e6fbcbacec3a2704a5d837f6758727c233cbf "add gitattributes to normalize line endings") | 8 years agoJan 31, 2019 |
| [.gitignore](https://github.com/ayoubfaouzi/al-khaser/blob/master/.gitignore ".gitignore") | [.gitignore](https://github.com/ayoubfaouzi/al-khaser/blob/master/.gitignore ".gitignore") | [Add .clang-format file; fix ldt test for x64; remove an unused local …](https://github.com/ayoubfaouzi/al-khaser/commit/aa9150da49c9a4e52374d1ed106db2017759336f "Add .clang-format file; fix ldt test for x64; remove an unused local variable (#292)  Co-authored-by: igor korkin <ikorkin@ptsecurity.com>") | 7 months agoJul 14, 2025 |
| [CHANGELOG.md](https://github.com/ayoubfaouzi/al-khaser/blob/master/CHANGELOG.md "CHANGELOG.md") | [CHANGELOG.md](https://github.com/ayoubfaouzi/al-khaser/blob/master/CHANGELOG.md "CHANGELOG.md") | [Add KVM virtio reg keys, files and dir and QEMU dirs](https://github.com/ayoubfaouzi/al-khaser/commit/f2b026a49c0ed492fefb26024d478763c9a6366b "Add KVM virtio reg keys, files and dir and QEMU dirs") | 5 years agoSep 14, 2021 |
| [LICENSE](https://github.com/ayoubfaouzi/al-khaser/blob/master/LICENSE "LICENSE") | [LICENSE](https://github.com/ayoubfaouzi/al-khaser/blob/master/LICENSE "LICENSE") | [update code](https://github.com/ayoubfaouzi/al-khaser/commit/c1780029e882d85d355612cf86b4815f229fc5ce "update code") | 11 years agoFeb 6, 2016 |
| [README.md](https://github.com/ayoubfaouzi/al-khaser/blob/master/README.md "README.md") | [README.md](https://github.com/ayoubfaouzi/al-khaser/blob/master/README.md "README.md") | [Parametrized --sleep/--delay seconds. Added -h/--help. (](https://github.com/ayoubfaouzi/al-khaser/commit/f27424dcc0d67690c0dd261883438cdbd16ba91b "Parametrized --sleep/--delay seconds. Added -h/--help. (#293)  * Parametrized --delay/--sleep  * Added -h/--help message. Updated README with --help message (Usage)") [#293](https://github.com/ayoubfaouzi/al-khaser/pull/293) [)](https://github.com/ayoubfaouzi/al-khaser/commit/f27424dcc0d67690c0dd261883438cdbd16ba91b "Parametrized --sleep/--delay seconds. Added -h/--help. (#293)  * Parametrized --delay/--sleep  * Added -h/--help message. Updated README with --help message (Usage)") | 7 months agoJul 14, 2025 |
| [al-khaser.sln](https://github.com/ayoubfaouzi/al-khaser/blob/master/al-khaser.sln "al-khaser.sln") | [al-khaser.sln](https://github.com/ayoubfaouzi/al-khaser/blob/master/al-khaser.sln "al-khaser.sln") | [Merge branch 'master' into pnpentity-wmi](https://github.com/ayoubfaouzi/al-khaser/commit/fb191f99a3861a2a82ef7a69c2bcfa5ef0a4f073 "Merge branch 'master' into pnpentity-wmi") | 7 years agoApr 13, 2019 |
| View all files |

## Repository files navigation

## Al-Khaser v0.81

[Permalink: Al-Khaser v0.81](https://github.com/ayoubfaouzi/al-khaser#al-khaser-v081)

[![Logo](https://camo.githubusercontent.com/1bdbeb3a09a0ea2d2587524e6926e6eb17b976cd9e0f142427bcc43c5ad7c793/68747470733a2f2f7777772e6d696e646d6569737465722e636f6d2f66696c65732f617661746172732f303033352f383333322f6f726967696e616c2f6176617461722e6a7067)](https://camo.githubusercontent.com/1bdbeb3a09a0ea2d2587524e6926e6eb17b976cd9e0f142427bcc43c5ad7c793/68747470733a2f2f7777772e6d696e646d6569737465722e636f6d2f66696c65732f617661746172732f303033352f383333322f6f726967696e616c2f6176617461722e6a7067)

## Content

[Permalink: Content](https://github.com/ayoubfaouzi/al-khaser#content)

- [Introduction](https://github.com/ayoubfaouzi/al-khaser#introduction)
- [Possible uses](https://github.com/ayoubfaouzi/al-khaser#uses)
- [Features](https://github.com/ayoubfaouzi/al-khaser#features)
- [Anti-debugging attacks](https://github.com/ayoubfaouzi/al-khaser#antidebug)
- [Anti-Dumping](https://github.com/ayoubfaouzi/al-khaser#antidump)
- [Timing Attacks](https://github.com/ayoubfaouzi/al-khaser#timingattack)
- [Human Interaction](https://github.com/ayoubfaouzi/al-khaser#antidump)
- [Anti-VM](https://github.com/ayoubfaouzi/al-khaser#antivm)
- [Anti-Disassembly](https://github.com/ayoubfaouzi/al-khaser#antidisassm)
- [Requirements](https://github.com/ayoubfaouzi/al-khaser#requirements)
- [License](https://github.com/ayoubfaouzi/al-khaser#license)

## Introduction

[Permalink: Introduction](https://github.com/ayoubfaouzi/al-khaser#introduction)

al-khaser is a PoC "malware" application with good intentions that aims to stress your anti-malware system.
It performs a bunch of common malware tricks with the goal of seeing if you stay under the radar.

[![Logo](https://camo.githubusercontent.com/469f3cf6c0bc62c5ec683e7bcafa13055d83715d72eba6e190db8961b1642a02/68747470733a2f2f692e696d6775722e636f6d2f6a454668734a542e706e67)](https://camo.githubusercontent.com/469f3cf6c0bc62c5ec683e7bcafa13055d83715d72eba6e190db8961b1642a02/68747470733a2f2f692e696d6775722e636f6d2f6a454668734a542e706e67)

### Usage

[Permalink: Usage](https://github.com/ayoubfaouzi/al-khaser#usage)

```
$ ./al-khaser.exe -h
Usage: al-khaser.exe [OPTIONS]
Options:
  --check <type>      Enable specific check(s). Can be used multiple times. Valid types are:
                        TLS              (Thread Local Storage callback checks)
                        DEBUG            (Anti-debugging checks)
                        INJECTION        (Code injection checks)
                        GEN_SANDBOX      (Generic sandbox checks)
                        VBOX             (VirtualBox detection)
                        VMWARE           (VMware detection)
                        VPC              (Virtual PC detection)
                        QEMU             (QEMU detection)
                        KVM              (KVM detection)
                        XEN              (Xen detection)
                        WINE             (Wine detection)
                        PARALLELS        (Parallels detection)
                        HYPERV           (Hyper-V detection)
                        CODE_INJECTIONS  (Additional code injection techniques)
                        TIMING_ATTACKS   (Timing/sleep-based sandbox evasion)
                        DUMPING_CHECK    (Dumping memory/process checks)
                        ANALYSIS_TOOLS   (Analysis tools detection)
                        ANTI_DISASSM     (Anti-disassembly checks)
  --sleep <seconds>   Set sleep/delay duration in seconds (default: 600).
  --delay <seconds>   Alias for --sleep.
  -h, --help          Show this help message and exit.

Examples:
  al-khaser.exe --check DEBUG --check TIMING_ATTACKS --sleep 30
  al-khaser.exe --check VMWARE --check QEMU
  al-khaser.exe --sleep 30
```

## Download

[Permalink: Download](https://github.com/ayoubfaouzi/al-khaser#download)

You can download built binaries (x86, x64) from this project's [releases page](https://github.com/LordNoteworthy/al-khaser/releases). The password for the 7zs can be found [here](https://github.com/LordNoteworthy/al-khaser/blob/master/.github/workflows/release.yml#L25).

## Possible uses

[Permalink: Possible uses](https://github.com/ayoubfaouzi/al-khaser#possible-uses)

- You are making an anti-debug plugin and you want to check its effectiveness.
- You want to ensure that your sandbox solution is hidden enough.
- Or you want to ensure that your malware analysis environment is well hidden.

Please, if you encounter any of the anti-analysis tricks which you have seen in a malware, don't hesitate to contribute.

## Features

[Permalink: Features](https://github.com/ayoubfaouzi/al-khaser#features)

### Anti-debugging attacks

[Permalink: Anti-debugging attacks](https://github.com/ayoubfaouzi/al-khaser#anti-debugging-attacks)

- IsDebuggerPresent
- CheckRemoteDebuggerPresent
- Process Environment Block (BeingDebugged)
- Process Environment Block (NtGlobalFlag)
- ProcessHeap (Flags)
- ProcessHeap (ForceFlags)
- Low Fragmentation Heap (LFH)
- NtQueryInformationProcess (ProcessDebugPort)
- NtQueryInformationProcess (ProcessDebugFlags)
- NtQueryInformationProcess (ProcessDebugObject)
- WudfIsAnyDebuggerPresent
- WudfIsKernelDebuggerPresent
- WudfIsUserDebuggerPresent
- NtSetInformationThread (HideThreadFromDebugger)
- NtQueryObject (ObjectTypeInformation)
- NtQueryObject (ObjectAllTypesInformation)
- CloseHanlde (NtClose) Invalide Handle
- SetHandleInformation (Protected Handle)
- UnhandledExceptionFilter
- OutputDebugString (GetLastError())
- Hardware Breakpoints (SEH / GetThreadContext)
- Software Breakpoints (INT3 / 0xCC)
- Memory Breakpoints (PAGE\_GUARD)
- Interrupt 0x2d
- Interrupt 1
- Trap Flag
- Parent Process (Explorer.exe)
- SeDebugPrivilege (Csrss.exe)
- NtYieldExecution / SwitchToThread
- TLS callbacks
- Process jobs
- Memory write watching
- Page exception breakpoint detection
- API hook detection (module bounds based)

### Anti-injection

[Permalink: Anti-injection](https://github.com/ayoubfaouzi/al-khaser#anti-injection)

- Enumerate modules with EnumProcessModulesEx (32-bit, 64-bit, and all options)
- Enumerate modules with ToolHelp32
- Enumerate the process LDR structures with LdrEnumerateLoadedModules
- Enumerate the process LDR structures directly
- Walk memory with GetModuleInformation
- Walk memory for hidden modules

### Anti-Dumping

[Permalink: Anti-Dumping](https://github.com/ayoubfaouzi/al-khaser#anti-dumping)

- Erase PE header from memory
- SizeOfImage

### Timing Attacks \[Anti-Sandbox\]

[Permalink: Timing Attacks [Anti-Sandbox]](https://github.com/ayoubfaouzi/al-khaser#timing-attacks-anti-sandbox)

- RDTSC (with CPUID to force a VM Exit)
- RDTSC (Locky version with GetProcessHeap & CloseHandle)
- Sleep -> SleepEx -> NtDelayExecution
- Sleep (in a loop a small delay)
- Sleep and check if time was accelerated (GetTickCount)
- SetTimer (Standard Windows Timers)
- timeSetEvent (Multimedia Timers)
- WaitForSingleObject -> WaitForSingleObjectEx -> NtWaitForSingleObject
- WaitForMultipleObjects -> WaitForMultipleObjectsEx -> NtWaitForMultipleObjects
- IcmpSendEcho (CCleaner Malware)
- CreateWaitableTimer
- CreateTimerQueueTimer
- Big crypto loops (todo)

### Human Interaction / Generic \[Anti-Sandbox\]

[Permalink: Human Interaction / Generic [Anti-Sandbox]](https://github.com/ayoubfaouzi/al-khaser#human-interaction--generic-anti-sandbox)

- Mouse movement
- File names like `sample.exe` or `sandbox.exe`.
- Total Physical memory (GlobalMemoryStatusEx)
- Disk size using DeviceIoControl (IOCTL\_DISK\_GET\_LENGTH\_INFO)
- Disk size using GetDiskFreeSpaceEx (TotalNumberOfBytes)
- Mouse (Single click / Double click) (todo)
- DialogBox (todo)
- Scrolling (todo)
- Execution after reboot (todo)
- Count of processors (Win32/Tinba - Win32/Dyre)
- Sandbox known product IDs (todo)
- Color of background pixel (todo)
- Keyboard layout (Win32/Banload) (todo)
- Genuine Windows installation.
- Known Sandbox hostnames and usernames

### Anti-Virtualization / Full-System Emulation

[Permalink: Anti-Virtualization / Full-System Emulation](https://github.com/ayoubfaouzi/al-khaser#anti-virtualization--full-system-emulation)

- **Registry key value artifacts**
  - HARDWARE\\DEVICEMAP\\Scsi\\Scsi Port 0\\Scsi Bus 0\\Target Id 0\\Logical Unit Id 0 (Identifier) (VBOX)
  - HARDWARE\\DEVICEMAP\\Scsi\\Scsi Port 0\\Scsi Bus 0\\Target Id 0\\Logical Unit Id 0 (Identifier) (QEMU)
  - HARDWARE\\Description\\System (SystemBiosVersion) (VBOX)
  - HARDWARE\\Description\\System (SystemBiosVersion) (QEMU)
  - HARDWARE\\Description\\System (VideoBiosVersion) (VIRTUALBOX)
  - HARDWARE\\Description\\System (SystemBiosDate) (06/23/99)
  - HARDWARE\\DEVICEMAP\\Scsi\\Scsi Port 0\\Scsi Bus 0\\Target Id 0\\Logical Unit Id 0 (Identifier) (VMWARE)
  - HARDWARE\\DEVICEMAP\\Scsi\\Scsi Port 1\\Scsi Bus 0\\Target Id 0\\Logical Unit Id 0 (Identifier) (VMWARE)
  - HARDWARE\\DEVICEMAP\\Scsi\\Scsi Port 2\\Scsi Bus 0\\Target Id 0\\Logical Unit Id 0 (Identifier) (VMWARE)
  - SYSTEM\\ControlSet001\\Control\\SystemInformation (SystemManufacturer) (VMWARE)
  - SYSTEM\\ControlSet001\\Control\\SystemInformation (SystemProductName) (VMWARE)
- **Registry Keys artifacts**
  - HARDWARE\\ACPI\\DSDT\\VBOX\_\_ (VBOX)
  - HARDWARE\\ACPI\\FADT\\VBOX\_\_ (VBOX)
  - HARDWARE\\ACPI\\RSDT\\VBOX\_\_ (VBOX)
  - SOFTWARE\\Oracle\\VirtualBox Guest Additions (VBOX)
  - SYSTEM\\ControlSet001\\Services\\VBoxGuest (VBOX)
  - SYSTEM\\ControlSet001\\Services\\VBoxMouse (VBOX)
  - SYSTEM\\ControlSet001\\Services\\VBoxService (VBOX)
  - SYSTEM\\ControlSet001\\Services\\VBoxSF (VBOX)
  - SYSTEM\\ControlSet001\\Services\\VBoxVideo (VBOX)
  - SOFTWARE\\VMware, Inc.\\VMware Tools (VMWARE)
  - SOFTWARE\\Wine (WINE)
  - SOFTWARE\\Microsoft\\Virtual Machine\\Guest\\Parameters (HYPER-V)
  - SYSTEM\\CurrentControlSet\\Services\\Disk\\Enum
  - SYSTEM\\CurrentControlSet\\Enum\\IDE
  - SYSTEM\\CurrentControlSet\\Enum\\SCSI
- **File system artifacts**
  - "system32\\drivers\\VBoxMouse.sys"
  - "system32\\drivers\\VBoxGuest.sys"
  - "system32\\drivers\\VBoxSF.sys"
  - "system32\\drivers\\VBoxVideo.sys"
  - "system32\\vboxdisp.dll"
  - "system32\\vboxhook.dll"
  - "system32\\vboxmrxnp.dll"
  - "system32\\vboxogl.dll"
  - "system32\\vboxoglarrayspu.dll"
  - "system32\\vboxoglcrutil.dll"
  - "system32\\vboxoglerrorspu.dll"
  - "system32\\vboxoglfeedbackspu.dll"
  - "system32\\vboxoglpackspu.dll"
  - "system32\\vboxoglpassthroughspu.dll"
  - "system32\\vboxservice.exe"
  - "system32\\vboxtray.exe"
  - "system32\\VBoxControl.exe"
  - "system32\\drivers\\vmmouse.sys"
  - "system32\\drivers\\vmhgfs.sys"
  - "system32\\drivers\\vm3dmp.sys"
  - "system32\\drivers\\vmci.sys"
  - "system32\\drivers\\vmhgfs.sys"
  - "system32\\drivers\\vmmemctl.sys"
  - "system32\\drivers\\vmmouse.sys"
  - "system32\\drivers\\vmrawdsk.sys"
  - "system32\\drivers\\vmusbmouse.sys"
- **Directories artifacts**
  - "%PROGRAMFILES%\\oracle\\virtualbox guest additions\\"
  - "%PROGRAMFILES%\\VMWare\\"
- **Memory artifacts**
  - Interupt Descriptor Table (IDT) location
  - Local Descriptor Table (LDT) location
  - Global Descriptor Table (GDT) location
  - Task state segment trick with STR
- **MAC Address**
  - "\\x08\\x00\\x27" (VBOX)
  - "\\x00\\x05\\x69" (VMWARE)
  - "\\x00\\x0C\\x29" (VMWARE)
  - "\\x00\\x1C\\x14" (VMWARE)
  - "\\x00\\x50\\x56" (VMWARE)
  - "\\x00\\x1C\\x42" (Parallels)
  - "\\x00\\x16\\x3E" (Xen)
  - "\\x0A\\x00\\x27" (Hybrid Analysis)
- **Virtual devices**
  - "\\\.\\VBoxMiniRdrDN"
  - "\\\.\\VBoxGuest"
  - "\\\.\\pipe\\VBoxMiniRdDN"
  - "\\\.\\VBoxTrayIPC"
  - "\\\.\\pipe\\VBoxTrayIPC")
  - "\\\.\\HGFS"
  - "\\\.\\vmci"
- **Hardware Device information**
  - SetupAPI SetupDiEnumDeviceInfo (GUID\_DEVCLASS\_DISKDRIVE)
    - QEMU
    - VMWare
    - VBOX
    - VIRTUAL HD
  - Power policies (S1-S4 states, thermal control)
- **System Firmware Tables**
  - SMBIOS string checks (VirtualBox)
  - SMBIOS string checks (VMWare)
  - SMBIOS string checks (Qemu)
  - SMBIOS number of tables (Qemu, VirtualBox)
  - ACPI string checks (WAET table, PNP devices, PM state with battery checks)
  - ACPI string checks (VirtualBox)
  - ACPI string checks (VMWare)
  - ACPI string checks (Qemu)
- **Driver Services**
  - VirtualBox
  - VMWare
- **Adapter name**
  - VMWare
- **Windows Class**
  - VBoxTrayToolWndClass
  - VBoxTrayToolWnd
- **Network shares**
  - VirtualBox Shared Folders
- **Processes**
  - vboxservice.exe (VBOX)
  - vboxtray.exe (VBOX)
  - vmtoolsd.exe(VMWARE)
  - vmwaretray.exe(VMWARE)
  - vmwareuser(VMWARE)
  - VGAuthService.exe (VMWARE)
  - vmacthlp.exe (VMWARE)
  - vmsrvc.exe(VirtualPC)
  - vmusrvc.exe(VirtualPC)
  - prl\_cc.exe(Parallels)
  - prl\_tools.exe(Parallels)
  - xenservice.exe(Citrix Xen)
  - qemu-ga.exe (QEMU)
  - looking-glass-host.exe (GENERIC)
  - VDDSysTray.exe (GENERIC)
- **WMI**
  - SELECT \* FROM Win32\_Bios (SerialNumber) (GENERIC)
  - SELECT \* FROM Win32\_PnPEntity (DeviceId) (VBOX)
  - SELECT \* FROM Win32\_NetworkAdapterConfiguration (MACAddress) (VBOX)
  - SELECT \* FROM Win32\_NTEventlogFile (VBOX)
  - SELECT \* FROM Win32\_Processor (NumberOfCores and ProcessorId) (GENERIC)
  - SELECT \* FROM Win32\_LogicalDisk (Size) (GENERIC)
  - SELECT \* FROM Win32\_ComputerSystem (Model and Manufacturer) (GENERIC)
  - SELECT \* FROM MSAcpi\_ThermalZoneTemperature CurrentTemperature) (GENERIC)
  - SELECT \* FROM Win32\_Fan (GENERIC)
- **DLL Exports and Loaded DLLs**
  - avghookx.dll (AVG)
  - avghooka.dll (AVG)
  - snxhk.dll (Avast)
  - kernel32.dll!wine\_get\_unix\_file\_nameWine (Wine)
  - sbiedll.dll (Sandboxie)
  - dbghelp.dll (MS debugging support routines)
  - api\_log.dll (iDefense Labs)
  - dir\_watch.dll (iDefense Labs)
  - pstorec.dll (SunBelt Sandbox)
  - vmcheck.dll (Virtual PC)
  - wpespy.dll (WPE Pro)
  - cmdvrt32.dll (Comodo Container)
  - cmdvrt64.dll (Comodo Container)
- **CPU**
  - Hypervisor presence using (EAX=0x1)
  - Hypervisor vendor using (EAX=0x40000000)
    - "KVMKVMKVM\\0\\0\\0" (KVM)
      - "Microsoft Hv"(Microsoft Hyper-V or Windows Virtual PC)
      - "VMwareVMware"(VMware)
      - "XenVMMXenVMM"(Xen)
      - "prl hyperv "( Parallels)
        -"VBoxVBoxVBox"( VirtualBox)
- NtQueryLicenseValue with Kernel-VMDetection-Private as license value.


### Anti-Analysis

[Permalink: Anti-Analysis](https://github.com/ayoubfaouzi/al-khaser#anti-analysis)

- **Processes**
  - OllyDBG / ImmunityDebugger / WinDbg / IDA Pro / X64dbg / Cheat Engine
  - SysInternals Suite Tools (Process Explorer / Process Monitor / Regmon / Filemon, TCPView, Autoruns)
  - Wireshark / Dumpcap / Fiddler / Http Debugger
  - ProcessHacker / SysAnalyzer / HookExplorer / SysInspector
  - ImportREC / PETools / LordPE
  - JoeBox Sandbox
  - Resource Hacker
  - Frida

### Anti-Disassembly

[Permalink: Anti-Disassembly](https://github.com/ayoubfaouzi/al-khaser#anti-disassembly)

- Jump with constant condition
- Jump instruction with same target
- Impossible disassembly
- Function Pointers
- Return Pointer Abuse

### Macro malware attacks

[Permalink: Macro malware attacks](https://github.com/ayoubfaouzi/al-khaser#macro-malware-attacks)

- Document\_Close / Auto\_Close.
- Application.RecentFiles.Count

### Code/DLL Injections techniques

[Permalink: Code/DLL Injections techniques](https://github.com/ayoubfaouzi/al-khaser#codedll-injections-techniques)

- CreateRemoteThread
- SetWindowsHooksEx
- NtCreateThreadEx
- RtlCreateUserThread
- APC (QueueUserAPC / NtQueueApcThread)
- RunPE (GetThreadContext / SetThreadContext)

## Authors

[Permalink: Authors](https://github.com/ayoubfaouzi/al-khaser#authors)

- [Mattiwatti](https://github.com/Mattiwatti): Matthijs Lavrijsen
- [gsuberland](https://twitter.com/gsuberland): Graham Sutherland
- [hFireF0x](https://github.com/hfiref0x): hfiref0x

Pull requests welcome. Please read the [Developer Guidelines](https://github.com/LordNoteworthy/al-khaser/wiki/Developer-Guidelines) on our wiki if you wish to contribute to the project.

## References

[Permalink: References](https://github.com/ayoubfaouzi/al-khaser#references)

- An Anti-Reverse Engineering Guide By Josh Jackson.
- Anti-Unpacker Tricks By Peter Ferrie.
- The Art Of Unpacking By Mark Vincent Yason.
- Walied Assar's blog [http://waleedassar.blogspot.de/](http://waleedassar.blogspot.de/).
- Pafish tool: [https://github.com/a0rtega/pafish](https://github.com/a0rtega/pafish).
- PafishMacro by JoeSecurity: [https://github.com/joesecurity/pafishmacro](https://github.com/joesecurity/pafishmacro)

## About

Public malware techniques used in the wild: Virtual Machine, Emulation, Debuggers, Sandbox detection.


### Topics

[malware](https://github.com/topics/malware "Topic: malware") [code-injection](https://github.com/topics/code-injection "Topic: code-injection") [timing-attacks](https://github.com/topics/timing-attacks "Topic: timing-attacks") [anti-debugging](https://github.com/topics/anti-debugging "Topic: anti-debugging") [anti-analysis](https://github.com/topics/anti-analysis "Topic: anti-analysis") [anti-sandbox](https://github.com/topics/anti-sandbox "Topic: anti-sandbox") [anti-vm](https://github.com/topics/anti-vm "Topic: anti-vm") [anti-emulation](https://github.com/topics/anti-emulation "Topic: anti-emulation") [av-bypass](https://github.com/topics/av-bypass "Topic: av-bypass") [sandbox-evasion](https://github.com/topics/sandbox-evasion "Topic: sandbox-evasion") [anti-disassembly](https://github.com/topics/anti-disassembly "Topic: anti-disassembly")

### Resources

[Readme](https://github.com/ayoubfaouzi/al-khaser#readme-ov-file)

### License

[GPL-2.0 license](https://github.com/ayoubfaouzi/al-khaser#GPL-2.0-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/ayoubfaouzi/al-khaser).

[Activity](https://github.com/ayoubfaouzi/al-khaser/activity)

### Stars

[**6.8k**\\
stars](https://github.com/ayoubfaouzi/al-khaser/stargazers)

### Watchers

[**235**\\
watching](https://github.com/ayoubfaouzi/al-khaser/watchers)

### Forks

[**1.3k**\\
forks](https://github.com/ayoubfaouzi/al-khaser/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fayoubfaouzi%2Fal-khaser&report=ayoubfaouzi+%28user%29)

## [Releases\  2](https://github.com/ayoubfaouzi/al-khaser/releases)

[v1.1.0\\
Latest\\
\\
3 weeks agoJan 27, 2026](https://github.com/ayoubfaouzi/al-khaser/releases/tag/v1.1.0)

[\+ 1 release](https://github.com/ayoubfaouzi/al-khaser/releases)

## [Packages\  0](https://github.com/users/ayoubfaouzi/packages?repo_name=al-khaser)

No packages published

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/ayoubfaouzi/al-khaser).

## [Contributors\  35](https://github.com/ayoubfaouzi/al-khaser/graphs/contributors)

- [![@ayoubfaouzi](https://avatars.githubusercontent.com/u/5129564?s=64&v=4)](https://github.com/ayoubfaouzi)
- [![@gsuberland](https://avatars.githubusercontent.com/u/6430604?s=64&v=4)](https://github.com/gsuberland)
- [![@hfiref0x](https://avatars.githubusercontent.com/u/10708977?s=64&v=4)](https://github.com/hfiref0x)
- [![@mrexodia](https://avatars.githubusercontent.com/u/2458265?s=64&v=4)](https://github.com/mrexodia)
- [![@Mattiwatti](https://avatars.githubusercontent.com/u/3313892?s=64&v=4)](https://github.com/Mattiwatti)
- [![@IgorKorkin](https://avatars.githubusercontent.com/u/10939751?s=64&v=4)](https://github.com/IgorKorkin)
- [![@kaganisildak](https://avatars.githubusercontent.com/u/12753938?s=64&v=4)](https://github.com/kaganisildak)
- [![@recvfrom](https://avatars.githubusercontent.com/u/36489577?s=64&v=4)](https://github.com/recvfrom)
- [![@dmfrpro](https://avatars.githubusercontent.com/u/45668671?s=64&v=4)](https://github.com/dmfrpro)
- [![@dependabot[bot]](https://avatars.githubusercontent.com/in/29110?s=64&v=4)](https://github.com/apps/dependabot)
- [![@CyberGreg05](https://avatars.githubusercontent.com/u/62875146?s=64&v=4)](https://github.com/CyberGreg05)
- [![@rdzhaafar](https://avatars.githubusercontent.com/u/38199959?s=64&v=4)](https://github.com/rdzhaafar)
- [![@dvarshavsky](https://avatars.githubusercontent.com/u/49674797?s=64&v=4)](https://github.com/dvarshavsky)
- [![@lowlevel01](https://avatars.githubusercontent.com/u/88563786?s=64&v=4)](https://github.com/lowlevel01)

[\+ 21 contributors](https://github.com/ayoubfaouzi/al-khaser/graphs/contributors)

## Languages

- [C++90.5%](https://github.com/ayoubfaouzi/al-khaser/search?l=c%2B%2B)
- [C7.7%](https://github.com/ayoubfaouzi/al-khaser/search?l=c)
- [C#1.2%](https://github.com/ayoubfaouzi/al-khaser/search?l=c%23)
- Other0.6%

You can’t perform that action at this time.