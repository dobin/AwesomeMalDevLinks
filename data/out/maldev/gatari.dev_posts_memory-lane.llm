Title:
Memory Lane

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post revisits older “simple shellcode loader” AV-evasion techniques and shows why they no longer reliably bypass modern Windows Defender.  
- The author reproduces classic msfvenom + VirtualAlloc/RtlMoveMemory/RWX execution loaders, then uses tooling (Ghidra, gocheck/MpCmdRun) to identify what Defender flags (often the embedded shellcode and later behavioral patterns).  
- It demonstrates incremental changes: XOR-encrypting shellcode to reduce static signatures, then shifting execution from direct function-pointer invocation to an EarlyBird APC injection flow (CreateProcess suspended → VirtualAllocEx/WriteProcessMemory → VirtualProtectEx → QueueUserAPC → ResumeThread) to evade common behavioral detections.  
- The post highlights pitfalls of relying on VirusTotal: cloud/sandbox verdicts can turn into hash-based detections that “nuke” the whole file rather than specific bytes.  
- It introduces guardrails (e.g., hostname checks) as a basic sandbox-evasion/scoping mechanism and discusses why memory scanners still catch unencrypted payloads during post-exploitation.  
- Useful for red teamers and malware/tooling developers who need a realistic view of Defender’s current detection surface (static, behavioral, cloud) and practical loader tradeoffs.

Technical Focus:
- Windows Defender static vs behavioral vs cloud (hash) detections
- Shellcode loader patterns (RWX allocation, memcpy, direct execution)
- XOR shellcode encryption and string/signature avoidance
- EarlyBird APC injection (suspended process + QueueUserAPC)
- Sandbox/VT operational security and guardrails
- Reverse engineering triage with Ghidra + MpCmdRun/gocheck

Use Cases:
- Updating legacy shellcode loader tutorials to work against modern Defender
- Building stageless loaders with reduced static indicators (encrypted payloads)
- Switching to alternative execution primitives (APC) to avoid common heuristics
- Testing and isolating Defender detections locally (MpCmdRun chunking) without leaking samples to VT
- Adding environment guardrails to reduce sandbox detonation and scope execution

Keywords:
Windows Defender, MpCmdRun.exe, gocheck, Ghidra, msfvenom, shellcode loader, VirtualAlloc, VirtualAllocEx, RtlMoveMemory, WriteProcessMemory, VirtualProtectEx, PAGE_EXECUTE_READWRITE, RWX, EarlyBird APC, QueueUserAPC, CreateProcessA, CREATE_SUSPENDED, process injection, behavioral detection, cloud protection, VirusTotal, YARA, Sigma, sandbox evasion, guardrails, hostname check, memory scanning, sleep mask, Ekko