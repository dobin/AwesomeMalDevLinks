# https://blog.levi.wiki/post/2025-12-04-defender-detection-engines

<!DOCTYPE html><html lang="en">

<body>
    

    <div id="main">
        

        <main>
            
<article>
    <h1>EDR Detection Engines</h1>

<p>Defender (and any modern EDR) has 4 different analysis engines, i.e. different mechanisms to catch your malware: <b>Signature, Sandbox, Memory, Behaviour</b><br>
These are sparsely documented in <a href="https://www.amazon.com/Microsoft-Defender-Endpoint-Depth-organizations/dp/1804615463">Microsoft Defender for Endpoint in Depth, p.17</a>, as well as observed by maldev research.</p>

<h2>Maldev Research</h2>

<ul>
<li><a href="https://blog.deeb.ch/posts/how-edr-works/#edr-detection">Bubbles of Bane</a> -&gt; Signature, Memory, Behaviour</li>
<li><a href="https://vanmieghem.io/blueprint-for-evading-edr-in-2022/">A blueprint for evading EDR</a> -&gt; techniques against (all) the analysis engines</li>
<li><a href="https://labs.withsecure.com/publications/bypassing-windows-defender-runtime-scanning">Bypassing Windows Defender Runtime Scanning</a> -&gt; anti signature, anti memory scan</li>
<li><a href="https://www.bordergate.co.uk/windows-defender-memory-scanning-evasion/">Windows Defender Memory Scanning Evasion</a> -&gt; anti memory scan</li>
</ul>

<h2>My Observations</h2>

<p>Below is my theory how Defender (or any modern EDR) catches your malware.<br>
A red "m" means the executable is detected.<br><br></p>

<p><img src="https://blog.levi.wiki/static/defender-detection-engines/defender-scanning-engines.png" alt="Defender Scanning Engines"></p>

<h3>Storing on Disk (pre execution)</h3>

<p>1) The heuristics engine tries to match your executable to known bad signatures, like hashes, imphashes, yara rules, etc.<br>
2) The emulation engine emulates the file and stops (freezes) after a certain cutoff (may be from 0.1sec to 3sec).<br>
3) The memory scanning engine reads the memory of the emulated process and again tries to match it to known bad signatures.<br></p>

<h3>Start Execution</h3>

<p>4) The EDR may repeat steps 1-3, or use cached results (known good or known bad) before starting the actual executable.<br>
5) The behaviour engine continously tracks the executable via the emitted ETW events (or obsolete: via its syscalls with hooks).<br>
6) When suspicious behaviour is encountered, the executable is either directly marked as malware, or another memory scan is conducted.<br></p>

<h2>Conclusion</h2>

<p>To be undetected, your malware "just" needs to bypass these detections. Do not do overfancy stuff, this is detected again.</p>

<ul>
<li>Change static signatures, use a loader, obfuscate strings. Have a look at <a href="https://github.com/dobin/avred">AvRed</a>.</li>
<li>Use an anti-emulator if you decrypt or do malicious stuff in the first few seconds.</li>
<li>Do some deconditioning, so that your future malicious actions are no longer tracked or your memory is scanned. See <a href="https://blog.levi.wiki/post/2025-12-05-decondition-everything">Decondition Everything</a>.</li>
</ul>

</article>

        </main>

        
    </div>

<div height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" data-original-tag="iframe"></div>
</body></html>