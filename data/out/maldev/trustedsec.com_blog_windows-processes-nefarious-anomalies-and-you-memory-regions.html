# https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions

<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <body class="mx-auto lang-en section-blog type-blog antialiased overscroll-none"><div class="cky-hide cky-overlay"></div><div class="cky-btn-revisit-wrapper cky-revisit-hide cky-revisit-bottom-left" data-cky-tag="revisit-consent" data-tooltip="Consent Preferences" style="background-color: #000000;"><button aria-label="Consent Preferences" class="cky-btn-revisit"><img alt="Revisit consent button" src="https://cdn-cookieyes.com/assets/images/revisit.svg"></button></div><div class="cky-consent-container cky-box-bottom-left" aria-label="We value your privacy" role="region" tabindex="0"><div class="cky-consent-bar" data-cky-tag="notice" style="border-color: #EDF1F4; background-color: #EDF1F4;"><div class="cky-notice"><p class="cky-title" aria-level="1" data-cky-tag="title" role="heading" style="color: #212121;">We value your privacy</p><div class="cky-notice-group"><div class="cky-notice-des" data-cky-tag="description" style="color: #212121;"><p>We use cookies to enhance your browsing experience, serve personalised ads or content, and analyse our traffic. By clicking "Accept All", you consent to our use of cookies.</p></div><div class="cky-notice-btn-wrapper" data-cky-tag="notice-buttons"><button class="cky-btn cky-btn-customize" aria-label="Customise" data-cky-tag="settings-button" style="color: #000000; border-color: #000000; background-color: #EDF1F4;">Customise</button> <button class="cky-btn cky-btn-reject" aria-label="Reject All" data-cky-tag="reject-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Reject All</button> <button class="cky-btn cky-btn-accept" aria-label="Accept All" data-cky-tag="accept-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Accept All</button> </div></div></div></div></div><div class="cky-modal" tabindex="0"><div class="cky-preference-center" data-cky-tag="detail" aria-label="Customise Consent Preferences" aria-modal="true" role="dialog" style="color: #212121; border-color: #EDF1F4; background-color: #EDF1F4;"><div class="cky-preference-header"><span class="cky-preference-title" aria-level="1" data-cky-tag="detail-title" role="heading" style="color: #212121;">Customise Consent Preferences</span> <button aria-label="Close" class="cky-btn-close" data-cky-tag="detail-close"><img alt="Close" src="https://cdn-cookieyes.com/assets/images/close.svg" width="10" height="10"></button></div><div class="cky-preference-body-wrapper"><div class="cky-preference-content-wrapper" data-cky-tag="detail-description" style="color: #212121;"><p>We use cookies to help you navigate efficiently and perform certain functions. You will find detailed information about all cookies under each consent category below.</p><p>The cookies that are categorised as "Necessary" are stored on your browser as they are essential for enabling the basic functionalities of the site. ...&nbsp;<button class="cky-show-desc-btn" data-cky-tag="show-desc-button" aria-label="Show more">Show more</button></p></div><div class="cky-horizontal-separator"></div><div class="cky-accordion-wrapper" data-cky-tag="detail-categories"><div class="cky-accordion" id="ckyDetailCategorynecessary"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategorynecessaryBody" aria-label="Necessary" data-cky-tag="detail-category-title" style="color: #212121;">Necessary</button><span class="cky-always-active" data-cky-tag="always-active">Always Active</span></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Necessary cookies are required to enable the basic features of this site, such as providing secure log-in or adjusting your consent preferences. These cookies do not store any personally identifiable data.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategorynecessaryBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__cf_bm</div></li><li><div>Duration</div><div>1 hour</div></li><li><div>Description</div><div>This cookie, set by Cloudflare, is used to support Cloudflare Bot Management. </div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hssrc</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>This cookie is set by Hubspot whenever it changes the session cookie. The __hssrc cookie set to 1 indicates that the user has restarted the browser, and if the cookie does not exist, it is assumed to be a new session.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hssc</div></li><li><div>Duration</div><div>1 hour</div></li><li><div>Description</div><div>HubSpot sets this cookie to keep track of sessions and to determine if HubSpot should increment the session number and timestamps in the __hstc cookie.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_cfuvid</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>Calendly sets this cookie to track users across sessions to optimize user experience by maintaining session consistency and providing personalized services</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryfunctional"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryfunctionalBody" aria-label="Functional" data-cky-tag="detail-category-title" style="color: #212121;">Functional</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchfunctional" aria-label="Enable Functional" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Functional cookies help perform certain functionalities like sharing the content of the website on social media platforms, collecting feedback, and other third-party features.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryfunctionalBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>lidc</div></li><li><div>Duration</div><div>1 day</div></li><li><div>Description</div><div>LinkedIn sets the lidc cookie to facilitate data center selection.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>li_gc</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>Linkedin set this cookie for storing visitor's consent regarding using cookies for non-essential purposes.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryanalytics"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryanalyticsBody" aria-label="Analytics" data-cky-tag="detail-category-title" style="color: #212121;">Analytics</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchanalytics" aria-label="Enable Analytics" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Analytical cookies are used to understand how visitors interact with the website. These cookies help provide information on metrics such as the number of visitors, bounce rate, traffic source, etc.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryanalyticsBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_gcl_au</div></li><li><div>Duration</div><div>3 months</div></li><li><div>Description</div><div>Google Tag Manager sets the cookie to experiment advertisement efficiency of websites using their services.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_ga_*</div></li><li><div>Duration</div><div>1 year 1 month 4 days</div></li><li><div>Description</div><div>Google Analytics sets this cookie to store and count page views.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_ga</div></li><li><div>Duration</div><div>1 year 1 month 4 days</div></li><li><div>Description</div><div>Google Analytics sets this cookie to calculate visitor, session and campaign data and track site usage for the site's analytics report. The cookie stores information anonymously and assigns a randomly generated number to recognise unique visitors.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hstc</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>Hubspot set this main cookie for tracking visitors. It contains the domain, initial timestamp (first visit), last timestamp (last visit), current timestamp (this visit), and session number (increments for each subsequent session).</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>hubspotutk</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>HubSpot sets this cookie to keep track of the visitors to the website. This cookie is passed to HubSpot on form submission and used when deduplicating contacts.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryperformance"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryperformanceBody" aria-label="Performance" data-cky-tag="detail-category-title" style="color: #212121;">Performance</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchperformance" aria-label="Enable Performance" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Performance cookies are used to understand and analyse the key performance indexes of the website which helps in delivering a better user experience for the visitors.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryperformanceBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>session_id</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>This cookie is used to get or set the session id for the current session.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryadvertisement"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryadvertisementBody" aria-label="Advertisement" data-cky-tag="detail-category-title" style="color: #212121;">Advertisement</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchadvertisement" aria-label="Enable Advertisement" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Advertisement cookies are used to provide visitors with customised advertisements based on the pages you visited previously and to analyse the effectiveness of the ad campaigns.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryadvertisementBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>sa-user-id</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>StackAdapt sets this cookie as a third party advertising cookie to record information about a user's website activity, such as the pages visited and the locations viewed, to enable us to provide users with interest-based content and personalised advertisements on external websites.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>sa-user-id-v2</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>StackAdapt sets this cookie as a third party advertising cookie to record information about a user's website activity, such as the pages visited and the locations viewed, to enable us to provide users with interest-based content and personalised advertisements on external websites.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>bcookie</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>LinkedIn sets this cookie from LinkedIn share buttons and ad tags to recognize browser IDs.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>IDE</div></li><li><div>Duration</div><div>1 year 24 days</div></li><li><div>Description</div><div>Google DoubleClick IDE cookies store information about how the user uses the website to present them with relevant ads according to the user profile.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>test_cookie</div></li><li><div>Duration</div><div>15 minutes</div></li><li><div>Description</div><div>doubleclick.net sets this cookie to determine if the user's browser supports cookies.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryother"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryotherBody" aria-label="Uncategorised" data-cky-tag="detail-category-title" style="color: #212121;">Uncategorised</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchother" aria-label="Enable Uncategorised" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Other uncategorised cookies are those that are being analysed and have not been classified into a category as yet.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryotherBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>sa-user-id-v3</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>Description is currently not available.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>calltrk_nearest_tld</div></li><li><div>Duration</div><div>1 year 1 month 4 days</div></li><li><div>Description</div><div>Description is currently not available.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>calltrk_referrer</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>This is a functionality cookie set by the CallRail. This cookie is used to store the referring URL. It helps to accurately attribute the visitor source when displaying a tracking phone number.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>calltrk_landing</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>This is a functionality cookie set by the CallRail. This cookie is used to store the landing page URL. It helps to accurately attribute the visitor source when displaying a tracking phone number.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>frontend_lang</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>No description available.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>libsyn-paywall-s</div></li><li><div>Duration</div><div>1 day</div></li><li><div>Description</div><div>Description is currently not available.</div></li></ul></div></div></div></div></div><div class="cky-footer-wrapper"><span class="cky-footer-shadow" style="background: linear-gradient(180deg, rgba(255, 255, 255, 0) 0%, #EDF1F4 100%);"></span><div class="cky-prefrence-btn-wrapper" data-cky-tag="detail-buttons"><button aria-label="Reject All" class="cky-btn cky-btn-reject" data-cky-tag="detail-reject-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Reject All</button> <button aria-label="Save My Preferences" class="cky-btn cky-btn-preferences" data-cky-tag="detail-save-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Save My Preferences</button> <button aria-label="Accept All" class="cky-btn cky-btn-accept" data-cky-tag="detail-accept-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Accept All</button></div><div data-cky-tag="detail-powered-by" style="padding: 8px 24px; font-size: 12px; font-weight: 400; line-height: 20px; text-align: right; border-radius: 0 0 6px 6px; direction: ltr; display: flex; justify-content: flex-end; align-items: center; color: #293C5B; background-color: #EDEDED;">Powered by <a href="https://www.cookieyes.com/product/cookie-consent/?ref=cypbcyb&amp;utm_source=cookie-banner&amp;utm_medium=powered-by-cookieyes" rel="noopener" style="margin-left:5px;line-height:0" target="_blank"><img alt="Cookieyes logo" src="https://cdn-cookieyes.com/assets/images/poweredbtcky.svg" style="width:78px;height:13px;margin:0" width="78" height="13"></a></div></div></div></div>


	

    

<!-- Global Header -->

<!-- End Global Header -->
		<main id="main" class="main overflow-x-hidden">

			

   



<section class="c-page-header relative bg-code text-white">

    <div class="px-p24 mq768:px-p48 mq1024:px-p56 c-header-wrap v-blog-header">
    <div class="max-w-p1440 mx-auto">
      <div class="flex flex-col mq768:flex-row">
        <div class="flex relative z-20 items-center mq768:w-1/2 order-1 py-p48 mq1024:py-p56 mq768:pr-p64 mq1024:pr-p56">

          <div class="w-full">

            

  
<ul class="mb-p64 mq1024:mb-p80 flex flex-wrap text-white">
                <li class="after:content-['/'] last:after:hidden after:mx-p8"><a class="text-sm hover:underline focus:underline" href="https://trustedsec.com/blog">Blog</a></li>
            <li class="after:content-['/'] last:after:hidden after:mx-p8"><a class="text-sm hover:underline focus:underline" href="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions">Windows Processes, Nefarious Anomalies, and You: Memory Regions</a></li>
     </ul>
                        <div class="mb-p32">

                              <div class="mb-p16">
                  <span class="font-mono text-sm">November 01, 2022</span>
                </div>
              
                                                                <h1 class="text-h1 mq1280:text-title-xl">Windows Processes, Nefarious Anomalies, and You: Memory Regions</h1>
                              
                                        </div>

                          <div class="mb-p16">
                <span class="text-h3 inline-block">
                  Written by
                                                            Brandon McGrath
                                                      </span>
              </div>
            


            
            
            
            <div class="mt-p64">
                          </div>
          </div>
        </div>

        <div class="mq768:flex overflow-hidden items-center mq768:justify-end mq768:w-paired-img max-w-p1080 -mx-p24 mq768:mx-none order-2 mq768:absolute inset-y-0 left-paired-img-plus fx" x-data="" x-fx.left.1200="2rem" style="transform: translate3d(-2rem, 0px, 0px); transition-duration: 1.2s;">
          <div class="relative mq768:static mq768:w-full h-full pt-full -mx-p24 mq768:mx-none">
                          <picture class=" w-full"><source type="image/webp" media="(min-width: 64rem)" srcset="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=600&amp;h=600&amp;q=90&amp;fm=webp&amp;fit=crop&amp;dm=1767067278&amp;s=69a184aec99717a300616ade0d905134, https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=900&amp;h=900&amp;q=90&amp;fm=webp&amp;fit=crop&amp;dm=1767067278&amp;s=21f7f752916253d384c88cf9d23c73cf 1.5x"><source type="image/webp" media="(min-width: 64rem)" srcset="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=600&amp;h=600&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067278&amp;s=b8beddbc62e67d8c41b136cfb080f4ce, https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=900&amp;h=900&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067278&amp;s=eeb64d3f04893b90db8c6f80154e5d7d 1.5x"><source type="image/webp" srcset="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=320&amp;h=320&amp;q=90&amp;fm=webp&amp;fit=crop&amp;dm=1767067278&amp;s=260942d0d0077d2cd741c65cbb732a63, https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=480&amp;h=480&amp;q=90&amp;fm=webp&amp;fit=crop&amp;dm=1767067278&amp;s=16e3f5f1f4f561bf6d700363db397a65 1.5x"><source type="image/webp" srcset="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=320&amp;h=320&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067278&amp;s=4cc8db5321525c4fc883859f5e3270f6, https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=480&amp;h=480&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067278&amp;s=578ba47ad713db855c98d1051f49319d 1.5x"><img class="c-img opacity-0 transition-all duration-300 absolute inset-0 object-cover w-full h-full object-center" src="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part1_WebHero.jpg?w=320&amp;h=320&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067278&amp;s=4cc8db5321525c4fc883859f5e3270f6" loading="eager" x-data="image({mq1024:{width:600,height:600},DEFAULT:{width:320,height:320}})" :width="getSize()" :height="getSize('height')" alt="" width="600" height="600" style="opacity: 1;"></picture>                      </div>
        </div>
      </div>
    </div>
  </div>

</section>


      
			
						<div class="relative"><section id="migratedContent-0" class="c-module relative bg-white text-black py-p64 mq768:py-p96" data-module-num="1" style="z-index: 0;"><div class="px-p24 mq768:px-p48 mq1024:px-p56"><div class="max-w-p1440 mx-auto"><div class="flex flex-col mq1024:flex-row" x-data="{ mobile: ! $breakpoint('mq1024') }" @resize.window="mobile = ! $breakpoint('mq1024')"><div class="mq1024:w-p320 mq1024:pr-p64 grow-0 shrink-0 mq1024:order-1"><div><div class="w-full"><p id="share-label" class="text-xs font-mono mb-p16">Share</p><ul id="share-icons" class="flex items-center" aria-describedby="share-label"><li class="ml-p12"><a href="https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share URL" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-share"></use></svg></span><span class="sr-only">Share URL</span></a></li><li class="ml-p12"><a href="mailto:?subject=Check%20out%20this%20article%20from%20TrustedSec%21&amp;body=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Memory%20Regions%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share via Email" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-email"></use></svg></span><span class="sr-only">Share via Email</span></a></li><li class="ml-p12"><a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share on Facebook" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-facebook"></use></svg></span><span class="sr-only">Share on Facebook</span></a></li><li class="ml-p12"><a href="http://twitter.com/share?text=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Memory%20Regions%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" title="Share on X" rel="nofollow" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-twitter"></use></svg></span><span class="sr-only">Share on X</span></a></li><li class="ml-p12"><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions&amp;mini=true" target="_blank" title="Share on LinkedIn" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-linkedin"></use></svg></span><span class="sr-only">Share on LinkedIn</span></a></li></ul></div></div><div><div class="w-full"><p id="share-label" class="text-xs font-mono mb-p16">Share</p><ul id="share-icons" class="flex items-center" aria-describedby="share-label"><li class="ml-p12"><a href="https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share URL" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-share"></use></svg></span><span class="sr-only">Share URL</span></a></li><li class="ml-p12"><a href="mailto:?subject=Check%20out%20this%20article%20from%20TrustedSec%21&amp;body=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Memory%20Regions%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share via Email" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-email"></use></svg></span><span class="sr-only">Share via Email</span></a></li><li class="ml-p12"><a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share on Facebook" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-facebook"></use></svg></span><span class="sr-only">Share on Facebook</span></a></li><li class="ml-p12"><a href="http://twitter.com/share?text=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Memory%20Regions%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" title="Share on X" rel="nofollow" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-twitter"></use></svg></span><span class="sr-only">Share on X</span></a></li><li class="ml-p12"><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions&amp;mini=true" target="_blank" title="Share on LinkedIn" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-linkedin"></use></svg></span><span class="sr-only">Share on LinkedIn</span></a></li></ul></div></div></div><div class="w-full mq1024:w-content-well mq1024:order-2 flex-1"><div class="c-content"><p>While operating on a red team, the likelihood of an Endpoint Detection and Response (EDR) being present on a host is becoming increasingly higher than it was a few years ago. When an implant is being initiated on a host, whether it’s on-disk or loaded into memory, then there is a lot to consider. In this post, we will focus on one very specific component of EDR: memory scanners.</p><p>A memory scanner is quite self-explanatory. It scans the memory of a process and attempts to identify non-standard attributes within a memory region in effort to determine if the process requires additional analysis and/or containment.</p><p>The community has done a great job of implementing memory scanners to identify malicious activity, and they have been adopted by red teamers as a means to QA their own implants:</p><ul><li><a href="https://github.com/hasherezade/pe-sieve">pe-sieve</a> by <a href="https://twitter.com/hasherezade">Hasherezade</a></li><li><a href="https://github.com/forrest-orr/moneta">Moneta</a> by <a href="https://twitter.com/_forrestorr">Forrest Orr</a></li><li><a href="https://github.com/thefLink/Hunt-Sleeping-Beacons">Hunt-Sleeping-Beacons</a> by <a href="https://twitter.com/thefLinkk">thefLinkk</a></li></ul><p>For extra points, organizations <em>could</em> implement these into their own detection strategy – however, these types of tools look for very specific anomalies within a process, and because of that, may generate false positives.</p><p>In terms of EDR vendors, smaller components of these scanners will likely be in their toolkit, but they must undergo a lot of effort to ensure that false positives don’t make it into production, let alone customer environments. However, they are used for a slightly different purpose within an EDR—typically, when one of the memory scanner indicators is hit, it will trigger further analysis of the process. That could be known-malware signatures, log analysis for that particular process, and so on. An EDR is extremely unlikely to create an alert on an endpoint because RWX was allocated in a process. As we go into this series, we will show the sheer number of false positives that memory scanners can create when scanning everything. However, it <em>may</em> cause the EDR to take a further look into that process (as a naive example).</p><p>In this blog, we will look at what a memory scanner is looking at and why, and then we will identify some low-hanging fruit from a Command &amp; Control (C2) implant.</p><h2>1.&nbsp; Process Structure</h2><p>In its simplest form, a process is an executing program. Under the hood, Windows is an object-oriented system. This means that each component of Windows will essentially boil down to sort of object. As for a process, the Windows Kernel knows this as the <a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/ps/eprocess/index.htm">EPROCESS structure</a>. However, going up a level, this structure is simplified to the <a href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb">Process Environment Block</a> (PEB).</p><pre class="wp-block-preformatted hljs language-css" data-highlighted="yes">typedef struct _PEB {
  BYTE                          Reserved1<span class="hljs-selector-attr">[2]</span>;
  BYTE                          BeingDebugged;
  BYTE                          Reserved2<span class="hljs-selector-attr">[1]</span>;
  PVOID                         Reserved3<span class="hljs-selector-attr">[2]</span>;
  PPEB_LDR_DATA                 Ldr;
  PRTL_USER_PROCESS_PARAMETERS  ProcessParameters;
  PVOID                         Reserved4<span class="hljs-selector-attr">[3]</span>;
  PVOID                         AtlThunkSListPtr;
  PVOID                         Reserved5;
  ULONG                         Reserved6;
  PVOID                         Reserved7;
  ULONG                         Reserved8;
  ULONG                         AtlThunkSListPtr32;
  PVOID                         Reserved9<span class="hljs-selector-attr">[45]</span>;
  BYTE                          Reserved10<span class="hljs-selector-attr">[96]</span>;
  PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine;
  BYTE                          Reserved11<span class="hljs-selector-attr">[128]</span>;
  PVOID                         Reserved12<span class="hljs-selector-attr">[1]</span>;
  ULONG                         SessionId;
} PEB, *PPEB;</pre><p>From this structure, we can get information such as the process name, current directory, loaded Dynamic-Link Libraries (DLLs), and so on. This is the structure we will be working with a lot.</p><p>To simplify this quite a bit, we will focus on three components of a process:</p><ol type="1"><li>Memory regions</li><li>Threads</li><li>Loaded DLLs</li></ol><p>To learn more about the PEB, "<a href="https://ntopcode.wordpress.com/2018/02/26/anatomy-of-the-process-environment-block-peb-windows-internals/">Anatomy of the Process Environment Block (PEB) (Windows Internals)</a>" is recommended reading.</p><h2>2.&nbsp; A Bit of Context</h2><p>For a bit of context, the sample used for this demonstration is going to be an unreleased/proof-of-concept C2 for the <a href="https://pre.empt.dev/posts/maelstrom-an-introduction/">Maelstrom</a> series, as it contains embedded indicators of compromise, which is perfect for this demonstration.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath1.png" alt="" class="wp-image-27876"><figcaption>Figure 1 Maelstrom Implant Existing</figcaption></figure><p>This reaches out to a local IP address, requests a Reflective DLL, and then executes it within memory. We will be searching for that final step.</p><p>One final note: The framework being used in this article to assess the process will not be released, but we will do our best to supply source code to achieve each component of this blog. The tool in question is known as Fennec and will be addressed as such throughout.</p><h2>3.&nbsp; Enumerating Memory Regions</h2><p>Using explorer.exe as an example, let’s use <a href="https://processhacker.sourceforge.io/">Process Hacker</a> to look at the memory regions. This is done by finding a process, double-clicking and going to the Memory tab.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath2.png" alt="" class="wp-image-27877"><figcaption>Figure 2 Process Explorer Memory Regions</figcaption></figure><p>The way to achieve this programmatically is the <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualqueryex">VirtualQueryEx</a> call.</p><pre class="wp-block-preformatted hljs language-css" data-highlighted="yes">SIZE_T VirtualQueryEx(
  <span class="hljs-selector-attr">[in]</span>           HANDLE                    hProcess,
  <span class="hljs-selector-attr">[in, optional]</span> LPCVOID                   lpAddress,
  <span class="hljs-selector-attr">[out]</span>          PMEMORY_BASIC_INFORMATION lpBuffer,
  <span class="hljs-selector-attr">[in]</span>           SIZE_T                    dwLength
);</pre><p>This takes in a few arguments:</p><ul><li>Handle to the process</li><li>A base address to query</li><li>A pointer to a structure</li><li>The size of the previous parameter</li></ul><p>The most important part in this call is what we are expecting to get out of it: <a href="https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-memory_basic_information">MEMORY_BASIC_INFORMATION</a>.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes"> <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">_MEMORY_BASIC_INFORMATION</span> {
  PVOID  BaseAddress;
  PVOID  AllocationBase;
  DWORD  AllocationProtect;
  WORD   PartitionId;
  SIZE_T RegionSize;
  DWORD  State;
  DWORD  Protect;
  DWORD  Type;
} MEMORY_BASIC_INFORMATION, *PMEMORY_BASIC_INFORMATION;</pre><p>This structure will essentially create most of the regions found in the screenshot of Process Hacker, and this will give us 99% of the information required to analyze a processes memory!</p><p>As the scanner we will be producing has an extra member, and to allow for expansion later, a new structure is defined.</p><pre class="wp-block-preformatted hljs language-java" data-highlighted="yes">typedef struct REGION_
{
      <span class="hljs-type">LPVOID</span> <span class="hljs-variable">BaseAddress</span> <span class="hljs-operator">=</span> nullptr;
      <span class="hljs-type">LPVOID</span> <span class="hljs-variable">AllocationBase</span> <span class="hljs-operator">=</span> nullptr;
      <span class="hljs-type">WORD</span> <span class="hljs-variable">PartitionId</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
      <span class="hljs-type">DWORD</span> <span class="hljs-variable">Size</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
      <span class="hljs-type">DWORD</span> <span class="hljs-variable">ActiveProtect</span>     <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
      <span class="hljs-type">DWORD</span> <span class="hljs-variable">InitialProtect</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
      <span class="hljs-type">DWORD</span> <span class="hljs-variable">State</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
      <span class="hljs-type">DWORD</span> <span class="hljs-variable">Type</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
      std::<span class="hljs-type">string</span> <span class="hljs-variable">Use</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
} Region;
</pre><p>In this case, the Use will hold the DLL associated with the region, <em>IF</em> it exists.</p><p>One final thing before we work through all the regions—let’s make a quick note on each of the structure members we actually need:</p><ul><li><strong>Base Address:</strong> The base address of the memory region</li><li><strong>Allocation Base:</strong> The base address of a range of pages which are created by <a href="https://docs.microsoft.com/en-us/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc</a></li><li><strong>Region Size: </strong>The size of the region beginning at the base address of all pages</li><li><strong>State: </strong>Whether it’s committed, freed, or reserved</li><li><strong>Active Protection:</strong> The access protection of the region as of access</li><li><strong>Initial Protection:</strong> The protection it was originally allocated as</li><li><strong>Type:</strong> Whether it’s private, image, or mapped memory (more on this later)</li><li><strong>Use:</strong> The reason that the region exists</li></ul><p>Each of the structures defined will be put into a <a href="https://en.cppreference.com/w/cpp/container/vector">vector</a> (array of objects). Here is the function to query each region, incrementing by the current region's size. Then, we build out the region structure and add it to the vector.</p><pre class="wp-block-preformatted hljs language-ruby" data-highlighted="yes">std::vector&lt;<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Region&gt;</span> <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:GetAllRegions</span>(<span class="hljs-variable constant_">HANDLE</span> hProcess)
{
    std::vector&lt;<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Region&gt;</span> <span class="hljs-title class_">Regions</span>;
    <span class="hljs-variable constant_">MEMORY_BASIC_INFORMATION</span> mbi = { <span class="hljs-number">0</span> };
    <span class="hljs-variable constant_">LPVOID</span> offset = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">while</span> (<span class="hljs-title class_">VirtualQueryEx</span>(hProcess, offset, &amp;mbi, sizeof(mbi)))
    {
        <span class="hljs-keyword">if</span> (mbi.<span class="hljs-title class_">RegionSize</span> &gt; <span class="hljs-number">0</span>)
        {
            offset = (<span class="hljs-variable constant_">LPVOID</span>)((<span class="hljs-variable constant_">DWORD_PTR</span>)mbi.<span class="hljs-title class_">BaseAddress</span> + mbi.<span class="hljs-title class_">RegionSize</span>);
            <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Region</span> <span class="hljs-title class_">Region</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">BaseAddress</span> = mbi.<span class="hljs-title class_">BaseAddress</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">AllocationBase</span> = mbi.<span class="hljs-title class_">AllocationBase</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">PartitionId</span> = mbi.<span class="hljs-title class_">PartitionId</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">Size</span> = mbi.<span class="hljs-title class_">RegionSize</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">ActiveProtect</span> = mbi.<span class="hljs-title class_">Protect</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">InitialProtect</span> = mbi.<span class="hljs-title class_">AllocationProtect</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">State</span> = mbi.<span class="hljs-title class_">State</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">Type</span> = mbi.<span class="hljs-title class_">Type</span>;
            <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">Use</span> = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:GetRegionUse</span>(hProcess, <span class="hljs-title class_">Region</span>);

            <span class="hljs-title class_">Regions</span>.push_back(<span class="hljs-title class_">Region</span>);
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Regions</span>;
}</pre><p>As for the <code>GetRegionUse</code>, this is simply a wrapper around the following function.</p><pre class="wp-block-preformatted hljs language-ruby" data-highlighted="yes">std::string <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:GetModulePath</span>(<span class="hljs-variable constant_">HANDLE</span> hProcess, <span class="hljs-variable constant_">HMODULE</span> hModule)
{
    <span class="hljs-variable constant_">CHAR</span> <span class="hljs-title class_">Path</span>[<span class="hljs-variable constant_">MAX_PATH</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">K32GetModuleFileNameEx</span>A(hProcess, hModule, <span class="hljs-title class_">Path</span>, sizeof(<span class="hljs-title class_">Path</span>) / sizeof(<span class="hljs-variable constant_">CHAR</span>)))
    {
        <span class="hljs-keyword">return</span> std::string(<span class="hljs-title class_">Path</span>);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}</pre><p><a href="https://docs.microsoft.com/en-us/windows/win32/api/psapi/nf-psapi-getmodulefilenameexa">GetModuleFileNameExA</a> takes in a handle to a process and a module (base address), then attempts to retrieve its name. If this succeeds, then the region has a 'use'. This means that the memory region is attributed to something. We can demonstrate that.</p><p>In the following screenshot, we can see the memory regions of WINWORD.EXE, and there are two things to note.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath3.png" alt="" class="wp-image-27878"><figcaption>Figure 3 WINWORD.EXE Memory Use</figcaption></figure><p>First of all, the Use column is filled with various DLLs. Secondly, the memory type is <code>Image: Commit (MEM_IMAGE).</code></p><p>When a DLL is loaded into a process, its memory region will be a mapped image (<code>MEM_IMAGE</code>), and the base address will be that of the DLL—that is where the <code>Use</code> comes from, and that is what we are replicating above.</p><p>As an example, one of the structures would appear as follows.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath4.png" alt="" class="wp-image-27879"><figcaption>Figure 4 Example of a Region Structure</figcaption></figure><p>With that, the enumeration section is done for now. Up next, parsing it for badness.</p><h2>4.&nbsp; Identifying Malicious Attributes in Memory Regions</h2><p>There are many ways to filter through memory regions to mark them as malicious. In this blog, we will look at two low-hanging fruits— RWX and MZ headers in private memory Regions—to ensure that this blog does not go on too long.</p><h3>4.1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PAGE_EXECUTE_READWRITE</h3><p>Out of all the techniques mentioned in this blog, this is the easiest to identify. And like the rest of the techniques, if the memory scanner detects any of these techniques, it does not necessarily mean they are malicious—it is just a potential indicator for further enumeration.</p><p>Below is the code to check for RWX.</p><pre class="wp-block-preformatted hljs language-ruby" data-highlighted="yes">void <span class="hljs-title class_">Scanner</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:HuntRWX</span>(std::vector&lt;<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Region&gt;</span> <span class="hljs-title class_">Regions</span>, <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Comms</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Common</span> <span class="hljs-title class_">Common</span>)
{
	<span class="hljs-keyword">for</span> (<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Region&amp;</span> <span class="hljs-title class_">Region</span> : <span class="hljs-title class_">Regions</span>)
	{
		<span class="hljs-keyword">if</span> (<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">ActiveProtect</span> == <span class="hljs-variable constant_">PAGE_EXECUTE_READWRITE</span>)
		{
			nlohmann::json <span class="hljs-title class_">Json</span>;
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"method"</span>] = <span class="hljs-string">"RWX"</span>;

			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"base_address"</span>] = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Strings</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:LPVOID2StringA</span>(<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">BaseAddress</span>);
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"use"</span>] = <span class="hljs-title class_">Region</span>.<span class="hljs-title class_">Use</span>;
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"allocation_base"</span>] = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Strings</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:LPVOID2StringA</span>(<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">AllocationBase</span>);
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"partition_id"</span>] = std::to_string(<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">PartitionId</span>);
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"region_size"</span>] = std::to_string(<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">Size</span>);
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"region_protection_active"</span>] = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Strings</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:ProtectToString</span>(<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">ActiveProtect</span>);
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"region_allocation_initial"</span>] = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Strings</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:ProtectToString</span>(<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">InitialProtect</span>);
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"region_state"</span>] = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Strings</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:AllocateToString</span>(<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">State</span>);
			<span class="hljs-title class_">Json</span>[<span class="hljs-string">"region_type"</span>] = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Strings</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:TypeToString</span>(<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">Type</span>);

			std::string <span class="hljs-title class_">Log</span> = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Comms</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:ConvertCommonLogStructureToJson</span>(<span class="hljs-title class_">Common</span>, <span class="hljs-title class_">Json</span>);
			<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Logger</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Good</span>(<span class="hljs-string">"RWX Identified: %s\n"</span>, <span class="hljs-title class_">Log</span>.c_str());
			<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Logger</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:WriteLogToFile</span>(<span class="hljs-variable constant_">LOG_TYPE</span>, <span class="hljs-title class_">Log</span>);
		}
	}
}</pre><p>Essentially, we check if the <code>ActiveProtect </code>member of the structure is <code>PAGE_EXECUTE_READWRITE</code>—simple.</p><p>Then we run the scanner.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath5.png" alt="" class="wp-image-27880"><figcaption>Figure 5 Log for RWX Scan</figcaption></figure><p>Beautifying the JSON, here is the full log.</p><pre class="wp-block-preformatted hljs language-swift" data-highlighted="yes">{
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"allocation_base"</span>: <span class="hljs-string">"0x00000000001E0000"</span>,
    <span class="hljs-string">"base_address"</span>: <span class="hljs-string">"0x00000000001E0000"</span>,
    <span class="hljs-string">"method"</span>: <span class="hljs-string">"RWX"</span>,
    <span class="hljs-string">"partition_id"</span>: <span class="hljs-string">"0"</span>,
    <span class="hljs-string">"region_allocation_initial"</span>: <span class="hljs-string">"PAGE_EXECUTE_READWRITE"</span>,
    <span class="hljs-string">"region_protection_active"</span>: <span class="hljs-string">"PAGE_EXECUTE_READWRITE"</span>,
    <span class="hljs-string">"region_size"</span>: <span class="hljs-string">"73728"</span>,
    <span class="hljs-string">"region_state"</span>: <span class="hljs-string">"MEM_COMMIT"</span>,
    <span class="hljs-string">"region_type"</span>: <span class="hljs-string">"MEM_PRIVATE"</span>,
    <span class="hljs-string">"use"</span>: <span class="hljs-string">""</span>
  },
  <span class="hljs-string">"event_category"</span>: <span class="hljs-string">"Memory Scanner"</span>,
  <span class="hljs-string">"event_time"</span>: <span class="hljs-string">"Tue Sep 6 10:07:34 2022"</span>,
  <span class="hljs-string">"guid"</span>: <span class="hljs-string">"e861eb49-08ab-427f-95d7-e8116475c1e8"</span>,
  <span class="hljs-string">"image_name"</span>: <span class="hljs-string">"maelstrom.unsafe.x64.exe"</span>,
  <span class="hljs-string">"image_path"</span>: <span class="hljs-string">"<span class="hljs-subst">\\</span>Device<span class="hljs-subst">\\</span>HarddiskVolume11<span class="hljs-subst">\\</span>maelstrom<span class="hljs-subst">\\</span>agent<span class="hljs-subst">\\</span>stage0<span class="hljs-subst">\\</span>bin<span class="hljs-subst">\\</span>maelstrom.unsafe.x64.exe"</span>,
  <span class="hljs-string">"parent_procecess"</span>: <span class="hljs-number">12652</span>,
  <span class="hljs-string">"process_id"</span>: <span class="hljs-number">15372</span>
}</pre><p>This log structure is common amongst all techniques within the scanner, and it provides a lot of context that could aid in further analysis. For example, in this case, it was allocated as RWX and was not changed at all. However, if this was allocated as RW and made a switch to RX, then this could also be malware, as this is the process to which 99% of implants subscribe.</p><p>In the case of an EDR, checking for protection changes from RW to RX whilst on a memory scan isn’t performed too often. Adjusting the scanner to scan all processes, it produces 498 entries on the host.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath6.png" alt="" class="wp-image-27881"><figcaption>Figure 6 498 RWX Entries Found</figcaption></figure><p>Taking this one step further by checking this information out inside of ELK, we find there are quite a lot of processes that use RWX.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath7.png" alt="" class="wp-image-27882"><figcaption>Figure 7 Image to RWX Log Entry</figcaption></figure><p>To clarify, the left column is the process name, and the right is the amount of log entries in which that process has RWX allocated.</p><h3>4.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MZ Headers in Private Memory Regions</h3><p>This method is far less common, and a bit more complicated to understand. When a DLL is loaded, it gets marked as <code>MEM_IMAGE</code>, one of the types from <a href="https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-memory_basic_information">MEMORY_BASIC_INFORMATION</a>.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath8.png" alt="" class="wp-image-27883"><figcaption>Figure 8 MEMORY_BASIC_INFORMATION Types</figcaption></figure><p>We can see this by opening up Process Hacker, finding a process, and navigating to the <code>Memory</code> section.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath9.png" alt="" class="wp-image-27884"><figcaption>Figure 9 MEM_IMAGE Memory Regions</figcaption></figure><p>In this list, there will also be regions marked as mapped, which equates to the <code>MEM_MAPPED</code> type.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath10.png" alt="" class="wp-image-27885"><figcaption>Figure 10 MEM_MAPPED Memory Regions</figcaption></figure><p>Looking at all the <code>MEM_PRIVATE</code> allocations, they tend to be regions used within the process/DLL for whatever they may need.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath11.png" alt="" class="wp-image-27886"><figcaption>Figure 11 MEM_PRIVATE Memory Regions</figcaption></figure><p>As an example, let’s allocate a big chunk of memory.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes">LPVOID pAddress = <span class="hljs-built_in">VirtualAlloc</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-number">409600</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
	<span class="hljs-built_in">memset</span>(pAddress, <span class="hljs-string">'a'</span>, <span class="hljs-number">409600</span>);</pre><p>Opening up the memory regions, we can see our allocation is <code>Private Memory</code>.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath12.png" alt="" class="wp-image-27887"><figcaption>Figure 12 VirtualAlloc Creating Private Memory</figcaption></figure><p>And then again with <code>malloc</code> (and a VirtualQuery so we can find where it is).</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes">	LPVOID pAddress = (LPVOID)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">409600</span>);
	<span class="hljs-built_in">memset</span>(pAddress, <span class="hljs-string">'a'</span>, <span class="hljs-number">409600</span>);

	MEMORY_BASIC_INFORMATION mbi = { <span class="hljs-number">0</span> };
	<span class="hljs-built_in">VirtualQuery</span>(pAddress, &amp;mbi, <span class="hljs-keyword">sizeof</span> mbi);</pre><p>Here's the result.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath13.png" alt="" class="wp-image-27888"><figcaption>Figure 13 Malloc Creating Private Memory</figcaption></figure><p>As we can see in both cases, the memory is allocated as private, meaning that when ever memory is allocated within a process to do something with a buffer, a region like this will be created.</p><p>Therefore, if a DLL is found within this region, it’s extremely suspicious. If a genuine process needs a legitimate DLL, it will just load it appropriately—it will either load it at runtime as a dependency, or it will dynamically load it with something like <a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">LoadLibraryA</a>.</p><p>Now that we understand why seeing a DLL in private memory is a bit weird, let’s look at how we identify this.</p><p>We begin by identifying all the memory regions as we did earlier and putting their structures into a vector. Now it’s time to parse.</p><p>The first thing we can do is disregard <code>MEM_IMAGE</code> and <code>MEM_MAPPED</code>. As this is more of a proof-of-concept, we don’t need to care about them. With that said, EDRs will respond differently to these types, and this kind of logic is extremely unlikely to occur. But we will do it for now.</p><pre class="wp-block-preformatted hljs language-python" data-highlighted="yes"><span class="hljs-keyword">if</span> (Region.<span class="hljs-type">Type</span> == MEM_MAPPED || Region.<span class="hljs-type">Type</span> == MEM_IMAGE)
{
    <span class="hljs-keyword">continue</span>;
}</pre><p>Next, we define a few things that will be used.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes">BOOL bMzFound = FALSE;
BOOL bIsDLLBacked = FALSE;
std::vector&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>&gt; bytes = { <span class="hljs-number">0x4d</span>, <span class="hljs-number">0x5a</span> };
PCHAR lpBuffer = <span class="hljs-built_in">static_cast</span>&lt;PCHAR&gt;(<span class="hljs-built_in">malloc</span>(Region.Size));</pre><p>Note the bytes vector. 0x4d and 0x5a are the hex values of MZ. We then allocate space into which we can read the entire region.</p><p>Using <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-readprocessmemory">ReadProcessMemory</a>, we then read the region.</p><pre class="wp-block-preformatted hljs language-objectivec" data-highlighted="yes"><span class="hljs-type">BOOL</span> bRead = ReadProcessMemory(hProcess, (LPVOID)Region.BaseAddress, lpBuffer, Region.Size, <span class="hljs-literal">NULL</span>);

<span class="hljs-keyword">if</span> (bRead == <span class="hljs-literal">FALSE</span>)
{
      free(lpBuffer);
      <span class="hljs-keyword">continue</span>;
}</pre><p>In this example, we then get the first two bytes of the region and put them into a vector.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes"><span class="hljs-function">std::vector&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>&gt; <span class="hljs-title">vectorBuffer</span><span class="hljs-params">(lpBuffer, lpBuffer + <span class="hljs-number">2</span>)</span></span>;</pre><p>By simply adding three 0s (000) to the start of the malicious region, this logic would be avoided.</p><p>With that, we compare the newly created 2-byte vector to the <code>MZ</code> vector.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes">BOOL FENNEC::Strings::<span class="hljs-built_in">CompareVectors</span>(std::vector&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>&gt; a, std::vector&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>&gt; b)
{
	<span class="hljs-keyword">if</span> (std::<span class="hljs-built_in">equal</span>(a.<span class="hljs-built_in">begin</span>(), a.<span class="hljs-built_in">end</span>(), b.<span class="hljs-built_in">begin</span>()))
	{
		<span class="hljs-keyword">return</span> TRUE;
	}
	<span class="hljs-keyword">else</span>
	{
		<span class="hljs-keyword">return</span> FALSE;
	}
}</pre><p>At this point, it could potentially be finished. But there is a bit more checking to do first, just to make sure.</p><p>If this returns a 'true' response, the scanner will validate if that region belongs to any DLL in the process. Not strictly required, but worthwhile. To achieve this, there are two methods.</p><p>First, we get every DLL in the process and compare base addresses.</p><pre class="wp-block-preformatted hljs language-ruby" data-highlighted="yes">	std::vector&lt;<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Module&gt;</span> modules = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:GetModules</span>(hProcess);
	<span class="hljs-keyword">for</span> (<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Module&amp;</span> <span class="hljs-title class_">Module</span> : modules)
	{
		<span class="hljs-keyword">if</span> (<span class="hljs-title class_">Region</span>.<span class="hljs-title class_">AllocationBase</span> == <span class="hljs-title class_">Module</span>.<span class="hljs-title class_">BaseAddress</span>)
		{
			bIsDLLBacked = <span class="hljs-variable constant_">TRUE</span>;
			<span class="hljs-keyword">break</span>;
		}
	}</pre><p>Or we can do this manually by parsing the <a href="https://learn.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb_ldr_data" target="_blank" rel="noreferrer noopener">PPEB_LDR_DATA</a> structure.</p><pre class="wp-block-preformatted hljs language-rust" data-highlighted="yes">BOOL FENNEC::PEBLOCK::<span class="hljs-title function_ invoke__">IsBaseAddressWithDll</span>(LPVOID BaseAddress)
{
	PPEB_LDR_DATA Ldr = FENNEC::PEBLOCK::Peb<span class="hljs-punctuation">-&gt;</span>Ldr;
	LIST_ENTRY* ModuleList = NULL;
	BOOL bDllIsBacked = FALSE;

	ModuleList = &amp;Ldr<span class="hljs-punctuation">-&gt;</span>InMemoryOrderModuleList;
	LIST_ENTRY* pStartListEntry = ModuleList<span class="hljs-punctuation">-&gt;</span>Flink;
	<span class="hljs-keyword">for</span> (LIST_ENTRY* pListEntry = pStartListEntry; pListEntry != ModuleList; pListEntry = pListEntry<span class="hljs-punctuation">-&gt;</span>Flink)
	{
		LDR_DATA_TABLE_ENTRY* pEntry = (LDR_DATA_TABLE_ENTRY*)((BYTE*)pListEntry - <span class="hljs-title function_ invoke__">sizeof</span>(LIST_ENTRY));
		std::wstring <span class="hljs-title function_ invoke__">wsName</span>(pEntry<span class="hljs-punctuation">-&gt;</span>BaseDllName.Buffer);
		std::wstring <span class="hljs-title function_ invoke__">wsPath</span>(pEntry<span class="hljs-punctuation">-&gt;</span>FullDllName.Buffer);

		std::string modName = FENNEC::Strings::<span class="hljs-title function_ invoke__">StringW2StringA</span>(wsName);
		std::string modPath = FENNEC::Strings::<span class="hljs-title function_ invoke__">StringW2StringA</span>(wsPath);

		<span class="hljs-keyword">if</span> (BaseAddress == pEntry<span class="hljs-punctuation">-&gt;</span>DllBase)
		{
			bDllIsBacked = TRUE;
			<span class="hljs-keyword">break</span>;
		}
	
	}
	<span class="hljs-keyword">return</span> bDllIsBacked;
}</pre><p>Either way, this will return a 'false' response, as the memory region is not the base address of a DLL.</p><p>Targeting the implant process, it identifies one region.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath14.png" alt="" class="wp-image-27889"><figcaption>Figure 14 MZ Header Found in MEM_PRIVATE</figcaption></figure><p>Here is the full log.</p><pre class="wp-block-preformatted hljs language-swift" data-highlighted="yes">{
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"allocation_base"</span>: <span class="hljs-string">"0x00000000001E0000"</span>,
    <span class="hljs-string">"base_address"</span>: <span class="hljs-string">"0x00000000001E0000"</span>,
    <span class="hljs-string">"method"</span>: <span class="hljs-string">"Memory Allocation without DLL Backing"</span>,
    <span class="hljs-string">"partition_id"</span>: <span class="hljs-string">"0"</span>,
    <span class="hljs-string">"region_allocation_initial"</span>: <span class="hljs-string">"PAGE_EXECUTE_READWRITE"</span>,
    <span class="hljs-string">"region_protection_active"</span>: <span class="hljs-string">"PAGE_EXECUTE_READWRITE"</span>,
    <span class="hljs-string">"region_size"</span>: <span class="hljs-string">"73728"</span>,
    <span class="hljs-string">"region_state"</span>: <span class="hljs-string">"MEM_COMMIT"</span>,
    <span class="hljs-string">"region_type"</span>: <span class="hljs-string">"MEM_PRIVATE"</span>,
    <span class="hljs-string">"use"</span>: <span class="hljs-string">""</span>
  },
  <span class="hljs-string">"event_category"</span>: <span class="hljs-string">"Memory Scanner"</span>,
  <span class="hljs-string">"event_time"</span>: <span class="hljs-string">"Tue Sep  6 11:57:57 2022"</span>,
  <span class="hljs-string">"guid"</span>: <span class="hljs-string">"59cd7a5a-53aa-4ca8-91b4-d76e8feecab1"</span>,
  <span class="hljs-string">"image_name"</span>: <span class="hljs-string">"maelstrom.unsafe.x64.exe"</span>,
  <span class="hljs-string">"image_path"</span>: <span class="hljs-string">"<span class="hljs-subst">\\</span>Device<span class="hljs-subst">\\</span>HarddiskVolume11<span class="hljs-subst">\\</span>maelstrom<span class="hljs-subst">\\</span>agent<span class="hljs-subst">\\</span>stage0<span class="hljs-subst">\\</span>bin<span class="hljs-subst">\\</span>maelstrom.unsafe.x64.exe"</span>,<span class="hljs-string">",
  "</span>parent_procecess<span class="hljs-string">": 12652,
  "</span>process_id<span class="hljs-string">": 15372
}</span></pre><p>As with RWX, this detection strategy is reporting a region. So, the structure above is exactly the same. However, this time the <code>method</code> has changed in the JSON.</p><pre class="wp-block-preformatted hljs language-json" data-highlighted="yes"><span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Memory Allocation without DLL Backing"</span></pre><p>If we run this scanner across every process on the host, only one region is hit.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath15.png" alt="" class="wp-image-27890"><figcaption>Figure 15 Single MZ Header in MEM_PRIVATE Found</figcaption></figure><p>We can verify this by opening Process Hacker and finding the region (<code>0x00000000001E0000</code>).</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath16.png" alt="" class="wp-image-27891"><figcaption>Figure 16 MEM_PRIVATE with MZ Header</figcaption></figure><p>Comparing this to the RWX check, this is far more accurate and a much bigger indicator.</p><h2>5.&nbsp; Conclusion</h2><p>As far as this goes, tools such as <a href="https://github.com/hasherezade/pe-sieve">pe-sieve</a> are a lot better at detecting malicious activity with greater detail and are recommended tools if implant development is required. As for EDRs, some of the utility <em>MAY </em>be too performance intensive and aren’t likely to be used—however, attributes of this will be used and are often used as a basis to trigger further queries, rules, or scripts.</p></div><div class="mb-p24 mt-p56 pt-p32 border-t first:border-t-none"><div class="w-full"><p id="share-label" class="text-xs font-mono mb-p16">Share</p><ul id="share-icons" class="flex items-center" aria-describedby="share-label"><li class="ml-p12"><a href="https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share URL" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-share"></use></svg></span><span class="sr-only">Share URL</span></a></li><li class="ml-p12"><a href="mailto:?subject=Check%20out%20this%20article%20from%20TrustedSec%21&amp;body=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Memory%20Regions%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share via Email" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-email"></use></svg></span><span class="sr-only">Share via Email</span></a></li><li class="ml-p12"><a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" target="_blank" title="Share on Facebook" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-facebook"></use></svg></span><span class="sr-only">Share on Facebook</span></a></li><li class="ml-p12"><a href="http://twitter.com/share?text=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Memory%20Regions%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions" title="Share on X" rel="nofollow" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-twitter"></use></svg></span><span class="sr-only">Share on X</span></a></li><li class="ml-p12"><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-memory-regions&amp;mini=true" target="_blank" title="Share on LinkedIn" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-linkedin"></use></svg></span><span class="sr-only">Share on LinkedIn</span></a></li></ul></div></div></div></div></div></div></section></div>
		</main>

		
		




  
<div class="c-modal fixed inset-0 z-100" x-comp="modal" x-data="modal({id:'modal-component'})" x-show="$store.modal.show" x-trap="$store.modal.show" x-bind:aria-hidden="!$store.modal.show" @keydown="keyPress($event)" x-transition:enter="c-modal-enter" x-transition:enter-start="c-modal-enter-start" x-transition:enter-end="c-modal-enter-end" x-transition:leave="c-modal-leave" x-transition:leave-start="c-modal-leave-start" x-transition:leave-end="c-modal-leave-end" aria-hidden="true" style="display: none;">
    <div class="w-full h-full bg-overlay fixed inset-0 z-0" tabindex="-1">

    <div class="relative z-10 flex flex-col w-full h-full justify-center items-center p-p12 mq768:p-none">
      <div id="modal-component" class="c-modal-box relative outline-none false w-full m-p24 max-w-p768" :class="modalClass(true)" :tabindex="($store.modal.show) ? '-1' : false" :aria-labelledby="showHeading() ? 'modal-component-title' : false" :aria-label="getLabel()" @focus="activate()" aria-role="dialog" x-ref="dialog">
        
          
        
        
          <div class="c-content p-p32" tabindex="-1" x-ref="content"></div>
        
        <button class="absolute z-50 overflow-hidden w-p24 h-p24 flex items-center justify-center border-black border top-p24 right-p24 group hover:bg-black" @click="closeModal()">
          <svg role="presentation" class="c-icon h-p12 w-p12 group-hover:fill-white"><use xlink:href="/ui/icons.svg?1.26#icon-close"></use></svg>
          <span class="sr-only">Close</span>
        </button>
        <button x-show="$store.modal.transcript" class="text-btn text-white uppercase tracking-widest px-p8 py-p16" @click="showTranscript($event)" x-text="$store.modal.showTranscript ? 'Hide Transcript' : 'Show Transcript'" style="display: none;">Show Transcript</button>
      </div>
      <div x-show="$store.modal.showTranscript" class="relative -top-ms bg-white text-segment w-full max-w-p768 mx-auto overflow-auto px-sm false m-p24" :class="modalClass()" x-ref="transcript" style="display: none;">
        <div x-collapse.duration.700ms="" style="height: 0px; overflow: hidden;">
          <div class="py-p32 mq768:px-p32" id="modal-transcript" tabindex="0"></div>
        </div>
      </div>
    </div>

  </div>
  </div>
		<!-- Start cookieyes banner --> 
 
<!-- End cookieyes banner -->

		
	


</body></html>