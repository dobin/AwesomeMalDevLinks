Title:
10 Years of DLL Hijacking, and What We Can Do to Prevent 10 More

Type:
Blog Post

Short Summary (4–8 sentences max):
- This write-up reviews a decade of Windows DLL hijacking/sideloading activity (as cataloged in MITRE ATT&CK T1574.002) and breaks down common real-world patterns, abused executables, and how malicious DLLs are constructed.  
- It frames DLL hijacking as an execution-flow hijack via a benign executable’s DLL dependencies, commonly used for evasion (trusted parent process), persistence (piggyback on routinely launched apps), and privilege escalation (abusing higher-integrity processes/UAC realities).  
- The authors highlight that the dominant operational pattern is “simple bundling”: dropping a legitimate EXE and a malicious same-name DLL in the same directory so the loader resolves the attacker DLL first.  
- It also provides reverse-engineering observations of malicious DLLs (e.g., XOR deobfuscation loops, export stubs where many exports point to the same malicious routine, and proxying mistakes/typos).  
- On prevention, it focuses on developer-side mitigations: hardening DLL search behavior (e.g., `SetDllDirectory("")`, safe search mode, `LoadLibraryEx` with constrained search paths) and signature enforcement (`LOAD_LIBRARY_REQUIRE_SIGNED_TARGET`).  
- A key contribution is a PoC “homebrew Authenticode-like” approach: sign a DLL with a self-signed cert, append the signature as an overlay, embed the cert in the loader EXE, verify before loading, then load only if verification succeeds—useful when avoiding CA overhead.  
- Useful for red teams and malware analysts for understanding prevalent sideloading tradecraft, and for blue teams/developers to prioritize practical mitigations beyond reputation-based trust.

Technical Focus:
- Windows DLL search order / DLL preloading & sideloading (T1574.002)
- PE imports, runtime loading (`LoadLibrary`, `LoadLibraryEx`) and search-path controls
- Developer mitigations: `SetDllDirectory`, `SetSearchPathMode`, fully-qualified DLL paths
- Digital signature enforcement (`LOAD_LIBRARY_REQUIRE_SIGNED_TARGET`) and trust models
- Malicious DLL implementation patterns (export forwarding/proxying, stub exports, XOR obfuscation)
- Hunting approaches (ProcMon “NAME NOT FOUND”, EDR telemetry, hijacklibs, Spartacus)

Use Cases:
- Identify and triage applications vulnerable to DLL search-order hijacking
- Build detections for suspicious DLL loads (unsigned/mismatched signature, unusual load directory)
- Reverse engineer sideloaded DLL payloads by recognizing common export-stub/obfuscation patterns
- Harden in-house Windows applications against sideloading via safer load paths and signature checks
- Create controlled PoCs to validate organizational exposure and mitigation effectiveness

Keywords:
DLL hijacking, DLL sideloading, T1574.002, Windows loader, DLL search order, LoadLibrary, LoadLibraryEx, SetDllDirectory, SetSearchPathMode, LOAD_LIBRARY_REQUIRE_SIGNED_TARGET, Authenticode, self-signed certificate, OpenSSL, PE import table, export proxying, WinSxS, ProcMon, EDR telemetry, hijacklibs, Spartacus