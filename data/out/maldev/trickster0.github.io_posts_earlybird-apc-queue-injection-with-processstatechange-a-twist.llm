Title:
EarlyBird APC Queue Injection With a ProcessStateChange Twist

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post presents a variation of EarlyBird APC queue injection that leverages newer Windows process/thread “state change” objects to suspend and resume execution without calling the classic `ResumeThread` pattern.  
- It builds on Yarden Shafir’s research into `NtCreateProcessStateChange` / `NtChangeProcessState` (and related thread APIs) introduced in newer Windows 10 Insider builds and Windows 11 to track suspension state via kernel objects.  
- The PoC creates a process (Notepad), suspends it via a ProcessStateChange handle, allocates and writes shellcode, queues an APC to the primary thread, then resumes execution by changing the process state back—shifting observable injection telemetry.  
- The author notes the sample is still trivially detectable due to common APIs (`VirtualAllocEx`, `WriteProcessMemory`, `QueueUserAPC`), but suggests direct syscalls (e.g., SysWhispers) to reduce user-mode API hooking visibility.  
- Useful for red teams and malware developers exploring alternative injection flows and for blue teams to understand and detect emerging Windows internals primitives being abused for evasion.

Technical Focus:
- EarlyBird APC queue code injection
- Process/Thread State Change objects (`NtCreateProcessStateChange`, `NtChangeProcessState`)
- Windows 10/11 NTAPI and ntdll exports
- Remote memory allocation and writing (`VirtualAllocEx`, `WriteProcessMemory`)
- EDR evasion via altered API/telemetry patterns (direct syscalls / SysWhispers)

Use Cases:
- Implementing alternative process injection chains that avoid `CreateProcess(..., CREATE_SUSPENDED)` + `ResumeThread`
- Researching detection opportunities around ProcessStateChange object usage
- Building PoCs to test EDR coverage for new NTAPI primitives
- Developing syscall-based variants to bypass user-mode hooks

Keywords:
EarlyBird, APC injection, QueueUserAPC, process injection, NtCreateProcessStateChange, NtChangeProcessState, NtCreateThreadStateChange, NtChangeThreadState, Windows 11, Windows 10 Insider, NTAPI, ntdll, SysWhispers, direct syscalls, VirtualAllocEx, WriteProcessMemory, CreateProcess, EDR evasion, thread suspension, process state tracking