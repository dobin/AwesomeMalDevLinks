# https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/

<!DOCTYPE html><html lang="en-US" class="js-focus-visible js" data-js-focus-visible="" style="--wp--custom--scrollbar-width: 0px;">

<body class="wp-singular post-template-default single single-post postid-80327 single-format-standard wp-embed-responsive wp-theme-blog-in-a-box wp-child-theme-security-blog-2025 microsoft-uhf light">
<a class="skip-link screen-reader-text" href="https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/#wp--skip-link--target">Skip to content</a><div id="ms-cookie-banner"></div>
<a class="skip-link screen-reader-text" id="wp-skip-link" href="https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/#wp--skip-link--target">Skip to content</a><div class="wp-site-blocks"><div class="wp-block-template-part wp-block-template-part--header"><div id="headerArea" class="uhf" data-m="{&quot;cN&quot;:&quot;headerArea&quot;,&quot;cT&quot;:&quot;Area_coreuiArea&quot;,&quot;id&quot;:&quot;a1Body&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;Body&quot;}">
                <div id="headerRegion" data-region-key="headerregion" data-m="{&quot;cN&quot;:&quot;headerRegion&quot;,&quot;cT&quot;:&quot;Region_coreui-region&quot;,&quot;id&quot;:&quot;r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;a1&quot;}" style="overflow-x: visible;">

    <div id="headerUniversalHeader" data-m="{&quot;cN&quot;:&quot;headerUniversalHeader&quot;,&quot;cT&quot;:&quot;Module_coreui-universalheader&quot;,&quot;id&quot;:&quot;m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;r1a1&quot;}" data-module-id="Category|headerRegion|coreui-region|headerUniversalHeader|coreui-universalheader" style="overflow-x: visible;">
        






        







    </div>
        </div>

    </div>
</div>



<main class="wp-block-group has-global-padding is-layout-constrained wp-container-core-group-is-layout-7db9d80f wp-block-group-is-layout-constrained wp-block-pattern" style="padding-right:0;padding-left:0" id="wp--skip-link--target">
<div style="padding-bottom:var(--wp--preset--spacing--2-xl);" class="section alignfull wp-block-bloginabox-theme-section has-global-padding is-layout-constrained wp-block-section-is-layout-constrained">
	
<div class="section__background alignfull is-layout-constrained">

				<div class="section-background-image-wrapper section-background-image-wrapper--light section-background-image-wrapper--desktop alignfull" style="opacity: 100%">
							<img src="https://www.microsoft.com/en-us/security/blog/wp-content/themes/security-blog-2025/dist/images/single-bg.jpg" alt="" class="section-background__image">					</div>
	
				<div class="section-background-image-wrapper section-background-image-wrapper--dark section-background-image-wrapper--desktop alignfull" style="opacity: 100%">
							<img src="https://www.microsoft.com/en-us/security/blog/wp-content/themes/security-blog-2025/dist/images/single-bg-dark.jpg" alt="" class="section-background__image">					</div>
	
		
		</div>
<div class="section__content alignfull is-layout-constrained">
	



</div>
</div>



<hr class="wp-block-separator alignfull has-alpha-channel-opacity is-style-x-thick" style="margin-top:0;margin-bottom:0">



<div class="wp-block-columns alignfull is-style-sidebar has-blur-background-color has-background is-layout-flex wp-container-core-columns-is-layout-eb450259 wp-block-columns-is-layout-flex" style="margin-top:0;margin-bottom:0;padding-top:var(--wp--preset--spacing--xl);padding-right:0;padding-bottom:var(--wp--preset--spacing--2-xl);padding-left:0">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<div class="social-share wp-block-bloginabox-theme-social-share">

			<h2 class="social-share__headline">Share</h2>
	
	<ul class="social-share__list" data-bi-an="Rail">
					<li class="social-share__item">
				<a href="https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/" data-bi-bhvr="120" data-bi-tn="Social share" data-bi-ct="share link" data-bi-cn="Copy share link" aria-label="Copy share link" data-copy-url="https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/" class="social-share__link social-share--share-link copy-link">
					<span aria-hidden="true" class="bloginabox-theme-svg"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 28 28"><path stroke="#223440" stroke-width="2.333" d="M4.667 14v9.333A2.333 2.333 0 0 0 7 25.667h14a2.333 2.333 0 0 0 2.333-2.334V14"></path><path stroke="#000" stroke-width="2.333" d="M18.667 7 14 2.334 9.333 7M14 2.334V17.5"></path></svg></span>											<span class="social-share__copy-notice" id="copy-notice">
							Link copied to clipboard!						</span>
									</a>
			</li>
					<li class="social-share__item">
				<a href="https://www.facebook.com/sharer/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/" data-bi-bhvr="120" data-bi-tn="Social share" data-bi-ct="share link" data-bi-cn="Share on Facebook" aria-label="Share on Facebook" target="_blank" rel="noreferrer noopener" class="social-share__link social-share--facebook">
					<span aria-hidden="true" class="bloginabox-theme-svg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"><g><path fill="#0067B8" d="M23.73 11.636C23.73 5.21 18.52 0 12.093 0S.457 5.21.457 11.636c0 5.81 4.255 10.623 9.818 11.496V15H7.321v-3.364h2.954V9.073c0-2.916 1.737-4.528 4.396-4.528 1.272 0 2.604.228 2.604.228v2.863h-1.468c-1.445 0-1.895.898-1.895 1.819v2.181h3.227L16.623 15h-2.711v8.132c5.563-.873 9.818-5.687 9.818-11.496"></path><path fill="#fff" d="m16.623 15 .515-3.364h-3.227V9.455c0-.92.45-1.819 1.896-1.819h1.468V4.773s-1.332-.228-2.605-.228c-2.659 0-4.395 1.612-4.395 4.528v2.563H7.32V15h2.955v8.132a11.7 11.7 0 0 0 3.636 0V15z"></path></g><defs><path fill="#fff" d="M.457 0H23.73v23.273H.457z"></path></defs></svg></span>									</a>
			</li>
					<li class="social-share__item">
				<a href="https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/&amp;text=FinFisher+exposed%3A+A+researcher%E2%80%99s+tale+of+defeating+traps%2C+tricks%2C+and+complex+virtual+machines" data-bi-bhvr="120" data-bi-tn="Social share" data-bi-ct="share link" data-bi-cn="Share on X" aria-label="Share on X" target="_blank" rel="noreferrer noopener" class="social-share__link social-share--x">
					<span aria-hidden="true" class="bloginabox-theme-svg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"><circle cx="12.366" cy="11.635" r="11.635" fill="#0F1419"></circle><path fill="#fff" d="m13.474 10.745 4.331-4.927H16.78l-3.763 4.277-3.003-4.278H6.548l4.543 6.47-4.543 5.165h1.026l3.972-4.518 3.172 4.519h3.465l-4.71-6.708Zm-5.53-4.17h1.577l2.956 4.136.46.645 3.842 5.376h-1.577z"></path></svg></span>									</a>
			</li>
					<li class="social-share__item">
				<a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/" data-bi-bhvr="120" data-bi-tn="Social share" data-bi-ct="share link" data-bi-cn="Share on LinkedIn" aria-label="Share on LinkedIn" target="_blank" rel="noreferrer noopener" class="social-share__link social-share--linkedin">
					<span aria-hidden="true" class="bloginabox-theme-svg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"><g><path fill="#0067B8" d="M19.884 20.283h-3.45v-5.535c0-1.305-.038-3.005-1.783-3.005-1.783 0-2.092 1.423-2.092 2.926v5.614h-3.45V8.936h3.294v1.542h.04a3.54 3.54 0 0 1 3.294-1.819c3.488 0 4.147 2.372 4.147 5.417zM5.194 7.393c-1.124 0-2.016-.909-2.016-2.055s.892-2.056 2.016-2.056 2.015.91 2.015 2.056-.891 2.056-2.015 2.056Zm1.744 12.89H3.45V8.936H6.9v11.347zM21.628 0H1.706C.775 0 0 .751 0 1.7v20.402c0 .95.775 1.74 1.705 1.7H21.59c.93 0 1.705-.75 1.744-1.7V1.7c0-.949-.775-1.7-1.706-1.7"></path></g><defs><path fill="#fff" d="M0 0h24v24H0z"></path></defs></svg></span>									</a>
			</li>
			</ul>
</div>



<div style="height:var(--wp--preset--spacing--lg)" aria-hidden="true" class="wp-block-spacer"></div>



<div class="taxonomy-list wp-block-bloginabox-theme-post-taxonomy-list" data-bi-an="Rail">
			<div class="taxonomy-terms" data-taxonomy="content-type">
			<h2 class="taxonomy-terms__heading" aria-hidden="false">Content types</h2>
			<ul class="taxonomy-terms__list" id="taxonomy-content-type-80327">
				<li class="taxonomy-terms__term"><a href="https://www.microsoft.com/en-us/security/blog/content-type/research/" class="taxonomy-terms__link" data-bi-id="3663" data-bi-name="content-type" data-bi-cn="Research" data-bi-ct="Post Categories">Research</a></li>			</ul>
		</div>
			<div class="taxonomy-terms" data-taxonomy="topic">
			<h2 class="taxonomy-terms__heading" aria-hidden="false">Topics</h2>
			<ul class="taxonomy-terms__list" id="taxonomy-topic-80327">
				<li class="taxonomy-terms__term"><a href="https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/" class="taxonomy-terms__link" data-bi-id="3687" data-bi-name="topic" data-bi-cn="Threat intelligence" data-bi-ct="Post Categories">Threat intelligence</a></li>			</ul>
		</div>
	</div>



</div>



<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow"><div class="entry-content wp-block-post-content has-global-padding is-layout-constrained wp-block-post-content-is-layout-constrained">
<p class="wp-block-paragraph">Office 365 Advanced Threat Protection (<a href="https://products.office.com/en-us/exchange/online-email-threat-protection?ocid=cx-blog-mmpc" target="_blank" rel="noopener">Office 365 ATP</a>) blocked many <a href="https://cloudblogs.microsoft.com/microsoftsecure/2017/11/21/office-365-advanced-threat-protection-defense-for-corporate-networks-against-recent-office-exploit-attacks/" target="_blank" rel="noopener">notable zero-day exploits</a> in 2017. In our analysis, one activity group stood out: <a href="https://blogs.technet.microsoft.com/mmpc/2016/12/14/twin-zero-day-attacks-promethium-and-neodymium-target-individuals-in-europe/" target="_blank" rel="noopener">NEODYMIUM</a>. This threat actor is remarkable for two reasons:</p>



<ul class="wp-block-list">
<li class="wp-block-list-item">Its access to sophisticated zero-day exploits for Microsoft and Adobe software</li>



<li class="wp-block-list-item">Its use of an advanced piece of government-grade surveillance spyware FinFisher, also known as FinSpy and detected by Microsoft security products as <a href="https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Backdoor:Win32/Wingbird.A!dha" target="_blank" rel="noopener">Wingbird</a></li>
</ul>



<p class="wp-block-paragraph">FinFisher is such a complex piece of malware that, like other researchers, we had to devise special methods to crack it. We needed to do this to understand the techniques FinFisher uses to compromise and persist on a machine, and to validate the effectiveness of Office 365 ATP detonation sandbox, Windows Defender Advanced Threat Protection (<a href="https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc" target="_blank" rel="noopener">Windows Defender ATP</a>) generic detections, and other Microsoft security solutions.</p>



<p class="wp-block-paragraph">This task proved to be nontrivial. FinFisher is not afraid of using all kinds of tricks, ranging from junk instructions and “spaghetti code” to multiple layers of virtual machines and several known and lesser-known anti-debug and defensive measures. Security analysts are typically equipped with the tools to defeat a good number of similar tricks during malware investigations. However, FinFisher is in a different category of malware for the level of its anti-analysis protection. It’s a complicated puzzle that can be solved by skilled reverse engineers only with good amount of time, code, automation, and creativity. The intricate anti-analysis methods reveal how much effort the FinFisher authors exerted to keep the malware hidden and difficult to analyze.</p>



<p class="wp-block-paragraph">This exercise revealed tons of information about techniques used by FinFisher that we used to make Office 365 ATP more resistant to sandbox detection and Windows Defender ATP to catch similar techniques and generic behaviors. Using intelligence from our in-depth investigation, Windows Defender ATP can raise alerts for malicious behavior employed by FinFisher (such as memory injection in persistence) in different stages of the attack kill chain. <a href="https://cloudblogs.microsoft.com/microsoftsecure/2017/08/03/windows-defender-atp-machine-learning-detecting-new-and-unusual-breach-activity/" target="_blank" rel="noopener">Machine learning in Windows Defender ATP</a> further flags suspicious behaviors observed related to the manipulation of legitimate Windows binaries.</p>



<figure class="wp-block-image"><img decoding="async" width="1024" height="635" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig1-windows-defender-atp-alert-finfisher-1024x635.png" alt="Figure 1. Generic Windows Defender ATP detections trigger alerts on FinFisher behavior" class="wp-image-80333"></figure>



<p class="wp-block-paragraph"><em>Figure 1. Generic Windows Defender ATP detections trigger alerts on FinFisher behavior</em></p>



<p class="wp-block-paragraph">While our analysis has allowed us to immediately protect our customers, we’d like to share our insights and add to the growing number of published analyses by other talented researchers (listed below this blog post). We hope that this blog post helps other researchers to understand and analyze FinFisher samples and that this industry-wide information-sharing translate to the protection of as many customers as possible.</p>



<h2 class="wp-block-heading" id="spaghetti-and-junk-codes-make-common-analyst-tools-ineffective">Spaghetti and junk codes make common analyst tools ineffective</h2>



<p class="wp-block-paragraph">In analyzing FinFisher, the first obfuscation problem that requires a solution is the removal of junk instructions and “spaghetti code”, which is a technique that aims to confuse disassembly programs. Spaghetti code makes the program flow hard to read by adding continuous code jumps, hence the name. An example of FinFisher’s spaghetti code is shown below.</p>



<figure class="wp-block-image"><img decoding="async" width="292" height="421" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig2-spaghetti-code.png" alt="Figure 2. The spaghetti code in FinFisher dropper" class="wp-image-80336"></figure>



<p class="wp-block-paragraph"><em>Figure 2. The spaghetti code in FinFisher dropper</em></p>



<p class="wp-block-paragraph">This problem is not novel, and in common situations there are known reversing plugins that may help for this task. In the case of FinFisher, however, we could not find a good existing interactive disassembler (IDA) plugin that can normalize the code flow. So we decided to write our own plugin code using IDA Python. Armed with this code, we removed this first layer of anti-analysis protection.</p>



<p class="wp-block-paragraph">Removing the junk instructions revealed a readable block of code. This code starts by allocating two chunks of memory: a global 1 MB buffer and one 64 KB buffer per thread. The big first buffer is used as index for multiple concurrent threads. A big chunk of data is extracted from the portable executable (PE) file itself and decrypted two times using a custom XOR algorithm. We determined that this chunk of data contains an array of opcode instructions ready to be interpreted by a custom virtual machine program (from this point on referenced generically as “VM”) implemented by FinFisher authors.</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="700" height="400" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig3-FinFisher-stages.png" alt="Figure 3. The stages of the FinFisher multi-layered protection mechanisms" class="wp-image-80339"></figure>



<p class="wp-block-paragraph"><em>Figure 3. The stages of the FinFisher multi-layered protection mechanisms</em></p>



<h2 class="wp-block-heading" id="stage-0-dropper-with-custom-virtual-machine">Stage 0: Dropper with custom virtual machine</h2>



<p class="wp-block-paragraph">The main dropper implements the VM dispatcher loop and can use 32 different opcodes handlers. Th 64KB buffer is used as a VM descriptor data structure to store data and the just-in-time (JIT) generated code to run. The VM dispatcher loop routine ends with a JMP to another routine. In total, there are 32 different routines, each of them implementing a different opcode and some basic functionality that the malware program may execute.</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="1000" height="442" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig4-VM-opcode.png" alt="Figure 4. A snapshot of the code that processes each VM opcode and the associate interpreter" class="wp-image-80342"></figure>



<p class="wp-block-paragraph"><em>Figure 4. A snapshot of the code that processes each VM opcode and the associate interpreter</em></p>



<p class="wp-block-paragraph">The presence of a VM and virtualized instruction blocks can be described in simpler terms: Essentially, the creators of FinFisher interposed a layer of dynamic code translation (the virtual machine) that makes analysis using regular tools practically impossible. Static analysis tools like IDA may not be useful in analyzing custom code that is interpreted and executed through a VM and a new set of instructions. On the other hand, dynamic analysis tools (like debuggers or sandbox) face the anti-debug and anti-analysis tricks hidden in the virtualized code itself that detects sandbox environments and alters the behavior of the malware.</p>



<p class="wp-block-paragraph">At this stage, the analysis can only continue by manually investigating the individual code blocks and opcode handlers, which are highly obfuscated (also using spaghetti code). Reusing our deobfuscation tool and some other tricks, we have been able to reverse and analyze these opcodes and map them to a finite list that can be used later to automate the analysis process with some scripting.</p>



<p class="wp-block-paragraph">The opcode instructions generated by this custom VM are divided into different categories:</p>



<ol class="wp-block-list">
<li class="wp-block-list-item">Logical opcodes, which implement bit-logic operators (OR, AND, NOT, XOR) and mathematical operators</li>



<li class="wp-block-list-item">Conditional branching opcodes, which implement a code branch based on conditions (equals to JC, JE, JZ, other similar branching opcodes)</li>



<li class="wp-block-list-item">Load/Store opcodes, which write to or read from particular addresses of the virtual address space of the process</li>



<li class="wp-block-list-item">Specialized opcodes for various purposes, like execute specialized machine instruction that are not virtualized</li>
</ol>



<p class="wp-block-paragraph">We are publishing below the (hopefully) complete list of opcodes used by FinFisher VM that we found during our analysis and integrated into our de-virtualization script:</p>



<figure class="wp-block-table table"><table class="has-fixed-layout"><tbody><tr><td><strong>INDEX</strong></td><td><strong>MNEMONIC</strong></td><td><strong>DESCRIPTION</strong></td></tr><tr><td>0x0</td><td>EXEC</td><td>Execute machine code</td></tr><tr><td>0x1</td><td>JG</td><td>Jump if greater/Jump if not less or equal</td></tr><tr><td>0x2</td><td>WRITE</td><td>Write a value into the dereferenced internal VM value (treated as a pointer)</td></tr><tr><td>0x3</td><td>JNO</td><td>Jump if not overflow</td></tr><tr><td>0x4</td><td>JLE</td><td>Jump if less or equal (signed)</td></tr><tr><td>0x5</td><td>MOV</td><td>Move the value of a register into the VM descriptor (same as opcode 0x1F)</td></tr><tr><td>0x6</td><td>JO</td><td>Jump if overflow</td></tr><tr><td>0x7</td><td>PUSH</td><td>Push the internal VM value to the stack</td></tr><tr><td>0x8</td><td>ZERO</td><td>Reset the internal VM value to 0 (zero)</td></tr><tr><td>0x9</td><td>JP</td><td>Jump if parity even</td></tr><tr><td>0xA</td><td>WRITE</td><td>Write into an address</td></tr><tr><td>0xB</td><td>ADD</td><td>Add the value of a register to the internal VM value</td></tr><tr><td>0xC</td><td>JNS</td><td>Jump if not signed</td></tr><tr><td>0xD</td><td>JL</td><td>Jump if less (signed)</td></tr><tr><td>0xE</td><td>EXEC</td><td>Execute machine code and branch</td></tr><tr><td>0xF</td><td>JBE</td><td>Jump if below or equal or Jump if not above</td></tr><tr><td>0x10</td><td>SHL</td><td>Shift left the internal value the number of times specified into the opcodes</td></tr><tr><td>0x11</td><td>JA</td><td>Jump if above/Jump if not below or equal</td></tr><tr><td>0x12</td><td>MOV</td><td>Move the internal VM value into a register</td></tr><tr><td>0x13</td><td>JZ</td><td>JMP if zero</td></tr><tr><td>0x14</td><td>ADD</td><td>Add an immediate value to the internal Vm descriptor</td></tr><tr><td>0x15</td><td>JB</td><td>Jump if below (unsigned)</td></tr><tr><td>0x16</td><td>JS</td><td>Jump if signed</td></tr><tr><td>0x17</td><td>EXEC</td><td>Execute machine code (same as opcode <em>0x0</em>)</td></tr><tr><td>0x18</td><td>JGE</td><td>Jump if greater or equal/Jump if not less</td></tr><tr><td>0x19</td><td>DEREF</td><td>Write a register value into a dereferenced pointer</td></tr><tr><td>0x1A</td><td>JMP</td><td>Special obfuscated “Jump if below” opcode</td></tr><tr><td>0x1B</td><td>*</td><td>Resolve a pointer</td></tr><tr><td>0x1C</td><td>LOAD</td><td>Load a value into the internal VM descriptor</td></tr><tr><td>0x1D</td><td>JNE</td><td>Jump if not equal/Jump if not zero</td></tr><tr><td>0x1E</td><td>CALL</td><td>Call an external function or a function located in the dropper</td></tr><tr><td>0x1F</td><td>MOV</td><td>Move the value of a register into the VM descriptor</td></tr><tr><td>0x20</td><td>JNB</td><td>Jump if not below/Jump if above or equal/Jump if not carry</td></tr><tr><td>0x21</td><td>JNP</td><td>Jump if not parity/Jump if parity odd</td></tr></tbody></table></figure>



<p class="wp-block-paragraph">Each virtual instruction is stored in a special data structure that contains all the information needed to be properly read and executed by the VM. This data structure is 24 bytes and is composed of some fixed fields and a variable portion that depends on the opcode. Before interpreting the opcode, the VM decrypts the opcode’s content (through a simple XOR algorithm), which it then relocates (if needed), using the relocation fields.</p>



<p class="wp-block-paragraph">Here is an approximate diagram of the opcode data structure:</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="852" height="208" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig5-data-structure-vm-opcode.png" alt="Figure 5. A graphical representation of the data structure used to store each VM opcode" class="wp-image-80345"></figure>



<p class="wp-block-paragraph"><em>Figure 5. A graphical representation of the data structure used to store each VM opcode</em></p>



<p class="wp-block-paragraph">The VM handler is completely able to generate different code blocks and deal with relocated code due to address space layout randomization (ASLR). It is also able to move code execution into different locations if needed. For instance, in the case of the “Execute” opcode (<em>0x17</em>), the 32-bit code to run is stored entirely into the variable section with the value at offset 5 specifying the number of bytes to be copied and executed. Otherwise, in the case of conditional opcodes, the variable part can contain the next JIT packet ID or the next relative virtual address (RVA) where code execution should continue.</p>



<p class="wp-block-paragraph">Of course, not all the opcodes are can be easily read and understood due to additional steps that the authors have taken to make analysis extremely complicated. For example, this is how opcode <em>0x1A</em> is implemented: The opcode should represent a JB (Jump if below) function, but it’s implemented through set carry (STC) instruction followed by a JMP into the dispatcher code that will verify the carry flag condition set by STC.</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="1024" height="287" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig6-obfuscation-1024x287.png" alt="Figure 6. One of the obfuscation tricks included by the malware authors in a VM opcode dispatcher" class="wp-image-80348"></figure>



<p class="wp-block-paragraph"><em>Figure 6. One of the obfuscation tricks included by the malware authors in a VM opcode dispatcher</em></p>



<p class="wp-block-paragraph">Even armed with the knowledge we have described so far, it still took us many hours to write a full-fledged opcode interpreter that’s able to reconstruct the real code executed by FinFisher.</p>



<h2 class="wp-block-heading" id="stage-1-loader-malware-keeps-sandbox-and-debuggers-away">Stage 1: Loader malware keeps sandbox and debuggers away</h2>



<p class="wp-block-paragraph">The first stage of FinFisher running through this complicated virtual machine is a loader malware designed to probe the system and determine whether it’s running in a sandbox environment (typical for cloud-based detonation solution like Office 365 ATP).</p>



<p class="wp-block-paragraph">The loader first dynamically rebuilds a simple import address table (IAT), resolving all the API needed from Kernel32 and NtDll libraries. It then continues executing in a spawned new thread that checks if there are additional undesired modules inside its own virtual address space (for example, modules injected by certain security solutions). It eventually kills all threads that belong to these undesired modules (using <em>ZwQueryInformationThread</em> native API with <em>ThreadQuerySetWin32StartAddress</em> information class).</p>



<p class="wp-block-paragraph">The first anti-sandbox technique is the loader checking the code segment. If it’s not <em>0x1B</em> (for 32-bit systems) or <em>0x23</em> (for 32-bit system under Wow64), the loader exits.</p>



<p class="wp-block-paragraph">Next, the dropper checks its own parent process for indications that it is running in a sandbox setup. It calculates the MD5 hash of the lower-case process image name and terminates if one of the following conditions are met:</p>



<ol class="wp-block-list">
<li class="wp-block-list-item">The MD5 hash of the parent process image name is either D0C4DBFA1F3962AED583F6FCE666F8BC or 3CE30F5FED4C67053379518EACFCF879</li>



<li class="wp-block-list-item">The parent process’s full image path is equal to its own process path</li>
</ol>



<p class="wp-block-paragraph">If these initial checks are passed, the loader builds a complete IAT by reading four imported libraries from disk (<em>ntdll.dll</em>, <em>kernel32.dll</em>, <em>advapi32.dll</em>, and <em>version.dll</em>) and remapping them in memory. This technique makes use of debuggers and software breakpoints useless. During this stage, the loader may also call a certain API using native system calls, which is another way to bypass breakpoints on API and security solutions using hooks.</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="667" height="339" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig7-finfisher-loader.png" alt="Figure 7. FinFisher loader calling native Windows API to perform anti-debugging tricks" class="wp-image-80351"></figure>



<p class="wp-block-paragraph"><em>Figure 7. FinFisher loader calling native Windows API to perform anti-debugging tricks</em></p>



<p class="wp-block-paragraph">At this point, the fun in analysis is not over. A lot of additional anti-sandbox checks are performed in this exact order:</p>



<ol class="wp-block-list">
<li class="wp-block-list-item">Check that the malware is not executed under the root folder of a drive</li>



<li class="wp-block-list-item">Check that the malware file is readable from an external source</li>



<li class="wp-block-list-item">Check that the hash of base path is not 3D6D62AF1A7C8053DBC8E110A530C679</li>



<li class="wp-block-list-item">Check that the full malware path contains only human readable characters (“a-z”, “A-Z”, and “0-9”)</li>



<li class="wp-block-list-item">Check that no node in the full path contains the MD5 string of the malware file</li>



<li class="wp-block-list-item">Fingerprint the system and check the following registry values:
<ol style="list-style-type:lower-alpha" class="wp-block-list">
<li class="wp-block-list-item"><em>HKLM\SOFTWARE\Microsoft\Cryptography\MachineGuid</em> should not be “6ba1d002-21ed-4dbe-afb5-08cf8b81ca32”</li>



<li class="wp-block-list-item"><em>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DigitalProductId</em> should not be “55274-649-6478953-23109”, “A22-00001”, or “47220”</li>



<li class="wp-block-list-item"><em>HARDWARE\Description\System\SystemBiosDate</em> should not contain “01/02/03”</li>
</ol>
</li>



<li class="wp-block-list-item">Check that the mutex <em>WininetStartupMutex0</em> does not already exist</li>



<li class="wp-block-list-item">Check that no DLL whose base name has hash value of 0xC9CEF3E4 is mapped into the malware address space</li>
</ol>



<p class="wp-block-paragraph">The hashes in these checks are most likely correspond to sandbox or security products that the FinFisher authors want to avoid.</p>



<p class="wp-block-paragraph">Next, the loader checks that it’s not running in a virtualized environment (VMWare or Hyper-V) or under a debugger. For the hardware virtualization check, the loader obtains the hardware device list and checks if the MD5 of the vendor ID is equal to a predefined list. In our tests, the malware sample was able to easily detect both VMWare and Hyper-V environments through the detection of the virtualized peripherals (for example, Vmware has VEN_15AD as vendor ID, HyperV has VMBus as bus name). Office 365 ATP sandbox employs special mechanisms to avoid being detected by similar checks.</p>



<p class="wp-block-paragraph">The loader’s anti-debugger code is based on the following three methods:</p>



<ol class="wp-block-list">
<li class="wp-block-list-item">The first call aims to destroy the debugger connection:</li>
</ol>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="850" height="20" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/finfisher-anti-debugger-1.png" alt="" class="wp-image-80456"></figure>



<p class="wp-block-paragraph">NOTE: This call completely stops the execution of WinDbg and other debuggers</p>



<ol start="2" class="wp-block-list">
<li class="wp-block-list-item">The second call tries to detect the presence of a debugger:</li>
</ol>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="850" height="37" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/finfisher-anti-debugger-2.png" alt="" class="wp-image-80459"></figure>



<ol start="3" class="wp-block-list">
<li class="wp-block-list-item">The final call tries to destroy the possibility of adding software breakpoint:</li>
</ol>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="850" height="37" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/finfisher-anti-debugger-3.png" alt="" class="wp-image-80462"></figure>



<p class="wp-block-paragraph"></p>



<p class="wp-block-paragraph">Finally, if the loader is happy with all the checks done so far, based on the victim operating system (32 or 64-bit) it proceeds to decrypt a set of fake bitmap resources (stage 2) embedded in the executable and prepares the execution of a new layer of VM decoding.</p>



<p class="wp-block-paragraph">Each bitmap resource is extracted, stripped of the first 0x428 bytes (BMP headers and garbage data), and combined into one file. The block is decrypted using a customized algorithm that uses a key derived from the original malware dropper’s <em>TimeDateStamp</em> field multiplied by 5.</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="689" height="329" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig8-finfisher-fake-bitmap.png" alt="Figure 8. The fake bitmap image embedded as resource" class="wp-image-80354"></figure>



<p class="wp-block-paragraph"><em>Figure 8. The fake bitmap image embedded as resource</em></p>



<p class="wp-block-paragraph">The 32-bit stage 2 malware uses a customized loading mechanism (i.e., the PE file has a scrambled IAT and relocation table) and exports only one function. For the 64-bit stage 2 malware, the code execution is transferred from the loader using a <a href="https://www.malwaretech.com/2014/02/the-0x33-segment-selector-heavens-gate.html" target="_blank" rel="noopener">well-known</a> technique called <a href="http://www.alex-ionescu.com/?p=300" target="_blank" rel="noopener">Heaven’s Gate</a>. In the next sections, for simplicity, we will continue the analysis only on the 64-bit payload.</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="401" height="165" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig9-finfisher-heaven-s-gate.png" alt="" class="wp-image-80357"></figure>



<p class="wp-block-paragraph"></p>



<p class="wp-block-paragraph"><em>Figure 9. Heaven’s gate is still in use in 2017</em></p>



<h2 class="wp-block-heading" id="stage-2-a-second-multi-platform-virtual-machine">Stage 2: A second multi-platform virtual machine</h2>



<p class="wp-block-paragraph">The 64-bit stage 2 malware implements another loader combined with another virtual machine. The architecture is quite similar to the one described previously, but the opcodes are slightly different. After reversing these opcodes, we were able to update our interpreter script to support both 32-bit and 64-bit virtual machines used by FinFisher.</p>



<figure class="wp-block-table table"><table class="has-fixed-layout"><tbody><tr><td><strong>INDEX</strong></td><td><strong>MNEMONIC</strong></td><td><strong>DESCRIPTION</strong></td></tr><tr><td>0x0</td><td>JMP</td><td>Special obfuscated conditional Jump (always taken or always ignored)</td></tr><tr><td>0x1</td><td>JMP</td><td>Jump to a function (same as opcode 0x10)</td></tr><tr><td>0x2</td><td>CALL</td><td>Call to the function pointed by the internal VM value</td></tr><tr><td>0x3</td><td>CALL</td><td>Optimized CALL function (like the 0x1E opcode of the 32-bit VM)</td></tr><tr><td>0x4</td><td>EXEC</td><td>Execute code and move to the next packet</td></tr><tr><td>0x5</td><td>JMP</td><td>Jump to an internal function</td></tr><tr><td>0x6</td><td>NOP</td><td>No operation, move to the next packet</td></tr><tr><td>0x7</td><td>CALL</td><td>Call an imported API (whose address is stored in the internal VM value)</td></tr><tr><td>0x8</td><td>LOAD</td><td>Load a value into the VM descriptor structure <strong>*</strong></td></tr><tr><td>0x9</td><td>STORE</td><td>Store the internal VM value inside a register</td></tr><tr><td>0xA</td><td>WRITE</td><td>Resolve a pointer and store the value of a register in its content</td></tr><tr><td>0xB</td><td>READ</td><td>Move the value pointed by the VM internal value into a register</td></tr><tr><td>0xC</td><td>LOAD</td><td>Load a value into the VM descriptor structure (not optimized)</td></tr><tr><td>0xD</td><td>CMP</td><td>Compare the value pointed by the internal VM descriptor with a register</td></tr><tr><td>0xE</td><td>CMP</td><td>Compare the value pointed by the internal VM descriptor with an immediate value</td></tr><tr><td>0xF</td><td>XCHG</td><td>Exchange the value pointed by the internal VM descriptor with a register</td></tr><tr><td>0x10</td><td>SHL</td><td>Jump to a function (same as opcode 0x1)</td></tr></tbody></table></figure>



<p class="wp-block-paragraph">This additional virtual machine performs the same duties as the one already described but in a 64-bit environment. It extracts and decrypts the stage 3 malware, which is stored in encrypted resources such as fake dialog boxes. The extraction method is the same, but the encryption algorithm (also XOR) is much simpler. The new payload is decrypted, remapped, and executed in memory, and represents the installation and persistence stage of the malware.</p>



<h2 class="wp-block-heading" id="stage-3-installer-that-takes-dll-side-loading-to-a-new-level">Stage 3: Installer that takes DLL side-loading to a new level</h2>



<p class="wp-block-paragraph">Stage 3 represents the setup program for FinFisher. It is the first plain stage that does not employ a VM or obfuscation. The code supports two different installation methods: setup in a UAC-enforced environment (with limited privileges), or an installation with full-administrative privileges enabled (in cases where the malware gains the ability to run with elevated permissions). We were a bit disappointed that we did not see traces of a true privilege escalation exploit after all this deobfuscation work, but it seems these FinFisher samples were designed to work just using UAC bypasses.</p>



<p class="wp-block-paragraph">The setup code receives an installation command from the previous stage. In our test, this command was the value <em>3</em>. The malware creates a global event named <em>0x0A7F1FFAB12BB2</em> and drops some files under a folder located in <em>C:\ProgramData</em> or in the user application data folder. The name of the folder and the malware configuration are read from a customized configuration file stored in the resource section of the setup program.</p>



<p class="wp-block-paragraph">Here the list of the files potentially dropped during the installation stage:</p>



<figure class="wp-block-table table"><table class="has-fixed-layout"><tbody><tr><td><strong>FILE NAME</strong></td><td><strong>STAGE</strong></td><td><strong>DESCRIPTION</strong></td></tr><tr><td>d3d9.dll</td><td>Stage 4</td><td>Malware loader used for UAC environments with limited privileges; also protected by VM obfuscation</td></tr><tr><td>aepic.dll, sspisrv.dll, userenv.dll</td><td>Stage 4</td><td>Malware loader used in presence of administrative privileges; executed from (and injected into) a fake service; also protected by VM obfuscation</td></tr><tr><td>msvcr90.dll</td><td>Stage 5</td><td>Malware payload injected into the <em>explorer.exe</em> or <em>winlogon.exe</em> process; also protected by VM obfuscation</td></tr><tr><td>&lt;randomName&gt;.cab</td><td>Config</td><td>Main configuration file; encrypted</td></tr><tr><td>setup.cab</td><td>Unknown</td><td>Last section of the setup executable; content still unknown</td></tr><tr><td>&lt;randomName&gt;.7z</td><td>Plugin</td><td>Malware plugin used to spy the victim network communications</td></tr><tr><td>wsecedit.rar</td><td>Stage 6</td><td>Main malware executable</td></tr></tbody></table></figure>



<p class="wp-block-paragraph">After writing some of these files, the malware decides which kind of installation to perform based on the current privilege provided by the hosting process (for example, if a Microsoft Office process was used as exploit vector):</p>



<ol class="wp-block-list">
<li class="wp-block-list-item"><strong>Installation process under UAC</strong></li>
</ol>



<p class="wp-block-paragraph">When running under a limited UAC account, the installer extracts d3d9.dll and creates a persistence key under <em>HKCU\Software\Microsoft\Windows\Run</em>. The malware sets a registry value (whose name is read from the configuration file) to <em>“C:\Windows\system32\rundll32.exe c:\ProgramData\AuditApp\d3d9.dll, Control_Run”</em>. Before doing this, the malware makes a screenshot of the screen and displays it on top of all other windows for few seconds. This indicates that the authors are trying to hide some messages showed by the system during the setup process.</p>



<p class="wp-block-paragraph">When loaded with startup command <em>2</em>, the installer can copy the original <em>explorer.exe</em> file inside its current running directory and rename <em>d3d9.dll</em> to <em>uxtheme.dll</em>. In this case the persistence is achieved by loading the original explorer.exe from its startup location and, using DLL side-loading, passing the execution control to the stage 4 malware (discussed in next section).</p>



<p class="wp-block-paragraph">Finally, the malware spawns a thread that has the goal to load, remap, and relocate the stage 5 malware. In this context, there is indeed no need to execute the stage 4 malware. The <em>msvcr90.dll</em> file is opened, read, and decrypted, and the code execution control is transferred to the <em>RunDll</em> exported routine.</p>



<p class="wp-block-paragraph">In the case of 32-bit systems, the malware may attempt a known UAC bypass by launching <em>printui.exe</em> system process and using token manipulation with <em>NtFilterToken</em> as described in this blog post.</p>



<ol start="2" class="wp-block-list">
<li class="wp-block-list-item"><strong>Installation process with administrative privilege</strong></li>
</ol>



<p class="wp-block-paragraph">This installation method is more interesting because it reveals how the malware tries to achieve stealthier persistence on the machine. The method is a well-known trick used by penetration testers that was automated and generalized by FinFisher</p>



<p class="wp-block-paragraph">The procedure starts by enumerating the <em>KnownDlls</em> object directory and then scanning for section objects of the cached system DLLs. Next, the malware enumerates all .exe programs in the <em>%System%</em> folder and looks for an original signed Windows binary that imports from at least one <em>KnownDll</em> and from a library that is not in the <em>KnownDll</em> directory. When a suitable .exe file candidate is found, it is copied into the malware installation folder (for example, <em>C:\ProgramData</em>). At this point the malware extracts and decrypts a stub DLL from its own resources (ID 101). It then calls a routine that adds a code section to a target module. This section will contain a fake export table mimicking the same export table of the original system DLL chosen. At the time of writing, the dropper supports <em>aepic.dll</em>, <em>sspisrv.dll</em>, <em>ftllib.dll</em>, and <em>userenv.dll</em> to host the malicious FinFisher payload. Finally, a new Windows service is created with the service path pointing to the candidate .exe located in this new directory together with the freshly created, benign-looking DLL.</p>



<p class="wp-block-paragraph">In this way, when the service runs during boot, the original Windows executable is executed from a different location and it will automatically load and map the malicious DLL inside its address space, instead of using the genuine system library. This routine is a form of generic and variable generator of DLL side-loading combinations.</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="1024" height="725" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig10-windows-defender-atp-side-loading-1024x725.png" alt="Figure 10. Windows Defender ATP timeline can pinpoint the service DLL side-loading trick (in this example, using fltlib.dll)." class="wp-image-80360"></figure>



<p class="wp-block-paragraph"><em>Figure 10. Windows Defender ATP timeline can pinpoint the service DLL side-loading trick (in this example, using fltlib.dll).</em></p>



<p class="wp-block-paragraph">In the past, we have seen other activity groups like LEAD employ a similar attacker technique named “proxy-library” to achieve persistence, but not with this professionalism. The said technique brings the advantage of avoiding auto-start extensibility points (ASEP) scanners and programs that checks for binaries installed as service (for the latter, the service chosen by FinFisher will show up as a clean Windows signed binary).</p>



<p class="wp-block-paragraph">The malware cleans the system event logs using <em>OpenEventLog/ClearEventLog</em> APIs, and then terminates the setup procedure with a call to <em>StartService</em> to run the stage 4 malware.</p>



<figure class="wp-block-image"><img loading="lazy" decoding="async" width="1024" height="528" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2018/03/fig11-finfisher-side-loading-1024x528.png" alt="Figure 11. The DLL side-loaded stage 4 malware mimicking a real export table to avoid detection" class="wp-image-80366"></figure>



<p class="wp-block-paragraph"><em>Figure 11. The DLL side-loaded stage 4 malware mimicking a real export table to avoid detection</em></p>



<h2 class="wp-block-heading" id="stage-4-the-memory-loader-fun-injection-with-gdi-function-hijacking">Stage 4: The memory loader – Fun injection with GDI function hijacking</h2>



<p class="wp-block-paragraph">Depending on how stage 4 was launched, two different things may happen:</p>



<ul class="wp-block-list">
<li class="wp-block-list-item">In the low-integrity case (under UAC) the installer simply injects the stage 5 malware into the bogus <em>explorer.exe</em> process started earlier and terminates</li>



<li class="wp-block-list-item">In the high-integrity case (with administrative privileges or after UAC bypass), the code searches for the process hosting the Plug and Play service (usually <em>svchost.exe</em>) loaded in memory and injects itself into it</li>
</ul>



<p class="wp-block-paragraph">For the second scenario, the injection process works like this:</p>



<ol class="wp-block-list">
<li class="wp-block-list-item">The malware opens the target service process.</li>



<li class="wp-block-list-item">It allocates and fills four chunks of memory inside the service process. One chunk contains the entire malware DLL code (without PE headers). Another chunk is used to copy a basic <em>Ntdll</em> and <em>Kernel32</em> import address table. Two chunks are filled with an asynchronous procedure call (APC) routine code and a stub.</li>



<li class="wp-block-list-item">It opens the service thread of the service process and uses the <em>ZwQueueApcThread</em> native API to inject an APC.</li>
</ol>



<p class="wp-block-paragraph">The APC routine creates a thread in the context of the svchost.exe process that will map and execute the stage 5 malware into the <em>winlogon.exe</em> process.</p>



<p class="wp-block-paragraph">The injection method used for <em>winlogon.exe</em> is also interesting and quite unusual. We believe that this method is engineered to avoid trivial detection of process injection using the well-detected<em> CreateRemoteThread</em> or <em>ZwQueueApcThread API</em>.</p>



<p class="wp-block-paragraph">The malware takes these steps:</p>



<ol class="wp-block-list">
<li class="wp-block-list-item">Check if the system master boot record (MBR) contains an infection marker (<em>0xD289C989C089</em> 8-bytes value at offset <em>0x2C</em>), and, if so, terminate itself</li>



<li class="wp-block-list-item">Check again if the process is attached to a debugger (using the techniques described previously)</li>



<li class="wp-block-list-item">Read, decrypt, and map the stage 5 malware (written in the previous stage in <em>msvcr90.dll</em>)</li>



<li class="wp-block-list-item">Open <em>winlogon.exe</em> process</li>



<li class="wp-block-list-item">Load <em>user32.dll</em> system library and read the <em>KernelCallbackTable</em> pointer from its own process environment block (PEB) (Note: The <em>KernelCallbackTable</em> points to an array of graphic functions used by Win32 kernel subsystem module <em>win32k.sys</em> as call-back into user-mode.)</li>



<li class="wp-block-list-item">Calculate the difference between this pointer and the User32 base address.</li>



<li class="wp-block-list-item">Copy the stage 5 DLL into winlogon.exe</li>



<li class="wp-block-list-item">Allocate a chunk of memory in winlogon.exe process and copy the same APC routine seen previously</li>



<li class="wp-block-list-item">Read and save the original pointer of the <em>__fnDWORD</em> internal User32 routine (located at offset <em>+0x10</em> of the <em>KernelCallbackTable</em>) and replace this pointer with the address of the APC stub routine</li>
</ol>



<p class="wp-block-paragraph">After this function pointer hijacking, when <em>winlogon.exe</em> makes any graphical call (GDI), the malicious code can execute without using <em>CreateRemoteThread</em> or similar triggers that are easily detectable. After execution it takes care of restoring the original <em>KernelCallbackTable</em>.</p>



<h2 class="wp-block-heading" id="stage-5-the-final-loader-takes-control">Stage 5: The final loader takes control</h2>



<p class="wp-block-paragraph">The stage 5 malware is needed only to provide one more layer of obfuscation, through the VM, of the final malware payload and to set up a special Structured Exception Hander routine, which is inserted as <em>Wow64PrepareForException</em> in <em>Ntdll</em>. This special exception handler is needed to manage some memory buffers protection and special exceptions that are used to provide more stealthy execution.</p>



<p class="wp-block-paragraph">After the VM code has checked again the user environment, it proceeds to extract and execute the final un-obfuscated payload sample directly into winlogon.exe (alternatively, into <em>explorer.exe</em>) process. After the payload is extracted, decrypted, and mapped in the process memory, the malware calls the new DLL entry point, and then the <em>RunDll</em> exported function. The latter implements the entire spyware program.</p>



<h2 class="wp-block-heading" id="stage-6-the-payload-is-a-modular-spyware-framework-for-further-analysis">Stage 6: The payload is a modular spyware framework for further analysis</h2>



<p class="wp-block-paragraph">Our journey to deobfuscating FinFisher has allowed us to uncover the complex anti-analysis techniques used by this malware, as well as to use this intel to protect our customers, which is our top priority. Analysis of the additional spyware modules is future work.</p>



<p class="wp-block-paragraph">It is evident that the ultimate goal of this program is to steal information. The malware architecture is modular, which means that it can execute plugins. The plugins are stored in its resource section and can be protected by the same VM. The sample we analyzed in October, for example, contains a plugin that is able to spy on internet connections, and can even divert some SSL connections and steal data from encrypted traffic.</p>



<p class="wp-block-paragraph">Some FinFisher variants incorporate an <a href="http://artemonsecurity.blogspot.com/2017/01/finfisher-rootkit-analysis.html" target="_blank" rel="noopener">MBR rootkit</a>, the exact purpose of which is not clear. Quite possibly, this routine targets older platforms like Windows 7 and machines not taking advantage of hardware protections like UEFI and SecureBoot, available on Windows 10. Describing this additional piece of code in detail is outside the scope of this analysis and may require a new dedicated blog post.</p>



<h2 class="wp-block-heading" id="defense-against-finfisher">Defense against FinFisher</h2>



<p class="wp-block-paragraph">Exposing as much of FinFisher’s riddles as possible during this painstaking analysis has allowed us to ensure our customers are protected against this advanced piece of malware.</p>



<p class="wp-block-paragraph"><a href="https://www.microsoft.com/en-us/windows/windows-10-s?ocid=cx-blog-mmpc" target="_blank" rel="noopener">Windows 10 S</a> devices are naturally protected against FinFisher and other threats thanks to the strong code integrity policies that don’t allow unknown unsigned binaries to run (thus stopping FinFisher’s PE installer) or loaded (blocking FinFisher’s DLL persistence). On <a href="https://www.microsoft.com/en-us/windows/get-windows-10?ocid=cx-blog-mmpc" target="_blank" rel="noopener">Windows 10</a>, similar code integrity policies can be configured using <a href="https://cloudblogs.microsoft.com/microsoftsecure/2017/10/23/introducing-windows-defender-application-control/" target="_blank" rel="noopener">Windows Defender Application Control</a>.</p>



<p class="wp-block-paragraph"><a href="https://products.office.com/en-us/exchange/online-email-threat-protection?ocid=cx-blog-mmpc" target="_blank" rel="noopener">Office 365 Advanced Threat Protection</a> secures mailboxes from <a href="https://cloudblogs.microsoft.com/microsoftsecure/2017/11/21/office-365-advanced-threat-protection-defense-for-corporate-networks-against-recent-office-exploit-attacks/" target="_blank" rel="noopener">email campaigns that use zero-day exploits</a> to deliver threats like FinFisher. Office 365 ATP blocks unsafe attachments, malicious links, and linked-to files using time-of-click protection. Using intel from this research, we have made Office 365 ATP more resistant to FinFisher’s anti-sandbox checks.</p>



<p class="wp-block-paragraph">Generic detections, advanced behavioral analytics, and machine learning technologies in <a href="https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc" target="_blank" rel="noopener">Windows Defender Advanced Threat Protection</a> detect FinFisher’s malicious behavior throughout the attack kill chain and alert SecOps personnel. Windows Defender ATP also integrates with the Windows protection stack so that protections from <a href="https://www.microsoft.com/en-us/windows/windows-defender?ocid=cx-blog-mmpc" target="_blank" rel="noopener">Windows Defender AV</a> and <a href="https://blogs.technet.microsoft.com/mmpc/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/" target="_blank" rel="noopener">Windows Defender Exploit Guard</a> are reported in <a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-atp/use-windows-defender-advanced-threat-protection" target="_blank" rel="noopener">Windows Defender ATP portal</a>, enabling SecOps personnel to centrally manage security, and as well as promptly investigate and respond to hostile activity in the network.</p>



<p class="wp-block-paragraph">We hope that this writeup of our journey through all the multiple layers of protection, obfuscation, and anti-analysis techniques of FinFisher will be useful to other researchers studying this malware. We believe that an industry-wide collaboration and information-sharing is important in defending customers against this complex piece of malware. For further reading, we recommend these other great references:</p>



<ul class="wp-block-list">
<li class="wp-block-list-item"><a href="http://linuxch.org/poc2012/Tora,%20Devirtualizing%20FinSpy.pdf" target="_blank" rel="noopener">Devirtualizing FinSpy</a> [PDF], Tora (2012)</li>



<li class="wp-block-list-item"><a href="http://artemonsecurity.blogspot.com/2017/01/finfisher-rootkit-analysis.html" target="_blank" rel="noopener">Finfisher rootkit analysis</a>, Artem Baranov (2017)</li>



<li class="wp-block-list-item"><a href="http://www.msreverseengineering.com/blog/2018/1/23/a-walk-through-tutorial-with-code-on-statically-unpacking-the-finspy-vm-part-one-x86-deobfuscation" target="_blank" rel="noopener">A Walk-Through Tutorial, with Code, on Statically Unpacking the FinSpy VM: Part One, x86 Deobfuscation</a>, Rolf Rolles (2018)</li>



<li class="wp-block-list-item"><a href="http://www.msreverseengineering.com/blog/2018/1/31/finspy-vm-part-2-vm-analysis-and-bytecode-disassembly" target="_blank" rel="noopener">FinSpy VM Part 2: VM Analysis and Bytecode Disassembly</a>, Rolf Rolles (2018)</li>



<li class="wp-block-list-item"><a href="https://www.welivesecurity.com/wp-content/uploads/2018/01/WP-FinFisher.pdf" target="_blank" rel="noopener">ESET’s guide to deobfuscating and devirtualizing FinFisher</a> [PDF], Filip Kafka (2018)</li>
</ul>



<p class="wp-block-paragraph">To test how Windows Defender ATP can help your organization detect, investigate, and respond to advanced attacks, <strong><a href="https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc" target="_blank" rel="noopener">sign up for a free trial</a></strong>.</p>



<p class="wp-block-paragraph"><em><strong>Andrea Allievi</strong>, Office 365 ATP Research team</em><br><em>with <strong>Elia Florio</strong>, Windows Defender ATP Research team</em></p>



<p class="wp-block-paragraph">Sample analyzed:</p>



<p class="wp-block-paragraph">MD5: a7b990d5f57b244dd17e9a937a41e7f5<br>SHA-1: c217d48c4ac1555491348721cc7cfd1143fe0b16<br>SHA-256: b035ca2d174e5e4fd2d66fd3c8ce4ae5c1e75cf3290af872d1adb2658852afb8</p>



<hr class="wp-block-separator has-alpha-channel-opacity">



<h2 class="wp-block-heading" id="talk-to-us"><strong>Talk to us</strong></h2>



<p class="wp-block-paragraph">Questions, concerns, or insights on this story? Join discussions at the <a href="https://answers.microsoft.com/en-us/protect" target="_blank" rel="noopener">Microsoft community</a> and <a href="https://www.microsoft.com/en-us/wdsi" target="_blank" rel="noopener">Windows Defender Security Intelligence</a>.</p>



<p class="wp-block-paragraph">Follow us on Twitter <a href="https://twitter.com/WDSecurity" target="_blank" rel="noopener">@WDSecurity</a> and Facebook <a href="https://www.facebook.com/MsftWDSI/" target="_blank" rel="noopener">Windows Defender Security Intelligence</a>.</p>
</div></div>
</div>




<div class="alignwide wp-block-bloginabox-theme-carousel is-layout-flow wp-block-carousel-is-layout-flow wp-block-pattern" data-wp-interactive="bloginabox-theme/carousel" data-wp-class--has-peek="context.hasPeek" data-wp-context="{&quot;isFirst&quot;:true,&quot;isLast&quot;:false,&quot;slides&quot;:[],&quot;hasPeek&quot;:true}">
	<div class="wp-block-bloginabox-theme-carousel__track" data-wp-init="callbacks.init" data-wp-on-window--resize="actions.onScroll" data-wp-on--scroll="actions.onScroll" style="--slides-per-view:3">
		
	
<div class="wp-block-bloginabox-theme-authors-loop is-layout-flow wp-block-authors-loop-is-layout-flow">
	
		
<div class="wp-block-bloginabox-theme-carousel-item is-layout-flow wp-block-authors-loop-is-layout-flow">
	
			<div class="wp-block-bloginabox-theme-author-overview">
	
<div class="author-overview author-overview--compact" data-bi-an="Author Bio">
	<div class="author-overview__media">
					<div class="author-overview__avatar">
									<img alt="" src="https://www.microsoft.com/en-us/security/blog/wp-content/themes/blog-in-a-box/dist/images/default-avatar.png" class="avatar avatar-212 photo avatar-default author-overview__avatar-img" height="212" width="212" loading="lazy">							</div>
		
					<ul class="author-overview__social">
						<li class="author-overview__social-item">
			<a href="https://x.com/MsftSecIntel" class="author-overview__social-link author-overview__social-link--x" target="_blank" rel="noopener noreferrer" data-bi-bhvr="126" data-bi-cn="X" data-bi-an="Get to know more about Microsoft Threat Intelligence" data-bi-ct="follow link" aria-label="Follow Microsoft Threat Intelligence on X">
				<span class="screen-reader-text">X</span>
			</a>
		</li>
				<li class="author-overview__social-item">
			<a href="https://www.linkedin.com/showcase/microsoft-threat-intelligence/" class="author-overview__social-link author-overview__social-link--linkedin" target="_blank" rel="noopener noreferrer" data-bi-bhvr="126" data-bi-cn="LinkedIn" data-bi-an="Get to know more about Microsoft Threat Intelligence" data-bi-ct="follow link" aria-label="Follow Microsoft Threat Intelligence on LinkedIn">
				<span class="screen-reader-text">LinkedIn</span>
			</a>
		</li>
					</ul>
			</div>

	<div class="author-overview__content">
					<h2 class="author-overview__title">
			Microsoft Threat Intelligence			</h2>
		
		
													<a href="https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/" class="author-overview__link" data-bi-bhvr="0" data-bi-cn="See Microsoft Threat Intelligence posts" data-bi-an="Get to know more about Microsoft Threat Intelligence">
				See Microsoft Threat Intelligence posts			</a>
			</div>
</div>
</div>

		</div>

	</div>

	</div>
	<div class="wp-block-bloginabox-theme-carousel__navigation is-disabled" data-wp-class--is-disabled="context.isDisabled">
		<button aria-disabled="true" aria-label="Scroll to previous post" class="wp-block-bloginabox-theme-carousel__arrow" data-wp-bind--aria-disabled="context.isFirst" data-wp-on--click="actions.onPrevious" type="button">
			<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="#0E1726" d="M10.295 19.716a1 1 0 1 0 1.404-1.425L6.33 13H20a1 1 0 1 0 0-2H6.336L11.7 5.715a1 1 0 0 0-1.404-1.425l-6.924 6.823a1.25 1.25 0 0 0 0 1.78z"></path></svg>		</button>
		<button aria-disabled="false" aria-label="Scroll to next post" class="wp-block-bloginabox-theme-carousel__arrow" data-wp-bind--aria-disabled="context.isLast" data-wp-on--click="actions.onNext" type="button">
			<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="#0E1726" d="M13.704 4.284a1 1 0 1 0-1.403 1.425L17.67 11H4a1 1 0 1 0 0 2h13.665L12.3 18.285a1 1 0 1 0 1.403 1.424l6.925-6.822a1.25 1.25 0 0 0 0-1.78l-6.925-6.823Z"></path></svg>		</button>
	</div>
</div>




<div class="wp-block-group alignwide has-global-padding is-layout-constrained wp-block-group-is-layout-constrained" style="padding-top:var(--wp--preset--spacing--2-xl);padding-bottom:var(--wp--preset--spacing--2-xl)">
<h2 class="wp-block-heading alignwide" style="margin-bottom:var(--wp--preset--spacing--lg)">Related posts</h2>



<div data-bi-an="Related Articles" data-query-id="3" class="wp-block-query alignwide is-layout-flow wp-block-query-is-layout-flow"><ul class="columns-3 wp-block-post-template is-layout-grid wp-container-core-post-template-is-layout-6d3fbd8f wp-block-post-template-is-layout-grid"><li class="wp-block-post post-138572 post type-post status-publish format-standard has-post-thumbnail hentry threat-intelligence-cloud-threats threat-intelligence-attacker-techniques-tools-and-infrastructure content-type-research product-microsoft-defender product-microsoft-defender-for-cloud product-microsoft-defender-for-endpoint product-microsoft-defender-xdr topic-threat-intelligence review-flag-1694638264-948 review-flag-1694638265-576 review-flag-1694638265-310 review-flag-1-1694638265-354 review-flag-disable review-flag-disabled review-flag-integ-1694638263-281 review-flag-lever-1694638263-909 review-flag-new-1694638263-340">

<div class="wp-block-bloginabox-theme-card--default wp-block-bloginabox-theme-card wp-block-null">
	
<article data-bi-an="Related Articles" class="card-block card-block--default is-clickable card-block--has-media card-block--has-excerpt" data-bi-id="138572" data-bi-cn="Understanding the threat landscape for Kubernetes and containerized assets" data-bi-ct="card link" data-wp-interactive="bloginabox-theme/card" data-wp-init="actions.init" data-wp-class--not-visible="!context.isVisible" data-wp-context="{&quot;id&quot;: &quot;138572&quot;}">
			<div class="card-block__media">
			<div class="card-block__media-container">
								<img width="806" height="455" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2025/04/Threat-landscape-containers-featured.png" class="attachment-card16x9 size-card16x9" alt="A woman sitting at a desk using a laptop" loading="lazy">			</div>
		</div>
	
	<div class="card-block__content-wrapper">
		<div class="card-block__content">
			<ul class="card-block__meta">
				
				<li class="card-block__meta-item card-block__meta-item--date">
					<time datetime="2025-04-23T09:00:00-07:00">
						April 23, 2025					</time>
				</li>

				<li class="card-block__meta-item card-block__meta-item--read-time">
					14 min read				</li>
			</ul>

			<h3 class="card-block__title">
									<a href="https://www.microsoft.com/en-us/security/blog/2025/04/23/understanding-the-threat-landscape-for-kubernetes-and-containerized-assets/" data-bi-cn="Understanding the threat landscape for Kubernetes and containerized assets" data-bi-id="138572" data-bi-ct="title link" data-bi-tn="content-card">
						Understanding the threat landscape for Kubernetes and containerized assets						<span class="card-block__title-glyph card-block__title-chevron-right" aria-hidden="true"></span>					</a>
							</h3>

			
							<div class="card-block__excerpt">
					The dynamic nature of containers can make it challenging for security teams to detect runtime anomalies or pinpoint the source of a security incident, presenting an opportunity for attackers to stay undetected.				</div>
			
			
					</div>
	</div>
</article>
</div>

</li><li class="wp-block-post post-134000 post type-post status-publish format-standard has-post-thumbnail hentry threat-intelligence-cloud-threats threat-intelligence-attacker-techniques-tools-and-infrastructure threat-intelligence-cybercrime threat-intelligence-vulnerabilities-and-exploits content-type-research product-microsoft-defender product-microsoft-defender-for-cloud topic-cloud-security topic-threat-intelligence review-flag-1694638265-576 review-flag-1-1694638265-354 review-flag-2-1694638266-864 review-flag-3-1694638266-241 review-flag-8-1694638266-352 review-flag-lever-1694638263-909 review-flag-new-1694638263-340">

<div class="wp-block-bloginabox-theme-card--default wp-block-bloginabox-theme-card wp-block-null">
	
<article data-bi-an="Related Articles" class="card-block card-block--default is-clickable card-block--has-media card-block--has-excerpt" data-bi-id="134000" data-bi-cn="Attackers exploiting new critical OpenMetadata vulnerabilities on Kubernetes clusters" data-bi-ct="card link" data-wp-interactive="bloginabox-theme/card" data-wp-init="actions.init" data-wp-class--not-visible="!context.isVisible" data-wp-context="{&quot;id&quot;: &quot;134000&quot;}">
			<div class="card-block__media">
			<div class="card-block__media-container">
								<img width="683" height="455" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2024/04/OpenMetadata-exploitation.png" class="attachment-card16x9 size-card16x9" alt="Operations manager working at standing desk." loading="lazy">			</div>
		</div>
	
	<div class="card-block__content-wrapper">
		<div class="card-block__content">
			<ul class="card-block__meta">
				
				<li class="card-block__meta-item card-block__meta-item--date">
					<time datetime="2024-04-17T09:00:00-07:00">
						April 17, 2024					</time>
				</li>

				<li class="card-block__meta-item card-block__meta-item--read-time">
					4 min read				</li>
			</ul>

			<h3 class="card-block__title">
									<a href="https://www.microsoft.com/en-us/security/blog/2024/04/17/attackers-exploiting-new-critical-openmetadata-vulnerabilities-on-kubernetes-clusters/" data-bi-cn="Attackers exploiting new critical OpenMetadata vulnerabilities on Kubernetes clusters" data-bi-id="134000" data-bi-ct="title link" data-bi-tn="content-card">
						Attackers exploiting new critical OpenMetadata vulnerabilities on Kubernetes clusters						<span class="card-block__title-glyph card-block__title-chevron-right" aria-hidden="true"></span>					</a>
							</h3>

			
							<div class="card-block__excerpt">
					Microsoft recently uncovered an attack that exploits new critical vulnerabilities in OpenMetadata to gain access to Kubernetes workloads and leverage them for cryptomining activity.				</div>
			
			
					</div>
	</div>
</article>
</div>

</li><li class="wp-block-post post-132748 post type-post status-publish format-standard has-post-thumbnail hentry threat-intelligence-business-email-compromise threat-intelligence-cloud-threats threat-intelligence-cybercrime threat-intelligence-social-engineering-phishing content-type-research product-microsoft-defender product-microsoft-defender-for-cloud product-microsoft-defender-for-cloud-apps product-microsoft-defender-for-office-365 product-microsoft-defender-xdr product-microsoft-entra product-microsoft-entra-id-protection product-microsoft-sentinel topic-threat-intelligence review-flag-1694638264-948 review-flag-1694638265-576 review-flag-1694638265-310 review-flag-1694638271-781 review-flag-1-1694638265-354 review-flag-2-1694638266-864 review-flag-3-1694638266-241 review-flag-4-1694638266-512 review-flag-5-1694638266-171 review-flag-6-1694638266-691 review-flag-7-1694638266-851 review-flag-9-1694638266-118 review-flag-anywh-1694638264-237 review-flag-lever-1694638263-909 review-flag-new-1694638263-340 review-flag-usd-1694638271-92 review-flag-vm-1694638271-244">

<div class="wp-block-bloginabox-theme-card--default wp-block-bloginabox-theme-card wp-block-null">
	
<article data-bi-an="Related Articles" class="card-block card-block--default is-clickable card-block--has-media card-block--has-excerpt" data-bi-id="132748" data-bi-cn="Threat actors misuse OAuth applications to automate financially driven attacks" data-bi-ct="card link" data-wp-interactive="bloginabox-theme/card" data-wp-init="actions.init" data-wp-class--not-visible="!context.isVisible" data-wp-context="{&quot;id&quot;: &quot;132748&quot;}">
			<div class="card-block__media">
			<div class="card-block__media-container">
								<img width="683" height="455" src="https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/12/MSC16_slalom_014.jpg" class="attachment-card16x9 size-card16x9" alt="Two male engineers sitting in front of a computer screen." loading="lazy">			</div>
		</div>
	
	<div class="card-block__content-wrapper">
		<div class="card-block__content">
			<ul class="card-block__meta">
				
				<li class="card-block__meta-item card-block__meta-item--date">
					<time datetime="2023-12-12T10:00:00-08:00">
						December 12, 2023					</time>
				</li>

				<li class="card-block__meta-item card-block__meta-item--read-time">
					16 min read				</li>
			</ul>

			<h3 class="card-block__title">
									<a href="https://www.microsoft.com/en-us/security/blog/2023/12/12/threat-actors-misuse-oauth-applications-to-automate-financially-driven-attacks/" data-bi-cn="Threat actors misuse OAuth applications to automate financially driven attacks" data-bi-id="132748" data-bi-ct="title link" data-bi-tn="content-card">
						Threat actors misuse OAuth applications to automate financially driven attacks						<span class="card-block__title-glyph card-block__title-chevron-right" aria-hidden="true"></span>					</a>
							</h3>

			
							<div class="card-block__excerpt">
					Microsoft Threat Intelligence presents cases of threat actors misusing OAuth applications as automation tools in financially motivated attacks.				</div>
			
			
					</div>
	</div>
</article>
</div>

</li></ul></div>
</div>
</main>



<div class="wp-block-template-part wp-block-template-part--footer">

<div style="padding-top:var(--wp--preset--spacing--4-xl);padding-bottom:var(--wp--preset--spacing--4-xl);" class="section wp-block-bloginabox-theme-section has-global-padding is-layout-constrained wp-block-section-is-layout-constrained wp-block-pattern">
	
<div class="section__background alignfull is-layout-constrained" data-bi-an="Global CTA">

				<div class="section-background-image-wrapper section-background-image-wrapper--light section-background-image-wrapper--desktop alignfull" style="opacity: 60%">
							<img decoding="async" src="https://www.microsoft.com/en-us/security/blog/wp-content/themes/security-blog-2025/dist/images/bg-footer.png" alt="" class="section-background__image">					</div>
	
				<div class="section-background-image-wrapper section-background-image-wrapper--dark section-background-image-wrapper--desktop alignfull" style="opacity: 80%">
							<img decoding="async" src="https://www.microsoft.com/en-us/security/blog/wp-content/themes/security-blog-2025/dist/images/bg-footer.png" alt="" class="section-background__image">					</div>
	
		
		</div>
<div class="section__content alignfull is-layout-constrained">
	

<div class="alignwide wp-block-bloginabox-theme-promotional">
	
<div class="promotional promotional--has-media promotional--media-right promotional--glass">
	<div class="promotional__wrapper">
		<div class="promotional__content-wrapper">
			<div class="promotional__content">
				

<h2 class="wp-block-heading">Get started with Microsoft Security</h2>



<p class="wp-block-paragraph">Protect your people, data, and infrastructure with AI-powered, end-to-end security from Microsoft.</p>



<div class="wp-block-buttons is-layout-flex wp-block-buttons-is-layout-flex">
<div class="wp-block-button"><a data-bi-an="Global CTA" data-bi-ct="cta link" data-bi-id="cta-block" class="wp-block-button__link wp-element-button" href="https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&amp;ocid=AID730391_QSG_BLOG_319247">Learn how</a></div>
</div>

			</div>
		</div>
					<div class="promotional__media-wrapper">
				<div class="promotional__media">
											<img decoding="async" src="https://www.microsoft.com/en-us/security/blog/wp-content/themes/security-blog-2025/dist/images/footer-promotional.jpg" alt="" loading="lazy">
									</div>
			</div>
			</div>
</div>
</div>

</div>
</div>



<div class="wp-block-group has-vapor-gray-50-background-color has-background is-content-justification-center is-nowrap is-layout-flex wp-container-core-group-is-layout-c6d7f5e5 wp-block-group-is-layout-flex" style="margin-top:0;margin-bottom:0;padding-top:var(--wp--preset--spacing--md);padding-bottom:var(--wp--preset--spacing--md)">
<p class="has-body-medium-font-size wp-block-paragraph">Connect with us on social</p>



<ul class="wp-block-social-links has-normal-icon-size is-layout-flex wp-block-social-links-is-layout-flex">
<li class="wp-social-link wp-social-link-x  wp-block-social-link"><a data-bi-an="Global CTA social" data-bi-bhvr="126" data-bi-cn="Follow on x" data-bi-ct="follow link" data-bi-id="social-link-x" rel="noopener nofollow" target="_blank" href="https://twitter.com/msftsecurity" class="wp-block-social-link-anchor"><svg width="24" height="24" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M13.982 10.622 20.54 3h-1.554l-5.693 6.618L8.745 3H3.5l6.876 10.007L3.5 21h1.554l6.012-6.989L15.868 21h5.245l-7.131-10.378Zm-2.128 2.474-.697-.997-5.543-7.93H8l4.474 6.4.697.996 5.815 8.318h-2.387l-4.745-6.787Z"></path></svg><span class="wp-block-social-link-label screen-reader-text">X</span></a></li>
<li class="wp-social-link wp-social-link-youtube  wp-block-social-link"><a data-bi-an="Global CTA social" data-bi-bhvr="126" data-bi-cn="Follow on youtube" data-bi-ct="follow link" data-bi-id="social-link-youtube" rel="noopener nofollow" target="_blank" href="https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A" class="wp-block-social-link-anchor"><svg width="24" height="24" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M21.8,8.001c0,0-0.195-1.378-0.795-1.985c-0.76-0.797-1.613-0.801-2.004-0.847c-2.799-0.202-6.997-0.202-6.997-0.202 h-0.009c0,0-4.198,0-6.997,0.202C4.608,5.216,3.756,5.22,2.995,6.016C2.395,6.623,2.2,8.001,2.2,8.001S2,9.62,2,11.238v1.517 c0,1.618,0.2,3.237,0.2,3.237s0.195,1.378,0.795,1.985c0.761,0.797,1.76,0.771,2.205,0.855c1.6,0.153,6.8,0.201,6.8,0.201 s4.203-0.006,7.001-0.209c0.391-0.047,1.243-0.051,2.004-0.847c0.6-0.607,0.795-1.985,0.795-1.985s0.2-1.618,0.2-3.237v-1.517 C22,9.62,21.8,8.001,21.8,8.001z M9.935,14.594l-0.001-5.62l5.404,2.82L9.935,14.594z"></path></svg><span class="wp-block-social-link-label screen-reader-text">YouTube</span></a></li>
<li class="wp-social-link wp-social-link-linkedin  wp-block-social-link"><a data-bi-an="Global CTA social" data-bi-bhvr="126" data-bi-cn="Follow on linkedin" data-bi-ct="follow link" data-bi-id="social-link-linkedin" rel="noopener nofollow" target="_blank" href="https://www.linkedin.com/showcase/microsoft-security/" class="wp-block-social-link-anchor"><svg width="24" height="24" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M19.7,3H4.3C3.582,3,3,3.582,3,4.3v15.4C3,20.418,3.582,21,4.3,21h15.4c0.718,0,1.3-0.582,1.3-1.3V4.3 C21,3.582,20.418,3,19.7,3z M8.339,18.338H5.667v-8.59h2.672V18.338z M7.004,8.574c-0.857,0-1.549-0.694-1.549-1.548 c0-0.855,0.691-1.548,1.549-1.548c0.854,0,1.547,0.694,1.547,1.548C8.551,7.881,7.858,8.574,7.004,8.574z M18.339,18.338h-2.669 v-4.177c0-0.996-0.017-2.278-1.387-2.278c-1.389,0-1.601,1.086-1.601,2.206v4.249h-2.667v-8.59h2.559v1.174h0.037 c0.356-0.675,1.227-1.387,2.526-1.387c2.703,0,3.203,1.779,3.203,4.092V18.338z"></path></svg><span class="wp-block-social-link-label screen-reader-text">LinkedIn</span></a></li>
</ul>
</div>


<div id="footerArea" class="uhf" data-m="{&quot;cN&quot;:&quot;footerArea&quot;,&quot;cT&quot;:&quot;Area_coreuiArea&quot;,&quot;id&quot;:&quot;a2Body&quot;,&quot;sN&quot;:2,&quot;aN&quot;:&quot;Body&quot;}">
                <div id="footerRegion" data-region-key="footerregion" data-m="{&quot;cN&quot;:&quot;footerRegion&quot;,&quot;cT&quot;:&quot;Region_coreui-region&quot;,&quot;id&quot;:&quot;r1a2&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;a2&quot;}">

    <div id="footerUniversalFooter" data-m="{&quot;cN&quot;:&quot;footerUniversalFooter&quot;,&quot;cT&quot;:&quot;Module_coreui-universalfooter&quot;,&quot;id&quot;:&quot;m1r1a2&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;r1a2&quot;}" data-module-id="Category|footerRegion|coreui-region|footerUniversalFooter|coreui-universalfooter">
        













    </div>
        </div>

    </div>

</div>
</div>

	
	






	<!-- JSLL tracking -->
	
	


</body></html><!--
Performance optimized by Redis Object Cache. Learn more: https://wprediscache.com

Retrieved 3360 objects (912 KB) from Redis using PhpRedis (v6.3.0).
-->