Title:
Hiding Malicious Code With Module Stomping

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains “module stomping,” a Windows in-memory evasion technique where an attacker loads a legitimate DLL into a process and overwrites (stomps) its mapped image with malicious code.  
- The goal is to execute payloads while appearing to originate from a trusted, signed module, complicating detections that rely on suspicious memory regions (e.g., RWX private allocations) or unknown module mappings.  
- It discusses how PE images are mapped, how attackers choose a target module with sufficient size, and how memory protections/section characteristics are manipulated to permit overwriting and execution.  
- The technique is positioned as an alternative to classic process injection patterns (e.g., allocating new executable memory) by reusing an existing module’s address space and metadata.  
- It’s useful for red teams and malware developers building stealthy loaders, and for blue teams/EDR engineers to understand what telemetry and invariants still expose this behavior.  
- It’s interesting because it abuses normal loader behavior and module trust assumptions, shifting detection from “new executable memory” to “unexpected modifications inside mapped images.”

Technical Focus:
- Windows PE/DLL image mapping and loader behavior
- In-memory code replacement of mapped modules (module stomping)
- Memory protection changes (VirtualProtect/NtProtectVirtualMemory) and section permissions
- Thread start redirection / execution transfer (e.g., CreateRemoteThread/APC/context manipulation)
- EDR detection blind spots: private vs mapped memory, module-backed regions, image integrity

Use Cases:
- Stealthy payload execution inside a process without obvious new executable allocations
- Evasion testing against EDR rules focused on RWX memory or unbacked executable pages
- Developing detections for modified image-backed memory and anomalous module contents
- Incident response triage: identifying “legit module, malicious bytes” scenarios in memory dumps

Keywords:
module stomping, Windows injection, DLL, PE image, memory mapping, image-backed memory, VirtualProtect, NtProtectVirtualMemory, CreateRemoteThread, APC injection, thread context hijack, reflective loading, process hollowing, EDR evasion, signed module abuse, code cave, section permissions, in-memory loader, memory forensics, image integrity