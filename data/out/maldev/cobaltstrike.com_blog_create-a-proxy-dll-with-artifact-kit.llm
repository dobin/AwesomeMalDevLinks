Title:
Create a proxy DLL with artifact kit

Type:
Blog Post

Short Summary (4–8 sentences max):
This post explains DLL proxying (a form of DLL search order hijacking) and demonstrates how to build a proxy DLL that preserves an application’s original behavior while executing an attacker payload. It walks through identifying a target DLL loaded by a process, extracting its exported functions, and creating a replacement DLL that forwards those exports to a renamed “original” DLL via a `.def` file. The author provides a simple MinGW-based example (using `rundll32.exe`) and then extends the technique to Cobalt Strike’s Artifact Kit to turn `beacon.dll` into a proxy DLL by adding forwarding exports in the kit’s DLL template. It highlights practical targeting considerations (e.g., user-writable AppData-installed applications) and notes that proxy DLLs are primarily a loader/persistence mechanism rather than a novel payload. Defensive notes include DLL signature validation, restricting install locations/permissions, and file integrity monitoring. Useful for red teams and pentesters validating detection/prevention around DLL load hijacking; also relevant to defenders modeling T1574.001.

Technical Focus:
- DLL proxying via export forwarding (`.def` files, ordinals)
- DLL Search Order Hijacking (MITRE ATT&CK T1574.001)
- Enumerating loaded modules and DLL load events (Sysinternals Procmon/Process Explorer)
- Export enumeration (`dumpbin /exports`, custom export-parsing scripts)
- Cobalt Strike Artifact Kit customization (modifying `dllmain.def`, Aggressor script integration)
- Persistence opportunities in user-writable application directories (e.g., AppData)

Use Cases:
- Build proxy DLLs to maintain application functionality while executing a loader/payload
- Red team simulation of DLL search order hijacking and persistence in user-writable paths
- Customize Cobalt Strike Beacon DLL artifacts to include forwarding exports for proxy scenarios
- Identify candidate DLL hijack/proxy targets by monitoring “Load Image” events and imports/exports
- Blue team validation of controls: DLL signature enforcement, install path hardening, FIM alerts

Keywords:
DLL proxying, DLL hijacking, DLL search order hijacking, T1574.001, export forwarding, module-definition file, DEF file, ordinals, dumpbin, MinGW, x86_64-w64-mingw32-gcc, dllwrap, rundll32.exe, Sysinternals Procmon, Process Explorer, Cobalt Strike Artifact Kit, beacon.dll, Aggressor script, AppData persistence, digital signature validation, file integrity monitoring