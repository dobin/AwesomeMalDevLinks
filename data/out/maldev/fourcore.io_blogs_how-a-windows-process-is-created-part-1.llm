Title:
Genesis – The Birth of a Windows Process (Part 1)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This article breaks down Windows process creation at a systems-internals level, focusing on the user-mode APIs, required privileges, and the core kernel/user data structures involved.  
- It surveys common creation paths (CreateProcess*, ShellExecute*) and explains how they converge into `CreateProcessInternal` and ultimately `NtCreateUserProcess` for the user→kernel transition.  
- The post highlights key creation flags and structures (`STARTUPINFO/STARTUPINFOEX`, `PROCESS_INFORMATION`, `UpdateProcThreadAttributes`) and touches on “modern” (UWP/Store) process activation via package attributes or `IApplicationActivationManager`.  
- It provides an overview of process representations and per-subsystem tracking (`EPROCESS/KPROCESS`, `ETHREAD`, `PEB`, `CSR_PROCESS`, `W32PROCESS`) and points to kernel callbacks like `PsSetCreateProcessNotifyRoutine(Ex*)`.  
- It also introduces special process classes—Protected Process / PPL, Minimal processes, Pico processes (WSL), and VBS trustlets (Isolated User Mode)—and what enforces their protection or creation constraints.  
- Useful for red teamers, malware developers, and defenders who need accurate mental models for process spawning, token usage, and why certain processes resist inspection/injection.

Technical Focus:
- Win32 process creation APIs vs native syscalls (`CreateProcess*`, `CreateProcessInternal`, `NtCreateUserProcess`)
- Token-based process creation and privilege requirements (SeImpersonate, SeAssignPrimaryToken, SeIncreaseQuota)
- Process creation attributes (`STARTUPINFOEX`, `UpdateProcThreadAttributes`, package full name)
- Windows process/kernel structures (`EPROCESS`, `KPROCESS`, `ETHREAD`, `PEB`, `CSR_PROCESS`, `W32PROCESS`)
- Protected Process / Protected Process Light (PPL) signing/EKU enforcement and access-right restrictions
- Minimal/Pico processes and Pico provider model (`PsRegisterPicoProvider`, `PspCreatePicoProcess`), VBS trustlets (IUM/VTL1)

Use Cases:
- Implementing or instrumenting custom process creation (suspended start, extended attributes, token-based spawning)
- Debugging/detecting process creation flows and correlating user-mode API calls to kernel syscalls
- Understanding why PP/PPL targets block handle access, injection, or termination and what rights remain
- Building kernel/user telemetry around process lifecycle (notify routines, EPROCESS/PEB inspection)
- Researching WSL Pico processes and VBS trustlets for attack surface or defensive monitoring

Keywords:
Windows process creation, CreateProcess, CreateProcessAsUser, CreateProcessWithTokenW, CreateProcessWithLogonW, ShellExecuteEx, CreateProcessInternal, NtCreateUserProcess, RtlCreateUserProcess, NtCreateProcessEx, STARTUPINFOEX, UpdateProcThreadAttributes, PROC_THREAD_ATTRIBUTE_PACKAGE_FULL_NAME, access token, SeImpersonatePrivilege, SeAssignPrimaryTokenPrivilege, SeIncreaseQuotaPrivilege, EPROCESS, KPROCESS, ETHREAD, PEB, CSRSS, CSR_PROCESS, W32PROCESS, PsSetCreateProcessNotifyRoutineEx, Protected Process, PPL, Code Integrity, EKU OID, Pico process, PsRegisterPicoProvider, WSL, Isolated User Mode, trustlet, VTL1, IApplicationActivationManager