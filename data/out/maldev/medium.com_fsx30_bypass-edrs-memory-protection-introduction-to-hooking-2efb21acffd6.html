# https://medium.com/@fsx30/bypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6

<!DOCTYPE html><html lang="en" data-rh="lang" dir="ltr"><body><div id="root"><div class="a b c"><a href="https://medium.com/sitemap/sitemap.xml" class="d">Sitemap</a><div class="e f g h i j k l"></div><div></div><div class="m c"><div class="m n o p c" style="transform: translateY(0px);"><div class="q r s t u v w x y j e z ab"><a class="eb ai ec bg am b ao ap aq ar as at au av t v x j e r ed ab" href="https://play.google.com/store/apps/details?id=com.medium.reader&amp;referrer=utm_source%3DmobileNavBar&amp;source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="ea"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" rel="noopener follow" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40fsx30%2Fbypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" data-discover="true">Sign in</a></span></p></div></div></div><div class="q r s ac ae af"><div class="ac r ag"><a class="ah ai aj ak al am an ao ap aq ar as at au av ac" aria-label="Homepage" data-testid="headerMediumLogo" rel="noopener follow" href="https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" aria-labelledby="wordmark-medium-desc" viewBox="0 0 719 160" class="aw ax ay"><desc id="wordmark-medium-desc">Medium Logo</desc><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="az i"><div class="ac ak ba bb bc r bd be"><div class="bn" aria-describedby="searchResults" aria-labelledby="searchResults" aria-haspopup="listbox" role="listbox"></div><div class="bo bp ac"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ak bf bg bh ab bi bj bk bl bm" placeholder="Search" value=""></div></div></div><div class="i l x fp fq"><span data-dd-action-name="Susi presentation tracker new_post_topnav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerWriteButton" rel="noopener follow" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav------------------" data-discover="true"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg>Write</div></a></span></div><div class="l k j e"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSearchButton" rel="noopener follow" href="https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------" data-discover="true"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Search</span></div></a></div><div class="ge i l k"><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" rel="noopener follow" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40fsx30%2Fbypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" data-discover="true">Sign in</a></span></p></div></div></div><div class="m"><div><div class="bn" role="tooltip" aria-describedby="1" aria-labelledby="1"><div tabindex="-1" class="bf"><button class="ak gf ao ac r aq fr gg gh gi" aria-label="user options menu" data-testid="headerUserIcon"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m bz ca fw o ak gk"></div></div></button></div></div></div></div></div></div><div class="ac"><div class="cb i l k j cc" style="width: 0px;"></div><div class="cd bi ce cf cg ch" style="width: calc(100% + 0px);"><div class="m"><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div data-focus-lock-disabled="disabled"><div class="qo" role="dialog" aria-modal="true" tabindex="-1"><div class="vp vq bi ed vr vs vt aq vu hd vv" aria-hidden="true" role="presentation"></div><div class="vw vr vx vy vz vp ed fk wa wb wc lp wd we wf wg wh wi wj wk wl wm ac cv wn" aria-hidden="true"><div class="wo gy"></div></div></div></div><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div class="gl gm gn go gp m"><div class="ac ci"><div class="cp bi gq gr gs gt"></div></div><article><div class="m"><div class="m"><span class="m"></span><section><div><div class="fw gz wp hb hc hd"></div><div class="speechify-ignore oq or pf fr i l k j cc"></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><div><h1 id="f6d6" class="pw-post-title hj hk hl bg hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il bl" data-testid="storyTitle" data-selectable-paragraph="">Bypass EDR’s memory protection, introduction to hooking</h1><div><div class="speechify-ignore ac cw"><div class="speechify-ignore bi m"><div class="ac im in io ip iq ir is it iu iv iw"><div class="ac r iw"><div class="ac ix"><div><div class="bn" aria-describedby="3" aria-labelledby="3" role="tooltip"><div tabindex="-1" class="bf"><a rel="noopener follow" href="https://medium.com/@fsx30?source=post_page---byline--2efb21acffd6---------------------------------------" data-discover="true"><div class="m iy iz by ja jb"><div class="m fr"><img alt="Hoang Bui" class="m fk by bz ca de" width="32" height="32" loading="lazy" data-testid="authorPhoto" src="https://miro.medium.com/v2/resize:fill:32:32/1*aI87lLNjPvtF3ZVnHsEZYw.jpeg"><div class="jc by m bz ca fw o jd gk"></div></div></div></a></div></div></div></div><span class="bg b bh ab bl"><div class="je ac r"><div class="ac r jf"><div class="ac r"><div><div class="bn" aria-describedby="4" aria-labelledby="4" role="tooltip"><div tabindex="-1" class="bf"><span class="bg b bh ab bl"><a class="ah ai aj fo al am an ao ap aq ar as at jg" data-testid="authorName" rel="noopener follow" href="https://medium.com/@fsx30?source=post_page---byline--2efb21acffd6---------------------------------------" data-discover="true">Hoang Bui</a></span></div></div></div></div><div class="jh bn"></div><button class="td xi aq ac ci r xj xk xl" style="border: 1px solid rgb(36, 36, 36);"><span class="bg b bh ab bl bi"><span class="bn xm">Follow</span></span></button></div></div></span></div><div class="ac r ji"><span class="bg b bh ab eb"><div class="ac ag"><span data-testid="storyReadTime">8 min read</span><div class="jj jk m" aria-hidden="true"><span class="m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span></div><span data-testid="storyPublishDate">Jan 18, 2019</span></div></span></div></div><div class="ac cw jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka"><div class="i l x fp fq r"><div class="kq m"><div class="ac r kr ks"><div class="pw-multi-vote-icon fr kt ku kv kw"><span data-dd-action-name="Susi presentation tracker clap_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerClapButton" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F2efb21acffd6&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40fsx30%2Fbypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6&amp;user=Hoang+Bui&amp;userId=e00ab389ccdc&amp;source=---header_actions--2efb21acffd6---------------------clap_footer------------------" data-discover="true"><div><div class="bn" aria-describedby="5" aria-labelledby="5" role="tooltip"><div tabindex="-1" class="bf"><div class="kx aq ky kz la lb ao lc ld le kw" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></div></a></span></div><div class="pw-multi-vote-count m lf lg lh li lj lk ll"><div><div class="bn" aria-describedby="66" aria-labelledby="66" role="tooltip"><div tabindex="-1" class="bf"><p class="bg b ec ab eb"><button class="ah ai aj fo al am an ao ap aq ar as at au av xn lu">330<span class="m i h g qt qu"></span></button></p></div></div></div></div></div></div><div><div class="bn" aria-describedby="6" aria-labelledby="6" role="tooltip"><div tabindex="-1" class="bf"><button class="aq kx lp lq ac r fs lr ls" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lo"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bg b ec ab eb"><span class="pw-responses-count ln lo">7</span></p></button></div></div></div></div><div class="ac r kb kc kd ke kf kg kh ki kj kk kl km kn ko kp"><div class="lt l k j e"></div><div class="i l"><div><div class="bn" aria-describedby="7" aria-labelledby="7" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerBookmarkButton" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2efb21acffd6&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40fsx30%2Fbypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6&amp;source=---header_actions--2efb21acffd6---------------------bookmark_footer------------------" data-discover="true"><span class=""><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb lu" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></span></a></span></div></div></div></div><div class="fk lv cu"><div class="m ag"><div class="ac ci"><div class="lw lx ly lz ma mb cp bi"><div class="ac"><span data-dd-action-name="Susi presentation tracker post_audio_button"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2Fplans%3Fdimension%3Dpost_audio_button%26postId%3D2efb21acffd6&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40fsx30%2Fbypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6&amp;source=---header_actions--2efb21acffd6---------------------post_audio_button------------------" data-discover="true"><div><div class="bn" aria-describedby="54" aria-labelledby="54" role="tooltip"><div tabindex="-1" class="bf"><button aria-label="Listen" data-testid="audioPlayButton" class="ah fs aj fo al am an mc ap aq ar fe md me ls mf mg mh mi mj t mk ml mm mn mo mp mq v mr ms mt"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Listen</p></div></button></div></div></div></a></span></div></div></div></div></div><div class="bn" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bn" aria-describedby="9" aria-labelledby="9" role="tooltip"><div tabindex="-1" class="bf"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="ah fs aj fo al am an mc ap aq ar fe md me ls mf mg mh mi mj t mk ml mm mn mo mp mq v mr ms mt"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Share</p></div></button></div></div></div></div></div></div></div></div></div></div><h2 id="8bc7" class="mu mv hl bg mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr bl" data-selectable-paragraph="">Introduction</h2><p id="38df" class="pw-post-body-paragraph ns nt hl nu b nv nw nx ny nz oa ob oc od oe of og oh oi oj ok ol om on oo op he bl" data-selectable-paragraph="">On a recent internal penetration engagement, I was faced against an EDR product that I will not name. This product greatly hindered my ability to access lsass’ memory and use our own custom flavor of Mimikatz to dump clear-text credentials.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or os"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 1100w, https://miro.medium.com/v2/resize:fit:1368/format:webp/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 1368w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 684px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 1100w, https://miro.medium.com/v2/resize:fit:1368/1*fNWQ3Rr0v1sCGy5pqkGS3A.png 1368w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 684px"><img alt="" class="bi mb pd c" width="684" height="218" loading="eager" role="presentation" src="https://miro.medium.com/v2/resize:fit:684/1*fNWQ3Rr0v1sCGy5pqkGS3A.png"></picture></div></div><figcaption class="pe fm pf oq or pg ph bg b bh ab eb" data-selectable-paragraph="">For those who recommends ProcDump</figcaption></figure><h2 id="e7a8" class="mu mv hl bg mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr bl" data-selectable-paragraph="">The Wrong Path</h2><p id="05f3" class="pw-post-body-paragraph ns nt hl nu b nv nw nx ny nz oa ob oc od oe of og oh oi oj ok ol om on oo op he bl" data-selectable-paragraph="">So now, as an ex-malware author — I know that there are a few things you could do as a driver to accomplish this detection and block. The first thing that comes to my mind was <a class="ah pi" href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/wdm/nf-wdm-obregistercallbacks" rel="noopener ugc nofollow" target="_blank">Obregistercallback </a>which is commonly used by many Antivirus products. Microsoft implemented this callback due to many antivirus products performing very sketchy winapi hooks that reassemble malware rootkits. However, at the bottom of the msdn page, you will notice a text saying “<em class="pj">Available starting with Windows Vista with Service Pack 1 (SP1) and Windows Server 2008.</em>” To give some missing context, I am on a Windows server 2003 at the moment. Therefore, it is missing the necessary function to perform this block.</p><p id="56ed" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">After spending hours and hours, doing black magic stuff with csrss.exe and attempting to inherit a handle to lsass.exe through csrss.exe, I was successful in gaining a handle with PROCESS_ALL_ACCESS to lsass.exe. This was through abusing csrss to spawn a child process and then inherit the already existing handle to lsass.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or pp"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*xw5PhZArlr4rrm3objLdMw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*xw5PhZArlr4rrm3objLdMw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*xw5PhZArlr4rrm3objLdMw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*xw5PhZArlr4rrm3objLdMw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*xw5PhZArlr4rrm3objLdMw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*xw5PhZArlr4rrm3objLdMw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xw5PhZArlr4rrm3objLdMw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*xw5PhZArlr4rrm3objLdMw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*xw5PhZArlr4rrm3objLdMw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*xw5PhZArlr4rrm3objLdMw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*xw5PhZArlr4rrm3objLdMw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*xw5PhZArlr4rrm3objLdMw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*xw5PhZArlr4rrm3objLdMw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*xw5PhZArlr4rrm3objLdMw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb pd c" width="700" height="350" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*xw5PhZArlr4rrm3objLdMw.png"></picture></div></div><figcaption class="pe fm pf oq or pg ph bg b bh ab eb" data-selectable-paragraph="">There is no EDR solution on this machine, this was just an PoC</figcaption></figure><p id="b47c" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">However, after thinking “I got this!” and was ready to rejoice in victory over defeating a certain EDR, I was met with a disappointing conclusion. The EDR blocked the shellcode injection into csrss as well as the thread creation through <em class="pj">RtlCreateUserThread. </em>However, for some reason — the code while failing to spawn as a child process and inherit the handle, was still somehow able to get the PROCESS_ALL_ACCESS handle to lsass.exe.</p><p id="2dde" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">WHAT?!</p><p id="139a" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">Hold up, let me try just opening a handle to lsass.exe without any fancy stuff with just this line:</p><p id="6e81" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph=""><em class="pj">HANDLE hProc = OpenProcess(PROCESS_ALL_ACCESS, FALSE, lsasspid);</em></p><p id="04e6" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">And what do you know, I got a handle with FULL CONTROL over lsass.exe. The EDR did not make a single fuzz about this. This is when I realized, I started off the approach the wrong way and the EDR never really cared about you gaining the handle access. It is what you do afterward with that handle that will come under scrutiny.</p><h2 id="362e" class="mu mv hl bg mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr bl" data-selectable-paragraph="">Back on Track</h2><p id="23bb" class="pw-post-body-paragraph ns nt hl nu b nv nw nx ny nz oa ob oc od oe of og oh oi oj ok ol om on oo op he bl" data-selectable-paragraph="">Knowing there was no fancy trick in getting a full control handle to lsass.exe, we can now move forward to find the next point of the issue. Immediately calling MiniDumpWriteDump() with the handle failed spectacularly.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or pq"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*XdE-ViKCp_6HkwBdQflHLg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*XdE-ViKCp_6HkwBdQflHLg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*XdE-ViKCp_6HkwBdQflHLg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*XdE-ViKCp_6HkwBdQflHLg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*XdE-ViKCp_6HkwBdQflHLg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*XdE-ViKCp_6HkwBdQflHLg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XdE-ViKCp_6HkwBdQflHLg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*XdE-ViKCp_6HkwBdQflHLg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*XdE-ViKCp_6HkwBdQflHLg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*XdE-ViKCp_6HkwBdQflHLg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*XdE-ViKCp_6HkwBdQflHLg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*XdE-ViKCp_6HkwBdQflHLg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*XdE-ViKCp_6HkwBdQflHLg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*XdE-ViKCp_6HkwBdQflHLg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb pd c" width="700" height="198" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*XdE-ViKCp_6HkwBdQflHLg.png"></picture></div></div></figure><p id="4d98" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">Let’s dissect this warning further. “Violation: LsassRead”. I didn’t read anything, what are you talking about? I just want to do a dump of the process. However, I also know that to make a dump of a remote process, there must be some sort of WINAPI being called such as ReadProcessMemory (RPM) inside MiniDumpWriteDump(). Let’s look at MiniDumpWriteDump’s source code at <a class="ah pi" href="https://doxygen.reactos.org/d8/d5d/minidump_8c.html#a9a74c45722230d9f89a34fd843050937" rel="noopener ugc nofollow" target="_blank">ReactOS</a>.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or pr"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ZHSc5p--XuK5NaKhAQrIIQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ZHSc5p--XuK5NaKhAQrIIQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ZHSc5p--XuK5NaKhAQrIIQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ZHSc5p--XuK5NaKhAQrIIQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ZHSc5p--XuK5NaKhAQrIIQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ZHSc5p--XuK5NaKhAQrIIQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZHSc5p--XuK5NaKhAQrIIQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*ZHSc5p--XuK5NaKhAQrIIQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ZHSc5p--XuK5NaKhAQrIIQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ZHSc5p--XuK5NaKhAQrIIQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ZHSc5p--XuK5NaKhAQrIIQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ZHSc5p--XuK5NaKhAQrIIQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ZHSc5p--XuK5NaKhAQrIIQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*ZHSc5p--XuK5NaKhAQrIIQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb pd c" width="700" height="657" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*ZHSc5p--XuK5NaKhAQrIIQ.png"></picture></div></div><figcaption class="pe fm pf oq or pg ph bg b bh ab eb" data-selectable-paragraph="">Multiple calls to RPM</figcaption></figure><p id="a2fa" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">As you can see by, the function (2) dump_exception_info(), as well as many other functions, relies on (3) RPM to perform its duty. These functions are referenced by MiniDumpWriteDump (1) and this is probably the root of our issue. Now here is where a bit of experience comes into play. You must understand the Windows System Internal and how WINAPIs are processed. Using ReadProcessMemory as an example — it works like this.</p><p id="794e" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">ReadProcessMemory is just a wrapper. It does a bunch of sanity check such as nullptr check. That is all RPM does. However, RPM also calls a function “NtReadVirtualMemory”, which sets up the registers before doing a <em class="pj">syscall </em>instruction. Syscall instruction is just telling the CPU to enter kernel mode which then another function ALSO named NtReadVirtualMemory is called, which does the actual logic of what ReadProcessMemory is supposed to do.</p><p id="4f6d" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">— — — — — -Userland — — — —-— — | — — — Kernel Land — — —</p><p id="0844" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">RPM — &gt; NtReadVirtualMemory --&gt; SYSCALL-&gt;NtReadVirtualMemory</p><p id="c830" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">Kernel32 — — -ntdll — — — — — — — — — - — — — — — ntoskrnl</p><p id="2b4b" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">With that knowledge, we now must identify HOW the EDR product is detecting and stopping the RPM/NtReadVirtualMemory call. This comes as a simple answer which is “hooking”. Please refer to my previous post regarding hooking <a class="ah pi" rel="noopener" href="https://medium.com/@fsx30/vectored-exception-handling-hooking-via-forced-exception-f888754549c6" data-discover="true">here</a> for more information. In short, it gives you the ability to put your code in the middle of any function and gain access to the arguments as well as the return variable. I am 100% sure that the EDR is using some sort of hook through one or more of the various techniques that I mentioned.</p><div class="ty sv tz ua ac r cv"><div class="ub uc ud ue uf m fm"><h2 class="ug b uh ui uj uk ul">Get Hoang Bui’s stories in&nbsp;your&nbsp;inbox</h2></div><div class="cs m fm"><p class="bg b bh ab eb">Join Medium for free to get updates from&nbsp;this&nbsp;writer.</p></div><div class="up qy uq ur qx us ac"><span class="bg b bh ab bl"><div class="ut ac cv"><div class="ac ut fj fi bq uu uv de lp uw ux uy uz va vb vc"><input class="vd al aj an ve vf gd lb bm vg bi" placeholder="Enter your email" type="text" value=""></div></div></span><div class="i l ro cb"><div class="um un uo"><button class="bg b bh ab vh qd vi vj vk vl tf fc fd vm vn vo fh fi fj fk bn fl fm">Subscribe</button></div></div><div class="bi k j e"><button class="bg b bh ab vh qd vi vj vk vl tf fc fd vm vn vo fh bi fi fj fk bn fl fm">Subscribe</button></div></div><div class="qb m"><div id="g-recaptcha"></div></div></div><p id="b2d6" class="pw-post-body-paragraph ns nt hl nu b nv nx ny nz ob oc od of og oh oj ok ol on oo ua op he bl" data-selectable-paragraph=""><mark class="xq xr aq">However, readers should know that most if not all EDR products are using a service, specifically a driver running inside kernel mode. With access to the kernel mode, the driver could perform the hook at ANY of the level in the RPM’s callstack. However, this opens up a huge security hole in a Windows environment if it was trivial for any driver to hook ANY level of a function. Therefore, a solution is to put forward to prevent modification of such nature and that solution is known as Kernel Patch Protection (KPP or Patch Guard). KPP scans the kernel on almost every level and will triggers a BSOD if a modification is detected. This includes ntoskrnl portion which houses the WINAPI’s kernel level’s logic. With this knowledge, we are assured that the EDR would not and did not hook any kernel level function inside that portion of the call stack, leaving us with the user-land’s RPM and NtReadVirtualMemory calls.</mark></p><h2 id="031a" class="mu mv hl bg mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr bl" data-selectable-paragraph="">The Hook</h2><p id="8fe9" class="pw-post-body-paragraph ns nt hl nu b nv nw nx ny nz oa ob oc od oe of og oh oi oj ok ol om on oo op he bl" data-selectable-paragraph="">To see where the function is located inside our application’s memory, it is as trivial as a printf with %p format string and the function name as the argument, such as below.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or ps"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*VoVNNC0WUVNiJZoeJoxekg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*VoVNNC0WUVNiJZoeJoxekg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*VoVNNC0WUVNiJZoeJoxekg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*VoVNNC0WUVNiJZoeJoxekg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*VoVNNC0WUVNiJZoeJoxekg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*VoVNNC0WUVNiJZoeJoxekg.png 1100w, https://miro.medium.com/v2/resize:fit:1196/format:webp/1*VoVNNC0WUVNiJZoeJoxekg.png 1196w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 598px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*VoVNNC0WUVNiJZoeJoxekg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*VoVNNC0WUVNiJZoeJoxekg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*VoVNNC0WUVNiJZoeJoxekg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*VoVNNC0WUVNiJZoeJoxekg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*VoVNNC0WUVNiJZoeJoxekg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*VoVNNC0WUVNiJZoeJoxekg.png 1100w, https://miro.medium.com/v2/resize:fit:1196/1*VoVNNC0WUVNiJZoeJoxekg.png 1196w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 598px"><img alt="" class="bi mb pd c" width="598" height="26" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:598/1*VoVNNC0WUVNiJZoeJoxekg.png"></picture></div></figure><p id="3fe8" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">However, unlike RPM, NtReadVirtualMemory is not an exported function inside ntdll and therefore you cannot just reference to the function like normal. You must specify the signature of the function as well as linking ntdll.lib into your project to do so.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or pt"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*qMG_2DisKrQyexTwVuFhCg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*qMG_2DisKrQyexTwVuFhCg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*qMG_2DisKrQyexTwVuFhCg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*qMG_2DisKrQyexTwVuFhCg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*qMG_2DisKrQyexTwVuFhCg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*qMG_2DisKrQyexTwVuFhCg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qMG_2DisKrQyexTwVuFhCg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*qMG_2DisKrQyexTwVuFhCg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*qMG_2DisKrQyexTwVuFhCg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*qMG_2DisKrQyexTwVuFhCg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*qMG_2DisKrQyexTwVuFhCg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*qMG_2DisKrQyexTwVuFhCg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*qMG_2DisKrQyexTwVuFhCg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*qMG_2DisKrQyexTwVuFhCg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb pd c" width="700" height="64" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*qMG_2DisKrQyexTwVuFhCg.png"></picture></div></div></figure><p id="3a83" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">With everything in place, let’s run it and take a look!</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or pu"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*jH-wGT33yPZSgZpv_09tDw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*jH-wGT33yPZSgZpv_09tDw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*jH-wGT33yPZSgZpv_09tDw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*jH-wGT33yPZSgZpv_09tDw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*jH-wGT33yPZSgZpv_09tDw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*jH-wGT33yPZSgZpv_09tDw.png 1100w, https://miro.medium.com/v2/resize:fit:886/format:webp/1*jH-wGT33yPZSgZpv_09tDw.png 886w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 443px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*jH-wGT33yPZSgZpv_09tDw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*jH-wGT33yPZSgZpv_09tDw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*jH-wGT33yPZSgZpv_09tDw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*jH-wGT33yPZSgZpv_09tDw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*jH-wGT33yPZSgZpv_09tDw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*jH-wGT33yPZSgZpv_09tDw.png 1100w, https://miro.medium.com/v2/resize:fit:886/1*jH-wGT33yPZSgZpv_09tDw.png 886w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 443px"><img alt="" class="bi mb pd c" width="443" height="31" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:443/1*jH-wGT33yPZSgZpv_09tDw.png"></picture></div></figure><p id="5c17" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">Now, this provides us with the address of both RPM and ntReadVirtualMemory. I will now use my favorite reversing tool to read the memory and analyze its structure, Cheat Engine.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or pv"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Bqv-8TlP1QYvcEAAb-9vIg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Bqv-8TlP1QYvcEAAb-9vIg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Bqv-8TlP1QYvcEAAb-9vIg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Bqv-8TlP1QYvcEAAb-9vIg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Bqv-8TlP1QYvcEAAb-9vIg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Bqv-8TlP1QYvcEAAb-9vIg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bqv-8TlP1QYvcEAAb-9vIg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*Bqv-8TlP1QYvcEAAb-9vIg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Bqv-8TlP1QYvcEAAb-9vIg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Bqv-8TlP1QYvcEAAb-9vIg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Bqv-8TlP1QYvcEAAb-9vIg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Bqv-8TlP1QYvcEAAb-9vIg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Bqv-8TlP1QYvcEAAb-9vIg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*Bqv-8TlP1QYvcEAAb-9vIg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb pd c" width="700" height="147" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*Bqv-8TlP1QYvcEAAb-9vIg.png"></picture></div></div><figcaption class="pe fm pf oq or pg ph bg b bh ab eb" data-selectable-paragraph="">ReadProcessMemory</figcaption></figure><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or pw"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*_tXC6nIEuzL_hDFzdzlHyw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*_tXC6nIEuzL_hDFzdzlHyw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*_tXC6nIEuzL_hDFzdzlHyw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*_tXC6nIEuzL_hDFzdzlHyw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*_tXC6nIEuzL_hDFzdzlHyw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*_tXC6nIEuzL_hDFzdzlHyw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_tXC6nIEuzL_hDFzdzlHyw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*_tXC6nIEuzL_hDFzdzlHyw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*_tXC6nIEuzL_hDFzdzlHyw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*_tXC6nIEuzL_hDFzdzlHyw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*_tXC6nIEuzL_hDFzdzlHyw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*_tXC6nIEuzL_hDFzdzlHyw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*_tXC6nIEuzL_hDFzdzlHyw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*_tXC6nIEuzL_hDFzdzlHyw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb pd c" width="700" height="315" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*_tXC6nIEuzL_hDFzdzlHyw.png"></picture></div></div><figcaption class="pe fm pf oq or pg ph bg b bh ab eb" data-selectable-paragraph="">NtReadVirtualMemory</figcaption></figure><p id="d418" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">For the RPM function, it looks fine. It does some stack and register set up and then calls ReadProcessMemory inside Kernelbase (Topic for another time). Which would eventually leads you down into ntdll’s NtReadVirtualMemory. However, if you look at NtReadVirtualMemory and know what the most basic detour hook look like, you can tell that this is not normal. The first 5 bytes of the function is modified and the rest are left as-is. You can tell this by looking at other similar functions around it. All the other functions follows a very similar format:</p><p id="a8d5" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">0x4C, 0x8B, 0xD1, // mov r10, rcx; NtReadVirtualMemory</p><p id="34bb" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">0xB8, 0x3c, 0x00, 0x00, 0x00, // eax, 3ch — aka syscall id</p><p id="8b8e" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">0x0F, 0x05, // syscall</p><p id="6afe" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">0xC3 // retn</p><p id="b41a" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">With one difference being the syscall id (which identifies the WINAPI function to be called once inside kernel land). However, for NtReadVirtualMemory, the first instruction is actually a JMP instruction to an address somewhere else in memory. Let’s follow that.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or px"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*68aOIpWqp363FzoyxVjEfg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*68aOIpWqp363FzoyxVjEfg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*68aOIpWqp363FzoyxVjEfg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*68aOIpWqp363FzoyxVjEfg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*68aOIpWqp363FzoyxVjEfg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*68aOIpWqp363FzoyxVjEfg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*68aOIpWqp363FzoyxVjEfg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*68aOIpWqp363FzoyxVjEfg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*68aOIpWqp363FzoyxVjEfg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*68aOIpWqp363FzoyxVjEfg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*68aOIpWqp363FzoyxVjEfg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*68aOIpWqp363FzoyxVjEfg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*68aOIpWqp363FzoyxVjEfg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*68aOIpWqp363FzoyxVjEfg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb pd c" width="700" height="150" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*68aOIpWqp363FzoyxVjEfg.png"></picture></div></div><figcaption class="pe fm pf oq or pg ph bg b bh ab eb" data-selectable-paragraph="">CyMemDef64.dll</figcaption></figure><p id="8495" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">Okay, so we are no longer inside ntdll’s module but instead inside CyMemdef64.dll’s module. Ahhhhh now I get it.</p><p id="6430" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">The EDR placed a jump instruction where the original NtReadVirtualMemory function is supposed to be, redirect the code flow into their own module which then checked for any sort of malicious activity. If the checks fail, the Nt* function would then return with an error code, never entering the kernel land and execute to begin with.</p><h2 id="8340" class="mu mv hl bg mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr bl" data-selectable-paragraph="">The Bypass</h2><p id="fcd8" class="pw-post-body-paragraph ns nt hl nu b nv nw nx ny nz oa ob oc od oe of og oh oi oj ok ol om on oo op he bl" data-selectable-paragraph="">It is now very self-evident what the EDR is doing to detect and stop our WINAPI calls. But how do we get around that? There are two solutions.</p><p id="8575" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph=""><strong class="nu hm">Re-Patch the Patch</strong></p><p id="dac2" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">We know what the NtReadVirtualMemory function <em class="pj">SHOULD </em>looks like and we can easily overwrite the jmp instruction with the correct instructions. This will stop our calls from being intercepted by CyMemDef64.dll and enter the kernel where they have no control over.</p><p id="50c5" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph=""><strong class="nu hm">Ntdll IAT Hook</strong></p><p id="dcba" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">We could also create our own function, similar to what we are doing in Re-Patch the Patch, but instead of overwriting the hooked function, we will recreate it elsewhere. Then, we will walk Ntdll’s Import Address Table, swap out the <mark class="xq xr aq">pointer</mark> for NtReadVirtualMemory and points it to our new fixed_NtReadVirtualMemory. The advantage of this method is that if the EDR decides to check on their hook, it will looks unmodified. It just is never called and the <a class="ah pi" href="https://guidedhacking.com/" rel="noopener ugc nofollow" target="_blank">ntdll IAT</a> is pointed elsewhere.</p><h2 id="e48b" class="mu mv hl bg mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr bl" data-selectable-paragraph="">The Result</h2><p id="8e82" class="pw-post-body-paragraph ns nt hl nu b nv nw nx ny nz oa ob oc od oe of og oh oi oj ok ol om on oo op he bl" data-selectable-paragraph="">I went with the first approach. It is simple, and it allows me to get out the blog quicker :). However, it would be trivial to do the second method and I have plans on doing just that within a few days. Introducing AndrewSpecial, for my manager Andrew who is currently battling a busted appendix in the hospital right now. Get well soon man.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="oz pa fr pb bi pc"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="oq or py"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*iB3oBz4wzOtvLXGq0EGPCw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*iB3oBz4wzOtvLXGq0EGPCw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*iB3oBz4wzOtvLXGq0EGPCw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*iB3oBz4wzOtvLXGq0EGPCw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*iB3oBz4wzOtvLXGq0EGPCw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*iB3oBz4wzOtvLXGq0EGPCw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iB3oBz4wzOtvLXGq0EGPCw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*iB3oBz4wzOtvLXGq0EGPCw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*iB3oBz4wzOtvLXGq0EGPCw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*iB3oBz4wzOtvLXGq0EGPCw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*iB3oBz4wzOtvLXGq0EGPCw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*iB3oBz4wzOtvLXGq0EGPCw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*iB3oBz4wzOtvLXGq0EGPCw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*iB3oBz4wzOtvLXGq0EGPCw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb pd c" width="700" height="211" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*iB3oBz4wzOtvLXGq0EGPCw.png"></picture></div></div><figcaption class="pe fm pf oq or pg ph bg b bh ab eb" data-selectable-paragraph="">AndrewSpecial.exe was never caught :P</figcaption></figure><h2 id="419b" class="mu mv hl bg mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr bl" data-selectable-paragraph="">Conclusion</h2><p id="5f96" class="pw-post-body-paragraph ns nt hl nu b nv nw nx ny nz oa ob oc od oe of og oh oi oj ok ol om on oo op he bl" data-selectable-paragraph="">This currently works for this particular EDR, however — It would be trivial to reverse similar EDR products and create a universal bypass due to their limitation around what they can hook and what they can’t (Thank you KPP).</p><p id="4c97" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">Did I also mention that this works on both 64 bit (on all versions of windows) and 32 bits (untested)? <a class="ah pi" href="https://github.com/hoangprod/AndrewSpecial/tree/master" rel="noopener ugc nofollow" target="_blank">And the source code is available HERE.</a></p><p id="db5f" class="pw-post-body-paragraph ns nt hl nu b nv pk nx ny nz pl ob oc od pm of og oh pn oj ok ol po on oo op he bl" data-selectable-paragraph="">Thank you again for your time and please let me know if I made any mistake.</p></div></div></div></div></section></div></div></article></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="pz qa ac ji"><div class="qb ac"><a class="qc ak ao aq" rel="noopener follow" href="https://medium.com/tag/programming?source=post_page-----2efb21acffd6---------------------------------------" data-discover="true"><div class="qd fr de qe gv qf qg bg b bh ab bl gc">Programming</div></a></div><div class="qb ac"><a class="qc ak ao aq" rel="noopener follow" href="https://medium.com/tag/hacking?source=post_page-----2efb21acffd6---------------------------------------" data-discover="true"><div class="qd fr de qe gv qf qg bg b bh ab bl gc">Hacking</div></a></div><div class="qb ac"><a class="qc ak ao aq" rel="noopener follow" href="https://medium.com/tag/malware?source=post_page-----2efb21acffd6---------------------------------------" data-discover="true"><div class="qd fr de qe gv qf qg bg b bh ab bl gc">Malware</div></a></div><div class="qb ac"><a class="qc ak ao aq" rel="noopener follow" href="https://medium.com/tag/bypass?source=post_page-----2efb21acffd6---------------------------------------" data-discover="true"><div class="qd fr de qe gv qf qg bg b bh ab bl gc">Bypass</div></a></div><div class="qb ac"><a class="qc ak ao aq" rel="noopener follow" href="https://medium.com/tag/endpoint-security?source=post_page-----2efb21acffd6---------------------------------------" data-discover="true"><div class="qd fr de qe gv qf qg bg b bh ab bl gc">Endpoint Security</div></a></div></div></div></div><div class="m"></div><div class="qw m"><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ac iv it ir qx qy"><div class="qz ra rb rc rd re rf rg rh ri ac cw"><div class="i l"><a tabindex="0" rel="noopener follow" href="https://medium.com/@fsx30?source=post_page---post_author_info--2efb21acffd6---------------------------------------" data-discover="true"><div class="m fr"><img alt="Hoang Bui" class="m fk by rj rk de" width="48" height="48" loading="lazy" src="https://miro.medium.com/v2/resize:fill:48:48/1*aI87lLNjPvtF3ZVnHsEZYw.jpeg"><div class="gj by m rj rk fw o ak rl"></div></div></a></div><div class="k j e"><a tabindex="0" rel="noopener follow" href="https://medium.com/@fsx30?source=post_page---post_author_info--2efb21acffd6---------------------------------------" data-discover="true"><div class="m fr"><img alt="Hoang Bui" class="m fk by rm rn de" width="64" height="64" loading="lazy" src="https://miro.medium.com/v2/resize:fill:64:64/1*aI87lLNjPvtF3ZVnHsEZYw.jpeg"><div class="gj by m rm rn fw o ak rl"></div></div></a></div><div class="k j e ro cb"><div class="ac"><button class="td xi aq ac ci r xo kq xp" style="border: 1px solid rgb(36, 36, 36);"><span class="bg b bh ab bl bi"><span class="bn xm">Follow</span></span></button></div></div></div><div class="ac cv cd"><div class="rp rq rr rs rt m"><a class="ah ai aj al am an ao ap aq ar as at au av ac r" rel="noopener follow" href="https://medium.com/@fsx30?source=post_page---post_author_info--2efb21acffd6---------------------------------------" data-discover="true"><h2 class="pw-author-name bg rv rw rx ry rz sa sb od sc sd oh se sf ol sg sh bl"><span class="he ru">Written by Hoang Bui</span></h2></a><div class="qb ac ix"><div class="m cb"><span class="pw-follower-count bg b bh ab eb"><a class="ah ai aj fo al am an ao ap aq ar as at jg" rel="noopener follow" href="https://medium.com/@fsx30/followers?source=post_page---post_author_info--2efb21acffd6---------------------------------------" data-discover="true">357 followers</a></span></div><div class="bg b bh ab eb ac si"><span class="sj m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span><a class="ah ai aj fo al am an ao ap aq ar as at jg" rel="noopener follow" href="https://medium.com/@fsx30/following?source=post_page---post_author_info--2efb21acffd6---------------------------------------" data-discover="true">2 following</a></div></div><div class="sk m"></div></div></div><div class="i l"><div class="ac"><button class="td xi aq ac ci r xo kq xp" style="border: 1px solid rgb(36, 36, 36);"><span class="bg b bh ab bl bi"><span class="bn xm">Follow</span></span></button></div></div></div></div></div></div><div class="sl sm sn so sp m"><div class="sq bi s qw"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ac r cw"><h2 class="bg rv mx mz na nb nd ne nf nh ni nj nl nm nn np nq bl">Responses (7)</h2><div class="ac sr"><div><div class="bn" aria-describedby="15" aria-labelledby="15" role="tooltip"><div tabindex="-1" class="bf"><a class="ss st" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page---post_responses--2efb21acffd6---------------------------------------" rel="noopener follow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" aria-label="Shield with a checkmark" viewBox="0 0 25 25"><path fill-rule="evenodd" d="M11.987 5.036a.754.754 0 0 1 .914-.01c.972.721 1.767 1.218 2.6 1.543.828.322 1.719.485 2.887.505a.755.755 0 0 1 .741.757c-.018 3.623-.43 6.256-1.449 8.21-1.034 1.984-2.662 3.209-4.966 4.083a.75.75 0 0 1-.537-.003c-2.243-.874-3.858-2.095-4.897-4.074-1.024-1.951-1.457-4.583-1.476-8.216a.755.755 0 0 1 .741-.757c1.195-.02 2.1-.182 2.923-.503.827-.322 1.6-.815 2.519-1.535m.468.903c-.897.69-1.717 1.21-2.623 1.564-.898.35-1.856.527-3.026.565.037 3.45.469 5.817 1.36 7.515.884 1.684 2.25 2.762 4.284 3.571 2.092-.81 3.465-1.89 4.344-3.575.886-1.698 1.299-4.065 1.334-7.512-1.149-.039-2.091-.217-2.99-.567-.906-.353-1.745-.873-2.683-1.561m-.009 9.155a2.672 2.672 0 1 0 0-5.344 2.672 2.672 0 0 0 0 5.344m0 1a3.672 3.672 0 1 0 0-7.344 3.672 3.672 0 0 0 0 7.344m-1.813-3.777.525-.526.916.917 1.623-1.625.526.526-2.149 2.152z" clip-rule="evenodd"></path></svg></a></div></div></div></div></div><div class="su sv sw sx sy sz ta m"><div><div class="bg b bh ab bl"><div class="wq"><div class="wy m"><div class="wz ac r"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m bz ca fw o ak rl"></div></div><div class="bo ac cu cv ci"><p class="bg b bh ab eb">Write a response</p></div></div><div class="de bq ac cv wr ws"><div class="ac cv fr"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40fsx30%2Fbypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6&amp;source=---post_responses--2efb21acffd6---------------------respond_sidebar------------------" data-discover="true"><div class="uu m"><p class="bg b bh ab eb">What are your thoughts?</p></div></a></span><div class="cw wt eb ac wu vu wv"><span class="bg b bh ab eb"><div class="ac"><div><div class="bn" aria-describedby="28" aria-labelledby="28" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Bold (⌘B)" class="xa xb xc xd bq lv ci xe xf xg" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M10.308 17.993h-5.92l.11-.894.783-.12c.56-.11.79-.224.79-.448V5.37c0-.225-.113-.336-.902-.448H4.5l-.114-.894h6.255c4.02 0 5.58 1.23 5.58 3.13 0 1.896-1.78 3.125-3.79 3.463v.11c2.69.34 4.25 1.56 4.25 3.57 0 2.35-2.01 3.69-6.37 3.69l.02.01h-.02zm-.335-12.96H8.967V10.5h1.23c1.788 0 2.79-1.23 2.79-2.683 0-1.685-1.004-2.803-3.006-2.803v.02zm-.223 6.36h-.783v5.588l1.225.23h.22c1.67 0 3.01-1.004 3.01-2.792 0-2.122-1.566-3.016-3.69-3.016h.018z"></path></svg></span></div></div></div><div><div class="bn" aria-describedby="29" aria-labelledby="29" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Italic (⌘I)" class="xa xb xc xd bq lv ci xe xf xg" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M9.847 18.04c-.533 0-2.027-.64-1.92-.853l2.027-7.68-.64-.214-1.387 1.494-.427-.427c.534-1.173 1.707-2.667 2.774-2.667.533 0 2.24.534 2.133.854l-2.133 7.786.533.214 1.6-1.067.427.427c-.64 1.066-1.92 2.133-2.987 2.133m2.347-11.733c-.96 0-1.387-.64-1.387-1.387 0-1.067.747-1.92 1.493-1.92.854 0 1.387.64 1.387 1.493-.107 1.067-.747 1.814-1.493 1.814"></path></svg></span></div></div></div></div></span><div class="ww ro ac wu vu wv"><div class="wx"><button class="bg b ec ab bl xh tc td te lu lr tf fc fd fe tg th ti fh fi fj fk bn fl fm" data-testid="CancelResponseButton">Cancel</button></div><button class="bg b ec ab vh xh vi vj vk vl tf fc fd vm vn vo fh fi fj fk bn fl fm" disabled="" data-testid="ResponseRespondButton">Respond</button></div></div></div></div></div></div></div></div></div><div class="sv m"><div class="bi ed"><div class="xz ya m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="75" aria-labelledby="75" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@326509095?source=post_page---post_responses--2efb21acffd6----0-----------------------------------" data-discover="true"><div class="m fr"><div class="m fr"><img alt="test while" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="https://miro.medium.com/v2/resize:fill:32:32/0*EhevBoYBdXwp2s2c.jpg"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="yb m"><div class="ac r"><div><div class="bn" aria-describedby="76" aria-labelledby="76" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r yc yd" rel="noopener follow" href="https://medium.com/@326509095?source=post_page---post_responses--2efb21acffd6----0-----------------------------------" data-discover="true"><div class="ac ix yc"><p class="bg b bh ab ga ye xw yf yg yh yi yj bl">test while</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@326509095/this-was-through-abusing-csrss-to-spawn-a-child-process-and-then-inherit-the-already-existing-ce27a2b7efb9?source=post_page---post_responses--2efb21acffd6----0-----------------------------------" data-discover="true"><p class="bg b ec ab eb"><span>Feb 18, 2019</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an mc ap aq ar fe md me ls mf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="yk m he"><pre class="si"><div class="yl m"><div class="bg b bh ab bl"><div class="wq">“ This was through abusing csrss to spawn a child process and then inherit the already existing handle to lsass.” — how to do this?</div></div></div></pre></div><div class="ym ac r kr cw"><div class="ac r ae"><div class="ac r kr ks"><div class="pw-multi-vote-icon fr kt ku kv kw"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2Fce27a2b7efb9&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40326509095%2Fthis-was-through-abusing-csrss-to-spawn-a-child-process-and-then-inherit-the-already-existing-ce27a2b7efb9&amp;user=test+while&amp;userId=83bbe1d57751&amp;source=---post_responses--ce27a2b7efb9----0-----------------respond_sidebar------------------" data-discover="true"><div class="kx aq ky kz la lb ao lc ld le kw" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div><div class="pw-multi-vote-count m lf lg lh li lj lk ll"><p class="bg b ec ab eb">4</p></div></div><button class="ah fs aj fo al am an ao ap aq ar as at au av ac r yc lu lr ls"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="responses"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bg b ec ab eb">1 reply</p></button><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at pi">Reply</button></p></div></div></div></div></div><div class="sv m"><div class="bi ed"><div class="xz ya m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="77" aria-labelledby="77" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@kankojoseph?source=post_page---post_responses--2efb21acffd6----1-----------------------------------" data-discover="true"><div class="m fr"><div class="m fr"><img alt="Joseph &quot;n3m0” KANKO" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="https://miro.medium.com/v2/resize:fill:32:32/1*m1fYMNmaiHN9OwQuHaDzlw.png"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="yb m"><div class="ac r"><div><div class="bn" aria-describedby="78" aria-labelledby="78" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r yc yd" rel="noopener follow" href="https://medium.com/@kankojoseph?source=post_page---post_responses--2efb21acffd6----1-----------------------------------" data-discover="true"><div class="ac ix yc"><p class="bg b bh ab ga ye xw yf yg yh yi yj bl">Joseph "n3m0” KANKO</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@kankojoseph/thx-c94ef932afea?source=post_page---post_responses--2efb21acffd6----1-----------------------------------" data-discover="true"><p class="bg b ec ab eb"><span>Aug 20, 2025</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an mc ap aq ar fe md me ls mf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="yk m he"><pre class="si"><div class="yl m"><div class="bg b bh ab bl"><div class="wq">thx</div></div></div></pre></div><div class="ym ac r kr cw"><div class="ac r ae"><div class="ac r kr ks"><div class="pw-multi-vote-icon fr yn ku kv kw"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2Fc94ef932afea&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40kankojoseph%2Fthx-c94ef932afea&amp;user=Joseph+%22n3m0%E2%80%9D+KANKO&amp;userId=8d9787449bf9&amp;source=---post_responses--c94ef932afea----1-----------------respond_sidebar------------------" data-discover="true"><div class="kx aq ky kz la lb ao lc ld le kw" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at pi">Reply</button></p></div></div></div></div></div><div class="sv m"><div class="bi ed"><div class="xz ya m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="79" aria-labelledby="79" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@include233333?source=post_page---post_responses--2efb21acffd6----2-----------------------------------" data-discover="true"><div class="m fr"><div class="m fr"><img alt="Include" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="https://miro.medium.com/v2/resize:fill:32:32/0*cIz8OzDWt4DBqK-x"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="yb m"><div class="ac r"><div><div class="bn" aria-describedby="80" aria-labelledby="80" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r yc yd" rel="noopener follow" href="https://medium.com/@include233333?source=post_page---post_responses--2efb21acffd6----2-----------------------------------" data-discover="true"><div class="ac ix yc"><p class="bg b bh ab ga ye xw yf yg yh yi yj bl">Include</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/@include233333/with-kaspersky-installed-when-you-call-openprocess-to-get-process-vm-read-access-to-lsass-exe-95b54f3fedac?source=post_page---post_responses--2efb21acffd6----2-----------------------------------" data-discover="true"><p class="bg b ec ab eb"><span>Aug 15, 2023</span>&nbsp;(edited)</p></a></div></div><div class="bn"><button class="ah fs aj fo al am an mc ap aq ar fe md me ls mf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="yk m he"><pre class="si"><div class="yl m"><div class="bg b bh ab bl"><div class="wq">with Kaspersky installed, when you call OpenProcess to get PROCESS_VM_READ access to lsass.exe, you will get a handle without this access right, because Kaspersky will filter it out, a callback named PreOperationCallback will be called before the…<button class="eb ai aj fo al am an ao ap aq ar as at pi ln lu">more</button></div></div></div></pre></div><div class="ym ac r kr cw"><div class="ac r ae"><div class="ac r kr ks"><div class="pw-multi-vote-icon fr yn ku kv kw"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F95b54f3fedac&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40include233333%2Fwith-kaspersky-installed-when-you-call-openprocess-to-get-process-vm-read-access-to-lsass-exe-95b54f3fedac&amp;user=Include&amp;userId=56654d0d6d6&amp;source=---post_responses--95b54f3fedac----2-----------------respond_sidebar------------------" data-discover="true"><div class="kx aq ky kz la lb ao lc ld le kw" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at pi">Reply</button></p></div></div></div></div></div><div class="tb m"><button class="bg b bh ab bl qd tc td te lu lr tf fc fd fe tg th ti fh tj tk tl tm tn fi fj fk bn fl fm">See all responses</button></div></div></div></div><div class="to tp tq tr ts m bx"><div class="i l k"><div class="sq bi tt tu"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="tv ac kr ji"><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://help.medium.com/hc/en-us?source=post_page-----2efb21acffd6---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Help</p></a></div><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://status.medium.com/?source=post_page-----2efb21acffd6---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Status</p></a></div><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/about?autoplay=1&amp;source=post_page-----2efb21acffd6---------------------------------------" data-discover="true"><p class="bg b ec ab eb">About</p></a></div><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----2efb21acffd6---------------------------------------" data-discover="true"><p class="bg b ec ab eb">Careers</p></a></div><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="mailto:pressinquiries@medium.com" rel="noopener follow"><p class="bg b ec ab eb">Press</p></a></div><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://blog.medium.com/?source=post_page-----2efb21acffd6---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Blog</p></a></div><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2efb21acffd6---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Privacy</p></a></div><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page-----2efb21acffd6---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Rules</p></a></div><div class="tw tx m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2efb21acffd6---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Terms</p></a></div><div class="tw m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://speechify.com/medium?source=post_page-----2efb21acffd6---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Text to speech</p></a></div></div></div></div></div></div></div></div></div></div></div></div>





































<div height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" data-original-tag="iframe"></div>
<div><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><div title="reCAPTCHA" width="256" height="60" role="presentation" name="a-o1gpcbogvrnf" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="https://www.google.com/recaptcha/enterprise/anchor?ar=1&amp;k=6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp&amp;co=aHR0cHM6Ly9tZWRpdW0uY29tOjQ0Mw..&amp;hl=en&amp;v=vUgXt_KV952_-5BB2jjloYzl&amp;size=invisible&amp;anchor-ms=20000&amp;execute-ms=30000&amp;cb=7ea31k791tsr" data-original-tag="iframe">

<title>reCAPTCHA</title>

<link rel="stylesheet" type="text/css" href="https://www.gstatic.com/recaptcha/releases/vUgXt_KV952_-5BB2jjloYzl/styles__ltr.css">


<div id="rc-anchor-alert" class="rc-anchor-alert"></div>

<div class="rc-anchor rc-anchor-invisible rc-anchor-light  rc-anchor-invisible-hover"><div id="recaptcha-accessible-status" class="rc-anchor-aria-status" aria-hidden="true">Recaptcha requires verification. </div><div class="rc-anchor-error-msg-container" style="display:none"><span class="rc-anchor-error-msg" aria-hidden="true"></span></div><div class="rc-anchor-normal-footer"><div class="rc-anchor-logo-large" role="presentation"><div class="rc-anchor-logo-img rc-anchor-logo-img-large"></div></div><div class="rc-anchor-pt"><a href="https://www.google.com/intl/en/policies/privacy/" target="_blank">Privacy</a><span aria-hidden="true" role="presentation"> - </span><a href="https://www.google.com/intl/en/policies/terms/" target="_blank">Terms</a></div></div><div class="rc-anchor-invisible-text"><span>protected by <strong>reCAPTCHA</strong></span><div class="rc-anchor-pt"><a href="https://www.google.com/intl/en/policies/privacy/" target="_blank" style="">Privacy</a><span aria-hidden="true" role="presentation"> - </span><a href="https://www.google.com/intl/en/policies/terms/" target="_blank" style="">Terms</a></div></div></div><div style="display: none;" data-original-tag="iframe"></div></div></div><div class="grecaptcha-error"></div><textarea id="g-recaptcha-response-100000" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div><div style="display: none;" data-original-tag="iframe"></div></div></body></html>