Title:
Creating Processes Using System Calls

Type:
Blog Post

Short Summary (4–8 sentences max):
- This article explains how to reliably create Windows processes using direct syscalls instead of the Win32 `CreateProcess*` APIs, aiming to reduce exposure to userland EDR/AV hooks.  
- It focuses on the practical problem that calling `NtCreateUserProcess` alone often yields a process that immediately crashes because it wasn’t registered with the Windows Subsystem (CSRSS).  
- The author reverse engineers and reimplements the CSRSS notification path (`CsrClientCallServer` and related capture/CSR message building) and discusses how to obtain required `ntdll` globals (`CsrPortHandle`, `CsrPortMemoryRemoteDelta`) by pattern-scanning `ntdll` code rather than hardcoding offsets.  
- It also covers using ALPC (`NtAlpcSendWaitReceivePort`) for the client/server exchange and references ReactOS as a source for internal structure layouts and logic.  
- Finally, it contrasts `NtCreateUserProcess` with `NtCreateProcessEx` (no initial thread creation) in the context of kernel process-creation callbacks used by EDRs, and provides a working implementation (linked GitHub repo) with features like PPID spoofing and DLL blocking.  
- Useful for red teamers and malware developers building custom process creation for defended environments; also relevant to defenders understanding telemetry gaps and alternative creation paths.

Technical Focus:
- Windows process creation internals (`CreateProcessInternalW`, `NtCreateUserProcess`, `NtCreateProcessEx`)
- CSRSS/CSR process registration and messaging (`CsrClientCallServer`)
- ALPC/LPC communication (`NtSecureConnectPort`, `NtAlpcSendWaitReceivePort`)
- Reverse engineering `ntdll` globals via RIP-relative pattern scanning
- `RTL_USER_PROCESS_PARAMETERS` construction and pointer fixups in remote processes
- EDR process creation callbacks and timing (thread insertion vs process object creation)

Use Cases:
- Implement process spawning without calling `CreateProcess*` to reduce userland-hook visibility
- Build custom loaders/spawners that correctly register processes with CSRSS to avoid crashes
- PPID spoofing and controlled process parameters (cwd, command line) via native structures
- Research/detection engineering for nonstandard process creation and CSRSS/ALPC artifacts
- Experimentation with `NtCreateProcessEx`-based creation flows relevant to doppelgänging/herpaderping/ghosting-style primitives

Keywords:
Windows internals, syscalls, NtCreateUserProcess, NtCreateProcessEx, CreateProcessInternalW, CSRSS, CSR, CsrClientCallServer, CsrpConnectToServer, CsrPortHandle, CsrPortMemoryRemoteDelta, ALPC, LPC, NtSecureConnectPort, NtAlpcSendWaitReceivePort, RTL_USER_PROCESS_PARAMETERS, RIP-relative addressing, EDR callbacks, PPID spoofing, DLL blocking, ReactOS