Title:
Primitive Injection – Breaking the Status Quo

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post presents “primitive injection”: building remote memory allocation, read, and write primitives using only minimal process rights (PROCESS_CREATE_THREAD + PROCESS_QUERY_LIMITED_INFORMATION) instead of the usual VM_OPERATION/VM_WRITE/ALL_ACCESS flow.  
- The author uses thread creation and APCs to call existing, CFG-compatible ntdll functions as “function-oriented primitives” rather than classic ROP gadgets.  
- Remote allocation is done by starting a remote thread at `malloc`, then reconstructing the full x64 pointer by combining the 32-bit thread exit code with the target process heap base read from the PEB.  
- Remote read is implemented via repeated remote calls to `RtlQueryDepthSList` (2 bytes per call) and collecting return values via `GetExitCodeThread`.  
- Remote write is implemented by queuing APCs that call `RtlInitializeBitMapEx` to write 16 bytes per APC (plus `RtlFillMemory` for tail bytes), avoiding massive APC counts and related detections (e.g., “StackBombing”).  
- It’s useful for red teamers and implant developers aiming to reduce common injection IOCs/telemetry (notably avoiding ReadProcessMemory/WriteProcessMemory ETWTI), and is also relevant to exploit dev due to CFG/CET considerations.

Technical Focus:
- Minimal-rights remote process injection (PROCESS_CREATE_THREAD / PROCESS_QUERY_LIMITED_INFORMATION)
- NtCreateThreadEx + GetExitCodeThread return-value abuse on x64
- PEB/ProcessBasicInformation parsing via NtQueryInformationProcess
- Remote memory read primitive using RtlQueryDepthSList
- Remote memory write via NtQueueApcThread + RtlInitializeBitMapEx (16-byte writes)
- CFG/CET (IBT) implications using function calls vs ROP gadgets

Use Cases:
- Low-IOC remote injection workflows without ReadProcessMemory/WriteProcessMemory
- Building custom remote memory primitives for post-exploitation frameworks/BOFs
- Researching CFG/CET-tolerant code-reuse and “function-oriented” primitives
- Situations where only limited process handle rights are obtainable
- Alternative remote staging/write mechanisms that reduce APC volume/detections

Keywords:
process injection, PROCESS_CREATE_THREAD, PROCESS_QUERY_LIMITED_INFORMATION, NtCreateThreadEx, NtQueueApcThread, GetExitCodeThread, NtQueryInformationProcess, ProcessBasicInformation, PEB, heap base, malloc, RtlQueryDepthSList, RtlInitializeBitMapEx, RtlFillMemory, APC injection, CFG, CET, IBT, ETWTI, WriteProcessMemory bypass, ReadProcessMemory bypass