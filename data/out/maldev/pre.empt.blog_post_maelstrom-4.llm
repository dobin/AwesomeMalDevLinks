Title:
Maelstrom 4: Building the Implant (Stage0 PIC loader + Stage1 Reflective DLL)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post continues the Maelstrom C2 series by moving from architecture into implementing a basic Windows implant with a two-stage design.  
- Stage0 is a position-independent (PIC) loader intended to be extractable as shellcode; it performs basic safety/evasion checks, resolves WinAPI dynamically via PEB parsing, downloads the next stage over WinHTTP, and reflectively loads it.  
- Stage1 is a Reflective DLL (RDLL) implant that starts a worker thread from `DllMain`, performs initial host enumeration, and “checks in” to the team server using WinHTTP with simple XOR “encryption” as a placeholder.  
- The post frames why classic post-exploitation patterns (spawning `cmd.exe`/PowerShell) are increasingly noisy under modern EDR/SIEM telemetry, and motivates in-process execution and modular loading approaches.  
- It covers guardrailing/environmental keying, suspicious-process checks, anti-sandbox heuristics, and anti-debug via the PEB `BeingDebugged` flag, while explicitly noting the PoC contains common IOCs for detectability.  
- Useful for red team/offensive tool developers learning implant tradecraft and for defenders wanting to understand common loader/reflective-loading artifacts and detection points.

Technical Focus:
- Position Independent Code (PIC) loaders and extracting `.text` as shellcode
- PEB parsing for module enumeration and custom GetProcAddress (export table walking, hashing)
- Reflective DLL loading (RDLL), RVA/offset calculations, export resolution
- WinHTTP-based staging/check-in and header-based “authentication”
- Basic evasion/guardrails: environmental keying, process enumeration, anti-sandbox, anti-debug
- Memory permissions and OPSEC considerations (RWX regions, sleep/obfuscation references)

Use Cases:
- Build a minimal staged Windows implant (PIC stager + RDLL payload) for C2 prototyping
- Implement dynamic API resolution to reduce static imports and support shellcode-style execution
- Add guardrails to restrict execution to intended hosts/environments
- Prototype reflective loading and understand its common indicators for detection engineering
- Generate reusable shellcode from a loader for embedding in droppers/loaders in other languages

Keywords:
Maelstrom, C2 implant, stage0 stager, stage1 implant, position-independent code, PIC, shellcode, PEB, Process Environment Block, export table parsing, custom GetProcAddress, DJB2 hash, WinAPI resolution, WinHTTP, reflective DLL injection, RDLL, VirtualAlloc, VirtualProtect, CreateThread, Toolhelp32Snapshot, anti-debug, BeingDebugged, anti-sandbox, guardrailing, environmental keying, memory RWX, OPSEC, MITRE T1059, MITRE T1480