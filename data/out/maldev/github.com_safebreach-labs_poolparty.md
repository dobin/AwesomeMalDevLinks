# https://github.com/SafeBreach-Labs/PoolParty

[Skip to content](https://github.com/SafeBreach-Labs/PoolParty#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/SafeBreach-Labs/PoolParty) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/SafeBreach-Labs/PoolParty) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/SafeBreach-Labs/PoolParty) to refresh your session.Dismiss alert

{{ message }}

[SafeBreach-Labs](https://github.com/SafeBreach-Labs)/ **[PoolParty](https://github.com/SafeBreach-Labs/PoolParty)** Public

- [Notifications](https://github.com/login?return_to=%2FSafeBreach-Labs%2FPoolParty) You must be signed in to change notification settings
- [Fork\\
171](https://github.com/login?return_to=%2FSafeBreach-Labs%2FPoolParty)
- [Star\\
1.2k](https://github.com/login?return_to=%2FSafeBreach-Labs%2FPoolParty)


A set of fully-undetectable process injection techniques abusing Windows Thread Pools


### License

[BSD-3-Clause license](https://github.com/SafeBreach-Labs/PoolParty/blob/main/LICENSE)

[1.2k\\
stars](https://github.com/SafeBreach-Labs/PoolParty/stargazers) [171\\
forks](https://github.com/SafeBreach-Labs/PoolParty/forks) [Branches](https://github.com/SafeBreach-Labs/PoolParty/branches) [Tags](https://github.com/SafeBreach-Labs/PoolParty/tags) [Activity](https://github.com/SafeBreach-Labs/PoolParty/activity)

[Star](https://github.com/login?return_to=%2FSafeBreach-Labs%2FPoolParty)

[Notifications](https://github.com/login?return_to=%2FSafeBreach-Labs%2FPoolParty) You must be signed in to change notification settings

# SafeBreach-Labs/PoolParty

main

[**2** Branches](https://github.com/SafeBreach-Labs/PoolParty/branches) [**1** Tag](https://github.com/SafeBreach-Labs/PoolParty/tags)

[Go to Branches page](https://github.com/SafeBreach-Labs/PoolParty/branches)[Go to Tags page](https://github.com/SafeBreach-Labs/PoolParty/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![0xDeku](https://avatars.githubusercontent.com/u/93016131?v=4&size=40)](https://github.com/0xDeku)[0xDeku](https://github.com/SafeBreach-Labs/PoolParty/commits?author=0xDeku)<br>[Merge pull request](https://github.com/SafeBreach-Labs/PoolParty/commit/77e968b35f4bad74add33ea8a2b0b5ed9543276c) [#1](https://github.com/SafeBreach-Labs/PoolParty/pull/1) [from SafeBreach-Labs/develop](https://github.com/SafeBreach-Labs/PoolParty/commit/77e968b35f4bad74add33ea8a2b0b5ed9543276c)<br>Open commit details<br>3 years agoDec 6, 2023<br>[77e968b](https://github.com/SafeBreach-Labs/PoolParty/commit/77e968b35f4bad74add33ea8a2b0b5ed9543276c) · 3 years agoDec 6, 2023<br>## History<br>[61 Commits](https://github.com/SafeBreach-Labs/PoolParty/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/SafeBreach-Labs/PoolParty/commits/main/) 61 Commits |
| [PoolParty](https://github.com/SafeBreach-Labs/PoolParty/tree/main/PoolParty "PoolParty") | [PoolParty](https://github.com/SafeBreach-Labs/PoolParty/tree/main/PoolParty "PoolParty") | [Removed use of error handler in query template](https://github.com/SafeBreach-Labs/PoolParty/commit/b261344cc0382d3e825ed045c7c6ba8d9fbb0a45 "Removed use of error handler in query template") | 3 years agoDec 6, 2023 |
| [.gitattributes](https://github.com/SafeBreach-Labs/PoolParty/blob/main/.gitattributes ".gitattributes") | [.gitattributes](https://github.com/SafeBreach-Labs/PoolParty/blob/main/.gitattributes ".gitattributes") | [Add .gitattributes and .gitignore.](https://github.com/SafeBreach-Labs/PoolParty/commit/292b910c794b6058f240b0ed878d373832075d84 "Add .gitattributes and .gitignore.") | 3 years agoDec 2, 2023 |
| [.gitignore](https://github.com/SafeBreach-Labs/PoolParty/blob/main/.gitignore ".gitignore") | [.gitignore](https://github.com/SafeBreach-Labs/PoolParty/blob/main/.gitignore ".gitignore") | [Add .gitattributes and .gitignore.](https://github.com/SafeBreach-Labs/PoolParty/commit/292b910c794b6058f240b0ed878d373832075d84 "Add .gitattributes and .gitignore.") | 3 years agoDec 2, 2023 |
| [LICENSE](https://github.com/SafeBreach-Labs/PoolParty/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/SafeBreach-Labs/PoolParty/blob/main/LICENSE "LICENSE") | [Create LICENSE](https://github.com/SafeBreach-Labs/PoolParty/commit/0af28fbef0936b46e9c5f4346dd12469b36b1d80 "Create LICENSE") | 3 years agoDec 2, 2023 |
| [PoolParty.sln](https://github.com/SafeBreach-Labs/PoolParty/blob/main/PoolParty.sln "PoolParty.sln") | [PoolParty.sln](https://github.com/SafeBreach-Labs/PoolParty/blob/main/PoolParty.sln "PoolParty.sln") | [Add project files.](https://github.com/SafeBreach-Labs/PoolParty/commit/70fea59fa5b913ad4984d115a3d430a4dda26193 "Add project files.") | 3 years agoDec 2, 2023 |
| [README.md](https://github.com/SafeBreach-Labs/PoolParty/blob/main/README.md "README.md") | [README.md](https://github.com/SafeBreach-Labs/PoolParty/blob/main/README.md "README.md") | [Update README.md](https://github.com/SafeBreach-Labs/PoolParty/commit/20ac9292528b642f2406e1876e66204d68ab8d41 "Update README.md") | 3 years agoDec 3, 2023 |
| View all files |

## Repository files navigation

# PoolParty

[Permalink: PoolParty](https://github.com/SafeBreach-Labs/PoolParty#poolparty)

A collection of fully-undetectable process injection techniques abusing Windows Thread Pools. Presented at Black Hat EU 2023 Briefings under the title - [**The Pool Party You Will Never Forget: New Process Injection Techniques Using Windows Thread Pools**](https://www.blackhat.com/eu-23/briefings/schedule/#the-pool-party-you-will-never-forget-new-process-injection-techniques-using-windows-thread-pools-35446)

## PoolParty Variants

[Permalink: PoolParty Variants](https://github.com/SafeBreach-Labs/PoolParty#poolparty-variants)

| Variant ID | Varient Description |
| --- | --- |
| 1 | Overwrite the start routine of the target worker factory |
| 2 | Insert TP\_WORK work item to the target process's thread pool |
| 3 | Insert TP\_WAIT work item to the target process's thread pool |
| 4 | Insert TP\_IO work item to the target process's thread pool |
| 5 | Insert TP\_ALPC work item to the target process's thread pool |
| 6 | Insert TP\_JOB work item to the target process's thread pool |
| 7 | Insert TP\_DIRECT work item to the target process's thread pool |
| 8 | Insert TP\_TIMER work item to the target process's thread pool |

## Usage

[Permalink: Usage](https://github.com/SafeBreach-Labs/PoolParty#usage)

```
PoolParty.exe -V <VARIANT ID> -P <TARGET PID>
```

## Usage Examples

[Permalink: Usage Examples](https://github.com/SafeBreach-Labs/PoolParty#usage-examples)

Insert TP\_TIMER work item to process ID 1234

```
>> PoolParty.exe -V 8 -P 1234

[info]    Starting PoolParty attack against process id: 1234
[info]    Retrieved handle to the target process: 00000000000000B8
[info]    Hijacked worker factory handle from the target process: 0000000000000058
[info]    Hijacked timer queue handle from the target process: 0000000000000054
[info]    Allocated shellcode memory in the target process: 00000281DBEF0000
[info]    Written shellcode to the target process
[info]    Retrieved target worker factory basic information
[info]    Created TP_TIMER structure associated with the shellcode
[info]    Allocated TP_TIMER memory in the target process: 00000281DBF00000
[info]    Written the specially crafted TP_TIMER structure to the target process
[info]    Modified the target process's TP_POOL tiemr queue list entry to point to the specially crafted TP_TIMER
[info]    Set the timer queue to expire to trigger the dequeueing TppTimerQueueExpiration
[info]    PoolParty attack completed successfully
```

## Default Shellcode and Customization

[Permalink: Default Shellcode and Customization](https://github.com/SafeBreach-Labs/PoolParty#default-shellcode-and-customization)

The default shellcode spawns a calculator via the [WinExec API](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-winexec).

To customize the executable to execute, change the path in the end of the `g_Shellcode` variable present in the main.cpp file.

## Author - Alon Leviev

[Permalink: Author - Alon Leviev](https://github.com/SafeBreach-Labs/PoolParty#author---alon-leviev)

- LinkedIn - [Alon Leviev](https://il.linkedin.com/in/alonleviev)
- Twitter - [@\_0xDeku](https://twitter.com/_0xDeku)

## About

A set of fully-undetectable process injection techniques abusing Windows Thread Pools


### Resources

[Readme](https://github.com/SafeBreach-Labs/PoolParty#readme-ov-file)

### License

[BSD-3-Clause license](https://github.com/SafeBreach-Labs/PoolParty#BSD-3-Clause-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/SafeBreach-Labs/PoolParty).

[Activity](https://github.com/SafeBreach-Labs/PoolParty/activity)

[Custom properties](https://github.com/SafeBreach-Labs/PoolParty/custom-properties)

### Stars

[**1.2k**\\
stars](https://github.com/SafeBreach-Labs/PoolParty/stargazers)

### Watchers

[**19**\\
watching](https://github.com/SafeBreach-Labs/PoolParty/watchers)

### Forks

[**171**\\
forks](https://github.com/SafeBreach-Labs/PoolParty/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FSafeBreach-Labs%2FPoolParty&report=SafeBreach-Labs+%28user%29)

## [Releases\  1](https://github.com/SafeBreach-Labs/PoolParty/releases)

[PoolParty\\
Latest\\
\\
on Dec 6, 2023Dec 6, 2023](https://github.com/SafeBreach-Labs/PoolParty/releases/tag/PoolParty)

## [Packages\  0](https://github.com/orgs/SafeBreach-Labs/packages?repo_name=PoolParty)

No packages published

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/SafeBreach-Labs/PoolParty).

## Languages

- [C++100.0%](https://github.com/SafeBreach-Labs/PoolParty/search?l=c%2B%2B)

You can’t perform that action at this time.