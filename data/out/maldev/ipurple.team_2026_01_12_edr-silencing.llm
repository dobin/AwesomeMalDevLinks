Title:
EDR Silencing

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes “EDR silencing”: disrupting an endpoint’s EDR agent outbound connectivity to its cloud console to blind detections without killing the agent/service.  
- It focuses on abusing native Windows networking components (primarily Windows Filtering Platform) and local name resolution/routing mechanisms (hosts, NRPT, routes, IPSec policy) to block EDR egress, typically requiring local admin privileges.  
- It reviews public PoCs inspired by MDSec’s FireBlock approach, including EDRSilencer (C), SilentButDeadly, and WFP_EDR (Go), showing how filters are added (e.g., FwpmFilterAdd0) and how targets are identified via process enumeration and image-path resolution.  
- The article provides a purple-team playbook with multiple execution paths and highlights operational considerations (avoid running untrusted binaries; prevent full host isolation via bypass rules).  
- It also covers detection engineering: enabling specific Windows auditing policies, monitoring key registry/file locations, and correlating WFP/IPSec/NRPT/hosts modifications with relevant Windows Event IDs and process ancestry.  
- Useful for purple teams and defenders building resilience and detections; also relevant to red teams for understanding realistic “visibility degradation” tradecraft and its telemetry.

Technical Focus:
- Windows Filtering Platform (WFP) filter/provider manipulation (FwpmEngineOpen0, FwpmProviderAdd0, FwpmFilterAdd0/DeleteById0)
- Process discovery for targeting (CreateToolhelp32Snapshot, Process32First/Next, OpenProcess, QueryFullProcessImageNameW)
- DNS/name resolution tampering (hosts/hosts.ics, NRPT via Add-DnsClientNrptRule)
- Network path disruption (routing table changes, secondary IP assignment)
- IPSec policy/filter abuse via netsh and registry-backed policy storage
- Windows auditing/detection mapping (Security Event IDs, registry/file auditing, Sigma rule)

Use Cases:
- Emulate EDR cloud-visibility loss in purple-team exercises
- Build detections for WFP filter additions and blocked-connection telemetry (e.g., 5157/5444/5441/5445)
- Incident response triage for “EDR stopped reporting” scenarios (check WFP/NRPT/hosts/IPSec/routes)
- Validate hardening controls (GPO auditing, application control, restricting netsh/PowerShell capabilities)
- Create test cases for SOC alerting on suspicious modifications to BFE/WFP and DNS policy registry keys

Keywords:
EDR silencing, Windows Filtering Platform, WFP, BFE, FwpmFilterAdd0, FwpmProviderAdd0, FwpmEngineOpen0, FWPM_LAYER_ALE_AUTH_CONNECT_V4, FWPM_LAYER_ALE_AUTH_RECV_ACCEPT_V4, FWP_ACTION_BLOCK, netsh wfp, hosts file, hosts.ics, NRPT, Add-DnsClientNrptRule, Dnscache, IPSec policy, netsh ipsec static, routing table, New-NetRoute, secondary IP address, registry auditing, Event ID 5157, Event ID 5444, Event ID 5441, Event ID 4663, Sigma, ATT&CK T1562