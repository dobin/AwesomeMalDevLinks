Title:
Abusing native Windows functions for shellcode execution

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post analyzes a maldoc technique that executes shellcode by passing its memory address as a callback/function-pointer argument to legitimate Win32 APIs.  
- It uses `EnumResourceTypesA` as an example: the API repeatedly calls a supplied callback pointer, so pointing it at shellcode transfers execution (assuming executable memory).  
- The author enumerates Windows SDK header files to find APIs with callback-like parameters (`Func/Proc/Callback/lpfn/lpproc`) that can be repurposed for code execution.  
- A large candidate list is produced, and ~49 functions are validated as “low-friction” shellcode triggers requiring minimal setup.  
- The post introduces `trigen`, a script that generates randomized VBA macro variants by mixing memory allocation, shellcode copy, and one of many callback-based execution APIs to reduce static/dynamic detection patterns.  
- It’s primarily useful for red teams, exploit developers, and malware analysts studying macro tradecraft and alternative execution primitives.

Technical Focus:
- Win32 callback/function-pointer abuse for indirect code execution
- VBA macros calling Windows APIs (maldoc execution flow)
- Memory allocation and shellcode staging (e.g., `HeapCreate/HeapAlloc`, `RtlMoveMemory`)
- API surface enumeration via Windows SDK header parsing
- Evasion via polymorphic macro generation / artifact variation
- Execution prerequisites (executable memory / DEP considerations)

Use Cases:
- Generate varied VBA maldoc payload templates with different execution triggers
- Replace common “CreateThread”-style execution with callback-based primitives
- Reduce signature-based detections by rotating API call patterns
- Identify additional imported APIs in a target process that can serve as execution pivots
- Build smaller ROP chains by leveraging existing imported callback APIs

Keywords:
Windows API, Win32, VBA, maldoc, shellcode, callback, function pointer, EnumResourceTypesA, EnumSystemCodePagesW, CallWindowProc, SetWindowsHookEx, SendMessageCallback, HeapAlloc, HeapCreate, RtlMoveMemory, ntdll, kernel32, DEP, ROP, trigen, macro generation, Windows SDK headers, API enumeration