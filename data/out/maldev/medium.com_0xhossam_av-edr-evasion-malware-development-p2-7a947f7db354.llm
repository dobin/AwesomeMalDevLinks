Title:
AV/EDR Evasion | Malware Development — P2

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post continues a beginner-oriented malware development series focused on basic AV/EDR evasion patterns in Windows.  
- It demonstrates “function call obfuscation” by resolving sensitive WinAPI calls (e.g., VirtualAlloc/CreateThread) dynamically via `GetModuleHandle` + `GetProcAddress`, with XOR-encrypted API name strings decrypted at runtime.  
- It covers simple payload obfuscation using XOR and an additional idea of encoding shellcode into UUID-formatted chunks (16-byte blocks) to reduce obvious byte-pattern signatures.  
- The author introduces rudimentary sandbox evasion checks (registry artifacts, empty Desktop/Downloads heuristics) and a basic anti-debug check using `IsDebuggerPresent`.  
- It ends with a classic process injection example targeting `msedge.exe` using Toolhelp process enumeration, `OpenProcess`, `VirtualAllocEx`, `WriteProcessMemory`, and `CreateRemoteThread`.  
- Useful primarily for red teamers and learners building first-stage loaders, and for defenders as a catalog of common, low-complexity behaviors to detect.

Technical Focus:
- Dynamic API resolution (GetProcAddress/GetModuleHandle) and function pointer typedefs
- String obfuscation via XOR and runtime decryption
- Sandbox/VM heuristics (registry checks, user-folder file-count checks)
- Anti-debugging (`IsDebuggerPresent`, early-exit logic)
- Shellcode encoding/obfuscation using UUID chunking
- Process injection via remote memory allocation + remote thread creation

Use Cases:
- Building a basic Windows shellcode loader with reduced static indicators
- Implementing simple anti-analysis gates before payload execution
- Demonstrating common injection primitives for training/lab environments
- Creating detection content for suspicious API resolution and injection chains
- Reverse engineering practice: mapping obfuscation layers to underlying WinAPI calls

Keywords:
AV evasion, EDR evasion, malware development, Windows API, dynamic API resolution, GetProcAddress, GetModuleHandle, kernel32.dll, VirtualAlloc, CreateThread, RtlMoveMemory, VirtualAllocEx, WriteProcessMemory, CreateRemoteThread, Toolhelp32Snapshot, Process32First, IsDebuggerPresent, sandbox evasion, registry artifacts, XOR encryption, UUID shellcode encoding, process injection, msedge.exe