Title:
Bypassing Windows Defender Runtime Scanning

Type:
Blog Post

Short Summary (4–8 sentences max):
- This write-up analyzes how Windows Defender performs static (on-disk) and runtime (in-memory) scanning, and demonstrates practical bypasses for both.  
- It shows that encrypting/packing payloads (a custom crypter) can evade Defender’s static signatures even with common payloads like Metasploit Meterpreter, but runtime scanning can still terminate sessions when certain actions occur.  
- The author identifies that Defender’s memory scanning can be *triggered* by specific WinAPI calls (notably `CreateProcess` and `CreateRemoteThread`), likely via kernel-level telemetry rather than userland hooks.  
- A bypass is implemented by hooking `CreateProcessInternalW`, suspending the Meterpreter thread, flipping the payload’s memory pages to `PAGE_NOACCESS` to avoid scanning, then restoring permissions after a delay and resuming execution.  
- The post also notes some processes (e.g., `explorer.exe`, `smartscreen.exe`) did not trigger the same scanning behavior, suggesting potential “safe” injection targets.  
- It’s useful for red teamers and offensive security researchers testing AV/Defender evasion and for defenders understanding trigger points and memory-permission abuse.

Technical Focus:
- Windows Defender real-time scanning triggers (API-driven runtime scanning)
- WinAPI hooking/trampolines (inline JMP patching)
- Memory protection manipulation (`VirtualProtect`, `PAGE_NOACCESS`, RWX)
- Metasploit/Meterpreter behavior and post-exploitation stability
- Process injection techniques (shellcode injection, process hollowing, reflective loading)
- `CreateProcessInternalW` / `CreateRemoteThread` telemetry implications

Use Cases:
- Testing Defender evasion against common payload frameworks (e.g., Meterpreter)
- Building PoCs to study AV runtime scanning boundaries and trigger conditions
- Developing post-exploitation modules that temporarily hide in-memory code during scans
- Evaluating which injection targets/processes reduce Defender runtime scrutiny
- Informing defensive detections around suspicious memory-permission flips and API-hook patterns

Keywords:
Windows Defender, runtime scanning, memory scanning, static analysis bypass, crypter, Meterpreter, Metasploit, CreateProcess, CreateProcessInternalW, CreateRemoteThread, inline hooking, JMP patch, VirtualProtect, PAGE_NOACCESS, PAGE_EXECUTE_READWRITE, process injection, reflective loading, process hollowing, RWX memory, kernel telemetry