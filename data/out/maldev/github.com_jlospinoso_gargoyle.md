# https://github.com/JLospinoso/gargoyle

[Skip to content](https://github.com/JLospinoso/gargoyle#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/JLospinoso/gargoyle) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/JLospinoso/gargoyle) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/JLospinoso/gargoyle) to refresh your session.Dismiss alert

{{ message }}

[JLospinoso](https://github.com/JLospinoso)/ **[gargoyle](https://github.com/JLospinoso/gargoyle)** Public

- [Notifications](https://github.com/login?return_to=%2FJLospinoso%2Fgargoyle) You must be signed in to change notification settings
- [Fork\\
118](https://github.com/login?return_to=%2FJLospinoso%2Fgargoyle)
- [Star\\
897](https://github.com/login?return_to=%2FJLospinoso%2Fgargoyle)


A memory scanning evasion technique


[jlospinoso.github.io/security/assembly/c/cpp/developing/software/2017/03/04/gargoyle-memory-analysis-evasion.html](https://jlospinoso.github.io/security/assembly/c/cpp/developing/software/2017/03/04/gargoyle-memory-analysis-evasion.html "https://jlospinoso.github.io/security/assembly/c/cpp/developing/software/2017/03/04/gargoyle-memory-analysis-evasion.html")

### License

[AGPL-3.0 license](https://github.com/JLospinoso/gargoyle/blob/master/LICENSE)

[897\\
stars](https://github.com/JLospinoso/gargoyle/stargazers) [118\\
forks](https://github.com/JLospinoso/gargoyle/forks) [Branches](https://github.com/JLospinoso/gargoyle/branches) [Tags](https://github.com/JLospinoso/gargoyle/tags) [Activity](https://github.com/JLospinoso/gargoyle/activity)

[Star](https://github.com/login?return_to=%2FJLospinoso%2Fgargoyle)

[Notifications](https://github.com/login?return_to=%2FJLospinoso%2Fgargoyle) You must be signed in to change notification settings

# JLospinoso/gargoyle

master

[**1** Branch](https://github.com/JLospinoso/gargoyle/branches) [**0** Tags](https://github.com/JLospinoso/gargoyle/tags)

[Go to Branches page](https://github.com/JLospinoso/gargoyle/branches)[Go to Tags page](https://github.com/JLospinoso/gargoyle/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![JLospinoso](https://avatars.githubusercontent.com/u/147698?v=4&size=40)](https://github.com/JLospinoso)[JLospinoso](https://github.com/JLospinoso/gargoyle/commits?author=JLospinoso)<br>[Merge pull request](https://github.com/JLospinoso/gargoyle/commit/38416e4cbce28cd0f1884801393da2d2ccd6726e) [#10](https://github.com/JLospinoso/gargoyle/pull/10) [from ccooper21/rop\_gadget\_search](https://github.com/JLospinoso/gargoyle/commit/38416e4cbce28cd0f1884801393da2d2ccd6726e)<br>Open commit details<br>9 years agoMay 23, 2017<br>[38416e4](https://github.com/JLospinoso/gargoyle/commit/38416e4cbce28cd0f1884801393da2d2ccd6726e) · 9 years agoMay 23, 2017<br>## History<br>[33 Commits](https://github.com/JLospinoso/gargoyle/commits/master/) <br>Open commit details<br>[View commit history for this file.](https://github.com/JLospinoso/gargoyle/commits/master/) 33 Commits |
| [.gitignore](https://github.com/JLospinoso/gargoyle/blob/master/.gitignore ".gitignore") | [.gitignore](https://github.com/JLospinoso/gargoyle/blob/master/.gitignore ".gitignore") | [Draft images](https://github.com/JLospinoso/gargoyle/commit/2651f040c892cbb95c544e3ba31adb5cf84f3da3 "Draft images") | 9 years agoMar 3, 2017 |
| [Gargoyle.sln](https://github.com/JLospinoso/gargoyle/blob/master/Gargoyle.sln "Gargoyle.sln") | [Gargoyle.sln](https://github.com/JLospinoso/gargoyle/blob/master/Gargoyle.sln "Gargoyle.sln") | [Windows x86 POC](https://github.com/JLospinoso/gargoyle/commit/bb14dc9f4d62486943ee3865a24242b4d58a7f31 "Windows x86 POC") | 9 years agoMar 3, 2017 |
| [Gargoyle.vcxproj](https://github.com/JLospinoso/gargoyle/blob/master/Gargoyle.vcxproj "Gargoyle.vcxproj") | [Gargoyle.vcxproj](https://github.com/JLospinoso/gargoyle/blob/master/Gargoyle.vcxproj "Gargoyle.vcxproj") | [\[Issue](https://github.com/JLospinoso/gargoyle/commit/ef92d0732343812dd6619df1c5cdb7ce3cb53f0c "[Issue #9] Search for the ROP gadget in \"mshtml.dll\" at run-time instead of using hard coded offsets  - Gargoyle now loads the \"mshtml.dll\" system DLL into memory and searches the executable portions of its address space to find a suitable ROP gadget.  As a result, Gargoyle is now immune to Microsoft updating \"mshtml.dll\", as long as the DLL is not changed at some point to eliminate the ROP gadget.") [#9](https://github.com/JLospinoso/gargoyle/issues/9) [\] Search for the ROP gadget in "mshtml.dll" at run-time instead](https://github.com/JLospinoso/gargoyle/commit/ef92d0732343812dd6619df1c5cdb7ce3cb53f0c "[Issue #9] Search for the ROP gadget in \"mshtml.dll\" at run-time instead of using hard coded offsets  - Gargoyle now loads the \"mshtml.dll\" system DLL into memory and searches the executable portions of its address space to find a suitable ROP gadget.  As a result, Gargoyle is now immune to Microsoft updating \"mshtml.dll\", as long as the DLL is not changed at some point to eliminate the ROP gadget.") | 9 years agoMay 23, 2017 |
| [Gargoyle.vcxproj.filters](https://github.com/JLospinoso/gargoyle/blob/master/Gargoyle.vcxproj.filters "Gargoyle.vcxproj.filters") | [Gargoyle.vcxproj.filters](https://github.com/JLospinoso/gargoyle/blob/master/Gargoyle.vcxproj.filters "Gargoyle.vcxproj.filters") | [Upgrading to VS2017](https://github.com/JLospinoso/gargoyle/commit/fa77ba72daa146439a501b3cfc78aff572316730 "Upgrading to VS2017") | 9 years agoMar 8, 2017 |
| [LICENSE](https://github.com/JLospinoso/gargoyle/blob/master/LICENSE "LICENSE") | [LICENSE](https://github.com/JLospinoso/gargoyle/blob/master/LICENSE "LICENSE") | [Initial commit](https://github.com/JLospinoso/gargoyle/commit/4c7386e0064b05a1d55b3ed7719ab1027db7c34a "Initial commit") | 9 years agoMar 3, 2017 |
| [README.md](https://github.com/JLospinoso/gargoyle/blob/master/README.md "README.md") | [README.md](https://github.com/JLospinoso/gargoyle/blob/master/README.md "README.md") | [Merge branch 'master' of github.com:jlospinoso/gargoyle](https://github.com/JLospinoso/gargoyle/commit/d7b1ceb1d98ac6b7b1901238fd70bb05fd8b9e28 "Merge branch 'master' of github.com:jlospinoso/gargoyle") | 9 years agoMar 8, 2017 |
| [gadget.nasm](https://github.com/JLospinoso/gargoyle/blob/master/gadget.nasm "gadget.nasm") | [gadget.nasm](https://github.com/JLospinoso/gargoyle/blob/master/gadget.nasm "gadget.nasm") | [Windows x86 POC](https://github.com/JLospinoso/gargoyle/commit/bb14dc9f4d62486943ee3865a24242b4d58a7f31 "Windows x86 POC") | 9 years agoMar 3, 2017 |
| [gargoyle.png](https://github.com/JLospinoso/gargoyle/blob/master/gargoyle.png "gargoyle.png") | [gargoyle.png](https://github.com/JLospinoso/gargoyle/blob/master/gargoyle.png "gargoyle.png") | [Draft images](https://github.com/JLospinoso/gargoyle/commit/2651f040c892cbb95c544e3ba31adb5cf84f3da3 "Draft images") | 9 years agoMar 3, 2017 |
| [infographic.png](https://github.com/JLospinoso/gargoyle/blob/master/infographic.png "infographic.png") | [infographic.png](https://github.com/JLospinoso/gargoyle/blob/master/infographic.png "infographic.png") | [Draft images](https://github.com/JLospinoso/gargoyle/commit/2651f040c892cbb95c544e3ba31adb5cf84f3da3 "Draft images") | 9 years agoMar 3, 2017 |
| [infographic\_web.png](https://github.com/JLospinoso/gargoyle/blob/master/infographic_web.png "infographic_web.png") | [infographic\_web.png](https://github.com/JLospinoso/gargoyle/blob/master/infographic_web.png "infographic_web.png") | [800px](https://github.com/JLospinoso/gargoyle/commit/9ef3e1dd1b1ec8058e40847ffa56de86d9cbc297 "800px") | 9 years agoMar 4, 2017 |
| [main.cpp](https://github.com/JLospinoso/gargoyle/blob/master/main.cpp "main.cpp") | [main.cpp](https://github.com/JLospinoso/gargoyle/blob/master/main.cpp "main.cpp") | [\[Issue](https://github.com/JLospinoso/gargoyle/commit/ef92d0732343812dd6619df1c5cdb7ce3cb53f0c "[Issue #9] Search for the ROP gadget in \"mshtml.dll\" at run-time instead of using hard coded offsets  - Gargoyle now loads the \"mshtml.dll\" system DLL into memory and searches the executable portions of its address space to find a suitable ROP gadget.  As a result, Gargoyle is now immune to Microsoft updating \"mshtml.dll\", as long as the DLL is not changed at some point to eliminate the ROP gadget.") [#9](https://github.com/JLospinoso/gargoyle/issues/9) [\] Search for the ROP gadget in "mshtml.dll" at run-time instead](https://github.com/JLospinoso/gargoyle/commit/ef92d0732343812dd6619df1c5cdb7ce3cb53f0c "[Issue #9] Search for the ROP gadget in \"mshtml.dll\" at run-time instead of using hard coded offsets  - Gargoyle now loads the \"mshtml.dll\" system DLL into memory and searches the executable portions of its address space to find a suitable ROP gadget.  As a result, Gargoyle is now immune to Microsoft updating \"mshtml.dll\", as long as the DLL is not changed at some point to eliminate the ROP gadget.") | 9 years agoMay 23, 2017 |
| [setup.nasm](https://github.com/JLospinoso/gargoyle/blob/master/setup.nasm "setup.nasm") | [setup.nasm](https://github.com/JLospinoso/gargoyle/blob/master/setup.nasm "setup.nasm") | [Improving comment](https://github.com/JLospinoso/gargoyle/commit/eccfa0a804abaac581472ec417e6e93697bc7d4d "Improving comment") | 9 years agoMar 4, 2017 |
| [title.png](https://github.com/JLospinoso/gargoyle/blob/master/title.png "title.png") | [title.png](https://github.com/JLospinoso/gargoyle/blob/master/title.png "title.png") | [Draft images](https://github.com/JLospinoso/gargoyle/commit/2651f040c892cbb95c544e3ba31adb5cf84f3da3 "Draft images") | 9 years agoMar 3, 2017 |
| View all files |

## Repository files navigation

[![gargoyle title](https://github.com/JLospinoso/gargoyle/raw/master/title.png)](https://github.com/JLospinoso/gargoyle/raw/master/title.png)

[![gargoyle infographic](https://github.com/JLospinoso/gargoyle/raw/master/infographic.png)](https://github.com/JLospinoso/gargoyle/raw/master/infographic.png)

# Building gargoyle

[Permalink: Building gargoyle](https://github.com/JLospinoso/gargoyle#building-gargoyle)

_gargoyle_ is only implemented for 32-bit Windows (64-bit Windows on Windows is fine). You must have the following installed:

- [Visual Studio](https://www.visualstudio.com/downloads/): 2017 Community is tested, but it may work for other versions.
- [Netwide Assembler](http://www.nasm.us/pub/nasm/releasebuilds/?C=M;O=D) v2.12.02 x64 is tested, but it may work for other versions. Make sure `nasm.exe` is on your path.

Clone _gargoyle_:

```
git clone https://github.com/JLospinoso/gargoyle.git
```

Open `Gargoyle.sln`, build, and run. There is some harness code in `main.cpp` that configures the following three components:

- _gargoyle_ stack trampoline, stack, and configuration (read/write memory on the heap)
- _gargoyle_ position independent code (PIC) that receives the ROP gadget/stack trampoline and runs arbitrary code
- A ROP gadget. If you have `mshtml.dll`, _gargoyle_ will load it into memory and use it. If it is not available, you will have to tell _gargoyle_ to allocate its own (3-byte) ROP gadget on the heap:

```
// main.cpp
auto use_mshtml{ true };
auto gadget_memory = get_gadget(use_mshtml, gadget_pic_path);
```

Every 15 seconds, gargoyle will pop up a message box. When you click ok, gargoyle sets up the tail calls to mark itself non-executable and to wait for the timer. For fun, use [Sysinternals's excellent VMMap tool](https://technet.microsoft.com/en-us/sysinternals/vmmap.aspx) to examine when _gargoyle_'s PIC is executable. If a message box is active, _gargoyle_ will be executable. If it is not, _gargoyle_ should not be executable. The PIC's address is printed to `stdout` just before the harness calls into the PIC.

# More information

[Permalink: More information](https://github.com/JLospinoso/gargoyle#more-information)

See the blog post [available at lospi.net](https://jlospinoso.github.io/security/assembly/c/cpp/developing/software/2017/03/04/gargoyle-memory-analysis-evasion.html) for more information.

Also feel free to hop on gitter: [![Join the chat at https://gitter.im/grgyl/Lobby](https://camo.githubusercontent.com/2934b0a258686a640a4fde53f62ae02b3922473909ffdc3747c060a4ec0525ec/68747470733a2f2f6261646765732e6769747465722e696d2f677267796c2f4c6f6262792e737667)](https://gitter.im/grgyl/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)

## About

A memory scanning evasion technique


[jlospinoso.github.io/security/assembly/c/cpp/developing/software/2017/03/04/gargoyle-memory-analysis-evasion.html](https://jlospinoso.github.io/security/assembly/c/cpp/developing/software/2017/03/04/gargoyle-memory-analysis-evasion.html "https://jlospinoso.github.io/security/assembly/c/cpp/developing/software/2017/03/04/gargoyle-memory-analysis-evasion.html")

### Topics

[security](https://github.com/topics/security "Topic: security") [assembly](https://github.com/topics/assembly "Topic: assembly") [pic](https://github.com/topics/pic "Topic: pic") [x86](https://github.com/topics/x86 "Topic: x86") [rop-gadgets](https://github.com/topics/rop-gadgets "Topic: rop-gadgets") [memory-analysis](https://github.com/topics/memory-analysis "Topic: memory-analysis")

### Resources

[Readme](https://github.com/JLospinoso/gargoyle#readme-ov-file)

### License

[AGPL-3.0 license](https://github.com/JLospinoso/gargoyle#AGPL-3.0-1-ov-file)

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/JLospinoso/gargoyle).

[Activity](https://github.com/JLospinoso/gargoyle/activity)

### Stars

[**897**\\
stars](https://github.com/JLospinoso/gargoyle/stargazers)

### Watchers

[**25**\\
watching](https://github.com/JLospinoso/gargoyle/watchers)

### Forks

[**118**\\
forks](https://github.com/JLospinoso/gargoyle/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FJLospinoso%2Fgargoyle&report=JLospinoso+%28user%29)

## [Releases](https://github.com/JLospinoso/gargoyle/releases)

No releases published

## [Packages\  0](https://github.com/users/JLospinoso/packages?repo_name=gargoyle)

No packages published

### Uh oh!

There was an error while loading. [Please reload this page](https://github.com/JLospinoso/gargoyle).

## [Contributors\  3](https://github.com/JLospinoso/gargoyle/graphs/contributors)

- [![@JLospinoso](https://avatars.githubusercontent.com/u/147698?s=64&v=4)](https://github.com/JLospinoso)[**JLospinoso** Josh Lospinoso](https://github.com/JLospinoso)
- [![@ccooper21](https://avatars.githubusercontent.com/u/2042273?s=64&v=4)](https://github.com/ccooper21)[**ccooper21** Christopher Cooper](https://github.com/ccooper21)
- [![@gleeda](https://avatars.githubusercontent.com/u/176825?s=64&v=4)](https://github.com/gleeda)[**gleeda** gleeda (Jamie Levy)](https://github.com/gleeda)

## Languages

- [C++70.5%](https://github.com/JLospinoso/gargoyle/search?l=c%2B%2B)
- [Assembly29.5%](https://github.com/JLospinoso/gargoyle/search?l=assembly)

You can’t perform that action at this time.