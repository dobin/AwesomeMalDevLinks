# https://www.mdsec.co.uk/2022/07/part-1-how-i-met-your-beacon-overview/

<!DOCTYPE html><!--[if lt IE 7 ]><html lang="en-GB" class="no-js ie ie6 lte7 lte8 lte9"><![endif]--><!--[if IE 7 ]><html lang="en-GB" class="no-js ie ie7 lte7 lte8 lte9"><![endif]--><!--[if IE 8 ]><html lang="en-GB" class="no-js ie ie8 lte8 lte9"><![endif]--><!--[if IE 9 ]><html lang="en-GB" class="no-js ie ie9 lte9"><![endif]--><!--[if (gt IE 9)|!(IE)]><!--><html lang="en-GB" class=" js flexbox flexboxlegacy canvas canvastext postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers no-applicationcache svg inlinesvg" dir="ltr"><!--<![endif]-->
	    
	<body class="wp-singular post-template-default single single-post postid-2980 single-format-standard wp-theme-mdsec">
    <!--[if lt IE 7]>
        <div class="browse-happy">
        	 <a href="https://www.mdsec.co.uk">
				<div id="logo">Logo</div>
			</a>
        	<p>You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        </div>    	
    <![endif]-->              
	
	<!-- Site Wrapper Start --> 
	<div class="site-wrapper">
		
	<!-- Header Start --> 
	
    <!-- Header End --> 
		
		
	<div class="subnav">
		<section class="content-wrapper">
			<ul class="service-list clearfix">
				<li class="item" style="">
					<a href="https://www.mdsec.co.uk/our-services/adversary-simulation/">
						<div class="service-icon">
							<img src="https://www.mdsec.co.uk/wp-content/themes/mdsec/img/icons/icon-adversary.svg" alt="Adversary" width="300" height="150">
						</div>
						<hgroup>
							<h2>
								Adversary Simulation
							</h2>
						</hgroup>
						<p>Our best in class red team can deliver a holistic cyber attack simulation to provide a true evaluation of your organisation’s cyber resilience.</p>
						
					</a>
				</li>
				<li class="item" style="">
					<a href="https://www.mdsec.co.uk/our-services/applicaton-security/">
						<div class="service-icon">
							<img src="https://www.mdsec.co.uk/wp-content/themes/mdsec/img/icons/icon-application-security.svg" alt="Application Security" width="300" height="150">
						</div>
						<hgroup>
							<h2>
								Application <br>Security
							</h2>
						</hgroup>
						<p>Leverage the team behind the industry-leading Web Application and Mobile Hacker’s Handbook series.</p>
					</a>
				</li>
				<li class="item" style="">
					<a href="https://www.mdsec.co.uk/our-services/penetration-testing/">
						<div class="service-icon">
							<img src="https://www.mdsec.co.uk/wp-content/themes/mdsec/img/icons/icon-penetration-testing.svg" alt="Penetration Testing" width="300" height="150">
						</div>
						<hgroup>
							<h2>
								Penetration <br>Testing
							</h2>
						</hgroup>
						<p>MDSec’s penetration testing team is trusted by companies from the world’s leading technology firms to global financial institutions.</p>
					</a>
				</li>
				<li class="item" style="">
					<a href="https://www.mdsec.co.uk/our-services/response/">
						<div class="service-icon">
							<img src="https://www.mdsec.co.uk/wp-content/themes/mdsec/img/icons/icon-response.svg" alt="Response" width="300" height="150">
						</div>
						<hgroup>
							<h2>
								Response
							</h2>
						</hgroup>
						<p>Our certified team work with customers at all stages of the Incident Response lifecycle through our range of proactive and reactive services.</p>
					</a>
				</li>
			</ul>
		</section>		
	</div>
	<div class="subnav-kc">
		<section class="content-wrapper">
			<ul class="service-list clearfix">
				<li>
					<a href="https://www.mdsec.co.uk/knowledge-centre/research/">
						<hgroup>
							<h2>
								Research
							</h2>
						</hgroup>
						<p>MDSec’s dedicated research team periodically releases white papers, blog posts, and tooling.</p>
					</a>
				</li>
				<li>
					<a href="https://www.mdsec.co.uk/knowledge-centre/training/">
						<hgroup>
							<h2>
								Training
							</h2>
						</hgroup>
						<p>MDSec’s training courses are informed by our security consultancy and research functions, ensuring you benefit from the latest and most applicable trends in the field.</p>
					</a>
				</li>
				<li>
					<a href="https://www.mdsec.co.uk/knowledge-centre/insights/">
						<hgroup>
							<h2>
								Insights
							</h2>
						</hgroup>
						<p>View insights from MDSec’s consultancy and research teams.</p>
					</a>
				</li>
			</ul>
		</section>		
	</div>		

	
	<section class="insights-single-header">
		<div class="content-wrapper">
			<div class="the-category">
			<span class="category">ActiveBreach</span>			</div>
			<h1>PART 1: How I Met Your Beacon – Overview</h1>
		</div>
	</section>

	<section class="full-width-wrapper white pad20-120">
		<div class="content-wrapper">
			<div class="breadcrumb-wrapper">
				
			</div>	

		</div>
		
		<div class="insights-content">
		
<h1 class="wp-block-heading">Introduction</h1>



<p>Its no secret that MDSec provides a commercial command-and-control framework with a focus on evasion for covert operations. With this in mind, we are continuously performing on-going R&amp;D in to techniques to not only hide a beacon, but also detect them. Indeed, some would argue that the best way to build an elusive beacon, is to not only understand the ways in which your opposition detects you, but to try and find new ways that they could detect you in the future.</p>



<p>During this research we will outline a number of effective strategies for hunting for beacons, supported by our BeaconHunter tool that we developed to execute these strategies and which we intend to open source in due course. In the following posts to this research, we will then step in to a number of case studies for applying these detections to a variety of both commercial and open source frameworks.</p>



<p>This material was originally discussed at x33fcon 2022, the slides for this material can be found <a href="https://github.com/mdsecresearch/Publications/blob/master/presentations/How%20I%20Met%20Your%20Beacon%20-%20x33fcon.pdf" target="_blank" rel="noreferrer noopener">here</a>.</p>



<h1 class="wp-block-heading">Approaches for Beacon Detection</h1>



<p>While there are a variety of different approaches for detecting a beacon running inside your network, we will focus less on the functionality of specific post-exploitation functionality, and more on generically identifying the beacons being residing or being loaded in to memory.</p>



<h2 class="wp-block-heading">Behaviour</h2>



<p>The behaviour of the beacon whilst its not only operating but also loading can give rise to detection opportunities for defenders. Many of the commercial frameworks are closed source, and as such some behaviours cannot trivially be changed, allowing defenders to create signatures aligned to these actions.</p>



<p>A great example of this is how the beacon loads itself and its dependencies; lets look at how behaviour associated with image loads might provide detection opportunities for defenders.</p>



<p>In order for a beacon to provide a rich post-exploitation framework, it often relies heavily on libraries native to the operating system, allowing the developer to keep the beacon size as small as possible by avoiding statically bundling many dependencies.</p>



<p>From analysing a number of beacon frameworks, we’ve noticed that many of these will proceed to load all dependencies required for the core beacon at load time as opposed to on use. In some cases, this leads to a unique sequence of events occurring on the endpoint, which can be trivially signatured by defenders.</p>



<p>For example, it is common to see beacons leveraging the native Windows HTTP libraries for egress beacons by loading winhttp.dll and wininet.dll; these may stand out as anomalies when loaded in to processes that would not normally perform HTTP interaction. Furthermore, some beacons have been noted to load libraries that are used more sparsely such as credui.dll, dbghelp.dll or samcli.dll.</p>



<p>Using these sequences of DLL loads, it becomes feasible to build signatures using EQL rules to detect when the beacon is executed.</p>



<p>For example, using an EQL rule similar to the following, it is possible to detect or hunt for all processes loading the <em>credui.dll</em>, and <em>winhttp.dlls</em> within a short period of time:</p>



<pre class="wp-block-code"><code class="hljs sql">sequence by Image <span class="hljs-keyword">with</span> maxspan=<span class="hljs-number">1</span>m
	[<span class="hljs-keyword">any</span> <span class="hljs-keyword">where</span> ImageLoaded == <span class="hljs-string">'C:\\Windows\\System32\\credui.dll'</span>]
	[<span class="hljs-keyword">any</span> <span class="hljs-keyword">where</span> ImageLoaded == <span class="hljs-string">'C:\\Windows\\System32\\winhttp.dll'</span>]</code></pre>



<p>This category of detection can of course be avoided by beacons that are designed to be modular or load dependencies on use or with delayed loads.</p>



<h2 class="wp-block-heading">In Memory Detections</h2>



<p>In many cases, beacons may remain memory resident in order to avoid on disk detections. The beacon is typically injected in to memory by a loader, which will create a new or hijack an existing thread in which to run the beacon in.</p>



<p>A typical loading process for the beacon may look as follows:</p>


<div class="wp-block-image is-style-default">
<figure class="aligncenter size-large is-resized"><img fetchpriority="high" decoding="async" src="https://www.mdsec.co.uk/wp-content/uploads/2022/07/image-16-960x826.png" alt="" class="wp-image-2981" width="720" height="620"></figure></div>


<p>Once the beacon is running in memory, through analysis of the process there are often a number of indicators that we can leverage to detect the beacon; let’s look at some approaches for in-memory detections.</p>



<h3 class="wp-block-heading">Signatures</h3>



<p>Perhaps one of the simplest, but most effective strategies for detecting in-memory beacons for known malware is through signature detection. While many anti-virus engines and EDRs implement their own memory scanning routines, threat hunters can readily achieve comprehensive memory scanning using Yara rules.</p>



<p>A simple Yara rule that can be used with the <em>yara64.exe</em> command line utility might look like this, which would match on detecting any of the three listed strings in memory:</p>



<pre class="wp-block-code"><code class="hljs bash">rule howimetyourbeacon
{
meta:
    author = <span class="hljs-string">"domchell"</span>
    description = <span class="hljs-string">"Simple yara rule"</span>
strings:
    <span class="hljs-variable">$a</span> = <span class="hljs-string">"How"</span>
    <span class="hljs-variable">$b</span> = <span class="hljs-string">"I"</span>
    <span class="hljs-variable">$c</span> = <span class="hljs-string">"Met"</span>
		<span class="hljs-variable">$d</span> = <span class="hljs-string">"Your"</span>
		<span class="hljs-variable">$e</span> = <span class="hljs-string">"Beacon"</span>
condition:
    3 of them
}</code></pre>



<p>Creating Yara rules for strings/data embedded within the beacon, or code from the .text section can conceptually be used as an effective technique for detecting known in-memory malware.</p>



<p>Elastic have done some great work in the past on how this can be leveraged to <a href="https://www.elastic.co/blog/detecting-cobalt-strike-with-memory-signatures" target="_blank" rel="noreferrer noopener">detect Cobalt Strike in memory</a> and is recommended reading for how these techniques can be applied in practice.</p>



<p>To evade such memory scanning, beacons can employ a number of techniques to obfuscate their footprint in memory, including replacing known strings such as can be achieved using Cobalt Strikes <a href="https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/malleable-c2-extend_pe-memory-indicators.htm#_Toc65482854" target="_blank" rel="noreferrer noopener">strrep malleable profile option </a>and/or the use of a obfuscate and sleep strategy <a href="https://suspicious.actor/2022/05/05/mdsec-nighthawk-study.html" target="_blank" rel="noreferrer noopener">such as the one we use in Nighthawk</a> to protect all strings, data and code of the beacon while sleeping.</p>



<h3 class="wp-block-heading">Memory Hooks</h3>



<p>In order to circumvent controls or change how a process might function, beacons (or the operator) may apply hooks to certain functions in memory. These hooks can leave hidden traces that can provide threat hunters opportunities to reveal hidden beacons. Lets examine some examples of this behaviour.</p>



<p><span style="text-decoration: underline;"><strong>ETW and AMSI Patching</strong></span></p>



<p>Patching security controls such as AMSI and/or impairing telemetry obtained through Event Tracing for Windows is no secret in the offensive community, indeed we have previously blogged about these tactics in the <a href="https://www.mdsec.co.uk/2020/03/hiding-your-net-etw/" target="_blank" rel="noreferrer noopener">past</a>.</p>



<p>These patches are typically applied by modifying memory; let’s look at two examples taken from the Sliver C2 armory:</p>



<p><a href="https://github.com/sliverarmory/injectEtwBypass">https://github.com/sliverarmory/injectEtwBypass</a></p>


<div class="wp-block-image is-style-default">
<figure class="aligncenter size-large is-resized"><img decoding="async" src="https://www.mdsec.co.uk/wp-content/uploads/2022/07/image-17-960x448.png" alt="" class="wp-image-2982" width="720" height="336"></figure></div>


<p><a href="https://github.com/sliverarmory/injectAmsiBypass">https://github.com/sliverarmory/injectAmsiBypass</a></p>


<div class="wp-block-image is-style-default">
<figure class="aligncenter size-large is-resized"><img decoding="async" src="https://www.mdsec.co.uk/wp-content/uploads/2022/07/image-18-960x168.png" alt="" class="wp-image-2983" width="720" height="126"></figure></div>


<p>As we can see in the screenshots above, both of these examples will cause the beacon to apply a patch to either the <em>ntdll!etwEventWrite</em> or <em>amsi.dll!AmsiOpenSession</em> functions.</p>



<p>With this in mind, a low noise detection opportunity arises simply by hunting for processes with these patches applied to these and other commonly patched functions such as <em>AmsiScanBuffer</em> or <em>SleepEx</em> which a hook is applied to by Cobalt Strike’s thread stack spoofing feature from the arsenal kit.</p>



<p><strong><span style="text-decoration: underline;">Copy on Write Modifications</span></strong></p>



<p>As noted above, it is not unusual for beacons to apply patches to process memory which can create detection opportunities for hunters. The fruitfulness of these hunts can however be reduced should the beacon remove the patches once the post-exploitation operations have been performed. For example, the implant may apply an AMSI patch prior to executing a .NET assembly in memory, then following execution revert patch to its original opcodes. This approach is moderately more intelligent than simply leaving dangling patches in-memory.</p>



<p>However, in order to avoid duplication, Windows will back common DLLs to physical memory that is shared across running processes. Should a beacon or the operator perform an operation that applies a patch to one of these DLLs, a copy on write operation will occur, making the page private to that process. Using the QueryWorkingSetEx API, we’re able to query information about the pages at a specific virtual address of a process. Within the returned <em>PSAPI_WORKING_SET_EX_INFORMATION</em> structure is a <em>PSAPI_WORKING_SET_EX_BLOCK</em> union that indicates the attributes of the page at the queried address. Within this union we’re able to determine if a copy on write operation occurred on the page by the return value of the Shared bit. This technique is used by memory scanners such as <a href="https://www.forrest-orr.net/post/masking-malicious-memory-artifacts-part-ii-insights-from-moneta" target="_blank" rel="noreferrer noopener">Moneta</a>  and is highly effective, at detecting in-memory patches, even if the original patch value is restored.</p>



<p>There are however some risks of false positive in applying this technique at scale in that it is not uncommon for EDRs and anti-virus software to apply their own in-memory hooks, meaning that they can invalidate some of the value we can obtain from looking for copy on write operations. However, to perhaps reduce the risk of false positives, we can apply more intelligence to this by resolving the exports on the modified pages and applying a greater weighting to functions that EDRs do not typically hook such as <em>EtwEventWrite</em> or <em>AmsiScanBuffer</em>.</p>



<h3 class="wp-block-heading">Anomalies in Threads</h3>



<p>As previously noted, once the beacon is operating in memory it will typically live inside one or more threads, depending on if the beacon is synchronous or asynchronous. Anomalies associated with these threads can provide high signal indicators of beacon activity, in particular when combined with other indicators or in conjunction with each other. Some common suspicious thread related indicators include the following:</p>



<ul class="wp-block-list"><li>Unmapped memory: threads that originate from virtual memory, without being backed by a DLL are a classic indicator for an injected thread. These threads can trivially be detected by hunting for threads with memory regions with a <em>MemoryType</em> of <em>MEM_IMAGE</em> and a MemoryState of <em>MEM_COMMIT</em>. Alternatively, these threads are commonly detected by EDR inspection through kernel callbacks for thread creation APIs. This indicator is well <a href="https://gist.github.com/jaredcatkinson/23905d34537ce4b5b1818c3e6405c1d2" target="_blank" rel="noreferrer noopener">documented</a> and many tools exist for hunting for this indicator.</li><li>Delay state: most of the time a beacon will be sleeping, before awaking to recover its tasking. To achieve this sleeping behaviour, windows API calls such as <em>SleepEx</em> are typically used; these put the thread in to a waiting state and will result in thread call stack containing calls to KernelBase.dll!SleepEx and <em>ntdll.dll!NtDelayExecution</em>. When combined with other indicators such as signs of module stomping (discussed later) or calls to virtual memory in the call stack, then this may provide some intelligence of beacon behaviour.</li></ul>



<p>Attempts to evade detections around suspicious threads have become recently popularised, with several <a href="https://github.com/mgeeky/ThreadStackSpoofer" target="_blank" rel="noreferrer noopener">proof of concept </a>and commercial implementations being published.</p>



<p>These implementations typically work by either truncating the call stack of the thread (for example by setting the frame’s return address to null) or by cloning the context of an existing thread. With this in mind, we have further indicators that we can hunt for to add to our metrics:</p>



<ul class="wp-block-list"><li>Suspicious start address: one of the side effects of truncating the call stack for the thread is that the start address does not originate from an expected location. That is, threads will typically originate from <em>ntdll!RtlUserThreadStart</em> and <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/xperf/thread-start-functions" target="_blank" rel="noreferrer noopener">kernel32!BaseThreadInitThunk</a>, or <em>ntdll!RtlGetAppContainerNamedObjectPath</em> in the case of CLR threads. Hunting for threads that do not follow this pattern can be used as a suspicious metric for further analysis. Furthermore, the start address of the thread can also be considered suspicious and allude to potential truncation if a mismatch exists between the return value of <em>NtQueryInformationThread(ThreadQuerySetWin32StartAddress)</em> for the thread and the return address of the last frame.</li><li>Distance between initial frames: as mentioned, the initial start address of the call stack will typically originate from a set number of addresses used to perform thread initialisation and creation. The distance between these initial stack frames is noted to be relatively consistent, and typically static between the first and second frames (e.g. <em>ntdll!RtlUserThreadStart</em> and <em>kernel32!BaseThreadInitThunk</em>). In the scenario where the call stack is truncated, the distance between these frames will almost certainly be variable.</li><li>Cloned context: as noted, aside from truncating the call stack of the thread, one means of spoofing the call stack is to clone the context of a legitimate thread. This technique can be effective and relatively straightforward to implement; however there are some pitfalls that can be hunted for to give relatively good confidence of suspicious activity. Primarily, within the <a href="https://www.wikiwand.com/en/Win32_Thread_Information_Block" target="_blank" rel="noreferrer noopener">Thread Information Block</a>  for the thread, there are a number of pointers to various information about the thread; duplicates of these across threads, such as multiple threads having the same Stack Base (bottom of stack) and Stack Limit (stack ceiling) are a good indicator that the thread context has been cloned.</li></ul>



<p><strong><span style="text-decoration: underline;">Page Permissions</span></strong></p>



<p>Generally speaking, the beacon will be operating from virtual memory, or from within a region backed by a DLL if module stomping.</p>



<p>In order for the beacon to recover and execute its tasking, the pages where the beacon is living need to have execute permissions applied to them. If this is from virtual memory and with the exception of jitted code (eg the CLR), it is highly irregular to see private committed memory with executable permissions.</p>



<p>For example, we can see in the following screenshot that the memory at <em>0x22f96c5000</em> is not backed by a DLL, it is marked as “Private:Commit” (i.e. virtual memory as a result of <em>VirtualAlloc</em>) and has the RX page permissions set:</p>


<div class="wp-block-image is-style-default">
<figure class="aligncenter size-large is-resized"><img loading="lazy" decoding="async" src="https://www.mdsec.co.uk/wp-content/uploads/2022/07/image-19-960x336.png" alt="" class="wp-image-2984" width="720" height="252"></figure></div>


<p>These indicators are a strong signal that there is a beacon executing in this region.</p>



<p>The challenge then becomes how can this indicator be avoided; well the simple answer is it cannot if your beacon is operating from virtual memory, at some point the beacon needs to be executing. The compromise is really to only maintain the executable permissions while the beacon is performing tasking, and leverage strategies to remove the executable permissions while the beacon is sleeping. Therefore, avoiding tradecraft such as SOCKS proxying can help to minimise the exposure of this indicator:</p>


<div class="wp-block-image is-style-default">
<figure class="aligncenter size-large is-resized"><img loading="lazy" decoding="async" src="https://www.mdsec.co.uk/wp-content/uploads/2022/07/image-20-960x501.png" alt="" class="wp-image-2985" width="720" height="376"></figure></div>


<p>Several implants employ strategies for shuffling the page protections according to the beacon state, as well as several open source implementations such as <a href="https://twitter.com/ilove2pwn_">@</a><a href="https://twitter.com/ilove2pwn_" target="_blank" rel="noreferrer noopener">Ilove2pwn_</a>’s <a href="https://github.com/SecIdiot/FOLIAGE" target="_blank" rel="noreferrer noopener">Foliage</a>, <a href="https://twitter.com/c5pider" target="_blank" rel="noreferrer noopener">@c5pider</a>’s <a href="https://github.com/Cracked5pider/Ekko" target="_blank" rel="noreferrer noopener">Ekko</a>, @mariuszbit’s <a href="https://github.com/mgeeky/ShellcodeFluctuation" target="_blank" rel="noreferrer noopener">ShellcodeFluctuation</a> and Josh Lospinoso’s <a href="https://github.com/JLospinoso/gargoyle" target="_blank" rel="noreferrer noopener">Gargoyle</a>.</p>



<p>These strategies will typically leverage some form of event driven execution to sleep and wake the beacon, reengaging execution using ROP gadgets to call <em>VirtualProtect</em> and reset the beacon’s pages back to executable permissions. The Timer based technique discovered by MDSec’s Peter Winter-Smith and as used by Ekko, was originally reverse engineered from MDSec’s Nighthawk c2. In short, this technique works by queueing a number of timers using <em>CreateTimerQueueTimer</em>, which then when the event triggers will return to a previously defined Context record, executed using <em>NtContinue</em> and calling <em>VirtualProtect</em> to reenable the execute bit.</p>



<p>To understand this technique in greater detail, the original write up by <a href="https://twitter.com/ilove2pwn_" target="_blank" rel="noreferrer noopener">@Ilove2pwn_</a> can be found <a href="https://suspicious.actor/2022/05/05/mdsec-nighthawk-study.html" target="_blank" rel="noreferrer noopener">here</a>.</p>



<p><strong><span style="text-decoration: underline;">Module Stomping</span></strong></p>



<p>Module stomping provides an alternate method of hiding your beacon in memory, avoiding some of the common indicators associated with beaconing from unmapped memory. Conceptually, to achieve this, a legitimate DLL that is unlikely to be used by the process is loaded and the beacon copies itself over the module; a thread is then created backed by the stomped code:</p>


<div class="wp-block-image is-style-default">
<figure class="aligncenter size-full is-resized"><img loading="lazy" decoding="async" src="https://www.mdsec.co.uk/wp-content/uploads/2022/07/image-21.png" alt="" class="wp-image-2986" width="554" height="350"></figure></div>


<p>Cobalt Strike has offered this feature since its 3.11 release and is available using the “<em>set module_x64 / module_x86</em>” malleable configuration options.</p>



<p>While this technique can provide a number of OpSec advantageous, it does leave behind several indicators which we can reliable detect on:</p>



<ul class="wp-block-list"><li>Perhaps the simplest technique for detecting this attack is comparing the contents of the module in memory with that which exists on disk. Any variations on the code sections will almost certainly allude to some suspicious behaviour. This process is of course relatively intensive as it would require all modules within the running process to be loaded from disk and compared against running memory.</li><li>As previously described, modifications to in-process module memory will result in a copy on write operation occurring. With this in mind, the same logic for described for detecting memory hooks, can also be applied to detecting module stomping as overwriting the DLL in memory will lead to a copy of the DLL being made and the shared bit being cleared.</li><li>There are several approaches that can be leveraged for performing module stomping, some involve leveraging existing Windows APIs such as LoadLibrary, while other more complex implementations may use custom loaders to map the DLL in to memory. Some techniques have known indicators associated with them, leaving resident traces in the PEB that can be used to hunt for this technique was high confidence. Examples of this will be discussed in greater detail later.</li></ul>



<p>In conclusion, we’ve outlined a number of strategies for detecting in-memory beacons. In the next part of this series, we’ll begin to look at a number of case studies of real frameworks and see how we can apply these techniques.</p>



<p>This post was written by <a href="https://twitter.com/domchell" target="_blank" rel="noreferrer noopener">Dominic Chell</a>.</p>
		</div>
		
		<div class="author">
			<div class="content-wrapper clearfix">
				<div class="author-avatar">
					<img alt="" src="https://secure.gravatar.com/avatar/9cb7b62409a4b5ef00769dca4ba852fc49229c9729d600fc2637daf77068c31c?s=96&amp;d=wp_user_avatar&amp;r=g" class="avatar avatar-96 photo" height="96" width="96" loading="lazy" decoding="async">				</div>
				<div class="author-meta">
					<div class="author-meta__content">
						<span>written by</span>
						<h4>MDSec Research</h4>
					</div>
				</div>
			</div>
		</div>
		<section class="testing">
	<div class="content-wrapper">
		<h2>Ready to engage<br>with MDSec?</h2>
		<div class="button">
			<a href="https://www.mdsec.co.uk/contact">
				Get in touch
			</a>
		</div>
	</div>
</section>		
	</section>




	<section class="newsletter">
	<div class="content-wrapper clearfix">
		<div class="newsletter-left">
			<p>
				Stay updated with the latest <br>news from MDSec.
			</p>
		</div>
		<div class="newsletter-right">
			<div class="frm_forms  with_frm_style frm_style_formidable-style" id="frm_form_2_container">
<form enctype="multipart/form-data" method="post" class="frm-show-form  frm_js_validate " id="form_newslettersignupform">
<div class="frm_form_fields ">
<fieldset>
<legend class="frm_screen_reader">Newsletter Signup Form</legend>

<div class="frm_fields_container">





<div id="frm_field_10_container" class="frm_form_field form-field  frm_none_container frm_full">
    <label for="field_nkjbj" id="field_nkjbj_label" class="frm_primary_label">Email
        <span class="frm_required"></span>
    </label>
    <input type="email" id="field_nkjbj" name="item_meta[10]" value="" placeholder="Enter your email for updates" data-invmsg="Email is invalid" aria-invalid="false">
    
    
</div>
<div id="frm_field_11_container" class="frm_form_field form-field  frm_none_container frm_first frm_full">
    <label for="g-recaptcha-response" id="field_ah4d8_label" class="frm_primary_label" style="display: none;">
        <span class="frm_required"></span>
    </label>
    <div id="field_ah4d8" class="frm-g-recaptcha" data-sitekey="6Lc27L0ZAAAAAMV4QCtKwWRbT-Hm1FnY6IKqcSxw" data-size="invisible" data-theme="light" data-rid="0"><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><div title="reCAPTCHA" width="256" height="60" role="presentation" name="a-2ymhrbx7ofza" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="https://www.google.com/recaptcha/api2/anchor?ar=1&amp;k=6Lc27L0ZAAAAAMV4QCtKwWRbT-Hm1FnY6IKqcSxw&amp;co=aHR0cHM6Ly93d3cubWRzZWMuY28udWs6NDQz&amp;hl=en&amp;v=vUgXt_KV952_-5BB2jjloYzl&amp;theme=light&amp;size=invisible&amp;anchor-ms=20000&amp;execute-ms=30000&amp;cb=ynee2rr0xrcd" data-original-tag="iframe">

<title>reCAPTCHA</title>

<link rel="stylesheet" type="text/css" href="https://www.gstatic.com/recaptcha/releases/vUgXt_KV952_-5BB2jjloYzl/styles__ltr.css">


<div id="rc-anchor-alert" class="rc-anchor-alert"></div>

<div class="rc-anchor rc-anchor-invisible rc-anchor-light  rc-anchor-invisible-hover"><div id="recaptcha-accessible-status" class="rc-anchor-aria-status" aria-hidden="true">Recaptcha requires verification. </div><div class="rc-anchor-error-msg-container" style="display:none"><span class="rc-anchor-error-msg" aria-hidden="true"></span></div><div class="rc-anchor-normal-footer"><div class="rc-anchor-logo-large" role="presentation"><div class="rc-anchor-logo-img rc-anchor-logo-img-large"></div></div><div class="rc-anchor-pt"><a href="https://www.google.com/intl/en/policies/privacy/" target="_blank">Privacy</a><span aria-hidden="true" role="presentation"> - </span><a href="https://www.google.com/intl/en/policies/terms/" target="_blank">Terms</a></div></div><div class="rc-anchor-invisible-text"><span>protected by <strong>reCAPTCHA</strong></span><div class="rc-anchor-pt"><a href="https://www.google.com/intl/en/policies/privacy/" target="_blank" style="">Privacy</a><span aria-hidden="true" role="presentation"> - </span><a href="https://www.google.com/intl/en/policies/terms/" target="_blank" style="">Terms</a></div></div></div><div style="display: none;" data-original-tag="iframe"></div></div></div><div class="grecaptcha-error"></div><textarea id="g-recaptcha-response" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div><div style="display: none;" data-original-tag="iframe"></div></div>
    
    
</div>
	
			<div id="frm_field_29_container">
			<label for="field_h1dhe" style="display:none;">
				If you are human, leave this field blank.			</label>
			<input id="field_h1dhe" type="text" class="frm_form_field form-field frm_verify" name="item_meta[29]" value="" style="display:none;">
		</div>
		<div class="frm_submit">

<button class="frm_button_submit" type="submit">Submit</button>

</div></div>
</fieldset>
</div>

</form>
</div>
			
		</div>
	</div>
</section>

		</div>
	<!-- Site Wrapper End -->
	
	<!-- Footer Start -->	
	

	<div class="end clearfix">
		<div class="end__left">
			Copyright 2026 MDSec
		</div>
		<div class="end__right">
			<!--<a href="#">Privacy Policy</a>-->
		</div>
	</div>
	<!-- Footer End -->
	
    










	
			
	
	



    	    			




<div style="visibility: hidden; position: absolute; width: 100%; top: -10000px; left: 0px; right: 0px; transition: visibility linear 0.3s, opacity 0.3s linear; opacity: 0;"><div style="width: 100%; height: 100%; position: fixed; top: 0px; left: 0px; z-index: 2000000000; background-color: rgb(255, 255, 255); opacity: 0.5;"></div><div style="margin: 0px auto; top: 0px; left: 0px; right: 0px; position: fixed; border: 1px solid rgb(204, 204, 204); z-index: 2000000000; background-color: rgb(255, 255, 255);"><div title="recaptcha challenge expires in two minutes" name="c-2ymhrbx7ofza" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="https://www.google.com/recaptcha/api2/bframe?hl=en&amp;v=vUgXt_KV952_-5BB2jjloYzl&amp;k=6Lc27L0ZAAAAAMV4QCtKwWRbT-Hm1FnY6IKqcSxw&amp;bft=0dAFcWeA6TR91FHy30H43AEXE4D-H7idqIZfldMlN3kzwzGiWSO_I1Jwj9fxDVhmkRXuacznoC-W4EP2E6A6dhLW0ziU49zWev0A" style="width: 100%; height: 100%;" data-original-tag="iframe">


<title>reCAPTCHA</title>

<link rel="stylesheet" type="text/css" href="https://www.gstatic.com/recaptcha/releases/vUgXt_KV952_-5BB2jjloYzl/styles__ltr.css">



<div></div></div></div></div></body><!-- Body End --></html>