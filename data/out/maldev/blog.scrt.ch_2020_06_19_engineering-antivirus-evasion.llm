Title:
Engineering antivirus evasion (automatic refactoring of Meterpreter) – SCRT Team Blog

Type:
Blog Post

Short Summary (4–8 sentences max):
- The post describes SCRT’s research into AV/EDR detection primitives and how they built an automated refactoring pipeline to make Meterpreter bypass multiple products.  
- It focuses on defeating largely “static” detections driven by suspicious strings and import-table artifacts, and “dynamic/behavioral” detections commonly implemented via userland API hooking.  
- The main implemented technique in this part is automated string obfuscation at the C/C++ source level using Clang/LLVM libTooling to rewrite string literals into runtime-constructed character arrays (stack/local or inserted declarations), including tricky cases like macro arguments and initializer lists.  
- It also outlines (with examples) planned/related transformations: hiding API imports by converting IAT imports into runtime resolution (LoadLibrary/GetProcAddress) and bypassing userland hooks by rewriting sensitive calls to direct syscalls by parsing ntdll to recover syscall numbers.  
- The article includes practical implementation details: AST matching, parent-node climbing to determine context, safe insertion points for new declarations, and handling macro expansion edge cases.  
- Useful for red teams, exploit developers, and toolsmiths building reproducible payload customization pipelines; also relevant to blue teams for understanding common evasion patterns and what artifacts remain.

Technical Focus:
- Clang/LLVM libTooling source-to-source transformation
- AST matchers and context-aware rewriting (CallExpr, InitListExpr, FunctionDecl/VarDecl)
- String literal obfuscation to remove .rdata indicators
- Import Address Table (IAT) evasion via runtime API resolution
- Userland API hook evasion and syscall indirection via ntdll parsing
- Meterpreter payload refactoring/automation (avcleaner)

Use Cases:
- Automatically refactor large C/C++ offensive codebases (e.g., Meterpreter) to reduce signature hits
- Remove/relocate suspicious plaintext strings from compiled binaries
- Convert static imports of sensitive Win32/NT APIs into runtime-resolved calls
- Bypass EDR userland hooks by switching to direct/indirect syscalls
- Generate reproducible “clean” PoCs that run in defended environments for assessments

Keywords:
Meterpreter, avcleaner, SCRT, antivirus evasion, EDR bypass, Clang libTooling, LLVM, AST matcher, source-to-source refactoring, string obfuscation, .rdata, Import Address Table, IAT, LoadLibrary, GetProcAddress, userland API hooking, direct syscalls, ntdll.dll, process injection, Cylance, ESET Nod32