Title:
KrakenMask (APC-based Sleep Mask with Gadget/Callstack Evasion)

Type:
GitHub Tool

Short Summary (4–8 sentences max):
- KrakenMask is a Windows “sleep mask” implementation that obfuscates beacon sleep by using APC execution and gadget-based return address manipulation to evade modern EDR detections.  
- It specifically targets detections that flag `VirtualProtect` calls made via APC when the call stack returns through `NtTestAlert`/`ZwTestAlert`.  
- The project demonstrates altering the return address of `VirtualProtect` to a `call NtTestAlert` gadget to change the observed stack trace and reduce detection fidelity.  
- Updates mention additional call stack masking during the delay phase to evade tools/detections like HuntBeaconSleep-NG, and a technique that sets `CONTEXT.RIP` to a `jmp rdi` gadget with `RDI` holding the target function address.  
- Useful for red team operators and malware developers building stealthy in-memory implants, and for blue teams studying how call stack–based detections can be bypassed.  
- Interesting because it operationalizes a concrete bypass against published detection logic (e.g., Elastic’s VirtualProtect-via-NtTestAlert rule) using low-level control-flow and context manipulation.

Technical Focus:
- APC-based execution (`KiUserApcHandler`) for sleep/obfuscation
- Call stack spoofing / return address “gadget” redirection
- `VirtualProtect` / `NtProtectVirtualMemory` detection evasion
- Thread context manipulation (`CONTEXT.RIP`, register staging like `RDI`)
- Gadget selection (e.g., `call NtTestAlert`, `jmp rdi`)
- EDR rule evasion against call-stack-summary heuristics

Use Cases:
- Implementing stealth sleep in C2 beacons/implants to reduce behavioral detections
- Testing and validating EDR detections that rely on `VirtualProtect` + APC call stack patterns
- Researching practical call stack masking/spoofing techniques on Windows
- Building PoCs to reproduce and evaluate Elastic-style behavioral rules

Keywords:
KrakenMask, sleep mask, APC, KiUserApcHandler, VirtualProtect, NtProtectVirtualMemory, NtTestAlert, ZwTestAlert, call stack spoofing, call stack masking, return address spoofing, ROP gadget, jmp rdi gadget, CONTEXT.RIP, ntdll.dll, KERNELBASE.dll, EDR evasion, HuntBeaconSleep-NG, Elastic detection rule, in-memory implant