Title:
Attacking an EDR – Part 1

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes a black-box methodology for finding weaknesses in a modern EDR by identifying where it “lives” in the OS (notably userland injected hooking DLLs) and then hunting for processes that don’t load the EDR DLL.  
- The authors hypothesize that processes missing the hooking DLL are effectively whitelisted and therefore less monitored for post-exploitation behaviors.  
- They validate this by enumerating loaded modules across processes, finding an EDR-related process running unprotected and under a low-privileged user that did not load the EDR DLL.  
- Using PPID spoofing to spawn a new process as a child of the whitelisted EDR process, they perform classic CreateRemoteThread shellcode injection (Covenant stager) and achieve an undetected implant.  
- From that context, common post-exploitation actions (e.g., in-memory Mimikatz DLL injection) were not detected, indicating a monitoring gap tied to process trust/whitelisting rather than stealthy injection.  
- The vendor confirmed the behavior was unintended and fixed the reported issues, highlighting how EDR trust assumptions can create high-impact bypasses.  
- Useful primarily for red teamers and EDR evaluators; also valuable to blue teams for understanding blind spots created by allowlists and userland-only telemetry.

Technical Focus:
- Userland API hooking via injected DLLs (EDR architecture)
- Module/process enumeration to identify unhooked/whitelisted processes
- PPID spoofing using STARTUPINFOEX / ProcThreadAttributeParentProcess
- Remote process injection (VirtualAllocEx, WriteProcessMemory, VirtualProtectEx, CreateRemoteThread)
- Post-exploitation execution from “trusted” process context (credential dumping)

Use Cases:
- Identify EDR trust boundaries by locating processes excluded from userland hooking
- Build PoCs to validate whether “trusted” agent processes create detection blind spots
- Execute implants under a whitelisted parent/lineage to reduce behavioral detections
- Red team assessment of EDR resilience against basic injection + known C2 payloads
- Defensive testing: ensure EDR agent components aren’t implicitly exempt from monitoring

Keywords:
EDR bypass, userland hooking, injected DLL, module enumeration, tasklist /m, whitelisting, trust assumptions, PPID spoofing, STARTUPINFOEX, UpdateProcThreadAttribute, ProcThreadAttributeParentProcess, CreateProcess, CreateRemoteThread, VirtualAllocEx, WriteProcessMemory, VirtualProtectEx, process injection, Covenant, shellcode, Mimikatz, credential dumping, Windows internals, PPL (Protected Process Light)