# https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads

<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <body class="mx-auto lang-en section-blog type-blog antialiased overscroll-none"><div class="cky-hide cky-overlay"></div><div class="cky-btn-revisit-wrapper cky-revisit-hide cky-revisit-bottom-left" data-cky-tag="revisit-consent" data-tooltip="Consent Preferences" style="background-color: #000000;"><button aria-label="Consent Preferences" class="cky-btn-revisit"><img alt="Revisit consent button" src="https://cdn-cookieyes.com/assets/images/revisit.svg"></button></div><div class="cky-consent-container cky-box-bottom-left" aria-label="We value your privacy" role="region" tabindex="0"><div class="cky-consent-bar" data-cky-tag="notice" style="border-color: #EDF1F4; background-color: #EDF1F4;"><div class="cky-notice"><p class="cky-title" aria-level="1" data-cky-tag="title" role="heading" style="color: #212121;">We value your privacy</p><div class="cky-notice-group"><div class="cky-notice-des" data-cky-tag="description" style="color: #212121;"><p>We use cookies to enhance your browsing experience, serve personalised ads or content, and analyse our traffic. By clicking "Accept All", you consent to our use of cookies.</p></div><div class="cky-notice-btn-wrapper" data-cky-tag="notice-buttons"><button class="cky-btn cky-btn-customize" aria-label="Customise" data-cky-tag="settings-button" style="color: #000000; border-color: #000000; background-color: #EDF1F4;">Customise</button> <button class="cky-btn cky-btn-reject" aria-label="Reject All" data-cky-tag="reject-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Reject All</button> <button class="cky-btn cky-btn-accept" aria-label="Accept All" data-cky-tag="accept-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Accept All</button> </div></div></div></div></div><div class="cky-modal" tabindex="0"><div class="cky-preference-center" data-cky-tag="detail" aria-label="Customise Consent Preferences" aria-modal="true" role="dialog" style="color: #212121; border-color: #EDF1F4; background-color: #EDF1F4;"><div class="cky-preference-header"><span class="cky-preference-title" aria-level="1" data-cky-tag="detail-title" role="heading" style="color: #212121;">Customise Consent Preferences</span> <button aria-label="Close" class="cky-btn-close" data-cky-tag="detail-close"><img alt="Close" src="https://cdn-cookieyes.com/assets/images/close.svg" width="10" height="10"></button></div><div class="cky-preference-body-wrapper"><div class="cky-preference-content-wrapper" data-cky-tag="detail-description" style="color: #212121;"><p>We use cookies to help you navigate efficiently and perform certain functions. You will find detailed information about all cookies under each consent category below.</p><p>The cookies that are categorised as "Necessary" are stored on your browser as they are essential for enabling the basic functionalities of the site. ...&nbsp;<button class="cky-show-desc-btn" data-cky-tag="show-desc-button" aria-label="Show more">Show more</button></p></div><div class="cky-horizontal-separator"></div><div class="cky-accordion-wrapper" data-cky-tag="detail-categories"><div class="cky-accordion" id="ckyDetailCategorynecessary"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategorynecessaryBody" aria-label="Necessary" data-cky-tag="detail-category-title" style="color: #212121;">Necessary</button><span class="cky-always-active" data-cky-tag="always-active">Always Active</span></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Necessary cookies are required to enable the basic features of this site, such as providing secure log-in or adjusting your consent preferences. These cookies do not store any personally identifiable data.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategorynecessaryBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__cf_bm</div></li><li><div>Duration</div><div>1 hour</div></li><li><div>Description</div><div>This cookie, set by Cloudflare, is used to support Cloudflare Bot Management. </div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hssrc</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>This cookie is set by Hubspot whenever it changes the session cookie. The __hssrc cookie set to 1 indicates that the user has restarted the browser, and if the cookie does not exist, it is assumed to be a new session.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hssc</div></li><li><div>Duration</div><div>1 hour</div></li><li><div>Description</div><div>HubSpot sets this cookie to keep track of sessions and to determine if HubSpot should increment the session number and timestamps in the __hstc cookie.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_cfuvid</div></li><li><div>Duration</div><div>session</div></li><li><div>Description</div><div>Calendly sets this cookie to track users across sessions to optimize user experience by maintaining session consistency and providing personalized services</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryfunctional"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryfunctionalBody" aria-label="Functional" data-cky-tag="detail-category-title" style="color: #212121;">Functional</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchfunctional" aria-label="Enable Functional" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Functional cookies help perform certain functionalities like sharing the content of the website on social media platforms, collecting feedback, and other third-party features.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryfunctionalBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>lidc</div></li><li><div>Duration</div><div>1 day</div></li><li><div>Description</div><div>LinkedIn sets the lidc cookie to facilitate data center selection.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>li_gc</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>Linkedin set this cookie for storing visitor's consent regarding using cookies for non-essential purposes.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryanalytics"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryanalyticsBody" aria-label="Analytics" data-cky-tag="detail-category-title" style="color: #212121;">Analytics</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchanalytics" aria-label="Enable Analytics" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Analytical cookies are used to understand how visitors interact with the website. These cookies help provide information on metrics such as the number of visitors, bounce rate, traffic source, etc.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryanalyticsBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_gcl_au</div></li><li><div>Duration</div><div>3 months</div></li><li><div>Description</div><div>Google Tag Manager sets the cookie to experiment advertisement efficiency of websites using their services.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_ga_*</div></li><li><div>Duration</div><div>1 year 1 month 4 days</div></li><li><div>Description</div><div>Google Analytics sets this cookie to store and count page views.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>_ga</div></li><li><div>Duration</div><div>1 year 1 month 4 days</div></li><li><div>Description</div><div>Google Analytics sets this cookie to calculate visitor, session and campaign data and track site usage for the site's analytics report. The cookie stores information anonymously and assigns a randomly generated number to recognise unique visitors.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>__hstc</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>Hubspot set this main cookie for tracking visitors. It contains the domain, initial timestamp (first visit), last timestamp (last visit), current timestamp (this visit), and session number (increments for each subsequent session).</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>hubspotutk</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>HubSpot sets this cookie to keep track of the visitors to the website. This cookie is passed to HubSpot on form submission and used when deduplicating contacts.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryperformance"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryperformanceBody" aria-label="Performance" data-cky-tag="detail-category-title" style="color: #212121;">Performance</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchperformance" aria-label="Enable Performance" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Performance cookies are used to understand and analyse the key performance indexes of the website which helps in delivering a better user experience for the visitors.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryperformanceBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>session_id</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>This cookie is used to get or set the session id for the current session.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryadvertisement"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryadvertisementBody" aria-label="Advertisement" data-cky-tag="detail-category-title" style="color: #212121;">Advertisement</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchadvertisement" aria-label="Enable Advertisement" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Advertisement cookies are used to provide visitors with customised advertisements based on the pages you visited previously and to analyse the effectiveness of the ad campaigns.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryadvertisementBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>sa-user-id</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>StackAdapt sets this cookie as a third party advertising cookie to record information about a user's website activity, such as the pages visited and the locations viewed, to enable us to provide users with interest-based content and personalised advertisements on external websites.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>sa-user-id-v2</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>StackAdapt sets this cookie as a third party advertising cookie to record information about a user's website activity, such as the pages visited and the locations viewed, to enable us to provide users with interest-based content and personalised advertisements on external websites.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>bcookie</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>LinkedIn sets this cookie from LinkedIn share buttons and ad tags to recognize browser IDs.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>IDE</div></li><li><div>Duration</div><div>1 year 24 days</div></li><li><div>Description</div><div>Google DoubleClick IDE cookies store information about how the user uses the website to present them with relevant ads according to the user profile.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>test_cookie</div></li><li><div>Duration</div><div>15 minutes</div></li><li><div>Description</div><div>doubleclick.net sets this cookie to determine if the user's browser supports cookies.</div></li></ul></div></div></div><div class="cky-accordion" id="ckyDetailCategoryother"><div class="cky-accordion-item"><div class="cky-accordion-chevron"><i class="cky-chevron-right"></i></div><div class="cky-accordion-header-wrapper"><div class="cky-accordion-header"><button class="cky-accordion-btn" aria-expanded="false" aria-controls="ckyDetailCategoryotherBody" aria-label="Uncategorised" data-cky-tag="detail-category-title" style="color: #212121;">Uncategorised</button><div class="cky-switch" data-cky-tag="detail-category-toggle"><input type="checkbox" id="ckySwitchother" aria-label="Enable Uncategorised" autocomplete="off" style="background-color: rgb(237, 241, 244);"></div></div><div class="cky-accordion-header-des" data-cky-tag="detail-category-description" style="color: #212121;"><p>Other uncategorised cookies are those that are being analysed and have not been classified into a category as yet.</p></div></div></div><div class="cky-accordion-body" id="ckyDetailCategoryotherBody"><div class="cky-audit-table" data-cky-tag="audit-table" style="color: #212121; border-color: #EBEBEB; background-color: #F4F4F4;"><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>sa-user-id-v3</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>Description is currently not available.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>calltrk_nearest_tld</div></li><li><div>Duration</div><div>1 year 1 month 4 days</div></li><li><div>Description</div><div>Description is currently not available.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>calltrk_referrer</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>This is a functionality cookie set by the CallRail. This cookie is used to store the referring URL. It helps to accurately attribute the visitor source when displaying a tracking phone number.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>calltrk_landing</div></li><li><div>Duration</div><div>6 months</div></li><li><div>Description</div><div>This is a functionality cookie set by the CallRail. This cookie is used to store the landing page URL. It helps to accurately attribute the visitor source when displaying a tracking phone number.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>frontend_lang</div></li><li><div>Duration</div><div>1 year</div></li><li><div>Description</div><div>No description available.</div></li></ul><ul class="cky-cookie-des-table"><li><div>Cookie</div><div>libsyn-paywall-s</div></li><li><div>Duration</div><div>1 day</div></li><li><div>Description</div><div>Description is currently not available.</div></li></ul></div></div></div></div></div><div class="cky-footer-wrapper"><span class="cky-footer-shadow" style="background: linear-gradient(180deg, rgba(255, 255, 255, 0) 0%, #EDF1F4 100%);"></span><div class="cky-prefrence-btn-wrapper" data-cky-tag="detail-buttons"><button aria-label="Reject All" class="cky-btn cky-btn-reject" data-cky-tag="detail-reject-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Reject All</button> <button aria-label="Save My Preferences" class="cky-btn cky-btn-preferences" data-cky-tag="detail-save-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Save My Preferences</button> <button aria-label="Accept All" class="cky-btn cky-btn-accept" data-cky-tag="detail-accept-button" style="color: #FFFFFF; border-color: #000000; background-color: #000000;">Accept All</button></div><div data-cky-tag="detail-powered-by" style="padding: 8px 24px; font-size: 12px; font-weight: 400; line-height: 20px; text-align: right; border-radius: 0 0 6px 6px; direction: ltr; display: flex; justify-content: flex-end; align-items: center; color: #293C5B; background-color: #EDEDED;">Powered by <a href="https://www.cookieyes.com/product/cookie-consent/?ref=cypbcyb&amp;utm_source=cookie-banner&amp;utm_medium=powered-by-cookieyes" rel="noopener" style="margin-left:5px;line-height:0" target="_blank"><img alt="Cookieyes logo" src="https://cdn-cookieyes.com/assets/images/poweredbtcky.svg" style="width:78px;height:13px;margin:0" width="78" height="13"></a></div></div></div></div>


	

    

<!-- Global Header -->

<!-- End Global Header -->
		<main id="main" class="main overflow-x-hidden">

			

   



<section class="c-page-header relative bg-code text-white">

    <div class="px-p24 mq768:px-p48 mq1024:px-p56 c-header-wrap v-blog-header">
    <div class="max-w-p1440 mx-auto">
      <div class="flex flex-col mq768:flex-row">
        <div class="flex relative z-20 items-center mq768:w-1/2 order-1 py-p48 mq1024:py-p56 mq768:pr-p64 mq1024:pr-p56">

          <div class="w-full">

            

  
<ul class="mb-p64 mq1024:mb-p80 flex flex-wrap text-white">
                <li class="after:content-['/'] last:after:hidden after:mx-p8"><a class="text-sm hover:underline focus:underline" href="https://trustedsec.com/blog">Blog</a></li>
            <li class="after:content-['/'] last:after:hidden after:mx-p8"><a class="text-sm hover:underline focus:underline" href="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads">Windows Processes, Nefarious Anomalies, and You: Threads</a></li>
     </ul>
                        <div class="mb-p32">

                              <div class="mb-p16">
                  <span class="font-mono text-sm">November 03, 2022</span>
                </div>
              
                                                                <h1 class="text-h1 mq1280:text-title-xl">Windows Processes, Nefarious Anomalies, and You: Threads</h1>
                              
                                        </div>

                          <div class="mb-p16">
                <span class="text-h3 inline-block">
                  Written by
                                                            Brandon McGrath
                                                      </span>
              </div>
            


            
            
            
            <div class="mt-p64">
                          </div>
          </div>
        </div>

        <div class="mq768:flex overflow-hidden items-center mq768:justify-end mq768:w-paired-img max-w-p1080 -mx-p24 mq768:mx-none order-2 mq768:absolute inset-y-0 left-paired-img-plus fx fx-in" x-data="" x-fx.left.1200="2rem" style="transition-duration: 1.2s;">
          <div class="relative mq768:static mq768:w-full h-full pt-full -mx-p24 mq768:mx-none">
                          <picture class=" w-full"><source type="image/webp" media="(min-width: 64rem)" srcset="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=600&amp;h=600&amp;q=90&amp;fm=webp&amp;fit=crop&amp;dm=1767067300&amp;s=9949b582201b0960be689372e4416d5a, https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=900&amp;h=900&amp;q=90&amp;fm=webp&amp;fit=crop&amp;dm=1767067300&amp;s=600dcd75f1e58bd7d44afd01e63a2eb1 1.5x"><source type="image/webp" media="(min-width: 64rem)" srcset="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=600&amp;h=600&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067300&amp;s=ac39096e790073fa8e7d555869e306c3, https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=900&amp;h=900&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067300&amp;s=046fbda20860a80a1e54b1fa2416d44d 1.5x"><source type="image/webp" srcset="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=320&amp;h=320&amp;q=90&amp;fm=webp&amp;fit=crop&amp;dm=1767067300&amp;s=b4a2feaf1cbc925a30ed21a743b09bfa, https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=480&amp;h=480&amp;q=90&amp;fm=webp&amp;fit=crop&amp;dm=1767067300&amp;s=8b1b2c6a5cc35f514383f04495c8b5c6 1.5x"><source type="image/webp" srcset="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=320&amp;h=320&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067300&amp;s=7f92e78072b4a477a75ada679d77e2ef, https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=480&amp;h=480&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067300&amp;s=a2e07fd4e0f0bb42538a9458e395700f 1.5x"><img class="c-img opacity-0 transition-all duration-300 absolute inset-0 object-cover w-full h-full object-center" src="https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/WindowProcesses_Part2_WebHero.jpg?w=320&amp;h=320&amp;q=90&amp;auto=format&amp;fit=crop&amp;dm=1767067300&amp;s=7f92e78072b4a477a75ada679d77e2ef" loading="eager" x-data="image({mq1024:{width:600,height:600},DEFAULT:{width:320,height:320}})" :width="getSize()" :height="getSize('height')" alt="" width="600" height="600" style="opacity: 1;"></picture>                      </div>
        </div>
      </div>
    </div>
  </div>

</section>


      
			
						<div class="relative"><section id="migratedContent-0" class="c-module relative bg-white text-black py-p64 mq768:py-p96" data-module-num="1" style="z-index: 0;"><div class="px-p24 mq768:px-p48 mq1024:px-p56"><div class="max-w-p1440 mx-auto"><div class="flex flex-col mq1024:flex-row" x-data="{ mobile: ! $breakpoint('mq1024') }" @resize.window="mobile = ! $breakpoint('mq1024')"><div class="mq1024:w-p320 mq1024:pr-p64 grow-0 shrink-0 mq1024:order-1"><div><div class="w-full"><p id="share-label" class="text-xs font-mono mb-p16">Share</p><ul id="share-icons" class="flex items-center" aria-describedby="share-label"><li class="ml-p12"><a href="https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share URL" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-share"></use></svg></span><span class="sr-only">Share URL</span></a></li><li class="ml-p12"><a href="mailto:?subject=Check%20out%20this%20article%20from%20TrustedSec%21&amp;body=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Threads%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share via Email" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-email"></use></svg></span><span class="sr-only">Share via Email</span></a></li><li class="ml-p12"><a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share on Facebook" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-facebook"></use></svg></span><span class="sr-only">Share on Facebook</span></a></li><li class="ml-p12"><a href="http://twitter.com/share?text=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Threads%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" title="Share on X" rel="nofollow" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-twitter"></use></svg></span><span class="sr-only">Share on X</span></a></li><li class="ml-p12"><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads&amp;mini=true" target="_blank" title="Share on LinkedIn" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-linkedin"></use></svg></span><span class="sr-only">Share on LinkedIn</span></a></li></ul></div></div><div><div class="w-full"><p id="share-label" class="text-xs font-mono mb-p16">Share</p><ul id="share-icons" class="flex items-center" aria-describedby="share-label"><li class="ml-p12"><a href="https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share URL" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-share"></use></svg></span><span class="sr-only">Share URL</span></a></li><li class="ml-p12"><a href="mailto:?subject=Check%20out%20this%20article%20from%20TrustedSec%21&amp;body=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Threads%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share via Email" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-email"></use></svg></span><span class="sr-only">Share via Email</span></a></li><li class="ml-p12"><a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share on Facebook" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-facebook"></use></svg></span><span class="sr-only">Share on Facebook</span></a></li><li class="ml-p12"><a href="http://twitter.com/share?text=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Threads%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" title="Share on X" rel="nofollow" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-twitter"></use></svg></span><span class="sr-only">Share on X</span></a></li><li class="ml-p12"><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads&amp;mini=true" target="_blank" title="Share on LinkedIn" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-linkedin"></use></svg></span><span class="sr-only">Share on LinkedIn</span></a></li></ul></div></div></div><div class="w-full mq1024:w-content-well mq1024:order-2 flex-1"><div class="c-content"><p><a></a><a href="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions">In part 1 of this blog mini-series, we looked at memory regions and analyzed them to find some potential malicious behavior. In part 2, we will do the same thing with enumerating threads.</a></p><p>Nobody explains it better than Microsoft—here is their explanation of what a thread is:</p><p>"A thread is the basic unit to which the operating system allocates processor time. A thread can execute any part of the process code, including parts currently being executed by another thread."</p><p>Essentially, a thread runs code.</p><p>If this is where the malicious code will run, it makes sense to analyze threads from time to time. But before we try to identify anomalies, we need to actually enumerate a thread—that’s up first!</p><h2>1.&nbsp; Enumerating Threads</h2><p>A thread is essentially the location from which code begins running. On Windows, a thread will often start from a memory region with calls such as:</p><ul><li><a href="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread">CreateThread</a></li><li><a href="http://undocumented.ntinternals.net/index.html?page=UserMode%2FUndocumented%20Functions%2FExecutable%20Images%2FRtlCreateUserThread.html">RtlCreateUserThread</a></li><li><a href="http://undocumented.ntinternals.net/index.html?page=UserMode%2FUndocumented%20Functions%2FNT%20Objects%2FThread%2FNtCreateThread.html">NtCreateThread</a></li></ul><p>There are other ways to execute code from a memory region, but we will focus on these for now.</p><p>As an example, the image below shows a ton of threads in <code>WINWORD.EXE</code>, as well as the call stack on thread ID 16160.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB1.png" alt="" class="wp-image-27899"><figcaption>Figure 1 WINWORD.EXE Threads</figcaption></figure><p>Starting from the bottom, the entry point to this thread was <code>ntdll.dll!RtlUserThreadStart+0x21</code>, which then subsequently made a few calls to do whatever that thread needs to do.</p><p>Now, let’s compare that to our implant. Remember, this implant loaded a Reflective Dynamic-Link Library (DLL), and the thread is being started on the memory region allocated for the Reflective DLL.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes">hThread = ((CREATETHREAD)Api.CreateThread)(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, pRoutine, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);</pre><p>In this case, <code>pRoutine</code> is the exported function from the Reflective DLL. That call stack appears as follows.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB2.png" alt="" class="wp-image-27900"><figcaption>Figure 2 Maelstrom’s Thread Entry Point</figcaption></figure><p>In this process, the thread (836) starts in <code>0x1b7ddb</code>. This matches up with the base address it was allocated in, <code>0x1b0000</code>.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB3.png" alt="" class="wp-image-27901"><figcaption>Figure 3 Maelstroms Base Address</figcaption></figure><p>This is very uncommon—clicking through other processes, it’s very unlikely to find processes with non-backed entry points. This means that the entry point isn’t a genuine function from a DLL; it's coming from the nether. In the next section, we will discuss how to identify this behavior, but for now, let’s actually identify the threads.</p><p>Enumerating threads is just as easy as enumerating the memory regions. The <a href="https://learn.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot">CreateToolhelp32Snapshot</a> Application Programming Interface (API) has a <code>TH32CS_SNAPTHREAD</code> flag that will take a snapshot of all the threads on the host. Doing so will give access to the <a href="https://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/ns-tlhelp32-threadentry32">THREADENTRY32</a> structure.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">tagTHREADENTRY32</span> {
  DWORD dwSize;
  DWORD cntUsage;
  DWORD th32ThreadID;
  DWORD th32OwnerProcessID;
  LONG  tpBasePri;
  LONG  tpDeltaPri;
  DWORD dwFlags;
} THREADENTRY32;</pre><p>This structure plus some other members will create the structure that we will define for each thread.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">THREAD_</span>
{
 std::string FullStartAddress = <span class="hljs-string">""</span>;
 DWORD ThreadId = <span class="hljs-number">0</span>;
 DWORD Flags = <span class="hljs-number">0</span>;
 DWORD Size = <span class="hljs-number">0</span>;
 DWORD ProcessId = <span class="hljs-number">0</span>;
 LPVOID BaseAddress  = <span class="hljs-literal">nullptr</span>;
 std::vector&lt;std::string&gt; Callstack;
 FENNEC::Processes::Region Region;
} Thread;</pre><p>The additional members here are the vector of functions in the call stack and a vector of <code>Region </code>structures from the previous section.</p><p>With that out of the way, the code to enumerate threads is easy. It relies on <a href="https://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-thread32first">Thread32First</a> and <a href="https://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-thread32next">Thread32Next</a>. Additionally, Microsoft has provided an example: "<a href="https://docs.microsoft.com/en-us/windows/win32/toolhelp/traversing-the-thread-list">Traversing the Thread List</a>".</p><p>As a base, this is the core logic to work through each thread if it matches a given process ID.</p><pre class="wp-block-preformatted hljs language-csharp" data-highlighted="yes">HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPTHREAD, <span class="hljs-number">0</span>);

THREADENTRY32 te = { <span class="hljs-number">0</span> };

te.dwSize = <span class="hljs-keyword">sizeof</span>(te);

<span class="hljs-keyword">if</span> (Thread32First(hSnapshot, &amp;te))
{
<span class="hljs-keyword">do</span>
{
    <span class="hljs-keyword">if</span> (te.dwSize &gt;= FIELD_OFFSET(THREADENTRY32, th32OwnerProcessID) + <span class="hljs-keyword">sizeof</span>(te.th32OwnerProcessID))
    {
        <span class="hljs-keyword">if</span> (te.th32OwnerProcessID == <span class="hljs-number">0</span> &amp;&amp; te.th32ThreadID == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (te.th32OwnerProcessID != dwProcessId) <span class="hljs-keyword">continue</span>;
    }

    te.dwSize = <span class="hljs-keyword">sizeof</span>(te);

} <span class="hljs-keyword">while</span> (Thread32Next(hSnapshot, &amp;te));</pre><p>We simply loop through every thread in the snapshot by iterating with <code>Thread32Next</code>.</p><p>Using <code>WINWORD.EXE</code> as an example again, the information inside the thread structure appears as follows.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB4.png" alt="" class="wp-image-27902"><figcaption>Figure 4 Thread Structure</figcaption></figure><p>There are two additional members we need to fill out that aren’t in the snapshots structure:</p><ul><li>The thread start address</li><li>The call stack</li></ul><p>Let’s start with the thread start address. To obtain this, the <a href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntqueryinformationthread">NtQueryInformationThread</a> from NTDLL is used with the <a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/api/ps/psquery/class.htm">THREADINFOCLASS</a> structure—specifically <code>ThreadQuerySetWin32StartAddress</code>.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">_THREADINFOCLASS</span> {
    ThreadBasicInformation,
    ThreadTimes,
    ThreadPriority,
    ThreadBasePriority,
    ThreadAffinityMask,
    ThreadImpersonationToken,
    ThreadDescriptorTableEntry,
    ThreadEnableAlignmentFaultFixup,
    ThreadEventPair,
    ThreadQuerySetWin32StartAddress,
    ThreadZeroTlsCell,
    ThreadPerformanceCount,
    ThreadAmILastThread,
    ThreadIdealProcessor,
    ThreadPriorityBoost,
    ThreadSetTlsArrayAddress,
    MaxThreadInfoClass
} THREADINFOCLASS;</pre><p>Using the call:</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes">PVOID lpStartAddress = <span class="hljs-literal">nullptr</span>;

NTSTATUS status = <span class="hljs-built_in">NtQueryInformationThread</span>(hThread, <span class="hljs-built_in">static_cast</span>&lt;THREADINFOCLASS&gt;(<span class="hljs-number">9</span>), &amp;lpStartAddress, <span class="hljs-built_in">static_cast</span>&lt;ULONG&gt;(<span class="hljs-built_in">sizeof</span>(PVOID)), <span class="hljs-literal">NULL</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">NT_SUCCESS</span>(status))
{
    <span class="hljs-keyword">continue</span>;
}

<span class="hljs-keyword">if</span> (lpStartAddress == <span class="hljs-literal">nullptr</span>)
{
    <span class="hljs-keyword">continue</span>;
}</pre><p><code>lpStartAddress</code> will now hold the base address of the thread. This is cool, and it will let us track down the location from which the thread operated, as we discussed earlier. With that, we can now track down the call stack, which is slightly more complicated.</p><p>To “walk the stack,” a few things are needed. First of all, we initial the symbol handler for the process with <a href="https://docs.microsoft.com/en-us/windows/win32/api/dbghelp/nf-dbghelp-syminitialize">SymInitialize</a>.</p><pre class="wp-block-preformatted hljs language-css" data-highlighted="yes">BOOL IMAGEAPI SymInitialize(
  <span class="hljs-selector-attr">[in]</span>           HANDLE hProcess,
  <span class="hljs-selector-attr">[in, optional]</span> PCSTR  UserSearchPath,
  <span class="hljs-selector-attr">[in]</span>           BOOL   fInvadeProcess
);</pre><p>Like so:</p><pre class="wp-block-preformatted hljs language-objectivec" data-highlighted="yes">HANDLE hProcess = OpenProcess(MAXIMUM_ALLOWED, <span class="hljs-literal">FALSE</span>, dwProcessId);
<span class="hljs-keyword">if</span> (hProcess == nullptr)
{
    <span class="hljs-keyword">return</span> Threads;
}
SymInitialize(hProcess, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">TRUE</span>);</pre><p>In order to walk the stack, we must use a few functions:</p><ul><li><a href="https://docs.microsoft.com/en-us/windows/win32/api/dbghelp/nf-dbghelp-stackwalk64">StackWalk64</a></li><li><a href="https://docs.microsoft.com/en-us/windows/win32/api/dbghelp/nf-dbghelp-symfunctiontableaccess">SymFunctionTableAccess</a></li><li><a href="https://docs.microsoft.com/en-us/windows/win32/api/dbghelp/nf-dbghelp-symgetmodulebase64">SymGetModuleBase64</a></li><li><a href="https://docs.microsoft.com/en-us/windows/win32/api/dbghelp/nf-dbghelp-symfromaddr">SymFromAddr</a></li></ul><p>The theory in this particular section is quite long, so we will not go into too much detail, but these posts are recommended:</p><ul><li><a href="https://www.codeproject.com/Articles/11132/Walking-the-callstack-2">Walking the call stack</a></li><li><a href="https://jpassing.com/2008/03/12/walking-the-stack-of-the-current-thread/">Walking the stack of the current thread</a></li><li><a href="https://github.com/JochenKalmbach/StackWalker">StackWalker - Walking the call stack</a></li></ul><p>First, we set up the <a href="https://docs.microsoft.com/en-us/windows/win32/api/dbghelp/ns-dbghelp-stackframe64">STACKFRAME64</a> structure obtaining a <a href="https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-context">CONTEXT</a> structure of the threads registers.</p><pre class="wp-block-preformatted hljs language-objectivec" data-highlighted="yes">CONTEXT context = {};

context.ContextFlags = CONTEXT_FULL;

<span class="hljs-keyword">if</span> (GetThreadContext(hThread, &amp;context) == <span class="hljs-literal">FALSE</span>)
{
    <span class="hljs-keyword">goto</span> cleanup;
}

frame.AddrPC.Offset = context.Rip;
frame.AddrPC.Mode = AddrModeFlat;
frame.AddrStack.Offset = context.Rsp;
frame.AddrStack.Mode = AddrModeFlat;
frame.AddrFrame.Offset = context.Rbp;
frame.AddrFrame.Mode = AddrModeFlat;</pre><p>Now, the thread’s stack is ready to be walked!</p><p>This is done by calling <code>StackWalk64</code> until it fails.</p><pre class="wp-block-preformatted hljs language-objectivec" data-highlighted="yes"><span class="hljs-keyword">do</span>
{
    <span class="hljs-keyword">if</span> (StackWalk64(IMAGE_FILE_MACHINE_AMD64, hProcess, hThread, &amp;frame, &amp;context, <span class="hljs-literal">NULL</span>, SymFunctionTableAccess64, SymGetModuleBase64, <span class="hljs-literal">NULL</span>) == <span class="hljs-literal">FALSE</span>)
    {
        <span class="hljs-keyword">break</span>;
    }
} <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);
</pre><p>Inside this do/while, a <a href="https://docs.microsoft.com/en-us/windows/win32/api/dbghelp/ns-dbghelp-symbol_info">SYMBOL_INFO</a> structure is set up.</p><pre class="wp-block-preformatted hljs language-csharp" data-highlighted="yes">DWORD64 dwOffset = <span class="hljs-number">0</span>;
<span class="hljs-built_in">char</span> Buffer[<span class="hljs-keyword">sizeof</span>(SYMBOL_INFO) + MAX_SYM_NAME * <span class="hljs-keyword">sizeof</span>(WCHAR)] = { <span class="hljs-number">0</span> };
PSYMBOL_INFO Symbol = (PSYMBOL_INFO)Buffer;
Symbol-&gt;SizeOfStruct = <span class="hljs-keyword">sizeof</span>(SYMBOL_INFO);
Symbol-&gt;MaxNameLen = MAX_SYM_NAME;</pre><p>At this point, we’re ready to query what this address actually is with <code>SymFromAddr</code>. If this works, then cool, we have a function name. If it fails, then we have just an address, which is one of the detections we discussed earlier.</p><pre class="wp-block-preformatted hljs language-rust" data-highlighted="yes"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">SymFromAddr</span>(hProcess, frame.AddrPC.Offset, &amp;dwOffset, Symbol))
{
    call = Symbol<span class="hljs-punctuation">-&gt;</span>Name;
    Callstack.<span class="hljs-title function_ invoke__">push_back</span>(call);
}
<span class="hljs-keyword">else</span>
{
    Callstack.<span class="hljs-title function_ invoke__">push_back</span>(FENNEC::Strings::<span class="hljs-title function_ invoke__">LPVOID2StringA</span>(reinterpret_cast&lt;LPVOID&gt;(frame.AddrPC.Offset)));
}</pre><p>Each item is appended to the vector, whether it is a valid function or just an address. Then we let it run against Maelstrom.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB5.png" alt="" class="wp-image-27903"><figcaption>Figure 5 Call Stack of Maelstrom in VS</figcaption></figure><p>In this vector, we see <code>NtDelayExecution</code>, <code>SleepEx</code>, and then an address—this is what we see in Process Hacker, too. We add a final check here to validate it. This is easy enough with a wraparound <a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a> whilst looping over all the modules in the current process.</p><pre class="wp-block-preformatted hljs language-ruby" data-highlighted="yes"><span class="hljs-keyword">for</span> (<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Processes</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Module&amp;</span> <span class="hljs-title class_">Module</span> : <span class="hljs-title class_">Modules</span>)
{
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">GetProcAddress</span>((<span class="hljs-variable constant_">HMODULE</span>)<span class="hljs-title class_">Module</span>.<span class="hljs-title class_">BaseAddress</span>, <span class="hljs-title class_">FirstCallStackEntry</span>.c_str()) != nullptr)
    {
        <span class="hljs-title class_">ModuleStart</span> = <span class="hljs-title class_">Module</span>.<span class="hljs-title class_">ModuleName</span>;
        <span class="hljs-keyword">break</span>;
    }
}</pre><p>If GetProcAddress returns an address, then this is where the function belongs, so we can track the module's name.</p><p>At this point, we have a vector of enumerated threads with most of the information we will need (<em>foreshadowing</em>). Next, we need to parse the information to identify malicious attributes.</p><h2>2.&nbsp; Identifying Malicious Attributes in Threads</h2><p>When looking at threads, there are a few indicators that the process may be up to something nefarious. The easiest indicators to find are specific calls on the call stack, like <code>NtDelayExecution</code>. Or, we can figure out if the thread has originated from private memory. For the more adventurous, Debug Registers can be found on the thread, as seen <a href="https://gist.github.com/olliencc/90f6e040dfef1dccb61f5b3fdc62fa00">here</a>.</p><h3>2.1.    &nbsp; Sleeping Threads</h3><p>In this section we will focus on the latter: specific calls on the call stack and thread originating from private memory.</p><p>As a lot of attention has been given to the data structure, checking if these calls are on the call stack is as simple as checking if the vector contains a string:</p><pre class="wp-block-preformatted hljs language-css" data-highlighted="yes">if (FENNEC::Strings::<span class="hljs-built_in">VectorContainsStringA</span>(Thread.Callstack, <span class="hljs-string">"NtDelayExecution"</span>))
{
    Scanner::<span class="hljs-built_in">LogThreadDelay</span>(Thread, Common);
}</pre><p>If the function is in the call stack, then log it. Obviously, this is quite naive, but it’s just a proof-of-concept.</p><p>This is great and all, but let’s build something that relies on Windows determining if the process is in a delayed state. This will require <a href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntquerysysteminformation">NtQuerySystemInformation</a>.</p><pre class="wp-block-preformatted hljs language-css" data-highlighted="yes">__kernel_entry NTSTATUS NtQuerySystemInformation(
  <span class="hljs-selector-attr">[in]</span>            SYSTEM_INFORMATION_CLASS SystemInformationClass,
  <span class="hljs-selector-attr">[in, out]</span>       PVOID                    SystemInformation,
  <span class="hljs-selector-attr">[in]</span>            ULONG                    SystemInformationLength,
  <span class="hljs-selector-attr">[out, optional]</span> PULONG                   ReturnLength
);</pre><p>To get the information we need, we will need to give it the <code>SystemProcessInformation</code> flag. This returns <a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/api/ex/sysinfo/process.htm">SYSTEM_PROCESS_INFORMATION</a>.</p><p>This function is a bit of a nightmare to use. To get a better understanding of this, <a href="https://github.com/hasherezade/pe-sieve/blob/2cd8269ac2d685d1db6600ee00779ab24406a056/utils/threads_util.cpp">threads_util.cpp</a> from <a href="https://github.com/hasherezade/pe-sieve/">pe-sieve</a> is a great reference, alongside "<a href="http://jgrunzweig.github.io/posts/2014/12/unique-technique-for-iterating-through-processes/">Unique Technique for Iterating through Processes</a>." Let’s look at the code.</p><p>In a while loop, <code>NtQuerySystemInformation</code> is called until <code>STATUS_INFO_LENGTH_MISMATCH </code>is hit. When it is, the buffer is set the length of the return length, and the call is reattempted. The goal here is to determine the actual size required, essentially via brute-force. This will appear as follows.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes"><span class="hljs-keyword">while</span> (status != STATUS_SUCCESS)
{
    status = <span class="hljs-built_in">NtQuerySystemInformation</span>(SystemProcessInformation, SystemInformation, SystemInformationLength, &amp;ReturnLength);

    <span class="hljs-keyword">if</span> (status == <span class="hljs-number">0xC0000004</span>)
    {
        <span class="hljs-built_in">free</span>(SystemInformation);
        SystemInformation = <span class="hljs-literal">nullptr</span>;
        SystemInformationLength = <span class="hljs-number">0</span>;
        SystemInformation = (LPVOID)<span class="hljs-built_in">calloc</span>(ReturnLength, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> (!SystemInformation) {
            <span class="hljs-keyword">return</span> Thread;
        }
        SystemInformationLength = ReturnLength;
        <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">break</span>;
};</pre><p>This is a bit confusing, but once it has iterated and found the correct size, it will no longer hit the mismatch error, thus breaking out of the loop.</p><p>Once that is done, the buffer returned from <code>NtQuerySystemInformation</code> can be cast.</p><pre class="wp-block-preformatted hljs language-undefined" data-highlighted="yes">SYSTEM_PROCESS_INFORMATION* ProcessInfo = (SYSTEM_PROCESS_INFORMATION*)SystemInformation;</pre><p><em>ANOTHER </em>while loop is entered. This now iterates through the <code>SYSTEM_PROCESS_INFORMATION</code> object by incrementing over the <code>NextEntryOffset</code>.</p><pre class="wp-block-preformatted hljs language-rust" data-highlighted="yes"><span class="hljs-keyword">while</span> (ProcessInfo)
{
    ProcessInfo = (SYSTEM_PROCESS_INFORMATION*)((ULONG_PTR)ProcessInfo + ProcessInfo<span class="hljs-punctuation">-&gt;</span>NextEntryOffset);
}</pre><p>We almost have the data we need.</p><p>Next, we need to iterate over the number of threads in the structure, while checking if the thread ID is what we are need</p><pre class="wp-block-preformatted hljs language-rust" data-highlighted="yes"><span class="hljs-keyword">for</span> (size_t i = <span class="hljs-number">0</span>; i &lt; ProcessInfo<span class="hljs-punctuation">-&gt;</span>NumberOfThreads; i++) {
    <span class="hljs-keyword">if</span> (((ULONGLONG)ProcessInfo<span class="hljs-punctuation">-&gt;</span>Threads[i].ClientId.UniqueThread &amp; <span class="hljs-number">0xffffffff</span>) == Tid)
    {
    
    }
}</pre><p>Note the ‘<code>bitwise AND</code>’ operation, which is shifting the <code>UniqueThread</code> by <code>0xffffffff</code>.</p><p>After all of that, we get the following information.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB6.png" alt="" class="wp-image-27914"><figcaption>Figure 6 Thread Data</figcaption></figure><p>By doing all that, we get access to the <a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/api/ex/sysinfo/thread.htm">SYSTEM_THREAD_INFORMATION</a> structure.</p><pre class="wp-block-preformatted hljs language-objectivec" data-highlighted="yes"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> _SYSTEM_THREAD_INFORMATION
{
    LARGE_INTEGER KernelTime;
    LARGE_INTEGER UserTime;
    LARGE_INTEGER CreateTime;
    ULONG WaitTime;
    PVOID StartAddress;
    <span class="hljs-built_in">CLIENT_ID</span> ClientId;
    KPRIORITY Priority;
    LONG BasePriority;
    ULONG ContextSwitches;
    KTHREAD_STATE ThreadState;
    KWAIT_REASON WaitReason;
} SYSTEM_THREAD_INFORMATION, * PSYSTEM_THREAD_INFORMATION;</pre><p>The full function appears as follows.</p><pre class="wp-block-preformatted hljs language-rust" data-highlighted="yes">FENNEC::Processes::Thread FENNEC::Processes::<span class="hljs-title function_ invoke__">GetExtendedThreadInfo</span>(DWORD Tid)
{
    FENNEC::Processes::Thread Thread;
    LPVOID SystemInformation = nullptr;
    ULONG SystemInformationLength = <span class="hljs-number">0</span>;
    ULONG ReturnLength = <span class="hljs-number">0</span>;
    NTSTATUS status = STATUS_UNSUCCESSFUL;

    <span class="hljs-keyword">while</span> (status != STATUS_SUCCESS)
    {
        status = <span class="hljs-title function_ invoke__">NtQuerySystemInformation</span>(SystemProcessInformation, SystemInformation, SystemInformationLength, &amp;ReturnLength);

        <span class="hljs-keyword">if</span> (status == <span class="hljs-number">0xC0000004</span>)
        {
            <span class="hljs-title function_ invoke__">free</span>(SystemInformation);
            SystemInformation = nullptr;
            SystemInformationLength = <span class="hljs-number">0</span>;
            SystemInformation = (LPVOID)<span class="hljs-title function_ invoke__">calloc</span>(ReturnLength, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (!SystemInformation) {
                <span class="hljs-keyword">return</span> Thread;
            }
            SystemInformationLength = ReturnLength;
            <span class="hljs-keyword">continue</span>;
        }
        <span class="hljs-keyword">break</span>;
    };

    <span class="hljs-keyword">if</span> (status != STATUS_SUCCESS)
    {
        <span class="hljs-title function_ invoke__">free</span>(SystemInformation);
        <span class="hljs-keyword">return</span> Thread;
    }

    SYSTEM_PROCESS_INFORMATION* ProcessInfo = (SYSTEM_PROCESS_INFORMATION*)SystemInformation;

    <span class="hljs-type">bool</span> bFound = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">while</span> (ProcessInfo)
    {
        ProcessInfo = (SYSTEM_PROCESS_INFORMATION*)((ULONG_PTR)ProcessInfo + ProcessInfo<span class="hljs-punctuation">-&gt;</span>NextEntryOffset);

        <span class="hljs-keyword">for</span> (size_t i = <span class="hljs-number">0</span>; i &lt; ProcessInfo<span class="hljs-punctuation">-&gt;</span>NumberOfThreads; i++) {
            <span class="hljs-keyword">if</span> (((ULONGLONG)ProcessInfo<span class="hljs-punctuation">-&gt;</span>Threads[i].ClientId.UniqueThread &amp; <span class="hljs-number">0xffffffff</span>) == Tid)
            {
                Thread.ThreadState = FENNEC::Strings::<span class="hljs-title function_ invoke__">StateToString</span>(ProcessInfo<span class="hljs-punctuation">-&gt;</span>Threads[i].ThreadState);
                Thread.WaitReason = FENNEC::Strings::<span class="hljs-title function_ invoke__">WaitReasonToString</span>(ProcessInfo<span class="hljs-punctuation">-&gt;</span>Threads[i].WaitReason);
                Thread.WaitTime = ProcessInfo<span class="hljs-punctuation">-&gt;</span>Threads[i].WaitTime;
                bFound = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">if</span> (bFound == <span class="hljs-literal">true</span>)
        {
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-keyword">return</span> Thread;
}</pre><p>Letting this run against the implant, we now have the <code>DelayExecution</code> enum.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB7.png" alt="" class="wp-image-27915"><figcaption>Figure 7 DelayExecution Enum</figcaption></figure><p>Now the detection code can be simplified to the following.</p><pre class="wp-block-preformatted hljs language-cpp" data-highlighted="yes"><span class="hljs-keyword">if</span> (Thread.WaitReason, <span class="hljs-string">"DelayExecution"</span>)
{
    Scanner::<span class="hljs-built_in">LogThreadDelay</span>(Thread, Common);
}</pre><p>We didn’t save much code, but we’ve determined that the thread is 100% in a delayed state, as opposed to checking the call stack.</p><p>If we switch the sleep to <code>WaitForSingleObject</code>, it fits in with the noise a lot more, as it is harder to determine that the thread is sleeping.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB8.png" alt="" class="wp-image-27904"><figcaption>Figure 8 Thread Sleeping With WaitForSingleObject</figcaption></figure><h3>2.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread Origin</h3><p>Checking the origins is slightly more complicated. First, we check if the first item in the call stack starts with 0x, as that’s how strings are being formatted. If that matches, get the actual address from the string.</p><pre class="wp-block-preformatted hljs language-ruby" data-highlighted="yes"><span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Strings</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:StringAContainsA</span>(<span class="hljs-title class_">Call</span>, <span class="hljs-string">"0x"</span>))
{
    <span class="hljs-variable constant_">LPVOID</span> lpAddress = <span class="hljs-variable constant_">FENNEC</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Strings</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:StringA2LPVOID</span>(<span class="hljs-title class_">Call</span>);
}</pre><p>With that, next up is looping over all regions and checking if the thread address is within the specific page.</p><pre class="wp-block-preformatted hljs language-php" data-highlighted="yes"><span class="hljs-keyword">bool</span> bPrivateMem = <span class="hljs-literal">false</span>;

<span class="hljs-keyword">for</span> (FENNEC::<span class="hljs-variable constant_">Processes</span>::<span class="hljs-variable constant_">Region</span>&amp; Region : Process.Regions)
{
    <span class="hljs-keyword">if</span> (FENNEC::<span class="hljs-variable constant_">Processes</span>::<span class="hljs-title function_ invoke__">IsMemoryInRegion</span>(lpAddress, Region.BaseAddress, Region.Size) == <span class="hljs-literal">true</span>)
    {
        <span class="hljs-keyword">if</span> (Region.Use.<span class="hljs-keyword">empty</span>())
        {
            bPrivateMem = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">break</span>;
        }
    }
}</pre><p>If it’s within the range, then check if the region structure has a use applied to it. In the case of the data structure, this means it is associated with a DLL.</p><p>If it’s set to 'true', then we can log it. As an example, the Reflective DLL’s thread starts at <code>0x1b7da9</code>.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB9.png" alt="" class="wp-image-27905"><figcaption>Figure 9 Thread Starting at 0x1b7da9</figcaption></figure><p>This is within the RWX region allocated for the Reflective DLL.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath10-1.png" alt="" class="wp-image-27906"><figcaption>Figure 10 Maelstrom RWX Region at 0x1b0000</figcaption></figure><p>Finally, note how there is no DLL and it is <code>Private: Commit</code>.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/Mcgrath11-1.png" alt="" class="wp-image-27907"><figcaption>Figure 11 RWX with no Use</figcaption></figure><p>There’s a big <em>however</em> here: tons of false positives.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB13.png" alt="" class="wp-image-27909"><figcaption>Figure 12 2088 Entries for Addresses in the Call Stack</figcaption></figure><p>Tracking this down, it’s because .NET does not live by any of the natural rules. This bit was quite interesting dive into the PEB, so I will leave this as a task for the reader. However, here is the reference: <a href="https://jstdev.wordpress.com/2014/02/16/clr-header/">The CLR Header</a>.</p><p>After eradicating .NET, the line count is down to 58. With a new bug, devenv.exe:</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB14.png" alt="" class="wp-image-27910"><figcaption>Figure 13 Devenv.exe</figcaption></figure><p>This will remain a bug for another day!</p><p>Here is the log for detecting <code>NtDelayExecution</code>.</p><pre class="wp-block-preformatted hljs language-swift" data-highlighted="yes">{
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"allocation_base"</span>: <span class="hljs-string">"0x00000000001B0000"</span>,
    <span class="hljs-string">"base_address"</span>: <span class="hljs-string">"0x00000000001B7000"</span>,
    <span class="hljs-string">"callstack"</span>: [
      <span class="hljs-string">"NtDelayExecution"</span>,
      <span class="hljs-string">"SleepEx"</span>,
      <span class="hljs-string">"0x00000000001B7DA9"</span>
    ],
    <span class="hljs-string">"flags"</span>: <span class="hljs-string">"0"</span>,
    <span class="hljs-string">"method"</span>: <span class="hljs-string">"Thread Sleeping (NtDelayExecution)"</span>,
    <span class="hljs-string">"partition_id"</span>: <span class="hljs-string">"0"</span>,
    <span class="hljs-string">"process_id"</span>: <span class="hljs-string">"27184"</span>,
    <span class="hljs-string">"region_allocation_initial"</span>: <span class="hljs-string">"PAGE_EXECUTE_READWRITE"</span>,
    <span class="hljs-string">"region_protection_active"</span>: <span class="hljs-string">"PAGE_EXECUTE_READWRITE"</span>,
    <span class="hljs-string">"region_size"</span>: <span class="hljs-string">"45056"</span>,
    <span class="hljs-string">"region_state"</span>: <span class="hljs-string">"MEM_COMMIT"</span>,
    <span class="hljs-string">"region_type"</span>: <span class="hljs-string">"MEM_PRIVATE"</span>,
    <span class="hljs-string">"start_address"</span>: <span class="hljs-string">"0x00000000001B76F0"</span>,
    <span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"836"</span>,
    <span class="hljs-string">"use"</span>: <span class="hljs-string">""</span>
  },
  <span class="hljs-string">"event_category"</span>: <span class="hljs-string">"Memory Scanner"</span>,
  <span class="hljs-string">"event_time"</span>: <span class="hljs-string">"Wed Sep  7 11:39:13 2022"</span>,
  <span class="hljs-string">"guid"</span>: <span class="hljs-string">"a098d87b-808a-42dd-8997-0d69355914e2"</span>,
  <span class="hljs-string">"image_name"</span>: <span class="hljs-string">"maelstrom.unsafe.x64.exe"</span>,
  <span class="hljs-string">"image_path"</span>: <span class="hljs-string">"<span class="hljs-subst">\\</span>Device<span class="hljs-subst">\\</span>HarddiskVolume11<span class="hljs-subst">\\</span>maelstrom<span class="hljs-subst">\\</span>agent<span class="hljs-subst">\\</span>stage0<span class="hljs-subst">\\</span>bin<span class="hljs-subst">\\</span>maelstrom.unsafe.x64.exe"</span>,
  <span class="hljs-string">"parent_procecess"</span>: <span class="hljs-number">18056</span>,
  <span class="hljs-string">"process_id"</span>: <span class="hljs-number">27184</span>
}</pre><p>Here is the log for tor threads origin.</p><pre class="wp-block-preformatted hljs language-swift" data-highlighted="yes">{
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"allocation_base"</span>: <span class="hljs-string">"0x00000000001B0000"</span>,
    <span class="hljs-string">"base_address"</span>: <span class="hljs-string">"0x00000000001B7000"</span>,
    <span class="hljs-string">"callstack"</span>: [
      <span class="hljs-string">"NtDelayExecution"</span>,
      <span class="hljs-string">"SleepEx"</span>,
      <span class="hljs-string">"0x00000000001B7DA9"</span>
    ],
    <span class="hljs-string">"flags"</span>: <span class="hljs-string">"0"</span>,
    <span class="hljs-string">"method"</span>: <span class="hljs-string">"Thread Origin is Memory Region"</span>,
    <span class="hljs-string">"partition_id"</span>: <span class="hljs-string">"0"</span>,
    <span class="hljs-string">"process_id"</span>: <span class="hljs-string">"27184"</span>,
    <span class="hljs-string">"region_allocation_initial"</span>: <span class="hljs-string">"PAGE_EXECUTE_READWRITE"</span>,
    <span class="hljs-string">"region_protection_active"</span>: <span class="hljs-string">"PAGE_EXECUTE_READWRITE"</span>,
    <span class="hljs-string">"region_size"</span>: <span class="hljs-string">"45056"</span>,
    <span class="hljs-string">"region_state"</span>: <span class="hljs-string">"MEM_COMMIT"</span>,
    <span class="hljs-string">"region_type"</span>: <span class="hljs-string">"MEM_PRIVATE"</span>,
    <span class="hljs-string">"start_address"</span>: <span class="hljs-string">"0x00000000001B76F0"</span>,
    <span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"836"</span>,
    <span class="hljs-string">"use"</span>: <span class="hljs-string">""</span>
  },
  <span class="hljs-string">"event_category"</span>: <span class="hljs-string">"Memory Scanner"</span>,
  <span class="hljs-string">"event_time"</span>: <span class="hljs-string">"Wed Sep  7 11:39:13 2022"</span>,
  <span class="hljs-string">"guid"</span>: <span class="hljs-string">"a098d87b-808a-42dd-8997-0d69355914e2"</span>,
  <span class="hljs-string">"image_name"</span>: <span class="hljs-string">"maelstrom.unsafe.x64.exe"</span>,
  <span class="hljs-string">"image_path"</span>: <span class="hljs-string">"<span class="hljs-subst">\\</span>Device<span class="hljs-subst">\\</span>HarddiskVolume11<span class="hljs-subst">\\</span>maelstrom<span class="hljs-subst">\\</span>agent<span class="hljs-subst">\\</span>stage0<span class="hljs-subst">\\</span>bin<span class="hljs-subst">\\</span>maelstrom.unsafe.x64.exe"</span>,
  <span class="hljs-string">"parent_procecess"</span>: <span class="hljs-number">18056</span>,
  <span class="hljs-string">"process_id"</span>: <span class="hljs-number">27184</span>
}</pre><h2>3.&nbsp; Conclusion</h2><p><a href="https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-memory-regions/" target="_blank" rel="noreferrer noopener">In the first part of this mini-series</a>, we covered anomalies within memory regions and found some ways to determine if that region had some nefarious qualities. In this post, we did the same thing for threads. There are many more of these techniques to add to something like this, but this will cover the low-hanging fruits.</p><p>As a bonus, here are some visualizations generated from Kibana based on the JSON gathered throughout this process, which are quite interesting—they show the general statistics with no implants running on a development machine. Make of it what you will.</p><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB15.png" alt="" class="wp-image-27911"><figcaption>Figure 14 Tree Map of Methods</figcaption></figure><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB16.png" alt="" class="wp-image-27912"><figcaption>Figure 15 Method to Process Name</figcaption></figure><figure class="wp-block-image size-full aligncenter"><img src="https://www.trustedsec.com/wp-content/uploads/2022/10/McgrathB17.png" alt="" class="wp-image-27913"><figcaption>Figure 16 No Results for RW to RX</figcaption></figure></div><div class="mb-p24 mt-p56 pt-p32 border-t first:border-t-none"><div class="w-full"><p id="share-label" class="text-xs font-mono mb-p16">Share</p><ul id="share-icons" class="flex items-center" aria-describedby="share-label"><li class="ml-p12"><a href="https://www.trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share URL" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-share"></use></svg></span><span class="sr-only">Share URL</span></a></li><li class="ml-p12"><a href="mailto:?subject=Check%20out%20this%20article%20from%20TrustedSec%21&amp;body=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Threads%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share via Email" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-email"></use></svg></span><span class="sr-only">Share via Email</span></a></li><li class="ml-p12"><a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" target="_blank" title="Share on Facebook" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-facebook"></use></svg></span><span class="sr-only">Share on Facebook</span></a></li><li class="ml-p12"><a href="http://twitter.com/share?text=Windows%20Processes%2C%20Nefarious%20Anomalies%2C%20and%20You%3A%20Threads%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads" title="Share on X" rel="nofollow" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-twitter"></use></svg></span><span class="sr-only">Share on X</span></a></li><li class="ml-p12"><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fwindows-processes-nefarious-anomalies-and-you-threads&amp;mini=true" target="_blank" title="Share on LinkedIn" data-target="https://trustedsec.com/blog/windows-processes-nefarious-anomalies-and-you-threads"><span class="inline-block"><svg role="presentation" class="c-icon fill-black hover:fill-gibson w-p24 h-p24 transition duration-300"><use xlink:href="/ui/icons.svg?1.26#icon-linkedin"></use></svg></span><span class="sr-only">Share on LinkedIn</span></a></li></ul></div></div></div></div></div></div></section></div>
		</main>

		
		




  
<div class="c-modal fixed inset-0 z-100" x-comp="modal" x-data="modal({id:'modal-component'})" x-show="$store.modal.show" x-trap="$store.modal.show" x-bind:aria-hidden="!$store.modal.show" @keydown="keyPress($event)" x-transition:enter="c-modal-enter" x-transition:enter-start="c-modal-enter-start" x-transition:enter-end="c-modal-enter-end" x-transition:leave="c-modal-leave" x-transition:leave-start="c-modal-leave-start" x-transition:leave-end="c-modal-leave-end" aria-hidden="true" style="display: none;">
    <div class="w-full h-full bg-overlay fixed inset-0 z-0" tabindex="-1">

    <div class="relative z-10 flex flex-col w-full h-full justify-center items-center p-p12 mq768:p-none">
      <div id="modal-component" class="c-modal-box relative outline-none false w-full m-p24 max-w-p768" :class="modalClass(true)" :tabindex="($store.modal.show) ? '-1' : false" :aria-labelledby="showHeading() ? 'modal-component-title' : false" :aria-label="getLabel()" @focus="activate()" aria-role="dialog" x-ref="dialog">
        
          
        
        
          <div class="c-content p-p32" tabindex="-1" x-ref="content"></div>
        
        <button class="absolute z-50 overflow-hidden w-p24 h-p24 flex items-center justify-center border-black border top-p24 right-p24 group hover:bg-black" @click="closeModal()">
          <svg role="presentation" class="c-icon h-p12 w-p12 group-hover:fill-white"><use xlink:href="/ui/icons.svg?1.26#icon-close"></use></svg>
          <span class="sr-only">Close</span>
        </button>
        <button x-show="$store.modal.transcript" class="text-btn text-white uppercase tracking-widest px-p8 py-p16" @click="showTranscript($event)" x-text="$store.modal.showTranscript ? 'Hide Transcript' : 'Show Transcript'" style="display: none;">Show Transcript</button>
      </div>
      <div x-show="$store.modal.showTranscript" class="relative -top-ms bg-white text-segment w-full max-w-p768 mx-auto overflow-auto px-sm false m-p24" :class="modalClass()" x-ref="transcript" style="display: none;">
        <div x-collapse.duration.700ms="" style="height: 0px; overflow: hidden;">
          <div class="py-p32 mq768:px-p32" id="modal-transcript" tabindex="0"></div>
        </div>
      </div>
    </div>

  </div>
  </div>
		<!-- Start cookieyes banner --> 
 
<!-- End cookieyes banner -->

		
	


</body></html>