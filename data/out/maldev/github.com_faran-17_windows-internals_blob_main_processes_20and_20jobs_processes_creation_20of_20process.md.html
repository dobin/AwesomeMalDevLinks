# https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md

<!DOCTYPE html><html lang="en" data-color-mode="auto" data-light-theme="light" data-dark-theme="dark" data-a11y-animated-images="system" data-a11y-link-underlines="true" class="js-focus-visible" data-js-focus-visible="" data-turbo-loaded="">

  <body class="logged-out env-production page-responsive" style="overflow-wrap: break-word; --dialog-scrollgutter: 31px;" data-dialog-scroll-optimized="">
    <div data-turbo-body="" class="logged-out env-production page-responsive" style="word-wrap: break-word;">
      <div id="__primerPortalRoot__" role="region" style="z-index: 1000; position: absolute; width: 100%;" data-turbo-permanent=""></div>
      

    <div class="position-relative header-wrapper js-header-wrapper ">
      <a href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#start-of-content" data-skip-target-assigned="false" class="px-2 py-4 color-bg-accent-emphasis color-fg-on-emphasis show-on-focus js-skip-to-content">Skip to content</a>

      <span data-view-component="true" class="progress-pjax-loader Progress position-fixed width-full">
    <span style="width: 0%;" data-view-component="true" class="Progress-item progress-pjax-loader-bar left-0 top-0 color-bg-accent-emphasis"></span>
</span>      
      
      <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/primer-react-css.09a94c9db6a9e074.module.css">
<link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/keyboard-shortcuts-dialog.0205351a430dbeb5.module.css">

<react-partial partial-name="keyboard-shortcuts-dialog" data-ssr="false" data-attempted-ssr="false" data-react-profiling="true" data-catalyst="" class="loaded">
  
  
  <div data-target="react-partial.reactRoot"><div class="d-none"></div></div>
</react-partial>





      

          

              








      <div data-view-component="true" class="js-stale-session-flash stale-session-flash flash flash-warn flash-full">
  
        <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
        <span class="js-stale-session-flash-signed-in">You signed in with another tab or window. <a class="Link--inTextBlock" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md">Reload</a> to refresh your session.</span>
        <span class="js-stale-session-flash-signed-out">You signed out in another tab or window. <a class="Link--inTextBlock" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md">Reload</a> to refresh your session.</span>
        <span class="js-stale-session-flash-switched">You switched accounts on another tab or window. <a class="Link--inTextBlock" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md">Reload</a> to refresh your session.</span>

    <button id="icon-button-c10604d9-5799-4e99-aec8-d623702ef89d" aria-labelledby="tooltip-28147304-9f5d-4f29-b7fb-e983330149cb" type="button" data-view-component="true" class="Button Button--iconOnly Button--invisible Button--medium flash-close js-flash-close">  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x Button-visual">
    <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
</svg>
</button><tool-tip id="tooltip-28147304-9f5d-4f29-b7fb-e983330149cb" for="icon-button-c10604d9-5799-4e99-aec8-d623702ef89d" popover="manual" data-direction="s" data-type="label" data-view-component="true" class="sr-only position-absolute" aria-hidden="true" role="tooltip"><slot></slot>Dismiss alert</tool-tip>


  
</div>
    </div>

  <div id="start-of-content" class="show-on-focus"></div>








    <div id="js-flash-container" class="flash-container" data-turbo-replace="">




  
    
<div class="flash flash-full   {{ className }}">
  <div>
    <button autofocus="" class="flash-close js-flash-close" type="button" aria-label="Dismiss this message">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
</svg>
    </button>
    <div aria-atomic="true" role="alert" class="js-flash-alert">
      
      <div>{{ message }}</div>

    </div>
  </div>
</div>
  
</div>


    






  <div class="application-main " data-commit-hovercards-enabled="" data-discussion-hovercards-enabled="" data-issue-and-pr-hovercards-enabled="" data-project-hovercards-enabled="">
        <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" class="">
    <main id="js-repo-pjax-container">
      
      






  

  <div id="repository-container-header" class="pt-3 hide-full-screen" style="background-color: var(--page-header-bgColor, var(--color-page-header-bg));" data-turbo-replace="">

      <div class="d-flex flex-nowrap flex-justify-end mb-3  px-3 px-lg-5" style="gap: 1rem;">

        <div class="flex-auto min-width-0 width-fit">
            
  <div class=" d-flex flex-wrap flex-items-center wb-break-word f3 text-normal">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-repo color-fg-muted mr-2">
    <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25a.25.25 0 0 1 .25-.25h3.5a.25.25 0 0 1 .25.25v3.25a.25.25 0 0 1-.4.2l-1.45-1.087a.249.249 0 0 0-.3 0L5.4 15.7a.25.25 0 0 1-.4-.2Z"></path>
</svg>
    
    <span class="author flex-self-stretch" itemprop="author">
      <a class="url fn" rel="author" data-hovercard-type="user" data-hovercard-url="/users/Faran-17/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Faran-17" aria-keyshortcuts="Alt+ArrowUp">
        Faran-17
</a>    </span>
    <span class="mx-1 flex-self-stretch color-fg-muted">/</span>
    <strong itemprop="name" class="mr-2 flex-self-stretch">
      <a data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" href="https://github.com/Faran-17/Windows-Internals">Windows-Internals</a>
    </strong>

    <span></span><span class="Label Label--secondary v-align-middle mr-1">Public</span>
  </div>


        </div>

        <div id="repository-details-container" class="flex-shrink-0" data-turbo-replace="" style="max-width: 70%;">
            <ul class="pagehead-actions flex-shrink-0 d-none d-md-inline" style="padding: 2px 0;">
    
      

  <li>
            <a href="https://github.com/login?return_to=%2FFaran-17%2FWindows-Internals" rel="nofollow" id="repository-details-watch-button" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;notification subscription menu watch&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="6ce1ccf05f39832bd096231b13b8f6e1e7b565d6ccc2c431fa6bfa1393c137a5" aria-label="You must be signed in to change notification settings" data-view-component="true" class="btn-sm btn" aria-describedby="tooltip-b42f9e80-3dc1-42be-b155-182cf4884e6e">    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-bell mr-2">
    <path d="M8 16a2 2 0 0 0 1.985-1.75c.017-.137-.097-.25-.235-.25h-3.5c-.138 0-.252.113-.235.25A2 2 0 0 0 8 16ZM3 5a5 5 0 0 1 10 0v2.947c0 .05.015.098.042.139l1.703 2.555A1.519 1.519 0 0 1 13.482 13H2.518a1.516 1.516 0 0 1-1.263-2.36l1.703-2.554A.255.255 0 0 0 3 7.947Zm5-3.5A3.5 3.5 0 0 0 4.5 5v2.947c0 .346-.102.683-.294.97l-1.703 2.556a.017.017 0 0 0-.003.01l.001.006c0 .002.002.004.004.006l.006.004.007.001h10.964l.007-.001.006-.004.004-.006.001-.007a.017.017 0 0 0-.003-.01l-1.703-2.554a1.745 1.745 0 0 1-.294-.97V5A3.5 3.5 0 0 0 8 1.5Z"></path>
</svg>Notifications
</a>    <tool-tip id="tooltip-b42f9e80-3dc1-42be-b155-182cf4884e6e" for="repository-details-watch-button" popover="manual" data-direction="s" data-type="description" data-view-component="true" class="sr-only position-absolute" role="tooltip"><slot></slot>You must be signed in to change notification settings</tool-tip>

  </li>

  <li>
          <a icon="repo-forked" id="fork-button" href="https://github.com/login?return_to=%2FFaran-17%2FWindows-Internals" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;repo details fork button&quot;,&quot;repository_id&quot;:555921024,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="da86fef0ff09492bc380601126b913b0076351cb926a8e70d10bc4acf4e0996b" data-view-component="true" class="btn-sm btn">    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-repo-forked mr-2">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>Fork
    <span id="repo-network-counter" data-pjax-replace="true" data-turbo-replace="true" title="59" data-view-component="true" class="Counter">59</span>
</a>
  </li>

  <li>
        <div data-view-component="true" class="BtnGroup d-flex">
        <a href="https://github.com/login?return_to=%2FFaran-17%2FWindows-Internals" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:555921024,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="ed3788e916f3c3628da49209b298e551118d1afae98624e5fa5c05cab6d96427" aria-label="You must be signed in to star a repository" data-view-component="true" class="tooltipped tooltipped-sw btn-sm btn">    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-star v-align-text-bottom d-inline-block mr-2">
    <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"></path>
</svg><span data-view-component="true" class="d-inline">
          Star
</span>          <span id="repo-stars-counter-star" aria-label="429 users starred this repository" data-singular-suffix="user starred this repository" data-plural-suffix="users starred this repository" data-turbo-replace="true" title="429" data-view-component="true" class="Counter js-social-count">429</span>
</a></div>
  </li>

</ul>

        </div>
      </div>

        <div id="responsive-meta-container" data-turbo-replace="">
</div>


          

  </div>
  



<turbo-frame id="repo-content-turbo-frame" target="_top" data-turbo-action="advance" class="">
    <div id="repo-content-pjax-container" class="repository-content ">
    



    
      
    








<react-app app-name="react-code-view" initial-path="/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md" style="display: block; min-height: calc(100vh - 64px);" data-attempted-ssr="false" data-ssr="false" data-lazy="false" data-alternate="false" data-data-router-enabled="false" data-react-profiling="true" data-catalyst="" class="loaded">
  
  
  <div data-target="react-app.reactRoot">   <button data-testid="header-permalink-button" data-hotkey="y,Shift+Y" data-hotkey-scope="read-only-cursor-text-area"></button><button data-hotkey="y,Shift+Y"></button><div><div class="prc-PageLayout-PageLayoutRoot--KH-d" style="--spacing: var(--spacing-none);"><div class="prc-PageLayout-PageLayoutWrapper-2BhU2" data-width="full"><div class="prc-PageLayout-PageLayoutContent-BneH9"><div tabindex="0" class="Box-sc-62in7e-0 jmjlbk"><div class="prc-PageLayout-PaneWrapper-pHPop ReposFileTreePane-module__Pane__rBZpI ReposFileTreePane-module__HidePane__VHAVt" data-is-hidden="false" data-position="start" data-sticky="true" style="--offset-header: 0px; --spacing-row: var(--spacing-none); --spacing-column: var(--spacing-none);"><div class="prc-PageLayout-HorizontalDivider-JLVqp prc-PageLayout-PaneHorizontalDivider-9tbnE" data-variant-regular="none" data-variant-narrow="none" data-position="start" style="--spacing-divider: var(--spacing-none); --spacing: var(--spacing-none);"></div><div class="prc-PageLayout-Pane-AyzHK" data-resizable="true" style="--spacing: var(--spacing-none); --pane-min-width: 256px; --pane-max-width: 1409px; --pane-width-size: var(--pane-width-large); --pane-width: 320px;" data-dragging="true"><div><div id="repos-file-tree" class="ReposFileTreePane-module__PaneContents__SJjfF"><div class="ReposFileTreePane-module__Box_1__PpIop"><div class="Box-sc-62in7e-0 fvNWEZ"><h2 class="use-tree-pane-module__Heading__s4QbZ prc-Heading-Heading-MtWFE"><button data-component="IconButton" type="button" data-testid="collapse-file-tree-button" aria-expanded="true" aria-controls="repos-file-tree" data-hotkey="Control+b" class="prc-Button-ButtonBase-9n-Xk position-relative ExpandFileTreeButton-module__expandButton__hDOcv fgColor-muted prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="medium" data-variant="invisible" aria-labelledby="_r_37_"><svg aria-hidden="true" focusable="false" class="octicon octicon-sidebar-expand" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="m4.177 7.823 2.396-2.396A.25.25 0 0 1 7 5.604v4.792a.25.25 0 0 1-.427.177L4.177 8.177a.25.25 0 0 1 0-.354Z"></path><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25H9.5v-13Zm12.5 13a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H11v13Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="se" aria-hidden="true" id="_r_37_" popover="auto">Collapse file tree</span><button data-testid="" data-hotkey="Control+b" data-hotkey-scope="read-only-cursor-text-area"></button></h2><h2 class="Heading-sc-1vc165i-0 dWfbpP">Files</h2></div><div class="ReposFileTreePane-module__Box_2__g74WI"><div class="ReposFileTreePane-module__Box_3__D6cTp"><button type="button" aria-haspopup="true" aria-expanded="false" tabindex="0" data-hotkey="w" aria-label="main branch" data-testid="anchor-button" class="prc-Button-ButtonBase-9n-Xk react-repos-tree-pane-ref-selector width-full ref-selector-class RefSelectorAnchoredOverlay-module__RefSelectorOverlayBtn__a3WK3" data-loading="false" data-size="medium" data-variant="default" id="ref-picker-repos-header-ref-selector" style="min-width: 0px;"><span data-component="buttonContent" data-align="center" class="prc-Button-ButtonContent-Iohp5"><span data-component="text" class="prc-Button-Label-FWkx3"><div class="RefSelectorAnchoredOverlay-module__RefSelectorOverlayContainer__yaf4p"><div class="RefSelectorAnchoredOverlay-module__RefSelectorOverlayHeader__XtXRG"><svg aria-hidden="true" focusable="false" class="octicon octicon-git-branch" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M9.5 3.25a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.493 2.493 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25Zm-6 0a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Zm8.25-.75a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z"></path></svg></div><div class="ref-selector-button-text-container RefSelectorAnchoredOverlay-module__RefSelectorBtnTextContainer__Di3rk"><span class="RefSelectorAnchoredOverlay-module__RefSelectorText__w_fmP">&nbsp;main</span></div></div></span><span data-component="trailingVisual" class="prc-Button-Visual-YNt2F prc-Button-VisualWrap-E4cnq"><svg aria-hidden="true" focusable="false" class="octicon octicon-triangle-down" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="m4.427 7.427 3.396 3.396a.25.25 0 0 0 .354 0l3.396-3.396A.25.25 0 0 0 11.396 7H4.604a.25.25 0 0 0-.177.427Z"></path></svg></span></span></button><button data-testid="ref-selector-hotkey-button" data-hotkey="w" data-hotkey-scope="read-only-cursor-text-area"></button></div><div class="ReposFileTreePane-module__Box_4__DG4pa"><button data-component="IconButton" type="button" data-hotkey="/" class="prc-Button-ButtonBase-9n-Xk SearchButton-module__IconButton__SBlqu prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="medium" data-variant="default" aria-labelledby="_r_3d_"><svg aria-hidden="true" focusable="false" class="octicon octicon-search" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215ZM11.5 7a4.499 4.499 0 1 0-8.997 0A4.499 4.499 0 0 0 11.5 7Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="nw" aria-hidden="true" id="_r_3d_" popover="auto">Search this repository</span><button data-testid="" data-hotkey="/" data-hotkey-scope="read-only-cursor-text-area"></button></div></div></div><div class="Box-sc-62in7e-0 ReposFileTreePane-module__FileResultsList__zmSnM"><span class="TextInput__StyledTextInput-sc-ttxlvl-0 d-flex FileResultsList-module__FilesSearchBox__ivVkc TextInput-wrapper prc-components-TextInputWrapper-Hpdqi prc-components-TextInputBaseWrapper-wY-n0" data-leading-visual="true" data-trailing-visual="true" aria-busy="false"><span class="TextInput-icon" id="_r_3f_" aria-hidden="true"><svg aria-hidden="true" focusable="false" class="octicon octicon-search" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215ZM11.5 7a4.499 4.499 0 1 0-8.997 0A4.499 4.499 0 0 0 11.5 7Z"></path></svg></span><input aria-label="Go to file" role="combobox" aria-controls="file-results-list" aria-expanded="false" aria-haspopup="dialog" autocorrect="off" spellcheck="false" placeholder="Go to file" aria-describedby="_r_3f_ _r_3g_" data-component="input" class="prc-components-Input-IwWrt" type="text" value=""><span class="TextInput-icon" id="_r_3g_" aria-hidden="true"></span></span></div><button data-testid="" data-hotkey="t,Shift+T" data-hotkey-scope="read-only-cursor-text-area"></button><button data-hotkey="t,Shift+T"></button><div class="ReposFileTreePane-module__Box_5__Zy_o6"><div><div class="react-tree-show-tree-items"><div class="ReposFileTreeView-module__Box__vkb5W" data-testid="repos-file-tree-container"></div></div></div></div></div></div></div><div class="prc-PageLayout-VerticalDivider-9QRmK prc-PageLayout-PaneVerticalDivider-le57g" data-variant-narrow="none" data-variant-regular="line" data-variant-wide="line" data-position="start" style="--spacing: var(--spacing-none);"><div class="prc-PageLayout-DraggableHandle-9s6B4" role="slider" aria-label="Draggable pane splitter" aria-valuemin="256" aria-valuemax="1409" aria-valuenow="320" aria-valuetext="Pane width 320 pixels" tabindex="0"></div></div></div></div><div class="prc-PageLayout-ContentWrapper-gR9eG" data-is-hidden-narrow="true" data-dragging="true"><div class="prc-PageLayout-Content-xWL-A" data-width="full" style="--spacing: var(--spacing-none);"><div data-selector="repos-split-pane-content" tabindex="0" class="Box-sc-62in7e-0 cybVuK"><div class="Box-sc-62in7e-0 gSjuRy"><div class="container CodeViewHeader-module__Box__JkPOb"><div class="tmp-px-3 tmp-pt-3 pb-0" id="StickyHeader"><div class="CodeViewHeader-module__Box_1__SbNDV"><div class="CodeViewHeader-module__Box_2__TB46f"><div class="CodeViewHeader-module__Box_6__qKUtX"><div class="Breadcrumb-module__container__Vxvev Breadcrumb-module__lg__Rjz0A"><div data-testid="breadcrumbs-filename" class="Breadcrumb-module__filename__equZR"><span class="Breadcrumb-module__separator__eNwsI Breadcrumb-module__lg__Rjz0A" aria-hidden="true">/</span><h1 class="Breadcrumb-module__filenameHeading__MNMtw Breadcrumb-module__lg__Rjz0A prc-Heading-Heading-MtWFE" tabindex="-1" id="file-name-id-wide">Creation Of Process.md</h1></div><button data-component="IconButton" type="button" class="prc-Button-ButtonBase-9n-Xk ml-2 prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="small" data-variant="invisible" aria-labelledby="_r_3l_"><svg aria-hidden="true" focusable="false" class="octicon octicon-copy" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg></button><span class="CopyToClipboardButton-module__tooltip__BhMvU prc-TooltipV2-Tooltip-tLeuB" data-direction="nw" aria-label="Copy path" aria-hidden="true" id="_r_3l_" popover="auto">Copy path</span></div></div><div class="react-code-view-header-element--wide"><div class="CodeViewHeader-module__Box_7___0R6c"><div class="d-flex gap-2"> <button type="button" data-hotkey="b,Shift+B,Control+/ Control+b" class="prc-Button-ButtonBase-9n-Xk Button__StyledButtonComponent-sc-vqy3e4-0 hfSsoj NavigationMenu-module__Button__LpKgm" data-loading="false" data-no-visuals="true" data-size="medium" data-variant="default"><span data-component="buttonContent" data-align="center" class="prc-Button-ButtonContent-Iohp5"><span data-component="text" class="prc-Button-Label-FWkx3">Blame</span></span></button><button data-testid="" data-hotkey="b,Shift+B,Control+/ Control+b" data-hotkey-scope="read-only-cursor-text-area"></button><button data-component="IconButton" type="button" data-testid="more-file-actions-button-nav-menu-wide" aria-haspopup="true" aria-expanded="false" tabindex="0" class="prc-Button-ButtonBase-9n-Xk js-blob-dropdown-click NavigationMenu-module__IconButton__HpX3G prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="medium" data-variant="default" aria-labelledby="_r_2d_" id="_r_2b_"><svg aria-hidden="true" focusable="false" class="octicon octicon-kebab-horizontal" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M8 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM1.5 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm13 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="nw" aria-hidden="true" id="_r_2d_" popover="auto">More file actions</span> </div></div></div><div class="react-code-view-header-element--narrow"><div class="CodeViewHeader-module__Box_7___0R6c"><div class="d-flex gap-2"> <button type="button" data-hotkey="b,Shift+B,Control+/ Control+b" class="prc-Button-ButtonBase-9n-Xk Button__StyledButtonComponent-sc-vqy3e4-0 hfSsoj NavigationMenu-module__Button__LpKgm" data-loading="false" data-no-visuals="true" data-size="medium" data-variant="default"><span data-component="buttonContent" data-align="center" class="prc-Button-ButtonContent-Iohp5"><span data-component="text" class="prc-Button-Label-FWkx3">Blame</span></span></button><button data-testid="" data-hotkey="b,Shift+B,Control+/ Control+b" data-hotkey-scope="read-only-cursor-text-area"></button><button data-component="IconButton" type="button" data-testid="more-file-actions-button-nav-menu-narrow" aria-haspopup="true" aria-expanded="false" tabindex="0" class="prc-Button-ButtonBase-9n-Xk js-blob-dropdown-click NavigationMenu-module__IconButton__HpX3G prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="medium" data-variant="default" aria-labelledby="_r_2i_" id="_r_2g_"><svg aria-hidden="true" focusable="false" class="octicon octicon-kebab-horizontal" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M8 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM1.5 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm13 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="nw" aria-hidden="true" id="_r_2i_" popover="auto">More file actions</span> </div></div></div></div></div></div></div></div><div class="Box-sc-62in7e-0 jyTWxL react-code-view-bottom-padding"> <div class="BlobTopBanners-module__Box__v_nvx"></div>   </div><div class="Box-sc-62in7e-0 jyTWxL">   <button data-testid="" data-hotkey="r,Shift+R" data-hotkey-scope="read-only-cursor-text-area"></button><button data-hotkey="r,Shift+R"></button><div class="d-flex flex-column border rounded-2 tmp-mb-3 pl-1"><div class="LatestCommit-module__Box__B25ZT"><h2 class="sr-only ScreenReaderHeading-module__userSelectNone__rwWIk prc-Heading-Heading-MtWFE" data-testid="screen-reader-heading">Latest commit</h2><div data-testid="latest-commit" class="LatestCommit-module__Box_1__YkEgg"><div class="CommitAttribution-module__CommitAttributionContainer__I_rfs"><div data-testid="author-avatar" class="Box-sc-62in7e-0 AuthorAvatar-module__AuthorAvatarContainer__n0MVc"><a class="Link__StyledLink-sc-1syctfj-0 prc-Link-Link-9ZwDx" href="https://github.com/Faran-17" data-testid="avatar-icon-link" data-hovercard-url="/users/Faran-17/hovercard" data-hovercard-type="user" octo-click="hovercard-link-click" octo-dimensions="link_type:self" aria-keyshortcuts="Alt+ArrowUp"><img data-component="Avatar" class="Box-sc-62in7e-0 kglDHV AuthorAvatar-module__authorAvatarImage__a3R8x prc-Avatar-Avatar-0xaUi" alt="Faran-17" width="20" height="20" data-testid="github-avatar" aria-label="Faran-17" src="https://avatars.githubusercontent.com/u/59355783?v=4&amp;size=40" style="--avatarSize-regular: 20px;"></a><a class="Link__StyledLink-sc-1syctfj-0 iIGVMW AuthorAvatar-module__authorHoverableLink__MHTT8 prc-Link-Link-9ZwDx" data-muted="true" href="https://github.com/Faran-17/Windows-Internals/commits?author=Faran-17" aria-label="commits by Faran-17" data-hovercard-url="/users/Faran-17/hovercard" data-hovercard-type="user" octo-click="hovercard-link-click" octo-dimensions="link_type:self" aria-keyshortcuts="Alt+ArrowUp">Faran-17</a></div><span class=""></span></div><div class="d-none d-sm-flex LatestCommit-module__Box_2__pSPKJ"><div class="Truncate flex-items-center f5"><span class="Text__StyledText-sc-1klmep6-0 Truncate-text prc-Text-Text-9mHv3" data-testid="latest-commit-html"><a href="https://github.com/Faran-17/Windows-Internals/commit/dbf67595775691f55af5419646827e27d532b086" class="Link--secondary" data-pjax="true" data-hovercard-url="/Faran-17/Windows-Internals/commit/dbf67595775691f55af5419646827e27d532b086/hovercard" aria-keyshortcuts="Alt+ArrowUp">Update Creation Of Process.md</a></span></div></div><span class="d-flex d-sm-none fgColor-muted f6"><relative-time tense="past" datetime="2023-09-13T10:46:43.000Z" title="Sep 13, 2023, 6:46 AM EDT">3 years agoSep 13, 2023</relative-time></span></div><div class="d-flex flex-shrink-0 gap-2"><div data-testid="latest-commit-details" class="d-none d-sm-flex flex-items-center"><span class="d-flex flex-nowrap fgColor-muted f6"><a class="Link--secondary prc-Link-Link-9ZwDx" aria-label="Commit dbf6759" data-hovercard-url="/Faran-17/Windows-Internals/commit/dbf67595775691f55af5419646827e27d532b086/hovercard" data-hovercard-type="commit" octo-click="hovercard-link-click" octo-dimensions="link_type:self" aria-keyshortcuts="Alt+ArrowUp" href="https://github.com/Faran-17/Windows-Internals/commit/dbf67595775691f55af5419646827e27d532b086" data-discover="true">dbf6759</a>&nbsp;·&nbsp;<relative-time tense="past" datetime="2023-09-13T10:46:43.000Z" title="Sep 13, 2023, 6:46 AM EDT">3 years agoSep 13, 2023</relative-time></span></div><div class="d-flex gap-2"><h2 class="sr-only ScreenReaderHeading-module__userSelectNone__rwWIk prc-Heading-Heading-MtWFE" data-testid="screen-reader-heading">History</h2><a href="https://github.com/Faran-17/Windows-Internals/commits/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md" class="prc-Button-ButtonBase-9n-Xk d-none d-lg-flex LinkButton-module__linkButton__nFnov flex-items-center fgColor-default" data-loading="false" data-size="small" data-variant="invisible"><span data-component="buttonContent" data-align="center" class="prc-Button-ButtonContent-Iohp5"><span data-component="leadingVisual" class="prc-Button-Visual-YNt2F prc-Button-VisualWrap-E4cnq"><svg aria-hidden="true" focusable="false" class="octicon octicon-history" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="m.427 1.927 1.215 1.215a8.002 8.002 0 1 1-1.6 5.685.75.75 0 1 1 1.493-.154 6.5 6.5 0 1 0 1.18-4.458l1.358 1.358A.25.25 0 0 1 3.896 6H.25A.25.25 0 0 1 0 5.75V2.104a.25.25 0 0 1 .427-.177ZM7.75 4a.75.75 0 0 1 .75.75v2.992l2.028.812a.75.75 0 0 1-.557 1.392l-2.5-1A.751.751 0 0 1 7 8.25v-3.5A.75.75 0 0 1 7.75 4Z"></path></svg></span><span data-component="text" class="prc-Button-Label-FWkx3"><span class="fgColor-default">History</span></span></span></a><div class="d-sm-none"><button data-component="IconButton" type="button" aria-pressed="false" aria-expanded="false" data-testid="latest-commit-details-toggle" class="prc-Button-ButtonBase-9n-Xk LatestCommit-module__IconButton__mkJr_ prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="small" data-variant="invisible" aria-labelledby="_r_3o_"><svg aria-hidden="true" focusable="false" class="octicon octicon-ellipsis" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M0 5.75C0 4.784.784 4 1.75 4h12.5c.966 0 1.75.784 1.75 1.75v4.5A1.75 1.75 0 0 1 14.25 12H1.75A1.75 1.75 0 0 1 0 10.25ZM12 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM7 8a1 1 0 1 0 2 0 1 1 0 0 0-2 0ZM4 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="s" aria-hidden="true" id="_r_3o_" popover="auto">Open commit details</span></div><div class="d-flex d-lg-none"><a aria-label="View commit history for this file." href="https://github.com/Faran-17/Windows-Internals/commits/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md" class="prc-Button-ButtonBase-9n-Xk LinkButton-module__linkButton__nFnov flex-items-center fgColor-default" data-loading="false" data-size="small" data-variant="invisible" aria-describedby="_r_2l_"><span data-component="buttonContent" data-align="center" class="prc-Button-ButtonContent-Iohp5"><span data-component="leadingVisual" class="prc-Button-Visual-YNt2F prc-Button-VisualWrap-E4cnq"><svg aria-hidden="true" focusable="false" class="octicon octicon-history" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="m.427 1.927 1.215 1.215a8.002 8.002 0 1 1-1.6 5.685.75.75 0 1 1 1.493-.154 6.5 6.5 0 1 0 1.18-4.458l1.358 1.358A.25.25 0 0 1 3.896 6H.25A.25.25 0 0 1 0 5.75V2.104a.25.25 0 0 1 .427-.177ZM7.75 4a.75.75 0 0 1 .75.75v2.992l2.028.812a.75.75 0 0 1-.557 1.392l-2.5-1A.751.751 0 0 1 7 8.25v-3.5A.75.75 0 0 1 7.75 4Z"></path></svg></span></span></a><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="s" role="tooltip" aria-hidden="true" id="_r_2l_" popover="auto">History</span></div></div></div></div></div><div class="d-flex flex-row"><div class="container BlobViewContent-module__blobContainer__DtH2d"><div class="react-code-size-details-banner BlobViewContent-module__codeSizeDetails__e5sUw"><div class="react-code-size-details-banner CodeSizeDetails-module__Box__VcD6l"><div class="text-mono CodeSizeDetails-module__Box_1__GVxQL"><div data-testid="blob-size" class="CodeSizeDetails-module__Truncate_1__lE93V prc-Truncate-Truncate-2G1eo" data-inline="true" title="26.8 KB" style="--truncate-max-width: 100%;"><span>461 lines (358 loc) · 26.8 KB</span></div></div></div></div><div class="react-blob-view-header-sticky BlobViewContent-module__stickyHeader__VwxB5" id="repos-sticky-header"><div class="BlobViewHeader-module__Box__yhm9u"><div class="react-blob-sticky-header"><div class="Box-sc-62in7e-0 cVyjDu"><div class="FileNameStickyHeader-module__Box_5__dmNXA"><div class="Breadcrumb-module__container__Vxvev Breadcrumb-module__md__Wb1Gs"><div data-testid="breadcrumbs-filename" class="Breadcrumb-module__filename__equZR"><span class="Breadcrumb-module__separator__eNwsI Breadcrumb-module__md__Wb1Gs" aria-hidden="true">/</span><h1 class="Breadcrumb-module__filenameHeading__MNMtw Breadcrumb-module__md__Wb1Gs prc-Heading-Heading-MtWFE" tabindex="-1" id="sticky-file-name-id">Creation Of Process.md</h1></div></div><button type="button" class="prc-Button-ButtonBase-9n-Xk Button__StyledButtonComponent-sc-vqy3e4-0 FileNameStickyHeader-module__Button__LSEU_ FileNameStickyHeader-module__GoToTopButton__nxAFn" data-loading="false" data-size="small" data-variant="invisible"><span data-component="buttonContent" data-align="center" class="prc-Button-ButtonContent-Iohp5"><span data-component="leadingVisual" class="prc-Button-Visual-YNt2F prc-Button-VisualWrap-E4cnq"><svg aria-hidden="true" focusable="false" class="octicon octicon-arrow-up" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M3.47 7.78a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0l4.25 4.25a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018L9 4.81v7.44a.75.75 0 0 1-1.5 0V4.81L4.53 7.78a.75.75 0 0 1-1.06 0Z"></path></svg></span><span data-component="text" class="prc-Button-Label-FWkx3">Top</span></span></button></div></div></div><div class="BlobViewHeader-module__Box_1__VEmuQ BlobViewHeader-module__Box_1_stickied__L3NvW"><h2 class="sr-only ScreenReaderHeading-module__userSelectNone__rwWIk prc-Heading-Heading-MtWFE" data-testid="screen-reader-heading">File metadata and controls</h2><div class="BlobViewHeader-module__Box_2__icUs2"><ul aria-label="File view" class="prc-SegmentedControl-SegmentedControl-lqIXp BlobTabButtons-module__SegmentedControl__jen2u" data-variant="default" data-size="small"><li class="prc-SegmentedControl-Item-tSCQh" data-selected=""><button aria-current="true" class="prc-SegmentedControl-Button-E48xz" type="button" data-hotkey="Control+/ Control+p" style="--separator-color: transparent;"><span class="prc-SegmentedControl-Content-1COlk segmentedControl-content"><div class="prc-SegmentedControl-Text-7S2y2 segmentedControl-text" data-text="Preview">Preview</div></span></button></li><li class="prc-SegmentedControl-Item-tSCQh"><button aria-current="false" class="prc-SegmentedControl-Button-E48xz" type="button" data-hotkey="Control+/ Control+c" style="--separator-color: var(--borderColor-default);"><span class="prc-SegmentedControl-Content-1COlk segmentedControl-content"><div class="prc-SegmentedControl-Text-7S2y2 segmentedControl-text" data-text="Code">Code</div></span></button></li><li class="prc-SegmentedControl-Item-tSCQh"><button aria-current="false" class="prc-SegmentedControl-Button-E48xz" type="button" data-hotkey="b,Shift+B,Control+/ Control+b" style="--separator-color: var(--borderColor-default);"><span class="prc-SegmentedControl-Content-1COlk segmentedControl-content"><div class="prc-SegmentedControl-Text-7S2y2 segmentedControl-text" data-text="Blame">Blame</div></span></button></li></ul><button data-testid="" data-hotkey="Control+/ Control+c" data-hotkey-scope="read-only-cursor-text-area"></button><button data-testid="" data-hotkey="b,Shift+B,Control+/ Control+b" data-hotkey-scope="read-only-cursor-text-area"></button><button data-testid="" data-hotkey="Control+/ Control+p" data-hotkey-scope="read-only-cursor-text-area"></button><div class="react-code-size-details-in-header CodeSizeDetails-module__Box__VcD6l"><div class="text-mono CodeSizeDetails-module__Box_1__GVxQL"><div data-testid="blob-size" class="CodeSizeDetails-module__Truncate_1__lE93V prc-Truncate-Truncate-2G1eo" data-inline="true" title="26.8 KB" style="--truncate-max-width: 100%;"><span>461 lines (358 loc) · 26.8 KB</span></div></div></div></div><div class="BlobViewHeader-module__Box_3__ng6v2"><button data-testid="" data-hotkey="Control+Shift+>" data-hotkey-scope="read-only-cursor-text-area"></button><button data-hotkey="Control+Shift+>"></button><button data-testid="" data-hotkey="Control+Shift+<" data-hotkey-scope="read-only-cursor-text-area"></button><button data-hotkey="Control+Shift+<"></button><div class="react-blob-header-edit-and-raw-actions BlobViewHeader-module__Box_4__J4Y4W"><div class="prc-ButtonGroup-ButtonGroup-vFUrY"><div><a href="https://github.com/Faran-17/Windows-Internals/raw/refs/heads/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md" data-testid="raw-button" data-hotkey="Control+/ Control+r" class="prc-Button-ButtonBase-9n-Xk LinkButton-module__linkButton__nFnov BlobViewHeader-module__LinkButton__X9kx2" data-loading="false" data-no-visuals="true" data-size="small" data-variant="default"><span data-component="buttonContent" data-align="center" class="prc-Button-ButtonContent-Iohp5"><span data-component="text" class="prc-Button-Label-FWkx3">Raw</span></span></a></div><div><button data-component="IconButton" type="button" data-testid="copy-raw-button" data-hotkey="Control+Shift+C" class="prc-Button-ButtonBase-9n-Xk prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="small" data-variant="default" aria-labelledby="_r_2t_"><svg aria-hidden="true" focusable="false" class="octicon octicon-copy" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="n" aria-hidden="true" id="_r_2t_" popover="auto">Copy raw file</span></div><div><button data-component="IconButton" type="button" data-testid="download-raw-button" data-hotkey="Control+Shift+S" sx="[object Object]" class="prc-Button-ButtonBase-9n-Xk prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="small" data-variant="default" aria-labelledby="_r_2v_"><svg aria-hidden="true" focusable="false" class="octicon octicon-download" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M2.75 14A1.75 1.75 0 0 1 1 12.25v-2.5a.75.75 0 0 1 1.5 0v2.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-2.5a.75.75 0 0 1 1.5 0v2.5A1.75 1.75 0 0 1 13.25 14Z"></path><path d="M7.25 7.689V2a.75.75 0 0 1 1.5 0v5.689l1.97-1.969a.749.749 0 1 1 1.06 1.06l-3.25 3.25a.749.749 0 0 1-1.06 0L4.22 6.78a.749.749 0 1 1 1.06-1.06l1.97 1.969Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="n" aria-hidden="true" id="_r_2v_" popover="auto">Download raw file</span></div></div><button data-testid="raw-button-shortcut" data-hotkey="Control+/ Control+r" data-hotkey-scope="read-only-cursor-text-area"></button><button data-testid="copy-raw-button-shortcut" data-hotkey="Control+Shift+C" data-hotkey-scope="read-only-cursor-text-area"></button><button data-testid="download-raw-button-shortcut" data-hotkey="Control+Shift+S" data-hotkey-scope="read-only-cursor-text-area"></button></div><button data-component="IconButton" type="button" aria-pressed="false" class="prc-Button-ButtonBase-9n-Xk IconButton__StyledIconButton-sc-i53dt6-0 fvatuQ TableOfContents-module__IconButton__jrlNM prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="small" data-variant="invisible" aria-labelledby="_r_31_"><svg aria-hidden="true" focusable="false" class="octicon octicon-list-unordered" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M5.75 2.5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2 14a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm1-6a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM2 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="n" aria-hidden="true" id="_r_31_" popover="auto">Outline</span><div class="react-blob-header-edit-and-raw-actions-combined"><button data-component="IconButton" type="button" title="More file actions" data-testid="more-file-actions-button" aria-haspopup="true" aria-expanded="false" tabindex="0" class="prc-Button-ButtonBase-9n-Xk js-blob-dropdown-click BlobViewHeader-module__IconButton__XrMQY prc-Button-IconButton-fyge7" data-loading="false" data-no-visuals="true" data-size="small" data-variant="invisible" aria-labelledby="_r_35_" id="_r_33_"><svg aria-hidden="true" focusable="false" class="octicon octicon-kebab-horizontal" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" display="inline-block" overflow="visible" style="vertical-align: text-bottom;"><path d="M8 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM1.5 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm13 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path></svg></button><span class="prc-TooltipV2-Tooltip-tLeuB" data-direction="nw" aria-hidden="true" id="_r_35_" popover="auto">Edit and raw actions</span></div></div></div></div><div></div></div><div class="BlobViewContent-module__blobContentWrapper__JS0W6"><section aria-labelledby="file-name-id-wide file-name-id-mobile" class="Box-sc-62in7e-0 iZiBDT"><div class="Box-sc-62in7e-0 lhfNqO js-snippet-clipboard-copy-unpositioned undefined" data-hpc="true"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">Summary</h1><a id="user-content-summary" class="anchor" aria-label="Permalink: Summary" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#summary"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In this blog, we will take a deep dive inside on how a normal process is created in a Windows environment. We will start by writing a short code to create a simple process then debug it via debugger to understand it's internal working and also we will be taking a look at how to create a process via NTAPIs.</p>
<p dir="auto">Note - All the references, credits and codes will mentioned in this blog.</p>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">Index</h1><a id="user-content-index" class="anchor" aria-label="Permalink: Index" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#index"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ol dir="auto">
<li><strong><a href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#process-creation-via-c">Process Creation Via C++</a></strong></li>
<li><strong><a href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#static-analysis">Static Analysis</a></strong></li>
<li><strong><a href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#x64dbg-analysis">X64dbg Analysis</a></strong></li>
<li><strong><a href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#creating-process-via-ntapis">Process Creatia Via NTAPIs</a></strong></li>
</ol>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">Process Creation Via C++</h1><a id="user-content-process-creation-via-c" class="anchor" aria-label="Permalink: Process Creation Via C++" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#process-creation-via-c"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">I wrote a blog a while go on the overview of how a process is created inside a Windows environment, you can read it <strong><a href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Overview%20of%20process%20creation.md">here</a></strong>. In there I tried to explain the general overview of the whole process of creation of process(no puns intended). Let's take a deep dive. Below here is a simple C++ code that will spawn <strong>notepad.exe</strong> process. (The code is stored <strong><a href="https://github.com/Faran-17/Windows-Internals/blob/main/codes/Processes%20and%20Jobs/Create_Process.cpp">here</a></strong>)</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>windows.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>iostream<span class="pl-pds">&gt;</span></span>

<span class="pl-k">int</span> <span class="pl-en">main</span>() {
    STARTUPINFO si = {};
    PROCESS_INFORMATION pi = {};

    <span class="pl-c"><span class="pl-c">//</span> Path to the executable</span>
    LPCWSTR notepadPath = <span class="pl-s"><span class="pl-pds">L"</span>C:<span class="pl-cce">\\</span>Windows<span class="pl-cce">\\</span>System32<span class="pl-cce">\\</span>notepad.exe<span class="pl-pds">"</span></span>;

    <span class="pl-k">if</span> (<span class="pl-c1">CreateProcess</span>(notepadPath, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">FALSE</span>, <span class="pl-c1">0</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, &amp;si, &amp;pi)) {
        std::wcout &lt;&lt; <span class="pl-s"><span class="pl-pds">L"</span>Process ID (PID): <span class="pl-pds">"</span></span> &lt;&lt; pi.<span class="pl-smi">dwProcessId</span> &lt;&lt; std::endl;

        <span class="pl-c"><span class="pl-c">//</span> Close process and thread handles</span>
        <span class="pl-c1">CloseHandle</span>(pi.<span class="pl-smi">hProcess</span>);
        <span class="pl-c1">CloseHandle</span>(pi.<span class="pl-smi">hThread</span>);
    }
    <span class="pl-k">else</span> {
        std::cerr &lt;&lt; <span class="pl-s"><span class="pl-pds">"</span>CreateProcess failed. Error: <span class="pl-pds">"</span></span> &lt;&lt; <span class="pl-c1">GetLastError</span>() &lt;&lt; std::endl;
    }

    <span class="pl-k">return</span> <span class="pl-c1">0</span>;
}</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="#include <windows.h>
#include <iostream>

int main() {
    STARTUPINFO si = {};
    PROCESS_INFORMATION pi = {};

    // Path to the executable
    LPCWSTR notepadPath = L&quot;C:\\Windows\\System32\\notepad.exe&quot;;

    if (CreateProcess(notepadPath, NULL, NULL, NULL, FALSE, 0, NULL, NULL, &amp;si, &amp;pi)) {
        std::wcout << L&quot;Process ID (PID): &quot; << pi.dwProcessId << std::endl;

        // Close process and thread handles
        CloseHandle(pi.hProcess);
        CloseHandle(pi.hThread);
    }
    else {
        std::cerr << &quot;CreateProcess failed. Error: &quot; << GetLastError() << std::endl;
    }

    return 0;
}" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">The above code uses the basics API called <strong><a href="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessw" rel="nofollow">CreateProcess</a></strong>, which is used by Windows to create a process and malwares to create a malicious process. Here is the structure of the API.</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>BOOL <span class="pl-en">CreateProcessW</span>(
  [in, optional]      LPCWSTR               lpApplicationName,
  [in, out, optional] LPWSTR                lpCommandLine,
  [in, optional]      LPSECURITY_ATTRIBUTES lpProcessAttributes,
  [in, optional]      LPSECURITY_ATTRIBUTES lpThreadAttributes,
  [in]                BOOL                  bInheritHandles,
  [in]                DWORD                 dwCreationFlags,
  [in, optional]      LPVOID                lpEnvironment,
  [in, optional]      LPCWSTR               lpCurrentDirectory,
  [in]                LPSTARTUPINFOW        lpStartupInfo,
  [out]               LPPROCESS_INFORMATION lpProcessInformation
);</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="BOOL CreateProcessW(
  [in, optional]      LPCWSTR               lpApplicationName,
  [in, out, optional] LPWSTR                lpCommandLine,
  [in, optional]      LPSECURITY_ATTRIBUTES lpProcessAttributes,
  [in, optional]      LPSECURITY_ATTRIBUTES lpThreadAttributes,
  [in]                BOOL                  bInheritHandles,
  [in]                DWORD                 dwCreationFlags,
  [in, optional]      LPVOID                lpEnvironment,
  [in, optional]      LPCWSTR               lpCurrentDirectory,
  [in]                LPSTARTUPINFOW        lpStartupInfo,
  [out]               LPPROCESS_INFORMATION lpProcessInformation
);" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">Let's go throught the parameters.</p>
<ul dir="auto">
<li><strong>lpApplicationName</strong> is the name of the process to be created and should have a full path to the process executable. In this example, we can see that it is <strong>notepadPath</strong> variable as a parameter and also this variable is declared above with the full path of the notepad.exe
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c"><span class="pl-c">//</span> Path to the executable</span>
LPCWSTR notepadPath = <span class="pl-s"><span class="pl-pds">L"</span>C:<span class="pl-cce">\\</span>Windows<span class="pl-cce">\\</span>System32<span class="pl-cce">\\</span>notepad.exe<span class="pl-pds">"</span></span>;</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="// Path to the executable
LPCWSTR notepadPath = L&quot;C:\\Windows\\System32\\notepad.exe&quot;;" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
</li>
<li><strong><code>lpCommandLine</code></strong> is the command line arguments of a process that can be decalred and passed. This is optional so it is <strong>NULL</strong>.</li>
<li>The <strong><code>lpProcessAttributes</code></strong> is a pointer to the <strong><a href="https://learn.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)" rel="nofollow">SECURITY_ATTRIBUTES</a></strong> structure that determines whether the returned handle to the new process object can be inherited by child processes. If lpProcessAttributes is <strong>NULL</strong>, the handle cannot be inherited.</li>
<li>The <strong><code>lpThreadAttributes</code></strong> is the same as <strong>lpProcessAttributes</strong>, declared as <strong>NULL</strong>.</li>
<li>If <strong><code>bInheritHandles</code></strong> is TRUE, each inheritable handle in the calling process is inherited by the new process. Here it is declared <strong>FALSE</strong>, which means the handles are not inherited.</li>
<li>The <strong><code>dwCreationFlags</code></strong> controls the priority class and the creation of the process. Here are the list of values for reference(<strong>(here)[<a href="https://learn.microsoft.com/en-us/windows/win32/procthread/process-creation-flags" rel="nofollow">https://learn.microsoft.com/en-us/windows/win32/procthread/process-creation-flags</a>]</strong>). The flag is decalred with a value of 0.</li>
<li>The <strong><code>lpEnvironment</code></strong> parameter is a pointer to the environment block for the new process. The parameter is declared <strong>NULL</strong>, the new process uses the environment of the calling process.</li>
<li>The <strong><code>lpCurrentDirectory</code></strong> is the full path to the directory of the process. It is declares as <strong>NULL</strong>, which means the process will have the same current drive and directory as the calling process. Also we don't need the pull path as we've already declared the full path of notepad.exe</li>
<li>The <strong><code>lpStartupInfo</code></strong> contains the pointer to the <strong><a href="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa" rel="nofollow">STARTUPINFO</a></strong> structure which is used to specify main window properties if a new window is created for the new process. Declaring it's structure in the code.
<div class="snippet-clipboard-content notranslate position-relative overflow-auto"><pre class="notranslate"><code>STARTUPINFO si = {};
</code></pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="STARTUPINFO si = {};" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
</li>
<li>The <strong><code>lpProcessInformation</code></strong> points to the <strong><a href="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-process_information" rel="nofollow">PROCESS_INFORMATION</a></strong> structure which contains the information about a newly created process and its primary thread. Declaring it's structure in the code.
<div class="snippet-clipboard-content notranslate position-relative overflow-auto"><pre class="notranslate"><code>PROCESS_INFORMATION pi = {};
</code></pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="PROCESS_INFORMATION pi = {};" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
</li>
</ul>
<p dir="auto">Now we compile the code in Release mode and double-click on the generated executable.<br>
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266386025-f43f7ead-889a-42c9-ac65-38c2dd191e67.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjYzODYwMjUtZjQzZjdlYWQtODg5YS00MmM5LWFjNjUtMzhjMmRkMTkxZTY3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTk1NDZhYmZhZTk5ZWUyZGU4MzVkNmE2NGUyNDEzMDUyY2QxNGFkMTc2ZWEyZjI2NDAyMTNmNTYzMzBiNDA4YmQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.HQ89KW1bf29OIrm6SjB4fQaDGW4zWDHo9oXGlOa3fWM"><img src="https://private-user-images.githubusercontent.com/59355783/266386025-f43f7ead-889a-42c9-ac65-38c2dd191e67.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjYzODYwMjUtZjQzZjdlYWQtODg5YS00MmM5LWFjNjUtMzhjMmRkMTkxZTY3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTk1NDZhYmZhZTk5ZWUyZGU4MzVkNmE2NGUyNDEzMDUyY2QxNGFkMTc2ZWEyZjI2NDAyMTNmNTYzMzBiNDA4YmQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.HQ89KW1bf29OIrm6SjB4fQaDGW4zWDHo9oXGlOa3fWM" alt="image" style="max-width: 100%;"></a><br>
It ran successfully and spawned notepad.exe</p>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">Static Analysis</h1><a id="user-content-static-analysis" class="anchor" aria-label="Permalink: Static Analysis" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#static-analysis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Just like a malware, let's first take a look at inside the methodology of our code. For static analysis we will open the executable inside a tool called Cutter.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266386852-3726d542-596e-456b-be43-42157db4951f.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjYzODY4NTItMzcyNmQ1NDItNTk2ZS00NTZiLWJlNDMtNDIxNTdkYjQ5NTFmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTNmMzJlYzY1Zjc4MjUyYzIyYzM4NDkxN2Q5MTVjODIwNTUwMzU1MzY0NWM4YjkxNGMwYWNjZGJmYjU0NzhmMjkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.xN2IRavvHLcKOk9ScFEClLsB9Aw07H3LQwnwOLPAumk"><img src="https://private-user-images.githubusercontent.com/59355783/266386852-3726d542-596e-456b-be43-42157db4951f.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjYzODY4NTItMzcyNmQ1NDItNTk2ZS00NTZiLWJlNDMtNDIxNTdkYjQ5NTFmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTNmMzJlYzY1Zjc4MjUyYzIyYzM4NDkxN2Q5MTVjODIwNTUwMzU1MzY0NWM4YjkxNGMwYWNjZGJmYjU0NzhmMjkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.xN2IRavvHLcKOk9ScFEClLsB9Aw07H3LQwnwOLPAumk" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">Here is whole graphical flow of the whole process(no puns again)</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266483005-898ce84a-6f51-45c6-9ba4-4cc3afc5f159.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODMwMDUtODk4Y2U4NGEtNmY1MS00NWM2LTliYTQtNGNjM2FmYzVmMTU5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTc0OTRjY2Q5OTZhOTYwZGMxNjllNTU0MWQzMDg5NjRiOGIzZWExMGRmNTE2NjMzNjhkMTE3OTgyOTRhYjViY2MmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.mjJwApIzJ5unVNUkOEZ-MEPIH_zdb2HvFMBucNnLRlM"><img src="https://private-user-images.githubusercontent.com/59355783/266483005-898ce84a-6f51-45c6-9ba4-4cc3afc5f159.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODMwMDUtODk4Y2U4NGEtNmY1MS00NWM2LTliYTQtNGNjM2FmYzVmMTU5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTc0OTRjY2Q5OTZhOTYwZGMxNjllNTU0MWQzMDg5NjRiOGIzZWExMGRmNTE2NjMzNjhkMTE3OTgyOTRhYjViY2MmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.mjJwApIzJ5unVNUkOEZ-MEPIH_zdb2HvFMBucNnLRlM" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">As we can see, the <strong><code>main()</code></strong> function is shown in the analysis along with the variables and structures decalred.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266483231-ad38b8af-a6e6-4666-8cc5-c04d213eaefb.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODMyMzEtYWQzOGI4YWYtYTZlNi00NjY2LThjYzUtYzA0ZDIxM2VhZWZiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJjMjVhMGM2YTY0MWM2ZGI3YzE5OGRhNjNmZGU5NDBkMWU2MTE5MTA4YzZlYTZhMGZkZDhmMzZhNDk2Y2NmMDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.ZLUIR2SPnENFwZNtDT2rg7ZNIz1ta9EFVUPeb-KfGuo"><img src="https://private-user-images.githubusercontent.com/59355783/266483231-ad38b8af-a6e6-4666-8cc5-c04d213eaefb.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODMyMzEtYWQzOGI4YWYtYTZlNi00NjY2LThjYzUtYzA0ZDIxM2VhZWZiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJjMjVhMGM2YTY0MWM2ZGI3YzE5OGRhNjNmZGU5NDBkMWU2MTE5MTA4YzZlYTZhMGZkZDhmMzZhNDk2Y2NmMDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.ZLUIR2SPnENFwZNtDT2rg7ZNIz1ta9EFVUPeb-KfGuo" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">Scroll down and we see the whole code in the form of assembly, here its what happenning -</p>
<ul dir="auto">
<li>The value of <code>lpApplicationName</code> is loaded into rcx,</li>
<li>The value of <code>lpThreadAttributes</code> is set to NULL</li>
<li>The value of <code>lpProcessAttributes</code> is set to NULL</li>
<li>The value of <code>lpCommandLine</code> is set to NULL</li>
<li>The pointer to <code>lpProcessInformation</code> is set from the variable defined</li>
<li>The pointer to <code>lpStartupInfo</code> is set from the variable defined</li>
<li>Other parameters values are set accordingly.</li>
<li>Then the <code>CreateProcess</code> API is called along with it’s variables.</li>
</ul>
<p dir="auto">The CreateProcess API has return type of BOOL. The return value will be non-zero if the API runs successfully or else the value will be 0.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266483600-041b603e-f040-4388-ab7d-0c6296290415.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODM2MDAtMDQxYjYwM2UtZjA0MC00Mzg4LWFiN2QtMGM2Mjk2MjkwNDE1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTc3ZTcxMTg5YTI4MTFjMTRjNTg2ZjU4NmNlOGRjMmMzNzM2MWI1MTljMTJhNDAzZWIzMjE1YjcxYjdkNjMxMmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.B8vcLclwrX36Wii5JEtjduZqwzD32cFQOWjGZ2EK0a4"><img src="https://private-user-images.githubusercontent.com/59355783/266483600-041b603e-f040-4388-ab7d-0c6296290415.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODM2MDAtMDQxYjYwM2UtZjA0MC00Mzg4LWFiN2QtMGM2Mjk2MjkwNDE1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTc3ZTcxMTg5YTI4MTFjMTRjNTg2ZjU4NmNlOGRjMmMzNzM2MWI1MTljMTJhNDAzZWIzMjE1YjcxYjdkNjMxMmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.B8vcLclwrX36Wii5JEtjduZqwzD32cFQOWjGZ2EK0a4" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">The JE(Jump If Equal) will do the comparison and will redirect the execution. If the API fails.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266484051-a29f207f-fd3b-40cb-b2a0-abf066459e40.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODQwNTEtYTI5ZjIwN2YtZmQzYi00MGNiLWIyYTAtYWJmMDY2NDU5ZTQwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM2ZTYwMWM0ZDdhNmUzMjI3MjBmZDk0OGU5YTc1MzQ3YTNkMmRkYWU0M2QwNThlYjgyMTM3NmZhYzRhYmFlNDkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.jP1nPkgsCTD0IyCoZgD4ikEeD2XP3rLtfFAtuF0ZThs"><img src="https://private-user-images.githubusercontent.com/59355783/266484051-a29f207f-fd3b-40cb-b2a0-abf066459e40.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODQwNTEtYTI5ZjIwN2YtZmQzYi00MGNiLWIyYTAtYWJmMDY2NDU5ZTQwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM2ZTYwMWM0ZDdhNmUzMjI3MjBmZDk0OGU5YTc1MzQ3YTNkMmRkYWU0M2QwNThlYjgyMTM3NmZhYzRhYmFlNDkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.jP1nPkgsCTD0IyCoZgD4ikEeD2XP3rLtfFAtuF0ZThs" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">The <strong><a href="https://learn.microsoft.com/en-us/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror" rel="nofollow">GetLastError</a></strong> is called to handle the error. And if the API is successful.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266484154-021481ac-be19-4a17-a2a5-ec782ed3bc28.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODQxNTQtMDIxNDgxYWMtYmUxOS00YTE3LWEyYTUtZWM3ODJlZDNiYzI4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVjN2UwOTQ5ZjkxOGI0NTQwMTg2OTY1ZDBiMTZhM2NmNTY4NGFjMDYyNzJjMjIzMTkyYWZiZDQzZDRlYTBhNTUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.NQ9vKesXwLCSEoS37MH378v-VnaNjtKubcM3SdaoXe0"><img src="https://private-user-images.githubusercontent.com/59355783/266484154-021481ac-be19-4a17-a2a5-ec782ed3bc28.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODQxNTQtMDIxNDgxYWMtYmUxOS00YTE3LWEyYTUtZWM3ODJlZDNiYzI4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVjN2UwOTQ5ZjkxOGI0NTQwMTg2OTY1ZDBiMTZhM2NmNTY4NGFjMDYyNzJjMjIzMTkyYWZiZDQzZDRlYTBhNTUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.NQ9vKesXwLCSEoS37MH378v-VnaNjtKubcM3SdaoXe0" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">The process is spawned and the <strong><a href="https://learn.microsoft.com/en-us/windows/win32/api/handleapi/nf-handleapi-closehandle" rel="nofollow">CloseHandle</a></strong> API is called to close the process completely.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266485374-1370a892-b808-4441-8830-4b3b03f0aea8.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODUzNzQtMTM3MGE4OTItYjgwOC00NDQxLTg4MzAtNGIzYjAzZjBhZWE4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVjZDNhNWVhZDQwMzNhZGEwZWE5NjQyZmI5MjE3MzUxYjg2MWYwNGQxMDczYTAxOWNiMzRjYmY2ZDczYThmN2ImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.US0j2QkZTGsEMqn9Wq_ZR0Y5oVPyeo_GnsByFFZ6uHw"><img src="https://private-user-images.githubusercontent.com/59355783/266485374-1370a892-b808-4441-8830-4b3b03f0aea8.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0ODUzNzQtMTM3MGE4OTItYjgwOC00NDQxLTg4MzAtNGIzYjAzZjBhZWE4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVjZDNhNWVhZDQwMzNhZGEwZWE5NjQyZmI5MjE3MzUxYjg2MWYwNGQxMDczYTAxOWNiMzRjYmY2ZDczYThmN2ImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.US0j2QkZTGsEMqn9Wq_ZR0Y5oVPyeo_GnsByFFZ6uHw" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">And then the return function is called to close the program. Although the whole flow is understanable, still we can't see how the switch from user mode to kernel mode happens. To know this, we'll be doing dynamic analysis of the executable</p>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">X64Dbg Analysis</h1><a id="user-content-x64dbg-analysis" class="anchor" aria-label="Permalink: X64Dbg Analysis" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#x64dbg-analysis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Open the exectuable inside x64Dbg and press F9 to start the execution. To make things easy, I've already setup breakpoints at important places to make is more understandable.</p>
<p dir="auto">Before we move on, here is the whole diagram of the flow of creating a process.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266490968-eba6b471-572b-445b-bf92-0ced7d844a22.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTA5NjgtZWJhNmI0NzEtNTcyYi00NDViLWJmOTItMGNlZDdkODQ0YTIyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTRlM2JiMTYwYTc2MThjOGVmMjMwMjI4MzJmZmQwNWRkMmU4NWRlMjhlOTliY2QxOTJmY2Y0MGE5YjkyNWJjOTcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.vTqh-0EVSD5T1JBU1rl9OIsgBuPoT003lD5hqB6xX10"><img src="https://private-user-images.githubusercontent.com/59355783/266490968-eba6b471-572b-445b-bf92-0ced7d844a22.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTA5NjgtZWJhNmI0NzEtNTcyYi00NDViLWJmOTItMGNlZDdkODQ0YTIyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTRlM2JiMTYwYTc2MThjOGVmMjMwMjI4MzJmZmQwNWRkMmU4NWRlMjhlOTliY2QxOTJmY2Y0MGE5YjkyNWJjOTcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.vTqh-0EVSD5T1JBU1rl9OIsgBuPoT003lD5hqB6xX10" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">Make sure to keep this flow in your mind for better understanding. Open the exe inside the debugger and press F9 to start the execution.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266491366-1aea77c1-7eb7-4bd1-9a78-e72c47bc5950.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTEzNjYtMWFlYTc3YzEtN2ViNy00YmQxLTlhNzgtZTcyYzQ3YmM1OTUwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRkMzM2MmI2ZGIxMDdlMGJjYjg3MDk2ODMzNzFjMjhjZDc5Y2M5MTVlYzZiZmQ2ZjU3NjI4ZTZhNzE0YzA3MWUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.JzhfoKcVdB-6jvcP3jwXc_QpfiHUvZWWfrxFiL1BsTs"><img src="https://private-user-images.githubusercontent.com/59355783/266491366-1aea77c1-7eb7-4bd1-9a78-e72c47bc5950.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTEzNjYtMWFlYTc3YzEtN2ViNy00YmQxLTlhNzgtZTcyYzQ3YmM1OTUwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRkMzM2MmI2ZGIxMDdlMGJjYjg3MDk2ODMzNzFjMjhjZDc5Y2M5MTVlYzZiZmQ2ZjU3NjI4ZTZhNzE0YzA3MWUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.JzhfoKcVdB-6jvcP3jwXc_QpfiHUvZWWfrxFiL1BsTs" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">Pressing F9 to move to the next breakpoint.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266491539-41281d05-6696-47cd-acc3-fefcc02f035f.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTE1MzktNDEyODFkMDUtNjY5Ni00N2NkLWFjYzMtZmVmY2MwMmYwMzVmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTUyZDhiMTU0Y2Y1YzU5ZDI4MDUyM2U4NTllOWUyZmZkZjUzMGEzYmRiZGI5M2QwYTJjODY4NDhhOTEzZWY5YjMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.QDVGf_O525nIBrgQyUo8Ip9h22PtaaGX4JbpFfIXvDU"><img src="https://private-user-images.githubusercontent.com/59355783/266491539-41281d05-6696-47cd-acc3-fefcc02f035f.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTE1MzktNDEyODFkMDUtNjY5Ni00N2NkLWFjYzMtZmVmY2MwMmYwMzVmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTUyZDhiMTU0Y2Y1YzU5ZDI4MDUyM2U4NTllOWUyZmZkZjUzMGEzYmRiZGI5M2QwYTJjODY4NDhhOTEzZWY5YjMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.QDVGf_O525nIBrgQyUo8Ip9h22PtaaGX4JbpFfIXvDU" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">An execution call is mode to the executable binary i.e <strong>create-process.exe</strong>. Now stepping into this execution call and pressing F9 to move to the next breakpoint.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266491845-c3cec5bc-b66c-4b83-861c-db2693f172a0.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTE4NDUtYzNjZWM1YmMtYjY2Yy00YjgzLTg2MWMtZGIyNjkzZjE3MmEwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM2ZDRkMGM0YTE4NWJiOTllMjY0MDcxNDY2MzgwZTcxOThjOWExOGUwYjQxMmMxMTE5NzUwZTdiNzUyNTNkNjEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.rjH0zUNc8sMEa4U9Zk8KKz03ccjvERDc7ctiTg6G8so"><img src="https://private-user-images.githubusercontent.com/59355783/266491845-c3cec5bc-b66c-4b83-861c-db2693f172a0.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTE4NDUtYzNjZWM1YmMtYjY2Yy00YjgzLTg2MWMtZGIyNjkzZjE3MmEwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM2ZDRkMGM0YTE4NWJiOTllMjY0MDcxNDY2MzgwZTcxOThjOWExOGUwYjQxMmMxMTE5NzUwZTdiNzUyNTNkNjEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.rjH0zUNc8sMEa4U9Zk8KKz03ccjvERDc7ctiTg6G8so" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">Moving inside we will see the CreatePreocessW API call, this is where are the parameters are set. Then step into it as well. After setting the parameters we step into the moment before it get’s executed.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266492000-61ba8bba-9a08-4577-b1e8-cfd103ac9101.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTIwMDAtNjFiYThiYmEtOWEwOC00NTc3LWIxZTgtY2ZkMTAzYWM5MTAxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM5MjZjZjQ0OTMyODAxM2E5ZjIxM2I5NTI1YWVjNDY0NGIwY2IzOGUyNDg3OGJiODQ3YjlhYzg2OGUxN2ViNGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.EsiCv_pbOb3whWowUcioSaLB4Ekue9nHwUImZaPAIEc"><img src="https://private-user-images.githubusercontent.com/59355783/266492000-61ba8bba-9a08-4577-b1e8-cfd103ac9101.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTIwMDAtNjFiYThiYmEtOWEwOC00NTc3LWIxZTgtY2ZkMTAzYWM5MTAxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM5MjZjZjQ0OTMyODAxM2E5ZjIxM2I5NTI1YWVjNDY0NGIwY2IzOGUyNDg3OGJiODQ3YjlhYzg2OGUxN2ViNGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.EsiCv_pbOb3whWowUcioSaLB4Ekue9nHwUImZaPAIEc" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">Then we step into the it to see what happens after the <strong><code>CreateProcessW</code></strong> is called.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266492101-67eaf446-edff-45c5-b144-4e78a95cd3b6.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTIxMDEtNjdlYWY0NDYtZWRmZi00NWM1LWIxNDQtNGU3OGE5NWNkM2I2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWI5NGU3OWExNTIwYjlhOTEzMjZlMGI3MDhjY2U1YWZlMTA4NWU3NTczYjkxZjJiODhmYTNlMzZkM2Y5Y2U4OWImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Lq6CQdYwyeS_ken-uv_dlPnR4-mI3uLDJ-3OIAmGirI"><img src="https://private-user-images.githubusercontent.com/59355783/266492101-67eaf446-edff-45c5-b144-4e78a95cd3b6.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTIxMDEtNjdlYWY0NDYtZWRmZi00NWM1LWIxNDQtNGU3OGE5NWNkM2I2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWI5NGU3OWExNTIwYjlhOTEzMjZlMGI3MDhjY2U1YWZlMTA4NWU3NTczYjkxZjJiODhmYTNlMzZkM2Y5Y2U4OWImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Lq6CQdYwyeS_ken-uv_dlPnR4-mI3uLDJ-3OIAmGirI" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">We can see that the <strong><a href="https://doxygen.reactos.org/d9/dd7/dll_2win32_2kernel32_2client_2proc_8c.html#a13a0f94b43874ed5a678909bc39cc1ab" rel="nofollow">CreateProcessInternalW</a></strong> is called from KernelBase.dll which in simple words gets functionality from kernel32.dll and advapi32.dll. Now we step inside CreateProcessInternalW.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266494807-8adecf16-f317-4880-a074-e62e5face271.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTQ4MDctOGFkZWNmMTYtZjMxNy00ODgwLWEwNzQtZTYyZTVmYWNlMjcxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJlNTIzODEzZmU3Nzg2ZWVlOTlkMTJlMDg4YTRjMDhlNDgyZTVjZmMyMWQ4OGY1OWZmNWJlNjBmMDJkNTJjNWYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.-XZBQAqFsMyQOK5L7n4bEy3_Vc_qtEONsnV-IdJH4P0"><img src="https://private-user-images.githubusercontent.com/59355783/266494807-8adecf16-f317-4880-a074-e62e5face271.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTQ4MDctOGFkZWNmMTYtZjMxNy00ODgwLWEwNzQtZTYyZTVmYWNlMjcxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJlNTIzODEzZmU3Nzg2ZWVlOTlkMTJlMDg4YTRjMDhlNDgyZTVjZmMyMWQ4OGY1OWZmNWJlNjBmMDJkNTJjNWYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.-XZBQAqFsMyQOK5L7n4bEy3_Vc_qtEONsnV-IdJH4P0" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">It is making call to <strong><code>NtCreateUserProcess</code></strong> inside NTDLL. Here is the structure of the API</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>NTSTATUS
NTAPI
<span class="pl-en">NtCreateUserProcess</span>(
    _Out_ PHANDLE ProcessHandle,
    _Out_ PHANDLE ThreadHandle,
    _In_ ACCESS_MASK ProcessDesiredAccess,
    _In_ ACCESS_MASK ThreadDesiredAccess,
    _In_opt_ POBJECT_ATTRIBUTES ProcessObjectAttributes,
    _In_opt_ POBJECT_ATTRIBUTES ThreadObjectAttributes,
    _In_ ULONG ProcessFlags,
    _In_ ULONG ThreadFlags,
    _In_ PRTL_USER_PROCESS_PARAMETERS ProcessParameters,
    _Inout_ PPS_CREATE_INFO CreateInfo,
    _In_ PPS_ATTRIBUTE_LIST AttributeList
);</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="NTSTATUS
NTAPI
NtCreateUserProcess(
    _Out_ PHANDLE ProcessHandle,
    _Out_ PHANDLE ThreadHandle,
    _In_ ACCESS_MASK ProcessDesiredAccess,
    _In_ ACCESS_MASK ThreadDesiredAccess,
    _In_opt_ POBJECT_ATTRIBUTES ProcessObjectAttributes,
    _In_opt_ POBJECT_ATTRIBUTES ThreadObjectAttributes,
    _In_ ULONG ProcessFlags,
    _In_ ULONG ThreadFlags,
    _In_ PRTL_USER_PROCESS_PARAMETERS ProcessParameters,
    _Inout_ PPS_CREATE_INFO CreateInfo,
    _In_ PPS_ATTRIBUTE_LIST AttributeList
);" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">Stepping inside the API call.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266495345-84654a36-8566-4e16-a0ca-e63d8ab67d61.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTUzNDUtODQ2NTRhMzYtODU2Ni00ZTE2LWEwY2EtZTYzZDhhYjY3ZDYxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTZmNjkzYjRhZjEyYjZmYjVlYTNkZGE2ODBhYjYyYzI3NmNmZmRlOGJhNDIyNWI4YTU0NDNmMTY4OTJkMTJkM2MmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Syl2JjjIQFzjEMi90RLiRzpGVlqcN0BKbxPde7XIJ8g"><img src="https://private-user-images.githubusercontent.com/59355783/266495345-84654a36-8566-4e16-a0ca-e63d8ab67d61.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTUzNDUtODQ2NTRhMzYtODU2Ni00ZTE2LWEwY2EtZTYzZDhhYjY3ZDYxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTZmNjkzYjRhZjEyYjZmYjVlYTNkZGE2ODBhYjYyYzI3NmNmZmRlOGJhNDIyNWI4YTU0NDNmMTY4OTJkMTJkM2MmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Syl2JjjIQFzjEMi90RLiRzpGVlqcN0BKbxPde7XIJ8g" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">We can see that it is making a syscall to NtCreateUserProcess which resides inside kernel and that actually start our process. If we press F9 to resume the execution, notepad.exe will be spawned.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266495420-ea71ca75-a070-4698-bcf4-19e1982c3e61.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTU0MjAtZWE3MWNhNzUtYTA3MC00Njk4LWJjZjQtMTllMTk4MmMzZTYxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWVlNmFkNzc0ZTg1ODZhY2IyNTE2NTEwMTVkYWRmNjBhYzc3NTlmMDJlOTBiM2NiZjcwNTU1NGE2Y2U5OWFkYTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.fdpUEra_7-gbMy0jJcQl4pcXBdx3RErm8YzlnD8SI2g"><img src="https://private-user-images.githubusercontent.com/59355783/266495420-ea71ca75-a070-4698-bcf4-19e1982c3e61.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY0OTU0MjAtZWE3MWNhNzUtYTA3MC00Njk4LWJjZjQtMTllMTk4MmMzZTYxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWVlNmFkNzc0ZTg1ODZhY2IyNTE2NTEwMTVkYWRmNjBhYzc3NTlmMDJlOTBiM2NiZjcwNTU1NGE2Y2U5OWFkYTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.fdpUEra_7-gbMy0jJcQl4pcXBdx3RErm8YzlnD8SI2g" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">We can visualize this whole process creation in a small video.</p>
<details open="" class="details-reset border rounded-2">
  <summary class="px-3 py-2">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-device-camera-video">
    <path d="M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z"></path>
</svg>
    <span class="m-1">createprocess1.mp4</span>
    <span class="dropdown-caret"></span>
  </summary>

  <video src="https://private-user-images.githubusercontent.com/59355783/266601090-fc21c971-ade9-4505-8628-4a2298cd0331.mp4?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY2MDEwOTAtZmMyMWM5NzEtYWRlOS00NTA1LTg2MjgtNGEyMjk4Y2QwMzMxLm1wND9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTk2NTgyYjY0MjI2YzgxODgwNDdhOTk4MjNhNDhlMjNkYjVjZGFlZDIwZWE3NjNjYWQ5NzBlOGFkNjY2NmEyZWImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Db2OhNKB8L0_fEwDdjzYrHeJ6OT5DgK2lxlGipJZq3g" data-canonical-src="https://private-user-images.githubusercontent.com/59355783/266601090-fc21c971-ade9-4505-8628-4a2298cd0331.mp4?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY2MDEwOTAtZmMyMWM5NzEtYWRlOS00NTA1LTg2MjgtNGEyMjk4Y2QwMzMxLm1wND9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTk2NTgyYjY0MjI2YzgxODgwNDdhOTk4MjNhNDhlMjNkYjVjZGFlZDIwZWE3NjNjYWQ5NzBlOGFkNjY2NmEyZWImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Db2OhNKB8L0_fEwDdjzYrHeJ6OT5DgK2lxlGipJZq3g" controls="controls" muted="muted" class="d-block rounded-bottom-2 border-top width-fit" style="max-height:640px; min-height: 200px">

  </video>
</details>

<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">Creating Process Via NTAPIs</h1><a id="user-content-creating-process-via-ntapis" class="anchor" aria-label="Permalink: Creating Process Via NTAPIs" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#creating-process-via-ntapis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In this section, we will take a look at how we can create a process directly with the Native API <strong><code>NtCreateUserProcess</code></strong>. Although this is beyond my skillset, fortunately <strong><a href="https://twitter.com/CaptMeelo" rel="nofollow">@CaptMeelo</a></strong> created a awesome blog post on how to do it exactly. In this section, I'll just try to explain the method in an easy way. In order to know more about this topics you can read it on the author's website <strong>(<a href="https://captmeelo.com/redteam/maldev/2022/05/10/ntcreateuserprocess.html" rel="nofollow">HERE</a>)</strong>. All credits to the creator for this amazing write-up</p>
<p dir="auto">As we saw the <strong><code>NtCreateUserProcess</code></strong> API is where the transition from User mode to Kernel mode happens. Here is the structure of the API</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>NTSTATUS
NTAPI
<span class="pl-en">NtCreateUserProcess</span>(
    _Out_ PHANDLE ProcessHandle,
    _Out_ PHANDLE ThreadHandle,
    _In_ ACCESS_MASK ProcessDesiredAccess,
    _In_ ACCESS_MASK ThreadDesiredAccess,
    _In_opt_ POBJECT_ATTRIBUTES ProcessObjectAttributes,
    _In_opt_ POBJECT_ATTRIBUTES ThreadObjectAttributes,
    _In_ ULONG ProcessFlags,
    _In_ ULONG ThreadFlags,
    _In_ PRTL_USER_PROCESS_PARAMETERS ProcessParameters,
    _Inout_ PPS_CREATE_INFO CreateInfo,
    _In_ PPS_ATTRIBUTE_LIST AttributeList
);</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="NTSTATUS
NTAPI
NtCreateUserProcess(
    _Out_ PHANDLE ProcessHandle,
    _Out_ PHANDLE ThreadHandle,
    _In_ ACCESS_MASK ProcessDesiredAccess,
    _In_ ACCESS_MASK ThreadDesiredAccess,
    _In_opt_ POBJECT_ATTRIBUTES ProcessObjectAttributes,
    _In_opt_ POBJECT_ATTRIBUTES ThreadObjectAttributes,
    _In_ ULONG ProcessFlags,
    _In_ ULONG ThreadFlags,
    _In_ PRTL_USER_PROCESS_PARAMETERS ProcessParameters,
    _Inout_ PPS_CREATE_INFO CreateInfo,
    _In_ PPS_ATTRIBUTE_LIST AttributeList
);" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">Let's try to understand it's parameter.
<strong><code>ProcessHandle</code></strong>&nbsp;and&nbsp;<strong><code>ThreadHandle</code></strong>&nbsp;which will store the handles to the created process and thread. These two arguments are too simple and can be initialized with the following.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto"><pre class="notranslate"><code>HANDLE hProcess, hThread = NULL;
</code></pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="HANDLE hProcess, hThread = NULL;" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">For&nbsp;<strong><code>ProcessDesiredAccess</code></strong>&nbsp;and&nbsp;<strong><code>ThreadDesiredAccess</code></strong>&nbsp;parameters, we need to supply them with&nbsp;<strong><code>ACCESS_MASK</code></strong>&nbsp;values that would identify the rights and controls we have over the process and thread we’re creating. Different values could be assigned to&nbsp;<strong><code>ACCESS_MASK</code></strong>&nbsp;and they are listed in&nbsp;<strong><code>winnt.h</code></strong>. Since we’re only dealing with process and thread objects, we can use the process- and thread-specific access rights&nbsp;<strong><code>PROCESS_ALL_ACCESS</code></strong>&nbsp;and&nbsp;<strong><code>THREAD_ALL_ACCESS</code></strong>.</p>
<p dir="auto">Here are the other properties -</p>
<ul dir="auto">
<li><strong><a href="https://docs.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights" rel="nofollow">PROCESS ACCESS RIGHTS</a></strong></li>
<li><strong><a href="https://docs.microsoft.com/en-us/windows/win32/procthread/thread-security-and-access-rights" rel="nofollow">THREAD ACCESS RIGHTS</a></strong></li>
</ul>
<p dir="auto">The next parameters are&nbsp;<strong><code>ProcessObjectAttributes</code></strong>&nbsp;and&nbsp;<strong><code>ThreadObjectAttributes</code></strong>, which are pointers to an&nbsp;<strong><a href="https://learn.microsoft.com/en-us/windows/win32/api/ntdef/ns-ntdef-_object_attributes" rel="nofollow">OBJECT_ATTRIBUTES</a></strong>. This structure contains the attributes that could be applied to the objects or object handles that will be created. These parameters are optional hence we can simply assign&nbsp;<strong><code>NULL</code></strong>&nbsp;values to them.</p>
<p dir="auto">Moving on, the flags set within <strong><code>ProcessFlags</code></strong>&nbsp;and&nbsp;<strong><code>ThreadFlags</code></strong>&nbsp;determine how we want our process and thread to be created. These are similar to the <strong><code>dwCreationFlags</code></strong> argument of <strong><code>CreateProcess()</code></strong> API which doesn't apply in this case. We will look into <strong><a href="https://processhacker.sourceforge.io/" rel="nofollow">Process Hacker</a></strong> which is open-source software and also it's a useful tool to look inside a process properties it does interact with the kernel and native APIS.</p>
<p dir="auto">From the NTSAPI, here are the <strong><code>ProcessFlags</code></strong> valid parameters and values(<strong><a href="https://github.com/winsiderss/systeminformer/blob/master/phnt/include/ntpsapi.h#L1354">Here</a></strong>).</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_BREAKAWAY</span> <span class="pl-c1">0x00000001</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_NO_DEBUG_INHERIT</span> <span class="pl-c1">0x00000002</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_INHERIT_HANDLES</span> <span class="pl-c1">0x00000004</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_OVERRIDE_ADDRESS_SPACE</span> <span class="pl-c1">0x00000008</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx only</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_LARGE_PAGES</span> <span class="pl-c1">0x00000010</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx only, requires SeLockMemory</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_LARGE_PAGE_SYSTEM_DLL</span> <span class="pl-c1">0x00000020</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx only, requires SeLockMemory</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_PROTECTED_PROCESS</span> <span class="pl-c1">0x00000040</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateUserProcess only</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_CREATE_SESSION</span> <span class="pl-c1">0x00000080</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess, requires SeLoadDriver</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_INHERIT_FROM_PARENT</span> <span class="pl-c1">0x00000100</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_SUSPENDED</span> <span class="pl-c1">0x00000200</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_FORCE_BREAKAWAY</span> <span class="pl-c1">0x00000400</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess, requires SeTcb</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_MINIMAL_PROCESS</span> <span class="pl-c1">0x00000800</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx only</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_RELEASE_SECTION</span> <span class="pl-c1">0x00001000</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_CLONE_MINIMAL</span> <span class="pl-c1">0x00002000</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx only</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_CLONE_MINIMAL_REDUCED_COMMIT</span> <span class="pl-c1">0x00004000</span> <span class="pl-c"><span class="pl-c">//</span></span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_AUXILIARY_PROCESS</span> <span class="pl-c1">0x00008000</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess, requires SeTcb</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_CREATE_STORE</span> <span class="pl-c1">0x00020000</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess</span>
#<span class="pl-k">define</span> <span class="pl-en">PROCESS_CREATE_FLAGS_USE_PROTECTED_ENVIRONMENT</span> <span class="pl-c1">0x00040000</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateProcessEx &amp; NtCreateUserProcess</span></pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="#define PROCESS_CREATE_FLAGS_BREAKAWAY 0x00000001 // NtCreateProcessEx &amp; NtCreateUserProcess
#define PROCESS_CREATE_FLAGS_NO_DEBUG_INHERIT 0x00000002 // NtCreateProcessEx &amp; NtCreateUserProcess
#define PROCESS_CREATE_FLAGS_INHERIT_HANDLES 0x00000004 // NtCreateProcessEx &amp; NtCreateUserProcess
#define PROCESS_CREATE_FLAGS_OVERRIDE_ADDRESS_SPACE 0x00000008 // NtCreateProcessEx only
#define PROCESS_CREATE_FLAGS_LARGE_PAGES 0x00000010 // NtCreateProcessEx only, requires SeLockMemory
#define PROCESS_CREATE_FLAGS_LARGE_PAGE_SYSTEM_DLL 0x00000020 // NtCreateProcessEx only, requires SeLockMemory
#define PROCESS_CREATE_FLAGS_PROTECTED_PROCESS 0x00000040 // NtCreateUserProcess only
#define PROCESS_CREATE_FLAGS_CREATE_SESSION 0x00000080 // NtCreateProcessEx &amp; NtCreateUserProcess, requires SeLoadDriver
#define PROCESS_CREATE_FLAGS_INHERIT_FROM_PARENT 0x00000100 // NtCreateProcessEx &amp; NtCreateUserProcess
#define PROCESS_CREATE_FLAGS_SUSPENDED 0x00000200 // NtCreateProcessEx &amp; NtCreateUserProcess
#define PROCESS_CREATE_FLAGS_FORCE_BREAKAWAY 0x00000400 // NtCreateProcessEx &amp; NtCreateUserProcess, requires SeTcb
#define PROCESS_CREATE_FLAGS_MINIMAL_PROCESS 0x00000800 // NtCreateProcessEx only
#define PROCESS_CREATE_FLAGS_RELEASE_SECTION 0x00001000 // NtCreateProcessEx &amp; NtCreateUserProcess
#define PROCESS_CREATE_FLAGS_CLONE_MINIMAL 0x00002000 // NtCreateProcessEx only
#define PROCESS_CREATE_FLAGS_CLONE_MINIMAL_REDUCED_COMMIT 0x00004000 //
#define PROCESS_CREATE_FLAGS_AUXILIARY_PROCESS 0x00008000 // NtCreateProcessEx &amp; NtCreateUserProcess, requires SeTcb
#define PROCESS_CREATE_FLAGS_CREATE_STORE 0x00020000 // NtCreateProcessEx &amp; NtCreateUserProcess
#define PROCESS_CREATE_FLAGS_USE_PROTECTED_ENVIRONMENT 0x00040000 // NtCreateProcessEx &amp; NtCreateUserProcess" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">And for the <strong><code>ThreadFlags</code></strong> as well(<strong><a href="https://github.com/winsiderss/systeminformer/blob/master/phnt/include/ntpsapi.h#L2325">Here</a></strong>).</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>#<span class="pl-k">define</span> <span class="pl-en">THREAD_CREATE_FLAGS_NONE</span> <span class="pl-c1">0x00000000</span>
#<span class="pl-k">define</span> <span class="pl-en">THREAD_CREATE_FLAGS_CREATE_SUSPENDED</span> <span class="pl-c1">0x00000001</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateUserProcess &amp; NtCreateThreadEx</span>
#<span class="pl-k">define</span> <span class="pl-en">THREAD_CREATE_FLAGS_SKIP_THREAD_ATTACH</span> <span class="pl-c1">0x00000002</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateThreadEx only</span>
#<span class="pl-k">define</span> <span class="pl-en">THREAD_CREATE_FLAGS_HIDE_FROM_DEBUGGER</span> <span class="pl-c1">0x00000004</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateThreadEx only</span>
#<span class="pl-k">define</span> <span class="pl-en">THREAD_CREATE_FLAGS_LOADER_WORKER</span> <span class="pl-c1">0x00000010</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateThreadEx only</span>
#<span class="pl-k">define</span> <span class="pl-en">THREAD_CREATE_FLAGS_SKIP_LOADER_INIT</span> <span class="pl-c1">0x00000020</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateThreadEx only</span>
#<span class="pl-k">define</span> <span class="pl-en">THREAD_CREATE_FLAGS_BYPASS_PROCESS_FREEZE</span> <span class="pl-c1">0x00000040</span> <span class="pl-c"><span class="pl-c">//</span> NtCreateThreadEx only</span></pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="#define THREAD_CREATE_FLAGS_NONE 0x00000000
#define THREAD_CREATE_FLAGS_CREATE_SUSPENDED 0x00000001 // NtCreateUserProcess &amp; NtCreateThreadEx
#define THREAD_CREATE_FLAGS_SKIP_THREAD_ATTACH 0x00000002 // NtCreateThreadEx only
#define THREAD_CREATE_FLAGS_HIDE_FROM_DEBUGGER 0x00000004 // NtCreateThreadEx only
#define THREAD_CREATE_FLAGS_LOADER_WORKER 0x00000010 // NtCreateThreadEx only
#define THREAD_CREATE_FLAGS_SKIP_LOADER_INIT 0x00000020 // NtCreateThreadEx only
#define THREAD_CREATE_FLAGS_BYPASS_PROCESS_FREEZE 0x00000040 // NtCreateThreadEx only" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">One good thing about this is that the comments mentioned which flags are supported by which APIs. Now we're working on a nomral process creation so setting the flag to <strong>NULL</strong>.</p>
<p dir="auto">The last argument, <strong><code>AttributeList</code></strong>  parameter is used to set up the attributes for process and thread creation. An example of this is when implementing PPID Spoofing where the&nbsp;<strong><code>PROC_THREAD_ATTRIBUTE_PARENT_PROCESS</code></strong>&nbsp;attribute is set. We can again look at NTSAPI of Process Hacker for its valid values and parameters (<strong><a href="https://github.com/winsiderss/systeminformer/blob/master/phnt/include/ntpsapi.h#L2001">Here</a></strong>).</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_PARENT_PROCESS</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeParentProcess, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_DEBUG_PORT</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeDebugPort, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_TOKEN</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeToken, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_CLIENT_ID</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeClientId, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_TEB_ADDRESS</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeTebAddress, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_IMAGE_NAME</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeImageName, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_IMAGE_INFO</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeImageInfo, <span class="pl-c1">FALSE</span>, <span class="pl-c1">FALSE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_MEMORY_RESERVE</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeMemoryReserve, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_PRIORITY_CLASS</span> <span class="pl-en">PsAttributeValue</span>(PsAttributePriorityClass, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_ERROR_MODE</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeErrorMode, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_STD_HANDLE_INFO</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeStdHandleInfo, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_HANDLE_LIST</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeHandleList, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_GROUP_AFFINITY</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeGroupAffinity, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_PREFERRED_NODE</span> <span class="pl-en">PsAttributeValue</span>(PsAttributePreferredNode, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_IDEAL_PROCESSOR</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeIdealProcessor, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_UMS_THREAD</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeUmsThread, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_MITIGATION_OPTIONS</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeMitigationOptions, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_PROTECTION_LEVEL</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeProtectionLevel, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_SECURE_PROCESS</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeSecureProcess, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_JOB_LIST</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeJobList, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_CHILD_PROCESS_POLICY</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeChildProcessPolicy, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_ALL_APPLICATION_PACKAGES_POLICY</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeAllApplicationPackagesPolicy, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_WIN32K_FILTER</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeWin32kFilter, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_SAFE_OPEN_PROMPT_ORIGIN_CLAIM</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeSafeOpenPromptOriginClaim, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_BNO_ISOLATION</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeBnoIsolation, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_DESKTOP_APP_POLICY</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeDesktopAppPolicy, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_CHPE</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeChpe, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_MITIGATION_AUDIT_OPTIONS</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeMitigationAuditOptions, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">FALSE</span>)
#<span class="pl-k">define</span> <span class="pl-en">PS_ATTRIBUTE_MACHINE_TYPE</span> <span class="pl-en">PsAttributeValue</span>(PsAttributeMachineType, <span class="pl-c1">FALSE</span>, <span class="pl-c1">TRUE</span>, <span class="pl-c1">TRUE</span>)</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="#define PS_ATTRIBUTE_PARENT_PROCESS PsAttributeValue(PsAttributeParentProcess, FALSE, TRUE, TRUE)
#define PS_ATTRIBUTE_DEBUG_PORT PsAttributeValue(PsAttributeDebugPort, FALSE, TRUE, TRUE)
#define PS_ATTRIBUTE_TOKEN PsAttributeValue(PsAttributeToken, FALSE, TRUE, TRUE)
#define PS_ATTRIBUTE_CLIENT_ID PsAttributeValue(PsAttributeClientId, TRUE, FALSE, FALSE)
#define PS_ATTRIBUTE_TEB_ADDRESS PsAttributeValue(PsAttributeTebAddress, TRUE, FALSE, FALSE)
#define PS_ATTRIBUTE_IMAGE_NAME PsAttributeValue(PsAttributeImageName, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_IMAGE_INFO PsAttributeValue(PsAttributeImageInfo, FALSE, FALSE, FALSE)
#define PS_ATTRIBUTE_MEMORY_RESERVE PsAttributeValue(PsAttributeMemoryReserve, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_PRIORITY_CLASS PsAttributeValue(PsAttributePriorityClass, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_ERROR_MODE PsAttributeValue(PsAttributeErrorMode, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_STD_HANDLE_INFO PsAttributeValue(PsAttributeStdHandleInfo, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_HANDLE_LIST PsAttributeValue(PsAttributeHandleList, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_GROUP_AFFINITY PsAttributeValue(PsAttributeGroupAffinity, TRUE, TRUE, FALSE)
#define PS_ATTRIBUTE_PREFERRED_NODE PsAttributeValue(PsAttributePreferredNode, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_IDEAL_PROCESSOR PsAttributeValue(PsAttributeIdealProcessor, TRUE, TRUE, FALSE)
#define PS_ATTRIBUTE_UMS_THREAD PsAttributeValue(PsAttributeUmsThread, TRUE, TRUE, FALSE)
#define PS_ATTRIBUTE_MITIGATION_OPTIONS PsAttributeValue(PsAttributeMitigationOptions, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_PROTECTION_LEVEL PsAttributeValue(PsAttributeProtectionLevel, FALSE, TRUE, TRUE)
#define PS_ATTRIBUTE_SECURE_PROCESS PsAttributeValue(PsAttributeSecureProcess, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_JOB_LIST PsAttributeValue(PsAttributeJobList, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_CHILD_PROCESS_POLICY PsAttributeValue(PsAttributeChildProcessPolicy, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_ALL_APPLICATION_PACKAGES_POLICY PsAttributeValue(PsAttributeAllApplicationPackagesPolicy, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_WIN32K_FILTER PsAttributeValue(PsAttributeWin32kFilter, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_SAFE_OPEN_PROMPT_ORIGIN_CLAIM PsAttributeValue(PsAttributeSafeOpenPromptOriginClaim, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_BNO_ISOLATION PsAttributeValue(PsAttributeBnoIsolation, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_DESKTOP_APP_POLICY PsAttributeValue(PsAttributeDesktopAppPolicy, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_CHPE PsAttributeValue(PsAttributeChpe, FALSE, TRUE, TRUE)
#define PS_ATTRIBUTE_MITIGATION_AUDIT_OPTIONS PsAttributeValue(PsAttributeMitigationAuditOptions, FALSE, TRUE, FALSE)
#define PS_ATTRIBUTE_MACHINE_TYPE PsAttributeValue(PsAttributeMachineType, FALSE, TRUE, TRUE)" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">In the code, here how it is initialized.</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>PPS_ATTRIBUTE_LIST AttributeList = (PS_ATTRIBUTE_LIST*)RtlAllocateHeap(RtlProcessHeap(), HEAP_ZERO_MEMORY, <span class="pl-k">sizeof</span>(PS_ATTRIBUTE));
AttributeList-&gt;TotalLength = <span class="pl-k">sizeof</span>(PS_ATTRIBUTE_LIST) - <span class="pl-k">sizeof</span>(PS_ATTRIBUTE);

AttributeList-&gt;Attributes[<span class="pl-c1">0</span>].Attribute = PS_ATTRIBUTE_IMAGE_NAME;
AttributeList-&gt;Attributes[<span class="pl-c1">0</span>].Size = NtImagePath.Length;
AttributeList-&gt;Attributes[<span class="pl-c1">0</span>].Value = (ULONG_PTR)NtImagePath.Buffer;</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="PPS_ATTRIBUTE_LIST AttributeList = (PS_ATTRIBUTE_LIST*)RtlAllocateHeap(RtlProcessHeap(), HEAP_ZERO_MEMORY, sizeof(PS_ATTRIBUTE));
AttributeList->TotalLength = sizeof(PS_ATTRIBUTE_LIST) - sizeof(PS_ATTRIBUTE);

AttributeList->Attributes[0].Attribute = PS_ATTRIBUTE_IMAGE_NAME;
AttributeList->Attributes[0].Size = NtImagePath.Length;
AttributeList->Attributes[0].Value = (ULONG_PTR)NtImagePath.Buffer;" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">The <strong><code>pProcessParameters</code></strong>&nbsp;points to the&nbsp;<strong><code>RTL_USER_PROCESS_PARAMETERS</code></strong>&nbsp;structure, which will hold the process parameter information as a result of executing&nbsp;<strong><code>RtlCreateProcessParametersEx()</code></strong>. Any information stored in the structure is then used as an input to&nbsp;<strong><code>NtCreateProcess()</code></strong>.</p>
<p dir="auto">Here is the structure of <strong><code>RtlCreateProcessParametersEx()</code></strong>,</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">typedef</span> <span class="pl-en">NTSTATUS</span> (NTAPI *_RtlCreateProcessParametersEx)(
    _Out_ PRTL_USER_PROCESS_PARAMETERS *pProcessParameters,
    _In_ PUNICODE_STRING ImagePathName,
    _In_opt_ PUNICODE_STRING DllPath,
    _In_opt_ PUNICODE_STRING CurrentDirectory,
    _In_opt_ PUNICODE_STRING CommandLine,
    _In_opt_ PVOID Environment,
    _In_opt_ PUNICODE_STRING WindowTitle,
    _In_opt_ PUNICODE_STRING DesktopInfo,
    _In_opt_ PUNICODE_STRING ShellInfo,
    _In_opt_ PUNICODE_STRING RuntimeData,
    _In_ ULONG Flags
);</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="typedef NTSTATUS (NTAPI *_RtlCreateProcessParametersEx)(
    _Out_ PRTL_USER_PROCESS_PARAMETERS *pProcessParameters,
    _In_ PUNICODE_STRING ImagePathName,
    _In_opt_ PUNICODE_STRING DllPath,
    _In_opt_ PUNICODE_STRING CurrentDirectory,
    _In_opt_ PUNICODE_STRING CommandLine,
    _In_opt_ PVOID Environment,
    _In_opt_ PUNICODE_STRING WindowTitle,
    _In_opt_ PUNICODE_STRING DesktopInfo,
    _In_opt_ PUNICODE_STRING ShellInfo,
    _In_opt_ PUNICODE_STRING RuntimeData,
    _In_ ULONG Flags
);" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">And the strucutre of <strong><code>RTL_USER_PROCESS_PARAMETERS</code></strong>,</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">typedef</span> <span class="pl-k">struct</span> <span class="pl-en">_RTL_USER_PROCESS_PARAMETERS</span>
{
    ULONG MaximumLength;
    ULONG Length;
 
    ULONG Flags;
    ULONG DebugFlags;
 
    HANDLE ConsoleHandle;
    ULONG ConsoleFlags;
    HANDLE StandardInput;
    HANDLE StandardOutput;
    HANDLE StandardError;
 
    CURDIR CurrentDirectory;
    UNICODE_STRING DllPath;
    UNICODE_STRING ImagePathName;
    UNICODE_STRING CommandLine;
    PVOID Environment;
 
    ULONG StartingX;
    ULONG StartingY;
    ULONG CountX;
    ULONG CountY;
    ULONG CountCharsX;
    ULONG CountCharsY;
    ULONG FillAttribute;
 
    ULONG WindowFlags;
    ULONG ShowWindowFlags;
    UNICODE_STRING WindowTitle;
    UNICODE_STRING DesktopInfo;
    UNICODE_STRING ShellInfo;
    UNICODE_STRING RuntimeData;
    RTL_DRIVE_LETTER_CURDIR CurrentDirectories[RTL_MAX_DRIVE_LETTERS];
 
    ULONG EnvironmentSize;
    ULONG EnvironmentVersion;
    PVOID PackageDependencyData;
    ULONG ProcessGroupId;
} RTL_USER_PROCESS_PARAMETERS, *PRTL_USER_PROCESS_PARAMETERS;</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="typedef struct _RTL_USER_PROCESS_PARAMETERS
{
    ULONG MaximumLength;
    ULONG Length;
 
    ULONG Flags;
    ULONG DebugFlags;
 
    HANDLE ConsoleHandle;
    ULONG ConsoleFlags;
    HANDLE StandardInput;
    HANDLE StandardOutput;
    HANDLE StandardError;
 
    CURDIR CurrentDirectory;
    UNICODE_STRING DllPath;
    UNICODE_STRING ImagePathName;
    UNICODE_STRING CommandLine;
    PVOID Environment;
 
    ULONG StartingX;
    ULONG StartingY;
    ULONG CountX;
    ULONG CountY;
    ULONG CountCharsX;
    ULONG CountCharsY;
    ULONG FillAttribute;
 
    ULONG WindowFlags;
    ULONG ShowWindowFlags;
    UNICODE_STRING WindowTitle;
    UNICODE_STRING DesktopInfo;
    UNICODE_STRING ShellInfo;
    UNICODE_STRING RuntimeData;
    RTL_DRIVE_LETTER_CURDIR CurrentDirectories[RTL_MAX_DRIVE_LETTERS];
 
    ULONG EnvironmentSize;
    ULONG EnvironmentVersion;
    PVOID PackageDependencyData;
    ULONG ProcessGroupId;
} RTL_USER_PROCESS_PARAMETERS, *PRTL_USER_PROCESS_PARAMETERS;" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">The second parameter&nbsp;<strong><code>ImagePathName</code></strong>&nbsp;holds the full path (in NT path format) of the image/binary from which the process will be created. For example.</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>UNICODE_STRING NtImagePath;
<span class="pl-en">RtlInitUnicodeString</span>(&amp;NtImagePath, (PWSTR)L"\\??\\C:\\Windows\\System32\\calc.exe");</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="UNICODE_STRING NtImagePath;
RtlInitUnicodeString(&amp;NtImagePath, (PWSTR)L&quot;\\??\\C:\\Windows\\System32\\calc.exe&quot;);" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">The&nbsp;<strong><code>RtlInitUnicodeString()</code></strong>&nbsp;function, which has the following syntax, is necessary to initialize the&nbsp;<strong><code>UNICODE_STRING</code></strong>&nbsp;structure.</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>VOID <span class="pl-en">NTAPIRtlInitUnicodeString</span>(
    _Out_ PUNICODE_STRING DestinationString,
    _In_opt_ PWSTR SourceString
);</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="VOID NTAPIRtlInitUnicodeString(
    _Out_ PUNICODE_STRING DestinationString,
    _In_opt_ PWSTR SourceString
);" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">And here is the structure of <strong><code>UNICODE_STRING</code></strong>.</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">typedef</span> <span class="pl-k">struct</span> <span class="pl-en">_UNICODE_STRING</span>
{
  USHORT Length;
  USHORT MaximumLength;
  PWSTR Buffer;
} UNICODE_STRING, * PUNICODE_STRING;</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="typedef struct _UNICODE_STRING
{
  USHORT Length;
  USHORT MaximumLength;
  PWSTR Buffer;
} UNICODE_STRING, * PUNICODE_STRING;" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">The initialization of the&nbsp;<strong><code>UNICODE_STRING</code></strong>&nbsp;structure is done by:</p>
<ul dir="auto">
<li>Setting the&nbsp;<strong><code>Length</code></strong>&nbsp;and&nbsp;<strong><code>MaximumLength</code></strong>&nbsp;members to the length of the&nbsp;<strong><code>SourceString</code></strong></li>
<li>Setting the&nbsp;<strong><code>Buffer</code></strong>&nbsp;member to the address of the string passed in&nbsp;<strong><code>SourceString</code></strong></li>
</ul>
<p dir="auto">The other arguments are optional, so setting them to <strong>NULL</strong>. A scenario in which these parameters can be useful is when “blending in” to help avoid detections. As an example, if we set&nbsp;CommandLine&nbsp;to&nbsp;NULL, the value that will be set upon process creation is the same with what’s passed in&nbsp;ImagePathName.</p>
<p dir="auto">Here is the full code by <strong><a href="https://twitter.com/CaptMeelo" rel="nofollow">@CaptMeelo</a></strong>.</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>Windows.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">"</span>ntdll.h<span class="pl-pds">"</span></span>
#<span class="pl-k">pragma</span> comment(lib, "ntdll")

<span class="pl-k">int</span> <span class="pl-en">main</span>()
{
	<span class="pl-c"><span class="pl-c">//</span> Path to the image file from which the process will be created</span>
	UNICODE_STRING NtImagePath;
	<span class="pl-c1">RtlInitUnicodeString</span>(&amp;NtImagePath, (PWSTR)<span class="pl-s"><span class="pl-pds">L"</span><span class="pl-cce">\\</span>??<span class="pl-cce">\\</span>C:<span class="pl-cce">\\</span>Windows<span class="pl-cce">\\</span>System32<span class="pl-cce">\\</span>calc.exe<span class="pl-pds">"</span></span>);

	<span class="pl-c"><span class="pl-c">//</span> Create the process parameters</span>
	PRTL_USER_PROCESS_PARAMETERS ProcessParameters = <span class="pl-c1">NULL</span>;
	<span class="pl-c1">RtlCreateProcessParametersEx</span>(&amp;ProcessParameters, &amp;NtImagePath, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, RTL_USER_PROCESS_PARAMETERS_NORMALIZED);

	<span class="pl-c"><span class="pl-c">//</span> Initialize the PS_CREATE_INFO structure</span>
	PS_CREATE_INFO CreateInfo = { <span class="pl-c1">0</span> };
	CreateInfo.<span class="pl-smi">Size</span> = <span class="pl-k">sizeof</span>(CreateInfo);
	CreateInfo.<span class="pl-smi">State</span> = PsCreateInitialState;

	<span class="pl-c"><span class="pl-c">//</span> Initialize the PS_ATTRIBUTE_LIST structure</span>
	PPS_ATTRIBUTE_LIST AttributeList = (PS_ATTRIBUTE_LIST*)<span class="pl-c1">RtlAllocateHeap</span>(<span class="pl-c1">RtlProcessHeap</span>(), HEAP_ZERO_MEMORY, <span class="pl-k">sizeof</span>(PS_ATTRIBUTE));
	AttributeList-&gt;<span class="pl-smi">TotalLength</span> = <span class="pl-k">sizeof</span>(PS_ATTRIBUTE_LIST) - <span class="pl-k">sizeof</span>(PS_ATTRIBUTE);
	AttributeList-&gt;<span class="pl-smi">Attributes</span>[<span class="pl-c1">0</span>].<span class="pl-smi">Attribute</span> = PS_ATTRIBUTE_IMAGE_NAME;
	AttributeList-&gt;<span class="pl-smi">Attributes</span>[<span class="pl-c1">0</span>].<span class="pl-smi">Size</span> = NtImagePath.<span class="pl-smi">Length</span>;
	AttributeList-&gt;<span class="pl-smi">Attributes</span>[<span class="pl-c1">0</span>].<span class="pl-smi">Value</span> = (ULONG_PTR)NtImagePath.<span class="pl-smi">Buffer</span>;

	<span class="pl-c"><span class="pl-c">//</span> Create the process</span>
	HANDLE hProcess, hThread = <span class="pl-c1">NULL</span>;
	<span class="pl-c1">NtCreateUserProcess</span>(&amp;hProcess, &amp;hThread, PROCESS_ALL_ACCESS, THREAD_ALL_ACCESS, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, <span class="pl-c1">NULL</span>, ProcessParameters, &amp;CreateInfo, AttributeList);

	<span class="pl-c"><span class="pl-c">//</span> Clean up</span>
	<span class="pl-c1">RtlFreeHeap</span>(<span class="pl-c1">RtlProcessHeap</span>(), <span class="pl-c1">0</span>, AttributeList);
	<span class="pl-c1">RtlDestroyProcessParameters</span>(ProcessParameters);
}</pre><div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w" value="#include <Windows.h>
#include &quot;ntdll.h&quot;
#pragma comment(lib, &quot;ntdll&quot;)

int main()
{
	// Path to the image file from which the process will be created
	UNICODE_STRING NtImagePath;
	RtlInitUnicodeString(&amp;NtImagePath, (PWSTR)L&quot;\\??\\C:\\Windows\\System32\\calc.exe&quot;);

	// Create the process parameters
	PRTL_USER_PROCESS_PARAMETERS ProcessParameters = NULL;
	RtlCreateProcessParametersEx(&amp;ProcessParameters, &amp;NtImagePath, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, RTL_USER_PROCESS_PARAMETERS_NORMALIZED);

	// Initialize the PS_CREATE_INFO structure
	PS_CREATE_INFO CreateInfo = { 0 };
	CreateInfo.Size = sizeof(CreateInfo);
	CreateInfo.State = PsCreateInitialState;

	// Initialize the PS_ATTRIBUTE_LIST structure
	PPS_ATTRIBUTE_LIST AttributeList = (PS_ATTRIBUTE_LIST*)RtlAllocateHeap(RtlProcessHeap(), HEAP_ZERO_MEMORY, sizeof(PS_ATTRIBUTE));
	AttributeList->TotalLength = sizeof(PS_ATTRIBUTE_LIST) - sizeof(PS_ATTRIBUTE);
	AttributeList->Attributes[0].Attribute = PS_ATTRIBUTE_IMAGE_NAME;
	AttributeList->Attributes[0].Size = NtImagePath.Length;
	AttributeList->Attributes[0].Value = (ULONG_PTR)NtImagePath.Buffer;

	// Create the process
	HANDLE hProcess, hThread = NULL;
	NtCreateUserProcess(&amp;hProcess, &amp;hThread, PROCESS_ALL_ACCESS, THREAD_ALL_ACCESS, NULL, NULL, NULL, NULL, ProcessParameters, &amp;CreateInfo, AttributeList);

	// Clean up
	RtlFreeHeap(RtlProcessHeap(), 0, AttributeList);
	RtlDestroyProcessParameters(ProcessParameters);
}" tabindex="0" role="button">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div></div>
<p dir="auto">Compiling and running the code will pop-up the calc.exe</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/59355783/266775999-23a7949e-977c-4753-83ca-2ac1001f3762.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY3NzU5OTktMjNhNzk0OWUtOTc3Yy00NzUzLTgzY2EtMmFjMTAwMWYzNzYyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWI2YzU0ZTk3Njk4Nzk0MTZiZjc0OGIxMWE3ZjM3NmNkODVkMGQwMjMyNjIwM2FhNTBmMzQzZTNkNDFlZDUxMGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.kYc0ha8rFoC4rY7FYaxcwwyGtOHofWLDbVEHj-LsLjY"><img src="https://private-user-images.githubusercontent.com/59355783/266775999-23a7949e-977c-4753-83ca-2ac1001f3762.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTI2NzEsIm5iZiI6MTc3MTQxMjM3MSwicGF0aCI6Ii81OTM1NTc4My8yNjY3NzU5OTktMjNhNzk0OWUtOTc3Yy00NzUzLTgzY2EtMmFjMTAwMWYzNzYyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAyMTglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMjE4VDEwNTkzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWI2YzU0ZTk3Njk4Nzk0MTZiZjc0OGIxMWE3ZjM3NmNkODVkMGQwMjMyNjIwM2FhNTBmMzQzZTNkNDFlZDUxMGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.kYc0ha8rFoC4rY7FYaxcwwyGtOHofWLDbVEHj-LsLjY" alt="image" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">Conclusion</h1><a id="user-content-conclusion" class="anchor" aria-label="Permalink: Conclusion" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#conclusion"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In this, post we've seen how a normal process is created inside a Windows environment. We wrote a C++ code that spawns a process and debugged it inside a debugger to view it's inner working. Also we've taken a look at the POC that creates a process via NTAPIs. All the reference and resources are mentioned below</p>
<p dir="auto">Thank you for reading😄</p>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">References</h1><a id="user-content-references" class="anchor" aria-label="Permalink: References" href="https://github.com/Faran-17/Windows-Internals/blob/main/Processes%20and%20Jobs/Processes/Creation%20Of%20Process.md#references"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ol dir="auto">
<li><strong><a href="https://doxygen.reactos.org/" rel="nofollow">https://doxygen.reactos.org/</a></strong></li>
<li><strong><a href="https://captmeelo.com/redteam/maldev/2022/05/10/ntcreateuserprocess.html" rel="nofollow">https://captmeelo.com/redteam/maldev/2022/05/10/ntcreateuserprocess.html</a></strong></li>
<li><strong><a href="https://github.com/capt-meelo/NtCreateUserProcess">https://github.com/capt-meelo/NtCreateUserProcess</a></strong></li>
<li><strong><a href="https://github.com/winsiderss/systeminformer/blob/master/phnt/include/ntpsapi.h">https://github.com/winsiderss/systeminformer/blob/master/phnt/include/ntpsapi.h</a></strong></li>
</ol>
</article></div><button data-hotkey="Control+a"></button></section></div></div></div>   </div></div></div></div></div></div></div><div class="ScrollMarksContainer-module__scrollMarksContainer__Eu7uU" id="find-result-marks-container"></div><button data-testid="" data-hotkey="Control+F6,Control+Shift+F6" data-hotkey-scope="read-only-cursor-text-area"></button><button data-hotkey="Control+F6,Control+Shift+F6"></button></div>   </div>
</react-app>




  </div>

</turbo-frame>

    </main>
  </div>

  </div>

          



    <ghcc-consent id="ghcc" class="position-fixed bottom-0 left-0" style="z-index: 999999" data-locale="en" data-initial-cookie-consent-allowed="" data-cookie-consent-required="false" data-catalyst=""></ghcc-consent>




  <div id="ajax-error-message" class="ajax-error-message flash flash-error">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <button type="button" class="flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
</svg>
    </button>
    You can’t perform that action at this time.
  </div>

    
  <details class="details-reset details-overlay details-overlay-dark lh-default color-fg-default hx_rsm" open="">
    <summary role="button" aria-label="Close dialog"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast hx_rsm-dialog hx_rsm-modal">
      <button class="Box-btn-octicon m-0 btn-octicon position-absolute right-0 top-0" type="button" aria-label="Close dialog" data-close-dialog="">
        <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
</svg>
      </button>
      <div class="octocat-spinner my-6 js-details-dialog-spinner"></div>
    </details-dialog>
  </details>


    <div class="Popover js-hovercard-content position-absolute" style="display: none; outline: none;">
  <div class="Popover-message Popover-message--bottom-left Popover-message--large Box color-shadow-large" style="width:360px;"></div>
</div>

    
  <div class="zeroclipboard-container position-absolute right-0 top-0">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn js-clipboard-copy m-2 p-0" data-copy-feedback="Copied!" data-tooltip-direction="w">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon m-2">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div>


  <div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div>





    </div>
    <div id="js-global-screen-reader-notice" class="sr-only mt-n1" aria-live="polite" aria-atomic="true"></div>
    <div id="js-global-screen-reader-notice-assertive" class="sr-only mt-n1" aria-live="assertive" aria-atomic="true"></div>
  


<div class="sr-only mt-n1" id="screenReaderAnnouncementDiv" role="alert" data-testid="screenReaderAnnouncement" aria-live="assertive"></div><live-region>

<div id="polite" aria-live="polite" aria-atomic="true"></div>
<div id="assertive" aria-live="assertive" aria-atomic="true"></div>
</live-region></body></html>