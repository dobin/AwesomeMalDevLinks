Title:
Thread Name-Calling – using Thread Name for offense

Type:
Blog Post

Short Summary (4–8 sentences max):
- This write-up introduces “Thread Name-Calling,” a Windows process injection technique that abuses thread description APIs to implant shellcode into a remote process with atypical call patterns.  
- It uses `SetThreadDescription` to stash attacker-controlled bytes in the kernel-backed thread name (`_ETHREAD->ThreadName`), then remotely invokes `GetThreadDescription` so the target process allocates heap memory and copies that data into its working set (remote allocation + write primitive).  
- Execution is achieved via APC, leveraging the newer `Zw/NtQueueApcThreadEx2` (and Special User APC flags) to avoid requiring an alertable thread, and optionally using `RtlDispatchAPC` as a proxy callback to reduce suspicious direct shellcode APC indicators.  
- A key evasion angle is avoiding `PROCESS_VM_WRITE` by writing via thread metadata and using relatively new/less-monitored APIs, which the authors report bypassed some major AV/EDR products in testing.  
- The post also discusses limitations (e.g., RWX/RX transitions via `VirtualProtectEx`, DCP/ACG constraints, and mitigations like Win32k syscall disable) and proposes detection via ETW thread-name events.  
- Useful for red teams and malware researchers for tradecraft, and for blue teams/EDR engineers to add telemetry and detections around thread-name manipulation + APC chains.

Technical Focus:
- Thread description abuse (`GetThreadDescription` / `SetThreadDescription`, `NtSetInformationThread`, `ThreadNameInformation`)
- APC-based remote execution (`NtQueueApcThreadEx2`, Special User APC / `QueueUserAPC2`)
- Kernel storage of thread names (`_ETHREAD->ThreadName`, NonPagedPoolNx allocations)
- Remote allocation/write without `PROCESS_VM_WRITE` (heap allocation side effect of `GetThreadDescription`)
- Memory protection changes for execution (`VirtualProtectEx`, RWX/RX tradeoffs)
- ETW-based detection opportunities (thread set-name events)

Use Cases:
- Stealthier remote shellcode injection into an existing process without `WriteProcessMemory`
- EDR bypass research by using uncommon API sequences and newer syscalls
- DLL injection variant where the DLL path is delivered via thread name and executed via APC + `LoadLibraryW`
- Defensive engineering: build detections correlating thread-name set events with APC queuing and subsequent memory-protection changes

Keywords:
process injection, T1055, thread description, SetThreadDescription, GetThreadDescription, ThreadNameInformation, NtSetInformationThread, NtQueryInformationThread, _ETHREAD, NonPagedPoolNx, APC injection, NtQueueApcThreadEx2, QueueUserAPC2, Special User APC, RtlDispatchAPC, VirtualProtectEx, RWX, PEB SpareUlongs, ETW, defense evasion, Windows 10 19045, Windows 11 22621