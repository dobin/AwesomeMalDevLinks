Title:
Havoc C2 with AV/EDR Bypass Methods in 2024 (Part 1)

Type:
Blog Post

Short Summary (4–8 sentences max):
- Walkthrough of building a multi-stage implant chain that ultimately lands a Havoc C2 “Demon” agent while attempting to evade AV/EDR and basic network detection.  
- Uses a staged design: a small Stage 1 reverse_https payload (Metasploit/custom msfvenom) to deliver a larger Stage 2 Havoc payload over HTTPS, then establishes C2 to the Havoc teamserver.  
- Focuses on making traffic and artifacts less suspicious via custom TLS certificates, URIs, headers/user-agents, and HTTPS listeners, plus discusses Havoc options like indirect syscalls and sleep obfuscation (Foliage/ROP).  
- Execution is achieved via DLL side-loading with DLL proxying (using Spartacus to identify hijackable DLLs/exports) against a legitimate signed application (SumatraPDF installer) to avoid obvious LOLBins like rundll32/PowerShell.  
- Iterates on Defender detections by moving hardcoded shellcode out of the DLL and fetching it remotely (fileless-ish loader via Winsock), then adds basic memory-permission/thread-suspension tricks to reduce scanning at execution time.  
- Includes Wireshark observations comparing the staged TLS traffic patterns to normal HTTPS behavior.  
- Most useful for red teamers/pentesters building custom loaders/stagers around Havoc; also useful for defenders to understand common evasion tradecraft and telemetry points.

Technical Focus:
- Havoc C2 Demon staging and HTTPS listener customization
- Metasploit custom reverse_https stager (msfvenom) and staged shellcode delivery
- DLL side-loading + DLL proxying (export forwarding) using Spartacus
- Windows shellcode execution primitives (VirtualAllocEx, WriteProcessMemory, CreateRemoteThread, ResumeThread)
- Sleep obfuscation / ROP-based “Foliage”, indirect syscalls, ETW/AMSI evasion concepts (hardware breakpoints reference)
- Network evasion basics: custom TLS certs, URIs, user-agents, jitter; PCAP inspection

Use Cases:
- Build a staged Havoc deployment chain with a small on-disk loader and larger in-memory agent
- Create a proxy DLL that preserves application functionality while executing a payload
- Reduce static detections by removing embedded shellcode and retrieving payloads over HTTP/HTTPS
- Test/validate EDR detections around DLL hijacking, thread creation, and memory permission changes
- Generate more realistic C2 network indicators for purple-team exercises

Keywords:
Havoc C2, Demon agent, AV evasion, EDR bypass, staged payload, msfvenom, Metasploit multi/handler, windows/x64/custom/reverse_https, HTTPS C2, TLS certificate, user-agent spoofing, custom URI, DLL side-loading, DLL proxying, export forwarding, Spartacus, DWrite.dll hijack, SumatraPDF, VirtualAllocEx, WriteProcessMemory, CreateRemoteThread, VirtualProtectEx, ResumeThread, indirect syscalls, ETW, AMSI, sleep obfuscation, ROP chain, NtApcQueueThread, RtlCreateTimer, Winsock2, Wireshark PCAP