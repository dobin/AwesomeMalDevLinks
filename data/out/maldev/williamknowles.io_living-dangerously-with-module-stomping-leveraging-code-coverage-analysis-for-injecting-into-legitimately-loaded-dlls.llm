Title:
Living Dangerously with Module Stomping: Leveraging Code Coverage Analysis for Injecting into Legitimately Loaded DLLs

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes a “mini” variant of module stomping where code is injected into *already legitimately loaded* DLLs by overwriting memory regions that are not executed during normal runtime.  
- The goal is to avoid suspicious module loads (and least-frequency/hunting anomalies) while still having malicious code appear to reside inside a legitimate module listed in the PEB.  
- It uses code coverage analysis (DynamoRIO’s `drcov`) to map which DLL offsets are executed, then identifies large untouched regions suitable for payload placement.  
- The author provides scripts to parse `drcov` output and a test injector that can write shellcode at a chosen DLL+offset, including handling Control Flow Guard (CFG) call target constraints via alignment/patching.  
- It highlights practical limitations: payload behavior can change coverage, complex implants may load additional DLLs (reducing stealth), and OS version/patch differences can invalidate offsets and crash processes.  
- Useful for red teamers and implant developers exploring stealthier in-memory placement and evasion tradeoffs versus traditional module stomping.

Technical Focus:
- Module stomping / “mini stomp” into unused DLL regions
- Code coverage collection with DynamoRIO `drcov`
- Parsing executed basic blocks to find non-executed address ranges
- Windows PEB loaded module list / module-backed memory camouflage
- Control Flow Guard (CFG) valid call target considerations
- Position-independent code (PIC) shellcode vs reflective loaders

Use Cases:
- Selecting safe injection offsets inside legitimately loaded DLLs for a target process
- Reducing suspicious DLL load artifacts compared to classic module stomping
- Testing payload stability across Windows versions/patch levels using coverage-driven validation
- Building/validating PIC shellcode that executes in-place without new allocations

Keywords:
module stomping, mini stomp, code coverage, DynamoRIO, drcov, DLL injection, PEB, loaded module list, in-memory evasion, unused code regions, Windows 10, Control Flow Guard, CFG, call targets, PIC shellcode, reflective loader, Cobalt Strike Beacon, process injection, memory overwrite, threat hunting least-frequency analysis