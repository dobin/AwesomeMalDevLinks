Title:
Direct Syscalls: A journey from high to low

Type:
Blog Post

Short Summary (4–8 sentences max):
- Walkthrough explaining Windows system calls and how “direct syscalls” embed syscall stubs in a payload to avoid calling native APIs via `ntdll.dll`, a common user-mode hooking target for EDRs.  
- It frames the problem as EDR inline-hooking of selected `ntdll` exports (e.g., `NtAllocateVirtualMemory`) and shows why bypassing user-mode hooks matters for shellcode loaders/droppers.  
- The post incrementally builds a C++ shellcode dropper in Visual Studio across three stages: Win32 APIs (kernel32), Native APIs (ntdll), then direct syscalls generated with SysWhispers2 + MASM stubs.  
- It demonstrates validation/analysis using API Monitor, dumpbin import inspection, and x64dbg to confirm where the `syscall` instruction executes from (ntdll `.text` vs the dropper’s `.text`).  
- Includes a bonus technique for storing shellcode as a PE resource (`.bin`) and loading it at runtime.  
- Useful primarily for red teamers, offensive tool developers, and malware researchers; also relevant to blue teams for understanding syscall-based evasion tradeoffs and artifacts.

Technical Focus:
- Windows syscall path (user-mode → KiSystemCall64 → SSDT)
- User-mode inline API hooking in `ntdll.dll` and evasion rationale
- Shellcode loader/dropper construction (alloc/write/execute)
- Native API usage (`Nt*`) vs Win32 API usage (`VirtualAlloc`, etc.)
- SysWhispers2-generated syscall stubs (MASM) and Visual Studio integration
- Tooling for verification: API Monitor, dumpbin, x64dbg/WinDbg

Use Cases:
- Build and test syscall-based shellcode loaders to reduce exposure to user-mode hooks
- Compare detection surface between Win32, Native API, and direct-syscall implementations
- Validate whether syscalls originate from `ntdll` or from a custom PE `.text` section
- Package stageless payloads as PE resources and execute them in-memory

Keywords:
Windows syscalls, direct syscalls, indirect syscalls, EDR evasion, user-mode hooking, inline hook, trampoline JMP, ntdll.dll, kernel32.dll, KiSystemCall64, SSDT, NtAllocateVirtualMemory, NtWriteVirtualMemory, NtCreateThreadEx, NtWaitForSingleObject, NtClose, SysWhispers2, MASM, x64dbg, WinDbg, API Monitor, dumpbin, shellcode loader, PE sections, resource embedding