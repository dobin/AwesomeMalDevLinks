Title:
Windows Process Internals: A few Concepts to know before jumping on Memory Forensics [Part 4] — VADs

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains Windows Virtual Address Descriptors (VADs) and how the kernel memory manager tracks each process’s virtual memory ranges using a VAD AVL tree.  
- It focuses on Windows 10 (build 18362.1016) and walks through locating a process’s VadRoot via `_EPROCESS`, then traversing `RTL_AVL_TREE` / `RTL_BALANCED_NODE` nodes that correspond to `_MMVAD` / `_MMVAD_SHORT`.  
- The article shows how to identify VAD node “tags” (e.g., `Vad`) and how mapped-file metadata is stored in the VAD’s `Subsection -> ControlArea -> FilePointer` chain.  
- A key practical detail is decoding the `FilePointer` as an `_EX_FAST_REF` (masking low bits) to recover the real `_FILE_OBJECT` pointer and extract the full on-disk path of a mapped image.  
- It also covers VAD flags such as `Protection` and `VadType` (e.g., `VadImageMap`) to interpret memory protections and image mappings.  
- Useful for DFIR/memory forensics practitioners and red teamers validating injection/unlinking artifacts, because VADs can retain mapping evidence even when user-mode PEB module lists are tampered with.

Technical Focus:
- VAD trees (VadRoot) and `_EPROCESS` linkage
- `RTL_AVL_TREE` / `RTL_BALANCED_NODE` traversal and `_MMVAD` structures
- VAD tags and node classification (`Vad`, `_MMVAD_SHORT`)
- Mapped-file resolution via `Subsection`, `ControlArea`, `_EX_FAST_REF`, `_FILE_OBJECT`
- VAD flags: `Protection`, `VadType` (e.g., `VadImageMap`)
- Volatility concepts/plugins: `vadinfo`, `vadtree`, `vaddump` (data sources)

Use Cases:
- Recover full paths of mapped EXEs/DLLs from memory images
- Detect hidden/unlinked modules by comparing VAD-backed mappings vs PEB loader lists
- Triage suspicious RX/RWX regions by inspecting VAD protection and type
- Support investigation of injection techniques (DLL injection, reflective loading) via VAD anomalies
- Build/validate custom memory forensics tooling that parses VAD-related kernel structures

Keywords:
Windows memory manager, VAD, Virtual Address Descriptor, VadRoot, VAD tree, RTL_AVL_TREE, RTL_BALANCED_NODE, _MMVAD, _MMVAD_SHORT, _EPROCESS, kernel structures, Volatility, vadtree, vadinfo, vaddump, Subsection, ControlArea, _EX_FAST_REF, _FILE_OBJECT, VadType, VadImageMap, Protection flags, EXECUTE_WRITECOPY, PEB, Ldr modules, memory forensics, DFIR, Windows 10 18362.1016