Title:
No-Alloc No-Problem: Leveraging Program Entry Points for Process Injection

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes two remote process injection techniques that avoid explicit remote memory allocation (e.g., VirtualAllocEx) and avoid creating new threads or manipulating thread contexts.  
- The first technique overwrites a suspended process’s PE AddressOfEntryPoint by locating the remote image base via the PEB (NtQueryInformationProcess + ReadProcessMemory), parsing headers, then WriteProcessMemory’ing shellcode to the entry point and resuming the main thread.  
- The second (“ThreadQuery”) technique uses NtQueryInformationThread with ThreadQuerySetWin32StartAddress to retrieve the primary thread’s Win32 start address (which resolves to the program entry point during initialization), overwrites that address with shellcode, and resumes execution.  
- The author validates the ThreadQuery assumption with debugging (x64dbg) and notes that the thread initially starts in ntdll (RtlUserThreadStart) before reaching the resolved entry point.  
- Defensive notes include potential telemetry around security mitigation failures (e.g., VTGuard/_report_securityfailure) and a sample YARA rule to flag binaries importing common APIs used in these flows.  
- Useful for red teams and malware developers looking for lower-noise injection primitives, and for blue teams building detections around entry-point stomping patterns.

Technical Focus:
- PE Optional Header AddressOfEntryPoint stomping
- Suspended process creation and early-process module state (image + ntdll)
- PEB discovery via NtQueryInformationProcess and remote header parsing
- NtQueryInformationThread(ThreadQuerySetWin32StartAddress) start-address discovery
- WriteProcessMemory-based entry point overwrite and ResumeThread execution
- Detection ideas: stack/mitigation artifacts and YARA import heuristics

Use Cases:
- Remote code execution in a newly spawned suspended process without VirtualAllocEx/CreateRemoteThread
- EDR-evasion research comparing alerting on allocation/thread-creation vs entry-point overwrite
- Building PoCs for alternative injection tradecraft (entry point stomping variants)
- Defensive hunting for suspicious CreateProcess(CREATE_SUSPENDED)+WriteProcessMemory+ResumeThread chains
- YARA-based triage of tooling that implements entry-point injection patterns

Keywords:
process injection, AddressOfEntryPoint, PE Optional Header, entry point stomping, CREATE_SUSPENDED, PEB, NtQueryInformationProcess, NtQueryInformationThread, ThreadQuerySetWin32StartAddress, ReadProcessMemory, WriteProcessMemory, ResumeThread, ntdll, RtlUserThreadStart, x64dbg, EDR evasion, VTGuard, _report_securityfailure, YARA rule, MITRE ATT&CK T1055