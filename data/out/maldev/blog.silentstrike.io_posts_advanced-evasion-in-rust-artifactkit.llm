Title:
Advanced Evasion in Rust‑Based ArtifactKit: Techniques, CobaltStrike Integration, and Defensive Analysis

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post analyzes a Rust-based Windows artifact loader template designed to reduce common static and behavioral detection signals seen in traditional shellcode loaders.  
- It focuses on concepts like eliminating static imports via compile-time API hashing and PEB/EAT-based dynamic resolution, avoiding RWX memory permission flips using dual-mapped section objects, and avoiding new thread creation by executing via fibers.  
- It also explains how a Cobalt Strike CNA/Aggressor script “patches” a template using a strict marker-and-container contract (marker buffers, header + encrypted blob, rolling XOR keying, bounds checks) to produce per-task artifacts.  
- An optional overview covers direct syscall dispatch as a way to reduce exposure to user-mode API hooks.  
- The defensive half provides hunting heuristics and telemetry ideas (ETW/EDR memory signals, dual mapping detection, fiber API anomalies, export parsing patterns, XOR decode loops near opaque blobs) plus high-level ATT&CK mappings.  
- It’s useful for detection engineers/blue teams building behavioral detections, and for red team toolsmiths studying how Rust and loader design choices shift the detection surface.

Technical Focus:
- PEB walking and Export Address Table (EAT) parsing for dynamic API resolution
- Compile-time API hashing and forwarder export handling
- NT section objects with dual mapping (RW + RX views) to avoid `VirtualProtect` RWX transitions
- Fiber-based execution (`ConvertThreadToFiber`/`CreateFiber`/`SwitchToFiber`) as a threadless trampoline
- Marker-based CNA/Aggressor patching and embedded container ABI (header + encrypted blob)
- Detection engineering: ETW/EDR correlation for map-view, image load, and execution anomalies

Use Cases:
- Build detections for dual-mapped section execution and RX memory not backed by files
- Hunt for fiber API usage patterns in non-GUI/service processes
- Identify loaders that resolve APIs via export scanning without `LoadLibrary`
- Create YARA/behavioral analytics for short-key XOR decode loops adjacent to opaque data blobs
- Validate EDR coverage against section mapping, syscall usage, and threadless execution tradecraft

Keywords:
Rust, Cobalt Strike, Artifact Kit, CNA, Aggressor Script, Windows internals, PEB, EAT parsing, API hashing, dynamic API resolution, forwarded exports, NtCreateSection, NtMapViewOfSection, section object, dual mapping, RW/RX views, VirtualProtect avoidance, fibers, ConvertThreadToFiber, CreateFiber, SwitchToFiber, direct syscalls, ETW, EDR evasion, memory telemetry, MITRE ATT&CK T1055, T1027, T1106