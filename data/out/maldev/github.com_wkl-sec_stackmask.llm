Title:
StackMask (Masking the Implant with Stack Encryption)

Type:
GitHub Tool

Short Summary (4–8 sentences max):
StackMask is a proof-of-concept demonstrating how to encrypt a thread’s stack before entering a custom “sleep” routine to reduce in-memory artifacts during idle periods. It targets the common detection surface where EDRs snapshot memory (including stack contents) while implants are sleeping or waiting. The PoC retrieves the current stack pointer (RSP), uses `VirtualQuery` to determine the stack memory region boundaries, then encrypts that range. To avoid instability while modifying stack memory, the workflow includes suspending the thread prior to encryption. The “sleep” mechanism leverages CPU cycles (time-based evasion) rather than a straightforward `Sleep()` call, referencing prior work on sandbox/analysis evasion. It’s primarily useful for red team operators and malware developers exploring in-memory stealth and anti-analysis tradecraft.

Technical Focus:
- Stack boundary discovery via RSP and `VirtualQuery`
- In-place stack encryption/decryption around sleep
- Thread suspension to safely modify stack memory
- Custom sleep using CPU-cycle/time-based techniques
- Windows virtual memory page querying and protections

Use Cases:
- Reduce stack-based forensic artifacts during implant sleep/idle
- Experiment with EDR evasion concepts around memory snapshotting
- Research custom sleep implementations that avoid `Sleep()` telemetry
- Prototype defensive detections for anomalous stack memory changes

Keywords:
Windows, stack encryption, RSP, VirtualQuery, virtual memory, thread suspension, custom sleep, CPU cycles, time-based evasion, in-memory evasion, EDR bypass, implant masking, memory artifacts, C, PoC, sandbox evasion, runtime encryption, stack region discovery