Title:
Malware Development: Crafting Digital Chaos (05) — C2 Connection

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post walks through building a simple Windows “bot” that polls a basic HTTP server for commands and changes behavior based on the response.  
- It uses a hosted HTML page as the command container, extracting a 3-character opcode from within `<strong>` tags to reduce obviousness versus plain-text command files.  
- The bot implements C2 over WinINet (InternetOpenW/InternetOpenUrlW/InternetReadFile), converts the received bytes to UTF-16 with MultiByteToWideChar, then parses the HTML to dispatch actions.  
- Two example actions are implemented: registry-based persistence via `SOFTWARE\Microsoft\CurrentVersion\Run` (RegCreateKeyExA/RegSetValueExA) and dropping a file into `%TEMP%` (GetTempPathA/CreateFileA/WriteFile).  
- It’s useful for malware dev learners, red teamers building custom implants, and defenders wanting a clear example of basic HTTP beaconing + simple tasking.  
- The interesting part is the end-to-end minimal C2 loop: fetch → decode → parse → execute, using common Windows APIs that frequently appear in commodity malware.

Technical Focus:
- WinINet HTTP communication (InternetOpenW, InternetOpenUrlW, InternetReadFile)
- HTML-based command/tasking and string parsing (wcsstr, wcsncpy_s, wcscmp)
- Byte-to-wide string conversion (MultiByteToWideChar, UTF-8 → UTF-16)
- Registry Run-key persistence (RegCreateKeyExA, RegSetValueExA, HKLM/HKCU)
- File dropper behavior in TEMP (GetTempPathA, CreateFileA, WriteFile)
- Memory allocation/handling (LocalAlloc, pointer-to-pointer output)

Use Cases:
- Build a minimal HTTP polling implant for lab environments
- Prototype tasking/dispatch logic for a custom agent (opcode → function mapping)
- Demonstrate common persistence via Run keys for training/detections
- Create simple file-drop behaviors (notes, decoys, staging artifacts)
- Blue team: write detections for WinINet beaconing + Run-key modifications + TEMP file writes

Keywords:
C2, command-and-control, WinINet, InternetOpenW, InternetOpenUrlW, InternetReadFile, HTTP beaconing, HTML tasking, MultiByteToWideChar, UTF-8, UTF-16, wcsstr, registry persistence, Run key, RegCreateKeyExA, RegSetValueExA, HKEY_LOCAL_MACHINE, HKEY_CURRENT_USER, GetTempPathA, CreateFileA, WriteFile, LocalAlloc