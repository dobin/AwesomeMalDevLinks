Title:
Going Native: Malicious Native Applications

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post explains how to build and use Windows “Native” subsystem executables that rely only on NTDLL and the Native API (NtAPI), bypassing the usual WinAPI/Windows Subsystem DLL dependencies (e.g., kernel32/kernelbase).  
- It highlights offensive advantages such as reduced imports/IAT footprint, direct access to lower-level Nt* functions, and practical resistance to common user-mode DLL injection/hooking used by some security products and analysis tools.  
- The author shows how to compile native apps (NtProcessStartup entry point, /Subsystem:Native, linking ntdll, using PHNT headers) and how to launch them using RtlCreateUserProcess (via NativeRun).  
- A full NtAPI-based remote process injection chain is demonstrated (NtGetNextProcess → NtAllocateVirtualMemory → NtWriteVirtualMemory → NtProtectVirtualMemory → NtCreateThreadEx).  
- The post also explores early-boot execution via the BootExecute registry value, using that context to drop a conventional Windows payload into Startup for later execution and to write into normally protected directories (e.g., Windows Defender paths) using NtCreateFile/NtWriteFile.  
- It’s most useful for red team tool developers and malware researchers interested in subsystem-level tradeoffs, early-boot persistence, and evasion of user-mode instrumentation.

Technical Focus:
- Windows Native subsystem executables (/Subsystem:Native) and NtProcessStartup
- Direct NtAPI usage via ntdll.dll exports and PHNT headers
- NtAPI-based remote process injection (memory alloc/write/protect + NtCreateThreadEx)
- Early-boot persistence via HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\BootExecute
- File operations in boot context (NtCreateFile, NtWriteFile, NtDeleteFile) and privilege implications
- Evasion/limitations of user-mode hooks and DLL-based tracers/instrumentation

Use Cases:
- Develop implants that avoid common user-mode API hooking/injected security DLLs
- Implement NtAPI-only process injection from a native process
- Execute code very early in boot via BootExecute to stage payloads before userland defenses initialize
- Drop secondary Windows-subsystem payloads to autostart locations (e.g., Startup folder)
- Write/delete files in directories normally protected from admin writes (boot-context access testing)

Keywords:
Windows Native API, NtAPI, ntdll.dll, Native subsystem, /Subsystem:Native, NtProcessStartup, PHNT, System Informer headers, RtlCreateUserProcess, NativeRun, user-mode hooking, DLL injection, IAT reduction, NtGetNextProcess, NtAllocateVirtualMemory, NtWriteVirtualMemory, NtProtectVirtualMemory, NtCreateThreadEx, remote process injection, BootExecute, Session Manager, early boot persistence, NtCreateFile, NtWriteFile, NtDeleteFile, Windows Defender directory permissions, Autoruns blind spot