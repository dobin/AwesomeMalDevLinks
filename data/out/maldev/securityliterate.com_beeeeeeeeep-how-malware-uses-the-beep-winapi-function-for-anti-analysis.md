# https://securityliterate.com/beeeeeeeeep-how-malware-uses-the-beep-winapi-function-for-anti-analysis/

[![Big beep robot](https://i0.wp.com/securityliterate.com/wp-content/uploads/2024/05/screenshot-2024-05-15-at-215701.png?resize=720%2C576&ssl=1)](https://securityliterate.com/beeeeeeeeep-how-malware-uses-the-beep-winapi-function-for-anti-analysis/)

I was recently analyzing a malware sample that abuses the Beep function as an interesting evasion tactic. The [Beep](https://learn.microsoft.com/en-us/windows/win32/api/utilapiset/nf-utilapiset-beep) function basically plays an audible tone notification for the user. The Beep function accepts a parameter _DelayInterval_, which is the number of milliseconds to play the beep sound. The calling program’s thread that executed the function will “pause” execution for the duration of the beep. This can be an interesting anti-sandbox and anti-debugging technique. Let’s take a deeper look at the Beep function.

## How Beep Works

When a program invokes the Beep function, it ultimately calls into a function called [NtDelayExecution](http://undocumented.ntinternals.net/index.html?page=UserMode%2FUndocumented%20Functions%2FNT%20Objects%2FThread%2FNtDelayExecution.html), which does exactly as it is titled: It delays execution of the calling program’s running thread. The below image illustrates how this essentially works:

![](https://i0.wp.com/securityliterate.com/wp-content/uploads/2024/05/image-1.png?resize=278%2C313&ssl=1)

The calling program (in this case, the malware), calls Beep, which further calls into NtDelayExecution. Once the beep duration has been met, control flow is passed back to the malware.

Here is a function trace from API Monitor, showing the same thing. Notice how Beep invokes several other lower level functions, including DeviceIOControl (to play the audible beep sound via hardware) and the call to NtDelayExecution:

![](https://i0.wp.com/securityliterate.com/wp-content/uploads/2024/05/image-2.png?resize=640%2C114&ssl=1)

As a side note, as the Beep function was originally intended to play an audible “beeeep!” when executed, it accepts a parameter called _dwFreq_ which denotes a frequency of the beep sound, in hertz. This means that the calling program can decide the type of the tone that is played when Beep executes. This particular malware doesn’t play a tone when calling beep, but I think this would be a funny technique for malware to use; annoy the victim (or malware analyst). You may also wonder why the malware can’t just call NtDelayExecution directly. This would also work, but may appear more obvious to malware analysts and researchers. Anyway, it’s much more fun to use Beep than to call NtDelayExecution directly.

## The Malware

The malware I was investigating calls the Beep function with a _DelayInterval_ parameter of _65000_ milliseconds (which will stall analysis for about 1 minute). It also calls this Beep function multiple times for added delay. This will cause the sandbox to stall for potentially log periods of time. If the malware is being debugged, the analyst will temporarily lose control of the malware as the thread is “paused”. Here is an excerpt of this code in IDA Pro:

![](https://i0.wp.com/securityliterate.com/wp-content/uploads/2024/05/image-3.png?resize=640%2C271&ssl=1)

## Sandbox and Debugger Mitigations

To mitigate this technique, the sandbox should hook the NtDelayExecution function and modify the _DelayInterval_ parameter to artificially decrease any delay. In a debugger, the malware analyst can set a breakpoint on NtDelayExecution or the Beep function and modify the _DelayInterval_ parameter in the same way.

## Other References

While researching this malware, I ran across an article from researcher Natalie Zargarov from [Minerva Labs](https://thehackernews.com/2023/02/experts-warn-of-beep-new-evasive.html) who wrote about this same technique in 2023 used in a different malware family.

Thanks for reading!

— Kyle Cucci ( [@d4rksystem](https://twitter.com/d4rksystem))

https://thehackernews.com/2023/02/experts-warn-of-beep-new-evasive.html

### Share this:

- [Share on X (Opens in new window)X](https://securityliterate.com/beeeeeeeeep-how-malware-uses-the-beep-winapi-function-for-anti-analysis/?share=twitter&nb=1)
- [Share on Facebook (Opens in new window)Facebook](https://securityliterate.com/beeeeeeeeep-how-malware-uses-the-beep-winapi-function-for-anti-analysis/?share=facebook&nb=1)

### Like this:

LikeLoading...

### _Related_

[Malware Analysis in 5 Minutes: Identifying Evasion and Guardrail Techniques with CAPA](https://securityliterate.com/malware-analysis-identifying-evasion-and-guardrail-techniques-with-capa/ "Malware Analysis in 5 Minutes: Identifying Evasion and Guardrail Techniques with CAPA")August 26, 2021In "Malware Analysis"

[Unpacking StrelaStealer](https://securityliterate.com/unpacking-strela-stealer/ "Unpacking StrelaStealer")March 14, 2024In "Forensics"

[Go Big or Go Home (and Other Terrible Go Puns): Tips for Analyzing GoLang Malware](https://securityliterate.com/go-big-or-go-home-and-other-terrible-go-puns-tips-for-analyzing-golang-malware/ "Go Big or Go Home (and Other Terrible Go Puns): Tips for Analyzing GoLang Malware")July 14, 2025In "Malware Analysis"

Comments are closed.

### Search Posts

Search for:Search

### Recent Posts

- [Deceiving the Deceivers: A Review of Deception Pro](https://securityliterate.com/deceiving-the-deceivers-a-review-of-deception-pro/)
- [Elephant in the Sandbox: Analyzing DBatLoader’s Sandbox Evasion Techniques](https://securityliterate.com/elephant-in-the-sandbox-blah/)
- [Go Big or Go Home (and Other Terrible Go Puns): Tips for Analyzing GoLang Malware](https://securityliterate.com/go-big-or-go-home-and-other-terrible-go-puns-tips-for-analyzing-golang-malware/)
- [“Beeeeeeeeep!”. How Malware Uses the Beep WinAPI Function for Anti-Analysis](https://securityliterate.com/beeeeeeeeep-how-malware-uses-the-beep-winapi-function-for-anti-analysis/)
- [Unpacking StrelaStealer](https://securityliterate.com/unpacking-strela-stealer/)

### Recent Comments

- [Fileless attacks: How attackers evade traditional AV and how to stop them – Computer Security Articles](http://www.palada.net/index.php/2023/04/27/news-15599/) on [Malware Analysis in 5-Minutes: Deobfuscating PowerShell Scripts](https://securityliterate.com/malware-analysis-in-5-minutes-deobfuscating-powershell-scripts/#comment-340)
- [Where do entries from regsvr32-registered DLLs get stored - Boot Panic](https://bootpanic.com/where-do-entries-from-regsvr32-registered-dlls-get-stored/) on [Chantay’s Resume: Investigating a CV-Themed ZLoader Malware Campaign](https://securityliterate.com/chantays-resume-investigating-a-cv-themed-zloader-malware-campaign/#comment-327)

### Archives

- [January 2026](https://securityliterate.com/2026/01/)
- [September 2025](https://securityliterate.com/2025/09/)
- [July 2025](https://securityliterate.com/2025/07/)
- [May 2024](https://securityliterate.com/2024/05/)
- [March 2024](https://securityliterate.com/2024/03/)
- [January 2024](https://securityliterate.com/2024/01/)
- [July 2023](https://securityliterate.com/2023/07/)
- [June 2023](https://securityliterate.com/2023/06/)
- [May 2023](https://securityliterate.com/2023/05/)
- [August 2021](https://securityliterate.com/2021/08/)
- [January 2021](https://securityliterate.com/2021/01/)
- [December 2020](https://securityliterate.com/2020/12/)
- [August 2020](https://securityliterate.com/2020/08/)
- [April 2020](https://securityliterate.com/2020/04/)
- [January 2020](https://securityliterate.com/2020/01/)
- [October 2019](https://securityliterate.com/2019/10/)
- [June 2019](https://securityliterate.com/2019/06/)
- [February 2018](https://securityliterate.com/2018/02/)
- [September 2017](https://securityliterate.com/2017/09/)
- [August 2017](https://securityliterate.com/2017/08/)

### Categories

- [Evasive Malware Book](https://securityliterate.com/category/evasive-malware-book/)
- [Forensics](https://securityliterate.com/category/forensics/)
- [Malware Analysis](https://securityliterate.com/category/malware-analysis/)
- [Product Reviews](https://securityliterate.com/category/product-reviews/)
- [Recon](https://securityliterate.com/category/recon/)

### Meta

- [Log in](https://securityliterate.com/wp-login.php)
- [Entries feed](https://securityliterate.com/feed/)
- [Comments feed](https://securityliterate.com/comments/feed/)
- [WordPress.org](https://wordpress.org/)

[Toggle photo metadata visibility](https://securityliterate.com/beeeeeeeeep-how-malware-uses-the-beep-winapi-function-for-anti-analysis/#)[Toggle photo comments visibility](https://securityliterate.com/beeeeeeeeep-how-malware-uses-the-beep-winapi-function-for-anti-analysis/#)

Loading Comments...

Write a Comment...

EmailNameWebsite

%d