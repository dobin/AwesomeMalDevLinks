# https://trickster0.github.io/posts/Custom-ReadMemory-API/

<!DOCTYPE html><html lang="en"><body data-spy="scroll" data-target="#toc"><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="https://trickster0.github.io/"> Home </a> </span> <span>Custom ReadMemory API</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip="">Custom ReadMemory API</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> trickster0 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Sun, Feb 13, 2022, 12:00 AM +0800">Feb 13, 2022 <i class="unloaded">2022-02-13T00:00:00+08:00</i></span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Sun, Feb 13, 2022, 2:32 PM +0200">Feb 13, 2022 <i class="unloaded">2022-02-13T20:32:43+08:00</i></span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="293 words">1 min read</span></div></div><div class="post-content"><p>After the great job and inspiration by <a href="https://twitter.com/x86matthew">x86matthew</a> and his <a href="https://www.x86matthew.com/view_post?id=read_write_proc_memory">blogpost</a> I decided to play with it as well for x64 bit.<br> The NTAPI function in this method is RtlFirstEntrySList from ntdll.dll. Its definition like Matthew mentioned in his blog is similar like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" data-lang="plaintext"><button data-original-title="" title=""><i class="fa-fw far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>DWORD RtlFirstEntrySList(DWORD* Address)
</pre></td></tr></tbody></table></code></div></div><p>In his blog, only the x86 version is referenced and used, so I was curious and took a look myself.<br> Unfortunately, in x64 bit the actual function looks like this:</p><p><a href="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/pre-mod.png" class="img-link"><img data-proofer-ignore="" data-src="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/pre-mod.png" alt="" src="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/pre-mod.png" data-loaded="true"></a></p><p>We can see that there are 2 minor issues in the x64 bit version of this function, first one is that the argument of RtlFirstEntrySList will be +8, <code class="language-plaintext highlighter-rouge">mov rax, qword ptr(rcx+8)</code> which is easy to solve by just adding -8 in the passed address argument.<br> FYI, for my POC, I am just reading the address of RtlFirstEntrySList but using reference of its address.<br> You can alter it be removing the reference(&amp;) to just read the contents of that address.<br> First issue bypassed! Second one is not possible to evade that easy since it will perform <code class="language-plaintext highlighter-rouge">and al, 0F0h</code> in the byte we want to fetch, hence losing the accuracy of the byte and obtaing a completely wrong address.<br> The only way around this would be to patch the 2 bytes that perform the logical AND instruction like I do so, in the POC with WriteProcessMemory.<br> After patching the 2 bytes our function will look like this and it will be executed via NTDLL as normal.</p><p><a href="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/after-mod.png" class="img-link"><img data-proofer-ignore="" data-src="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/after-mod.png" alt="" src="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/after-mod.png" data-loaded="true"></a></p><p>Obviously the result will come back as little endian, but you can always allocate the bytes in a buffer and print or use them in a proper manner.</p><p><a href="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/output-mod.png" class="img-link"><img data-proofer-ignore="" data-src="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/output-mod.png" alt="" src="https://github.com/trickster0/trickster0.github.io/raw/master/assets/img/favicons/output-mod.png" data-loaded="true"></a></p><p>POC: <a href="https://github.com/trickster0/CReadMemory">https://github.com/trickster0/CReadMemory</a></p><p>Make sure you read the blog posts and research of Matthew, there are some great stuff on his blog.</p></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Custom%20ReadMemory%20API%20-%20trickster0%27s%20Nest&amp;url=https://trickster0.github.io/posts/Custom-ReadMemory-API/" data-toggle="tooltip" data-placement="top" title="" target="_blank" rel="noopener" aria-label="Twitter" data-original-title="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Custom%20ReadMemory%20API%20-%20trickster0%27s%20Nest&amp;u=https://trickster0.github.io/posts/Custom-ReadMemory-API/" data-toggle="tooltip" data-placement="top" title="" target="_blank" rel="noopener" aria-label="Facebook" data-original-title="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Custom%20ReadMemory%20API%20-%20trickster0%27s%20Nest&amp;url=https://trickster0.github.io/posts/Custom-ReadMemory-API/" data-toggle="tooltip" data-placement="top" title="" target="_blank" rel="noopener" aria-label="Telegram" data-original-title="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="" data-original-title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="https://trickster0.github.io/posts/Primitive-Injection/">Primitive Injection - Breaking the Status Quo</a></li><li><a href="https://trickster0.github.io/posts/Custom-ReadMemory-API/">Custom ReadMemory API</a></li><li><a href="https://trickster0.github.io/posts/Halo's-Gate-Evolves-to-Tartarus-Gate/">Halo's Gate Evolves -&gt; Tartarus' Gate</a></li><li><a href="https://trickster0.github.io/posts/Solving-the-BFS-EkoParty/">Solving the BFS Ekoparty 2019 Exploitation Challenge</a></li><li><a href="https://trickster0.github.io/posts/earlybird-apc-queue-injection-with-processstatechange-a-twist/">EarlyBird APC Queue Injection With a ProcessStateChange Twist</a></li></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="https://trickster0.github.io/tags/hacking/">hacking</a> <a class="post-tag" href="https://trickster0.github.io/tags/vulnhub/">vulnhub</a> <a class="post-tag" href="https://trickster0.github.io/tags/vm/">vm</a> <a class="post-tag" href="https://trickster0.github.io/tags/challenge/">challenge</a> <a class="post-tag" href="https://trickster0.github.io/tags/challenges/">challenges</a> <a class="post-tag" href="https://trickster0.github.io/tags/hack/">hack</a> <a class="post-tag" href="https://trickster0.github.io/tags/0/">%0</a> <a class="post-tag" href="https://trickster0.github.io/tags/asa/">asa</a> <a class="post-tag" href="https://trickster0.github.io/tags/certificate/">certificate</a> <a class="post-tag" href="https://trickster0.github.io/tags/cisco/">cisco</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip="">Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="https://trickster0.github.io/posts/Primitive-Injection/"><div class="card-body"> <span class="timeago small">Jun 6 <i class="unloaded">2025-06-06T00:00:00+08:00</i></span><h3 class="pt-0 mt-1 mb-3" data-toc-skip="">Primitive Injection - Breaking the Status Quo</h3><div class="text-muted small"><p> It has been a while, this is my research on trying to change the IOCs of a common remote process injection flow and the end result. I presented this in RedTreat in 2024 and I thought it was about t...</p></div></div></a></div><div class="card"> <a href="https://trickster0.github.io/posts/Halo's-Gate-Evolves-to-Tartarus-Gate/"><div class="card-body"> <span class="timeago small">Nov 27, 2021 <i class="unloaded">2021-11-27T00:00:00+08:00</i></span><h3 class="pt-0 mt-1 mb-3" data-toc-skip="">Halo's Gate Evolves -&gt; Tartarus' Gate</h3><div class="text-muted small"><p> A while ago in my twitter, I have mentioned what a huge fan I am of Hell’s Gate and Halo’s Gate. Hell’s Gate originally is a very creative way to fetch the syscall numbers by parsing the InMemoryOr...</p></div></div></a></div><div class="card"> <a href="https://trickster0.github.io/posts/Solving-the-BFS-EkoParty/"><div class="card-body"> <span class="timeago small">Nov 5, 2021 <i class="unloaded">2021-11-05T00:00:00+08:00</i></span><h3 class="pt-0 mt-1 mb-3" data-toc-skip="">Solving the BFS Ekoparty 2019 Exploitation Challenge</h3><div class="text-muted small"><p> This is a quick write up about how one of our team members, Thanasis, solved the challenge for EkoParty 2019. This was a fun challenge and thanks to Lukas and Nico from Blue Frost Security for maki...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="https://trickster0.github.io/posts/Halo's-Gate-Evolves-to-Tartarus-Gate/" class="btn btn-outline-primary" prompt="Older"><p>Halo's Gate Evolves -&gt; Tartarus' Gate</p></a> <a href="https://trickster0.github.io/posts/Primitive-Injection/" class="btn btn-outline-primary" prompt="Newer"><p>Primitive Injection - Breaking the Status Quo</p></a></div></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="https://trickster0.github.io/tags/hacking/">hacking</a> <a class="post-tag" href="https://trickster0.github.io/tags/vulnhub/">vulnhub</a> <a class="post-tag" href="https://trickster0.github.io/tags/vm/">vm</a> <a class="post-tag" href="https://trickster0.github.io/tags/challenge/">challenge</a> <a class="post-tag" href="https://trickster0.github.io/tags/challenges/">challenges</a> <a class="post-tag" href="https://trickster0.github.io/tags/hack/">hack</a> <a class="post-tag" href="https://trickster0.github.io/tags/0/">%0</a> <a class="post-tag" href="https://trickster0.github.io/tags/asa/">asa</a> <a class="post-tag" href="https://trickster0.github.io/tags/certificate/">certificate</a> <a class="post-tag" href="https://trickster0.github.io/tags/cisco/">cisco</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="https://trickster0.github.io/posts/Custom-ReadMemory-API/#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a>        
</body></html>