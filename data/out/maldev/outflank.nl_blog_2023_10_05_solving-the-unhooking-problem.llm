Title:
Solving The “Unhooking” Problem

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post discusses the practical problem of avoiding or removing EDR userland hooks when running code inside a C2 implant process, especially when executing external modules like BOFs or .NET executables.  
- It highlights how external code can load (or use already-loaded) DLLs that are hooked post-load by EDRs, making simple “wrap LoadLibrary + unhook” approaches incomplete due to dependency chains and alternate loader APIs (LoadLibraryExW, LdrLoadDll, etc.).  
- The proposed “better solution” is operator-facing tooling that can enumerate hooked user-mode functions and IAT hooks, then selectively clean/unhook them, rather than trying to fully hide complexity inside the implant.  
- Outflank describes implementing this in their Stage1 C2 with commands to list hooks and clean them, enabling operators to learn an EDR’s hooking strategy and validate whether hooks are restored.  
- It also emphasizes automation (Python wrappers/bots) to pre-load and unhook libraries before running OPSEC-sensitive modules.  
- Useful primarily for red team operators and offensive tool developers building resilient execution workflows in monitored Windows environments.

Technical Focus:
- Userland API hooking detection and removal (inline hooks)
- Import Address Table (IAT) hook detection/unhooking
- Windows DLL loading paths (LoadLibrary/LoadLibraryExW, LdrLoadDll)
- Operational tradeoffs: implant-side protection vs operator transparency
- Automation of pre-execution hygiene (library pre-load + unhook workflows)

Use Cases:
- Enumerate and remove EDR user-mode hooks before running BOFs or in-process tooling
- Identify which APIs an EDR hooks and adapt tradecraft accordingly
- Validate whether an EDR re-hooks functions after cleanup (persistence of hooks)
- Build automated “pre-flight” routines for OPSEC-sensitive module execution in C2

Keywords:
EDR, userland hooks, unhooking, inline hook, IAT hook, Windows API, LoadLibrary, LoadLibraryExW, LdrLoadDll, ntdll, AMSI, ETW, BOF, C2 implant, Stage1, OPSEC, automation, Python, DLL dependencies, hook enumeration