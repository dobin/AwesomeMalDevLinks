Title:
Uncovering Windows Events

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post walks through reverse engineering how Windows’ Threat-Intelligence (TI) ETW provider generates specific security telemetry, using WriteProcessMemory/NtWriteVirtualMemory as the example.  
- It addresses the gap that many manifest-based ETW providers exist but are not fully understood or consistently ingested by EDR/telemetry sensors.  
- The author demonstrates a practical methodology: locate TI provider registration in `ntoskrnl.exe` via `EtwRegister`, trace call sites to `EtwWrite`, and recover the `EVENT_DESCRIPTOR` (notably the Event ID and keyword mask) used for particular operations.  
- It highlights TI’s special requirement: events are only emitted/consumable when running as a Protected Process Light (PPL), explaining why vendor services commonly run as PPL and why tools like Sealighter-TI exist.  
- Useful for defenders building better detections and for red teamers/researchers validating what kernel-level telemetry exists around process memory operations and how vendors might be consuming it.  
- Interesting because it shows TI can expose high-fidelity kernel insights (e.g., remote process memory writes) without kernel hooking, and provides a repeatable approach for mapping other ETW providers.

Technical Focus:
- Event Tracing for Windows (ETW) manifest-based providers
- Threat-Intelligence ETW provider internals (kernel emission)
- `EtwRegister` / `EtwWrite` tracing in `ntoskrnl.exe`
- `EVENT_DESCRIPTOR` extraction (EventId, Keywords)
- Virtual memory read/write telemetry (`NtWriteVirtualMemory`, `MiReadWriteVirtualMemory`)
- Protected Process Light (PPL) requirements for TI logging

Use Cases:
- Map TI ETW event IDs/keywords to specific behaviors (e.g., remote process memory writes)
- Validate which low-level Windows events an EDR could ingest vs. what is missed
- Build or tune detections around process injection primitives (WriteProcessMemory/NtWriteVirtualMemory)
- Reverse engineer other ETW providers by tracing registration handles and write call paths
- Research PPL constraints and telemetry collection strategies for security tooling

Keywords:
ETW, Threat-Intelligence provider, ntoskrnl.exe, EtwRegister, EtwWrite, EVENT_DESCRIPTOR, EventId, Keyword mask, EtwProviderEnabled, Protected Process Light, PPL, EPROCESS, WinDbg, IDA Pro, WriteProcessMemory, NtWriteVirtualMemory, NtReadVirtualMemory, MiReadWriteVirtualMemory, PROCESS_VM_WRITE, PROCESS_VM_READ, telemetry, EDR ingestion