# https://devblogs.microsoft.com/oldnewthing/20040128-00/?p=40853

<!DOCTYPE html><html lang="en-US" theme="light" style="--scrollbar-width: 0px;" class="js"><body class="wp-singular post-template-default single single-post postid-40853 single-format-standard wp-theme-devblogs-evo sticky-menu" style="visibility: visible; opacity: 1;"><div id="sr-announcer" class="visually-hidden" role="status" aria-live="polite"></div>
<link rel="stylesheet" id="buttons-css" href="https://devblogs.microsoft.com/oldnewthing/wp-includes/css/buttons.min.css" type="text/css" media="all">



	<!-- Star cookies banner  -->
	<!--<script src="https://wcpstatic.microsoft.com/mscc/lib/v2/wcp-consent.js"></script> -->

	<div id="cookie-banner"></div>
	
	<!-- end cookies banner  -->
		<!-- UHF header -->
	<div id="headerArea" class="uhf" data-m="{&quot;cN&quot;:&quot;headerArea&quot;,&quot;cT&quot;:&quot;Area_coreuiArea&quot;,&quot;id&quot;:&quot;a1Body&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;Body&quot;}">
                <div id="headerRegion" data-region-key="headerregion" data-m="{&quot;cN&quot;:&quot;headerRegion&quot;,&quot;cT&quot;:&quot;Region_coreui-region&quot;,&quot;id&quot;:&quot;r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;a1&quot;}" style="overflow-x: visible;">

    <div id="headerUniversalHeader" data-m="{&quot;cN&quot;:&quot;headerUniversalHeader&quot;,&quot;cT&quot;:&quot;Module_coreui-universalheader&quot;,&quot;id&quot;:&quot;m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;r1a1&quot;}" data-module-id="Category|headerRegion|coreui-region|headerUniversalHeader|coreui-universalheader" style="overflow-x: visible;">
        


                        <div data-m="{&quot;cN&quot;:&quot;cookiebanner_cont&quot;,&quot;cT&quot;:&quot;Container&quot;,&quot;id&quot;:&quot;c1m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;m1r1a1&quot;}" style="overflow-x: visible;">

<div id="uhfCookieAlert" data-locale="en-us" style="overflow-x: visible;">
    <div id="msccBannerV2" style="overflow-x: visible;"></div>
</div>

                            
                        </div>




        <a id="uhfSkipToMain" class="m-skip-to-main" href="https://devblogs.microsoft.com/oldnewthing/20040128-00/?p=40853#main" data-href="#main" tabindex="0" data-m="{&quot;cN&quot;:&quot;Skip to content_nonnav&quot;,&quot;id&quot;:&quot;nn2m1r1a1&quot;,&quot;sN&quot;:2,&quot;aN&quot;:&quot;m1r1a1&quot;}" style="overflow-x: visible;">Skip to main content</a>







    </div>
        </div>

    </div><link rel="stylesheet" href="https://www.microsoft.com/onerfstatics/marketingsites-wcus-prod/west-european/shell/_scrf/css/themes=default.device=uplevel_web_pc/63-57d110/c9-be0100/a6-e969ef/43-9f2e7c/82-8b5456/a0-5d3913/3d-28500e/ae-f1ac0c?ver=2.0&amp;_cf=02242021_3231" type="text/css" media="all">	<!--/ UHF header -->
	
	<main class="devblogs-main" id="main" role="main">
							<div class="wrapper">
									<div class="container-evo pt-24">

													<div class="breadcrumbs-wrapper" data-bi-area="breadcrumb" data-bi-id="breadcrumb">
															</div>
						
												
							<!-- alert-banner-starts -->
														<!-- alert-banner-ends -->
											</div>
							
<div class="container-evo mt-56"> <!-- page container -->
  <div class="container-three-column-post"><!-- container-sidebar-left-post - top heading -->
    <div></div>
    <div class="pe-xl-198">
        <!-- .entry-header -->
                <div class="d-flex justify-content-between flex-column flex-lg-row align-items-center gap-24 mb-40" style="align-items: start;">
                            <div class="d-flex gap-10 align-items-center">
                    <div class="avatar-parent">
                        <img class="avatar-40" src="https://devblogs.microsoft.com/oldnewthing/wp-content/uploads/sites/38/2019/02/RaymondChen_5in-150x150.jpg" alt="Raymond Chen" style="width: 40px; height: 40px;">
                    </div>
                    <div class="d-flex flex-column">
                                                <div class="fs-16 fw-600">
                            <a class="read-more" href="https://devblogs.microsoft.com/oldnewthing/author/oldnewthing" aria-label="View Raymond Chen Author page" data-bi-area="body_author_top" data-bi-id="post_page_body_author_top_name" data-bi-name="Raymond Chen">Raymond Chen</a>
                        </div>

                                            </div>
                </div>
                    </div>
    </div>
    <div></div>
</div><!-- container-sidebar-left-post - top heading -->
<div class="container-three-column-post mb-40" id="single-wrapper">
    
    <article data-clarity-region="article" class="middle-column pe-xl-198" id="post-40853">
        <div class="entry-content sharepostcontent  remove_dcss" data-bi-area="body_article" data-bi-id="post_page_body_article">
            <p>
Your DllMain function runs inside the loader lock,
one of the few times the OS lets you run code while one
of its internal locks is held.
This means that you must be extra careful not to violate
a lock hierarchy in your DllMain; otherwise, you
are asking for a deadlock.
</p>
<p>
(You do have a
<a href="http://www.osr.com/ddk/ddtools/dv_8pkj.htm" target="_blank">
lock hierarchy</a> in your DLL, right?)
</p>
<p>
The loader lock is taken by any function that needs to
access the list of DLLs loaded into the process.
This includes functions like GetModuleHandle
and GetModuleFileName.
If your DllMain enters a critical section or waits on
a synchronization object, and that critical section or
synchronization object is owned by some code that is
in turn waiting for the loader lock, you just created a deadlock:
</p>
<pre tabindex="0">// global variable
CRITICAL_SECTION g_csGlobal;
// some code somewhere
EnterCriticalSection(&amp;g_csGlobal);
... GetModuleFileName(MyInstance, ..);
LeaveCriticalSection(&amp;g_csGlobal);
BOOL WINAPI
DllMain(HINSTANCE hinstDLL, DWORD fdwReason,
        LPVOID lpvReserved)
{
  switch (fdwReason) {
  ...
  case DLL_THREAD_DETACH:
   EnterCriticalSection(&amp;g_csGlobal);
   ...
  }
  ...
}
</pre>
<p>
Now imagine that some thread is happily executing the first
code fragment and enters g_csGlobal, then
gets pre-empty.  During this time, another thread exits.
This enters the loader lock and sends out
DLL_THREAD_DETACH messages while the loader lock is still held.
</p>
<p>
You receive the DLL_THREAD_DETACH and attempt to enter your DLL’s
g_csGlobal.  This blocks on the first thread, who owns the
critical section. That thread then resumes execution and calls
GetModuleFileName. This function requires the loader lock
(since it’s accessing the list of DLLs loaded into the process),
so it blocks, since the loader lock is owned by somebody else.
</p>
<p>
Now you have a deadlock:</p>
<ul>
<li>
g_cs owned by first thread, waiting on loader lock.<p></p>
</li><li>
Loader lock owned by second thread, waiting on g_cs.
</li></ul>
<p>
I have seen this happen. It’s not pretty.
</p>
<p>Moral of the story: Respect the loader lock.
Include it in your lock hierarchy rules if you take
any locks in your DllMain.</p>
        </div><!-- .entry-content -->

        <!-- AI Disclaimer -->
            </article>
    
<div class="left-sidebar">
    
</div></div><!-- This is the end of main section three column -->
<div class="container-three-column-post mb-40">
    <div></div>
    <div>
        <div class="border-bottom pb-40 mb-64"><div class="mb-24"><div class="fs-16 fw-600 mb-16">Category</div><div class="d-flex justify-content-start flex-wrap gap-12 post-topics"><a data-bi-area="body_category" data-bi-id="post_page_body_category" data-bi-name="Old New Thing Category" class="d-flex align-items-center btn-outline-secondary px-8" href="https://devblogs.microsoft.com/oldnewthing/category/oldnewthing" aria-label="Old New Thing Category">Old New Thing</a></div></div><div class="mb-24"><div class="fs-16 fw-600 pb-16">Topics</div><div class="d-flex justify-content-start flex-wrap gap-12 post-topics"><a data-bi-area="body_topics" data-bi-id="post_page_body_topics" data-bi-name="Code tag" class="d-flex align-items-center btn-outline-secondary px-8" href="https://devblogs.microsoft.com/oldnewthing/tag/code" aria-label="Code tag">Code</a></div></div><div class="post-detail-share social-panel" data-bi-area="body_share post">
					<div class="fs-16 fw-600 mb-16 x-hidden-focus">Share</div>
					<ul class="d-flex social-share-list gap-24 pl-0" style="list-style-type: none;">
						<li class="social-share-item">
							<a href="https://www.facebook.com/sharer/sharer.php?u=https://devblogs.microsoft.com/oldnewthing/20040128-00/?p=40853" data-bi-id="post_page_body_share post" data-post-id="40853" data-bi-name="Share on Facebook" aria-label="Share on Facebook" rel="noopener noreferrer nofollow" target="_blank" class="d-flex share-post">
								<span aria-hidden="true" class="msx-svg"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28" fill="none">
								<path d="M25.6663 13.9997C25.6663 7.55635 20.443 2.33301 13.9997 2.33301C7.55635 2.33301 2.33301 7.55635 2.33301 13.9997C2.33301 19.8228 6.59934 24.6494 12.1768 25.5246V17.3721H9.21452V13.9997H12.1768V11.4294C12.1768 8.5054 13.9185 6.8903 16.5834 6.8903C17.8599 6.8903 19.195 7.11816 19.195 7.11816V9.98926H17.7238C16.2746 9.98926 15.8226 10.8886 15.8226 11.8112V13.9997H19.0583L18.541 17.3721H15.8226V25.5246C21.4 24.6494 25.6663 19.8228 25.6663 13.9997Z" fill="#0F6CBD"></path>
								<path d="M19.0586 14H15.8229V11.8115C15.8229 10.8889 16.2749 9.98958 17.7242 9.98958H19.1953V7.11849C19.1953 7.11849 17.8602 6.89062 16.5838 6.89062C13.9188 6.89062 12.1771 8.50573 12.1771 11.4297V14H9.21484V17.3724H12.1771V25.5249C12.7711 25.6181 13.3798 25.6667 14 25.6667C14.6202 25.6667 15.2289 25.6181 15.8229 25.5249V17.3724H18.5413L19.0586 14Z" fill="white"></path></svg></span></a>
						</li>
						<li class="social-share-item">
							<a href="https://twitter.com/intent/tweet?url=https://devblogs.microsoft.com/oldnewthing/20040128-00/?p=40853&amp;text=Another%20reason%20not%20to%20do%20anything%20scary%20in%20your%20DllMain:%20Inadvertent%20deadlock" data-bi-id="post_page_body_share post" data-post-id="40853" data-bi-name="Share on X" aria-label="Share on X" target="_blank" rel="noreferrer noopener" class="d-flex share-post">
								<span aria-hidden="true" class="msx-svg"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28" fill="none"><path class="dark-theme" d="M16.1643 12.2581L24.6335 2.625H22.6266L15.2728 10.9893L9.39934 2.625H2.625L11.5068 15.2732L2.625 25.375H4.63204L12.3979 16.5421L18.6007 25.375H25.375L16.1638 12.2581H16.1643ZM13.4154 15.3847L12.5155 14.1252L5.35521 4.10339H8.43791L14.2164 12.1913L15.1163 13.4508L22.6276 23.9639H19.5449L13.4154 15.3852V15.3847Z" fill="#242424"></path></svg></span></a>
						</li>
						<li class="list-inline-item social-share-item">
							<a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://devblogs.microsoft.com/oldnewthing/20040128-00/?p=40853" data-bi-id="post_page_body_share post" data-post-id="40853" data-bi-name="Share on LinkedIn" aria-label="Share on LinkedIn" target="_blank" rel="noreferrer noopener" class="d-flex share-post"><span aria-hidden="true" class="msx-svg"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28" fill="none"><path d="M2.625 5.01974C2.625 3.69716 3.69716 2.625 5.01974 2.625H22.9803C24.3028 2.625 25.375 3.69716 25.375 5.01974V22.9803C25.375 24.3028 24.3028 25.375 22.9803 25.375H5.01974C3.69716 25.375 2.625 24.3028 2.625 22.9803V5.01974Z" fill="#0F6CBD"></path><path d="M9.77138 7.8028C9.77138 6.7122 8.8826 5.82715 7.79011 5.82715C6.69276 5.82715 5.80762 6.7122 5.80762 7.8028C5.80762 8.89461 6.69276 9.77967 7.79011 9.77967C8.8826 9.77967 9.77138 8.89461 9.77138 7.8028ZM18.1982 11.0052C21.6588 11.0052 22.2978 13.2747 22.2978 16.2273V22.2401H18.8809L18.8798 16.6214C18.8681 15.404 18.7292 14.0025 17.1057 14.0025C15.327 14.0025 15.0553 15.3882 15.0553 16.8185V22.2401H11.6433V11.2772H14.9183V12.7753H14.9656C15.4203 11.9132 16.5358 11.0052 18.1982 11.0052ZM9.50026 11.2774V22.2402H6.07971V11.2774H9.50026Z" fill="white"></path></svg></span></a>
						</li>
					</ul>
				</div></div>        <div><!-- Author section -->
            <h2 class="fs-20 mb-24">Author</h2>
            <div class="d-flex gap-24 flex-column flex-lg-row"><div style="flex: 0 0 100%"><div class="d-flex gap-12 align-items-start"><div class="avatar-parent" style="flex:0 0 auto;"><img class="avatar-40" src="https://devblogs.microsoft.com/oldnewthing/wp-content/uploads/sites/38/2019/02/RaymondChen_5in-150x150.jpg" alt="Raymond Chen" style="width: 64px; height: 64px;"></div><div style="flex: 1 0;"><div class="fs-16 fw-600"><a data-bi-area="body_author_bottom" data-bi-id="post_page_body_author_bottom_name" data-bi-name="Raymond Chen" class="read-more" href="https://devblogs.microsoft.com/oldnewthing/author/oldnewthing">Raymond Chen</a></div></div></div><p class="pt-20 fs-14">Raymond has been involved in the evolution of Windows for more than 30 years. In 2003, he began a Web site known as The Old New Thing which has grown in popularity far beyond his wildest imagination, a development which still gives him the heebie-jeebies. The Web site spawned a book, coincidentally also titled The Old New Thing (Addison Wesley 2007). He occasionally appears on the Windows Dev Docs Twitter account to tell stories which convey no useful information.</p></div></div>        </div>
    </div>
    <div></div>
</div>  <div class="container-three-column-even"><!-- start comments bottom full-width section -->
    <div></div><!-- Place holder for left sidebar -->
    <div class="mb-80" style="max-width: 1324px;"><!-- start max-width bottom section -->
      <!-- Comments section -->
      <div id="comments" class="mb-40" data-bi-area="body_comments" data-bi-id="post_page_body_comments">
        

    <div id="comments" class="comments-area" data-bi-id="post_page_body_comments">
    							<h2 class="comments-title"><span class="cm_count">0</span> comments</h2>
					
			<p class="nocomments">Discussion is closed.				</p>
	<div class="comment-reply-respond" id="comment-reply-respond">
	<form method="post" action="https://devblogs.microsoft.com/oldnewthing/wp-comments-post.php" id="commentform" class="wp-core-ui">
		<div id="editor-container-0">
			<div id="wp-comment_reply_content-wrap" class="wp-core-ui wp-editor-wrap html-active"><div id="wp-comment_reply_content-editor-container" class="wp-editor-container"><div id="qt_comment_reply_content_toolbar" class="quicktags-toolbar hide-if-no-js"><input type="button" id="qt_comment_reply_content_strong" class="ed_button button button-small" aria-label="Bold" value="b"><input type="button" id="qt_comment_reply_content_em" class="ed_button button button-small" aria-label="Italic" value="i"><input type="button" id="qt_comment_reply_content_link" class="ed_button button button-small" aria-label="Insert link" value="link"><input type="button" id="qt_comment_reply_content_del" class="ed_button button button-small" aria-label="Deleted text (strikethrough)" value="del"><input type="button" id="qt_comment_reply_content_customcode" class="ed_button button button-small" value="code"></div><textarea class="wp-editor-area" style="height: 200px" cols="40" name="comment_reply_content" id="comment_reply_content" aria-label="textarea editor"></textarea></div>
</div>

			<div class="vote">
				<span class="form-submit">
					<input name="submit" type="submit" id="submit" class="btn btn-primary" value="Reply">
					<input type="button" value="Cancel" id="cancel-reply-comment-form" name="Cancel" class="btn btn-secondary">
					
					
				</span>
				<span class="code-of-conduct"><a href="https://aka.ms/msftqacodeconduct" target="_blank">Code of Conduct</a></span>
			</div>
			
		</div><!-- editor-container -->
	</form>
</div>
				<ul class="commentlist">
					</ul><!-- .commentlist -->
			</div><!-- #comments .comments-area -->
      </div>
      <div class="read-next-desktop">
        
      </div>
      <!-- Stay Informed Section -->
      
<div class="stay-informed d-flex align-items-stretch flex-column flex-lg-row border-2 border-r-8 p-16">
    <div class="newsletter-form w-100" id="subscribe_form" data-bi-area="body_newsletter" data-bi-id="post_page_body_newsletter">
        <h2 id="stayInformed" class="fs-20 fw-600 mb-8">Stay informed</h2>
        <div class="fs-14 pb-16">Get notified when new posts are published.</div>
            <form method="post" action="https://devblogs.microsoft.com/oldnewthing?na=s">
                
                <div class="d-flex flex-column gap-12 mb-12">
                    <label for="ne">Email <span>*</span></label>
                    <div class="d-flex align-items-center justify-content-start flex-md-grow-1 bg-white" style="align-self: stretch; height: 32px; border-radius: 4px; overflow: hidden; border: 1px solid var(--clr-border); width: 90%;"> <input class="x-hidden-focus bg-white" style="flex: 1 1 0; align-self: stretch; border: none; padding: 4px 10px; font-family: Segoe UI; color: var(--clr-body);" type="email" name="ne" placeholder="Enter your email" required="" aria-required="true" autocomplete="email">
                    </div><div class="tnp-field tnp-field-profile"><label for="np1">Country/Region <span>*</span></label>
                        <select class="tnp-profile tnp-profile-1 mt-8" id="tnp-profile_1" name="np1" aria-label="Select Country/Region" required="" aria-required="true"><option value="" selected="" disabled="">Select...</option><option>United States</option><option>Afghanistan</option><option>Åland Islands</option><option>Albania</option><option>Algeria</option><option>American Samoa</option><option>Andorra</option><option>Angola</option><option>Anguilla</option><option>Antarctica</option><option>Antigua and Barbuda</option><option>Argentina</option><option>Armenia</option><option>Aruba</option><option>Australia</option><option>Austria</option><option>Azerbaijan</option><option>Bahamas</option><option>Bahrain</option><option>Bangladesh</option><option>Barbados</option><option>Belarus</option><option>Belgium</option><option>Belize</option><option>Benin</option><option>Bermuda</option><option>Bhutan</option><option>Bolivia</option><option>Bonaire</option><option>Bosnia and Herzegovina</option><option>Botswana</option><option>Bouvet Island</option><option>Brazil</option><option>British Indian Ocean Territory</option><option>British Virgin Islands</option><option>Brunei</option><option>Bulgaria</option><option>Burkina Faso</option><option>Burundi</option><option>Cabo Verde</option><option>Cambodia</option><option>Cameroon</option><option>Canada</option><option>Cayman Islands</option><option>Central African Republic</option><option>Chad</option><option>Chile</option><option>China</option><option>Christmas Island</option><option>Cocos (Keeling) Islands</option><option>Colombia</option><option>Comoros</option><option>Congo</option><option>Congo (DRC)</option><option>Cook Islands</option><option>Costa Rica</option><option>Côte dIvoire</option><option>Croatia</option><option>Curaçao</option><option>Cyprus</option><option>Czechia</option><option>Denmark</option><option>Djibouti</option><option>Dominica</option><option>Dominican Republic</option><option>Ecuador</option><option>Egypt</option><option>El Salvador</option><option>Equatorial Guinea</option><option>Eritrea</option><option>Estonia</option><option>Eswatini</option><option>Ethiopia</option><option>Falkland Islands</option><option>Faroe Islands</option><option>Fiji</option><option>Finland</option><option>France</option><option>French Guiana</option><option>French Polynesia</option><option>French Southern Territories</option><option>Gabon</option><option>Gambia</option><option>Georgia</option><option>Germany</option><option>Ghana</option><option>Gibraltar</option><option>Greece</option><option>Greenland</option><option>Grenada</option><option>Guadeloupe</option><option>Guam</option><option>Guatemala</option><option>Guernsey</option><option>Guinea</option><option>Guinea-Bissau</option><option>Guyana</option><option>Haiti</option><option>Heard Island and McDonald Islands</option><option>Honduras</option><option>Hong Kong SAR</option><option>Hungary</option><option>Iceland</option><option>India</option><option>Indonesia</option><option>Iraq</option><option>Ireland</option><option>Isle of Man</option><option>Israel</option><option>Italy</option><option>Jamaica</option><option>Jan Mayen</option><option>Japan</option><option>Jersey</option><option>Jordan</option><option>Kazakhstan</option><option>Kenya</option><option>Kiribati</option><option>Korea</option><option>Kosovo</option><option>Kuwait</option><option>Kyrgyzstan</option><option>Laos</option><option>Latvia</option><option>Lebanon</option><option>Lesotho</option><option>Liberia</option><option>Libya</option><option>Liechtenstein</option><option>Lithuania</option><option>Luxembourg</option><option>Macau SAR</option><option>Madagascar</option><option>Malawi</option><option>Malaysia</option><option>Maldives</option><option>Mali</option><option>Malta</option><option>Marshall Islands</option><option>Martinique</option><option>Mauritania</option><option>Mauritius</option><option>Mayotte</option><option>Mexico</option><option>Micronesia</option><option>Moldova</option><option>Monaco</option><option>Mongolia</option><option>Montenegro</option><option>Montserrat</option><option>Morocco</option><option>Mozambique</option><option>Myanmar</option><option>Namibia</option><option>Nauru</option><option>Nepal</option><option>Netherlands</option><option>New Caledonia</option><option>New Zealand</option><option>Nicaragua</option><option>Niger</option><option>Nigeria</option><option>Niue</option><option>Norfolk Island</option><option>North Macedonia</option><option>Northern Mariana Islands</option><option>Norway</option><option>Oman</option><option>Pakistan</option><option>Palau</option><option>Palestinian Authority</option><option>Panama</option><option>Papua New Guinea</option><option>Paraguay</option><option>Peru</option><option>Philippines</option><option>Pitcairn Islands</option><option>Poland</option><option>Portugal</option><option>Puerto Rico</option><option>Qatar</option><option>Réunion</option><option>Romania</option><option>Rwanda</option><option>Saba</option><option>Saint Barthélemy</option><option>Saint Kitts and Nevis</option><option>Saint Lucia</option><option>Saint Martin</option><option>Saint Pierre and Miquelon</option><option>Saint Vincent and the Grenadines</option><option>Samoa</option><option>San Marino</option><option>São Tomé and Príncipe</option><option>Saudi Arabia</option><option>Senegal</option><option>Serbia</option><option>Seychelles</option><option>Sierra Leone</option><option>Singapore</option><option>Sint Eustatius</option><option>Sint Maarten</option><option>Slovakia</option><option>Slovenia</option><option>Solomon Islands</option><option>Somalia</option><option>South Africa</option><option>South Georgia and South Sandwich Islands</option><option>South Sudan</option><option>Spain</option><option>Sri Lanka</option><option>St Helena</option><option>Ascension</option><option>Tristan da Cunha</option><option>Suriname</option><option>Svalbard</option><option>Sweden</option><option>Switzerland</option><option>Taiwan</option><option>Tajikistan</option><option>Tanzania</option><option>Thailand</option><option>Timor-Leste</option><option>Togo</option><option>Tokelau</option><option>Tonga</option><option>Trinidad and Tobago</option><option>Tunisia</option><option>Turkey</option><option>Turkmenistan</option><option>Turks and Caicos Islands</option><option>Tuvalu</option><option>U.S. Outlying Islands</option><option>U.S. Virgin Islands</option><option>Uganda</option><option>Ukraine</option><option>United Arab Emirates</option><option>United Kingdom</option><option>Uruguay</option><option>Uzbekistan</option><option>Vanuatu</option><option>Vatican City</option><option>Venezuela</option><option>Vietnam</option><option>Wallis and Futuna</option><option>Yemen</option><option>Zambia</option><option>Zimbabwe</option></select>
                        </div><div id="privacyField" class="tnp-field tnp-privacy-field">
                        <label>I would like to receive the The Old New Thing Newsletter. <a style="color: var(--clr-body-link); text-decoration: underline;" target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=521839">Privacy Statement.</a></label>
                    </div>
                    <div id="consentContainer"></div>
                    <div class="d-flex">
                        <button class="tnp-submit btn-primary" type="submit" value="Subscribe">Subscribe</button>
                    </div>
                </div>
            </form>
        </div>        <div class="follow-blog w-100">
        <div class="fs-20 fw-600 mb-16">Follow this blog</div>
        <div class="d-inline-flex justify-content-start align-items-center flex-wrap gap-24" data-bi-area="body_blog_follow">
            <a style="width: 24px; height: 24px; position: relative;" title="twitter" data-bi-id="post_page_body_blog_follow" data-bi-name="The Old New Thing-twitter" aria-label="Follow Us on Twitter" target="_blank" href="https://twitter.com/ChenCravat"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path class="dark-theme" d="M14.4821 10.6218L21.0389 3H19.4852L13.7919 9.61788L9.24467 3H4L10.8763 13.0074L4 21H5.55384L11.5661 14.0113L16.3683 21H21.613L14.4817 10.6218H14.4821ZM12.3539 13.0956L11.6572 12.0991L6.11372 4.16971H8.50033L12.974 10.5689L13.6707 11.5655L19.4859 19.8835H17.0993L12.3539 13.096V13.0956Z"></path></svg></a><a style="width: 24px; height: 24px; position: relative;" title="youtube" data-bi-id="post_page_body_blog_follow" data-bi-name="The Old New Thing-youtube" aria-label="Follow Us on YouTube" target="_blank" href="https://www.youtube.com/playlist?list=PLlrxD0HtieHge3_8Dm48C0Ns61I6bHThc"><img src="https://devblogs.microsoft.com/oldnewthing/wp-content/themes/devblogs-evo/images/social-icons/youtube.svg" alt="youtube" width="300" height="150"></a><a style="width: 24px; height: 24px; position: relative;" title="GitHub" data-bi-id="post_page_body_blog_follow" data-bi-name="The Old New Thing-github" aria-label="Follow Us on GitHub" target="_blank" href="https://github.com/oldnewthing"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="24" viewBox="0 0 25 24"><g clip-path="url(#clip0_4234_38739)"><path class="dark-theme" fill-rule="evenodd" clip-rule="evenodd" d="M13.2989 0C6.67328 0 0.5 5.37254 0.5 12.0004C0.5 17.3022 3.93804 21.7996 8.70651 23.3864C9.3069 23.4969 9.52569 23.1263 9.52569 22.8081C9.52569 22.5237 9.51538 21.7686 9.50949 20.7675C6.17163 21.4924 5.46737 19.1586 5.46737 19.1586C4.9215 17.7722 4.13473 17.4031 4.13473 17.4031C3.0452 16.6591 4.21724 16.6738 4.21724 16.6738C5.4217 16.7585 6.05523 17.9107 6.05523 17.9107C7.12562 19.7443 8.86416 19.2146 9.54779 18.9074C9.65682 18.1324 9.96696 17.6035 10.3095 17.3037C7.64497 17.0009 4.84341 15.971 4.84341 11.3727C4.84341 10.0629 5.3112 8.99107 6.07881 8.15274C5.95505 7.84923 5.54325 6.62856 6.19668 4.97695C6.19668 4.97695 7.2037 4.65429 9.49623 6.20719C10.4532 5.94051 11.4801 5.80791 12.5004 5.80276C13.5199 5.80791 14.5461 5.94051 15.5045 6.20719C17.7956 4.65429 18.8011 4.97695 18.8011 4.97695C19.456 6.62856 19.0442 7.84923 18.9212 8.15274C19.6903 8.99107 20.1544 10.0629 20.1544 11.3727C20.1544 15.9828 17.3484 16.9972 14.6758 17.2941C15.106 17.6646 15.4898 18.3969 15.4898 19.5166C15.4898 21.1204 15.475 22.4147 15.475 22.8081C15.475 23.1293 15.6916 23.5027 16.3001 23.3856C21.0649 21.7951 24.5 17.3007 24.5 12.0004C24.5 5.37254 19.1267 0 12.4989 0"></path></g><defs><clipPath id="clip0_4234_38739"><rect width="24" height="24" fill="white" transform="translate(0.5)"></rect></clipPath></defs></svg></a><a style="width: 24px; height: 24px; position: relative;" title="RSS Feed" data-bi-id="post_page_body_blog_follow" data-bi-name="The Old New Thing-rss-feed" aria-label="Subscribe to Our RSS Feed" target="_blank" href="https://devblogs.microsoft.com/oldnewthing/feed/"><svg xmlns="http://www.w3.org/2000/svg" class="dark-theme-rss" width="24" height="24" viewBox="0 0 24 24" fill="none"><path class="dark-theme" d="M6.25 3C4.45507 3 3 4.45507 3 6.25V17.75C3 19.5449 4.45507 21 6.25 21H17.75C19.5449 21 21 19.5449 21 17.75V6.25C21 4.45507 19.5449 3 17.75 3H6.25ZM6.75 7.5C6.34494 7.5 6 7.18276 6 6.7777V6.7233C6 6.33021 6.30507 6.00189 6.69816 6.00012L6.75 6C12.9632 6 18 11.0368 18 17.25L17.9999 17.3018C17.9981 17.6949 17.6698 18 17.2767 18H17.2223C16.8172 18 16.5 17.6551 16.5 17.25C16.5 11.8652 12.1348 7.5 6.75 7.5ZM13.294 18H13.2036C12.805 18 12.5 17.6486 12.5 17.25C12.5 14.0744 9.92564 11.5 6.75 11.5C6.35135 11.5 6 11.195 6 10.7964V10.706C6 10.3267 6.2871 10.0048 6.66639 10.0005C6.69422 10.0002 6.72209 10 6.75 10C10.7541 10 14 13.2459 14 17.25C14 17.2779 13.9998 17.3058 13.9995 17.3336C13.9952 17.7129 13.6733 18 13.294 18ZM7.5 18C6.67157 18 6 17.3284 6 16.5C6 15.6716 6.67157 15 7.5 15C8.32843 15 9 15.6716 9 16.5C9 17.3284 8.32843 18 7.5 18Z" fill="#DA3B01"></path></svg></a>        </div>
    </div>
</div>
    </div><!-- end max-width bottom section -->
  </div><!-- end comments bottom full-width section -->
</div>

<!-- Comment icon loader model / popup -->


<!-- Comment icon cofirm model / popup -->

<!-- Code Header for Post detail pages and Code to append a click to copy button -->
<!-- End -->



</div><!-- end .wrapper -->
</main><!-- end #main -->

<!-- Add a hidden dark theme button to trigger the toggle function -->
<div style="display:none;">
        
    </div>
    
    














































		
				
				<div id="wp-link-backdrop" style="display: none"></div>
		<div id="wp-link-wrap" class="wp-core-ui" style="display: none" role="dialog" aria-modal="true" aria-labelledby="link-modal-title">
		<form id="wp-link" tabindex="-1">
				<h1 id="link-modal-title">Insert/edit link</h1>
		<button type="button" id="wp-link-close"><span class="screen-reader-text">
			Close		</span></button>
		<div id="link-selector">
			<div id="link-options">
				<p class="howto" id="wplink-enter-url">Enter the destination URL</p>
				<div>
					<label><span>URL</span>
					<input id="wp-link-url" type="text" aria-describedby="wplink-enter-url"></label>
				</div>
				<div class="wp-link-text-field">
					<label><span>Link Text</span>
					<input id="wp-link-text" type="text"></label>
				</div>
				<div class="link-target">
					<label><span></span>
					<input type="checkbox" id="wp-link-target"> Open link in a new tab</label>
				</div>
			</div>
			<p class="howto" id="wplink-link-existing-content">Or link to existing content</p>
			<div id="search-panel">
				<div class="link-search-wrapper">
					<label>
						<span class="search-label">Search</span>
						<input type="search" id="wp-link-search" class="link-search-field" autocomplete="off" aria-describedby="wplink-link-existing-content">
						<span class="spinner"></span>
					</label>
				</div>
				<div id="search-results" class="query-results" tabindex="0">
					<ul></ul>
					<div class="river-waiting">
						<span class="spinner"></span>
					</div>
				</div>
				<div id="most-recent-results" class="query-results" tabindex="0">
					<div class="query-notice" id="query-notice-message">
						<em class="query-notice-default">No search term specified. Showing recent items.</em>
						<em class="query-notice-hint screen-reader-text">
							Search or use up and down arrow keys to select an item.						</em>
					</div>
					<ul></ul>
					<div class="river-waiting">
						<span class="spinner"></span>
					</div>
				</div>
			</div>
		</div>
		<div class="submitbox">
			<div id="wp-link-cancel">
				<button type="button" class="button">Cancel</button>
			</div>
			<div id="wp-link-update">
				<input type="submit" value="Add Link" class="button button-primary" id="wp-link-submit" name="wp-link-submit">
			</div>
		</div>
		</form>
		</div>
		    
            		
		<!-- Model form for code insert  -->
	



  

<!-- UHF footer -->
<div id="footerArea" class="uhf" data-m="{&quot;cN&quot;:&quot;footerArea&quot;,&quot;cT&quot;:&quot;Area_coreuiArea&quot;,&quot;id&quot;:&quot;a2Body&quot;,&quot;sN&quot;:2,&quot;aN&quot;:&quot;Body&quot;}">
                <div id="footerRegion" data-region-key="footerregion" data-m="{&quot;cN&quot;:&quot;footerRegion&quot;,&quot;cT&quot;:&quot;Region_coreui-region&quot;,&quot;id&quot;:&quot;r1a2&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;a2&quot;}">

    <div id="footerUniversalFooter" data-m="{&quot;cN&quot;:&quot;footerUniversalFooter&quot;,&quot;cT&quot;:&quot;Module_coreui-universalfooter&quot;,&quot;id&quot;:&quot;m1r1a2&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;r1a2&quot;}" data-module-id="Category|footerRegion|coreui-region|footerUniversalFooter|coreui-universalfooter">
        













    </div>
        </div>

    </div><!--/ UHF footer -->
<!-- back to top button -->
<div class="back-comment-buttons" data-bi-area="sidebar">
  

<div class="evo-right-sidebar">
    <a data-bi-id="click back to top of page" data-bi-name="Back to top" href="https://devblogs.microsoft.com/oldnewthing/20040128-00/?p=40853#page" title="Back to top" aria-label="click back to top of page" class="evo-sidebar-button back-to-top">
        <span class="evo-sidebar-button-inner">
            <svg width="30" height="30" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M39.5607 32.0607C38.9749 32.6464 38.0251 32.6464 37.4393 32.0607L24 18.6213L10.5607 32.0607C9.97487 32.6464 9.02513 32.6464 8.43934 32.0607C7.85355 31.4749 7.85355 30.5251 8.43934 29.9393L22.9393 15.4393C23.5251 14.8536 24.4749 14.8536 25.0607 15.4393L39.5607 29.9393C40.1464 30.5251 40.1464 31.4749 39.5607 32.0607Z" fill="currentColor"></path>
            </svg>
        </span>
    </a>
</div>
</div>
<!-- back to top button -->
<!-- UHF search functionality query parameter append for all pages excluding landing page -->
  



<div class="devblogs-lightbox-overlay"><div class="devblogs-lightbox-content" role="dialog" aria-modal="true"><button class="devblogs-lightbox-close" aria-label="Close" type="button">×</button><img class="devblogs-lightbox-img" alt=""></div></div><p id="a11y-speak-intro-text" class="a11y-speak-intro-text" style="position:absolute;margin:-1px;padding:0;height:1px;width:1px;overflow:hidden;clip-path:inset(50%);border:0;word-wrap:normal !important;">Notifications</p><div id="a11y-speak-assertive" class="a11y-speak-region" style="position:absolute;margin:-1px;padding:0;height:1px;width:1px;overflow:hidden;clip-path:inset(50%);border:0;word-wrap:normal !important;" aria-live="assertive" aria-relevant="additions text" aria-atomic="true"></div><div id="a11y-speak-polite" class="a11y-speak-region" style="position:absolute;margin:-1px;padding:0;height:1px;width:1px;overflow:hidden;clip-path:inset(50%);border:0;word-wrap:normal !important;" aria-live="polite" aria-relevant="additions text" aria-atomic="true"></div></body></html>