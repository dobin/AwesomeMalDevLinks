Title:
Windows API hooking with Rust on Windows ARM

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post walks through implementing Windows user-mode API/function hooking on Windows 11 ARM64 using Rust, focusing on detour-style inline hooks.  
- It demonstrates two approaches: a “naive” hook that temporarily restores original bytes inside the hook to call the real API, and a more robust trampoline hook that preserves overwritten instructions and resumes execution after the patched prologue.  
- The author explains ARM64-specific constraints (fixed 32-bit instruction width, 48-bit VA space) and how detour jumps are built by loading a target address via `MOVZ/MOVK` sequences followed by `BR/RET`.  
- A key technical challenge covered is handling PC-relative instructions when building trampolines (notably `ADRP` and `CBZ`), including decoding/rewriting them so relocated code remains correct.  
- The examples hook `MessageBoxW`, inspect/modify arguments, and use Windows APIs like `LoadLibraryA`, `GetProcAddress`, `WriteProcessMemory`, and `VirtualAlloc`.  
- Useful for malware developers, red teamers, and reverse engineers working on ARM64 Windows, and for defenders wanting to understand how inline hooks and trampolines are implemented on ARM64.

Technical Focus:
- ARM64 inline hooking (detour jumps) and instruction encoding
- Trampoline generation and relocated code execution
- PC-relative instruction patching (`ADRP`, `CBZ/CBNZ`)
- Rust FFI with Windows APIs (`GetProcAddress`, `WriteProcessMemory`, `VirtualAlloc`)
- Hook safety concerns (recursion, race conditions, atomic patching/transactions)

Use Cases:
- Implement user-mode API monitoring/interception on Windows ARM64
- Modify API parameters/behavior (e.g., sandboxing `Sleep`, blocking `TerminateProcess`)
- Build custom instrumentation for reverse engineering or malware analysis
- Research/replicate Detours-like hooking behavior on ARM64 in Rust
- Develop and test EDR-like userland protections (and understand bypass surface)

Keywords:
Windows 11 ARM64, AArch64, Rust, API hooking, inline hook, detour jump, trampoline, Microsoft Detours, MessageBoxW, LoadLibraryA, GetProcAddress, WriteProcessMemory, VirtualAlloc, PAGE_EXECUTE_READWRITE, ADRP, CBZ, CBNZ, MOVZ, MOVK, BR, RET, PC-relative addressing, instruction encoding, user-mode hooking