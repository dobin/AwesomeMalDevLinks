Title:
Tradecraft Garden — Stack Cutting (Simple Loader Hooking Module)

Type:
Documentation

Short Summary (4–8 sentences max):
- This module implements a “stack-cutting” call proxy for a Windows PIC/DLL loader so sensitive Win32 API calls execute with a cleaner/truncated call stack during stack walking.  
- It hooks selected APIs (VirtualAlloc, VirtualProtect, LoadLibraryA, Sleep, MessageBoxA) and forwards them through a proxy that rewrites the current frame pointer/return address to point to an earlier “legitimate” frame, attempting to hide loader/injected frames.  
- The write-up highlights x64-specific unwinding challenges: PIC code lacks .pdata/UNWIND_INFO, so StackWalk64-style heuristics require additional tricks (e.g., planting a spoofed return address at the top of the proxy frame).  
- It discusses practical limitations where x64 shadow space and callee register saves can stomp the planted return address (e.g., Sleep vs VirtualAlloc behavior), sometimes resulting only in truncated stacks.  
- The proxy is placed preferentially into an image-backed “code cave” (slack space in executable sections of the main module or kernel32) to avoid private RWX memory, with VirtualAlloc as fallback.  
- It’s primarily useful for red team/payload developers and researchers evaluating call stack-based detections and the reliability of stack spoofing across APIs and architectures.

Technical Focus:
- Call stack spoofing / “stack cutting” via frame pointer & return address manipulation
- x64 stack unwinding mechanics (.pdata, UNWIND_INFO absence in PIC, StackWalk64 heuristics)
- Win32 API hooking and call proxying in a custom loader
- Code cave discovery and PIC placement in image-backed memory
- x64 shadow space / callee-saved register interactions affecting spoof stability
- Loader self-hooking (“hooking inception”) and opt-out to avoid pre-init recursion

Use Cases:
- Reduce visibility of loader/injection frames in user-mode call stack telemetry
- Experimentally assess which Win32/Nt APIs are compatible with stack spoofing on x64
- Prototype stack-walk evasion techniques for custom loaders and reflective/PIC payloads
- Purple-team validation of EDR detections relying on suspicious call stacks
- Research on reliability pitfalls of stack spoofing without proper unwind metadata

Keywords:
stack cutting, call stack spoofing, StackWalk64, x64 unwinding, .pdata, UNWIND_INFO, shadow space, frame pointer, return address spoofing, position-independent code, PIC, Win32 API hooking, VirtualAlloc, VirtualProtect, LoadLibraryA, Sleep, NtAllocateVirtualMemory, code cave, reflective loader, CreateRemoteThread, System Informer