Title:
Modern Shellcode Implant Design (Stardust PIC Template)

Type:
Blog Post

Short Summary (4–8 sentences max):
- This post describes a “modern” approach to writing fully position-independent (PIC) Windows implants/shellcode without using reflective DLL loaders.  
- It argues reflective loaders are noisy (allocation + PE parsing/mapping, relocations, IAT fixing) and can leave signature-friendly artifacts in memory.  
- The proposed “Stardust” design uses a custom section layout and linker script to embed code, raw strings, and a dedicated page-aligned `.global` section for global state.  
- The implant finds its own base/end in memory via RIP-relative techniques, then temporarily changes page protections with `NtProtectVirtualMemory` to write a heap-allocated `INSTANCE` pointer into `.global`.  
- APIs are resolved dynamically by walking the PEB and parsing exports, using compile-time `constexpr` djb2 hashing to avoid runtime string handling.  
- Useful for red teamers, implant developers, and malware researchers building modular shellcode that needs maintainable global state and fewer loader-like behaviors.

Technical Focus:
- Position-independent code (PIC) implant layout using custom sections/linker scripts
- Self-location via RIP/return-address techniques (CET-friendly call/ret pairing)
- PEB-based module discovery and export resolution (manual GetProcAddress)
- Page protection changes with `NtProtectVirtualMemory` for writable global state
- Heap-backed global `INSTANCE` pattern for configuration/API tables
- Compile-time hashing (`constexpr` djb2) for API name obfuscation

Use Cases:
- Building loader-less shellcode implants that execute “as-is” in memory
- Maintaining global configuration/state across modules (e.g., tasking, comms, BOF/COFF integration)
- Reducing reflective-loader style telemetry/signatures (less PE mapping behavior)
- Creating modular implant templates for C2 frameworks (e.g., Havoc rewrite context)
- Implementing dynamic API resolution without embedded plaintext strings

Keywords:
position-independent code, PIC, shellcode, Windows x64 calling convention, CET, Control-flow Enforcement Technology, reflective DLL injection, manual mapping, linker script, section ordering, page alignment, PEB, InLoadOrderModuleList, export parsing, NtProtectVirtualMemory, RtlAllocateHeap, ntdll, kernel32, LoadLibraryW, djb2, constexpr hashing, global instance, .rdata, .text$A, .text$B, .global